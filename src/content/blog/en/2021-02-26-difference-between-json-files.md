---
author: Daniel Gustaw
canonicalName: calculating-the-difference-between-json-files
coverImage: http://localhost:8484/7f52c42e-103b-4ef9-b689-d08807ad2f7f.avif
date_updated: 2023-10-12
description: Learn how to find missing translations in JSON files with dictionaries.
excerpt: Learn how to find missing translations in JSON files with dictionaries.
publishDate: 2021-02-26
slug: en/calculating-the-difference-between-json-files
tags:
- i18next
title: Calculating the Difference Between JSON Files
---


In this article, we will demonstrate how to create a function that identifies the differences between two JSON files.

From an educational standpoint, this serves as an excellent example of using recursive functions. From a practical
perspective, it's a valuable tool for managing translations.

To begin, we'll create a command that reads the files and prints all keys present in the first file but missing in the
second file to the standard output.

We will start by checking if the files indicated as arguments exist:

```js
const fs = require('fs')

const pathBase = `${process.cwd()}/${process.argv[2]}`;
const pathComp = `${process.cwd()}/${process.argv[3]}`;

if (!fs.existsSync(pathBase)) {
  console.error(`File ${pathBase} not existst`);
  process.exit()
}

if (!fs.existsSync(pathComp)) {
  console.error(`File ${pathComp} not existst`);
  process.exit()
}
```

Next, we'll read the contents of these files and convert JSON to objects:

```javascript
const base = JSON.parse(fs.readFileSync(pathBase).toString());
const comp = JSON.parse(fs.readFileSync(pathComp).toString());
```

Now, we'll define a function for finding differences:

```javascript
function getDiff(a, b) {
  const res = {};

  for (let key in a) {
    if (a.hasOwnProperty(key)) {
      if (!b.hasOwnProperty(key)) {
        res[key] = a[key]
      } else {
        if (typeof a[key] === 'object') {
          res[key] = getDiff(a[key], b[key])
        }
      }
      if (res[key] && !Object.keys(res[key]).length) {
        delete res[key];
      }
    }
  }

  return res;
}
```

This function takes a pair of objects and iterates through the keys of the first (base) object. If the second object
(comparison) does not have the key, it is added to the result. If the key is present, it checks if the type is an object
and, if so, recursively calls the getDiff function.

Finally, we delete keys with empty objects before displaying the results:

```javascript
process.stdout.write(JSON.stringify(getDiff(base, comp)))
```

Executing command this program with paths to files, we can expect that
all the keys that appear in the first file but are not in the second
file will be printed to the standard output.

```bash
node json-diff.js src/locales/en_old.json src/locales/en.json
```

Note that this program does not support arrays, as they are typically not used in translation files. If you're
interested in more advanced methods of comparing JSON files, you can explore discussions on Stack Overflow.

Now, let's see how the program works in practice using translation files. The first file, en_old.json, contains manually
prepared translations for the entire application, while the second one, en.json, is generated by i18next but may not
include all translations.

Initially, I manually compared both files by sorting them on the codeshack.io/json-sorter website. Then, I used the
diffchecker website to identify differences between them.

I created a file with the missing translations:

```bash
node json-diff.js src/locales/en_old.json src/locales/en.json > src/locales/en-codes.json
```

The formatted file, displayed using jq, contains all the missing keys.

When importing translation files, you can use the deepmerge package. Here's an example of an i18n configuration file:

```javascript
import Vue from 'vue'
import VueI18n from 'vue-i18n'
import deepmerge from 'deepmerge'

import en from 'vuetify/lib/locale/en'
import pl from 'vuetify/lib/locale/pl'

Vue.use(VueI18n);

const messages = {
  en: deepmerge(
    require('@/locales/en-codes.json'),
    require('@/locales/en.json'),
    {$vuetify: en}
  ),
  pl: deepmerge(
    require('@/locales/pl-codes.json'),
    require('@/locales/pl.json'),
    {$vuetify: pl}
  ),
};

export default new VueI18n({
  locale: process.env.VUE_APP_I18N_LOCALE || 'en',
  fallbackLocale: process.env.VUE_APP_I18N_FALLBACK_LOCALE || 'en',
  messages,
})

export const languages = [
  {text: 'lang.pl', value: 'pl'},
  {text: 'lang.en', value: 'en'},
];
```

If you have any experiences related to automating translation work or recommendations for tools and scripts, feel free
to share them in the comments. I'm interested in learning about the tools and approaches you use.

