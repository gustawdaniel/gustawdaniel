{"db":[{"meta":{"exported_on":1693678750128,"version":"5.42.0"},"data":{"benefits":[],"custom_theme_settings":[],"newsletters":[{"id":"640b49fb0f360525ad85157d","name":"Precise Lab","description":"Software House","slug":"default-newsletter","sender_email":null,"sender_reply_to":"newsletter","status":"active","visibility":"members","subscribe_on_signup":1,"sort_order":0,"header_image":null,"show_header_icon":1,"show_header_title":1,"title_font_category":"sans_serif","title_alignment":"center","show_feature_image":1,"body_font_category":"sans_serif","footer_content":"","show_badge":1,"sender_name":null,"created_at":"2023-03-10T15:17:15.000Z","updated_at":null,"show_header_name":0,"uuid":"320d7478-335e-4715-b453-1bec0c1a5937","feedback_enabled":0,"show_post_title_section":1,"show_comment_cta":1,"show_subscription_details":0,"show_latest_posts":0,"background_color":"light","border_color":null,"title_color":null}],"offer_redemptions":[],"offers":[],"posts":[{"id":"606d7a485d6c891ac9aa7242","uuid":"02de26cd-6cbc-4b82-8056-9cf79158f083","title":"Bolt (always) Lite - MITM, Proxy, Insomnia and Vue","slug":"bolt-always-lite-mitm-proxy-and-insomnia","mobiledoc":"{\"version\":\"0.3.1\",\"atoms\":[[\"soft-return\",\"\",{}],[\"soft-return\",\"\",{}],[\"soft-return\",\"\",{}]],\"cards\":[[\"bookmark\",{\"type\":\"bookmark\",\"url\":\"https://eaton-works.com/2016/07/31/reverse-engineering-and-removing-pokemon-gos-certificate-pinning/\",\"metadata\":{\"url\":\"https://eaton-works.com/2016/07/31/reverse-engineering-and-removing-pokemon-gos-certificate-pinning/\",\"title\":\"Reverse engineering and removing Pokémon GO’s certificate pinning | Eaton Works\",\"description\":null,\"author\":null,\"publisher\":\"Eaton Works\",\"thumbnail\":\"https://eaton-works.com/wp-content/uploads/PGOCP1.png\",\"icon\":null}}],[\"bookmark\",{\"type\":\"bookmark\",\"url\":\"https://mitmproxy.org/\",\"metadata\":{\"url\":\"https://mitmproxy.org/\",\"title\":\"mitmproxy - an interactive HTTPS proxy\",\"description\":null,\"author\":null,\"publisher\":\"an interactive HTTPS proxy\",\"thumbnail\":\"https://mitmproxy.org/logo-navbar.png\",\"icon\":\"https://mitmproxy.org/favicon.ico\"}}],[\"code\",{\"code\":\"mitmweb (or mitmproxy if you love CLIs)\"}],[\"image\",{\"src\":\"__GHOST_URL__/content/images/2021/04/image-20210404194651219-1.png\",\"width\":562,\"height\":158,\"cardWidth\":\"\",\"caption\":\"You will encounter such errors a lot - the most important thing is to listen to them!\"}],[\"image\",{\"src\":\"__GHOST_URL__/content/images/2021/04/image-20210404194923297.png\",\"width\":1664,\"height\":650,\"cardWidth\":\"\"}],[\"image\",{\"src\":\"__GHOST_URL__/content/images/2021/04/image-20210404195016612.png\",\"width\":1674,\"height\":1932}],[\"image\",{\"src\":\"__GHOST_URL__/content/images/2021/04/image-20210405122512692.png\",\"width\":1368,\"height\":1734,\"cardWidth\":\"\"}],[\"code\",{\"code\":\"gps_lat: current latitude\\ngps_lng: current longitude\\nsession_id: must not be null - doesn't really matter\\nuser_id: string of numbers identifying user\\ncountry: current country\\nlanguage: user language\\ndeviceType: in my case \\\"android\\\"\\nversion: in my case \\\"CA.7.01\\\"\\ndeviceId: unique deviceId string generated\\ndevice_name: string including android device model number - probably for statistical purposes\\ndevice_os_version: android version (in my case 10)\"}],[\"image\",{\"src\":\"__GHOST_URL__/content/images/2021/05/image.png\",\"width\":774,\"height\":596,\"caption\":\"A sad alert you will get whenever you move the pickup pin on m.bolt.eu.\"}],[\"image\",{\"src\":\"__GHOST_URL__/content/images/2021/05/image-1.png\",\"width\":284,\"height\":70}]],\"markups\":[[\"strong\"],[\"a\",[\"href\",\"https://github.com/Fuzion24/JustTrustMe\"]],[\"code\"],[\"a\",[\"href\",\"mailto:krzysztof.dziardziel@preciselab.io\"]]],\"sections\":[[1,\"p\",[[0,[],0,\"Howdy!\"]]],[1,\"p\",[[0,[],0,\"This is the first part on how we made ordering Bolt Lite always possible. In this part we will discuss practical usage of Man In The Middle (MITM) attack and proxying through PC.\"]]],[1,\"h2\",[[0,[0],1,\"Certificate Pinning\"]]],[1,\"p\",[[0,[],0,\"Since Bolt app doesn't use mechanism known as Certificate Pinning it should be an easy job to capture all data sent in the packets.Google has been suggesting implementing CP to all the developers since quite some time, but a few of developers still use it. From the apps that I use most frequently, it is only used by banks and cryptowallets.If there would be certificate pinning in Bolt app, the app would seem disconnected from the internet when sniffing.It is still possible to connect with API when certificate pinning is in place but it involves some APK reverse engineering. If you're interested in how to do that read an excellent @XeEaton article and after you've done with patching the APK come back to my article.\"]]],[10,0],[1,\"h2\",[[0,[0],1,\"MITM Proxy\"]]],[1,\"p\",[[0,[],0,\"To sniff on packets sent by the Bolt Android App we will be using mitmproxy, which is an open source project.\"]]],[10,1],[1,\"p\",[[0,[],0,\"If your Android version is higher than Nougat (Android 7), which probably is the case since you're a mega geek and you're reading this article, you'll also need:\"]]],[3,\"ul\",[[[0,[],0,\"rooted Android device\"]],[[0,[],0,\"Xposed Framework installed\"]],[[0,[],0,\"JustTrustMe (\"],[0,[1],1,\"https://github.com/Fuzion24/JustTrustMe\"],[0,[],0,\") module enabled\"]]]],[1,\"p\",[[0,[],0,\"After installing the mitmproxy on your local-network PC, run command:\"]]],[10,2],[1,\"p\",[[0,[],0,\"It will show you the port it's listening on (8080 by default). Go to the network settings of your Android device and type it in under \\\"Proxy\\\".From now on you can sniff the packets, just like you would be in dev-tools of Google Chrome.\"]]],[1,\"h2\",[[0,[0],1,\"Alternative way: HTTPCanary\"]]],[1,\"p\",[[0,[],0,\"GuoShi made an awesome job and a beautiful Android app that allows you to sniff packets in real time. Unfortunately, I wasn't able to find the way to access the logs from your PC in real-time, but it is still an easy job to input those into Insomnia for tests.\"]]],[1,\"h2\",[[0,[0],1,\"Insomnia\"]]],[1,\"p\",[[0,[],0,\"After I catched all the necessary requests I've proceeded to Insomnia to check which ones do I need.\"]]],[1,\"h3\",[[0,[0],1,\"Creating rides\"]]],[1,\"p\",[[0,[],0,\"The Bolt API, though not public, has still very descriptive error codes such as:\"]]],[10,3],[1,\"p\",[[0,[],0,\"Because of that I knew we need to take a step back and first search for a taxi options to obtain the price lock hash and category id (Bolt, Lite, Pets...), which will be sent with a query for creating a ride.\"]]],[1,\"h3\",[[0,[0],1,\"Searching for taxi options\"]]],[10,4],[1,\"p\",[[0,[],0,\"Sending such payload returns us with the list of possible fares and available bolt categories:\"]]],[10,5],[1,\"p\",[[0,[],0,\"What's intriguing about it is that we also get \\\"surge_multiplier\\\" parameter, which is not visible in the app. Nice!\"]]],[1,\"h2\",[[0,[0],1,\"Request flow\"]]],[10,6],[1,\"h2\",[[0,[0],1,\"Constant reuqest queries\"]]],[1,\"p\",[[0,[],0,\"After careful analysis of all 4 requests (creating a ride, cancelling a ride, getting available cars and polling current app status) it's pretty easy to notice that there are some parameters, which concern each of requests' query:\"]]],[10,7],[1,\"p\",[[0,[],0,\"We will refactor those as an object and configure axios so that this data will be sent with each request as an additional query.\"]]],[1,\"h2\",[[0,[0],1,\"Tech stack choice\"]]],[1,\"p\",[[0,[],0,\"As we frequently do in our software house, we will be using Vue with Nuxt for front end. For the backend we will be using our Precise Lab CORS proxy.\"]]],[1,\"h2\",[[0,[0],1,\"Card denied issue\"]]],[1,\"p\",[[0,[],0,\"Sometimes, when you create a new ride, bolt randomly throws a credit card authorization error, which looks like a bug in their API. We will just \"],[0,[2],1,\"try {} catch {}\"],[0,[],0,\" it, wait for the error, assert it, and repeat creating a new ride. It never happens the second time in a row, so we are fine with that solution.\"]]],[1,\"h2\",[[0,[0],1,\"Making it fancier\"]]],[1,\"p\",[[0,[],0,\"As a last step I will take care of showing the current ride status to the end-user and providing him with an exact map so that he can make sure he chose the right pick-up and drop-off points. There's no need for real-time driver tracking because you can do it in the app as you would normally, however this could be added easily as when the ride has been confirmed by the driver you get car coordinates and even car orientation (that's how the bolt app shows cars doing backflips and drifting) in every ride status request.\"]]],[1,\"h2\",[[0,[0],1,\"Achilles' heel\"]]],[1,\"p\",[[0,[],0,\"So it is deployed and you can use it! Yay!\"],[1,[],0,0],[0,[],0,\"The only issue is that you still need to get you API key. Sadly, you won't be able to find it in your Bolt app settings. To get it you need to analyse requests that your app sends and to do that you need HTTP Canary or other packet sniffer that I wrote about in the 1st part of this bolt-hacking adventure. The good news are that your bolt api token is valid indefinitely (or at least for a very long time).\"],[1,[],0,1],[0,[],0,\"Maybe we could get this token with bolt web application?\"],[1,[],0,2],[0,[],0,\"There's a bolt mobile web app but sadly, it doesn't really work anywhere:\"]]],[10,8],[1,\"p\",[[0,[],0,\"And if you look into HTTP requests that are sent back and forth:\"]]],[10,9],[1,\"p\",[[0,[],0,\"That's pretty much it! Thanks for reading folks!\"]]],[1,\"p\",[[0,[],0,\"If You love what we do, feel free to reach me at \"],[0,[3],1,\"krzysztof.dziardziel@preciselab.io\"],[0,[],0,\".\"]]]],\"ghostVersion\":\"4.0\"}","html":"<p>Howdy!</p><p>This is the first part on how we made ordering Bolt Lite always possible. In this part we will discuss practical usage of Man In The Middle (MITM) attack and proxying through PC.</p><h2 id=\"certificate-pinning\"><strong>Certificate Pinning</strong></h2><p>Since Bolt app doesn't use mechanism known as Certificate Pinning it should be an easy job to capture all data sent in the packets.Google has been suggesting implementing CP to all the developers since quite some time, but a few of developers still use it. From the apps that I use most frequently, it is only used by banks and cryptowallets.If there would be certificate pinning in Bolt app, the app would seem disconnected from the internet when sniffing.It is still possible to connect with API when certificate pinning is in place but it involves some APK reverse engineering. If you're interested in how to do that read an excellent @XeEaton article and after you've done with patching the APK come back to my article.</p><figure class=\"kg-card kg-bookmark-card\"><a class=\"kg-bookmark-container\" href=\"https://eaton-works.com/2016/07/31/reverse-engineering-and-removing-pokemon-gos-certificate-pinning/\"><div class=\"kg-bookmark-content\"><div class=\"kg-bookmark-title\">Reverse engineering and removing Pokémon GO’s certificate pinning | Eaton Works</div><div class=\"kg-bookmark-description\"></div><div class=\"kg-bookmark-metadata\"><span class=\"kg-bookmark-author\">Eaton Works</span></div></div><div class=\"kg-bookmark-thumbnail\"><img src=\"https://eaton-works.com/wp-content/uploads/PGOCP1.png\"></div></a></figure><h2 id=\"mitm-proxy\"><strong>MITM Proxy</strong></h2><p>To sniff on packets sent by the Bolt Android App we will be using mitmproxy, which is an open source project.</p><figure class=\"kg-card kg-bookmark-card\"><a class=\"kg-bookmark-container\" href=\"https://mitmproxy.org/\"><div class=\"kg-bookmark-content\"><div class=\"kg-bookmark-title\">mitmproxy - an interactive HTTPS proxy</div><div class=\"kg-bookmark-description\"></div><div class=\"kg-bookmark-metadata\"><img class=\"kg-bookmark-icon\" src=\"https://mitmproxy.org/favicon.ico\"><span class=\"kg-bookmark-author\">an interactive HTTPS proxy</span></div></div><div class=\"kg-bookmark-thumbnail\"><img src=\"https://mitmproxy.org/logo-navbar.png\"></div></a></figure><p>If your Android version is higher than Nougat (Android 7), which probably is the case since you're a mega geek and you're reading this article, you'll also need:</p><ul><li>rooted Android device</li><li>Xposed Framework installed</li><li>JustTrustMe (<a href=\"https://github.com/Fuzion24/JustTrustMe\">https://github.com/Fuzion24/JustTrustMe</a>) module enabled</li></ul><p>After installing the mitmproxy on your local-network PC, run command:</p><pre><code>mitmweb (or mitmproxy if you love CLIs)</code></pre><p>It will show you the port it's listening on (8080 by default). Go to the network settings of your Android device and type it in under \"Proxy\".From now on you can sniff the packets, just like you would be in dev-tools of Google Chrome.</p><h2 id=\"alternative-way-httpcanary\"><strong>Alternative way: HTTPCanary</strong></h2><p>GuoShi made an awesome job and a beautiful Android app that allows you to sniff packets in real time. Unfortunately, I wasn't able to find the way to access the logs from your PC in real-time, but it is still an easy job to input those into Insomnia for tests.</p><h2 id=\"insomnia\"><strong>Insomnia</strong></h2><p>After I catched all the necessary requests I've proceeded to Insomnia to check which ones do I need.</p><h3 id=\"creating-rides\"><strong>Creating rides</strong></h3><p>The Bolt API, though not public, has still very descriptive error codes such as:</p><figure class=\"kg-card kg-image-card kg-card-hascaption\"><img src=\"__GHOST_URL__/content/images/2021/04/image-20210404194651219-1.png\" class=\"kg-image\" alt loading=\"lazy\" width=\"562\" height=\"158\"><figcaption>You will encounter such errors a lot - the most important thing is to listen to them!</figcaption></figure><p>Because of that I knew we need to take a step back and first search for a taxi options to obtain the price lock hash and category id (Bolt, Lite, Pets...), which will be sent with a query for creating a ride.</p><h3 id=\"searching-for-taxi-options\"><strong>Searching for taxi options</strong></h3><figure class=\"kg-card kg-image-card\"><img src=\"__GHOST_URL__/content/images/2021/04/image-20210404194923297.png\" class=\"kg-image\" alt loading=\"lazy\" width=\"1664\" height=\"650\" srcset=\"__GHOST_URL__/content/images/size/w600/2021/04/image-20210404194923297.png 600w, __GHOST_URL__/content/images/size/w1000/2021/04/image-20210404194923297.png 1000w, __GHOST_URL__/content/images/size/w1600/2021/04/image-20210404194923297.png 1600w, __GHOST_URL__/content/images/2021/04/image-20210404194923297.png 1664w\" sizes=\"(min-width: 720px) 720px\"></figure><p>Sending such payload returns us with the list of possible fares and available bolt categories:</p><figure class=\"kg-card kg-image-card\"><img src=\"__GHOST_URL__/content/images/2021/04/image-20210404195016612.png\" class=\"kg-image\" alt loading=\"lazy\" width=\"1674\" height=\"1932\" srcset=\"__GHOST_URL__/content/images/size/w600/2021/04/image-20210404195016612.png 600w, __GHOST_URL__/content/images/size/w1000/2021/04/image-20210404195016612.png 1000w, __GHOST_URL__/content/images/size/w1600/2021/04/image-20210404195016612.png 1600w, __GHOST_URL__/content/images/2021/04/image-20210404195016612.png 1674w\" sizes=\"(min-width: 720px) 720px\"></figure><p>What's intriguing about it is that we also get \"surge_multiplier\" parameter, which is not visible in the app. Nice!</p><h2 id=\"request-flow\"><strong>Request flow</strong></h2><figure class=\"kg-card kg-image-card\"><img src=\"__GHOST_URL__/content/images/2021/04/image-20210405122512692.png\" class=\"kg-image\" alt loading=\"lazy\" width=\"1368\" height=\"1734\" srcset=\"__GHOST_URL__/content/images/size/w600/2021/04/image-20210405122512692.png 600w, __GHOST_URL__/content/images/size/w1000/2021/04/image-20210405122512692.png 1000w, __GHOST_URL__/content/images/2021/04/image-20210405122512692.png 1368w\" sizes=\"(min-width: 720px) 720px\"></figure><h2 id=\"constant-reuqest-queries\"><strong>Constant reuqest queries</strong></h2><p>After careful analysis of all 4 requests (creating a ride, cancelling a ride, getting available cars and polling current app status) it's pretty easy to notice that there are some parameters, which concern each of requests' query:</p><pre><code>gps_lat: current latitude\ngps_lng: current longitude\nsession_id: must not be null - doesn't really matter\nuser_id: string of numbers identifying user\ncountry: current country\nlanguage: user language\ndeviceType: in my case \"android\"\nversion: in my case \"CA.7.01\"\ndeviceId: unique deviceId string generated\ndevice_name: string including android device model number - probably for statistical purposes\ndevice_os_version: android version (in my case 10)</code></pre><p>We will refactor those as an object and configure axios so that this data will be sent with each request as an additional query.</p><h2 id=\"tech-stack-choice\"><strong>Tech stack choice</strong></h2><p>As we frequently do in our software house, we will be using Vue with Nuxt for front end. For the backend we will be using our Precise Lab CORS proxy.</p><h2 id=\"card-denied-issue\"><strong>Card denied issue</strong></h2><p>Sometimes, when you create a new ride, bolt randomly throws a credit card authorization error, which looks like a bug in their API. We will just <code>try {} catch {}</code> it, wait for the error, assert it, and repeat creating a new ride. It never happens the second time in a row, so we are fine with that solution.</p><h2 id=\"making-it-fancier\"><strong>Making it fancier</strong></h2><p>As a last step I will take care of showing the current ride status to the end-user and providing him with an exact map so that he can make sure he chose the right pick-up and drop-off points. There's no need for real-time driver tracking because you can do it in the app as you would normally, however this could be added easily as when the ride has been confirmed by the driver you get car coordinates and even car orientation (that's how the bolt app shows cars doing backflips and drifting) in every ride status request.</p><h2 id=\"achilles-heel\"><strong>Achilles' heel</strong></h2><p>So it is deployed and you can use it! Yay!<br>The only issue is that you still need to get you API key. Sadly, you won't be able to find it in your Bolt app settings. To get it you need to analyse requests that your app sends and to do that you need HTTP Canary or other packet sniffer that I wrote about in the 1st part of this bolt-hacking adventure. The good news are that your bolt api token is valid indefinitely (or at least for a very long time).<br>Maybe we could get this token with bolt web application?<br>There's a bolt mobile web app but sadly, it doesn't really work anywhere:</p><figure class=\"kg-card kg-image-card kg-card-hascaption\"><img src=\"__GHOST_URL__/content/images/2021/05/image.png\" class=\"kg-image\" alt loading=\"lazy\" width=\"774\" height=\"596\" srcset=\"__GHOST_URL__/content/images/size/w600/2021/05/image.png 600w, __GHOST_URL__/content/images/2021/05/image.png 774w\" sizes=\"(min-width: 720px) 720px\"><figcaption>A sad alert you will get whenever you move the pickup pin on m.bolt.eu.</figcaption></figure><p>And if you look into HTTP requests that are sent back and forth:</p><figure class=\"kg-card kg-image-card\"><img src=\"__GHOST_URL__/content/images/2021/05/image-1.png\" class=\"kg-image\" alt loading=\"lazy\" width=\"284\" height=\"70\"></figure><p>That's pretty much it! Thanks for reading folks!</p><p>If You love what we do, feel free to reach me at <a href=\"mailto:krzysztof.dziardziel@preciselab.io\">krzysztof.dziardziel@preciselab.io</a>.</p>","comment_id":"606d7a485d6c891ac9aa7242","plaintext":"Howdy!\n\nThis is the first part on how we made ordering Bolt Lite always possible. In\nthis part we will discuss practical usage of Man In The Middle (MITM) attack and\nproxying through PC.\n\nCertificate Pinning\nSince Bolt app doesn't use mechanism known as Certificate Pinning it should be\nan easy job to capture all data sent in the packets.Google has been suggesting\nimplementing CP to all the developers since quite some time, but a few of\ndevelopers still use it. From the apps that I use most frequently, it is only\nused by banks and cryptowallets.If there would be certificate pinning in Bolt\napp, the app would seem disconnected from the internet when sniffing.It is still\npossible to connect with API when certificate pinning is in place but it\ninvolves some APK reverse engineering. If you're interested in how to do that\nread an excellent @XeEaton article and after you've done with patching the APK\ncome back to my article.\n\nReverse engineering and removing Pokémon GO’s certificate pinning | Eaton Works\nEaton Works\n[https://eaton-works.com/2016/07/31/reverse-engineering-and-removing-pokemon-gos-certificate-pinning/]\nMITM Proxy\nTo sniff on packets sent by the Bolt Android App we will be using mitmproxy,\nwhich is an open source project.\n\nmitmproxy - an interactive HTTPS proxyan interactive HTTPS proxy\n[https://mitmproxy.org/]If your Android version is higher than Nougat (Android\n7), which probably is the case since you're a mega geek and you're reading this\narticle, you'll also need:\n\n * rooted Android device\n * Xposed Framework installed\n * JustTrustMe (https://github.com/Fuzion24/JustTrustMe) module enabled\n\nAfter installing the mitmproxy on your local-network PC, run command:\n\nmitmweb (or mitmproxy if you love CLIs)\n\nIt will show you the port it's listening on (8080 by default). Go to the network\nsettings of your Android device and type it in under \"Proxy\".From now on you can\nsniff the packets, just like you would be in dev-tools of Google Chrome.\n\nAlternative way: HTTPCanary\nGuoShi made an awesome job and a beautiful Android app that allows you to sniff\npackets in real time. Unfortunately, I wasn't able to find the way to access the\nlogs from your PC in real-time, but it is still an easy job to input those into\nInsomnia for tests.\n\nInsomnia\nAfter I catched all the necessary requests I've proceeded to Insomnia to check\nwhich ones do I need.\n\nCreating rides\nThe Bolt API, though not public, has still very descriptive error codes such as:\n\nYou will encounter such errors a lot - the most important thing is to listen to\nthem!Because of that I knew we need to take a step back and first search for a\ntaxi options to obtain the price lock hash and category id (Bolt, Lite,\nPets...), which will be sent with a query for creating a ride.\n\nSearching for taxi options\nSending such payload returns us with the list of possible fares and available\nbolt categories:\n\nWhat's intriguing about it is that we also get \"surge_multiplier\" parameter,\nwhich is not visible in the app. Nice!\n\nRequest flow\nConstant reuqest queries\nAfter careful analysis of all 4 requests (creating a ride, cancelling a ride,\ngetting available cars and polling current app status) it's pretty easy to\nnotice that there are some parameters, which concern each of requests' query:\n\ngps_lat: current latitude\ngps_lng: current longitude\nsession_id: must not be null - doesn't really matter\nuser_id: string of numbers identifying user\ncountry: current country\nlanguage: user language\ndeviceType: in my case \"android\"\nversion: in my case \"CA.7.01\"\ndeviceId: unique deviceId string generated\ndevice_name: string including android device model number - probably for statistical purposes\ndevice_os_version: android version (in my case 10)\n\nWe will refactor those as an object and configure axios so that this data will\nbe sent with each request as an additional query.\n\nTech stack choice\nAs we frequently do in our software house, we will be using Vue with Nuxt for\nfront end. For the backend we will be using our Precise Lab CORS proxy.\n\nCard denied issue\nSometimes, when you create a new ride, bolt randomly throws a credit card\nauthorization error, which looks like a bug in their API. We will just try {}\ncatch {} it, wait for the error, assert it, and repeat creating a new ride. It\nnever happens the second time in a row, so we are fine with that solution.\n\nMaking it fancier\nAs a last step I will take care of showing the current ride status to the\nend-user and providing him with an exact map so that he can make sure he chose\nthe right pick-up and drop-off points. There's no need for real-time driver\ntracking because you can do it in the app as you would normally, however this\ncould be added easily as when the ride has been confirmed by the driver you get\ncar coordinates and even car orientation (that's how the bolt app shows cars\ndoing backflips and drifting) in every ride status request.\n\nAchilles' heel\nSo it is deployed and you can use it! Yay!\nThe only issue is that you still need to get you API key. Sadly, you won't be\nable to find it in your Bolt app settings. To get it you need to analyse\nrequests that your app sends and to do that you need HTTP Canary or other packet\nsniffer that I wrote about in the 1st part of this bolt-hacking adventure. The\ngood news are that your bolt api token is valid indefinitely (or at least for a\nvery long time).\nMaybe we could get this token with bolt web application?\nThere's a bolt mobile web app but sadly, it doesn't really work anywhere:\n\nA sad alert you will get whenever you move the pickup pin on m.bolt.eu.And if\nyou look into HTTP requests that are sent back and forth:\n\nThat's pretty much it! Thanks for reading folks!\n\nIf You love what we do, feel free to reach me at \nkrzysztof.dziardziel@preciselab.io.","feature_image":"__GHOST_URL__/content/images/2021/07/bg.jpeg","featured":0,"type":"post","status":"published","locale":null,"visibility":"public","email_recipient_filter":"all","created_at":"2021-04-07T09:24:24.000Z","updated_at":"2021-08-15T23:22:00.000Z","published_at":"2021-07-21T13:53:53.000Z","custom_excerpt":null,"codeinjection_head":null,"codeinjection_foot":null,"custom_template":null,"canonical_url":null,"newsletter_id":null,"lexical":null},{"id":"606d85f65d6c891ac9aa72b0","uuid":"1d3e43d3-1249-4b06-a687-0809e6a85578","title":"Portfolio","slug":"portfolio","mobiledoc":"{\"version\":\"0.3.1\",\"atoms\":[],\"cards\":[[\"image\",{\"src\":\"__GHOST_URL__/content/images/2021/04/1Zasob-3.png\",\"width\":912,\"height\":662}],[\"image\",{\"src\":\"__GHOST_URL__/content/images/2021/04/1Zasob-2.png\",\"width\":912,\"height\":625}],[\"image\",{\"src\":\"__GHOST_URL__/content/images/2021/04/iconZasob-7-1.png\",\"width\":912,\"height\":639}],[\"image\",{\"src\":\"__GHOST_URL__/content/images/2021/04/Screenshot_3.png\",\"width\":1065,\"height\":822}],[\"bookmark\",{\"type\":\"bookmark\",\"url\":\"http://v3.omnisys.pl/\",\"metadata\":{\"url\":\"http://v3.omnisys.pl/\",\"title\":\"OMNISYS | System v3\",\"description\":null,\"author\":null,\"publisher\":\"System v3\",\"thumbnail\":null,\"icon\":\"http://v3.omnisys.pl/favicon.ico\"}}],[\"image\",{\"src\":\"__GHOST_URL__/content/images/2021/04/79044650-88809e80-7c06-11ea-9409-a3bcb19b9953.png\",\"width\":1815,\"height\":1046}],[\"image\",{\"src\":\"__GHOST_URL__/content/images/2021/04/79043003-8c0f2800-7bfc-11ea-916f-901857e6e390.png\",\"width\":1832,\"height\":708}],[\"bookmark\",{\"type\":\"bookmark\",\"url\":\"http://prepilots.pl/\",\"metadata\":{\"url\":\"http://prepilots.pl/\",\"title\":\"Flight Preselection\",\"description\":\"Web application of test and pre-selection applying for the profession of pilot\",\"author\":\"Precise Lab Sp. z o.o. http://www.preciselab.io officepreciselab.io\",\"publisher\":null,\"thumbnail\":null,\"icon\":\"http://prepilots.pl/flight-24px.svg\"}}],[\"image\",{\"src\":\"__GHOST_URL__/content/images/2021/04/Screenshot_4.png\",\"width\":1197,\"height\":853}],[\"image\",{\"src\":\"__GHOST_URL__/content/images/2021/04/Screenshot-from-2021-04-07-13-44-08.png\",\"width\":1841,\"height\":1047}],[\"image\",{\"src\":\"__GHOST_URL__/content/images/2021/04/Screenshot-from-2021-04-07-13-34-20.png\",\"width\":1844,\"height\":1047}],[\"image\",{\"src\":\"__GHOST_URL__/content/images/2021/04/Screenshot-from-2021-04-07-13-56-31.png\",\"width\":1842,\"height\":1047}],[\"image\",{\"src\":\"__GHOST_URL__/content/images/2021/04/Screenshot-from-2021-04-07-13-56-11.png\",\"width\":1837,\"height\":1048}],[\"image\",{\"src\":\"__GHOST_URL__/content/images/2021/04/Screenshot-from-2021-04-07-13-55-50.png\",\"width\":1835,\"height\":1046}]],\"markups\":[[\"a\",[\"href\",\"http://vncoach.pl/\"]],[\"a\",[\"href\",\"http://interviewrecord.com/\"]],[\"a\",[\"href\",\"http://mailing.preciselab.io/\"]],[\"a\",[\"href\",\"materialy.coderslab.pl\"]]],\"sections\":[[1,\"p\",[[0,[],0,\"Quantum hash\"]]],[10,0],[1,\"p\",[[0,[],0,\"Neuro Coach\"]]],[1,\"p\",[[0,[0],1,\"http://vncoach.pl/\"]]],[10,1],[1,\"p\",[[0,[],0,\"Interview Record\"]]],[1,\"p\",[[0,[1],1,\"http://interviewrecord.com/\"]]],[10,2],[1,\"p\",[[0,[],0,\"Precise Sale\"]]],[10,3],[1,\"p\",[[0,[],0,\"Omnisys\"]]],[10,4],[10,5],[10,6],[1,\"p\",[[0,[],0,\"Lotnicy\"]]],[10,7],[10,8],[1,\"p\",[[0,[],0,\"Mailing\"]]],[1,\"p\",[[0,[2],1,\"http://mailing.preciselab.io/\"]]],[10,9],[1,\"p\",[[0,[],0,\"Coders Lab\"]]],[1,\"p\",[[0,[3],1,\"materialy.coderslab.pl\"]]],[10,10],[10,11],[10,12],[10,13],[1,\"p\",[]],[1,\"p\",[]],[1,\"p\",[]]],\"ghostVersion\":\"4.0\"}","html":"<p>Quantum hash</p><figure class=\"kg-card kg-image-card\"><img src=\"__GHOST_URL__/content/images/2021/04/1Zasob-3.png\" class=\"kg-image\" alt loading=\"lazy\" width=\"912\" height=\"662\" srcset=\"__GHOST_URL__/content/images/size/w600/2021/04/1Zasob-3.png 600w, __GHOST_URL__/content/images/2021/04/1Zasob-3.png 912w\" sizes=\"(min-width: 720px) 720px\"></figure><p>Neuro Coach</p><p><a href=\"http://vncoach.pl/\">http://vncoach.pl/</a></p><figure class=\"kg-card kg-image-card\"><img src=\"__GHOST_URL__/content/images/2021/04/1Zasob-2.png\" class=\"kg-image\" alt loading=\"lazy\" width=\"912\" height=\"625\" srcset=\"__GHOST_URL__/content/images/size/w600/2021/04/1Zasob-2.png 600w, __GHOST_URL__/content/images/2021/04/1Zasob-2.png 912w\" sizes=\"(min-width: 720px) 720px\"></figure><p>Interview Record</p><p><a href=\"http://interviewrecord.com/\">http://interviewrecord.com/</a></p><figure class=\"kg-card kg-image-card\"><img src=\"__GHOST_URL__/content/images/2021/04/iconZasob-7-1.png\" class=\"kg-image\" alt loading=\"lazy\" width=\"912\" height=\"639\" srcset=\"__GHOST_URL__/content/images/size/w600/2021/04/iconZasob-7-1.png 600w, __GHOST_URL__/content/images/2021/04/iconZasob-7-1.png 912w\" sizes=\"(min-width: 720px) 720px\"></figure><p>Precise Sale</p><figure class=\"kg-card kg-image-card\"><img src=\"__GHOST_URL__/content/images/2021/04/Screenshot_3.png\" class=\"kg-image\" alt loading=\"lazy\" width=\"1065\" height=\"822\" srcset=\"__GHOST_URL__/content/images/size/w600/2021/04/Screenshot_3.png 600w, __GHOST_URL__/content/images/size/w1000/2021/04/Screenshot_3.png 1000w, __GHOST_URL__/content/images/2021/04/Screenshot_3.png 1065w\" sizes=\"(min-width: 720px) 720px\"></figure><p>Omnisys</p><figure class=\"kg-card kg-bookmark-card\"><a class=\"kg-bookmark-container\" href=\"http://v3.omnisys.pl/\"><div class=\"kg-bookmark-content\"><div class=\"kg-bookmark-title\">OMNISYS | System v3</div><div class=\"kg-bookmark-description\"></div><div class=\"kg-bookmark-metadata\"><img class=\"kg-bookmark-icon\" src=\"http://v3.omnisys.pl/favicon.ico\"><span class=\"kg-bookmark-author\">System v3</span></div></div></a></figure><figure class=\"kg-card kg-image-card\"><img src=\"__GHOST_URL__/content/images/2021/04/79044650-88809e80-7c06-11ea-9409-a3bcb19b9953.png\" class=\"kg-image\" alt loading=\"lazy\" width=\"1815\" height=\"1046\" srcset=\"__GHOST_URL__/content/images/size/w600/2021/04/79044650-88809e80-7c06-11ea-9409-a3bcb19b9953.png 600w, __GHOST_URL__/content/images/size/w1000/2021/04/79044650-88809e80-7c06-11ea-9409-a3bcb19b9953.png 1000w, __GHOST_URL__/content/images/size/w1600/2021/04/79044650-88809e80-7c06-11ea-9409-a3bcb19b9953.png 1600w, __GHOST_URL__/content/images/2021/04/79044650-88809e80-7c06-11ea-9409-a3bcb19b9953.png 1815w\" sizes=\"(min-width: 720px) 720px\"></figure><figure class=\"kg-card kg-image-card\"><img src=\"__GHOST_URL__/content/images/2021/04/79043003-8c0f2800-7bfc-11ea-916f-901857e6e390.png\" class=\"kg-image\" alt loading=\"lazy\" width=\"1832\" height=\"708\" srcset=\"__GHOST_URL__/content/images/size/w600/2021/04/79043003-8c0f2800-7bfc-11ea-916f-901857e6e390.png 600w, __GHOST_URL__/content/images/size/w1000/2021/04/79043003-8c0f2800-7bfc-11ea-916f-901857e6e390.png 1000w, __GHOST_URL__/content/images/size/w1600/2021/04/79043003-8c0f2800-7bfc-11ea-916f-901857e6e390.png 1600w, __GHOST_URL__/content/images/2021/04/79043003-8c0f2800-7bfc-11ea-916f-901857e6e390.png 1832w\" sizes=\"(min-width: 720px) 720px\"></figure><p>Lotnicy</p><figure class=\"kg-card kg-bookmark-card\"><a class=\"kg-bookmark-container\" href=\"http://prepilots.pl/\"><div class=\"kg-bookmark-content\"><div class=\"kg-bookmark-title\">Flight Preselection</div><div class=\"kg-bookmark-description\">Web application of test and pre-selection applying for the profession of pilot</div><div class=\"kg-bookmark-metadata\"><img class=\"kg-bookmark-icon\" src=\"http://prepilots.pl/flight-24px.svg\"><span class=\"kg-bookmark-publisher\">Precise Lab Sp. z o.o. http://www.preciselab.io officepreciselab.io</span></div></div></a></figure><figure class=\"kg-card kg-image-card\"><img src=\"__GHOST_URL__/content/images/2021/04/Screenshot_4.png\" class=\"kg-image\" alt loading=\"lazy\" width=\"1197\" height=\"853\" srcset=\"__GHOST_URL__/content/images/size/w600/2021/04/Screenshot_4.png 600w, __GHOST_URL__/content/images/size/w1000/2021/04/Screenshot_4.png 1000w, __GHOST_URL__/content/images/2021/04/Screenshot_4.png 1197w\" sizes=\"(min-width: 720px) 720px\"></figure><p>Mailing</p><p><a href=\"http://mailing.preciselab.io/\">http://mailing.preciselab.io/</a></p><figure class=\"kg-card kg-image-card\"><img src=\"__GHOST_URL__/content/images/2021/04/Screenshot-from-2021-04-07-13-44-08.png\" class=\"kg-image\" alt loading=\"lazy\" width=\"1841\" height=\"1047\" srcset=\"__GHOST_URL__/content/images/size/w600/2021/04/Screenshot-from-2021-04-07-13-44-08.png 600w, __GHOST_URL__/content/images/size/w1000/2021/04/Screenshot-from-2021-04-07-13-44-08.png 1000w, __GHOST_URL__/content/images/size/w1600/2021/04/Screenshot-from-2021-04-07-13-44-08.png 1600w, __GHOST_URL__/content/images/2021/04/Screenshot-from-2021-04-07-13-44-08.png 1841w\" sizes=\"(min-width: 720px) 720px\"></figure><p>Coders Lab</p><p><a href=\"materialy.coderslab.pl\">materialy.coderslab.pl</a></p><figure class=\"kg-card kg-image-card\"><img src=\"__GHOST_URL__/content/images/2021/04/Screenshot-from-2021-04-07-13-34-20.png\" class=\"kg-image\" alt loading=\"lazy\" width=\"1844\" height=\"1047\" srcset=\"__GHOST_URL__/content/images/size/w600/2021/04/Screenshot-from-2021-04-07-13-34-20.png 600w, __GHOST_URL__/content/images/size/w1000/2021/04/Screenshot-from-2021-04-07-13-34-20.png 1000w, __GHOST_URL__/content/images/size/w1600/2021/04/Screenshot-from-2021-04-07-13-34-20.png 1600w, __GHOST_URL__/content/images/2021/04/Screenshot-from-2021-04-07-13-34-20.png 1844w\" sizes=\"(min-width: 720px) 720px\"></figure><figure class=\"kg-card kg-image-card\"><img src=\"__GHOST_URL__/content/images/2021/04/Screenshot-from-2021-04-07-13-56-31.png\" class=\"kg-image\" alt loading=\"lazy\" width=\"1842\" height=\"1047\" srcset=\"__GHOST_URL__/content/images/size/w600/2021/04/Screenshot-from-2021-04-07-13-56-31.png 600w, __GHOST_URL__/content/images/size/w1000/2021/04/Screenshot-from-2021-04-07-13-56-31.png 1000w, __GHOST_URL__/content/images/size/w1600/2021/04/Screenshot-from-2021-04-07-13-56-31.png 1600w, __GHOST_URL__/content/images/2021/04/Screenshot-from-2021-04-07-13-56-31.png 1842w\" sizes=\"(min-width: 720px) 720px\"></figure><figure class=\"kg-card kg-image-card\"><img src=\"__GHOST_URL__/content/images/2021/04/Screenshot-from-2021-04-07-13-56-11.png\" class=\"kg-image\" alt loading=\"lazy\" width=\"1837\" height=\"1048\" srcset=\"__GHOST_URL__/content/images/size/w600/2021/04/Screenshot-from-2021-04-07-13-56-11.png 600w, __GHOST_URL__/content/images/size/w1000/2021/04/Screenshot-from-2021-04-07-13-56-11.png 1000w, __GHOST_URL__/content/images/size/w1600/2021/04/Screenshot-from-2021-04-07-13-56-11.png 1600w, __GHOST_URL__/content/images/2021/04/Screenshot-from-2021-04-07-13-56-11.png 1837w\" sizes=\"(min-width: 720px) 720px\"></figure><figure class=\"kg-card kg-image-card\"><img src=\"__GHOST_URL__/content/images/2021/04/Screenshot-from-2021-04-07-13-55-50.png\" class=\"kg-image\" alt loading=\"lazy\" width=\"1835\" height=\"1046\" srcset=\"__GHOST_URL__/content/images/size/w600/2021/04/Screenshot-from-2021-04-07-13-55-50.png 600w, __GHOST_URL__/content/images/size/w1000/2021/04/Screenshot-from-2021-04-07-13-55-50.png 1000w, __GHOST_URL__/content/images/size/w1600/2021/04/Screenshot-from-2021-04-07-13-55-50.png 1600w, __GHOST_URL__/content/images/2021/04/Screenshot-from-2021-04-07-13-55-50.png 1835w\" sizes=\"(min-width: 720px) 720px\"></figure><p></p><p></p>","comment_id":"606d85f65d6c891ac9aa72b0","plaintext":"Quantum hash\n\nNeuro Coach\n\nhttp://vncoach.pl/\n\nInterview Record\n\nhttp://interviewrecord.com/\n\nPrecise Sale\n\nOmnisys\n\nOMNISYS | System v3System v3 [http://v3.omnisys.pl/]Lotnicy\n\nFlight PreselectionWeb application of test and pre-selection applying for the\nprofession of pilotPrecise Lab Sp. z o.o. http://www.preciselab.io\nofficepreciselab.io [http://prepilots.pl/]Mailing\n\nhttp://mailing.preciselab.io/\n\nCoders Lab\n\nmaterialy.coderslab.pl","feature_image":null,"featured":0,"type":"page","status":"published","locale":null,"visibility":"public","email_recipient_filter":"all","created_at":"2021-04-07T10:14:14.000Z","updated_at":"2021-04-12T12:36:32.000Z","published_at":"2021-04-07T10:36:11.000Z","custom_excerpt":null,"codeinjection_head":null,"codeinjection_foot":null,"custom_template":null,"canonical_url":null,"newsletter_id":null,"lexical":null},{"id":"606d8abf5d6c891ac9aa72b4","uuid":"44455df5-fb36-454a-bfae-0ea104dbf2d8","title":"Team","slug":"team","mobiledoc":"{\"version\":\"0.3.1\",\"atoms\":[[\"soft-return\",\"\",{}]],\"cards\":[[\"html\",{\"html\":\"<style>\\n\\n      .col-1 {\\n    grid-template-columns: repeat(1, minmax(0, 1fr))\\n    }\\n    \\n    @media (min-width: 1024px) {\\n  .sm-col-2 {\\n    grid-template-columns: repeat(2, minmax(0, 1fr));\\n  }\\n}\\n    \\n  \\n</style>\"}],[\"html\",{\"html\":\"<div class=\\\"col-1 sm-col-2\\\" style=\\\"width: 100%; display: grid;\\\">\\n<div>\\n    <h2>Daniel Gustaw</h2>\\n\\t<p>Tech Lead</p>\\n\\t<a href=\\\"mailto:daniel.gustaw@preciselab.io\\\">daniel.gustaw@preciselab.io</a>\\n</div>\\n<div style=\\\"display: flex; flex-direction: column;\\\">\\n        <img src=\\\"__GHOST_URL__/content/images/2021/04/1608291457588.jpeg\\\"/>\\n\\n</div>\\n</div>\"}],[\"bookmark\",{\"type\":\"bookmark\",\"url\":\"https://stackoverflow.com/users/6398044/daniel\",\"metadata\":{\"url\":\"https://stackoverflow.com/users/6398044/daniel\",\"title\":\"User Daniel\",\"description\":\"Stack Overflow | The World’s Largest Online Community for Developers\",\"author\":null,\"publisher\":\"Stack Overflow\",\"thumbnail\":\"https://cdn.sstatic.net/Sites/stackoverflow/Img/apple-touch-icon@2.png?v=73d79a89bded\",\"icon\":\"https://cdn.sstatic.net/Sites/stackoverflow/Img/apple-touch-icon.png?v=c78bd457575a\"},\"caption\":\"\"}],[\"html\",{\"html\":\"<div class=\\\"col-1 sm-col-2\\\" style=\\\"width: 100%; display: grid;\\\">\\n<div>\\n    <h2>Krzysztof Dziardziel</h2>\\n\\t<p>Full Stack Developer</p>\\n\\t<a href=\\\"mailto:krzysztof.dziardziel@preciselab.io\\\">krzysztof.dziardziel@preciselab.io</a>\\n</div>\\n<div style=\\\"display: flex; flex-direction: column;\\\">\\n        <img src=\\\"__GHOST_URL__/content/images/2021/04/Krzysztof-Dziardziel---Profile-photo-1.jpg\\\"/>\\n</div>\\n</div>\"}],[\"html\",{\"html\":\"<div class=\\\"col-1 sm-col-2\\\" style=\\\"width: 100%; display: grid;\\\">\\n<div>\\n    <h2>Angelina Zaretskaya</h2>\\n\\t<p>Project Manager</p>\\n\\t<a href=\\\"mailto:angelina.zaretska@preciselab.io\\\">angelina.zaretska@preciselab.io</a>\\n</div>\\n<div style=\\\"display: flex; flex-direction: column;\\\">\\n        <img src=\\\"__GHOST_URL__/content/images/2021/04/BF94162D-53D8-4F03-BF07-81653D0DF7FE_1_201_a.jpeg\\\"/>\\n\\n</div>\\n</div>\"}]],\"markups\":[[\"a\",[\"href\",\"https://www.linkedin.com/in/danielgustaw/\"]]],\"sections\":[[10,0],[10,1],[1,\"p\",[[0,[0],1,\"https://www.linkedin.com/in/danielgustaw/\"]]],[10,2],[10,3],[1,\"h2\",[[0,[],0,\"Jakub Szulc\"]]],[1,\"p\",[[0,[],0,\"Devops Engineer \"]]],[1,\"p\",[[0,[],0,\"jakub.szulc@preciselab.io\"],[1,[],0,0]]],[10,4],[1,\"h2\",[[0,[],0,\"Jan Czerwinski\"]]],[1,\"p\",[[0,[],0,\"Frontend Developer\"]]],[1,\"p\",[[0,[],0,\"jan.czerwinski@preciselab.io\"]]],[1,\"p\",[]],[1,\"p\",[]]],\"ghostVersion\":\"4.0\"}","html":"<!--kg-card-begin: html--><style>\n\n      .col-1 {\n    grid-template-columns: repeat(1, minmax(0, 1fr))\n    }\n    \n    @media (min-width: 1024px) {\n  .sm-col-2 {\n    grid-template-columns: repeat(2, minmax(0, 1fr));\n  }\n}\n    \n  \n</style><!--kg-card-end: html--><!--kg-card-begin: html--><div class=\"col-1 sm-col-2\" style=\"width: 100%; display: grid;\">\n<div>\n    <h2>Daniel Gustaw</h2>\n\t<p>Tech Lead</p>\n\t<a href=\"mailto:daniel.gustaw@preciselab.io\">daniel.gustaw@preciselab.io</a>\n</div>\n<div style=\"display: flex; flex-direction: column;\">\n        <img src=\"__GHOST_URL__/content/images/2021/04/1608291457588.jpeg\"/>\n\n</div>\n</div><!--kg-card-end: html--><p><a href=\"https://www.linkedin.com/in/danielgustaw/\">https://www.linkedin.com/in/danielgustaw/</a></p><figure class=\"kg-card kg-bookmark-card\"><a class=\"kg-bookmark-container\" href=\"https://stackoverflow.com/users/6398044/daniel\"><div class=\"kg-bookmark-content\"><div class=\"kg-bookmark-title\">User Daniel</div><div class=\"kg-bookmark-description\">Stack Overflow | The World’s Largest Online Community for Developers</div><div class=\"kg-bookmark-metadata\"><img class=\"kg-bookmark-icon\" src=\"https://cdn.sstatic.net/Sites/stackoverflow/Img/apple-touch-icon.png?v&#x3D;c78bd457575a\"><span class=\"kg-bookmark-author\">Stack Overflow</span></div></div><div class=\"kg-bookmark-thumbnail\"><img src=\"https://cdn.sstatic.net/Sites/stackoverflow/Img/apple-touch-icon@2.png?v&#x3D;73d79a89bded\"></div></a></figure><!--kg-card-begin: html--><div class=\"col-1 sm-col-2\" style=\"width: 100%; display: grid;\">\n<div>\n    <h2>Krzysztof Dziardziel</h2>\n\t<p>Full Stack Developer</p>\n\t<a href=\"mailto:krzysztof.dziardziel@preciselab.io\">krzysztof.dziardziel@preciselab.io</a>\n</div>\n<div style=\"display: flex; flex-direction: column;\">\n        <img src=\"__GHOST_URL__/content/images/2021/04/Krzysztof-Dziardziel---Profile-photo-1.jpg\"/>\n</div>\n</div><!--kg-card-end: html--><h2 id=\"jakub-szulc\">Jakub Szulc</h2><p>Devops Engineer </p><p>jakub.szulc@preciselab.io<br></p><!--kg-card-begin: html--><div class=\"col-1 sm-col-2\" style=\"width: 100%; display: grid;\">\n<div>\n    <h2>Angelina Zaretskaya</h2>\n\t<p>Project Manager</p>\n\t<a href=\"mailto:angelina.zaretska@preciselab.io\">angelina.zaretska@preciselab.io</a>\n</div>\n<div style=\"display: flex; flex-direction: column;\">\n        <img src=\"__GHOST_URL__/content/images/2021/04/BF94162D-53D8-4F03-BF07-81653D0DF7FE_1_201_a.jpeg\"/>\n\n</div>\n</div><!--kg-card-end: html--><h2 id=\"jan-czerwinski\">Jan Czerwinski</h2><p>Frontend Developer</p><p>jan.czerwinski@preciselab.io</p><p></p>","comment_id":"606d8abf5d6c891ac9aa72b4","plaintext":" Daniel Gustaw\nTech Lead\n\ndaniel.gustaw@preciselab.io https://www.linkedin.com/in/danielgustaw/\n\nUser DanielStack Overflow | The World’s Largest Online Community for Developers\nStack Overflow [https://stackoverflow.com/users/6398044/daniel] Krzysztof\nDziardziel\nFull Stack Developer\n\nkrzysztof.dziardziel@preciselab.io Jakub Szulc\nDevops Engineer \n\njakub.szulc@preciselab.io\n\n\nAngelina Zaretskaya\nProject Manager\n\nangelina.zaretska@preciselab.io Jan Czerwinski\nFrontend Developer\n\njan.czerwinski@preciselab.io","feature_image":null,"featured":0,"type":"page","status":"published","locale":null,"visibility":"public","email_recipient_filter":"all","created_at":"2021-04-07T10:34:39.000Z","updated_at":"2021-04-07T12:56:59.000Z","published_at":"2021-04-07T10:35:56.000Z","custom_excerpt":null,"codeinjection_head":null,"codeinjection_foot":null,"custom_template":null,"canonical_url":null,"newsletter_id":null,"lexical":null},{"id":"606d8b255d6c891ac9aa72bc","uuid":"4794421a-b902-48d7-b9e3-d1d1b05aca26","title":"Contact","slug":"contact","mobiledoc":"{\"version\":\"0.3.1\",\"atoms\":[[\"soft-return\",\"\",{}],[\"soft-return\",\"\",{}]],\"cards\":[[\"bookmark\",{\"type\":\"bookmark\",\"url\":\"https://calendly.com/gustaw-daniel\",\"metadata\":{\"url\":\"https://calendly.com/gustaw-daniel\",\"title\":\"Daniel Gustaw\",\"description\":\"Welcome to my scheduling page. Please follow the instructions to add an event to my calendar.\",\"author\":null,\"publisher\":\"Calendly\",\"thumbnail\":\"https://assets.calendly.com/assets/ogimage-a63bb2f442cd9e6345a5e4d7fe75393c6cfcc1ff29e48e858742d43573a8b02c.png?source=opengraph\",\"icon\":\"https://assets.calendly.com/assets/touch-icon-ipad-retina-7a95e0c775301f4c0a22002bdf0a95d3c2b9cbe95af29c64f9c9573bac1f01e4.png\"}}],[\"bookmark\",{\"type\":\"bookmark\",\"url\":\"https://gustawdaniel.com/\",\"metadata\":{\"url\":\"https://www.gustawdaniel.com\",\"title\":\"Daniel Gustaw\",\"description\":\"Blog o scrapingu, przetwarzaniu danych i programowaniu w technologiach node js, typescript, perl, php, python.\",\"author\":\"Daniel Gustaw\",\"publisher\":\"Daniel Gustaw\",\"thumbnail\":\"https://static.ghost.org/v3.0.0/images/publication-cover.png\",\"icon\":\"https://www.gustawdaniel.com/favicon.ico\"}}],[\"html\",{\"html\":\"<center>\\n<iframe src=\\\"https://www.google.com/maps/embed?pb=!1m14!1m8!1m3!1d9774.496173159272!2d20.9792931!3d52.2320479!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x0%3A0x8ad74468d92f4303!2sPrecise%20Lab!5e0!3m2!1spl!2spl!4v1617792944303!5m2!1spl!2spl\\\" width=\\\"100%\\\" height=\\\"450\\\" style=\\\"border:0;\\\" allowfullscreen=\\\"\\\" loading=\\\"lazy\\\"></iframe>\\n</center>\"}]],\"markups\":[],\"sections\":[[1,\"p\",[[0,[],0,\"PreciseLab Spółka z ograniczoną odpowiedzialnością\"],[1,[],0,0],[0,[],0,\"GRZYBOWSKA 85A/32, Warsaw, Mazovian 00-844 Poland\"],[1,[],0,1]]],[1,\"p\",[[0,[],0,\"Phone: +48 792 579 069\"]]],[1,\"p\",[[0,[],0,\"Email: office@preciselab.io\"]]],[1,\"p\",[[0,[],0,\"Schedule Meeting\"]]],[10,0],[1,\"p\",[[0,[],0,\"Daniel Gustaw Page\"]]],[10,1],[1,\"p\",[]],[10,2],[1,\"p\",[]]],\"ghostVersion\":\"4.0\"}","html":"<p>PreciseLab Spółka z ograniczoną odpowiedzialnością<br>GRZYBOWSKA 85A/32, Warsaw, Mazovian 00-844 Poland<br></p><p>Phone: +48 792 579 069</p><p>Email: office@preciselab.io</p><p>Schedule Meeting</p><figure class=\"kg-card kg-bookmark-card\"><a class=\"kg-bookmark-container\" href=\"https://calendly.com/gustaw-daniel\"><div class=\"kg-bookmark-content\"><div class=\"kg-bookmark-title\">Daniel Gustaw</div><div class=\"kg-bookmark-description\">Welcome to my scheduling page. Please follow the instructions to add an event to my calendar.</div><div class=\"kg-bookmark-metadata\"><img class=\"kg-bookmark-icon\" src=\"https://assets.calendly.com/assets/touch-icon-ipad-retina-7a95e0c775301f4c0a22002bdf0a95d3c2b9cbe95af29c64f9c9573bac1f01e4.png\"><span class=\"kg-bookmark-author\">Calendly</span></div></div><div class=\"kg-bookmark-thumbnail\"><img src=\"https://assets.calendly.com/assets/ogimage-a63bb2f442cd9e6345a5e4d7fe75393c6cfcc1ff29e48e858742d43573a8b02c.png?source&#x3D;opengraph\"></div></a></figure><p>Daniel Gustaw Page</p><figure class=\"kg-card kg-bookmark-card\"><a class=\"kg-bookmark-container\" href=\"https://gustawdaniel.com/\"><div class=\"kg-bookmark-content\"><div class=\"kg-bookmark-title\">Daniel Gustaw</div><div class=\"kg-bookmark-description\">Blog o scrapingu, przetwarzaniu danych i programowaniu w technologiach node js, typescript, perl, php, python.</div><div class=\"kg-bookmark-metadata\"><img class=\"kg-bookmark-icon\" src=\"https://www.gustawdaniel.com/favicon.ico\"><span class=\"kg-bookmark-author\">Daniel Gustaw</span><span class=\"kg-bookmark-publisher\">Daniel Gustaw</span></div></div><div class=\"kg-bookmark-thumbnail\"><img src=\"https://static.ghost.org/v3.0.0/images/publication-cover.png\"></div></a></figure><p></p><!--kg-card-begin: html--><center>\n<iframe src=\"https://www.google.com/maps/embed?pb=!1m14!1m8!1m3!1d9774.496173159272!2d20.9792931!3d52.2320479!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x0%3A0x8ad74468d92f4303!2sPrecise%20Lab!5e0!3m2!1spl!2spl!4v1617792944303!5m2!1spl!2spl\" width=\"100%\" height=\"450\" style=\"border:0;\" allowfullscreen=\"\" loading=\"lazy\"></iframe>\n</center><!--kg-card-end: html-->","comment_id":"606d8b255d6c891ac9aa72bc","plaintext":"PreciseLab Spółka z ograniczoną odpowiedzialnością\nGRZYBOWSKA 85A/32, Warsaw, Mazovian 00-844 Poland\n\n\nPhone: +48 792 579 069\n\nEmail: office@preciselab.io\n\nSchedule Meeting\n\nDaniel GustawWelcome to my scheduling page. Please follow the instructions to\nadd an event to my calendar.Calendly [https://calendly.com/gustaw-daniel]Daniel\nGustaw Page\n\nDaniel GustawBlog o scrapingu, przetwarzaniu danych i programowaniu w\ntechnologiach node js, typescript, perl, php, python.Daniel GustawDaniel Gustaw\n[https://gustawdaniel.com/]","feature_image":null,"featured":0,"type":"page","status":"published","locale":null,"visibility":"public","email_recipient_filter":"all","created_at":"2021-04-07T10:36:21.000Z","updated_at":"2021-07-17T05:48:45.000Z","published_at":"2021-04-07T10:36:23.000Z","custom_excerpt":null,"codeinjection_head":null,"codeinjection_foot":null,"custom_template":null,"canonical_url":null,"newsletter_id":null,"lexical":null},{"id":"60704f975d6c891ac9aa73ac","uuid":"5f6cd10a-87e5-46ac-9bc5-21fb1a17c68b","title":"The best web-scrapping methods","slug":"the-best-web-scrapping-methods","mobiledoc":"{\"version\":\"0.3.1\",\"atoms\":[],\"cards\":[],\"markups\":[],\"sections\":[[1,\"p\",[[0,[],0,\"Before you start a conversation about the possibilities, technologies and methods of modern website hijackers, be sure to formulate your problem.\"]]],[1,\"p\",[[0,[],0,\"Problem formulation\"]]],[1,\"p\",[[0,[],0,\"Constant optimization of web resources for mobile devices, rising internet speeds, iron-level technology and program code, and designers searching the Worldwide web like you see it today. Namely - colorful, contrast, crowded and absolutely useless (sometimes harmful) information. These are different techniques and technologies in the implementation of websites and this is the main problem that must be solved when organizing data access.\"]]],[1,\"p\",[[0,[],0,\"Access to target content can be organized in two main directions:\"]]],[1,\"p\",[[0,[],0,\"By using the API when information owners provide it to users based on personal interest - subscriptions, shipping, partner programs, etc.\"]]],[1,\"p\",[[0,[],0,\"Without API use - Authority of the website by scraping (unless it is provided by their code).\"]]],[1,\"p\",[[0,[],0,\"The first direction is limited only by cash, and the consumer does not experience difficulties in technical implementation. The data obtained through the API is clearly organized and standardized. For example, in XML or JSON formats.\"]]],[1,\"p\",[[0,[],0,\"The second direction is web scraping- it deserves for attention and is a kind of “challenge” for developers and mathematicians. Automatic text processing using artificial intelligence, semantic analysis, etc. All this can be called a colossal technological breakthrough that requires development, awareness and proper evaluation.\"]]],[1,\"p\",[[0,[],0,\"Manual copy content\"]]],[1,\"p\",[[0,[],0,\"The easiest method of web scrapping is to manually search for the information you want, then copy and maintain the destination.\"]]],[1,\"p\",[[0,[],0,\"This method is suitable for small blogs or small shops with a small assortment of rhe same type of goods.\"]]],[1,\"p\",[[0,[],0,\"Benefits:\"]]],[1,\"p\",[[0,[],0,\"High-quality content and its  final adaptation to the needs of the consumer.\"]]],[1,\"p\",[[0,[],0,\"High search speed.\"]]],[1,\"p\",[[0,[],0,\"Inconveniences:\"]]],[1,\"p\",[[0,[],0,\"A person's capabilities are significantly limited to physical resources, knowledge of the target ball, and trivial online search skills (not everyone can effectively use the search service tools).\"]]],[1,\"p\",[[0,[],0,\"A person is subject to various external influences (psychological, physical, etc.), and this adversely affects the stability of his work and the value of his services.\"]]],[1,\"p\",[[0,[],0,\"Detectable scraping up to several hundred qualitative results per day.\"]]],[1,\"p\",[[0,[],0,\"Regular expressions and capturing a match in the text\"]]],[1,\"p\",[[0,[],0,\"A very simple text processing technique and at the same time a powerful method of extracting information from the Internet. Especially in conjunction with the use of UNIX Capture commands (for example, \\\"Curl\\\"). Regular expressions are present in many programming languages ​​(for example, we implement web scraping with this method for several Python and Ruby projects).\"]]],[1,\"p\",[[0,[],0,\"The presented method is suitable for projects that involve automatic monitoring of several sources of information. Suppose scraping individual fragments (product name, its cost, phone numbers and e-mail addresses, etc.). In practice, implementing a scraper for one site can take about an hour. True only if target resource does not contain JS rendering traps.\"]]],[1,\"p\",[[0,[],0,\"Benefits:\"]]],[1,\"p\",[[0,[],0,\"If you already know the regular expressions of at least one programming language, the implementation of this decision will take the minimum amount of time.\"]]],[1,\"p\",[[0,[],0,\"Regular expressions allow you to quickly distinguish a large number of unnecessary small \\\"fuzzy\\\" from the result body, without breaking the main content (for example, clean up leftover HTML code).\"]]],[1,\"p\",[[0,[],0,\"Regular expressions are supported by almost all programming languages. And most importantly, their syntax from language to language hardly changes. This allows you to perform a painless migration of projects in languages ​​with greater efficiency and clarity of the Code (for example, from PHP to Ruby - recently such clients are becoming more and more).\"]]],[1,\"p\",[[0,[],0,\"Inconveniences:\"]]],[1,\"p\",[[0,[],0,\"Regular expressions can turn into a puzzle for those who haven't used them. In this case, it is better to contact specialists immediately. As a rule, problems arise when integrating solutions in one language into another or when migrating projects to another programming language.\"]]],[1,\"p\",[[0,[],0,\"Regular expressions are often very complex to read and parse. Sometimes, based on the specifics of the processed information, they are overstretched.\"]]],[1,\"p\",[[0,[],0,\"If the HTML has been changed on the target resource or a new tag has been added, most likely it will be changed and the regular expression (otherwise there is a high risk of \\\"broken\\\" content).\"]]],[1,\"p\",[[0,[],0,\"HTTP queries (HTML code analysis)\"]]],[1,\"p\",[[0,[],0,\"This method allows you to receive dynamic and static pages by sending HTTP requests to remote servers. It uses programming sockets and disassembles received responses from (if necessary) pre-prepared data on target containers (their classes and identifier).\"]]],[1,\"p\",[[0,[],0,\"The tool is suitable for most projects. In implementation it is slightly more compensated, but this is compensated by the possibility of obtaining large amounts of data quickly.\"]]],[1,\"p\",[[0,[],0,\"Benefits:\"]]],[1,\"p\",[[0,[],0,\"It allows you to get the original pages as HTTP responses.\"]]],[1,\"p\",[[0,[],0,\"Huge number of results limited only by server resources and Internet speed.\"]]],[1,\"p\",[[0,[],0,\"Inconveniences:\"]]],[1,\"p\",[[0,[],0,\"It requires processing of received responses - the results may contain many unnecessary ones.\"]]],[1,\"p\",[[0,[],0,\"Many sites are provided with protection against similar \\\"robots\\\" (as a production of the situation, you should generate additional site information in the header of the HTTP request, however not all sites can be fooled in this way).\"]]],[1,\"p\",[[0,[],0,\"A high probability is to be banned by the administrator of the destination or automated protection system when strange methodically repeating \\\"interest\\\" appears in the resource. Practice shows that the number and frequency of requests may exceed human capacity.\"]]],[1,\"p\",[[0,[],0,\"The remote server may be down or busy at the time the request is sent. As a result, there is a likelihood of a large number of limiting errors.\"]]],[1,\"p\",[[0,[],0,\"The collapse of the DOM structure based on screen effects\"]]],[1,\"p\",[[0,[],0,\"Dynamic content is one of the problematic moments of internet scraping. How to deal with this? To get it, you can use any full web weapon that recreates dynamic content and client-side script. Plugins are ready. They work for free and produce good results. True, with one reservation: poor performance. Only one result at a time. In fact, plugins like this solve a lot of problems and let you forget about things like cookies, regular expressions, http, etc.\"]]],[1,\"p\",[[0,[],0,\"Screen effects-based DOM structure analysis is suitable for large and medium-sized projects interested in both the amount of information extracted. The implementation of the automation of this method is quite complex from a technical point of view. However, our team managed to achieve the goal, and from design to design, it improves the developed functionality. To do this, a browser emulator has been written and supports a \\\"virtual screen\\\" with intelligent search for nodes in the DOM structure.\"]]],[1,\"p\",[[0,[],0,\"Benefits:\"]]],[1,\"p\",[[0,[],0,\"Get dynamic content.\"]]],[1,\"p\",[[0,[],0,\"Automation. It enables you to obtain high-quality content in large amounts.\"]]],[1,\"p\",[[0,[],0,\"The possibility of implementing commercial solutions. The method allows you to easily enjoy troubleshooting support for purchased / rented software.\"]]],[1,\"p\",[[0,[],0,\"Inconveniences:\"]]],[1,\"p\",[[0,[],0,\"The complexity and server loading during automation makes the process quite resource intensive, both in development and server costs.\"]]],[1,\"p\",[[0,[],0,\"Completeness of implementation. For non-specialists, it is virtually impossible, because it requires a thorough knowledge of \\\"iron\\\", the basics of web development and an excellent possession of at least one of the server programming languages.\"]]],[1,\"p\",[[0,[],0,\"Most of the implementation of this method is only applicable on a commercial basis, and the cost of such products has not yet tended to decrease.\"]]],[1,\"p\",[[0,[],0,\"Artificial intelligence and ontology methods\"]]],[1,\"p\",[[0,[],0,\"Imagine that you are faced with the task of scraping hundreds or thousands of sites. At the same time, they have a different layout and written in different languages ​​and frames. In such a situation, rational resources will invest in the development of complex artificial intelligence systems and / or ontologies (this method is based on the theory that all sites can be divided into classes and groups with a similar structure and set of technologies).\"]]],[1,\"p\",[[0,[],0,\"Benefits:\"]]],[1,\"p\",[[0,[],0,\"Having created a complex system, it allows you to get the highest possible content from a huge number of domains, even despite small changes to the pages (an intelligent system will adjust possible inaccuracies). The quality assessment for 150 thousand domains will be on average from 75% to 93% (verified by Jetrubia research in the implemented system).\"]]],[1,\"p\",[[0,[],0,\"The method enables the normalization of the result obtained from all sources in the database structure.\"]]],[1,\"p\",[[0,[],0,\"Despite the fact that such a system needs constant support (at the monitoring level), with possible failures, it requires little code intervention\"]]],[1,\"p\",[[0,[],0,\"Inconveniences:\"]]],[1,\"p\",[[0,[],0,\"Comprehensive implementation of the \\\"engine\\\", requiring a high level of knowledge in mathematics, statistics, and the sphere of fuzzy logic.\"]]],[1,\"p\",[[0,[],0,\"High development cost.\"]]],[1,\"p\",[[0,[],0,\"Similar costs of the support and training system.\"]]],[1,\"p\",[[0,[],0,\"Practice of subscribing to ready-made commercial projects. This applies to the limited number of requests and their high cost (we note that your own development pays off quickly).\"]]],[1,\"p\",[[0,[],0,\"You must provide bug trackers, data validity servers, and backup proxies  destination site.\"]]],[1,\"p\",[[0,[],0,\"Similar costs of the support and training system. Practice of subscribing to ready-made commercial projects. This applies to the limited number of requests and their high cost (we note that your own development pays off quickly).\"]]]],\"ghostVersion\":\"4.0\"}","html":"<p>Before you start a conversation about the possibilities, technologies and methods of modern website hijackers, be sure to formulate your problem.</p><p>Problem formulation</p><p>Constant optimization of web resources for mobile devices, rising internet speeds, iron-level technology and program code, and designers searching the Worldwide web like you see it today. Namely - colorful, contrast, crowded and absolutely useless (sometimes harmful) information. These are different techniques and technologies in the implementation of websites and this is the main problem that must be solved when organizing data access.</p><p>Access to target content can be organized in two main directions:</p><p>By using the API when information owners provide it to users based on personal interest - subscriptions, shipping, partner programs, etc.</p><p>Without API use - Authority of the website by scraping (unless it is provided by their code).</p><p>The first direction is limited only by cash, and the consumer does not experience difficulties in technical implementation. The data obtained through the API is clearly organized and standardized. For example, in XML or JSON formats.</p><p>The second direction is web scraping- it deserves for attention and is a kind of “challenge” for developers and mathematicians. Automatic text processing using artificial intelligence, semantic analysis, etc. All this can be called a colossal technological breakthrough that requires development, awareness and proper evaluation.</p><p>Manual copy content</p><p>The easiest method of web scrapping is to manually search for the information you want, then copy and maintain the destination.</p><p>This method is suitable for small blogs or small shops with a small assortment of rhe same type of goods.</p><p>Benefits:</p><p>High-quality content and its  final adaptation to the needs of the consumer.</p><p>High search speed.</p><p>Inconveniences:</p><p>A person's capabilities are significantly limited to physical resources, knowledge of the target ball, and trivial online search skills (not everyone can effectively use the search service tools).</p><p>A person is subject to various external influences (psychological, physical, etc.), and this adversely affects the stability of his work and the value of his services.</p><p>Detectable scraping up to several hundred qualitative results per day.</p><p>Regular expressions and capturing a match in the text</p><p>A very simple text processing technique and at the same time a powerful method of extracting information from the Internet. Especially in conjunction with the use of UNIX Capture commands (for example, \"Curl\"). Regular expressions are present in many programming languages ​​(for example, we implement web scraping with this method for several Python and Ruby projects).</p><p>The presented method is suitable for projects that involve automatic monitoring of several sources of information. Suppose scraping individual fragments (product name, its cost, phone numbers and e-mail addresses, etc.). In practice, implementing a scraper for one site can take about an hour. True only if target resource does not contain JS rendering traps.</p><p>Benefits:</p><p>If you already know the regular expressions of at least one programming language, the implementation of this decision will take the minimum amount of time.</p><p>Regular expressions allow you to quickly distinguish a large number of unnecessary small \"fuzzy\" from the result body, without breaking the main content (for example, clean up leftover HTML code).</p><p>Regular expressions are supported by almost all programming languages. And most importantly, their syntax from language to language hardly changes. This allows you to perform a painless migration of projects in languages ​​with greater efficiency and clarity of the Code (for example, from PHP to Ruby - recently such clients are becoming more and more).</p><p>Inconveniences:</p><p>Regular expressions can turn into a puzzle for those who haven't used them. In this case, it is better to contact specialists immediately. As a rule, problems arise when integrating solutions in one language into another or when migrating projects to another programming language.</p><p>Regular expressions are often very complex to read and parse. Sometimes, based on the specifics of the processed information, they are overstretched.</p><p>If the HTML has been changed on the target resource or a new tag has been added, most likely it will be changed and the regular expression (otherwise there is a high risk of \"broken\" content).</p><p>HTTP queries (HTML code analysis)</p><p>This method allows you to receive dynamic and static pages by sending HTTP requests to remote servers. It uses programming sockets and disassembles received responses from (if necessary) pre-prepared data on target containers (their classes and identifier).</p><p>The tool is suitable for most projects. In implementation it is slightly more compensated, but this is compensated by the possibility of obtaining large amounts of data quickly.</p><p>Benefits:</p><p>It allows you to get the original pages as HTTP responses.</p><p>Huge number of results limited only by server resources and Internet speed.</p><p>Inconveniences:</p><p>It requires processing of received responses - the results may contain many unnecessary ones.</p><p>Many sites are provided with protection against similar \"robots\" (as a production of the situation, you should generate additional site information in the header of the HTTP request, however not all sites can be fooled in this way).</p><p>A high probability is to be banned by the administrator of the destination or automated protection system when strange methodically repeating \"interest\" appears in the resource. Practice shows that the number and frequency of requests may exceed human capacity.</p><p>The remote server may be down or busy at the time the request is sent. As a result, there is a likelihood of a large number of limiting errors.</p><p>The collapse of the DOM structure based on screen effects</p><p>Dynamic content is one of the problematic moments of internet scraping. How to deal with this? To get it, you can use any full web weapon that recreates dynamic content and client-side script. Plugins are ready. They work for free and produce good results. True, with one reservation: poor performance. Only one result at a time. In fact, plugins like this solve a lot of problems and let you forget about things like cookies, regular expressions, http, etc.</p><p>Screen effects-based DOM structure analysis is suitable for large and medium-sized projects interested in both the amount of information extracted. The implementation of the automation of this method is quite complex from a technical point of view. However, our team managed to achieve the goal, and from design to design, it improves the developed functionality. To do this, a browser emulator has been written and supports a \"virtual screen\" with intelligent search for nodes in the DOM structure.</p><p>Benefits:</p><p>Get dynamic content.</p><p>Automation. It enables you to obtain high-quality content in large amounts.</p><p>The possibility of implementing commercial solutions. The method allows you to easily enjoy troubleshooting support for purchased / rented software.</p><p>Inconveniences:</p><p>The complexity and server loading during automation makes the process quite resource intensive, both in development and server costs.</p><p>Completeness of implementation. For non-specialists, it is virtually impossible, because it requires a thorough knowledge of \"iron\", the basics of web development and an excellent possession of at least one of the server programming languages.</p><p>Most of the implementation of this method is only applicable on a commercial basis, and the cost of such products has not yet tended to decrease.</p><p>Artificial intelligence and ontology methods</p><p>Imagine that you are faced with the task of scraping hundreds or thousands of sites. At the same time, they have a different layout and written in different languages ​​and frames. In such a situation, rational resources will invest in the development of complex artificial intelligence systems and / or ontologies (this method is based on the theory that all sites can be divided into classes and groups with a similar structure and set of technologies).</p><p>Benefits:</p><p>Having created a complex system, it allows you to get the highest possible content from a huge number of domains, even despite small changes to the pages (an intelligent system will adjust possible inaccuracies). The quality assessment for 150 thousand domains will be on average from 75% to 93% (verified by Jetrubia research in the implemented system).</p><p>The method enables the normalization of the result obtained from all sources in the database structure.</p><p>Despite the fact that such a system needs constant support (at the monitoring level), with possible failures, it requires little code intervention</p><p>Inconveniences:</p><p>Comprehensive implementation of the \"engine\", requiring a high level of knowledge in mathematics, statistics, and the sphere of fuzzy logic.</p><p>High development cost.</p><p>Similar costs of the support and training system.</p><p>Practice of subscribing to ready-made commercial projects. This applies to the limited number of requests and their high cost (we note that your own development pays off quickly).</p><p>You must provide bug trackers, data validity servers, and backup proxies  destination site.</p><p>Similar costs of the support and training system. Practice of subscribing to ready-made commercial projects. This applies to the limited number of requests and their high cost (we note that your own development pays off quickly).</p>","comment_id":"60704f975d6c891ac9aa73ac","plaintext":"Before you start a conversation about the possibilities, technologies and\nmethods of modern website hijackers, be sure to formulate your problem.\n\nProblem formulation\n\nConstant optimization of web resources for mobile devices, rising internet\nspeeds, iron-level technology and program code, and designers searching the\nWorldwide web like you see it today. Namely - colorful, contrast, crowded and\nabsolutely useless (sometimes harmful) information. These are different\ntechniques and technologies in the implementation of websites and this is the\nmain problem that must be solved when organizing data access.\n\nAccess to target content can be organized in two main directions:\n\nBy using the API when information owners provide it to users based on personal\ninterest - subscriptions, shipping, partner programs, etc.\n\nWithout API use - Authority of the website by scraping (unless it is provided by\ntheir code).\n\nThe first direction is limited only by cash, and the consumer does not\nexperience difficulties in technical implementation. The data obtained through\nthe API is clearly organized and standardized. For example, in XML or JSON\nformats.\n\nThe second direction is web scraping- it deserves for attention and is a kind of\n“challenge” for developers and mathematicians. Automatic text processing using\nartificial intelligence, semantic analysis, etc. All this can be called a\ncolossal technological breakthrough that requires development, awareness and\nproper evaluation.\n\nManual copy content\n\nThe easiest method of web scrapping is to manually search for the information\nyou want, then copy and maintain the destination.\n\nThis method is suitable for small blogs or small shops with a small assortment\nof rhe same type of goods.\n\nBenefits:\n\nHigh-quality content and its  final adaptation to the needs of the consumer.\n\nHigh search speed.\n\nInconveniences:\n\nA person's capabilities are significantly limited to physical resources,\nknowledge of the target ball, and trivial online search skills (not everyone can\neffectively use the search service tools).\n\nA person is subject to various external influences (psychological, physical,\netc.), and this adversely affects the stability of his work and the value of his\nservices.\n\nDetectable scraping up to several hundred qualitative results per day.\n\nRegular expressions and capturing a match in the text\n\nA very simple text processing technique and at the same time a powerful method\nof extracting information from the Internet. Especially in conjunction with the\nuse of UNIX Capture commands (for example, \"Curl\"). Regular expressions are\npresent in many programming languages ​​(for example, we implement web scraping\nwith this method for several Python and Ruby projects).\n\nThe presented method is suitable for projects that involve automatic monitoring\nof several sources of information. Suppose scraping individual fragments\n(product name, its cost, phone numbers and e-mail addresses, etc.). In practice,\nimplementing a scraper for one site can take about an hour. True only if target\nresource does not contain JS rendering traps.\n\nBenefits:\n\nIf you already know the regular expressions of at least one programming\nlanguage, the implementation of this decision will take the minimum amount of\ntime.\n\nRegular expressions allow you to quickly distinguish a large number of\nunnecessary small \"fuzzy\" from the result body, without breaking the main\ncontent (for example, clean up leftover HTML code).\n\nRegular expressions are supported by almost all programming languages. And most\nimportantly, their syntax from language to language hardly changes. This allows\nyou to perform a painless migration of projects in languages ​​with greater\nefficiency and clarity of the Code (for example, from PHP to Ruby - recently\nsuch clients are becoming more and more).\n\nInconveniences:\n\nRegular expressions can turn into a puzzle for those who haven't used them. In\nthis case, it is better to contact specialists immediately. As a rule, problems\narise when integrating solutions in one language into another or when migrating\nprojects to another programming language.\n\nRegular expressions are often very complex to read and parse. Sometimes, based\non the specifics of the processed information, they are overstretched.\n\nIf the HTML has been changed on the target resource or a new tag has been added,\nmost likely it will be changed and the regular expression (otherwise there is a\nhigh risk of \"broken\" content).\n\nHTTP queries (HTML code analysis)\n\nThis method allows you to receive dynamic and static pages by sending HTTP\nrequests to remote servers. It uses programming sockets and disassembles\nreceived responses from (if necessary) pre-prepared data on target containers\n(their classes and identifier).\n\nThe tool is suitable for most projects. In implementation it is slightly more\ncompensated, but this is compensated by the possibility of obtaining large\namounts of data quickly.\n\nBenefits:\n\nIt allows you to get the original pages as HTTP responses.\n\nHuge number of results limited only by server resources and Internet speed.\n\nInconveniences:\n\nIt requires processing of received responses - the results may contain many\nunnecessary ones.\n\nMany sites are provided with protection against similar \"robots\" (as a\nproduction of the situation, you should generate additional site information in\nthe header of the HTTP request, however not all sites can be fooled in this\nway).\n\nA high probability is to be banned by the administrator of the destination or\nautomated protection system when strange methodically repeating \"interest\"\nappears in the resource. Practice shows that the number and frequency of\nrequests may exceed human capacity.\n\nThe remote server may be down or busy at the time the request is sent. As a\nresult, there is a likelihood of a large number of limiting errors.\n\nThe collapse of the DOM structure based on screen effects\n\nDynamic content is one of the problematic moments of internet scraping. How to\ndeal with this? To get it, you can use any full web weapon that recreates\ndynamic content and client-side script. Plugins are ready. They work for free\nand produce good results. True, with one reservation: poor performance. Only one\nresult at a time. In fact, plugins like this solve a lot of problems and let you\nforget about things like cookies, regular expressions, http, etc.\n\nScreen effects-based DOM structure analysis is suitable for large and\nmedium-sized projects interested in both the amount of information extracted.\nThe implementation of the automation of this method is quite complex from a\ntechnical point of view. However, our team managed to achieve the goal, and from\ndesign to design, it improves the developed functionality. To do this, a browser\nemulator has been written and supports a \"virtual screen\" with intelligent\nsearch for nodes in the DOM structure.\n\nBenefits:\n\nGet dynamic content.\n\nAutomation. It enables you to obtain high-quality content in large amounts.\n\nThe possibility of implementing commercial solutions. The method allows you to\neasily enjoy troubleshooting support for purchased / rented software.\n\nInconveniences:\n\nThe complexity and server loading during automation makes the process quite\nresource intensive, both in development and server costs.\n\nCompleteness of implementation. For non-specialists, it is virtually impossible,\nbecause it requires a thorough knowledge of \"iron\", the basics of web\ndevelopment and an excellent possession of at least one of the server\nprogramming languages.\n\nMost of the implementation of this method is only applicable on a commercial\nbasis, and the cost of such products has not yet tended to decrease.\n\nArtificial intelligence and ontology methods\n\nImagine that you are faced with the task of scraping hundreds or thousands of\nsites. At the same time, they have a different layout and written in different\nlanguages ​​and frames. In such a situation, rational resources will invest in\nthe development of complex artificial intelligence systems and / or ontologies\n(this method is based on the theory that all sites can be divided into classes\nand groups with a similar structure and set of technologies).\n\nBenefits:\n\nHaving created a complex system, it allows you to get the highest possible\ncontent from a huge number of domains, even despite small changes to the pages\n(an intelligent system will adjust possible inaccuracies). The quality\nassessment for 150 thousand domains will be on average from 75% to 93% (verified\nby Jetrubia research in the implemented system).\n\nThe method enables the normalization of the result obtained from all sources in\nthe database structure.\n\nDespite the fact that such a system needs constant support (at the monitoring\nlevel), with possible failures, it requires little code intervention\n\nInconveniences:\n\nComprehensive implementation of the \"engine\", requiring a high level of\nknowledge in mathematics, statistics, and the sphere of fuzzy logic.\n\nHigh development cost.\n\nSimilar costs of the support and training system.\n\nPractice of subscribing to ready-made commercial projects. This applies to the\nlimited number of requests and their high cost (we note that your own\ndevelopment pays off quickly).\n\nYou must provide bug trackers, data validity servers, and backup proxies\n destination site.\n\nSimilar costs of the support and training system. Practice of subscribing to\nready-made commercial projects. This applies to the limited number of requests\nand their high cost (we note that your own development pays off quickly).","feature_image":null,"featured":0,"type":"post","status":"draft","locale":null,"visibility":"public","email_recipient_filter":"all","created_at":"2021-04-09T12:59:03.000Z","updated_at":"2021-04-29T22:46:02.000Z","published_at":"2021-04-29T22:45:55.000Z","custom_excerpt":null,"codeinjection_head":null,"codeinjection_foot":null,"custom_template":null,"canonical_url":null,"newsletter_id":null,"lexical":null},{"id":"607f29835d6c891ac9aa73bf","uuid":"c5308a2e-21e5-4b98-8f8a-f88e0c8278fa","title":"How to optimize your code","slug":"how-to-optimize-your-code","mobiledoc":"{\"version\":\"0.3.1\",\"atoms\":[],\"cards\":[[\"markdown\",{\"markdown\":\"There are some places where you should optimize code\\n\\n+ when you detected bottleneck\\n+ when you can change algorithmic complexity\\n\\nAnd some places when you should not\\n\\n+ when it have negative influence on security\\n+ when it obfuscate code clarity\\n\\nOf course these are general rules and any challenge has other weights assigned to security, code readability and performance, but idea of this text is the following: There are good and bad code optimizations. I would like to present and discuss both examples.\\n\\n### Async Await\\n\\nLets consider this code\\n\\n```js\\nconst dt = new Date();\\nfor(let i = 0; i < 120; i++) {\\n    dt.setDate( dt.getDate() - 1 );\\n    await prisma.createUserDailyLog({\\n        name: to,\\n        tier: Math.ceil(Math.random() * 10),\\n        user: {connect: {name: to}},\\n        date: formatEuropeanDate(dt),\\n        cache: {\\n            create: {\\n                float: 100 * Math.random() * Math.exp(- 10 * Math.random()),\\n                profit: 100 * Math.random() * Math.exp(- 10 * Math.random()),\\n                total: 100 * Math.random() * Math.exp(- 10 * Math.random())\\n            }\\n        }\\n    })\\n}\\n```\\n\\nIn this example we want to save to database some random data. We 120 times sending data to base and waiting for finalization of save. W can do it much better without huge changes:\\n\\n```\\nawait Promise.all([...new Array(120)].map(async (el, index) => {\\n    const dt = new Date();\\n    dt.setDate( dt.getDate() - index );\\n\\n    return prisma.createUserDailyLog({\\n        name: to,\\n        tier: Math.ceil(Math.random() * 10),\\n        user: {connect: {name: to}},\\n        date: formatEuropeanDate(dt),\\n        cache: {\\n            create: {\\n                float: 100 * Math.random() * Math.exp(- 10 * Math.random()),\\n                profit: 100 * Math.random() * Math.exp(- 10 * Math.random()),\\n                total: 100 * Math.random() * Math.exp(- 10 * Math.random())\\n            }\\n        }\\n    })\\n}));\\n```\\n\\nIn this case we are sending all requests to save in one time and waiting for last one will finish.\\n\\nTime of execution of first example is 1.8 - 2.2 sec, in second case it is 0.26  - 0.34 sec. \\n\\nIt is only 120 records. If it would be 120 000 recored, this method would be bad too. \\n\\nIn my case I am using `MongoDB`. For 120 000 logs I should use `bulkInsert`\\n\\n> https://docs.mongodb.com/manual/reference/method/Bulk.insert/\\n\\nBut cost of this solution is worse portability of code. Prisma is ORM and allow to connect with many different databases, so my code is more general than custom Mongo bulk Insert.\\n\\n\"}]],\"markups\":[],\"sections\":[[10,0],[1,\"p\",[]]],\"ghostVersion\":\"4.0\"}","html":"<!--kg-card-begin: markdown--><p>There are some places where you should optimize code</p>\n<ul>\n<li>when you detected bottleneck</li>\n<li>when you can change algorithmic complexity</li>\n</ul>\n<p>And some places when you should not</p>\n<ul>\n<li>when it have negative influence on security</li>\n<li>when it obfuscate code clarity</li>\n</ul>\n<p>Of course these are general rules and any challenge has other weights assigned to security, code readability and performance, but idea of this text is the following: There are good and bad code optimizations. I would like to present and discuss both examples.</p>\n<h3 id=\"async-await\">Async Await</h3>\n<p>Lets consider this code</p>\n<pre><code class=\"language-js\">const dt = new Date();\nfor(let i = 0; i &lt; 120; i++) {\n    dt.setDate( dt.getDate() - 1 );\n    await prisma.createUserDailyLog({\n        name: to,\n        tier: Math.ceil(Math.random() * 10),\n        user: {connect: {name: to}},\n        date: formatEuropeanDate(dt),\n        cache: {\n            create: {\n                float: 100 * Math.random() * Math.exp(- 10 * Math.random()),\n                profit: 100 * Math.random() * Math.exp(- 10 * Math.random()),\n                total: 100 * Math.random() * Math.exp(- 10 * Math.random())\n            }\n        }\n    })\n}\n</code></pre>\n<p>In this example we want to save to database some random data. We 120 times sending data to base and waiting for finalization of save. W can do it much better without huge changes:</p>\n<pre><code>await Promise.all([...new Array(120)].map(async (el, index) =&gt; {\n    const dt = new Date();\n    dt.setDate( dt.getDate() - index );\n\n    return prisma.createUserDailyLog({\n        name: to,\n        tier: Math.ceil(Math.random() * 10),\n        user: {connect: {name: to}},\n        date: formatEuropeanDate(dt),\n        cache: {\n            create: {\n                float: 100 * Math.random() * Math.exp(- 10 * Math.random()),\n                profit: 100 * Math.random() * Math.exp(- 10 * Math.random()),\n                total: 100 * Math.random() * Math.exp(- 10 * Math.random())\n            }\n        }\n    })\n}));\n</code></pre>\n<p>In this case we are sending all requests to save in one time and waiting for last one will finish.</p>\n<p>Time of execution of first example is 1.8 - 2.2 sec, in second case it is 0.26  - 0.34 sec.</p>\n<p>It is only 120 records. If it would be 120 000 recored, this method would be bad too.</p>\n<p>In my case I am using <code>MongoDB</code>. For 120 000 logs I should use <code>bulkInsert</code></p>\n<blockquote>\n<p><a href=\"https://docs.mongodb.com/manual/reference/method/Bulk.insert/\">https://docs.mongodb.com/manual/reference/method/Bulk.insert/</a></p>\n</blockquote>\n<p>But cost of this solution is worse portability of code. Prisma is ORM and allow to connect with many different databases, so my code is more general than custom Mongo bulk Insert.</p>\n<!--kg-card-end: markdown-->","comment_id":"607f29835d6c891ac9aa73bf","plaintext":"There are some places where you should optimize code\n\n * when you detected bottleneck\n * when you can change algorithmic complexity\n\nAnd some places when you should not\n\n * when it have negative influence on security\n * when it obfuscate code clarity\n\nOf course these are general rules and any challenge has other weights assigned\nto security, code readability and performance, but idea of this text is the\nfollowing: There are good and bad code optimizations. I would like to present\nand discuss both examples.\n\nAsync Await\nLets consider this code\n\nconst dt = new Date();\nfor(let i = 0; i < 120; i++) {\n    dt.setDate( dt.getDate() - 1 );\n    await prisma.createUserDailyLog({\n        name: to,\n        tier: Math.ceil(Math.random() * 10),\n        user: {connect: {name: to}},\n        date: formatEuropeanDate(dt),\n        cache: {\n            create: {\n                float: 100 * Math.random() * Math.exp(- 10 * Math.random()),\n                profit: 100 * Math.random() * Math.exp(- 10 * Math.random()),\n                total: 100 * Math.random() * Math.exp(- 10 * Math.random())\n            }\n        }\n    })\n}\n\n\nIn this example we want to save to database some random data. We 120 times\nsending data to base and waiting for finalization of save. W can do it much\nbetter without huge changes:\n\nawait Promise.all([...new Array(120)].map(async (el, index) => {\n    const dt = new Date();\n    dt.setDate( dt.getDate() - index );\n\n    return prisma.createUserDailyLog({\n        name: to,\n        tier: Math.ceil(Math.random() * 10),\n        user: {connect: {name: to}},\n        date: formatEuropeanDate(dt),\n        cache: {\n            create: {\n                float: 100 * Math.random() * Math.exp(- 10 * Math.random()),\n                profit: 100 * Math.random() * Math.exp(- 10 * Math.random()),\n                total: 100 * Math.random() * Math.exp(- 10 * Math.random())\n            }\n        }\n    })\n}));\n\n\nIn this case we are sending all requests to save in one time and waiting for\nlast one will finish.\n\nTime of execution of first example is 1.8 - 2.2 sec, in second case it is 0.26 -\n0.34 sec.\n\nIt is only 120 records. If it would be 120 000 recored, this method would be bad\ntoo.\n\nIn my case I am using MongoDB. For 120 000 logs I should use bulkInsert\n\n> https://docs.mongodb.com/manual/reference/method/Bulk.insert/\n\n\nBut cost of this solution is worse portability of code. Prisma is ORM and allow\nto connect with many different databases, so my code is more general than custom\nMongo bulk Insert.","feature_image":null,"featured":0,"type":"post","status":"draft","locale":null,"visibility":"public","email_recipient_filter":"all","created_at":"2021-04-20T19:20:35.000Z","updated_at":"2021-04-20T19:20:49.000Z","published_at":null,"custom_excerpt":null,"codeinjection_head":null,"codeinjection_foot":null,"custom_template":null,"canonical_url":null,"newsletter_id":null,"lexical":null},{"id":"607f2ab25d6c891ac9aa73c5","uuid":"711078d5-1eab-49b0-96ee-97479b3809d2","title":"Git styled calendar with custom dates","slug":"git-styled-calendar-with-custom-dates","mobiledoc":"{\"version\":\"0.3.1\",\"atoms\":[],\"cards\":[[\"image\",{\"src\":\"__GHOST_URL__/content/images/2021/04/img.png\",\"width\":1020,\"height\":216}],[\"markdown\",{\"markdown\":\"So I have great info. It is required an hour of coding. It is one line of code, maybe two...\\n\\n### In this article I will show how to generate an image like these. \\n\\nWhat do you need?\\n\\n+ jq - great toll for json / text processing\\n+ node - js interpreter\\n+ awk - text processor for selecting data\\n\\n### Installation\\n\\n```\\nnpm i -g cli-gh-cal\\n```\\n\\n### Preparing file with dates\\n\\nWe want to prepare a file with dates like these\\n\\n```csv\\n2019-08-13\\n2018-05-19\\n2018-06-22\\n2019-04-16\\n```\\n\\nAllow us to assume that you need to show dates of creation of files in your folder with photos. You can do it using the command\\n\\n```bash\\nls -l --time-style=long-iso . | awk '{print $6}' | sort > /tmp/dates.csv\\n```\\n\\nOption `--time-style` allows showing dates in easy to the processing format. Next `awk` selects column with dates and sorted dates are saved in temporary file  `/tmp/dates.csv` .\\n\\n### Displaying git styled calendar\\n\\nNow if you want to display these dates you need to type\\n\\n```bash\\ncli-gh-cal --data \\\"$(jq -R '[inputs | [.,1] ]' < /tmp/dates.csv)\\\"\\n```\\n\\nIn this case, we put to work `jq` - powerfull templater for json files. It allows replacing the list of dates to json string required by `cli-gh-cal`. After executing this command you should see an image similar to presented at the beginning.\\n\\n### Required packages\\n\\nTo work there have to be installed `node`. I recommend installing it with `nvm` on the local machine.\\n\\n> [https://www.digitalocean.com/community/tutorials/how-to-install-node-js-on-ubuntu-18-04](https://www.digitalocean.com/community/tutorials/how-to-install-node-js-on-ubuntu-18-04)\\n\\nNext package - `cli-gh-cal` can be installed by `npm` - node pacakges manager\\n\\n> [https://github.com/IonicaBizau/cli-gh-cal](https://github.com/IonicaBizau/cli-gh-cal)\\n\\nFinally, you need also `jq`\\n\\n> [https://stedolan.github.io/jq/download/](https://stedolan.github.io/jq/download/)\\n\\nI hope you like this article. For me, it is a great example of how a small amount of code is needed to achieve great-looking results in data visualization today. Wow! \"}],[\"image\",{\"src\":\"__GHOST_URL__/content/images/2021/04/Screenshot-from-2021-04-20-21-28-33.png\",\"width\":922,\"height\":227}]],\"markups\":[],\"sections\":[[1,\"p\",[[0,[],0,\"Let us assume that you have a set of dates. You want to display these dates in a readable clear way.\"]]],[1,\"p\",[[0,[],0,\"For example like this:\"]]],[10,0],[10,1],[1,\"p\",[[0,[],0,\"Screenshot from my console\"]]],[10,2],[1,\"p\",[]]],\"ghostVersion\":\"4.0\"}","html":"<p>Let us assume that you have a set of dates. You want to display these dates in a readable clear way.</p><p>For example like this:</p><figure class=\"kg-card kg-image-card\"><img src=\"__GHOST_URL__/content/images/2021/04/img.png\" class=\"kg-image\" alt loading=\"lazy\" width=\"1020\" height=\"216\" srcset=\"__GHOST_URL__/content/images/size/w600/2021/04/img.png 600w, __GHOST_URL__/content/images/size/w1000/2021/04/img.png 1000w, __GHOST_URL__/content/images/2021/04/img.png 1020w\" sizes=\"(min-width: 720px) 720px\"></figure><!--kg-card-begin: markdown--><p>So I have great info. It is required an hour of coding. It is one line of code, maybe two...</p>\n<h3 id=\"in-this-article-i-will-show-how-to-generate-an-image-like-these\">In this article I will show how to generate an image like these.</h3>\n<p>What do you need?</p>\n<ul>\n<li>jq - great toll for json / text processing</li>\n<li>node - js interpreter</li>\n<li>awk - text processor for selecting data</li>\n</ul>\n<h3 id=\"installation\">Installation</h3>\n<pre><code>npm i -g cli-gh-cal\n</code></pre>\n<h3 id=\"preparing-file-with-dates\">Preparing file with dates</h3>\n<p>We want to prepare a file with dates like these</p>\n<pre><code class=\"language-csv\">2019-08-13\n2018-05-19\n2018-06-22\n2019-04-16\n</code></pre>\n<p>Allow us to assume that you need to show dates of creation of files in your folder with photos. You can do it using the command</p>\n<pre><code class=\"language-bash\">ls -l --time-style=long-iso . | awk '{print $6}' | sort &gt; /tmp/dates.csv\n</code></pre>\n<p>Option <code>--time-style</code> allows showing dates in easy to the processing format. Next <code>awk</code> selects column with dates and sorted dates are saved in temporary file  <code>/tmp/dates.csv</code> .</p>\n<h3 id=\"displaying-git-styled-calendar\">Displaying git styled calendar</h3>\n<p>Now if you want to display these dates you need to type</p>\n<pre><code class=\"language-bash\">cli-gh-cal --data &quot;$(jq -R '[inputs | [.,1] ]' &lt; /tmp/dates.csv)&quot;\n</code></pre>\n<p>In this case, we put to work <code>jq</code> - powerfull templater for json files. It allows replacing the list of dates to json string required by <code>cli-gh-cal</code>. After executing this command you should see an image similar to presented at the beginning.</p>\n<h3 id=\"required-packages\">Required packages</h3>\n<p>To work there have to be installed <code>node</code>. I recommend installing it with <code>nvm</code> on the local machine.</p>\n<blockquote>\n<p><a href=\"https://www.digitalocean.com/community/tutorials/how-to-install-node-js-on-ubuntu-18-04\">https://www.digitalocean.com/community/tutorials/how-to-install-node-js-on-ubuntu-18-04</a></p>\n</blockquote>\n<p>Next package - <code>cli-gh-cal</code> can be installed by <code>npm</code> - node pacakges manager</p>\n<blockquote>\n<p><a href=\"https://github.com/IonicaBizau/cli-gh-cal\">https://github.com/IonicaBizau/cli-gh-cal</a></p>\n</blockquote>\n<p>Finally, you need also <code>jq</code></p>\n<blockquote>\n<p><a href=\"https://stedolan.github.io/jq/download/\">https://stedolan.github.io/jq/download/</a></p>\n</blockquote>\n<p>I hope you like this article. For me, it is a great example of how a small amount of code is needed to achieve great-looking results in data visualization today. Wow!</p>\n<!--kg-card-end: markdown--><p>Screenshot from my console</p><figure class=\"kg-card kg-image-card\"><img src=\"__GHOST_URL__/content/images/2021/04/Screenshot-from-2021-04-20-21-28-33.png\" class=\"kg-image\" alt loading=\"lazy\" width=\"922\" height=\"227\" srcset=\"__GHOST_URL__/content/images/size/w600/2021/04/Screenshot-from-2021-04-20-21-28-33.png 600w, __GHOST_URL__/content/images/2021/04/Screenshot-from-2021-04-20-21-28-33.png 922w\" sizes=\"(min-width: 720px) 720px\"></figure>","comment_id":"607f2ab25d6c891ac9aa73c5","plaintext":"Let us assume that you have a set of dates. You want to display these dates in a\nreadable clear way.\n\nFor example like this:\n\nSo I have great info. It is required an hour of coding. It is one line of code,\nmaybe two...\n\nIn this article I will show how to generate an image like these.\nWhat do you need?\n\n * jq - great toll for json / text processing\n * node - js interpreter\n * awk - text processor for selecting data\n\nInstallation\nnpm i -g cli-gh-cal\n\n\nPreparing file with dates\nWe want to prepare a file with dates like these\n\n2019-08-13\n2018-05-19\n2018-06-22\n2019-04-16\n\n\nAllow us to assume that you need to show dates of creation of files in your\nfolder with photos. You can do it using the command\n\nls -l --time-style=long-iso . | awk '{print $6}' | sort > /tmp/dates.csv\n\n\nOption --time-style allows showing dates in easy to the processing format. Next \nawk selects column with dates and sorted dates are saved in temporary file \n/tmp/dates.csv .\n\nDisplaying git styled calendar\nNow if you want to display these dates you need to type\n\ncli-gh-cal --data \"$(jq -R '[inputs | [.,1] ]' < /tmp/dates.csv)\"\n\n\nIn this case, we put to work jq - powerfull templater for json files. It allows\nreplacing the list of dates to json string required by cli-gh-cal. After\nexecuting this command you should see an image similar to presented at the\nbeginning.\n\nRequired packages\nTo work there have to be installed node. I recommend installing it with nvm on\nthe local machine.\n\n> https://www.digitalocean.com/community/tutorials/how-to-install-node-js-on-ubuntu-18-04\n\n\nNext package - cli-gh-cal can be installed by npm - node pacakges manager\n\n> https://github.com/IonicaBizau/cli-gh-cal\n\n\nFinally, you need also jq\n\n> https://stedolan.github.io/jq/download/\n\n\nI hope you like this article. For me, it is a great example of how a small\namount of code is needed to achieve great-looking results in data visualization\ntoday. Wow!\n\nScreenshot from my console","feature_image":"__GHOST_URL__/content/images/2021/04/img-1.png","featured":0,"type":"post","status":"published","locale":null,"visibility":"public","email_recipient_filter":"all","created_at":"2021-04-20T19:25:38.000Z","updated_at":"2021-04-20T19:28:39.000Z","published_at":"2021-04-20T19:28:40.000Z","custom_excerpt":null,"codeinjection_head":null,"codeinjection_foot":null,"custom_template":null,"canonical_url":null,"newsletter_id":null,"lexical":null},{"id":"607f2c065d6c891ac9aa73dc","uuid":"1cab335d-79fb-4bff-b93a-2fa6b2cb31e8","title":"Fractional calclus on example of gaussian curve","slug":"fractional-calclus-on-example-of-gaussian-curve","mobiledoc":"{\"version\":\"0.3.1\",\"atoms\":[],\"cards\":[[\"code\",{\"code\":\"J^\\\\alpha f = \\\\begin{cases} \\n   D^\\\\alpha f     & \\\\text{if } x \\\\gt 0 \\\\\\\\\\n   f              & \\\\text{if } x = 0 \\\\\\\\\\n   I^{|\\\\alpha|} f & \\\\text{if } x < 0\\n  \\\\end{cases}\",\"language\":\"math\"}],[\"markdown\",{\"markdown\":\"![](https://www.wolframcloud.com/obj/c6cd7a0f-d7af-4958-a6f1-2e5a947776ba)\"}],[\"markdown\",{\"markdown\":\"![](https://www.wolframcloud.com/obj/475b9211-e1bc-4785-87e8-e914c0c75be6)\"}]],\"markups\":[[\"strong\"]],\"sections\":[[1,\"p\",[[0,[],0,\"The fractional calculus is a extension of traditional calcus by noninteger orders of integrals and derivatives. Allows to generalize these operations and parametrize them to better understood how a functions that are these derivatives inject on each oder smoothly.\"]]],[1,\"p\",[[0,[],0,\"There you can see how behaves some fractional derivatives of known functions that I investigated.\"]]],[1,\"h3\",[[0,[0],1,\"How to calculate fractional derivatives and integrals\"]]],[1,\"p\",[[0,[],0,\"Lets define  differintegral operator - transformation that make differentiation for positive order and integration for negative. For integer $ \\\\alpha $ everything works like in traditional calculus.\"]]],[10,0],[1,\"p\",[[0,[],0,\"But magic starts for\"]]],[10,1],[10,2],[1,\"p\",[]]],\"ghostVersion\":\"4.0\"}","html":"<p>The fractional calculus is a extension of traditional calcus by noninteger orders of integrals and derivatives. Allows to generalize these operations and parametrize them to better understood how a functions that are these derivatives inject on each oder smoothly.</p><p>There you can see how behaves some fractional derivatives of known functions that I investigated.</p><h3 id=\"how-to-calculate-fractional-derivatives-and-integrals\"><strong>How to calculate fractional derivatives and integrals</strong></h3><p>Lets define  differintegral operator - transformation that make differentiation for positive order and integration for negative. For integer $ \\alpha $ everything works like in traditional calculus.</p><pre><code class=\"language-math\">J^\\alpha f = \\begin{cases} \n   D^\\alpha f     &amp; \\text{if } x \\gt 0 \\\\\n   f              &amp; \\text{if } x = 0 \\\\\n   I^{|\\alpha|} f &amp; \\text{if } x &lt; 0\n  \\end{cases}</code></pre><p>But magic starts for</p><!--kg-card-begin: markdown--><p><img src=\"https://www.wolframcloud.com/obj/c6cd7a0f-d7af-4958-a6f1-2e5a947776ba\" alt=\"\" loading=\"lazy\"></p>\n<!--kg-card-end: markdown--><!--kg-card-begin: markdown--><p><img src=\"https://www.wolframcloud.com/obj/475b9211-e1bc-4785-87e8-e914c0c75be6\" alt=\"\" loading=\"lazy\"></p>\n<!--kg-card-end: markdown-->","comment_id":"607f2c065d6c891ac9aa73dc","plaintext":"The fractional calculus is a extension of traditional calcus by noninteger\norders of integrals and derivatives. Allows to generalize these operations and\nparametrize them to better understood how a functions that are these derivatives\ninject on each oder smoothly.\n\nThere you can see how behaves some fractional derivatives of known functions\nthat I investigated.\n\nHow to calculate fractional derivatives and integrals\nLets define  differintegral operator - transformation that make differentiation\nfor positive order and integration for negative. For integer $ \\alpha $\neverything works like in traditional calculus.\n\nJ^\\alpha f = \\begin{cases} \n   D^\\alpha f     & \\text{if } x \\gt 0 \\\\\n   f              & \\text{if } x = 0 \\\\\n   I^{|\\alpha|} f & \\text{if } x < 0\n  \\end{cases}\n\nBut magic starts for","feature_image":null,"featured":0,"type":"post","status":"draft","locale":null,"visibility":"public","email_recipient_filter":"all","created_at":"2021-04-20T19:31:18.000Z","updated_at":"2021-04-20T19:32:37.000Z","published_at":null,"custom_excerpt":null,"codeinjection_head":null,"codeinjection_foot":null,"custom_template":null,"canonical_url":null,"newsletter_id":null,"lexical":null},{"id":"607f389d5d6c891ac9aa73ee","uuid":"43bb72bf-89cf-4ae9-883d-929e2cdffab4","title":"Xss attack using script style and image","slug":"xss-attack-using-script-style-and-image","mobiledoc":"{\"version\":\"0.3.1\",\"atoms\":[],\"cards\":[[\"code\",{\"code\":\"[\\\"First comment\\\",\\\"Second one\\\"]\",\"language\":\"json\"}],[\"code\",{\"code\":\"<?php\\n$comments = json_decode(file_get_contents('db.json'));\\n\\nif($_SERVER[\\\"REQUEST_METHOD\\\"] === \\\"POST\\\") {\\n    $comments[] = $_POST[\\\"comment\\\"];\\n    file_put_contents('db.json', json_encode($comments));\\n}\",\"language\":\"php\"}],[\"code\",{\"code\":\"echo '<form action=\\\"\\\" method=\\\"post\\\">\\n    <input type=\\\"text\\\" name=\\\"comment\\\">\\n    <input type=\\\"submit\\\" value=\\\"send\\\">\\n</form>\\n<ul>';\\n\\nforeach ($comments as $comment) {\\n    echo \\\"<li>\\\".$comment.\\\"</li>\\\";\\n}\\necho '</ul>';\\n\",\"language\":\"php\"}],[\"image\",{\"src\":\"__GHOST_URL__/content/images/2021/07/Screenshot-from-2021-07-08-15-46-08.png\"}],[\"image\",{\"src\":\"__GHOST_URL__/content/images/2021/07/Screenshot-from-2021-07-08-15-47-51.png\"}],[\"code\",{\"code\":\"<script>document.querySelector('html').innerHTML=\\\"Hacked By Daniel\\\"</script>\\n\",\"language\":\"html\"}],[\"code\",{\"code\":\"<style>html::before {content: \\\"Hacked By Daniel\\\";} body {display: none;}</style>\\n\",\"language\":\"html\"}],[\"code\",{\"code\":\"<img src=undefined onerror='document.querySelector(\\\"html\\\").innerHTML=\\\"Hacked By Daniel\\\"'>\\n\",\"language\":\"html\"}],[\"code\",{\"code\":\"-      $comments[] = $_POST[\\\"comment\\\"];\\n+      $comments[] = htmlspecialchars($_POST[\\\"comment\\\"]);\\n\",\"language\":\"diff\"}],[\"image\",{\"src\":\"__GHOST_URL__/content/images/2021/07/Screenshot-from-2021-07-08-15-50-50.png\",\"width\":711,\"height\":164}]],\"markups\":[[\"code\"]],\"sections\":[[1,\"p\",[[0,[],0,\"This article describes examples of XSS attacks. Usage of script tags is probably the most known case, but there also other possibilities. You can change the content of the website on your own using an image tag or pure css.\"]]],[1,\"p\",[[0,[],0,\"This is educational material and you should remember that hacking is illegal if you are caught red-handed. :)\"]]],[1,\"h2\",[[0,[],0,\"Website code\"]]],[1,\"p\",[[0,[],0,\"To present the attack we create a simple website based on PHP. I very like separate logic and view in code, but for simplicity and to minimize the number of lines of code we mixed in, and all website code is placed in index.php. To get the vulnerable website it has to be able to save text from user to database and display it on screen without filtering of this.\"]]],[1,\"p\",[[0,[],0,\"Again for the case of simplicity and clarity, we abandon best practices and use a json file instead of databases. The first file of our project is \"],[0,[0],1,\"db.json\"]]],[1,\"blockquote\",[[0,[],0,\"db.json\"]]],[10,0],[1,\"p\",[[0,[],0,\"To save comments send by using PHP script do the following things:\"]]],[1,\"blockquote\",[[0,[],0,\"index.php\"]]],[10,1],[3,\"ul\",[[[0,[],0,\"Read content of \"],[0,[0],1,\"db.json\"],[0,[],0,\" file and convert it to PHP array.\"]],[[0,[],0,\"Check if the user sends a request by method POST - it means send the form\"]],[[0,[],0,\"If yes\"]],[[0,[],0,\"Append comment send by the user to an array\"]],[[0,[],0,\"Override file \"],[0,[0],1,\"db.json\"],[0,[],0,\" by json encoding array with new comment\"]]]],[1,\"p\",[[0,[],0,\"Independent from the method of request script goes on and display form and list of comments\"]]],[1,\"blockquote\",[[0,[],0,\"index.php\"]]],[10,2],[1,\"p\",[[0,[],0,\"The created website looks like the following\"]]],[10,3],[1,\"p\",[[0,[],0,\"It is fully functional, allows you to add a comment, save it in json, and display a list of comments. If users want to add text, not hack it could be the end of our adventure. But we should assume that at least one user of a website wants to hack it. :)\"]]],[1,\"h2\",[[0,[],0,\"How to hack it?\"]]],[1,\"p\",[[0,[],0,\"This flow of data - saving on the server and displaying on client make possible XSS attack if the text is not properly filtered. XSS means Cross-site scripting and enables attackers to inject client-side scripts into web pages viewed by other users.\"]]],[1,\"p\",[[0,[],0,\"Appended executable code is interpreted by browser, not server so we cannot conquer server by it, but can exchange client behavior. Exemplary benefits for attackers are the following:\"]]],[3,\"ul\",[[[0,[],0,\"stealing cookies (session) - taking control over (logged in) session of the victim\"]],[[0,[],0,\"dynamic change of website content\"]],[[0,[],0,\"enabling key logger in browser\"]]]],[1,\"p\",[[0,[],0,\"The script can be stored on a server or included in the link. In our case, we want to save the script to json file by typing comments. We are interested in change the content of the website to \\\"Hacked by Daniel\\\". In any case of presented below attack method website will look like this:\"]]],[10,4],[1,\"h3\",[[0,[],0,\"Script\"]]],[1,\"p\",[[0,[],0,\"The simplest way is to append a script that dynamically after sile load changes his content to required. Try to add a comment:\"]]],[10,5],[1,\"p\",[[0,[],0,\"This code select \"],[0,[0],1,\"html\"],[0,[],0,\" - it means all page, and change his content using \"],[0,[0],1,\"innerHTML\"],[0,[],0,\" property.\"]]],[1,\"h3\",[[0,[],0,\"Style\"]]],[1,\"p\",[[0,[],0,\"Another method works even if javascript tags are stripped and javascript is disabled in the browser.\"]]],[10,6],[1,\"p\",[[0,[],0,\"We defined two rules for the styling of a website. The first one tells the browser to append text \"],[0,[0],1,\"Hacked By Daniel\"],[0,[],0,\" before the body of a website. The second one to do not display body.\"]]],[1,\"h3\",[[0,[],0,\"Image\"]]],[1,\"p\",[[0,[],0,\"Of course, if we block \"],[0,[0],1,\"script\"],[0,[],0,\" tag and \"],[0,[0],1,\"style\"],[0,[],0,\" tag in our comments is not enough, because we can run the script also in other tags.\"]]],[10,7],[1,\"p\",[[0,[],0,\"This is an example of an image that has an invalid address. If the address is invalid browser run script being the value of the attribute \"],[0,[0],1,\"onerror\"],[0,[],0,\".\"]]],[1,\"h2\",[[0,[],0,\"How to defense?\"]]],[1,\"p\",[[0,[],0,\"To defend against this attack we need to filter the comments of our users and strip HTML tags. We can do it by changing the code in \"],[0,[0],1,\"index.php\"],[0,[],0,\" as below\"]]],[10,8],[1,\"p\",[[0,[],0,\"After applying this fixed text written in the form will be displayed in comments lists literally equal text typed by the user, and will be not interpreted as Html tag.\"]]],[10,9],[1,\"h2\",[[0,[],0,\"Summary\"]]],[1,\"p\",[[0,[],0,\"We showed simple examples of XSS attacks. If you use a framework like Symfony then framework have security mechanism build in his structure, but you should remember about \"],[0,[0],1,\"htmlspecialchars\"],[0,[],0,\" function if you write in pure PHP.\"]]]],\"ghostVersion\":\"4.0\"}","html":"<p>This article describes examples of XSS attacks. Usage of script tags is probably the most known case, but there also other possibilities. You can change the content of the website on your own using an image tag or pure css.</p><p>This is educational material and you should remember that hacking is illegal if you are caught red-handed. :)</p><h2 id=\"website-code\">Website code</h2><p>To present the attack we create a simple website based on PHP. I very like separate logic and view in code, but for simplicity and to minimize the number of lines of code we mixed in, and all website code is placed in index.php. To get the vulnerable website it has to be able to save text from user to database and display it on screen without filtering of this.</p><p>Again for the case of simplicity and clarity, we abandon best practices and use a json file instead of databases. The first file of our project is <code>db.json</code></p><blockquote>db.json</blockquote><pre><code class=\"language-json\">[\"First comment\",\"Second one\"]</code></pre><p>To save comments send by using PHP script do the following things:</p><blockquote>index.php</blockquote><pre><code class=\"language-php\">&lt;?php\n$comments = json_decode(file_get_contents('db.json'));\n\nif($_SERVER[\"REQUEST_METHOD\"] === \"POST\") {\n    $comments[] = $_POST[\"comment\"];\n    file_put_contents('db.json', json_encode($comments));\n}</code></pre><ul><li>Read content of <code>db.json</code> file and convert it to PHP array.</li><li>Check if the user sends a request by method POST - it means send the form</li><li>If yes</li><li>Append comment send by the user to an array</li><li>Override file <code>db.json</code> by json encoding array with new comment</li></ul><p>Independent from the method of request script goes on and display form and list of comments</p><blockquote>index.php</blockquote><pre><code class=\"language-php\">echo '&lt;form action=\"\" method=\"post\"&gt;\n    &lt;input type=\"text\" name=\"comment\"&gt;\n    &lt;input type=\"submit\" value=\"send\"&gt;\n&lt;/form&gt;\n&lt;ul&gt;';\n\nforeach ($comments as $comment) {\n    echo \"&lt;li&gt;\".$comment.\"&lt;/li&gt;\";\n}\necho '&lt;/ul&gt;';\n</code></pre><p>The created website looks like the following</p><figure class=\"kg-card kg-image-card\"><img src=\"__GHOST_URL__/content/images/2021/07/Screenshot-from-2021-07-08-15-46-08.png\" class=\"kg-image\" alt loading=\"lazy\"></figure><p>It is fully functional, allows you to add a comment, save it in json, and display a list of comments. If users want to add text, not hack it could be the end of our adventure. But we should assume that at least one user of a website wants to hack it. :)</p><h2 id=\"how-to-hack-it\">How to hack it?</h2><p>This flow of data - saving on the server and displaying on client make possible XSS attack if the text is not properly filtered. XSS means Cross-site scripting and enables attackers to inject client-side scripts into web pages viewed by other users.</p><p>Appended executable code is interpreted by browser, not server so we cannot conquer server by it, but can exchange client behavior. Exemplary benefits for attackers are the following:</p><ul><li>stealing cookies (session) - taking control over (logged in) session of the victim</li><li>dynamic change of website content</li><li>enabling key logger in browser</li></ul><p>The script can be stored on a server or included in the link. In our case, we want to save the script to json file by typing comments. We are interested in change the content of the website to \"Hacked by Daniel\". In any case of presented below attack method website will look like this:</p><figure class=\"kg-card kg-image-card\"><img src=\"__GHOST_URL__/content/images/2021/07/Screenshot-from-2021-07-08-15-47-51.png\" class=\"kg-image\" alt loading=\"lazy\"></figure><h3 id=\"script\">Script</h3><p>The simplest way is to append a script that dynamically after sile load changes his content to required. Try to add a comment:</p><pre><code class=\"language-html\">&lt;script&gt;document.querySelector('html').innerHTML=\"Hacked By Daniel\"&lt;/script&gt;\n</code></pre><p>This code select <code>html</code> - it means all page, and change his content using <code>innerHTML</code> property.</p><h3 id=\"style\">Style</h3><p>Another method works even if javascript tags are stripped and javascript is disabled in the browser.</p><pre><code class=\"language-html\">&lt;style&gt;html::before {content: \"Hacked By Daniel\";} body {display: none;}&lt;/style&gt;\n</code></pre><p>We defined two rules for the styling of a website. The first one tells the browser to append text <code>Hacked By Daniel</code> before the body of a website. The second one to do not display body.</p><h3 id=\"image\">Image</h3><p>Of course, if we block <code>script</code> tag and <code>style</code> tag in our comments is not enough, because we can run the script also in other tags.</p><pre><code class=\"language-html\">&lt;img src=undefined onerror='document.querySelector(\"html\").innerHTML=\"Hacked By Daniel\"'&gt;\n</code></pre><p>This is an example of an image that has an invalid address. If the address is invalid browser run script being the value of the attribute <code>onerror</code>.</p><h2 id=\"how-to-defense\">How to defense?</h2><p>To defend against this attack we need to filter the comments of our users and strip HTML tags. We can do it by changing the code in <code>index.php</code> as below</p><pre><code class=\"language-diff\">-      $comments[] = $_POST[\"comment\"];\n+      $comments[] = htmlspecialchars($_POST[\"comment\"]);\n</code></pre><p>After applying this fixed text written in the form will be displayed in comments lists literally equal text typed by the user, and will be not interpreted as Html tag.</p><figure class=\"kg-card kg-image-card\"><img src=\"__GHOST_URL__/content/images/2021/07/Screenshot-from-2021-07-08-15-50-50.png\" class=\"kg-image\" alt loading=\"lazy\" width=\"711\" height=\"164\" srcset=\"__GHOST_URL__/content/images/size/w600/2021/07/Screenshot-from-2021-07-08-15-50-50.png 600w, __GHOST_URL__/content/images/2021/07/Screenshot-from-2021-07-08-15-50-50.png 711w\"></figure><h2 id=\"summary\">Summary</h2><p>We showed simple examples of XSS attacks. If you use a framework like Symfony then framework have security mechanism build in his structure, but you should remember about <code>htmlspecialchars</code> function if you write in pure PHP.</p>","comment_id":"607f389d5d6c891ac9aa73ee","plaintext":"This article describes examples of XSS attacks. Usage of script tags is probably\nthe most known case, but there also other possibilities. You can change the\ncontent of the website on your own using an image tag or pure css.\n\nThis is educational material and you should remember that hacking is illegal if\nyou are caught red-handed. :)\n\nWebsite code\nTo present the attack we create a simple website based on PHP. I very like\nseparate logic and view in code, but for simplicity and to minimize the number\nof lines of code we mixed in, and all website code is placed in index.php. To\nget the vulnerable website it has to be able to save text from user to database\nand display it on screen without filtering of this.\n\nAgain for the case of simplicity and clarity, we abandon best practices and use\na json file instead of databases. The first file of our project is db.json\n\n> db.json\n[\"First comment\",\"Second one\"]\n\nTo save comments send by using PHP script do the following things:\n\n> index.php\n<?php\n$comments = json_decode(file_get_contents('db.json'));\n\nif($_SERVER[\"REQUEST_METHOD\"] === \"POST\") {\n    $comments[] = $_POST[\"comment\"];\n    file_put_contents('db.json', json_encode($comments));\n}\n\n * Read content of db.json file and convert it to PHP array.\n * Check if the user sends a request by method POST - it means send the form\n * If yes\n * Append comment send by the user to an array\n * Override file db.json by json encoding array with new comment\n\nIndependent from the method of request script goes on and display form and list\nof comments\n\n> index.php\necho '<form action=\"\" method=\"post\">\n    <input type=\"text\" name=\"comment\">\n    <input type=\"submit\" value=\"send\">\n</form>\n<ul>';\n\nforeach ($comments as $comment) {\n    echo \"<li>\".$comment.\"</li>\";\n}\necho '</ul>';\n\n\nThe created website looks like the following\n\nIt is fully functional, allows you to add a comment, save it in json, and\ndisplay a list of comments. If users want to add text, not hack it could be the\nend of our adventure. But we should assume that at least one user of a website\nwants to hack it. :)\n\nHow to hack it?\nThis flow of data - saving on the server and displaying on client make possible\nXSS attack if the text is not properly filtered. XSS means Cross-site scripting\nand enables attackers to inject client-side scripts into web pages viewed by\nother users.\n\nAppended executable code is interpreted by browser, not server so we cannot\nconquer server by it, but can exchange client behavior. Exemplary benefits for\nattackers are the following:\n\n * stealing cookies (session) - taking control over (logged in) session of the\n   victim\n * dynamic change of website content\n * enabling key logger in browser\n\nThe script can be stored on a server or included in the link. In our case, we\nwant to save the script to json file by typing comments. We are interested in\nchange the content of the website to \"Hacked by Daniel\". In any case of\npresented below attack method website will look like this:\n\nScript\nThe simplest way is to append a script that dynamically after sile load changes\nhis content to required. Try to add a comment:\n\n<script>document.querySelector('html').innerHTML=\"Hacked By Daniel\"</script>\n\n\nThis code select html - it means all page, and change his content using \ninnerHTML property.\n\nStyle\nAnother method works even if javascript tags are stripped and javascript is\ndisabled in the browser.\n\n<style>html::before {content: \"Hacked By Daniel\";} body {display: none;}</style>\n\n\nWe defined two rules for the styling of a website. The first one tells the\nbrowser to append text Hacked By Daniel before the body of a website. The second\none to do not display body.\n\nImage\nOf course, if we block script tag and style tag in our comments is not enough,\nbecause we can run the script also in other tags.\n\n<img src=undefined onerror='document.querySelector(\"html\").innerHTML=\"Hacked By Daniel\"'>\n\n\nThis is an example of an image that has an invalid address. If the address is\ninvalid browser run script being the value of the attribute onerror.\n\nHow to defense?\nTo defend against this attack we need to filter the comments of our users and\nstrip HTML tags. We can do it by changing the code in index.php as below\n\n-      $comments[] = $_POST[\"comment\"];\n+      $comments[] = htmlspecialchars($_POST[\"comment\"]);\n\n\nAfter applying this fixed text written in the form will be displayed in comments\nlists literally equal text typed by the user, and will be not interpreted as\nHtml tag.\n\nSummary\nWe showed simple examples of XSS attacks. If you use a framework like Symfony\nthen framework have security mechanism build in his structure, but you should\nremember about htmlspecialchars function if you write in pure PHP.","feature_image":"__GHOST_URL__/content/images/2021/07/cross-site-scripting-xss.jpg","featured":0,"type":"post","status":"published","locale":null,"visibility":"public","email_recipient_filter":"all","created_at":"2021-04-20T20:25:01.000Z","updated_at":"2021-07-08T13:51:40.000Z","published_at":"2021-07-08T13:51:40.000Z","custom_excerpt":"Learn how to infect a page using an XSS attack with the script, style, or image tags. You can see how to replace the content of the page with your own even without javascript. ","codeinjection_head":null,"codeinjection_foot":null,"custom_template":null,"canonical_url":null,"newsletter_id":null,"lexical":null},{"id":"607f3e665d6c891ac9aa73fd","uuid":"14f8653e-107b-4405-8ea9-75262488d0c0","title":"Measuring the amount of text and code in my blog posts","slug":"measuring-the-amount-of-text-and-code-in-my-blog-posts","mobiledoc":"{\"version\":\"0.3.1\",\"atoms\":[],\"cards\":[[\"markdown\",{\"markdown\":\"## Project description\\n\\nOut of curiosity, I wanted to check what part of my blog posts are text and what source code. I wrote a program that gave me the answer to this question.\\n\\nThe whole project was originally written in perl5 in 2017 and described in Polish language, but there is presented perl6 version.\\n\\n## Installation\\n\\nWe install dependencies manager: [zef](https://github.com/ugexe/zef). Then we are installing two packages:\\n\\n```Bash\\nzef install WWW\\n```\\n\\n~~We're downloading the source code from gist~~\\n\\n```Bash\\n wget https://gist.githubusercontent.com/gustawdaniel/a4bb55473e8e4399a5b087f1979e78d0/raw/3427bbd1f6b68c75e0481eaee0fc6f466db8af6d/count_text_and_code.pl -O count_text_and_code.pl\\n```\\n\\nAnd ready.\\n\\n\\n\\n| text  | code  | title                                                       |\\n| ----- | ----- | ----------------------------------------------------------- |\\n| 3306  | 903   | Pomiar ilości tekstu i kodu w moich wpisach                 |\\n| 2560  | 223   | Instalacja odnawialnego certyfikatu TLS                     |\\n| 3741  | 788   | Xss attack using script style and image                     |\\n| 461   | 4320  | Measurement of the amount of text and code in my blog posts |\\n| 6830  | 2938  | Kompilacja interpretera php 7 w BunsenLabs                  |\\n| 11276 | 3936  | Scrapowanie danych w języku Perl                            |\\n| 4790  | 5576  | Snake game in JavaScript (part 1 - objects)                 |\\n| 10278 | 11629 | Logowanie danych w MySql, Ajax i Behat                      |\\n| 9520  | 5747  | Testowanie szybkości selektów                               |\\n| 9754  | 7307  | Fetch, promise oraz string templates                        |\\n| 5711  | 17380 | Snake game in JavaScript (part 2 - events)                  |\\n| 13852 | 12268 | Wizualizacja dynamicznej sieci korelacyjnej.                |\\n| 17293 | 11673 | Analiza logów Apache z GoAccess                             |\\n| 5798  | 22759 | Snake game in JavaScript (part 3 - Vue)                     |\\n| 18121 | 21940 | Tesseract-OCR i testowanie selektów.                        |\\n| 27173 | 15056 | Struktura bazy danych                                       |\\n| 23915 | 43022 | Aplikacja z FOSUserBundle i API Google Maps                 |\\n| 48455 | 16256 | Analiza wydajności pustych pętli w 16 językach              |\\n\\n\\n\\n## Action\\n\\nAfter switching on, the program prints a table on the screen with the number of characters in the text (text), number of characters of the presented source code (code) and title of entries (title).\\n\\n{% include video.html url = 'https: //www.dropbox.com/s/bh4n1ko7ygfu3ko/10.mp4? dl = 1' webm = 'https: //www.dropbox.com/s/9ngx754jsj9wzxj/10. webm? dl = 1 '%}\\n\\n## Source code\\n\\nThe code of this program is quite condensed. It starts with loading libraries:\\n\\n``` Perl\\n#! / usr / bin / env perl\\n\\nuse warnings;\\nuse strict;\\n\\nuse HTML :: TagParser;\\n```\\n\\nThen the declaration of variables follows\\n\\n``` Perl\\nmy $ url = 'https://blog.gustawdaniel.pl';\\nmy @tags = (\\\"h1 h2 h3 h4 li p\\\", \\\"pre\\\");\\n```\\n\\nThe first one is the location of the main page of this blog. The second contains a list of tags treated as text (h1 h2 h3 h4 li p) and tags treated as a (pre) code.\\n\\nThe executable part of the script starts with drawing the table header with the results\\n\\n``` Perl\\nprint \\\"| text | code | title \\\\ n\\\";\\n```\\n\\nHere the introduction ends and magic begins. The next line takes the content of the main page of the blog, extracts all elements from the tag `h2` from it and writes to the table.\\n\\n``` Perl\\nmy @list = HTML :: TagParser-> new ($ url) -> getElementsByTagName (\\\"h2\\\");\\n```\\n\\nWe deal with the tag `h2` because on the main page of the blog all the links to entries are located inside such a tag.\\n\\n[! [Scr2.png] (https://s1.postimg.org/fb5elwfgv/scr2.png)] (https://postimg.org/image/r09e9v6ff/)\\n\\nThe next natural step is to loop through this list:\\n\\n``` Perl\\nforeach my $ elem (@list) {\\n```\\n\\nInside the loop, we extract the value of the 'href' attribute for the first child of the `h2` element from the home page. We attach it to the blog's address - `$ url` and again download all content using the` new` method of the 'TagParser` object. Download the downloaded content to the `$ post` variable.\\n\\n``` Perl\\n    my $ post = HTML :: TagParser-> new ($ url. $ elem-> firstChild () -> getAttribute (\\\"href\\\"));\\n```\\n\\nWe are about to process it, but before moving on to the next part of the program, we initialize a two-element table inside which we will store the text and the code extracted from the post.\\n\\n```Perl\\n    my @str = (\\\"\\\", \\\"\\\");\\n```\\n\\nWe enter the next level of the loop that iterates just after these two elements. This means that for `$ i = 0` we extract texts, and for` $ i = 1` we are interested in counting the amount of source code.\\n\\n```Perl\\n    foreach my $ i ((0,1)) {\\n```\\n\\nSuch flexibility in the selection of the currently counted elements is obtained thanks to the `@ tags` variable defined earlier. Now we select its first element and convert it to an array containing tags. The `map` function allows us to select the list of elements after the tag for each of the extracted tags. Ultimately, all these elements end up in the common `@ elements` array.\\n\\n```Perl\\n        my @elements = map {$ post-> getElementsByTagName ($ _)} split / /, $ tags [$ i];\\n```\\n\\nTo extract the text from them we will use the method of 'innerText` and simple mapping and projection of the array on the string we will extract the searched texts.\\n\\n```Perl\\n        $ str [$ i] = join (\\\"\\\", map {$ _-> innerText} @elements);\\n```\\n\\nWe can end the loop body by indexes (0,1)\\n\\n```Perl\\n    }\\n```\\n\\nAll we have left is to calculate the number of characters and print results - one line of code:\\n\\n```Perl\\n    printf (\\\"|% 8d |% 8d |% -60s \\\\ n\\\", (map {$ str [$ _] = ~ y === c} (0,1)), $ elem-> innerText);\\n```\\n\\nAt the end we close the loop after posts.\\n\\n```Perl\\n}\\n```\\n\\nThe operation of the program is guaranteed until you change the organization of links on the home page in the `html` code.\\n\\n## Summary\\n\\nThe results are measured in the following screen:\\n\\n[! [Screen.png] (https://s11.postimg.org/niq06o56r/screen.png)] (https://postimg.org/image/o88sj15q7/)\\n\\nThis is one of the shortest entries. It is also one of the shortest source codes. It is just the density of the syntax in pearl that is, in my opinion, one of the greatest advantages of this beautiful language.\"}]],\"markups\":[],\"sections\":[[10,0],[1,\"p\",[]]],\"ghostVersion\":\"4.0\"}","html":"<!--kg-card-begin: markdown--><h2 id=\"project-description\">Project description</h2>\n<p>Out of curiosity, I wanted to check what part of my blog posts are text and what source code. I wrote a program that gave me the answer to this question.</p>\n<p>The whole project was originally written in perl5 in 2017 and described in Polish language, but there is presented perl6 version.</p>\n<h2 id=\"installation\">Installation</h2>\n<p>We install dependencies manager: <a href=\"https://github.com/ugexe/zef\">zef</a>. Then we are installing two packages:</p>\n<pre><code class=\"language-Bash\">zef install WWW\n</code></pre>\n<p><s>We're downloading the source code from gist</s></p>\n<pre><code class=\"language-Bash\"> wget https://gist.githubusercontent.com/gustawdaniel/a4bb55473e8e4399a5b087f1979e78d0/raw/3427bbd1f6b68c75e0481eaee0fc6f466db8af6d/count_text_and_code.pl -O count_text_and_code.pl\n</code></pre>\n<p>And ready.</p>\n<table>\n<thead>\n<tr>\n<th>text</th>\n<th>code</th>\n<th>title</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>3306</td>\n<td>903</td>\n<td>Pomiar ilości tekstu i kodu w moich wpisach</td>\n</tr>\n<tr>\n<td>2560</td>\n<td>223</td>\n<td>Instalacja odnawialnego certyfikatu TLS</td>\n</tr>\n<tr>\n<td>3741</td>\n<td>788</td>\n<td>Xss attack using script style and image</td>\n</tr>\n<tr>\n<td>461</td>\n<td>4320</td>\n<td>Measurement of the amount of text and code in my blog posts</td>\n</tr>\n<tr>\n<td>6830</td>\n<td>2938</td>\n<td>Kompilacja interpretera php 7 w BunsenLabs</td>\n</tr>\n<tr>\n<td>11276</td>\n<td>3936</td>\n<td>Scrapowanie danych w języku Perl</td>\n</tr>\n<tr>\n<td>4790</td>\n<td>5576</td>\n<td>Snake game in JavaScript (part 1 - objects)</td>\n</tr>\n<tr>\n<td>10278</td>\n<td>11629</td>\n<td>Logowanie danych w MySql, Ajax i Behat</td>\n</tr>\n<tr>\n<td>9520</td>\n<td>5747</td>\n<td>Testowanie szybkości selektów</td>\n</tr>\n<tr>\n<td>9754</td>\n<td>7307</td>\n<td>Fetch, promise oraz string templates</td>\n</tr>\n<tr>\n<td>5711</td>\n<td>17380</td>\n<td>Snake game in JavaScript (part 2 - events)</td>\n</tr>\n<tr>\n<td>13852</td>\n<td>12268</td>\n<td>Wizualizacja dynamicznej sieci korelacyjnej.</td>\n</tr>\n<tr>\n<td>17293</td>\n<td>11673</td>\n<td>Analiza logów Apache z GoAccess</td>\n</tr>\n<tr>\n<td>5798</td>\n<td>22759</td>\n<td>Snake game in JavaScript (part 3 - Vue)</td>\n</tr>\n<tr>\n<td>18121</td>\n<td>21940</td>\n<td>Tesseract-OCR i testowanie selektów.</td>\n</tr>\n<tr>\n<td>27173</td>\n<td>15056</td>\n<td>Struktura bazy danych</td>\n</tr>\n<tr>\n<td>23915</td>\n<td>43022</td>\n<td>Aplikacja z FOSUserBundle i API Google Maps</td>\n</tr>\n<tr>\n<td>48455</td>\n<td>16256</td>\n<td>Analiza wydajności pustych pętli w 16 językach</td>\n</tr>\n</tbody>\n</table>\n<h2 id=\"action\">Action</h2>\n<p>After switching on, the program prints a table on the screen with the number of characters in the text (text), number of characters of the presented source code (code) and title of entries (title).</p>\n<p>{% include video.html url = 'https: <a href=\"//www.dropbox.com/s/bh4n1ko7ygfu3ko/10.mp4\">//www.dropbox.com/s/bh4n1ko7ygfu3ko/10.mp4</a>? dl = 1' webm = 'https: <a href=\"//www.dropbox.com/s/9ngx754jsj9wzxj/10\">//www.dropbox.com/s/9ngx754jsj9wzxj/10</a>. webm? dl = 1 '%}</p>\n<h2 id=\"source-code\">Source code</h2>\n<p>The code of this program is quite condensed. It starts with loading libraries:</p>\n<pre><code class=\"language-Perl\">#! / usr / bin / env perl\n\nuse warnings;\nuse strict;\n\nuse HTML :: TagParser;\n</code></pre>\n<p>Then the declaration of variables follows</p>\n<pre><code class=\"language-Perl\">my $ url = 'https://blog.gustawdaniel.pl';\nmy @tags = (&quot;h1 h2 h3 h4 li p&quot;, &quot;pre&quot;);\n</code></pre>\n<p>The first one is the location of the main page of this blog. The second contains a list of tags treated as text (h1 h2 h3 h4 li p) and tags treated as a (pre) code.</p>\n<p>The executable part of the script starts with drawing the table header with the results</p>\n<pre><code class=\"language-Perl\">print &quot;| text | code | title \\ n&quot;;\n</code></pre>\n<p>Here the introduction ends and magic begins. The next line takes the content of the main page of the blog, extracts all elements from the tag <code>h2</code> from it and writes to the table.</p>\n<pre><code class=\"language-Perl\">my @list = HTML :: TagParser-&gt; new ($ url) -&gt; getElementsByTagName (&quot;h2&quot;);\n</code></pre>\n<p>We deal with the tag <code>h2</code> because on the main page of the blog all the links to entries are located inside such a tag.</p>\n<p>[! [Scr2.png] (<a href=\"https://s1.postimg.org/fb5elwfgv/scr2.png\">https://s1.postimg.org/fb5elwfgv/scr2.png</a>)] (<a href=\"https://postimg.org/image/r09e9v6ff/\">https://postimg.org/image/r09e9v6ff/</a>)</p>\n<p>The next natural step is to loop through this list:</p>\n<pre><code class=\"language-Perl\">foreach my $ elem (@list) {\n</code></pre>\n<p>Inside the loop, we extract the value of the 'href' attribute for the first child of the <code>h2</code> element from the home page. We attach it to the blog's address - <code>$ url</code> and again download all content using the<code> new</code> method of the 'TagParser<code>object. Download the downloaded content to the</code>$ post` variable.</p>\n<pre><code class=\"language-Perl\">    my $ post = HTML :: TagParser-&gt; new ($ url. $ elem-&gt; firstChild () -&gt; getAttribute (&quot;href&quot;));\n</code></pre>\n<p>We are about to process it, but before moving on to the next part of the program, we initialize a two-element table inside which we will store the text and the code extracted from the post.</p>\n<pre><code class=\"language-Perl\">    my @str = (&quot;&quot;, &quot;&quot;);\n</code></pre>\n<p>We enter the next level of the loop that iterates just after these two elements. This means that for <code>$ i = 0</code> we extract texts, and for<code> $ i = 1</code> we are interested in counting the amount of source code.</p>\n<pre><code class=\"language-Perl\">    foreach my $ i ((0,1)) {\n</code></pre>\n<p>Such flexibility in the selection of the currently counted elements is obtained thanks to the <code>@ tags</code> variable defined earlier. Now we select its first element and convert it to an array containing tags. The <code>map</code> function allows us to select the list of elements after the tag for each of the extracted tags. Ultimately, all these elements end up in the common <code>@ elements</code> array.</p>\n<pre><code class=\"language-Perl\">        my @elements = map {$ post-&gt; getElementsByTagName ($ _)} split / /, $ tags [$ i];\n</code></pre>\n<p>To extract the text from them we will use the method of 'innerText` and simple mapping and projection of the array on the string we will extract the searched texts.</p>\n<pre><code class=\"language-Perl\">        $ str [$ i] = join (&quot;&quot;, map {$ _-&gt; innerText} @elements);\n</code></pre>\n<p>We can end the loop body by indexes (0,1)</p>\n<pre><code class=\"language-Perl\">    }\n</code></pre>\n<p>All we have left is to calculate the number of characters and print results - one line of code:</p>\n<pre><code class=\"language-Perl\">    printf (&quot;|% 8d |% 8d |% -60s \\ n&quot;, (map {$ str [$ _] = ~ y === c} (0,1)), $ elem-&gt; innerText);\n</code></pre>\n<p>At the end we close the loop after posts.</p>\n<pre><code class=\"language-Perl\">}\n</code></pre>\n<p>The operation of the program is guaranteed until you change the organization of links on the home page in the <code>html</code> code.</p>\n<h2 id=\"summary\">Summary</h2>\n<p>The results are measured in the following screen:</p>\n<p>[! [Screen.png] (<a href=\"https://s11.postimg.org/niq06o56r/screen.png\">https://s11.postimg.org/niq06o56r/screen.png</a>)] (<a href=\"https://postimg.org/image/o88sj15q7/\">https://postimg.org/image/o88sj15q7/</a>)</p>\n<p>This is one of the shortest entries. It is also one of the shortest source codes. It is just the density of the syntax in pearl that is, in my opinion, one of the greatest advantages of this beautiful language.</p>\n<!--kg-card-end: markdown-->","comment_id":"607f3e665d6c891ac9aa73fd","plaintext":"Project description\nOut of curiosity, I wanted to check what part of my blog posts are text and what\nsource code. I wrote a program that gave me the answer to this question.\n\nThe whole project was originally written in perl5 in 2017 and described in\nPolish language, but there is presented perl6 version.\n\nInstallation\nWe install dependencies manager: zef [https://github.com/ugexe/zef]. Then we are\ninstalling two packages:\n\nzef install WWW\n\n\nWe're downloading the source code from gist\n\n wget https://gist.githubusercontent.com/gustawdaniel/a4bb55473e8e4399a5b087f1979e78d0/raw/3427bbd1f6b68c75e0481eaee0fc6f466db8af6d/count_text_and_code.pl -O count_text_and_code.pl\n\n\nAnd ready.\n\ntextcodetitle3306903Pomiar ilości tekstu i kodu w moich wpisach2560223Instalacja\nodnawialnego certyfikatu TLS3741788Xss attack using script style and image461\n4320Measurement of the amount of text and code in my blog posts68302938\nKompilacja interpretera php 7 w BunsenLabs112763936Scrapowanie danych w języku\nPerl47905576Snake game in JavaScript (part 1 - objects)1027811629Logowanie\ndanych w MySql, Ajax i Behat95205747Testowanie szybkości selektów97547307Fetch,\npromise oraz string templates571117380Snake game in JavaScript (part 2 - events)\n1385212268Wizualizacja dynamicznej sieci korelacyjnej.1729311673Analiza logów\nApache z GoAccess579822759Snake game in JavaScript (part 3 - Vue)1812121940\nTesseract-OCR i testowanie selektów.2717315056Struktura bazy danych2391543022\nAplikacja z FOSUserBundle i API Google Maps4845516256Analiza wydajności pustych\npętli w 16 językachAction\nAfter switching on, the program prints a table on the screen with the number of\ncharacters in the text (text), number of characters of the presented source code\n(code) and title of entries (title).\n\n{% include video.html url = 'https: //www.dropbox.com/s/bh4n1ko7ygfu3ko/10.mp4?\ndl = 1' webm = 'https: //www.dropbox.com/s/9ngx754jsj9wzxj/10. webm? dl = 1 '%}\n\nSource code\nThe code of this program is quite condensed. It starts with loading libraries:\n\n#! / usr / bin / env perl\n\nuse warnings;\nuse strict;\n\nuse HTML :: TagParser;\n\n\nThen the declaration of variables follows\n\nmy $ url = 'https://blog.gustawdaniel.pl';\nmy @tags = (\"h1 h2 h3 h4 li p\", \"pre\");\n\n\nThe first one is the location of the main page of this blog. The second contains\na list of tags treated as text (h1 h2 h3 h4 li p) and tags treated as a (pre)\ncode.\n\nThe executable part of the script starts with drawing the table header with the\nresults\n\nprint \"| text | code | title \\ n\";\n\n\nHere the introduction ends and magic begins. The next line takes the content of\nthe main page of the blog, extracts all elements from the tag h2 from it and\nwrites to the table.\n\nmy @list = HTML :: TagParser-> new ($ url) -> getElementsByTagName (\"h2\");\n\n\nWe deal with the tag h2 because on the main page of the blog all the links to\nentries are located inside such a tag.\n\n[! [Scr2.png] (https://s1.postimg.org/fb5elwfgv/scr2.png)] (\nhttps://postimg.org/image/r09e9v6ff/)\n\nThe next natural step is to loop through this list:\n\nforeach my $ elem (@list) {\n\n\nInside the loop, we extract the value of the 'href' attribute for the first\nchild of the h2 element from the home page. We attach it to the blog's address - \n$ url and again download all content using the new method of the 'TagParser\nobject. Download the downloaded content to the$ post` variable.\n\n    my $ post = HTML :: TagParser-> new ($ url. $ elem-> firstChild () -> getAttribute (\"href\"));\n\n\nWe are about to process it, but before moving on to the next part of the\nprogram, we initialize a two-element table inside which we will store the text\nand the code extracted from the post.\n\n    my @str = (\"\", \"\");\n\n\nWe enter the next level of the loop that iterates just after these two elements.\nThis means that for $ i = 0 we extract texts, and for $ i = 1 we are interested\nin counting the amount of source code.\n\n    foreach my $ i ((0,1)) {\n\n\nSuch flexibility in the selection of the currently counted elements is obtained\nthanks to the @ tags variable defined earlier. Now we select its first element\nand convert it to an array containing tags. The map function allows us to select\nthe list of elements after the tag for each of the extracted tags. Ultimately,\nall these elements end up in the common @ elements array.\n\n        my @elements = map {$ post-> getElementsByTagName ($ _)} split / /, $ tags [$ i];\n\n\nTo extract the text from them we will use the method of 'innerText` and simple\nmapping and projection of the array on the string we will extract the searched\ntexts.\n\n        $ str [$ i] = join (\"\", map {$ _-> innerText} @elements);\n\n\nWe can end the loop body by indexes (0,1)\n\n    }\n\n\nAll we have left is to calculate the number of characters and print results -\none line of code:\n\n    printf (\"|% 8d |% 8d |% -60s \\ n\", (map {$ str [$ _] = ~ y === c} (0,1)), $ elem-> innerText);\n\n\nAt the end we close the loop after posts.\n\n}\n\n\nThe operation of the program is guaranteed until you change the organization of\nlinks on the home page in the html code.\n\nSummary\nThe results are measured in the following screen:\n\n[! [Screen.png] (https://s11.postimg.org/niq06o56r/screen.png)] (\nhttps://postimg.org/image/o88sj15q7/)\n\nThis is one of the shortest entries. It is also one of the shortest source\ncodes. It is just the density of the syntax in pearl that is, in my opinion, one\nof the greatest advantages of this beautiful language.","feature_image":null,"featured":0,"type":"post","status":"draft","locale":null,"visibility":"public","email_recipient_filter":"all","created_at":"2021-04-20T20:49:42.000Z","updated_at":"2021-04-20T20:49:54.000Z","published_at":null,"custom_excerpt":null,"codeinjection_head":null,"codeinjection_foot":null,"custom_template":null,"canonical_url":null,"newsletter_id":null,"lexical":null},{"id":"607f40615d6c891ac9aa7404","uuid":"694c095e-6fff-4f40-81d1-9610d800d52d","title":"Communication between Vue components in Meteor","slug":"communication-between-vue-components-in-meteor","mobiledoc":"{\"version\":\"0.3.1\",\"atoms\":[],\"cards\":[[\"code\",{\"code\":\"meteor create .\"}],[\"code\",{\"code\":\"meteor remove autopublish insecure blaze-html-templates\\nmeteor add akryum:vue-component static-html\\nmeteor npm install --save vue-meteor-tracker vue\"}],[\"code\",{\"code\":\"<head>\\n   <title>Components communication</title>\\n</head>\\n<body>\\n   <div id=\\\"app\\\"></div>\\n</body>\"}],[\"code\",{\"code\":\"import Vue from 'vue';\\n\\nimport VueMeteorTracker from 'vue-meteor-tracker';   // here!\\nVue.use(VueMeteorTracker);                           // here!\\n\\nimport App from './App.vue';\\n\\nMeteor.startup(() => {\\n  new Vue({\\n    el: '#app',\\n    render: h => h(App)\\n  });\\n});\"}],[\"code\",{\"code\":\"<template>\\n    <h1>App</h1>\\n</template>\\n\\n<script>\\n    export default {\\n        name: \\\"App\\\"\\n    }\\n</script>\"}],[\"image\",{\"src\":\"__GHOST_URL__/content/images/2021/04/1_8pl-wsHGBftLFxMOiyBZXA.gif\",\"width\":701,\"height\":103}],[\"code\",{\"code\":\"<template>\\n\\n    <input class=\\\"form-input\\\" type=\\\"text\\\" ref=\\\"input\\\" @keyup=\\\"update\\\">\\n\\n</template>\\n\\n<script>\\n    export default {\\n        methods: {\\n            update() {\\n                document.querySelector('#dom-target').innerHTML = this.$refs.input.value; // result of selector could be cached\\n            }\\n        }\\n    }\\n</script>\"}],[\"code\",{\"code\":\"<template>\\n\\n    <p class=\\\"m-2\\\" id=\\\"dom-target\\\"></p>\\n\\n</template>\\n\"}],[\"code\",{\"code\":\"import Vue from 'vue';\\n\\nexport default new Vue();\"}],[\"code\",{\"code\":\"<template>\\n\\n    <input class=\\\"form-input\\\" type=\\\"text\\\" v-model=\\\"value\\\" @keyup=\\\"update\\\">\\n\\n</template>\\n\\n<script>\\n    import EventBus from '../../EventBus';\\n\\n    export default {\\n        data() {\\n            return { value: null }\\n        },\\n        methods: {\\n            update() {\\n                EventBus.$emit('update', this.value)\\n            }\\n        }\\n    }\\n</script>\"}],[\"code\",{\"code\":\"<template>\\n\\n    <p class=\\\"m-2\\\" id=\\\"dom-target\\\">{{value}}</p>\\n\\n</template>\\n\\n<script>\\n    import EventBus from '../../EventBus';\\n\\n    export default {\\n        data() {\\n            return {\\n                value: null\\n            }\\n        },\\n        mounted() {\\n            EventBus.$on('update', (value) => {\\n                this.value = value;\\n            })\\n        }\\n    }\\n</script>\"}],[\"code\",{\"code\":\"npm install vuex --save\"}],[\"code\",{\"code\":\"import Vue from 'vue'\\nimport Vuex from 'vuex'\\n\\nVue.use(Vuex);\"}],[\"code\",{\"code\":\"import Vuex from 'vuex'\\n\\nexport default new Vuex.Store({\\n    state: {\\n        value: null\\n    },\\n    mutations: {\\n        update (state, value) {\\n            state.value = value;\\n        }\\n    }\\n});\"}],[\"code\",{\"code\":\"import Vue from 'vue';\\n\\nimport '../imports/client/plugins/tracker'\\nimport '../imports/client/plugins/vuex'\\nimport store from '../imports/client/vuex/store';\\n\\nimport App from '../imports/client/ui/App.vue';\\n\\nMeteor.startup(() => {\\n  new Vue({\\n    el: '#app',\\n    store,\\n    render: h => h(App)\\n  });\\n});\"}],[\"code\",{\"code\":\"<template>\\n\\n    <input class=\\\"form-input\\\" type=\\\"text\\\" @keyup=\\\"update\\\">\\n\\n</template>\\n\\n<script>\\n    export default {\\n        methods: {\\n            update(event) {\\n                this.$store.commit('update', event.target.value)\\n            }\\n        }\\n    }\\n</script>\"}],[\"code\",{\"code\":\"<template>\\n\\n    <p class=\\\"m-2\\\" id=\\\"dom-target\\\">{{$store.state.value}}</p>\\n\\n</template>\"}],[\"code\",{\"code\":\"export default new Tracker.Dependency;\\n\"}],[\"code\",{\"code\":\"<template>\\n\\n    <input class=\\\"form-input\\\" type=\\\"text\\\" @keyup=\\\"update\\\">\\n\\n</template>\\n\\n<script>\\n    import dependency from '../../Dependency';\\n\\n    export default {\\n        methods: {\\n            update(event) {\\n                window.localStorage.setItem('value', event.target.value);\\n                dependency.changed();\\n            }\\n        },\\n        created() {\\n            window.localStorage.clear();\\n        }\\n    }\\n</script>\"}],[\"code\",{\"code\":\"<template>\\n\\n    <p class=\\\"m-2\\\" id=\\\"dom-target\\\">{{value}}</p>\\n\\n</template>\\n\\n<script>\\n    import dependency from '../../Dependency';\\n\\n    export default {\\n        data() {\\n            return {\\n                value: null\\n            }\\n        },\\n        created() {\\n            Tracker.autorun(() => {\\n                dependency.depend();\\n                this.value = window.localStorage.getItem('value');\\n            });\\n        }\\n    }\\n</script>\"}],[\"code\",{\"code\":\"export const Values = new Mongo.Collection(null);\\n\"}],[\"code\",{\"code\":\"<template>\\n\\n    <input class=\\\"form-input\\\" type=\\\"text\\\" @keyup=\\\"update\\\">\\n\\n</template>\\n\\n<script>\\n    import { Values } from '../../Values';\\n\\n    export default {\\n        methods: {\\n            update(event) {\\n                Values.upsert('value', {$set: {value: event.target.value}})\\n            }\\n        },\\n        created() {\\n            Values.upsert('value', {$set: {value: null}});\\n        }\\n    }\\n</script>\"}],[\"code\",{\"code\":\"<template>\\n\\n    <p class=\\\"m-2\\\">{{valueObject.value}}</p>\\n\\n</template>\\n\\n<script>\\n    import { Values } from '../../Values';\\n\\n    export default {\\n        meteor: {\\n            valueObject() {\\n                return Values.findOne('value');\\n            }\\n        }\\n    }\\n</script>\"}],[\"image\",{\"src\":\"__GHOST_URL__/content/images/2021/04/1_m73DyRU5IRqiUrZa6pIgkQ.png\",\"width\":687,\"height\":293,\"caption\":\"All methods presented in this article with input and output components.\"}],[\"bookmark\",{\"type\":\"bookmark\",\"url\":\"https://medium.com/@gustaw.daniel/communication-between-vue-components-in-meteor-29006be3dae9\",\"metadata\":{\"url\":\"https://medium.com/@gustaw.daniel/communication-between-vue-components-in-meteor-29006be3dae9\",\"title\":\"Communication between Vue components in Meteor\",\"description\":\"Full repository with all these method can be found there: https://github.com/gustawdaniel/vue-meteor-components-communication-tutorial We assume that you can create meteor project with Vue. If not…\",\"author\":\"Daniel Gustaw\",\"publisher\":\"Medium\",\"thumbnail\":\"https://miro.medium.com/max/687/1*m73DyRU5IRqiUrZa6pIgkQ.png\",\"icon\":\"https://miro.medium.com/fit/c/152/152/1*sHhtYhaCe2Uc3IU0IgKwIQ.png\"}}]],\"markups\":[[\"a\",[\"href\",\"https://github.com/meteor-vue/vue-meteor-tracker\",\"rel\",\"noopener nofollow\"]],[\"a\",[\"href\",\"https://github.com/gustawdaniel/vue-meteor-components-communication-tutorial\",\"rel\",\"noopener nofollow\"]],[\"code\"],[\"a\",[\"href\",\"https://vuejs.org/v2/guide/components-custom-events.html\",\"rel\",\"noopener nofollow\"]],[\"a\",[\"href\",\"https://vuex.vuejs.org/guide/\",\"rel\",\"noopener nofollow\"]],[\"a\",[\"href\",\"https://docs.meteor.com/api/tracker.html\",\"rel\",\"noopener nofollow\"]]],\"sections\":[[1,\"h2\",[[0,[],0,\"What we have and what we want?\"]]],[1,\"p\",[[0,[],0,\"Lets consider the following situation.\"]]],[3,\"ol\",[[[0,[],0,\"We have Meteor project with Vue\"]],[[0,[],0,\"We have two components that use the same data\"]],[[0,[],0,\"We want to observe changes made in one component in another\"]]]],[1,\"h2\",[[0,[],0,\"How to do this?\"]]],[1,\"p\",[[0,[],0,\"There are some very different approaches to gain this result:\"]]],[1,\"p\",[[0,[],0,\"a) Do no use Vue or Meteor and operate directly on DOM\"]]],[1,\"p\",[[0,[],0,\"b) Use EventBus known from Vue to emit and listen event\"]]],[1,\"p\",[[0,[],0,\"c) Use Vuex that allow many components to operate on global state\"]]],[1,\"p\",[[0,[],0,\"d) Use Meteor Tracker to recalculate property in second component\"]]],[1,\"p\",[[0,[],0,\"e) Use Minimongo and \"],[0,[0],1,\"vue-meteor-tracker\"],[0,[],0,\" package\"]]],[1,\"p\",[[0,[],0,\"Below we show examples of application any of these methods and describe their pros and cons.\"]]],[1,\"p\",[[0,[],0,\"Full repository with all these method can be found there: \"],[0,[1],1,\"https://github.com/gustawdaniel/vue-meteor-components-communication-tutorial\"]]],[1,\"h2\",[[0,[],0,\"How to integrate Vue with Meteor?\"]]],[1,\"p\",[[0,[],0,\"We assume that you can create meteor project with Vue. If not then after on standard meteor project created by\"]]],[10,0],[1,\"p\",[[0,[],0,\"you should use commands:\"]]],[10,1],[1,\"p\",[[0,[],0,\"Replace \"],[0,[2],1,\"/client/main.html\"],[0,[],0,\" by\"]]],[10,2],[1,\"p\",[[0,[],0,\"and \"],[0,[2],1,\"/client/main.js\"],[0,[],0,\" by\"]]],[10,3],[1,\"p\",[[0,[],0,\"Now in \"],[0,[2],1,\"/client/App.vue\"],[0,[],0,\" we can use standard Vue syntax like\"]]],[10,4],[1,\"p\",[[0,[],0,\"In following sections we can see results in table with applied spectre.css, but we will not discuss this. You can see how to use it following by commits in attached repository.\"]]],[1,\"h1\",[[0,[],0,\"Operation directly on DOM\"]]],[1,\"p\",[[0,[],0,\"In simplest cases when we do not want to operate on submitted data we can use old school direct dom modification. Listen on changes in first component, then select and directly modify \"],[0,[2],1,\"innerHTML\"],[0,[],0,\" of elements in other.\"]]],[10,5],[1,\"p\",[[0,[],0,\"To obtain this result we can write the following code in first component\"]]],[10,6],[1,\"p\",[[0,[],0,\"As you can see we listen on \"],[0,[2],1,\"keyup\"],[0,[],0,\" on input element and execute method \"],[0,[2],1,\"update\"],[0,[],0,\" that looking for \"],[0,[2],1,\"#dom-target\"],[0,[],0,\" and directly modify their content.\"]]],[1,\"p\",[[0,[],0,\"In second we do not want even JavaScript\"]]],[10,7],[1,\"p\",[[0,[],0,\"This method is\"]]],[3,\"ul\",[[[0,[],0,\"very simple\"]],[[0,[],0,\"easy to use and understand\"]],[[0,[],0,\"require small amount of code\"]]]],[1,\"p\",[[0,[],0,\"but have also drawbacks:\"]]],[3,\"ul\",[[[0,[],0,\"can cause hard to detect bugs\"]],[[0,[],0,\"wreck idea of independent components\"]],[[0,[],0,\"introduce global namespace of id or other constraining selectors\"]],[[0,[],0,\"we should avoid in bigger projects where many people collaborate\"]]]],[1,\"h1\",[[0,[],0,\"Use Event Bus\"]]],[1,\"p\",[[0,[],0,\"Concept of Event Bus relays on creation one (or many) independent globally available empty component that has only one task: emit and listen on events. This component can be injected to other components from our application and be used to signalize and invoke actions.\"]]],[10,8],[1,\"p\",[[0,[],0,\"Now out component initiating communication is more expanded\"]]],[10,9],[1,\"p\",[[0,[],0,\"We applied data property and use \"],[0,[2],1,\"$emit\"],[0,[],0,\" method on imported \"],[0,[2],1,\"EventBus\"],[0,[],0,\" to send signal. In component receiving we can use method \"],[0,[2],1,\"$on\"],[0,[],0,\" to listen on this.\"]]],[10,10],[1,\"p\",[[0,[],0,\"Advantages\"]]],[3,\"ul\",[[[0,[],0,\"no constrain of relative components position\"]],[[0,[],0,\"in more complex project you can use many EventBuses\"]]]],[1,\"p\",[[0,[],0,\"Disadvantages\"]]],[3,\"ul\",[[[0,[],0,\"you always should manually emit event\"]],[[0,[],0,\"you should remember to add this mechanism to any component that operate on these data\"]]]],[1,\"h2\",[[0,[],0,\"Vuex as global state of application\"]]],[1,\"p\",[[0,[],0,\"Idea of separated components has great influence on code clarity and possibility of maintain. But sometimes we have data that should be accessible in any component and we want to share these data deliberately. To achieve this goal we can use Vuex. Is it not part of core vue library but officially supported. We shoud install vuex by command:\"]]],[10,11],[1,\"p\",[[0,[],0,\"To make it working we should do some preparation before using \"],[0,[2],1,\"vuex\"],[0,[],0,\" in components. Firstly we should register it as package that we use. We can to it in file \"],[0,[2],1,\"/imports/client/plugins/vuex.js\"]]],[10,12],[1,\"p\",[[0,[],0,\"Next we should create global set of shared properties and method to change state of these values called \"],[0,[2],1,\"store\"],[0,[],0,\" . I propose create file \"],[0,[2],1,\"/imports/client/vuex/store.js\"],[0,[],0,\" with content\"]]],[10,13],[1,\"p\",[[0,[],0,\"You can see that our state contains \"],[0,[2],1,\"value\"],[0,[],0,\" and it can be “mutated” by function \"],[0,[2],1,\"update\"],[0,[],0,\" . But it is not all. We also should append both our plugin and store to \"],[0,[2],1,\"/client/main.js\"],[0,[],0,\" file. We can do this in following way\"]]],[10,14],[1,\"p\",[[0,[],0,\"You can see that \"],[0,[2],1,\"meteor-tracker\"],[0,[],0,\" is moved to depart file in the same way like \"],[0,[2],1,\"vuex\"],[0,[],0,\" , and in constructor of our \"],[0,[2],1,\"Vue\"],[0,[],0,\" object there is injected \"],[0,[2],1,\"store\"],[0,[],0,\" that we just defined.\"]]],[1,\"p\",[[0,[],0,\"Now we are prepared to use \"],[0,[2],1,\"vuex\"],[0,[],0,\" in our components. When we typing then update should commit mutation with name \"],[0,[2],1,\"update\"],[0,[],0,\" and send to their second argument value of our input.\"]]],[10,15],[1,\"p\",[[0,[],0,\"Store has defined behavior of this method. We know that it is setter of value property. And in second component we can simply get this value from vuex.\"]]],[10,16],[1,\"p\",[[0,[],0,\"Like in case with direct operation on dome we do not need additional JavaScript, but in this case it is achieved due to reactivity build in Vue.\"]]],[1,\"p\",[[0,[],0,\"Advantages:\"]]],[3,\"ul\",[[[0,[],0,\"Efficient for shared states\"]],[[0,[],0,\"Allow to create global rules of manipulating on shared resources\"]],[[0,[],0,\"Require small amount of code when is implemented\"]]]],[1,\"p\",[[0,[],0,\"Disadvantages:\"]]],[3,\"ul\",[[[0,[],0,\"Relatively hard to setup in compare to previous methods\"]],[[0,[],0,\"Need many components that use the same value to have sense of usage\"]]]],[1,\"h2\",[[0,[],0,\"Independent reactivity from Meteor tracker\"]]],[1,\"p\",[[0,[],0,\"You can see that we described three methods that we can use with Vue but without Meteor. Now We look at Meteor Tracker and see how to combine reactivity from meteor with reactivity from vue. Now idea is the following: create shared dependency like EventBus, import it in two components. In first send signal to recalculate any function dependent from this dependency, in second component create dependent function. To store data we will use \"],[0,[2],1,\"localStorage\"],[0,[],0,\" because of this is definitely non reactive storage of data and we show that thanks Tracker we can not worry about manner of storing (it could be external API), but only take care about where reactive data are changed and where they are used.\"]]],[1,\"p\",[[0,[],0,\"Lets start from creating dependency in file \"],[0,[2],1,\"/imports/client/Dependency.js\"]]],[10,17],[1,\"p\",[[0,[],0,\"Now we want to import this dependency and use on it method \"],[0,[2],1,\"changed()\"],[0,[],0,\" to signalize that any function dependent from this should be recalculated. Additionally we are saving value to \"],[0,[2],1,\"localStorage\"],[0,[],0,\" and clear \"],[0,[2],1,\"localStorage\"],[0,[],0,\" on create of this component to avoid caching value between browser refreshes.\"]]],[10,18],[1,\"p\",[[0,[],0,\"In second component we have standard \"],[0,[2],1,\"data()\"],[0,[],0,\" function but on created there is registered \"],[0,[2],1,\"autorun\"],[0,[],0,\" Tracker’s method. This method will be called always if any reactive (from Meteor point of view) variable inside of his function changed. By typing \"],[0,[2],1,\"dependency.depend()\"],[0,[],0,\" we command Meteor to recompute this function in any case when \"],[0,[2],1,\"dependency.changed()\"],[0,[],0,\" is invoked.\"]]],[10,19],[1,\"p\",[[0,[],0,\"Sometimes we want to communicate Meteor’s data with Vue data. Because of theirs reactivity are build on different technologies Meteor Tracker is point where they can meet and interact with each others.\"]]],[1,\"p\",[[0,[],0,\"Disadvantages:\"]]],[3,\"ul\",[[[0,[],0,\"Tracker is no such well known like other pure Vue methods\"]],[[0,[],0,\"If there are many points of update, you should remember about invoking \"],[0,[2],1,\"changed\"],[0,[],0,\" in any of them\"]]]],[1,\"p\",[[0,[],0,\"Advantages:\"]]],[3,\"ul\",[[[0,[],0,\"Allow to very custom integration with Meteor, more flexible than \"],[0,[2],1,\"vue-meteor-tracker\"],[0,[],0,\" package.\"]]]],[1,\"h2\",[[0,[],0,\"Automated tracking by vue-meteor-tracker package\"]]],[1,\"p\",[[0,[],0,\"One of most comfortable solution is usage \"],[0,[2],1,\"vue-meteor-tracker\"],[0,[],0,\" . In contrast to last example we need reactive (from Meteor perspective) resource. Thank to usage reactive variables we can automate process of sending signal about changing data to dependent functions. We can use Mini Mongo collection that simulate Mongo collection but lives only on front-end without connection with back-end. Of course real Mongo collection can be used too, but we chose Mini Mongo for simplicity. Lets create collection in\"],[0,[2],1,\"/imports/client/Values.js\"]]],[10,20],[1,\"p\",[[0,[],0,\"Now in input component we want to upsert data to this collection like the following:\"]]],[10,21],[1,\"p\",[[0,[],0,\"There are \"],[0,[2],1,\"upserts\"],[0,[],0,\" on create of component and on update of input. Now in component that present data we can have code with \"],[0,[2],1,\"meteor\"],[0,[],0,\" property of \"],[0,[2],1,\"Vue\"],[0,[],0,\" component provided by \"],[0,[2],1,\"vue-meteor-tracker\"],[0,[],0,\" package.\"]]],[10,22],[1,\"p\",[[0,[],0,\"This property allow to define functions that are reactive in two ways. These functions are invoked by changes of variables reactive for Meteor but they return values reactive for Vue. Due this fact we do not have any listener. Only pure logic of saving data to reactive Meteor collection in first component and returning value from reactive for Meteor cursor in second component. \"],[0,[2],1,\"Vue-meteor-tracker\"],[0,[],0,\" transform this reactivity to Vue reactivity and \"],[0,[2],1,\"valueObject\"],[0,[],0,\" can be treated in second component like property returned by \"],[0,[2],1,\"data()\"],[0,[],0,\" method.\"]]],[1,\"p\",[[0,[],0,\"Disadvantages:\"]]],[3,\"ul\",[[[0,[],0,\"you should learn and relay on external additional package\"]],[[0,[],0,\"there is some problems with dynamic changing subscription parameters\"]]]],[1,\"p\",[[0,[],0,\"Advantages\"]]],[3,\"ul\",[[[0,[],0,\"package is well documented\"]],[[0,[],0,\"intuitive and easy to use\"]],[[0,[],0,\"always used when you want to integrate Meteor with Vue\"]]]],[1,\"h1\",[[0,[],0,\"Summary\"]]],[1,\"p\",[[0,[],0,\"We presented some methods of communicating components. Some of them are universal, two last methods are typical for \"],[0,[2],1,\"vue-meteor\"],[0,[],0,\" integration. There is not best or worse. You will create best code if you will know and understood all and select right one in dependent from your needs.\"]]],[10,23],[1,\"p\",[[0,[],0,\"If you want to add method that I forgot or see other thing to improve do not hesitate and let mention about it in comment.\"]]],[1,\"p\",[[0,[],0,\"Sources:\"]]],[1,\"p\",[[0,[],0,\"Custom events in Vue\"]]],[1,\"blockquote\",[[0,[3],1,\"https://vuejs.org/v2/guide/components-custom-events.html\"]]],[1,\"p\",[[0,[],0,\"Vuex official guide\"]]],[1,\"blockquote\",[[0,[4],1,\"https://vuex.vuejs.org/guide/\"]]],[1,\"p\",[[0,[],0,\"Meteor Tracker Docs\"]]],[1,\"blockquote\",[[0,[5],1,\"https://docs.meteor.com/api/tracker.html\"]]],[1,\"p\",[[0,[],0,\"Vue Meteor Tracker\"]]],[1,\"blockquote\",[[0,[0],1,\"https://github.com/meteor-vue/vue-meteor-tracker\"]]],[1,\"p\",[[0,[],0,\"This blog post is published also there:\"]]],[10,24],[1,\"p\",[]]],\"ghostVersion\":\"4.0\"}","html":"<h2 id=\"what-we-have-and-what-we-want\">What we have and what we want?</h2><p>Lets consider the following situation.</p><ol><li>We have Meteor project with Vue</li><li>We have two components that use the same data</li><li>We want to observe changes made in one component in another</li></ol><h2 id=\"how-to-do-this\">How to do this?</h2><p>There are some very different approaches to gain this result:</p><p>a) Do no use Vue or Meteor and operate directly on DOM</p><p>b) Use EventBus known from Vue to emit and listen event</p><p>c) Use Vuex that allow many components to operate on global state</p><p>d) Use Meteor Tracker to recalculate property in second component</p><p>e) Use Minimongo and <a href=\"https://github.com/meteor-vue/vue-meteor-tracker\" rel=\"noopener nofollow\">vue-meteor-tracker</a> package</p><p>Below we show examples of application any of these methods and describe their pros and cons.</p><p>Full repository with all these method can be found there: <a href=\"https://github.com/gustawdaniel/vue-meteor-components-communication-tutorial\" rel=\"noopener nofollow\">https://github.com/gustawdaniel/vue-meteor-components-communication-tutorial</a></p><h2 id=\"how-to-integrate-vue-with-meteor\">How to integrate Vue with Meteor?</h2><p>We assume that you can create meteor project with Vue. If not then after on standard meteor project created by</p><pre><code>meteor create .</code></pre><p>you should use commands:</p><pre><code>meteor remove autopublish insecure blaze-html-templates\nmeteor add akryum:vue-component static-html\nmeteor npm install --save vue-meteor-tracker vue</code></pre><p>Replace <code>/client/main.html</code> by</p><pre><code>&lt;head&gt;\n   &lt;title&gt;Components communication&lt;/title&gt;\n&lt;/head&gt;\n&lt;body&gt;\n   &lt;div id=\"app\"&gt;&lt;/div&gt;\n&lt;/body&gt;</code></pre><p>and <code>/client/main.js</code> by</p><pre><code>import Vue from 'vue';\n\nimport VueMeteorTracker from 'vue-meteor-tracker';   // here!\nVue.use(VueMeteorTracker);                           // here!\n\nimport App from './App.vue';\n\nMeteor.startup(() =&gt; {\n  new Vue({\n    el: '#app',\n    render: h =&gt; h(App)\n  });\n});</code></pre><p>Now in <code>/client/App.vue</code> we can use standard Vue syntax like</p><pre><code>&lt;template&gt;\n    &lt;h1&gt;App&lt;/h1&gt;\n&lt;/template&gt;\n\n&lt;script&gt;\n    export default {\n        name: \"App\"\n    }\n&lt;/script&gt;</code></pre><p>In following sections we can see results in table with applied spectre.css, but we will not discuss this. You can see how to use it following by commits in attached repository.</p><h1 id=\"operation-directly-on-dom\">Operation directly on DOM</h1><p>In simplest cases when we do not want to operate on submitted data we can use old school direct dom modification. Listen on changes in first component, then select and directly modify <code>innerHTML</code> of elements in other.</p><figure class=\"kg-card kg-image-card\"><img src=\"__GHOST_URL__/content/images/2021/04/1_8pl-wsHGBftLFxMOiyBZXA.gif\" class=\"kg-image\" alt loading=\"lazy\" width=\"701\" height=\"103\"></figure><p>To obtain this result we can write the following code in first component</p><pre><code>&lt;template&gt;\n\n    &lt;input class=\"form-input\" type=\"text\" ref=\"input\" @keyup=\"update\"&gt;\n\n&lt;/template&gt;\n\n&lt;script&gt;\n    export default {\n        methods: {\n            update() {\n                document.querySelector('#dom-target').innerHTML = this.$refs.input.value; // result of selector could be cached\n            }\n        }\n    }\n&lt;/script&gt;</code></pre><p>As you can see we listen on <code>keyup</code> on input element and execute method <code>update</code> that looking for <code>#dom-target</code> and directly modify their content.</p><p>In second we do not want even JavaScript</p><pre><code>&lt;template&gt;\n\n    &lt;p class=\"m-2\" id=\"dom-target\"&gt;&lt;/p&gt;\n\n&lt;/template&gt;\n</code></pre><p>This method is</p><ul><li>very simple</li><li>easy to use and understand</li><li>require small amount of code</li></ul><p>but have also drawbacks:</p><ul><li>can cause hard to detect bugs</li><li>wreck idea of independent components</li><li>introduce global namespace of id or other constraining selectors</li><li>we should avoid in bigger projects where many people collaborate</li></ul><h1 id=\"use-event-bus\">Use Event Bus</h1><p>Concept of Event Bus relays on creation one (or many) independent globally available empty component that has only one task: emit and listen on events. This component can be injected to other components from our application and be used to signalize and invoke actions.</p><pre><code>import Vue from 'vue';\n\nexport default new Vue();</code></pre><p>Now out component initiating communication is more expanded</p><pre><code>&lt;template&gt;\n\n    &lt;input class=\"form-input\" type=\"text\" v-model=\"value\" @keyup=\"update\"&gt;\n\n&lt;/template&gt;\n\n&lt;script&gt;\n    import EventBus from '../../EventBus';\n\n    export default {\n        data() {\n            return { value: null }\n        },\n        methods: {\n            update() {\n                EventBus.$emit('update', this.value)\n            }\n        }\n    }\n&lt;/script&gt;</code></pre><p>We applied data property and use <code>$emit</code> method on imported <code>EventBus</code> to send signal. In component receiving we can use method <code>$on</code> to listen on this.</p><pre><code>&lt;template&gt;\n\n    &lt;p class=\"m-2\" id=\"dom-target\"&gt;{{value}}&lt;/p&gt;\n\n&lt;/template&gt;\n\n&lt;script&gt;\n    import EventBus from '../../EventBus';\n\n    export default {\n        data() {\n            return {\n                value: null\n            }\n        },\n        mounted() {\n            EventBus.$on('update', (value) =&gt; {\n                this.value = value;\n            })\n        }\n    }\n&lt;/script&gt;</code></pre><p>Advantages</p><ul><li>no constrain of relative components position</li><li>in more complex project you can use many EventBuses</li></ul><p>Disadvantages</p><ul><li>you always should manually emit event</li><li>you should remember to add this mechanism to any component that operate on these data</li></ul><h2 id=\"vuex-as-global-state-of-application\">Vuex as global state of application</h2><p>Idea of separated components has great influence on code clarity and possibility of maintain. But sometimes we have data that should be accessible in any component and we want to share these data deliberately. To achieve this goal we can use Vuex. Is it not part of core vue library but officially supported. We shoud install vuex by command:</p><pre><code>npm install vuex --save</code></pre><p>To make it working we should do some preparation before using <code>vuex</code> in components. Firstly we should register it as package that we use. We can to it in file <code>/imports/client/plugins/vuex.js</code></p><pre><code>import Vue from 'vue'\nimport Vuex from 'vuex'\n\nVue.use(Vuex);</code></pre><p>Next we should create global set of shared properties and method to change state of these values called <code>store</code> . I propose create file <code>/imports/client/vuex/store.js</code> with content</p><pre><code>import Vuex from 'vuex'\n\nexport default new Vuex.Store({\n    state: {\n        value: null\n    },\n    mutations: {\n        update (state, value) {\n            state.value = value;\n        }\n    }\n});</code></pre><p>You can see that our state contains <code>value</code> and it can be “mutated” by function <code>update</code> . But it is not all. We also should append both our plugin and store to <code>/client/main.js</code> file. We can do this in following way</p><pre><code>import Vue from 'vue';\n\nimport '../imports/client/plugins/tracker'\nimport '../imports/client/plugins/vuex'\nimport store from '../imports/client/vuex/store';\n\nimport App from '../imports/client/ui/App.vue';\n\nMeteor.startup(() =&gt; {\n  new Vue({\n    el: '#app',\n    store,\n    render: h =&gt; h(App)\n  });\n});</code></pre><p>You can see that <code>meteor-tracker</code> is moved to depart file in the same way like <code>vuex</code> , and in constructor of our <code>Vue</code> object there is injected <code>store</code> that we just defined.</p><p>Now we are prepared to use <code>vuex</code> in our components. When we typing then update should commit mutation with name <code>update</code> and send to their second argument value of our input.</p><pre><code>&lt;template&gt;\n\n    &lt;input class=\"form-input\" type=\"text\" @keyup=\"update\"&gt;\n\n&lt;/template&gt;\n\n&lt;script&gt;\n    export default {\n        methods: {\n            update(event) {\n                this.$store.commit('update', event.target.value)\n            }\n        }\n    }\n&lt;/script&gt;</code></pre><p>Store has defined behavior of this method. We know that it is setter of value property. And in second component we can simply get this value from vuex.</p><pre><code>&lt;template&gt;\n\n    &lt;p class=\"m-2\" id=\"dom-target\"&gt;{{$store.state.value}}&lt;/p&gt;\n\n&lt;/template&gt;</code></pre><p>Like in case with direct operation on dome we do not need additional JavaScript, but in this case it is achieved due to reactivity build in Vue.</p><p>Advantages:</p><ul><li>Efficient for shared states</li><li>Allow to create global rules of manipulating on shared resources</li><li>Require small amount of code when is implemented</li></ul><p>Disadvantages:</p><ul><li>Relatively hard to setup in compare to previous methods</li><li>Need many components that use the same value to have sense of usage</li></ul><h2 id=\"independent-reactivity-from-meteor-tracker\">Independent reactivity from Meteor tracker</h2><p>You can see that we described three methods that we can use with Vue but without Meteor. Now We look at Meteor Tracker and see how to combine reactivity from meteor with reactivity from vue. Now idea is the following: create shared dependency like EventBus, import it in two components. In first send signal to recalculate any function dependent from this dependency, in second component create dependent function. To store data we will use <code>localStorage</code> because of this is definitely non reactive storage of data and we show that thanks Tracker we can not worry about manner of storing (it could be external API), but only take care about where reactive data are changed and where they are used.</p><p>Lets start from creating dependency in file <code>/imports/client/Dependency.js</code></p><pre><code>export default new Tracker.Dependency;\n</code></pre><p>Now we want to import this dependency and use on it method <code>changed()</code> to signalize that any function dependent from this should be recalculated. Additionally we are saving value to <code>localStorage</code> and clear <code>localStorage</code> on create of this component to avoid caching value between browser refreshes.</p><pre><code>&lt;template&gt;\n\n    &lt;input class=\"form-input\" type=\"text\" @keyup=\"update\"&gt;\n\n&lt;/template&gt;\n\n&lt;script&gt;\n    import dependency from '../../Dependency';\n\n    export default {\n        methods: {\n            update(event) {\n                window.localStorage.setItem('value', event.target.value);\n                dependency.changed();\n            }\n        },\n        created() {\n            window.localStorage.clear();\n        }\n    }\n&lt;/script&gt;</code></pre><p>In second component we have standard <code>data()</code> function but on created there is registered <code>autorun</code> Tracker’s method. This method will be called always if any reactive (from Meteor point of view) variable inside of his function changed. By typing <code>dependency.depend()</code> we command Meteor to recompute this function in any case when <code>dependency.changed()</code> is invoked.</p><pre><code>&lt;template&gt;\n\n    &lt;p class=\"m-2\" id=\"dom-target\"&gt;{{value}}&lt;/p&gt;\n\n&lt;/template&gt;\n\n&lt;script&gt;\n    import dependency from '../../Dependency';\n\n    export default {\n        data() {\n            return {\n                value: null\n            }\n        },\n        created() {\n            Tracker.autorun(() =&gt; {\n                dependency.depend();\n                this.value = window.localStorage.getItem('value');\n            });\n        }\n    }\n&lt;/script&gt;</code></pre><p>Sometimes we want to communicate Meteor’s data with Vue data. Because of theirs reactivity are build on different technologies Meteor Tracker is point where they can meet and interact with each others.</p><p>Disadvantages:</p><ul><li>Tracker is no such well known like other pure Vue methods</li><li>If there are many points of update, you should remember about invoking <code>changed</code> in any of them</li></ul><p>Advantages:</p><ul><li>Allow to very custom integration with Meteor, more flexible than <code>vue-meteor-tracker</code> package.</li></ul><h2 id=\"automated-tracking-by-vue-meteor-tracker-package\">Automated tracking by vue-meteor-tracker package</h2><p>One of most comfortable solution is usage <code>vue-meteor-tracker</code> . In contrast to last example we need reactive (from Meteor perspective) resource. Thank to usage reactive variables we can automate process of sending signal about changing data to dependent functions. We can use Mini Mongo collection that simulate Mongo collection but lives only on front-end without connection with back-end. Of course real Mongo collection can be used too, but we chose Mini Mongo for simplicity. Lets create collection in<code>/imports/client/Values.js</code></p><pre><code>export const Values = new Mongo.Collection(null);\n</code></pre><p>Now in input component we want to upsert data to this collection like the following:</p><pre><code>&lt;template&gt;\n\n    &lt;input class=\"form-input\" type=\"text\" @keyup=\"update\"&gt;\n\n&lt;/template&gt;\n\n&lt;script&gt;\n    import { Values } from '../../Values';\n\n    export default {\n        methods: {\n            update(event) {\n                Values.upsert('value', {$set: {value: event.target.value}})\n            }\n        },\n        created() {\n            Values.upsert('value', {$set: {value: null}});\n        }\n    }\n&lt;/script&gt;</code></pre><p>There are <code>upserts</code> on create of component and on update of input. Now in component that present data we can have code with <code>meteor</code> property of <code>Vue</code> component provided by <code>vue-meteor-tracker</code> package.</p><pre><code>&lt;template&gt;\n\n    &lt;p class=\"m-2\"&gt;{{valueObject.value}}&lt;/p&gt;\n\n&lt;/template&gt;\n\n&lt;script&gt;\n    import { Values } from '../../Values';\n\n    export default {\n        meteor: {\n            valueObject() {\n                return Values.findOne('value');\n            }\n        }\n    }\n&lt;/script&gt;</code></pre><p>This property allow to define functions that are reactive in two ways. These functions are invoked by changes of variables reactive for Meteor but they return values reactive for Vue. Due this fact we do not have any listener. Only pure logic of saving data to reactive Meteor collection in first component and returning value from reactive for Meteor cursor in second component. <code>Vue-meteor-tracker</code> transform this reactivity to Vue reactivity and <code>valueObject</code> can be treated in second component like property returned by <code>data()</code> method.</p><p>Disadvantages:</p><ul><li>you should learn and relay on external additional package</li><li>there is some problems with dynamic changing subscription parameters</li></ul><p>Advantages</p><ul><li>package is well documented</li><li>intuitive and easy to use</li><li>always used when you want to integrate Meteor with Vue</li></ul><h1 id=\"summary\">Summary</h1><p>We presented some methods of communicating components. Some of them are universal, two last methods are typical for <code>vue-meteor</code> integration. There is not best or worse. You will create best code if you will know and understood all and select right one in dependent from your needs.</p><figure class=\"kg-card kg-image-card kg-card-hascaption\"><img src=\"__GHOST_URL__/content/images/2021/04/1_m73DyRU5IRqiUrZa6pIgkQ.png\" class=\"kg-image\" alt loading=\"lazy\" width=\"687\" height=\"293\" srcset=\"__GHOST_URL__/content/images/size/w600/2021/04/1_m73DyRU5IRqiUrZa6pIgkQ.png 600w, __GHOST_URL__/content/images/2021/04/1_m73DyRU5IRqiUrZa6pIgkQ.png 687w\"><figcaption>All methods presented in this article with input and output components.</figcaption></figure><p>If you want to add method that I forgot or see other thing to improve do not hesitate and let mention about it in comment.</p><p>Sources:</p><p>Custom events in Vue</p><blockquote><a href=\"https://vuejs.org/v2/guide/components-custom-events.html\" rel=\"noopener nofollow\">https://vuejs.org/v2/guide/components-custom-events.html</a></blockquote><p>Vuex official guide</p><blockquote><a href=\"https://vuex.vuejs.org/guide/\" rel=\"noopener nofollow\">https://vuex.vuejs.org/guide/</a></blockquote><p>Meteor Tracker Docs</p><blockquote><a href=\"https://docs.meteor.com/api/tracker.html\" rel=\"noopener nofollow\">https://docs.meteor.com/api/tracker.html</a></blockquote><p>Vue Meteor Tracker</p><blockquote><a href=\"https://github.com/meteor-vue/vue-meteor-tracker\" rel=\"noopener nofollow\">https://github.com/meteor-vue/vue-meteor-tracker</a></blockquote><p>This blog post is published also there:</p><figure class=\"kg-card kg-bookmark-card\"><a class=\"kg-bookmark-container\" href=\"https://medium.com/@gustaw.daniel/communication-between-vue-components-in-meteor-29006be3dae9\"><div class=\"kg-bookmark-content\"><div class=\"kg-bookmark-title\">Communication between Vue components in Meteor</div><div class=\"kg-bookmark-description\">Full repository with all these method can be found there: https://github.com/gustawdaniel/vue-meteor-components-communication-tutorial We assume that you can create meteor project with Vue. If not…</div><div class=\"kg-bookmark-metadata\"><img class=\"kg-bookmark-icon\" src=\"https://miro.medium.com/fit/c/152/152/1*sHhtYhaCe2Uc3IU0IgKwIQ.png\"><span class=\"kg-bookmark-author\">Medium</span><span class=\"kg-bookmark-publisher\">Daniel Gustaw</span></div></div><div class=\"kg-bookmark-thumbnail\"><img src=\"https://miro.medium.com/max/687/1*m73DyRU5IRqiUrZa6pIgkQ.png\"></div></a></figure>","comment_id":"607f40615d6c891ac9aa7404","plaintext":"What we have and what we want?\nLets consider the following situation.\n\n 1. We have Meteor project with Vue\n 2. We have two components that use the same data\n 3. We want to observe changes made in one component in another\n\nHow to do this?\nThere are some very different approaches to gain this result:\n\na) Do no use Vue or Meteor and operate directly on DOM\n\nb) Use EventBus known from Vue to emit and listen event\n\nc) Use Vuex that allow many components to operate on global state\n\nd) Use Meteor Tracker to recalculate property in second component\n\ne) Use Minimongo and vue-meteor-tracker\n[https://github.com/meteor-vue/vue-meteor-tracker] package\n\nBelow we show examples of application any of these methods and describe their\npros and cons.\n\nFull repository with all these method can be found there: \nhttps://github.com/gustawdaniel/vue-meteor-components-communication-tutorial\n\nHow to integrate Vue with Meteor?\nWe assume that you can create meteor project with Vue. If not then after on\nstandard meteor project created by\n\nmeteor create .\n\nyou should use commands:\n\nmeteor remove autopublish insecure blaze-html-templates\nmeteor add akryum:vue-component static-html\nmeteor npm install --save vue-meteor-tracker vue\n\nReplace /client/main.html by\n\n<head>\n   <title>Components communication</title>\n</head>\n<body>\n   <div id=\"app\"></div>\n</body>\n\nand /client/main.js by\n\nimport Vue from 'vue';\n\nimport VueMeteorTracker from 'vue-meteor-tracker';   // here!\nVue.use(VueMeteorTracker);                           // here!\n\nimport App from './App.vue';\n\nMeteor.startup(() => {\n  new Vue({\n    el: '#app',\n    render: h => h(App)\n  });\n});\n\nNow in /client/App.vue we can use standard Vue syntax like\n\n<template>\n    <h1>App</h1>\n</template>\n\n<script>\n    export default {\n        name: \"App\"\n    }\n</script>\n\nIn following sections we can see results in table with applied spectre.css, but\nwe will not discuss this. You can see how to use it following by commits in\nattached repository.\n\nOperation directly on DOM\nIn simplest cases when we do not want to operate on submitted data we can use\nold school direct dom modification. Listen on changes in first component, then\nselect and directly modify innerHTML of elements in other.\n\nTo obtain this result we can write the following code in first component\n\n<template>\n\n    <input class=\"form-input\" type=\"text\" ref=\"input\" @keyup=\"update\">\n\n</template>\n\n<script>\n    export default {\n        methods: {\n            update() {\n                document.querySelector('#dom-target').innerHTML = this.$refs.input.value; // result of selector could be cached\n            }\n        }\n    }\n</script>\n\nAs you can see we listen on keyup on input element and execute method update \nthat looking for #dom-target and directly modify their content.\n\nIn second we do not want even JavaScript\n\n<template>\n\n    <p class=\"m-2\" id=\"dom-target\"></p>\n\n</template>\n\n\nThis method is\n\n * very simple\n * easy to use and understand\n * require small amount of code\n\nbut have also drawbacks:\n\n * can cause hard to detect bugs\n * wreck idea of independent components\n * introduce global namespace of id or other constraining selectors\n * we should avoid in bigger projects where many people collaborate\n\nUse Event Bus\nConcept of Event Bus relays on creation one (or many) independent globally\navailable empty component that has only one task: emit and listen on events.\nThis component can be injected to other components from our application and be\nused to signalize and invoke actions.\n\nimport Vue from 'vue';\n\nexport default new Vue();\n\nNow out component initiating communication is more expanded\n\n<template>\n\n    <input class=\"form-input\" type=\"text\" v-model=\"value\" @keyup=\"update\">\n\n</template>\n\n<script>\n    import EventBus from '../../EventBus';\n\n    export default {\n        data() {\n            return { value: null }\n        },\n        methods: {\n            update() {\n                EventBus.$emit('update', this.value)\n            }\n        }\n    }\n</script>\n\nWe applied data property and use $emit method on imported EventBus to send\nsignal. In component receiving we can use method $on to listen on this.\n\n<template>\n\n    <p class=\"m-2\" id=\"dom-target\">{{value}}</p>\n\n</template>\n\n<script>\n    import EventBus from '../../EventBus';\n\n    export default {\n        data() {\n            return {\n                value: null\n            }\n        },\n        mounted() {\n            EventBus.$on('update', (value) => {\n                this.value = value;\n            })\n        }\n    }\n</script>\n\nAdvantages\n\n * no constrain of relative components position\n * in more complex project you can use many EventBuses\n\nDisadvantages\n\n * you always should manually emit event\n * you should remember to add this mechanism to any component that operate on\n   these data\n\nVuex as global state of application\nIdea of separated components has great influence on code clarity and possibility\nof maintain. But sometimes we have data that should be accessible in any\ncomponent and we want to share these data deliberately. To achieve this goal we\ncan use Vuex. Is it not part of core vue library but officially supported. We\nshoud install vuex by command:\n\nnpm install vuex --save\n\nTo make it working we should do some preparation before using vuex in\ncomponents. Firstly we should register it as package that we use. We can to it\nin file /imports/client/plugins/vuex.js\n\nimport Vue from 'vue'\nimport Vuex from 'vuex'\n\nVue.use(Vuex);\n\nNext we should create global set of shared properties and method to change state\nof these values called store . I propose create file \n/imports/client/vuex/store.js with content\n\nimport Vuex from 'vuex'\n\nexport default new Vuex.Store({\n    state: {\n        value: null\n    },\n    mutations: {\n        update (state, value) {\n            state.value = value;\n        }\n    }\n});\n\nYou can see that our state contains value and it can be “mutated” by function \nupdate . But it is not all. We also should append both our plugin and store to \n/client/main.js file. We can do this in following way\n\nimport Vue from 'vue';\n\nimport '../imports/client/plugins/tracker'\nimport '../imports/client/plugins/vuex'\nimport store from '../imports/client/vuex/store';\n\nimport App from '../imports/client/ui/App.vue';\n\nMeteor.startup(() => {\n  new Vue({\n    el: '#app',\n    store,\n    render: h => h(App)\n  });\n});\n\nYou can see that meteor-tracker is moved to depart file in the same way like \nvuex , and in constructor of our Vue object there is injected store that we just\ndefined.\n\nNow we are prepared to use vuex in our components. When we typing then update\nshould commit mutation with name update and send to their second argument value\nof our input.\n\n<template>\n\n    <input class=\"form-input\" type=\"text\" @keyup=\"update\">\n\n</template>\n\n<script>\n    export default {\n        methods: {\n            update(event) {\n                this.$store.commit('update', event.target.value)\n            }\n        }\n    }\n</script>\n\nStore has defined behavior of this method. We know that it is setter of value\nproperty. And in second component we can simply get this value from vuex.\n\n<template>\n\n    <p class=\"m-2\" id=\"dom-target\">{{$store.state.value}}</p>\n\n</template>\n\nLike in case with direct operation on dome we do not need additional JavaScript,\nbut in this case it is achieved due to reactivity build in Vue.\n\nAdvantages:\n\n * Efficient for shared states\n * Allow to create global rules of manipulating on shared resources\n * Require small amount of code when is implemented\n\nDisadvantages:\n\n * Relatively hard to setup in compare to previous methods\n * Need many components that use the same value to have sense of usage\n\nIndependent reactivity from Meteor tracker\nYou can see that we described three methods that we can use with Vue but without\nMeteor. Now We look at Meteor Tracker and see how to combine reactivity from\nmeteor with reactivity from vue. Now idea is the following: create shared\ndependency like EventBus, import it in two components. In first send signal to\nrecalculate any function dependent from this dependency, in second component\ncreate dependent function. To store data we will use localStorage because of\nthis is definitely non reactive storage of data and we show that thanks Tracker\nwe can not worry about manner of storing (it could be external API), but only\ntake care about where reactive data are changed and where they are used.\n\nLets start from creating dependency in file /imports/client/Dependency.js\n\nexport default new Tracker.Dependency;\n\n\nNow we want to import this dependency and use on it method changed() to\nsignalize that any function dependent from this should be recalculated.\nAdditionally we are saving value to localStorage and clear localStorage on\ncreate of this component to avoid caching value between browser refreshes.\n\n<template>\n\n    <input class=\"form-input\" type=\"text\" @keyup=\"update\">\n\n</template>\n\n<script>\n    import dependency from '../../Dependency';\n\n    export default {\n        methods: {\n            update(event) {\n                window.localStorage.setItem('value', event.target.value);\n                dependency.changed();\n            }\n        },\n        created() {\n            window.localStorage.clear();\n        }\n    }\n</script>\n\nIn second component we have standard data() function but on created there is\nregistered autorun Tracker’s method. This method will be called always if any\nreactive (from Meteor point of view) variable inside of his function changed. By\ntyping dependency.depend() we command Meteor to recompute this function in any\ncase when dependency.changed() is invoked.\n\n<template>\n\n    <p class=\"m-2\" id=\"dom-target\">{{value}}</p>\n\n</template>\n\n<script>\n    import dependency from '../../Dependency';\n\n    export default {\n        data() {\n            return {\n                value: null\n            }\n        },\n        created() {\n            Tracker.autorun(() => {\n                dependency.depend();\n                this.value = window.localStorage.getItem('value');\n            });\n        }\n    }\n</script>\n\nSometimes we want to communicate Meteor’s data with Vue data. Because of theirs\nreactivity are build on different technologies Meteor Tracker is point where\nthey can meet and interact with each others.\n\nDisadvantages:\n\n * Tracker is no such well known like other pure Vue methods\n * If there are many points of update, you should remember about invoking \n   changed in any of them\n\nAdvantages:\n\n * Allow to very custom integration with Meteor, more flexible than \n   vue-meteor-tracker package.\n\nAutomated tracking by vue-meteor-tracker package\nOne of most comfortable solution is usage vue-meteor-tracker . In contrast to\nlast example we need reactive (from Meteor perspective) resource. Thank to usage\nreactive variables we can automate process of sending signal about changing data\nto dependent functions. We can use Mini Mongo collection that simulate Mongo\ncollection but lives only on front-end without connection with back-end. Of\ncourse real Mongo collection can be used too, but we chose Mini Mongo for\nsimplicity. Lets create collection in/imports/client/Values.js\n\nexport const Values = new Mongo.Collection(null);\n\n\nNow in input component we want to upsert data to this collection like the\nfollowing:\n\n<template>\n\n    <input class=\"form-input\" type=\"text\" @keyup=\"update\">\n\n</template>\n\n<script>\n    import { Values } from '../../Values';\n\n    export default {\n        methods: {\n            update(event) {\n                Values.upsert('value', {$set: {value: event.target.value}})\n            }\n        },\n        created() {\n            Values.upsert('value', {$set: {value: null}});\n        }\n    }\n</script>\n\nThere are upserts on create of component and on update of input. Now in\ncomponent that present data we can have code with meteor property of Vue \ncomponent provided by vue-meteor-tracker package.\n\n<template>\n\n    <p class=\"m-2\">{{valueObject.value}}</p>\n\n</template>\n\n<script>\n    import { Values } from '../../Values';\n\n    export default {\n        meteor: {\n            valueObject() {\n                return Values.findOne('value');\n            }\n        }\n    }\n</script>\n\nThis property allow to define functions that are reactive in two ways. These\nfunctions are invoked by changes of variables reactive for Meteor but they\nreturn values reactive for Vue. Due this fact we do not have any listener. Only\npure logic of saving data to reactive Meteor collection in first component and\nreturning value from reactive for Meteor cursor in second component. \nVue-meteor-tracker transform this reactivity to Vue reactivity and valueObject \ncan be treated in second component like property returned by data() method.\n\nDisadvantages:\n\n * you should learn and relay on external additional package\n * there is some problems with dynamic changing subscription parameters\n\nAdvantages\n\n * package is well documented\n * intuitive and easy to use\n * always used when you want to integrate Meteor with Vue\n\nSummary\nWe presented some methods of communicating components. Some of them are\nuniversal, two last methods are typical for vue-meteor integration. There is not\nbest or worse. You will create best code if you will know and understood all and\nselect right one in dependent from your needs.\n\nAll methods presented in this article with input and output components.If you\nwant to add method that I forgot or see other thing to improve do not hesitate\nand let mention about it in comment.\n\nSources:\n\nCustom events in Vue\n\n> https://vuejs.org/v2/guide/components-custom-events.html\nVuex official guide\n\n> https://vuex.vuejs.org/guide/\nMeteor Tracker Docs\n\n> https://docs.meteor.com/api/tracker.html\nVue Meteor Tracker\n\n> https://github.com/meteor-vue/vue-meteor-tracker\nThis blog post is published also there:\n\nCommunication between Vue components in MeteorFull repository with all these\nmethod can be found there:\nhttps://github.com/gustawdaniel/vue-meteor-components-communication-tutorial We\nassume that you can create meteor project with Vue. If not…MediumDaniel Gustaw\n[https://medium.com/@gustaw.daniel/communication-between-vue-components-in-meteor-29006be3dae9]","feature_image":"__GHOST_URL__/content/images/2021/04/fmvuzlyiiygbhqwkzwmo.png","featured":0,"type":"post","status":"published","locale":null,"visibility":"public","email_recipient_filter":"all","created_at":"2021-04-20T20:58:09.000Z","updated_at":"2021-04-20T21:12:22.000Z","published_at":"2021-04-20T21:12:22.000Z","custom_excerpt":"There is few methods of sending data between unrelated vue components. Some of these are universal, other typical for vue, another for Meteor. We compare all of them. ","codeinjection_head":null,"codeinjection_foot":null,"custom_template":null,"canonical_url":null,"newsletter_id":null,"lexical":null},{"id":"607f47ff5d6c891ac9aa7469","uuid":"4a7eecfa-ed29-43a3-96e5-a76d31843032","title":"Fetch, Promise and Template String on example of To Do List in JavaScript","slug":"fetch-promise-and-template-string-on-example-of-to-do-list-in-javascript","mobiledoc":"{\"version\":\"0.3.1\",\"atoms\":[[\"soft-return\",\"\",{}]],\"cards\":[[\"image\",{\"src\":\"__GHOST_URL__/content/images/2021/04/1_qm93PtCN3Y0mZWzQrqVAFw--1-.png\",\"width\":666,\"height\":447,\"caption\":\"To Do List typed in pure JavaScript that will be presented in this article.\"}],[\"code\",{\"code\":\"wget -qO- https://github.com/gustawdaniel/simple-todo-app-js-tutorial/archive/1.0.tar.gz | tar xvz\"}],[\"code\",{\"code\":\"cd simple-todo-app-js-tutorial-1.0 \"}],[\"code\",{\"code\":\"npm i\"}],[\"code\",{\"code\":\"node node_modules/http-server/bin/http-server\"}],[\"code\",{\"code\":\"node node_modules/json-server/bin/index.js --watch db.json\"}],[\"image\",{\"src\":\"__GHOST_URL__/content/images/2021/04/1_PD3FHn76We8mFzIivvnpvg--1-.png\",\"width\":800,\"height\":264,\"caption\":\"Server with application (on the right) and with REST API connected with db.json file (on the left)\"}],[\"code\",{\"code\":\"├── app.js              // script providing creating, reading and deleting tasks\\n├── db.json             // json file with data that is connected with REST API\\n├── index.html          // html file with main page\\n├── LICENSE             // licencje WTFPL\\n├── package.json        // file with dependencies (servers: http and json)\\n├── README.md           // documentation for end user\\n└── style.css           // style\"}],[\"code\",{\"code\":\"<html>\\n<head>\\n    <link href=\\\"https://fonts.googleapis.com/css?family=Lato:300&amp;subset=latin-ext\\\" rel=\\\"stylesheet\\\">\\n    <link rel=\\\"stylesheet\\\" href=\\\"style.css\\\">\\n</head>\"}],[\"code\",{\"code\":\"<body>\\n<header>\\n    <form class=\\\"todo\\\">\\n        <input name=\\\"task\\\" type=\\\"text\\\" placeholder=\\\"Type text to add note\\\">\\n    </form>\\n</header>\"}],[\"code\",{\"code\":\"<main>\\n  <ul>\\n    <li data-id=\\\"1\\\">\\n      <div class=\\\"list-elem-head\\\">\\n          <span class=\\\"id\\\">1</span>\\n      </div>\\n      <div class=\\\"list-elem-body\\\">\\n          <span class=\\\"text\\\">First One</span>\\n          <span class=\\\"delete\\\">x</span>\\n      </div>\\n    </li>\\n    <li data-id=\\\"2\\\">\\n      <div class=\\\"list-elem-head\\\">\\n          <span class=\\\"id\\\">2</span>\\n      </div>\\n      <div class=\\\"list-elem-body\\\">\\n          <span class=\\\"text\\\">Second todo</span>\\n          <span class=\\\"delete\\\">x</span>\\n      </div>\\n    </li>\\n    <li data-id=\\\"5\\\">\\n      <div class=\\\"list-elem-head\\\">\\n          <span class=\\\"id\\\">5</span>\\n      </div>\\n      <div class=\\\"list-elem-body\\\">\\n          <span class=\\\"text\\\">At vero eos et accusamus et iusto odio dignissimos ducimus qui blanditiis praesentium voluptatum deleniti atque corrupti quos dolores et quas molestias excepturi sint occaecati cupiditate non provident, similique sunt in culpa qui officia deserunt mollitia animi, id est laborum et dolorum fuga. Et harum quidem rerum facilis est et expedita distinctio. Nam libero tempore, cum soluta nobis est eligendi optio cumque nihil impedit quo minus id quod maxime placeat facere possimus, omnis voluptas assumenda est, omnis dolor repellendus. Temporibus autem quibusdam et aut officiis debitis aut rerum necessitatibus saepe eveniet ut et voluptates repudiandae sint et molestiae non recusandae. Itaque earum rerum hic tenetur a sapiente delectus, ut aut reiciendis voluptatibus maiores alias consequatur aut perferendis doloribus asperiores repellat.</span>\\n          <span class=\\\"delete\\\">x</span>\\n      </div>\\n    </li>\\n  </ul>\\n</main>\"}],[\"code\",{\"code\":\"<script src=\\\"app.js\\\"></script>\\n</body>\\n</html>\"}],[\"code\",{\"code\":\"@media (max-width: 575px) {\\n    input,main {\\n        width: 100%;\\n    }\\n}\\n@media (min-width: 576px) {\\n    input,main {\\n        width: 80%;\\n    }\\n    main {\\n        margin-left: 10%;\\n    }\\n}\"}],[\"code\",{\"code\":\"body {\\n    font-family: 'Lato', sans-serif;\\n}\"}],[\"code\",{\"code\":\"header {\\n    text-align: center;\\n}\\nform {\\n    margin: 0;\\n}\"}],[\"code\",{\"code\":\"input:focus, input:hover {\\n    border: solid 1px crimson;\\n    box-shadow: 0 0 5px -1px crimson;\\n    background-color: rgba(220, 20, 60, 0.05);\\n}\"}],[\"code\",{\"code\":\"input {\\n    padding: 20px;\\n    border: solid 1px rgba(220, 20, 60, 0.52);\\n    margin: 10px 0;\\n    transition: box-shadow 1s, background-color 2s;\\n}\"}],[\"code\",{\"code\":\"li:hover {\\n    border: solid 1px rgba(220, 20, 60, 0.8);\\n    background-color: rgba(220, 20, 60, 0.05);\\n    box-shadow: 0 0 2px -1px crimson;\\n    margin: 3px 0 3px 10px;\\n}\"}],[\"code\",{\"code\":\"li {\\n    list-style: none;\\n    border: solid 1px rgba(220, 20, 60, 0.52);\\n    margin: 3px 0;\\n    color: gray;\\n    transition: margin 0.5s, background-color 2s;\\n}\"}],[\"code\",{\"code\":\".list-elem-head {\\n    float: left;\\n    margin: 20px;\\n}\"}],[\"code\",{\"code\":\".list-elem-body {\\n    margin-left: 50px;\\n    padding: 20px 20px 20px 20px;\\n    border-left: solid 1px rgba(220, 20, 60, 0.52);\\n}\"}],[\"code\",{\"code\":\"ul {\\n    margin: 0;\\n    padding: 0;\\n}\"}],[\"code\",{\"code\":\"li > span.text {\\n    padding-right: 20px;\\n}\"}],[\"code\",{\"code\":\"li > div > span.delete {\\n    float: right;\\n    border: solid 1px crimson;\\n    border-radius: 50%;\\n    padding: 5px;\\n    width: 7px;\\n    height: 7px;\\n    line-height: 5px;\\n    color: crimson;\\n    cursor: pointer;\\n    -moz-user-select: none;\\n    -webkit-user-select: none;\\n    -ms-user-select:none;\\n    user-select:none;\\n}\"}],[\"code\",{\"code\":\"\\\"dependencies\\\": {\\n    \\\"http-server\\\": \\\"^0.11.1\\\",\\n    \\\"json-server\\\": \\\"^0.12.1\\\"\\n  }\"}],[\"code\",{\"code\":\"http POST localhost:3000/todo text=\\\"First One\\\"\"}],[\"code\",{\"code\":\"http GET localhost:3000/todo\"}],[\"code\",{\"code\":\"http DELETE localhost:3000/todo/n\"}],[\"code\",{\"code\":\"{\\n  \\\"todo\\\": [\\n    {\\n      \\\"text\\\": \\\"First One\\\",\\n      \\\"id\\\": 1\\n    },\\n    {\\n      \\\"text\\\": \\\"Second todo\\\",\\n      \\\"id\\\": 2\\n    },\\n    {\\n      \\\"text\\\": \\\"At vero eos et accusamus et iusto odio dignissimos ducimus qui blanditiis praesentium voluptatum deleniti atque corrupti quos dolores et quas molestias excepturi sint occaecati cupiditate non provident, similique sunt in culpa qui officia deserunt mollitia animi, id est laborum et dolorum fuga. Et harum quidem rerum facilis est et expedita distinctio. Nam libero tempore, cum soluta nobis est eligendi optio cumque nihil impedit quo minus id quod maxime placeat facere possimus, omnis voluptas assumenda est, omnis dolor repellendus. Temporibus autem quibusdam et aut officiis debitis aut rerum necessitatibus saepe eveniet ut et voluptates repudiandae sint et molestiae non recusandae. Itaque earum rerum hic tenetur a sapiente delectus, ut aut reiciendis voluptatibus maiores alias consequatur aut perferendis doloribus asperiores repellat.\\\",\\n      \\\"id\\\": 5\\n    }\\n  ]\\n}\"}],[\"code\",{\"code\":\"document.addEventListener('DOMContentLoaded',function () {\\n\\n   // there should be placed code presented below\\n\\n})\"}],[\"code\",{\"code\":\"const dbUrl = 'http://localhost:3000/todo';\\nlet form = document.querySelector('form.todo');\\nlet list = document.querySelector('ul');\"}],[\"code\",{\"code\":\"function getAllTodos() {\\n        return new Promise(resolve => {\\n            fetch(new Request(dbUrl))\\n                .then(res => { return res.json(); })\\n                .then(data => { resolve(data); });\\n        });\\n    }\"}],[\"code\",{\"code\":\"function saveTodo(text) {\\n        let req = new Request(dbUrl,{ method: 'POST',\\n            headers: new Headers({'Content-Type': 'application/json'}),\\n            body: JSON.stringify({text: text})\\n        });\\n\\n        return new Promise(resolve => {\\n            fetch(req)\\n                .then(res => { return res.json(); })\\n                .then(data => { resolve(data); });\\n        })\\n    }\"}],[\"code\",{\"code\":\"function appendTextToList(todo) {\\n        list.innerHTML += `\\n<li data-id=\\\"${todo.id}\\\">\\n    <div class=\\\"list-elem-head\\\">\\n        <span class=\\\"id\\\">${todo.id}</span>\\n    </div>\\n    <div class=\\\"list-elem-body\\\">\\n        <span class=\\\"text\\\">${todo.text}</span>\\n        <span class=\\\"delete\\\">x</span>\\n    </div>\\n</li>`;\\n    }\"}],[\"code\",{\"code\":\"getAllTodos().then(todos => {\\n        todos.forEach(todo => { appendTextToList(todo); });\\n    });\"}],[\"code\",{\"code\":\"form.addEventListener('submit', function (e) {\\n        e.preventDefault();\\n        saveTodo(form.task.value).then(res => {\\n            console.log(res);\\n            appendTextToList(res);\\n        });\\n        form.reset();\\n    });\"}],[\"code\",{\"code\":\"list.addEventListener('click',function (e) {\\n        if(e.target.classList.contains('delete')) {\\n            const id = e.target.parentElement.parentElement.dataset.id;\\n            console.log(id);\\n            fetch(new Request(`${dbUrl}/${id}`,{ method: 'DELETE'}));\\n            document.querySelector(`li[data-id=\\\"${id}\\\"]`).outerHTML = \\\"\\\";\\n        }\\n    })\"}]],\"markups\":[[\"code\"],[\"a\",[\"href\",\"https://gustawdaniel.com/fetch-promise-oraz-string-templates/\",\"rel\",\"nofollow noopener\"]],[\"a\",[\"href\",\"https://github.com/gustawdaniel/simple-todo-app-js-tutorial\",\"rel\",\"nofollow noopener noopener\"]]],\"sections\":[[1,\"p\",[[0,[],0,\"This simple project learn you how to apply interface \"],[0,[0],1,\"fetch\"],[0,[],0,\" , shows examples of usage of \"],[0,[0],1,\"promises\"],[0,[],0,\" and some interesting \"],[0,[0],1,\"css\"],[0,[],0,\" properties like \"],[0,[0],1,\"transform\"],[0,[],0,\" , \"],[0,[0],1,\"user-select\"],[0,[],0,\" or directive \"],[0,[0],1,\"@media\"],[0,[],0,\".\"]]],[1,\"p\",[[0,[],0,\"After finishing project will looks following:\"]]],[10,0],[1,\"p\",[[0,[],0,\"Text was initially posted in polish language nearly one year ago and and for polish reader is still available here:\"]]],[1,\"p\",[[0,[],0,\"> \"],[0,[1],1,\"https://gustawdaniel.com/fetch-promise-oraz-string-templates/\"]]],[1,\"p\",[[0,[],0,\"You can see all source code under link\"]]],[1,\"p\",[[0,[],0,\"> \"],[0,[2],1,\"https://github.com/gustawdaniel/simple-todo-app-js-tutorial\"]]],[1,\"h3\",[[0,[],0,\"Installation\"]]],[1,\"p\",[[0,[],0,\"If you want to test code on your computer without rewriting it, simplest way is download release by command\"]]],[10,1],[1,\"p\",[[0,[],0,\"Next go to created directory\"]]],[10,2],[1,\"p\",[[0,[],0,\"Now you should install dependencies\"]]],[10,3],[1,\"p\",[[0,[],0,\"To setup servers we will need two terminals. In firs one we run server with our projct\"]]],[10,4],[1,\"p\",[[0,[],0,\"In second terminal \"],[0,[0],1,\"ctrl+n\"],[0,[],0,\" we setup \"],[0,[0],1,\"REST API\"],[0,[],0,\" server provided by \"],[0,[0],1,\"json-server\"],[0,[],0,\" package.\"]]],[10,5],[1,\"p\",[[0,[],0,\"If everything works we should see something like this\"]]],[10,6],[1,\"p\",[[0,[],0,\"Website should be available on address \"],[0,[0],1,\"localhost:8080\"]]],[1,\"h3\",[[0,[],0,\"Structure of project\"]]],[1,\"p\",[[0,[],0,\"Project contains the following files\"]]],[10,7],[1,\"p\",[[0,[],0,\"You can see that project is really simple. Page make possible following actions:\"]]],[3,\"ul\",[[[0,[],0,\"creating tasks\"]],[[0,[],0,\"displaying tasks\"]],[[0,[],0,\"removing tasks\"]]]],[1,\"p\",[[0,[],0,\"In next chapter we describe content of static files \"],[0,[0],1,\"index.html\"],[0,[],0,\" and \"],[0,[0],1,\"style.css\"],[0,[],0,\" . Next we discuss servers that we setup, role of \"],[0,[0],1,\"db.json\"],[0,[],0,\" file and at the end logic placed in file \"],[0,[0],1,\"app.js\"],[0,[],0,\" .\"]]],[1,\"h3\",[[0,[],0,\"Static document\"]]],[1,\"p\",[[0,[],0,\"File \"],[0,[0],1,\"index.html\"],[0,[],0,\" starts in quite classic way. We downloading font \"],[0,[0],1,\"Lato\"],[0,[],0,\" and attaching our custom style.\"]]],[10,8],[1,\"p\",[[0,[],0,\"Because of code typed is in agreement with rules of \"],[0,[0],1,\"HTML5\"],[0,[],0,\" semantics we have division on \"],[0,[0],1,\"header\"],[0,[],0,\" and \"],[0,[0],1,\"main\"],[0,[],0,\" . In header there is form with one field to type text of task.\"]]],[10,9],[1,\"p\",[[0,[],0,\"In part \"],[0,[0],1,\"main\"],[0,[],0,\" there is list with three exemplary elements. Elements has his own identifiers and are divided on two parts. First one contains identifier, second text and button to deleting task.\"]]],[10,10],[1,\"p\",[[0,[],0,\"At the end we attaching script, which we describe later. Now it can be empty file.\"]]],[10,11],[1,\"h2\",[[0,[],0,\"CSS file\"]]],[1,\"p\",[[0,[],0,\"If not styling, then looking on this page would cause nightmares. But inspired by lectures from \"],[0,[0],1,\"html\"],[0,[],0,\" and \"],[0,[0],1,\"css\"],[0,[],0,\" that I provided last time I decided type \"],[0,[0],1,\"css\"],[0,[],0,\" file from scratch. The rules that I have added begin with determining the width of the document depending on the width of the screen. Most frequently I using bootstrap to this purpose, but you can do it without it. This is served by the @media directive, the use of which is presented below:\"]]],[10,12],[1,\"p\",[[0,[],0,\"You can see that on biggest devices we want to have margin, which on smaller is not necessary. Next rule is applying font Lato to all document\"]]],[10,13],[1,\"p\",[[0,[],0,\"In header we centering form and removing his natural margins\"]]],[10,14],[1,\"p\",[[0,[],0,\"Next, we define the rules for highlighting the input to which we will click or over which we will have mouse. We removing the transparency from the frame and adding fuzzy shadow and red background.\"]]],[10,15],[1,\"p\",[[0,[],0,\"Now we can see on not selected input.\"]]],[10,16],[1,\"p\",[[0,[],0,\"Interesting property of not selected \"],[0,[0],1,\"input\"],[0,[],0,\" is \"],[0,[0],1,\"transition\"],[0,[],0,\" . It allows to define delay of shadow and background changes. Thank to transition we can see smooth vanishing and appearing of these properties.\"]]],[1,\"p\",[[0,[],0,\"Analogical effects we want to apply to list elements. Most standing out element is moving left border of list on the right what we set in property \"],[0,[0],1,\"margin\"],[0,[],0,\" .\"]]],[10,17],[1,\"p\",[[0,[],0,\"For comparison if mouse not hovered list element then margin is symmetric. There applied \"],[0,[0],1,\"transition\"],[0,[],0,\" too obtaining animation of indenting and ejecting a list item.\"]]],[10,18],[1,\"p\",[[0,[],0,\"Elements of the list are divided into two parts, \"],[0,[0],1,\".list-elem-head\"],[0,[],0,\" is used to display the identifier. The space around is pushed with margins. It is also worth paying attention to \"],[0,[0],1,\"float: left\"],[0,[],0,\" allowing divisions to be adjacent to one line.\"]]],[10,19],[1,\"p\",[[0,[],0,\"The situation is completely different for \"],[0,[0],1,\".list-elem-body\"],[0,[],0,\" . There not margins, but padding are responsible for pushing and centering relative to list element boundaries. It is because of we need full height of element \"],[0,[0],1,\".list-elem-body\"],[0,[],0,\" inside of \"],[0,[0],1,\"li\"],[0,[],0,\" element for adding border \"],[0,[0],1,\"border-left\"],[0,[],0,\" .\"]]],[10,20],[1,\"p\",[[0,[],0,\"This list do no need margins or paddings. With \"],[0,[0],1,\"list-style: none\"],[0,[],0,\" for \"],[0,[0],1,\"li\"],[0,[],0,\" we removing default style of list.\"]]],[10,21],[1,\"p\",[[0,[],0,\"One of the last changes is to offset the text with a note from the internal border of the list item.\"]]],[10,22],[1,\"p\",[[0,[],0,\"On the end we styling button to remove task. It is span containing letter \"],[0,[0],1,\"x\"],[0,[],0,\" . I do not downloading there any additional font. Although of this thanks to rounding corners, appropriate colors, padding and setting the size of the element we managed to get quite a clear-looking removal button. However, one more interesting property has been added here: \"],[0,[0],1,\"user-select\"],[0,[],0,\" . This allow to omit given element on selecting. Thanks this property double clicking on text of note not cause of selecting letter \"],[0,[0],1,\"x\"],[0,[],0,\" on the end.\"]]],[10,23],[1,\"h2\",[[0,[],0,\"Logic\"]]],[1,\"p\",[[0,[],0,\"Now we will discuss how to add to the project the possibility of creating new tasks, deleting them and displaying tasks saved in the database. If you look at the \"],[0,[0],1,\"package.json\"],[0,[],0,\" , you will see the following lines:\"]]],[10,24],[1,\"p\",[[0,[],0,\"First of these packages it is http server that serve our app on port 8080. In this case effect is quite similar like command \"],[0,[0],1,\"php -S localhost:8080\"],[0,[],0,\" but without interpreting \"],[0,[0],1,\"php\"],[0,[],0,\" script.\"]]],[1,\"p\",[[0,[],0,\"Second package is REST server that provide saving data to \"],[0,[0],1,\"db.json\"],[0,[],0,\" file. In file \"],[0,[0],1,\"README.md\"],[0,[],0,\" there are placed commands to run these servers and requests that we can do to communicate with API.\"]]],[1,\"p\",[[0,[],0,\"To add new task there is needed POST request\"]]],[10,25],[1,\"p\",[[0,[],0,\"To list all tasks from database you should send GET\"]]],[10,26],[1,\"p\",[[0,[],0,\"To remove \"],[0,[0],1,\"n-th\"],[0,[],0,\" task send DELETE request indicating which task should be removed in url\"]]],[10,27],[1,\"p\",[[0,[],0,\"Our initial state of \"],[0,[0],1,\"db.json\"],[0,[],0,\" can looks following:\"]]],[10,28],[1,\"p\",[[0,[],0,\"Now we can talk about logic of application placed in \"],[0,[0],1,\"app.js\"],[0,[],0,\" . Before this we need remove form \"],[0,[0],1,\"index.html\"],[0,[],0,\" exemplary list elements. I mean removing everything between \"],[0,[0],1,\"<ul></ul>\"],[0,[],0,\" . We modifying \"],[0,[0],1,\"index.html\"],[0,[],0,\" in this way now because responsibility for managing tasks is transferred to \"],[0,[0],1,\"app.js\"],[0,[],0,\" .\"]]],[1,\"p\",[[0,[],0,\"All script is placed in anonymous function executed after event \"],[0,[0],1,\"DOMContentLoaded\"],[0,[],0,\" . It prevent to executing script before loading \"],[0,[0],1,\"DOM\"],[0,[],0,\" .\"]]],[10,29],[1,\"p\",[[0,[],0,\"Inside this function we define variables which will be used in script. There are \"],[0,[0],1,\"dbUrl\"],[0,[],0,\" containing address to API managing database. And two variables with reference to form and list from \"],[0,[0],1,\"DOM\"],[0,[],0,\" .\"]]],[10,30],[1,\"p\",[[0,[],0,\"Now there is time for defining useful functions. We start from function downloading all tasks. Because of this function sends request it should wait for response. But waiting cant block rest of interface and other scripts. So by method \"],[0,[0],1,\"then\"],[0,[],0,\" we adding listener of receiving response from this request. We can say that \"],[0,[0],1,\"then\"],[0,[],0,\" removes himself from synchronous flow of program and starts waiting for response independent from rest of program. But because of we want to receive data from response we need receive Promise of obtaining these data. Promise is object that in constructor accepts function that argument is function to which we need pass interesting us data. It is complicated to describe but great visible in following code:\"]]],[10,31],[1,\"p\",[[0,[],0,\"But \"],[0,[0],1,\"Promise\"],[0,[],0,\" is not only great thing, that you can see in these lines. Next one is function \"],[0,[0],1,\"fetch\"],[0,[],0,\" . It is successor of interface \"],[0,[0],1,\"XMLHttpRequest\"],[0,[],0,\" . It is different form him by better syntax, more modern approach to low level optimization and support for data streaming. Argument of \"],[0,[0],1,\"fetch\"],[0,[],0,\" function is object \"],[0,[0],1,\"Request\"],[0,[],0,\" . Simplest request is request with method \"],[0,[0],1,\"GET\"],[0,[],0,\" to given address - it is our case. To this function we can attach listener of response by \"],[0,[0],1,\"then\"],[0,[],0,\" . First then is added to wait for obtaining all response and parsing them as \"],[0,[0],1,\"json\"],[0,[],0,\" . Second solves \"],[0,[0],1,\"Promise\"],[0,[],0,\" returning object with data obtained by from response.\"]]],[1,\"p\",[[0,[],0,\"Second method that we will define allows to save task to database. In this case we also use \"],[0,[0],1,\"Promise\"],[0,[],0,\" in identical way like last time, but now request is more complicated. To increase readability of code I saving it to temporary variable \"],[0,[0],1,\"req\"],[0,[],0,\" . We can see that \"],[0,[0],1,\"URL\"],[0,[],0,\" is the same, but in second argument of \"],[0,[0],1,\"Request\"],[0,[],0,\" object we have his additional configuration: method, object containing headers and body of request.\"]]],[10,32],[1,\"p\",[[0,[],0,\"Last function in this project do not have nothing to do with the interface \"],[0,[0],1,\"fetch\"],[0,[],0,\" or \"],[0,[0],1,\"Promise\"],[0,[],0,\" object, but presents other new feature from \"],[0,[0],1,\"ES6\"],[0,[],0,\" - \"],[0,[0],1,\"template strings\"],[0,[],0,\" . These are character strings surrounded by diagonal single quotation mark like this “`\\\", which can contain evaluation of JavaScript expressions designated by \"],[0,[0],1,\"${}\"],[0,[],0,\" syntax. To this function we passing object with properties \"],[0,[0],1,\"id\"],[0,[],0,\" and \"],[0,[0],1,\"text\"],[0,[],0,\" . Function render proper \"],[0,[0],1,\"html\"],[0,[],0,\" code that will be attached to list. It is much more comfortable than using \"],[0,[0],1,\"document.createElement()\"],[0,[],0,\" .\"]]],[10,33],[1,\"p\",[[0,[],0,\"After defining these functions we can describe executive part of code. It begins from iterating by list of notes drawn from \"],[0,[0],1,\"API\"],[0,[],0,\" and appending them to list on page.\"]]],[10,34],[1,\"p\",[[0,[],0,\"Then we, add a listener to the form. If you add an entry, we send it to the database, and after receiving the identifier, we attach it to the list.\"]]],[10,35],[1,\"p\",[[0,[],0,\"At the end, we’re adding a listener to clicks on the list. It’s supposed to be about just deleting, so using the \"],[0,[0],1,\"contains\"],[0,[],0,\" method in the class list, we check if you click on the element with the class \"],[0,[0],1,\"delete\"],[0,[],0,\". If so, we draw the \"],[0,[0],1,\"id\"],[0,[],0,\" from this list element, we send the request with the \"],[0,[0],1,\"DELETE\"],[0,[],0,\" method to the url terminated with this id and we cut it from the list.\"]]],[10,36],[1,\"h2\",[[0,[],0,\"Summary\"]]],[1,\"p\",[[0,[],0,\"This simple design is great as an introduction to programming in JavaScript. We have also presented CSS elements here, which show that you do not always need to use bootstrap to get attractive looking inputs and lists. If you have any questions after reading this text, do not hesitate and ask them in a comment.\"]]],[1,\"p\",[[1,[],0,0]]]],\"ghostVersion\":\"4.0\"}","html":"<p>This simple project learn you how to apply interface <code>fetch</code> , shows examples of usage of <code>promises</code> and some interesting <code>css</code> properties like <code>transform</code> , <code>user-select</code> or directive <code>@media</code>.</p><p>After finishing project will looks following:</p><figure class=\"kg-card kg-image-card kg-card-hascaption\"><img src=\"__GHOST_URL__/content/images/2021/04/1_qm93PtCN3Y0mZWzQrqVAFw--1-.png\" class=\"kg-image\" alt loading=\"lazy\" width=\"666\" height=\"447\" srcset=\"__GHOST_URL__/content/images/size/w600/2021/04/1_qm93PtCN3Y0mZWzQrqVAFw--1-.png 600w, __GHOST_URL__/content/images/2021/04/1_qm93PtCN3Y0mZWzQrqVAFw--1-.png 666w\"><figcaption>To Do List typed in pure JavaScript that will be presented in this article.</figcaption></figure><p>Text was initially posted in polish language nearly one year ago and and for polish reader is still available here:</p><p>&gt; <a href=\"https://gustawdaniel.com/fetch-promise-oraz-string-templates/\" rel=\"nofollow noopener\">https://gustawdaniel.com/fetch-promise-oraz-string-templates/</a></p><p>You can see all source code under link</p><p>&gt; <a href=\"https://github.com/gustawdaniel/simple-todo-app-js-tutorial\" rel=\"nofollow noopener noopener\">https://github.com/gustawdaniel/simple-todo-app-js-tutorial</a></p><h3 id=\"installation\">Installation</h3><p>If you want to test code on your computer without rewriting it, simplest way is download release by command</p><pre><code>wget -qO- https://github.com/gustawdaniel/simple-todo-app-js-tutorial/archive/1.0.tar.gz | tar xvz</code></pre><p>Next go to created directory</p><pre><code>cd simple-todo-app-js-tutorial-1.0 </code></pre><p>Now you should install dependencies</p><pre><code>npm i</code></pre><p>To setup servers we will need two terminals. In firs one we run server with our projct</p><pre><code>node node_modules/http-server/bin/http-server</code></pre><p>In second terminal <code>ctrl+n</code> we setup <code>REST API</code> server provided by <code>json-server</code> package.</p><pre><code>node node_modules/json-server/bin/index.js --watch db.json</code></pre><p>If everything works we should see something like this</p><figure class=\"kg-card kg-image-card kg-card-hascaption\"><img src=\"__GHOST_URL__/content/images/2021/04/1_PD3FHn76We8mFzIivvnpvg--1-.png\" class=\"kg-image\" alt loading=\"lazy\" width=\"800\" height=\"264\" srcset=\"__GHOST_URL__/content/images/size/w600/2021/04/1_PD3FHn76We8mFzIivvnpvg--1-.png 600w, __GHOST_URL__/content/images/2021/04/1_PD3FHn76We8mFzIivvnpvg--1-.png 800w\" sizes=\"(min-width: 720px) 720px\"><figcaption>Server with application (on the right) and with REST API connected with db.json file (on the left)</figcaption></figure><p>Website should be available on address <code>localhost:8080</code></p><h3 id=\"structure-of-project\">Structure of project</h3><p>Project contains the following files</p><pre><code>├── app.js              // script providing creating, reading and deleting tasks\n├── db.json             // json file with data that is connected with REST API\n├── index.html          // html file with main page\n├── LICENSE             // licencje WTFPL\n├── package.json        // file with dependencies (servers: http and json)\n├── README.md           // documentation for end user\n└── style.css           // style</code></pre><p>You can see that project is really simple. Page make possible following actions:</p><ul><li>creating tasks</li><li>displaying tasks</li><li>removing tasks</li></ul><p>In next chapter we describe content of static files <code>index.html</code> and <code>style.css</code> . Next we discuss servers that we setup, role of <code>db.json</code> file and at the end logic placed in file <code>app.js</code> .</p><h3 id=\"static-document\">Static document</h3><p>File <code>index.html</code> starts in quite classic way. We downloading font <code>Lato</code> and attaching our custom style.</p><pre><code>&lt;html&gt;\n&lt;head&gt;\n    &lt;link href=\"https://fonts.googleapis.com/css?family=Lato:300&amp;amp;subset=latin-ext\" rel=\"stylesheet\"&gt;\n    &lt;link rel=\"stylesheet\" href=\"style.css\"&gt;\n&lt;/head&gt;</code></pre><p>Because of code typed is in agreement with rules of <code>HTML5</code> semantics we have division on <code>header</code> and <code>main</code> . In header there is form with one field to type text of task.</p><pre><code>&lt;body&gt;\n&lt;header&gt;\n    &lt;form class=\"todo\"&gt;\n        &lt;input name=\"task\" type=\"text\" placeholder=\"Type text to add note\"&gt;\n    &lt;/form&gt;\n&lt;/header&gt;</code></pre><p>In part <code>main</code> there is list with three exemplary elements. Elements has his own identifiers and are divided on two parts. First one contains identifier, second text and button to deleting task.</p><pre><code>&lt;main&gt;\n  &lt;ul&gt;\n    &lt;li data-id=\"1\"&gt;\n      &lt;div class=\"list-elem-head\"&gt;\n          &lt;span class=\"id\"&gt;1&lt;/span&gt;\n      &lt;/div&gt;\n      &lt;div class=\"list-elem-body\"&gt;\n          &lt;span class=\"text\"&gt;First One&lt;/span&gt;\n          &lt;span class=\"delete\"&gt;x&lt;/span&gt;\n      &lt;/div&gt;\n    &lt;/li&gt;\n    &lt;li data-id=\"2\"&gt;\n      &lt;div class=\"list-elem-head\"&gt;\n          &lt;span class=\"id\"&gt;2&lt;/span&gt;\n      &lt;/div&gt;\n      &lt;div class=\"list-elem-body\"&gt;\n          &lt;span class=\"text\"&gt;Second todo&lt;/span&gt;\n          &lt;span class=\"delete\"&gt;x&lt;/span&gt;\n      &lt;/div&gt;\n    &lt;/li&gt;\n    &lt;li data-id=\"5\"&gt;\n      &lt;div class=\"list-elem-head\"&gt;\n          &lt;span class=\"id\"&gt;5&lt;/span&gt;\n      &lt;/div&gt;\n      &lt;div class=\"list-elem-body\"&gt;\n          &lt;span class=\"text\"&gt;At vero eos et accusamus et iusto odio dignissimos ducimus qui blanditiis praesentium voluptatum deleniti atque corrupti quos dolores et quas molestias excepturi sint occaecati cupiditate non provident, similique sunt in culpa qui officia deserunt mollitia animi, id est laborum et dolorum fuga. Et harum quidem rerum facilis est et expedita distinctio. Nam libero tempore, cum soluta nobis est eligendi optio cumque nihil impedit quo minus id quod maxime placeat facere possimus, omnis voluptas assumenda est, omnis dolor repellendus. Temporibus autem quibusdam et aut officiis debitis aut rerum necessitatibus saepe eveniet ut et voluptates repudiandae sint et molestiae non recusandae. Itaque earum rerum hic tenetur a sapiente delectus, ut aut reiciendis voluptatibus maiores alias consequatur aut perferendis doloribus asperiores repellat.&lt;/span&gt;\n          &lt;span class=\"delete\"&gt;x&lt;/span&gt;\n      &lt;/div&gt;\n    &lt;/li&gt;\n  &lt;/ul&gt;\n&lt;/main&gt;</code></pre><p>At the end we attaching script, which we describe later. Now it can be empty file.</p><pre><code>&lt;script src=\"app.js\"&gt;&lt;/script&gt;\n&lt;/body&gt;\n&lt;/html&gt;</code></pre><h2 id=\"css-file\">CSS file</h2><p>If not styling, then looking on this page would cause nightmares. But inspired by lectures from <code>html</code> and <code>css</code> that I provided last time I decided type <code>css</code> file from scratch. The rules that I have added begin with determining the width of the document depending on the width of the screen. Most frequently I using bootstrap to this purpose, but you can do it without it. This is served by the @media directive, the use of which is presented below:</p><pre><code>@media (max-width: 575px) {\n    input,main {\n        width: 100%;\n    }\n}\n@media (min-width: 576px) {\n    input,main {\n        width: 80%;\n    }\n    main {\n        margin-left: 10%;\n    }\n}</code></pre><p>You can see that on biggest devices we want to have margin, which on smaller is not necessary. Next rule is applying font Lato to all document</p><pre><code>body {\n    font-family: 'Lato', sans-serif;\n}</code></pre><p>In header we centering form and removing his natural margins</p><pre><code>header {\n    text-align: center;\n}\nform {\n    margin: 0;\n}</code></pre><p>Next, we define the rules for highlighting the input to which we will click or over which we will have mouse. We removing the transparency from the frame and adding fuzzy shadow and red background.</p><pre><code>input:focus, input:hover {\n    border: solid 1px crimson;\n    box-shadow: 0 0 5px -1px crimson;\n    background-color: rgba(220, 20, 60, 0.05);\n}</code></pre><p>Now we can see on not selected input.</p><pre><code>input {\n    padding: 20px;\n    border: solid 1px rgba(220, 20, 60, 0.52);\n    margin: 10px 0;\n    transition: box-shadow 1s, background-color 2s;\n}</code></pre><p>Interesting property of not selected <code>input</code> is <code>transition</code> . It allows to define delay of shadow and background changes. Thank to transition we can see smooth vanishing and appearing of these properties.</p><p>Analogical effects we want to apply to list elements. Most standing out element is moving left border of list on the right what we set in property <code>margin</code> .</p><pre><code>li:hover {\n    border: solid 1px rgba(220, 20, 60, 0.8);\n    background-color: rgba(220, 20, 60, 0.05);\n    box-shadow: 0 0 2px -1px crimson;\n    margin: 3px 0 3px 10px;\n}</code></pre><p>For comparison if mouse not hovered list element then margin is symmetric. There applied <code>transition</code> too obtaining animation of indenting and ejecting a list item.</p><pre><code>li {\n    list-style: none;\n    border: solid 1px rgba(220, 20, 60, 0.52);\n    margin: 3px 0;\n    color: gray;\n    transition: margin 0.5s, background-color 2s;\n}</code></pre><p>Elements of the list are divided into two parts, <code>.list-elem-head</code> is used to display the identifier. The space around is pushed with margins. It is also worth paying attention to <code>float: left</code> allowing divisions to be adjacent to one line.</p><pre><code>.list-elem-head {\n    float: left;\n    margin: 20px;\n}</code></pre><p>The situation is completely different for <code>.list-elem-body</code> . There not margins, but padding are responsible for pushing and centering relative to list element boundaries. It is because of we need full height of element <code>.list-elem-body</code> inside of <code>li</code> element for adding border <code>border-left</code> .</p><pre><code>.list-elem-body {\n    margin-left: 50px;\n    padding: 20px 20px 20px 20px;\n    border-left: solid 1px rgba(220, 20, 60, 0.52);\n}</code></pre><p>This list do no need margins or paddings. With <code>list-style: none</code> for <code>li</code> we removing default style of list.</p><pre><code>ul {\n    margin: 0;\n    padding: 0;\n}</code></pre><p>One of the last changes is to offset the text with a note from the internal border of the list item.</p><pre><code>li &gt; span.text {\n    padding-right: 20px;\n}</code></pre><p>On the end we styling button to remove task. It is span containing letter <code>x</code> . I do not downloading there any additional font. Although of this thanks to rounding corners, appropriate colors, padding and setting the size of the element we managed to get quite a clear-looking removal button. However, one more interesting property has been added here: <code>user-select</code> . This allow to omit given element on selecting. Thanks this property double clicking on text of note not cause of selecting letter <code>x</code> on the end.</p><pre><code>li &gt; div &gt; span.delete {\n    float: right;\n    border: solid 1px crimson;\n    border-radius: 50%;\n    padding: 5px;\n    width: 7px;\n    height: 7px;\n    line-height: 5px;\n    color: crimson;\n    cursor: pointer;\n    -moz-user-select: none;\n    -webkit-user-select: none;\n    -ms-user-select:none;\n    user-select:none;\n}</code></pre><h2 id=\"logic\">Logic</h2><p>Now we will discuss how to add to the project the possibility of creating new tasks, deleting them and displaying tasks saved in the database. If you look at the <code>package.json</code> , you will see the following lines:</p><pre><code>\"dependencies\": {\n    \"http-server\": \"^0.11.1\",\n    \"json-server\": \"^0.12.1\"\n  }</code></pre><p>First of these packages it is http server that serve our app on port 8080. In this case effect is quite similar like command <code>php -S localhost:8080</code> but without interpreting <code>php</code> script.</p><p>Second package is REST server that provide saving data to <code>db.json</code> file. In file <code>README.md</code> there are placed commands to run these servers and requests that we can do to communicate with API.</p><p>To add new task there is needed POST request</p><pre><code>http POST localhost:3000/todo text=\"First One\"</code></pre><p>To list all tasks from database you should send GET</p><pre><code>http GET localhost:3000/todo</code></pre><p>To remove <code>n-th</code> task send DELETE request indicating which task should be removed in url</p><pre><code>http DELETE localhost:3000/todo/n</code></pre><p>Our initial state of <code>db.json</code> can looks following:</p><pre><code>{\n  \"todo\": [\n    {\n      \"text\": \"First One\",\n      \"id\": 1\n    },\n    {\n      \"text\": \"Second todo\",\n      \"id\": 2\n    },\n    {\n      \"text\": \"At vero eos et accusamus et iusto odio dignissimos ducimus qui blanditiis praesentium voluptatum deleniti atque corrupti quos dolores et quas molestias excepturi sint occaecati cupiditate non provident, similique sunt in culpa qui officia deserunt mollitia animi, id est laborum et dolorum fuga. Et harum quidem rerum facilis est et expedita distinctio. Nam libero tempore, cum soluta nobis est eligendi optio cumque nihil impedit quo minus id quod maxime placeat facere possimus, omnis voluptas assumenda est, omnis dolor repellendus. Temporibus autem quibusdam et aut officiis debitis aut rerum necessitatibus saepe eveniet ut et voluptates repudiandae sint et molestiae non recusandae. Itaque earum rerum hic tenetur a sapiente delectus, ut aut reiciendis voluptatibus maiores alias consequatur aut perferendis doloribus asperiores repellat.\",\n      \"id\": 5\n    }\n  ]\n}</code></pre><p>Now we can talk about logic of application placed in <code>app.js</code> . Before this we need remove form <code>index.html</code> exemplary list elements. I mean removing everything between <code>&lt;ul&gt;&lt;/ul&gt;</code> . We modifying <code>index.html</code> in this way now because responsibility for managing tasks is transferred to <code>app.js</code> .</p><p>All script is placed in anonymous function executed after event <code>DOMContentLoaded</code> . It prevent to executing script before loading <code>DOM</code> .</p><pre><code>document.addEventListener('DOMContentLoaded',function () {\n\n   // there should be placed code presented below\n\n})</code></pre><p>Inside this function we define variables which will be used in script. There are <code>dbUrl</code> containing address to API managing database. And two variables with reference to form and list from <code>DOM</code> .</p><pre><code>const dbUrl = 'http://localhost:3000/todo';\nlet form = document.querySelector('form.todo');\nlet list = document.querySelector('ul');</code></pre><p>Now there is time for defining useful functions. We start from function downloading all tasks. Because of this function sends request it should wait for response. But waiting cant block rest of interface and other scripts. So by method <code>then</code> we adding listener of receiving response from this request. We can say that <code>then</code> removes himself from synchronous flow of program and starts waiting for response independent from rest of program. But because of we want to receive data from response we need receive Promise of obtaining these data. Promise is object that in constructor accepts function that argument is function to which we need pass interesting us data. It is complicated to describe but great visible in following code:</p><pre><code>function getAllTodos() {\n        return new Promise(resolve =&gt; {\n            fetch(new Request(dbUrl))\n                .then(res =&gt; { return res.json(); })\n                .then(data =&gt; { resolve(data); });\n        });\n    }</code></pre><p>But <code>Promise</code> is not only great thing, that you can see in these lines. Next one is function <code>fetch</code> . It is successor of interface <code>XMLHttpRequest</code> . It is different form him by better syntax, more modern approach to low level optimization and support for data streaming. Argument of <code>fetch</code> function is object <code>Request</code> . Simplest request is request with method <code>GET</code> to given address - it is our case. To this function we can attach listener of response by <code>then</code> . First then is added to wait for obtaining all response and parsing them as <code>json</code> . Second solves <code>Promise</code> returning object with data obtained by from response.</p><p>Second method that we will define allows to save task to database. In this case we also use <code>Promise</code> in identical way like last time, but now request is more complicated. To increase readability of code I saving it to temporary variable <code>req</code> . We can see that <code>URL</code> is the same, but in second argument of <code>Request</code> object we have his additional configuration: method, object containing headers and body of request.</p><pre><code>function saveTodo(text) {\n        let req = new Request(dbUrl,{ method: 'POST',\n            headers: new Headers({'Content-Type': 'application/json'}),\n            body: JSON.stringify({text: text})\n        });\n\n        return new Promise(resolve =&gt; {\n            fetch(req)\n                .then(res =&gt; { return res.json(); })\n                .then(data =&gt; { resolve(data); });\n        })\n    }</code></pre><p>Last function in this project do not have nothing to do with the interface <code>fetch</code> or <code>Promise</code> object, but presents other new feature from <code>ES6</code> - <code>template strings</code> . These are character strings surrounded by diagonal single quotation mark like this “`\", which can contain evaluation of JavaScript expressions designated by <code>${}</code> syntax. To this function we passing object with properties <code>id</code> and <code>text</code> . Function render proper <code>html</code> code that will be attached to list. It is much more comfortable than using <code>document.createElement()</code> .</p><pre><code>function appendTextToList(todo) {\n        list.innerHTML += `\n&lt;li data-id=\"${todo.id}\"&gt;\n    &lt;div class=\"list-elem-head\"&gt;\n        &lt;span class=\"id\"&gt;${todo.id}&lt;/span&gt;\n    &lt;/div&gt;\n    &lt;div class=\"list-elem-body\"&gt;\n        &lt;span class=\"text\"&gt;${todo.text}&lt;/span&gt;\n        &lt;span class=\"delete\"&gt;x&lt;/span&gt;\n    &lt;/div&gt;\n&lt;/li&gt;`;\n    }</code></pre><p>After defining these functions we can describe executive part of code. It begins from iterating by list of notes drawn from <code>API</code> and appending them to list on page.</p><pre><code>getAllTodos().then(todos =&gt; {\n        todos.forEach(todo =&gt; { appendTextToList(todo); });\n    });</code></pre><p>Then we, add a listener to the form. If you add an entry, we send it to the database, and after receiving the identifier, we attach it to the list.</p><pre><code>form.addEventListener('submit', function (e) {\n        e.preventDefault();\n        saveTodo(form.task.value).then(res =&gt; {\n            console.log(res);\n            appendTextToList(res);\n        });\n        form.reset();\n    });</code></pre><p>At the end, we’re adding a listener to clicks on the list. It’s supposed to be about just deleting, so using the <code>contains</code> method in the class list, we check if you click on the element with the class <code>delete</code>. If so, we draw the <code>id</code> from this list element, we send the request with the <code>DELETE</code> method to the url terminated with this id and we cut it from the list.</p><pre><code>list.addEventListener('click',function (e) {\n        if(e.target.classList.contains('delete')) {\n            const id = e.target.parentElement.parentElement.dataset.id;\n            console.log(id);\n            fetch(new Request(`${dbUrl}/${id}`,{ method: 'DELETE'}));\n            document.querySelector(`li[data-id=\"${id}\"]`).outerHTML = \"\";\n        }\n    })</code></pre><h2 id=\"summary\">Summary</h2><p>This simple design is great as an introduction to programming in JavaScript. We have also presented CSS elements here, which show that you do not always need to use bootstrap to get attractive looking inputs and lists. If you have any questions after reading this text, do not hesitate and ask them in a comment.</p>","comment_id":"607f47ff5d6c891ac9aa7469","plaintext":"This simple project learn you how to apply interface fetch , shows examples of\nusage of promises and some interesting css properties like transform , \nuser-select or directive @media.\n\nAfter finishing project will looks following:\n\nTo Do List typed in pure JavaScript that will be presented in this article.Text\nwas initially posted in polish language nearly one year ago and and for polish\nreader is still available here:\n\n> https://gustawdaniel.com/fetch-promise-oraz-string-templates/\n\nYou can see all source code under link\n\n> https://github.com/gustawdaniel/simple-todo-app-js-tutorial\n\nInstallation\nIf you want to test code on your computer without rewriting it, simplest way is\ndownload release by command\n\nwget -qO- https://github.com/gustawdaniel/simple-todo-app-js-tutorial/archive/1.0.tar.gz | tar xvz\n\nNext go to created directory\n\ncd simple-todo-app-js-tutorial-1.0 \n\nNow you should install dependencies\n\nnpm i\n\nTo setup servers we will need two terminals. In firs one we run server with our\nprojct\n\nnode node_modules/http-server/bin/http-server\n\nIn second terminal ctrl+n we setup REST API server provided by json-server \npackage.\n\nnode node_modules/json-server/bin/index.js --watch db.json\n\nIf everything works we should see something like this\n\nServer with application (on the right) and with REST API connected with db.json\nfile (on the left)Website should be available on address localhost:8080\n\nStructure of project\nProject contains the following files\n\n├── app.js              // script providing creating, reading and deleting tasks\n├── db.json             // json file with data that is connected with REST API\n├── index.html          // html file with main page\n├── LICENSE             // licencje WTFPL\n├── package.json        // file with dependencies (servers: http and json)\n├── README.md           // documentation for end user\n└── style.css           // style\n\nYou can see that project is really simple. Page make possible following actions:\n\n * creating tasks\n * displaying tasks\n * removing tasks\n\nIn next chapter we describe content of static files index.html and style.css .\nNext we discuss servers that we setup, role of db.json file and at the end logic\nplaced in file app.js .\n\nStatic document\nFile index.html starts in quite classic way. We downloading font Lato and\nattaching our custom style.\n\n<html>\n<head>\n    <link href=\"https://fonts.googleapis.com/css?family=Lato:300&amp;subset=latin-ext\" rel=\"stylesheet\">\n    <link rel=\"stylesheet\" href=\"style.css\">\n</head>\n\nBecause of code typed is in agreement with rules of HTML5 semantics we have\ndivision on header and main . In header there is form with one field to type\ntext of task.\n\n<body>\n<header>\n    <form class=\"todo\">\n        <input name=\"task\" type=\"text\" placeholder=\"Type text to add note\">\n    </form>\n</header>\n\nIn part main there is list with three exemplary elements. Elements has his own\nidentifiers and are divided on two parts. First one contains identifier, second\ntext and button to deleting task.\n\n<main>\n  <ul>\n    <li data-id=\"1\">\n      <div class=\"list-elem-head\">\n          <span class=\"id\">1</span>\n      </div>\n      <div class=\"list-elem-body\">\n          <span class=\"text\">First One</span>\n          <span class=\"delete\">x</span>\n      </div>\n    </li>\n    <li data-id=\"2\">\n      <div class=\"list-elem-head\">\n          <span class=\"id\">2</span>\n      </div>\n      <div class=\"list-elem-body\">\n          <span class=\"text\">Second todo</span>\n          <span class=\"delete\">x</span>\n      </div>\n    </li>\n    <li data-id=\"5\">\n      <div class=\"list-elem-head\">\n          <span class=\"id\">5</span>\n      </div>\n      <div class=\"list-elem-body\">\n          <span class=\"text\">At vero eos et accusamus et iusto odio dignissimos ducimus qui blanditiis praesentium voluptatum deleniti atque corrupti quos dolores et quas molestias excepturi sint occaecati cupiditate non provident, similique sunt in culpa qui officia deserunt mollitia animi, id est laborum et dolorum fuga. Et harum quidem rerum facilis est et expedita distinctio. Nam libero tempore, cum soluta nobis est eligendi optio cumque nihil impedit quo minus id quod maxime placeat facere possimus, omnis voluptas assumenda est, omnis dolor repellendus. Temporibus autem quibusdam et aut officiis debitis aut rerum necessitatibus saepe eveniet ut et voluptates repudiandae sint et molestiae non recusandae. Itaque earum rerum hic tenetur a sapiente delectus, ut aut reiciendis voluptatibus maiores alias consequatur aut perferendis doloribus asperiores repellat.</span>\n          <span class=\"delete\">x</span>\n      </div>\n    </li>\n  </ul>\n</main>\n\nAt the end we attaching script, which we describe later. Now it can be empty\nfile.\n\n<script src=\"app.js\"></script>\n</body>\n</html>\n\nCSS file\nIf not styling, then looking on this page would cause nightmares. But inspired\nby lectures from html and css that I provided last time I decided type css file\nfrom scratch. The rules that I have added begin with determining the width of\nthe document depending on the width of the screen. Most frequently I using\nbootstrap to this purpose, but you can do it without it. This is served by the\n@media directive, the use of which is presented below:\n\n@media (max-width: 575px) {\n    input,main {\n        width: 100%;\n    }\n}\n@media (min-width: 576px) {\n    input,main {\n        width: 80%;\n    }\n    main {\n        margin-left: 10%;\n    }\n}\n\nYou can see that on biggest devices we want to have margin, which on smaller is\nnot necessary. Next rule is applying font Lato to all document\n\nbody {\n    font-family: 'Lato', sans-serif;\n}\n\nIn header we centering form and removing his natural margins\n\nheader {\n    text-align: center;\n}\nform {\n    margin: 0;\n}\n\nNext, we define the rules for highlighting the input to which we will click or\nover which we will have mouse. We removing the transparency from the frame and\nadding fuzzy shadow and red background.\n\ninput:focus, input:hover {\n    border: solid 1px crimson;\n    box-shadow: 0 0 5px -1px crimson;\n    background-color: rgba(220, 20, 60, 0.05);\n}\n\nNow we can see on not selected input.\n\ninput {\n    padding: 20px;\n    border: solid 1px rgba(220, 20, 60, 0.52);\n    margin: 10px 0;\n    transition: box-shadow 1s, background-color 2s;\n}\n\nInteresting property of not selected input is transition . It allows to define\ndelay of shadow and background changes. Thank to transition we can see smooth\nvanishing and appearing of these properties.\n\nAnalogical effects we want to apply to list elements. Most standing out element\nis moving left border of list on the right what we set in property margin .\n\nli:hover {\n    border: solid 1px rgba(220, 20, 60, 0.8);\n    background-color: rgba(220, 20, 60, 0.05);\n    box-shadow: 0 0 2px -1px crimson;\n    margin: 3px 0 3px 10px;\n}\n\nFor comparison if mouse not hovered list element then margin is symmetric. There\napplied transition too obtaining animation of indenting and ejecting a list\nitem.\n\nli {\n    list-style: none;\n    border: solid 1px rgba(220, 20, 60, 0.52);\n    margin: 3px 0;\n    color: gray;\n    transition: margin 0.5s, background-color 2s;\n}\n\nElements of the list are divided into two parts, .list-elem-head is used to\ndisplay the identifier. The space around is pushed with margins. It is also\nworth paying attention to float: left allowing divisions to be adjacent to one\nline.\n\n.list-elem-head {\n    float: left;\n    margin: 20px;\n}\n\nThe situation is completely different for .list-elem-body . There not margins,\nbut padding are responsible for pushing and centering relative to list element\nboundaries. It is because of we need full height of element .list-elem-body \ninside of li element for adding border border-left .\n\n.list-elem-body {\n    margin-left: 50px;\n    padding: 20px 20px 20px 20px;\n    border-left: solid 1px rgba(220, 20, 60, 0.52);\n}\n\nThis list do no need margins or paddings. With list-style: none for li we\nremoving default style of list.\n\nul {\n    margin: 0;\n    padding: 0;\n}\n\nOne of the last changes is to offset the text with a note from the internal\nborder of the list item.\n\nli > span.text {\n    padding-right: 20px;\n}\n\nOn the end we styling button to remove task. It is span containing letter x . I\ndo not downloading there any additional font. Although of this thanks to\nrounding corners, appropriate colors, padding and setting the size of the\nelement we managed to get quite a clear-looking removal button. However, one\nmore interesting property has been added here: user-select . This allow to omit\ngiven element on selecting. Thanks this property double clicking on text of note\nnot cause of selecting letter x on the end.\n\nli > div > span.delete {\n    float: right;\n    border: solid 1px crimson;\n    border-radius: 50%;\n    padding: 5px;\n    width: 7px;\n    height: 7px;\n    line-height: 5px;\n    color: crimson;\n    cursor: pointer;\n    -moz-user-select: none;\n    -webkit-user-select: none;\n    -ms-user-select:none;\n    user-select:none;\n}\n\nLogic\nNow we will discuss how to add to the project the possibility of creating new\ntasks, deleting them and displaying tasks saved in the database. If you look at\nthe package.json , you will see the following lines:\n\n\"dependencies\": {\n    \"http-server\": \"^0.11.1\",\n    \"json-server\": \"^0.12.1\"\n  }\n\nFirst of these packages it is http server that serve our app on port 8080. In\nthis case effect is quite similar like command php -S localhost:8080 but without\ninterpreting php script.\n\nSecond package is REST server that provide saving data to db.json file. In file \nREADME.md there are placed commands to run these servers and requests that we\ncan do to communicate with API.\n\nTo add new task there is needed POST request\n\nhttp POST localhost:3000/todo text=\"First One\"\n\nTo list all tasks from database you should send GET\n\nhttp GET localhost:3000/todo\n\nTo remove n-th task send DELETE request indicating which task should be removed\nin url\n\nhttp DELETE localhost:3000/todo/n\n\nOur initial state of db.json can looks following:\n\n{\n  \"todo\": [\n    {\n      \"text\": \"First One\",\n      \"id\": 1\n    },\n    {\n      \"text\": \"Second todo\",\n      \"id\": 2\n    },\n    {\n      \"text\": \"At vero eos et accusamus et iusto odio dignissimos ducimus qui blanditiis praesentium voluptatum deleniti atque corrupti quos dolores et quas molestias excepturi sint occaecati cupiditate non provident, similique sunt in culpa qui officia deserunt mollitia animi, id est laborum et dolorum fuga. Et harum quidem rerum facilis est et expedita distinctio. Nam libero tempore, cum soluta nobis est eligendi optio cumque nihil impedit quo minus id quod maxime placeat facere possimus, omnis voluptas assumenda est, omnis dolor repellendus. Temporibus autem quibusdam et aut officiis debitis aut rerum necessitatibus saepe eveniet ut et voluptates repudiandae sint et molestiae non recusandae. Itaque earum rerum hic tenetur a sapiente delectus, ut aut reiciendis voluptatibus maiores alias consequatur aut perferendis doloribus asperiores repellat.\",\n      \"id\": 5\n    }\n  ]\n}\n\nNow we can talk about logic of application placed in app.js . Before this we\nneed remove form index.html exemplary list elements. I mean removing everything\nbetween <ul></ul> . We modifying index.html in this way now because\nresponsibility for managing tasks is transferred to app.js .\n\nAll script is placed in anonymous function executed after event DOMContentLoaded \n. It prevent to executing script before loading DOM .\n\ndocument.addEventListener('DOMContentLoaded',function () {\n\n   // there should be placed code presented below\n\n})\n\nInside this function we define variables which will be used in script. There are \ndbUrl containing address to API managing database. And two variables with\nreference to form and list from DOM .\n\nconst dbUrl = 'http://localhost:3000/todo';\nlet form = document.querySelector('form.todo');\nlet list = document.querySelector('ul');\n\nNow there is time for defining useful functions. We start from function\ndownloading all tasks. Because of this function sends request it should wait for\nresponse. But waiting cant block rest of interface and other scripts. So by\nmethod then we adding listener of receiving response from this request. We can\nsay that then removes himself from synchronous flow of program and starts\nwaiting for response independent from rest of program. But because of we want to\nreceive data from response we need receive Promise of obtaining these data.\nPromise is object that in constructor accepts function that argument is function\nto which we need pass interesting us data. It is complicated to describe but\ngreat visible in following code:\n\nfunction getAllTodos() {\n        return new Promise(resolve => {\n            fetch(new Request(dbUrl))\n                .then(res => { return res.json(); })\n                .then(data => { resolve(data); });\n        });\n    }\n\nBut Promise is not only great thing, that you can see in these lines. Next one\nis function fetch . It is successor of interface XMLHttpRequest . It is\ndifferent form him by better syntax, more modern approach to low level\noptimization and support for data streaming. Argument of fetch function is\nobject Request . Simplest request is request with method GET to given address -\nit is our case. To this function we can attach listener of response by then .\nFirst then is added to wait for obtaining all response and parsing them as json \n. Second solves Promise returning object with data obtained by from response.\n\nSecond method that we will define allows to save task to database. In this case\nwe also use Promise in identical way like last time, but now request is more\ncomplicated. To increase readability of code I saving it to temporary variable \nreq . We can see that URL is the same, but in second argument of Request object\nwe have his additional configuration: method, object containing headers and body\nof request.\n\nfunction saveTodo(text) {\n        let req = new Request(dbUrl,{ method: 'POST',\n            headers: new Headers({'Content-Type': 'application/json'}),\n            body: JSON.stringify({text: text})\n        });\n\n        return new Promise(resolve => {\n            fetch(req)\n                .then(res => { return res.json(); })\n                .then(data => { resolve(data); });\n        })\n    }\n\nLast function in this project do not have nothing to do with the interface fetch \nor Promise object, but presents other new feature from ES6 - template strings .\nThese are character strings surrounded by diagonal single quotation mark like\nthis “`\", which can contain evaluation of JavaScript expressions designated by \n${} syntax. To this function we passing object with properties id and text .\nFunction render proper html code that will be attached to list. It is much more\ncomfortable than using document.createElement() .\n\nfunction appendTextToList(todo) {\n        list.innerHTML += `\n<li data-id=\"${todo.id}\">\n    <div class=\"list-elem-head\">\n        <span class=\"id\">${todo.id}</span>\n    </div>\n    <div class=\"list-elem-body\">\n        <span class=\"text\">${todo.text}</span>\n        <span class=\"delete\">x</span>\n    </div>\n</li>`;\n    }\n\nAfter defining these functions we can describe executive part of code. It begins\nfrom iterating by list of notes drawn from API and appending them to list on\npage.\n\ngetAllTodos().then(todos => {\n        todos.forEach(todo => { appendTextToList(todo); });\n    });\n\nThen we, add a listener to the form. If you add an entry, we send it to the\ndatabase, and after receiving the identifier, we attach it to the list.\n\nform.addEventListener('submit', function (e) {\n        e.preventDefault();\n        saveTodo(form.task.value).then(res => {\n            console.log(res);\n            appendTextToList(res);\n        });\n        form.reset();\n    });\n\nAt the end, we’re adding a listener to clicks on the list. It’s supposed to be\nabout just deleting, so using the contains method in the class list, we check if\nyou click on the element with the class delete. If so, we draw the id from this\nlist element, we send the request with the DELETE method to the url terminated\nwith this id and we cut it from the list.\n\nlist.addEventListener('click',function (e) {\n        if(e.target.classList.contains('delete')) {\n            const id = e.target.parentElement.parentElement.dataset.id;\n            console.log(id);\n            fetch(new Request(`${dbUrl}/${id}`,{ method: 'DELETE'}));\n            document.querySelector(`li[data-id=\"${id}\"]`).outerHTML = \"\";\n        }\n    })\n\nSummary\nThis simple design is great as an introduction to programming in JavaScript. We\nhave also presented CSS elements here, which show that you do not always need to\nuse bootstrap to get attractive looking inputs and lists. If you have any\nquestions after reading this text, do not hesitate and ask them in a comment.","feature_image":"__GHOST_URL__/content/images/2021/04/maxresdefault.jpg","featured":0,"type":"post","status":"published","locale":null,"visibility":"public","email_recipient_filter":"all","created_at":"2021-04-20T21:30:39.000Z","updated_at":"2021-04-20T21:46:37.000Z","published_at":"2021-04-20T21:46:37.000Z","custom_excerpt":"This simple project is great as an introduction to JavaScript programming. The emphasis is on ES6 elements and the frontend.","codeinjection_head":null,"codeinjection_foot":null,"custom_template":null,"canonical_url":null,"newsletter_id":null,"lexical":null},{"id":"60c74386e7634f04c892be68","uuid":"fe0e445f-6ea2-4581-8f10-5c7c2180c46a","title":"How to create a free email account with custom domain?","slug":"how-to-create-a-free-email-account-with-custom-domain","mobiledoc":"{\"version\":\"0.3.1\",\"atoms\":[[\"soft-return\",\"\",{}],[\"soft-return\",\"\",{}],[\"soft-return\",\"\",{}],[\"soft-return\",\"\",{}]],\"cards\":[[\"image\",{\"src\":\"__GHOST_URL__/content/images/2021/06/image.png\",\"width\":652,\"height\":434,\"caption\":\"You can choose to verify your account with phone number or a security question.\"}],[\"image\",{\"src\":\"__GHOST_URL__/content/images/2021/06/image-3.png\",\"width\":2358,\"height\":206,\"caption\":\"It should look simmilar to this.\"}],[\"image\",{\"src\":\"__GHOST_URL__/content/images/2021/06/image-4.png\",\"width\":872,\"height\":1416,\"caption\":\"Congratulations! You've just created a custom email for free!\"}]],\"markups\":[[\"a\",[\"href\",\"https://mail.yandex.com/\"]],[\"a\",[\"href\",\"https://connect.yandex.com/portal/services/webmaster\"]],[\"a\",[\"href\",\"https://connect.yandex.com/portal/admin/users/\"]],[\"strong\"]],\"sections\":[[1,\"h2\",[[0,[],0,\"Yandex is king\"]]],[1,\"p\",[[0,[],0,\"After both Google and Microsoft enabled creation of custom emails only for paid plans, one of the only email providers standing is Yandex Mail. \"]]],[1,\"p\",[[0,[],0,\"First we will go to \"],[0,[0],1,\"https://mail.yandex.com/\"],[0,[],0,\" and create new Yandex account which will be organization-wide admin account.\"]]],[10,0],[1,\"p\",[[0,[],0,\"Login to newly created account on \"],[0,[0],1,\"https://mail.yandex.com/\"],[0,[],0,\" and then go to \"],[0,[1],1,\"https://connect.yandex.com/portal/services/webmaster\"],[0,[],0,\".\"]]],[1,\"h2\",[[0,[],0,\"Adding a new domain\"]]],[1,\"p\",[[0,[],0,\"As an option choose DNS and add TXT record to your domain provider's DNS zone.\"]]],[10,1],[1,\"h2\",[[0,[],0,\"Adding user accounts/custom email prefixes\"]]],[1,\"p\",[[0,[],0,\"To create a new email account go to \"],[0,[2],1,\"https://connect.yandex.com/portal/admin/users/\"],[1,[],0,0],[0,[],0,\"Then click \"],[0,[3],1,\"Все сотрудники \"],[0,[],0,\"and add a new user by clicking \\\"Add\\\" and choosing \\\"Add a person\\\".\"],[1,[],0,1],[0,[],0,\"You can also create mailing lists by \\\"Creating a department\\\" and adding people to it.\"]]],[10,2],[1,\"p\",[[0,[],0,\"If You want to create a new email for the same domain later, you can do it but only from the admin ___@yandex.com account that you've created at the beggining as it is only admin account in your organization.\"],[1,[],0,2],[1,[],0,3],[0,[],0,\"If You know about other great Yandex functionalities, leave them in the comments :)\"]]],[1,\"p\",[[0,[],0,\"Thanks for reading through!\"]]]],\"ghostVersion\":\"4.0\"}","html":"<h2 id=\"yandex-is-king\">Yandex is king</h2><p>After both Google and Microsoft enabled creation of custom emails only for paid plans, one of the only email providers standing is Yandex Mail. </p><p>First we will go to <a href=\"https://mail.yandex.com/\">https://mail.yandex.com/</a> and create new Yandex account which will be organization-wide admin account.</p><figure class=\"kg-card kg-image-card kg-card-hascaption\"><img src=\"__GHOST_URL__/content/images/2021/06/image.png\" class=\"kg-image\" alt loading=\"lazy\" width=\"652\" height=\"434\" srcset=\"__GHOST_URL__/content/images/size/w600/2021/06/image.png 600w, __GHOST_URL__/content/images/2021/06/image.png 652w\"><figcaption>You can choose to verify your account with phone number or a security question.</figcaption></figure><p>Login to newly created account on <a href=\"https://mail.yandex.com/\">https://mail.yandex.com/</a> and then go to <a href=\"https://connect.yandex.com/portal/services/webmaster\">https://connect.yandex.com/portal/services/webmaster</a>.</p><h2 id=\"adding-a-new-domain\">Adding a new domain</h2><p>As an option choose DNS and add TXT record to your domain provider's DNS zone.</p><figure class=\"kg-card kg-image-card kg-card-hascaption\"><img src=\"__GHOST_URL__/content/images/2021/06/image-3.png\" class=\"kg-image\" alt loading=\"lazy\" width=\"2000\" height=\"175\" srcset=\"__GHOST_URL__/content/images/size/w600/2021/06/image-3.png 600w, __GHOST_URL__/content/images/size/w1000/2021/06/image-3.png 1000w, __GHOST_URL__/content/images/size/w1600/2021/06/image-3.png 1600w, __GHOST_URL__/content/images/2021/06/image-3.png 2358w\" sizes=\"(min-width: 720px) 720px\"><figcaption>It should look simmilar to this.</figcaption></figure><h2 id=\"adding-user-accountscustom-email-prefixes\">Adding user accounts/custom email prefixes</h2><p>To create a new email account go to <a href=\"https://connect.yandex.com/portal/admin/users/\">https://connect.yandex.com/portal/admin/users/</a><br>Then click <strong>Все сотрудники </strong>and add a new user by clicking \"Add\" and choosing \"Add a person\".<br>You can also create mailing lists by \"Creating a department\" and adding people to it.</p><figure class=\"kg-card kg-image-card kg-card-hascaption\"><img src=\"__GHOST_URL__/content/images/2021/06/image-4.png\" class=\"kg-image\" alt loading=\"lazy\" width=\"872\" height=\"1416\" srcset=\"__GHOST_URL__/content/images/size/w600/2021/06/image-4.png 600w, __GHOST_URL__/content/images/2021/06/image-4.png 872w\" sizes=\"(min-width: 720px) 720px\"><figcaption>Congratulations! You've just created a custom email for free!</figcaption></figure><p>If You want to create a new email for the same domain later, you can do it but only from the admin ___@yandex.com account that you've created at the beggining as it is only admin account in your organization.<br><br>If You know about other great Yandex functionalities, leave them in the comments :)</p><p>Thanks for reading through!</p>","comment_id":"60c74386e7634f04c892be68","plaintext":"Yandex is king\nAfter both Google and Microsoft enabled creation of custom emails only for paid\nplans, one of the only email providers standing is Yandex Mail. \n\nFirst we will go to https://mail.yandex.com/ and create new Yandex account which\nwill be organization-wide admin account.\n\nYou can choose to verify your account with phone number or a security question.\nLogin to newly created account on https://mail.yandex.com/ and then go to \nhttps://connect.yandex.com/portal/services/webmaster.\n\nAdding a new domain\nAs an option choose DNS and add TXT record to your domain provider's DNS zone.\n\nIt should look simmilar to this.Adding user accounts/custom email prefixes\nTo create a new email account go to \nhttps://connect.yandex.com/portal/admin/users/\nThen click Все сотрудники and add a new user by clicking \"Add\" and choosing \"Add\na person\".\nYou can also create mailing lists by \"Creating a department\" and adding people\nto it.\n\nCongratulations! You've just created a custom email for free!If You want to\ncreate a new email for the same domain later, you can do it but only from the\nadmin ___@yandex.com account that you've created at the beggining as it is only\nadmin account in your organization.\n\nIf You know about other great Yandex functionalities, leave them in the comments\n:)\n\nThanks for reading through!","feature_image":"__GHOST_URL__/content/images/2021/06/bigstock-Login-Into-Account-In-Email-En-239697814-800x504.jpg","featured":0,"type":"post","status":"published","locale":null,"visibility":"public","email_recipient_filter":"all","created_at":"2021-06-14T11:54:46.000Z","updated_at":"2021-06-15T07:30:11.000Z","published_at":"2021-06-15T07:24:41.000Z","custom_excerpt":"In this article, you will learn how to create a free email with a custom domain. I've shown how to configure Yandex with your DNS.","codeinjection_head":null,"codeinjection_foot":null,"custom_template":null,"canonical_url":null,"newsletter_id":null,"lexical":null},{"id":"6375187bf20ac751bf7a5ea9","uuid":"93d59b8f-5fc6-4d2a-86fb-17a7a897d147","title":"Last Occurrence [Linear Search] easy","slug":"last-occurrence","mobiledoc":"{\"version\":\"0.3.1\",\"atoms\":[],\"cards\":[[\"html\",{\"html\":\"$$1 \\\\le N \\\\le 10^5$$\\n$$1 \\\\le  A[i] \\\\le 10^9$$\\n$$1 \\\\le M \\\\le 10^9$$\"}],[\"code\",{\"code\":\"5 1\\n1 2 3 4 1\"}],[\"code\",{\"code\":\"5\"}],[\"code\",{\"code\":\"use linear_sort_reverse_search_rust_easy::reverse_search;\\nuse std::io;\\n\\nfn main() -> io::Result<()> {\\n    reverse_search(&mut io::stdin(), &mut io::stdout())\\n}\",\"language\":\"rust\"}],[\"code\",{\"code\":\"use std::io::{Error, Read, Write};\\n\\n#[cfg(test)]\\nmod tests {\\n    use super::*;\\n\\n    #[test]\\n    fn basic_test() {\\n        let mut output: Vec<u8> = Vec::new();\\n\\n        reverse_search(&mut \\\"5 1\\n1 2 3 4 1\\\".as_bytes(), &mut output).unwrap();\\n        assert_eq!(&output, b\\\"5\\\\n\\\");\\n    }\\n\\n\\n    #[test]\\n    fn not_found_test() {\\n        let mut output: Vec<u8> = Vec::new();\\n\\n        reverse_search(&mut \\\"5 7\\n1 2 3 4 1\\\".as_bytes(), &mut output).unwrap();\\n        assert_eq!(&output, b\\\"-1\\\\n\\\");\\n    }\\n}\\n\\npub fn reverse_search(\\n    handle: &mut impl Read ,\\n    output: &mut impl Write,\\n) -> Result<(), Error> {\\n    let mut buffer = \\\"\\\".to_string();\\n    let mut out = \\\"\\\".to_string();\\n    handle.read_to_string(&mut buffer)?;\\n\\n    let mut lines = buffer.lines();\\n\\n    let mut some_line = match lines.next() {\\n        Some(line) => line,\\n        _ => \\\"\\\"\\n    };\\n\\n    let mut iterator = some_line.split_ascii_whitespace();\\n\\n    let mut len: usize = match iterator.next() {\\n        Some(p) => p.trim().parse().expect(\\\"can't read\\\"),\\n        None => 0\\n    };\\n    let  needle = match iterator.next() {\\n        Some(p) => p.trim().parse().expect(\\\"can't read\\\"),\\n        None => 0\\n    };\\n\\n    some_line = match lines.next() {\\n        Some(line) => line,\\n        _ => \\\"\\\"\\n    };\\n\\n    let mut vec:Vec<i32> = vec![0; len];\\n\\n    iterator = some_line.split_ascii_whitespace();\\n\\n    for n in 0..len {\\n        vec[n] = match iterator.next() {\\n            Some(p) => p.trim().parse().expect(\\\"can't read\\\"),\\n            None => 0\\n        };\\n    }\\n\\n    let mut iter = vec.iter().rev();\\n\\n    while let Some(num) = iter.next() {\\n        if *num == needle {\\n            out = format!(\\\"{}\\\\n\\\", len);\\n            break;\\n        }\\n        len -= 1;\\n    }\\n\\n    if len == 0 {\\n        out = format!(\\\"-1\\\\n\\\");\\n    }\\n\\n    output.write_all(out.to_uppercase().as_bytes())?;\\n\\n    Ok(())\\n}\\n\",\"language\":\"rust\"}],[\"bookmark\",{\"type\":\"bookmark\",\"url\":\"https://github.com/gustawdaniel/linear-sort-reverse-search-rust-easy\",\"metadata\":{\"url\":\"https://github.com/gustawdaniel/linear-sort-reverse-search-rust-easy\",\"title\":\"GitHub - gustawdaniel/linear-sort-reverse-search-rust-easy: https://preciselab.io/last-occurrence/\",\"description\":\"https://preciselab.io/last-occurrence/. Contribute to gustawdaniel/linear-sort-reverse-search-rust-easy development by creating an account on GitHub.\",\"author\":\"gustawdaniel\",\"publisher\":\"GitHub\",\"thumbnail\":\"https://opengraph.githubassets.com/0b4950012139fd8b6e5ae96e677386be992685851612dd1a1288b51972c9fd93/gustawdaniel/linear-sort-reverse-search-rust-easy\",\"icon\":\"https://github.githubassets.com/favicons/favicon.svg\"}}]],\"markups\":[[\"em\"],[\"strong\"],[\"code\"]],\"sections\":[[1,\"p\",[[0,[],0,\"You have been given an array of size \"],[0,[0],1,\"N\"],[0,[],0,\" consisting of integers. In addition you have been given an element \"],[0,[0],1,\"M\"],[0,[],0,\" you need to find and print the index of the last occurrence of this element \"],[0,[0],1,\"M\"],[0,[],0,\" in the array if it exists in it, otherwise print -1. Consider this array to be 1 indexed.\"]]],[1,\"p\",[[0,[1],1,\"Input Format\"],[0,[],0,\":\"]]],[1,\"p\",[[0,[],0,\"The first line consists of 2 integers \"],[0,[0],1,\"N\"],[0,[],0,\" and \"],[0,[0],1,\"M\"],[0,[],0,\" denoting the size of the array and the element to be searched for in the array respectively . The next line contains \"],[0,[0],1,\"N\"],[0,[],0,\" space separated integers denoting the elements of of the array.\"]]],[1,\"p\",[[0,[1],1,\"Output Format\"]]],[1,\"p\",[[0,[],0,\"Print a single integer denoting the index of the last occurrence of integer \"],[0,[0],1,\"M\"],[0,[],0,\" in the array if it exists, otherwise print -1.\"]]],[1,\"p\",[[0,[1],1,\"Constraints\"]]],[10,0],[1,\"p\",[[0,[1],1,\"SAMPLE INPUT\"]]],[10,1],[1,\"p\",[[0,[1],1,\"SAMPLE OUTPUT\"]]],[10,2],[1,\"p\",[[0,[],0,\"Solution\"]]],[1,\"p\",[[0,[],0,\"In \"],[0,[2],1,\"main.rs\"],[0,[],0,\" we can add main function that process in and out streams.\"]]],[10,3],[1,\"p\",[[0,[],0,\"in \"],[0,[2],1,\"lib.rs\"],[0,[],0,\" there is rest of our code\"]]],[10,4],[10,5],[1,\"p\",[]]],\"ghostVersion\":\"4.0\"}","html":"<p>You have been given an array of size <em>N</em> consisting of integers. In addition you have been given an element <em>M</em> you need to find and print the index of the last occurrence of this element <em>M</em> in the array if it exists in it, otherwise print -1. Consider this array to be 1 indexed.</p><p><strong>Input Format</strong>:</p><p>The first line consists of 2 integers <em>N</em> and <em>M</em> denoting the size of the array and the element to be searched for in the array respectively . The next line contains <em>N</em> space separated integers denoting the elements of of the array.</p><p><strong>Output Format</strong></p><p>Print a single integer denoting the index of the last occurrence of integer <em>M</em> in the array if it exists, otherwise print -1.</p><p><strong>Constraints</strong></p><!--kg-card-begin: html-->$$1 \\le N \\le 10^5$$\n$$1 \\le  A[i] \\le 10^9$$\n$$1 \\le M \\le 10^9$$<!--kg-card-end: html--><p><strong>SAMPLE INPUT</strong></p><pre><code>5 1\n1 2 3 4 1</code></pre><p><strong>SAMPLE OUTPUT</strong></p><pre><code>5</code></pre><p>Solution</p><p>In <code>main.rs</code> we can add main function that process in and out streams.</p><pre><code class=\"language-rust\">use linear_sort_reverse_search_rust_easy::reverse_search;\nuse std::io;\n\nfn main() -&gt; io::Result&lt;()&gt; {\n    reverse_search(&amp;mut io::stdin(), &amp;mut io::stdout())\n}</code></pre><p>in <code>lib.rs</code> there is rest of our code</p><pre><code class=\"language-rust\">use std::io::{Error, Read, Write};\n\n#[cfg(test)]\nmod tests {\n    use super::*;\n\n    #[test]\n    fn basic_test() {\n        let mut output: Vec&lt;u8&gt; = Vec::new();\n\n        reverse_search(&amp;mut \"5 1\n1 2 3 4 1\".as_bytes(), &amp;mut output).unwrap();\n        assert_eq!(&amp;output, b\"5\\n\");\n    }\n\n\n    #[test]\n    fn not_found_test() {\n        let mut output: Vec&lt;u8&gt; = Vec::new();\n\n        reverse_search(&amp;mut \"5 7\n1 2 3 4 1\".as_bytes(), &amp;mut output).unwrap();\n        assert_eq!(&amp;output, b\"-1\\n\");\n    }\n}\n\npub fn reverse_search(\n    handle: &amp;mut impl Read ,\n    output: &amp;mut impl Write,\n) -&gt; Result&lt;(), Error&gt; {\n    let mut buffer = \"\".to_string();\n    let mut out = \"\".to_string();\n    handle.read_to_string(&amp;mut buffer)?;\n\n    let mut lines = buffer.lines();\n\n    let mut some_line = match lines.next() {\n        Some(line) =&gt; line,\n        _ =&gt; \"\"\n    };\n\n    let mut iterator = some_line.split_ascii_whitespace();\n\n    let mut len: usize = match iterator.next() {\n        Some(p) =&gt; p.trim().parse().expect(\"can't read\"),\n        None =&gt; 0\n    };\n    let  needle = match iterator.next() {\n        Some(p) =&gt; p.trim().parse().expect(\"can't read\"),\n        None =&gt; 0\n    };\n\n    some_line = match lines.next() {\n        Some(line) =&gt; line,\n        _ =&gt; \"\"\n    };\n\n    let mut vec:Vec&lt;i32&gt; = vec![0; len];\n\n    iterator = some_line.split_ascii_whitespace();\n\n    for n in 0..len {\n        vec[n] = match iterator.next() {\n            Some(p) =&gt; p.trim().parse().expect(\"can't read\"),\n            None =&gt; 0\n        };\n    }\n\n    let mut iter = vec.iter().rev();\n\n    while let Some(num) = iter.next() {\n        if *num == needle {\n            out = format!(\"{}\\n\", len);\n            break;\n        }\n        len -= 1;\n    }\n\n    if len == 0 {\n        out = format!(\"-1\\n\");\n    }\n\n    output.write_all(out.to_uppercase().as_bytes())?;\n\n    Ok(())\n}\n</code></pre><figure class=\"kg-card kg-bookmark-card\"><a class=\"kg-bookmark-container\" href=\"https://github.com/gustawdaniel/linear-sort-reverse-search-rust-easy\"><div class=\"kg-bookmark-content\"><div class=\"kg-bookmark-title\">GitHub - gustawdaniel/linear-sort-reverse-search-rust-easy: https://preciselab.io/last-occurrence/</div><div class=\"kg-bookmark-description\">https://preciselab.io/last-occurrence/. Contribute to gustawdaniel/linear-sort-reverse-search-rust-easy development by creating an account on GitHub.</div><div class=\"kg-bookmark-metadata\"><img class=\"kg-bookmark-icon\" src=\"https://github.githubassets.com/favicons/favicon.svg\"><span class=\"kg-bookmark-author\">GitHub</span><span class=\"kg-bookmark-publisher\">gustawdaniel</span></div></div><div class=\"kg-bookmark-thumbnail\"><img src=\"https://opengraph.githubassets.com/0b4950012139fd8b6e5ae96e677386be992685851612dd1a1288b51972c9fd93/gustawdaniel/linear-sort-reverse-search-rust-easy\"></div></a></figure>","comment_id":"6375187bf20ac751bf7a5ea9","plaintext":"You have been given an array of size N consisting of integers. In addition you\nhave been given an element M you need to find and print the index of the last\noccurrence of this element M in the array if it exists in it, otherwise print\n-1. Consider this array to be 1 indexed.\n\nInput Format:\n\nThe first line consists of 2 integers N and M denoting the size of the array and\nthe element to be searched for in the array respectively . The next line\ncontains N space separated integers denoting the elements of of the array.\n\nOutput Format\n\nPrint a single integer denoting the index of the last occurrence of integer M in\nthe array if it exists, otherwise print -1.\n\nConstraints\n\n$$1 \\le N \\le 10^5$$\n$$1 \\le A[i] \\le 10^9$$\n$$1 \\le M \\le 10^9$$SAMPLE INPUT\n\n5 1\n1 2 3 4 1\n\nSAMPLE OUTPUT\n\n5\n\nSolution\n\nIn main.rs we can add main function that process in and out streams.\n\nuse linear_sort_reverse_search_rust_easy::reverse_search;\nuse std::io;\n\nfn main() -> io::Result<()> {\n    reverse_search(&mut io::stdin(), &mut io::stdout())\n}\n\nin lib.rs there is rest of our code\n\nuse std::io::{Error, Read, Write};\n\n#[cfg(test)]\nmod tests {\n    use super::*;\n\n    #[test]\n    fn basic_test() {\n        let mut output: Vec<u8> = Vec::new();\n\n        reverse_search(&mut \"5 1\n1 2 3 4 1\".as_bytes(), &mut output).unwrap();\n        assert_eq!(&output, b\"5\\n\");\n    }\n\n\n    #[test]\n    fn not_found_test() {\n        let mut output: Vec<u8> = Vec::new();\n\n        reverse_search(&mut \"5 7\n1 2 3 4 1\".as_bytes(), &mut output).unwrap();\n        assert_eq!(&output, b\"-1\\n\");\n    }\n}\n\npub fn reverse_search(\n    handle: &mut impl Read ,\n    output: &mut impl Write,\n) -> Result<(), Error> {\n    let mut buffer = \"\".to_string();\n    let mut out = \"\".to_string();\n    handle.read_to_string(&mut buffer)?;\n\n    let mut lines = buffer.lines();\n\n    let mut some_line = match lines.next() {\n        Some(line) => line,\n        _ => \"\"\n    };\n\n    let mut iterator = some_line.split_ascii_whitespace();\n\n    let mut len: usize = match iterator.next() {\n        Some(p) => p.trim().parse().expect(\"can't read\"),\n        None => 0\n    };\n    let  needle = match iterator.next() {\n        Some(p) => p.trim().parse().expect(\"can't read\"),\n        None => 0\n    };\n\n    some_line = match lines.next() {\n        Some(line) => line,\n        _ => \"\"\n    };\n\n    let mut vec:Vec<i32> = vec![0; len];\n\n    iterator = some_line.split_ascii_whitespace();\n\n    for n in 0..len {\n        vec[n] = match iterator.next() {\n            Some(p) => p.trim().parse().expect(\"can't read\"),\n            None => 0\n        };\n    }\n\n    let mut iter = vec.iter().rev();\n\n    while let Some(num) = iter.next() {\n        if *num == needle {\n            out = format!(\"{}\\n\", len);\n            break;\n        }\n        len -= 1;\n    }\n\n    if len == 0 {\n        out = format!(\"-1\\n\");\n    }\n\n    output.write_all(out.to_uppercase().as_bytes())?;\n\n    Ok(())\n}\n\n\nGitHub - gustawdaniel/linear-sort-reverse-search-rust-easy:\nhttps://preciselab.io/last-occurrence/https://preciselab.io/last-occurrence/.\nContribute to gustawdaniel/linear-sort-reverse-search-rust-easy development by\ncreating an account on GitHub.GitHubgustawdaniel\n[https://github.com/gustawdaniel/linear-sort-reverse-search-rust-easy]","feature_image":"__GHOST_URL__/content/images/2022/11/bgw.png","featured":0,"type":"post","status":"published","locale":null,"visibility":"public","email_recipient_filter":"all","created_at":"2022-11-16T17:06:03.000Z","updated_at":"2022-11-28T14:40:24.000Z","published_at":"2022-11-16T17:22:37.000Z","custom_excerpt":"Find and print the index of the last occurrence of element in the array.","codeinjection_head":null,"codeinjection_foot":null,"custom_template":null,"canonical_url":null,"newsletter_id":null,"lexical":null},{"id":"6379e4e9f20ac751bf7a5ee3","uuid":"32608cb5-76d8-4c70-a109-5d8ee3ac2a5c","title":"Pulumi - Infrastructure as a Code [ Digital Ocean ]","slug":"pulumi-infrastructure-as-a-code","mobiledoc":"{\"version\":\"0.3.1\",\"atoms\":[],\"cards\":[[\"image\",{\"src\":\"__GHOST_URL__/content/images/2022/11/02102016_ENIAC_programmers_LA.width-600.jpg\",\"width\":600,\"height\":391,\"caption\":\"first digital computer programmers\"}],[\"image\",{\"src\":\"__GHOST_URL__/content/images/2022/11/punch-card-machine.png\",\"width\":350,\"height\":350}],[\"image\",{\"src\":\"__GHOST_URL__/content/images/2022/11/Docker-linux-interfaces.svg.png\",\"width\":220,\"height\":203}],[\"code\",{\"code\":\"provider \\\"aws\\\" {\\n  region = \\\"us-west-2\\\"\\n}\\n\\nprovider \\\"random\\\" {}\\n\\nresource \\\"random_pet\\\" \\\"name\\\" {}\\n\\nresource \\\"aws_instance\\\" \\\"web\\\" {\\n  ami           = \\\"ami-a0cfeed8\\\"\\n  instance_type = \\\"t2.micro\\\"\\n  user_data     = file(\\\"init-script.sh\\\")\\n\\n  tags = {\\n    Name = random_pet.name.id\\n  }\\n}\",\"language\":\"tf\"}],[\"bookmark\",{\"type\":\"bookmark\",\"url\":\"https://gustawdaniel.com/infrastrukura-defniowana-jako-kod/\",\"metadata\":{\"url\":\"https://gustawdaniel.com/infrastrukura-defniowana-jako-kod/\",\"title\":\"Infrastrukura defniowana przez kod (terraform + digital ocean)\",\"description\":\"W scrapingu ważnym czynnikiem jest skala do jakiej możemy rozszerzyć tempo\\npobierania i przetwarzania danych. Kiedy kilka lat temu pisałem swój pierwszy\\nsystem, który równolegle zbierał dane używając kilkunastu serwerów, każdy z tych\\nserwerów był przeze mnie “wyklikany” w panelu dostawcy. Teraz pok…\",\"author\":\"Daniel Gustaw\",\"publisher\":\"Daniel Gustaw\",\"thumbnail\":\"https://gustawdaniel.com/content/images/2021/04/image6-1.png\",\"icon\":\"https://gustawdaniel.com/favicon.ico\"}}],[\"image\",{\"src\":\"__GHOST_URL__/content/images/2022/11/72cy2v.jpg\",\"width\":750,\"height\":500}],[\"code\",{\"code\":\"curl -sSL https://get.pulumi.com | sh\"}],[\"code\",{\"code\":\"mkdir pulumi && cd pulumi\\n\"}],[\"code\",{\"code\":\"pulumi new -l | grep typescript\\n\"}],[\"code\",{\"code\":\"pulumi new digitalocean-typescript\\n\"}],[\"code\",{\"code\":\"npm i dotenv jsrender\\n\"}],[\"code\",{\"code\":\"DOCKER_REGISTRY_DOMAIN=___ \\nDOCKER_TOKEN=__\\n\"}],[\"code\",{\"code\":\"#!/bin/bash\\n\\nexport DOCKER_REGISTRY_DOMAIN={{:DOCKER_REGISTRY_DOMAIN}}\\nexport DOCKER_TOKEN={{:DOCKER_TOKEN}}\\n\\ncat <<EOT >> ~/.bashrc\\nexport DOCKER_REGISTRY_DOMAIN={{:DOCKER_REGISTRY_DOMAIN}}\\nexport DOCKER_TOKEN={{:DOCKER_TOKEN}}\\nEOT\\n\\ncat <<EOT >> ~/.tmux.conf\\nset -g terminal-overrides 'xterm*:smcup@:rmcup@'\\n\\n# remap prefix from 'C-b' to 'C-a'\\nunbind C-b\\nset-option -g prefix C-a\\nbind-key C-a send-prefix\\n\\n# switch panes using Alt-arrow without prefix\\nbind -n M-Left select-pane -L\\nbind -n M-Right select-pane -R\\nbind -n M-Up select-pane -U\\nbind -n M-Down select-pane -D\\n\\n# Enable mouse control (clickable windows, panes, resizable panes)\\n#set -g mouse-select-window on\\n#set -g mouse-select-pane on\\n#set -g mouse-resize-pane on\\n\\n# Enable mouse mode (tmux 2.1 and above)\\nset -g mouse on\\n\\nset -g pane-border-format \\\"#{pane_index}#{?@custom_pane_title,:#{@custom_pane_title},}:#{pane_title}\\\"\\n\\nbind e set-window-option synchronize-panes\\nEOT\\n\\nsudo systemctl disable snapd.service\\nsudo systemctl disable snapd.socket\\nsudo systemctl disable snapd.seeded.service\\n\\nsudo apt autoremove --purge snapd -y\\nsudo rm -rf /var/cache/snapd/\\nrm -rf ~/snap\\n\\necho \\\"${DOCKER_TOKEN}\\\" | docker login -u \\\"${DOCKER_TOKEN}\\\" \\\"${DOCKER_REGISTRY_DOMAIN}\\\" --password-stdin;\\n\\napt -y update\\napt -y install python3 python3-pip\\npip3 install docker docker-compose\\n\\ngit clone --recurse-submodules https://github.com/evertramos/nginx-proxy-automation.git ~/proxy && cd ~/proxy/bin && ./fresh-start.sh --yes -e gustaw.daniel@gmail.com --use-nginx-conf-files\\n\",\"language\":\"bash\"}],[\"code\",{\"code\":\"doctl auth ls\"}],[\"code\",{\"code\":\"doctl auth switch --context preciselab\\n\"}],[\"code\",{\"code\":\"doctl account get\\n\"}],[\"code\",{\"code\":\"doctl auth init\\n\"}],[\"image\",{\"src\":\"__GHOST_URL__/content/images/2022/11/2022-11-26_16-57-1.png\",\"width\":1252,\"height\":615}],[\"code\",{\"code\":\"pulumi config set digitalocean:token TOKEN_VALUE --secret\\n\"}],[\"code\",{\"code\":\"doctl compute ssh-key list\\n\"}],[\"code\",{\"code\":\"ssh-keygen -t ed25519 -C \\\"gustaw.daniel@gmail.com\\\" -f ~/.ssh/id_ed25519\\n\"}],[\"image\",{\"src\":\"__GHOST_URL__/content/images/2022/11/2022-11-26_18-25.png\",\"width\":1242,\"height\":414}],[\"code\",{\"code\":\"doctl compute ssh-key list\\n\"}],[\"code\",{\"code\":\"\\\"allowSyntheticDefaultImports\\\": true, \\n\\\"esModuleInterop\\\": true\\n\",\"language\":\"json\"}],[\"code\",{\"code\":\"import 'dotenv/config'\\nimport * as pulumi from \\\"@pulumi/pulumi\\\";\\nimport * as digitalocean from \\\"@pulumi/digitalocean\\\";\\nimport fs from 'fs';\\nimport {templates} from 'jsrender';\\n\\n// we reading template ( there are no secretes )\\nconst userDataTemplate = fs.readFileSync('./userData.sh').toString();\\n\\n// secretes are injected during render\\nconst userData = templates(userDataTemplate).render(process.env)\\n\\n// this is our default droplet config\\nconst dropletConfig = {\\n    image: \\\"docker-20-04\\\",\\n    region: \\\"fra1\\\",\\n    size: \\\"s-1vcpu-1gb-intel\\\",\\n    monitoring: true,\\n    backups: false,\\n    userData, // there is rendered script to initiate server\\n    sshKeys: [\\n        // here are ids of keys saved on digital ocean\\n        '36403277', //    Github Actions\\n        '34336169', //    Daniel Laptop\\n    ]\\n};\\n\\n// now we defining that we need two servers\\nconst dropletApi = new digitalocean.Droplet(\\\"xue-api\\\", dropletConfig);\\nconst dropletUi = new digitalocean.Droplet(\\\"xue-ui\\\", dropletConfig);\\n\\n// and single main domain\\nconst domain = new digitalocean.Domain(\\\"xue.academy\\\", {\\n    name: \\\"xue.academy\\\",\\n}, {deleteBeforeReplace: true});\\n\\n// two environments:\\n// a) production without subdomain \\n// b) staging with subdomain stag\\nconst envs:Array<{name: 'stag' | 'prod', subdomain: string}> = [{\\n    subdomain: '',\\n    name: 'prod'\\n}, {\\n    subdomain: 'stag',\\n    name: 'stag'\\n}]\\n\\n// there are helpers function to name resources correctly\\nfunction recordName(envName: 'prod' | 'stag', name: string) {\\n    return envName === 'prod' ? name : `${name}-${envName}`;\\n}\\n\\n// and simplify subdomain selecton\\nfunction subdomainName(envName: 'prod' | 'stag', name: string) {\\n    return envName === 'prod' ? name : (name === '@' ? `${envName}` : `${name}.${envName}`);\\n}\\n\\n// we can iterate over environments connecting domains with servers\\nfor(let env of envs) {\\n    const dnsUi = new digitalocean.DnsRecord(recordName(env.name, `xue.academy`), {\\n        name: subdomainName(env.name, \\\"@\\\"),\\n        domain: domain.id,\\n        value: dropletUi.ipv4Address,\\n        type: 'A'\\n    }, {deleteBeforeReplace: true})\\n\\n    const dnsApi = new digitalocean.DnsRecord(recordName(env.name, \\\"api.xue.academy\\\"), {\\n        name: subdomainName(env.name, \\\"api\\\"),\\n        domain: domain.id,\\n        value: dropletApi.ipv4Address,\\n        type: 'A'\\n    }, {deleteBeforeReplace: true})\\n}\\n\\n// Export the name of the domain\\nexport const ipUi = dropletUi.ipv4Address;\\nexport const ipApi = dropletApi.ipv4Address;\\n\",\"language\":\"typescript\"}],[\"code\",{\"code\":\"const mysql = new digitalocean.DatabaseCluster(\\\"mysql\\\", {\\n  engine: \\\"mysql\\\",\\n  nodeCount: 1,\\n  region: \\\"fra1\\\",\\n  size: \\\"db-s-1vcpu-1gb\\\",\\n  version: \\\"8\\\",\\n}, {parent: playground});\\n\\nconst coreDatabase = new digitalocean.DatabaseDb(\\\"database-core\\\", {clusterId: mysql.id});\\n\\nexport const mysqlId = mysql.id;\\nexport const mysqlHost = mysql.host;\\nexport const mysqlUser = mysql.user;\\nexport const mysqlPassword = mysql.password;\\nexport const mysqlPort = mysql.port;\\nexport const mysqlUri = mysql.uri;\",\"language\":\"typescript\"}],[\"code\",{\"code\":\"const redis = new digitalocean.DatabaseCluster(\\\"redis\\\", {\\n  engine: \\\"redis\\\",\\n  nodeCount: 1,\\n  region: \\\"fra1\\\",\\n  size: \\\"db-s-1vcpu-1gb\\\",\\n  version: \\\"6\\\",\\n}, {parent: playground});\\n\\nexport const redisHost = redis.host;\\nexport const redisUser = redis.user;\\nexport const redisPassword = redis.password;\\nexport const redisPort = redis.port;\\nexport const redisUri = redis.uri;\",\"language\":\"typescript\"}],[\"image\",{\"src\":\"__GHOST_URL__/content/images/2022/11/72ccir.jpg\",\"width\":500,\"height\":500}]],\"markups\":[[\"code\"]],\"sections\":[[1,\"h3\",[[0,[],0,\"How deployment evolved by years?\"]]],[1,\"p\",[[0,[],0,\"Initially (70 years ago) computers was programmed by manual change of cables connections. There was no personal desktop so programs was written on production. No deployment - no problem.\"]]],[10,0],[1,\"p\",[[0,[],0,\"About decade later IBM introduced punched cards so deployment or installation was performed by insert of card with program to a reader.\"]]],[10,1],[1,\"p\",[[0,[],0,\"Next breakthrough - internet and ftp (1971) protocols changed everything. To move programs to other machines you stopped needing physical driver other than cables connecting with network.\"]]],[1,\"p\",[[0,[],0,\"Generally process was simple. You had to copy binaries to mainframe and start your program here.\"]]],[1,\"p\",[[0,[],0,\"There was only one problem. Cost of computers was huge, so to utilize them optimally and get return of investment there was introduced virtualisation - logical dividing resources of machine between processes.\"]]],[1,\"p\",[[0,[],0,\"Unfortunatelly on x86 machines there was problem with virtualisation some processor instructions and in decade 1980-1990 this method was abandoned with the end of supercomputers epoch.\"]]],[1,\"p\",[[0,[],0,\"We come back to virtualisation in 1990 not only because of increasing cost and inefectivness of infrastructure maintainance but also thanks to adaptive virtualisation technique introduced by VMware. They detected instructions that was problematic during virtualisation and convert them to these safe equivalents. \"]]],[1,\"p\",[[0,[],0,\"In my opinion, for deployment process this is revolution similar to internet. Internet digitalised a carrier of program during deployment, but virtualization allowed to change parameters of server without touching hardware.\"]]],[1,\"p\",[[0,[],0,\"These changes was important for cloud providers and IaaS branch, but developers was divided on these that putting on servers his own virtual machines or these that using ftp or scp to copy programs to vps delivered by his providers.\"]]],[1,\"p\",[[0,[],0,\"Next huge revolution was Docker written in Go in 2013, and using namespaces available from linux kernel 2.6.24  2008. His popularity exploded in 2017. Main problem of time before docker was configuration of server to use our application. When runtime environment was configured on server, then two different applications with different version or configuration of runtime couldn't be installed on the same host. If they was packed as virtual machines, then all operating system layer was duplicated. Docker solved these problems.\"]]],[10,2],[1,\"p\",[[0,[],0,\"But it is not the end. When people learned how to use Docker and created CI/CD flows to automate deployment and testing processes they realised that server managements can be done also on code layer. \"]]],[1,\"p\",[[0,[],0,\"Infrastructure as a code has the same advantage on admin panel to manage servers as commanline over gui in managing personal desktop - is universal and can be easy managed by scripts written by end user.\"]]],[1,\"p\",[[0,[],0,\"Dominating possition among IaC products have Terraform developed by Hashicorp. It is easy to learn but require custom config language. \"]]],[1,\"p\",[[0,[],0,\"this is examplary config:\"]]],[10,3],[1,\"p\",[[0,[],0,\"We will not focus on any line of this code. If you are interesed in this and know polish language I wrote article about terraform here:\"]]],[10,4],[1,\"p\",[[0,[],0,\"Now we will focus on competitor of Terraform. Lets discuss pulumi.\"]]],[10,5],[1,\"h1\",[[0,[],0,\"Pulumi\"]]],[1,\"p\",[[0,[],0,\"Pulumi is plafrom to define infrastructure by programs written in:\"]]],[3,\"ul\",[[[0,[],0,\"typescript\"]],[[0,[],0,\"python\"]],[[0,[],0,\"go\"]],[[0,[],0,\"c#\"]],[[0,[],0,\"java\"]],[[0,[],0,\"yaml\"]]]],[1,\"p\",[[0,[],0,\"It supports over 70 cloud providers. Key difference between terraform is simplicity of customization obtained by processing data used to define infrastructure parameters.\"]]],[1,\"p\",[[0,[],0,\"Instead of file with \"],[0,[0],1,\"init-script\"],[0,[],0,\" to execute on new \"],[0,[0],1,\"vps\"],[0,[],0,\" I can use template and render it with my env variables. Instead of copy config, I can loop over environments connecting subdomains to proper servers.\"]]],[1,\"p\",[[0,[],0,\"To install pulumi cli run command:\"]]],[10,6],[1,\"p\",[[0,[],0,\"We can start from creation directory for our config:\"]]],[10,7],[1,\"p\",[[0,[],0,\"Now we want to create new project using template. To list typescript templates we can type:\"]]],[10,8],[1,\"p\",[[0,[],0,\"Lets create config for Digital Ocean\"]]],[10,9],[1,\"p\",[[0,[],0,\"Now we will install two packages:\"]]],[3,\"ul\",[[[0,[],0,\"dotenv - to use values defined in .env file and append them to \"],[0,[0],1,\"process\"]],[[0,[],0,\"jsrender - to render template of script to prepare server\"]]]],[10,10],[1,\"p\",[[0,[],0,\"Now we can create \"],[0,[0],1,\".env\"],[0,[],0,\" file with two values:\"]]],[10,11],[1,\"p\",[[0,[],0,\"We need all servers with the same initial preparation. Below I lising our requirements:\"]]],[3,\"ul\",[[[0,[],0,\"we need to be logged in to docker registry\"]],[[0,[],0,\"tmux have to be configured with proper key binding\"]],[[0,[],0,\"snap have to be disable and removed to avoid 100% cpu bug\"]],[[0,[],0,\"python with \"],[0,[0],1,\"docker\"],[0,[],0,\" and \"],[0,[0],1,\"docker-compose\"],[0,[],0,\" packages for ansible installed\"]],[[0,[0],1,\"nginx-proxy-automation\"],[0,[],0,\" installed and started\"]]]],[1,\"p\",[[0,[],0,\"To satisfy them lets create \"],[0,[0],1,\"userData.sh\"],[0,[],0,\" with content:\"]]],[10,12],[1,\"h3\",[[0,[],0,\"Digital Ocean Personal Token\"]]],[1,\"p\",[[0,[],0,\"Now we have to select ssh keys for server. To do it we need \"],[0,[0],1,\"doctl\"],[0,[],0,\" - cli for digital ocean. In this platform you can have account that belong to different teams (contexts). To list contexts use\"]]],[10,13],[1,\"p\",[[0,[],0,\"We can select context by:\"]]],[10,14],[1,\"p\",[[0,[],0,\"Lets check if we have correct access:\"]]],[10,15],[1,\"p\",[[0,[],0,\"if you will see error, we can login by token\"]]],[10,16],[1,\"p\",[[0,[],0,\"You will need token that can be generated on in \"],[0,[0],1,\"API\"],[0,[],0,\" tab in Digital Ocean Panel\"]]],[10,17],[1,\"p\",[[0,[],0,\"The same token should be used to connect pulumi with your digital ocean:\"]]],[10,18],[1,\"h3\",[[0,[],0,\"SSH Keys\"]]],[1,\"p\",[[0,[],0,\"In this team you have to store your ssh keys. To list them use:\"]]],[10,19],[1,\"p\",[[0,[],0,\"in new project it will be empty list, so create keys. If you want to isolate keys in CI/CD from your personal as file name you can use your project.\"]]],[10,20],[1,\"p\",[[0,[],0,\"add public keys to security settings in digital ocean:\"]]],[10,21],[1,\"p\",[[0,[],0,\"After adding you can again ask about keys because you will need these numbers returned by command:\"]]],[10,22],[1,\"h3\",[[0,[],0,\"Pulumi index.ts config\"]]],[1,\"p\",[[0,[],0,\"To use import withou stars we need to add two \"],[0,[0],1,\"compilerOptions\"],[0,[],0,\" to your \"],[0,[0],1,\"tsconfig.json\"]]],[10,23],[1,\"p\",[[0,[],0,\"And finally creme de la creme - \"],[0,[0],1,\"index.ts\"],[0,[],0,\" file\"]]],[10,24],[1,\"p\",[[0,[],0,\"This in super simple config but we can easy add mysql databse\"]]],[10,25],[1,\"p\",[[0,[],0,\"or redis instance\"]]],[10,26],[1,\"p\",[[0,[],0,\"I hope this article will help you start with pulumi on Digital Ocean and follow primary devops rule:\"]]],[1,\"blockquote\",[[0,[],0,\"Better spend 10 hours failing to automate, than do task manually.\"]]],[10,27],[1,\"p\",[[0,[],0,\"Lets sum up advantages of IaC approach.\"]]],[3,\"ul\",[[[0,[],0,\"more reliable infrastructure management\"]],[[0,[],0,\"you can use the same approval / testing flow than for code to infrastructure\"]],[[0,[],0,\"you can easy multiply environments without clicking in admin panels of providers\"]],[[0,[],0,\"migrations of project to clients account indepenedent from infrastructure provider migration mechanism\"]]]]],\"ghostVersion\":\"4.0\"}","html":"<h3 id=\"how-deployment-evolved-by-years\">How deployment evolved by years?</h3><p>Initially (70 years ago) computers was programmed by manual change of cables connections. There was no personal desktop so programs was written on production. No deployment - no problem.</p><figure class=\"kg-card kg-image-card kg-card-hascaption\"><img src=\"__GHOST_URL__/content/images/2022/11/02102016_ENIAC_programmers_LA.width-600.jpg\" class=\"kg-image\" alt loading=\"lazy\" width=\"600\" height=\"391\" srcset=\"__GHOST_URL__/content/images/2022/11/02102016_ENIAC_programmers_LA.width-600.jpg 600w\"><figcaption>first digital computer programmers</figcaption></figure><p>About decade later IBM introduced punched cards so deployment or installation was performed by insert of card with program to a reader.</p><figure class=\"kg-card kg-image-card\"><img src=\"__GHOST_URL__/content/images/2022/11/punch-card-machine.png\" class=\"kg-image\" alt loading=\"lazy\" width=\"350\" height=\"350\"></figure><p>Next breakthrough - internet and ftp (1971) protocols changed everything. To move programs to other machines you stopped needing physical driver other than cables connecting with network.</p><p>Generally process was simple. You had to copy binaries to mainframe and start your program here.</p><p>There was only one problem. Cost of computers was huge, so to utilize them optimally and get return of investment there was introduced virtualisation - logical dividing resources of machine between processes.</p><p>Unfortunatelly on x86 machines there was problem with virtualisation some processor instructions and in decade 1980-1990 this method was abandoned with the end of supercomputers epoch.</p><p>We come back to virtualisation in 1990 not only because of increasing cost and inefectivness of infrastructure maintainance but also thanks to adaptive virtualisation technique introduced by VMware. They detected instructions that was problematic during virtualisation and convert them to these safe equivalents. </p><p>In my opinion, for deployment process this is revolution similar to internet. Internet digitalised a carrier of program during deployment, but virtualization allowed to change parameters of server without touching hardware.</p><p>These changes was important for cloud providers and IaaS branch, but developers was divided on these that putting on servers his own virtual machines or these that using ftp or scp to copy programs to vps delivered by his providers.</p><p>Next huge revolution was Docker written in Go in 2013, and using namespaces available from linux kernel 2.6.24  2008. His popularity exploded in 2017. Main problem of time before docker was configuration of server to use our application. When runtime environment was configured on server, then two different applications with different version or configuration of runtime couldn't be installed on the same host. If they was packed as virtual machines, then all operating system layer was duplicated. Docker solved these problems.</p><figure class=\"kg-card kg-image-card\"><img src=\"__GHOST_URL__/content/images/2022/11/Docker-linux-interfaces.svg.png\" class=\"kg-image\" alt loading=\"lazy\" width=\"220\" height=\"203\"></figure><p>But it is not the end. When people learned how to use Docker and created CI/CD flows to automate deployment and testing processes they realised that server managements can be done also on code layer. </p><p>Infrastructure as a code has the same advantage on admin panel to manage servers as commanline over gui in managing personal desktop - is universal and can be easy managed by scripts written by end user.</p><p>Dominating possition among IaC products have Terraform developed by Hashicorp. It is easy to learn but require custom config language. </p><p>this is examplary config:</p><pre><code class=\"language-tf\">provider \"aws\" {\n  region = \"us-west-2\"\n}\n\nprovider \"random\" {}\n\nresource \"random_pet\" \"name\" {}\n\nresource \"aws_instance\" \"web\" {\n  ami           = \"ami-a0cfeed8\"\n  instance_type = \"t2.micro\"\n  user_data     = file(\"init-script.sh\")\n\n  tags = {\n    Name = random_pet.name.id\n  }\n}</code></pre><p>We will not focus on any line of this code. If you are interesed in this and know polish language I wrote article about terraform here:</p><figure class=\"kg-card kg-bookmark-card\"><a class=\"kg-bookmark-container\" href=\"https://gustawdaniel.com/infrastrukura-defniowana-jako-kod/\"><div class=\"kg-bookmark-content\"><div class=\"kg-bookmark-title\">Infrastrukura defniowana przez kod (terraform + digital ocean)</div><div class=\"kg-bookmark-description\">W scrapingu ważnym czynnikiem jest skala do jakiej możemy rozszerzyć tempopobierania i przetwarzania danych. Kiedy kilka lat temu pisałem swój pierwszysystem, który równolegle zbierał dane używając kilkunastu serwerów, każdy z tychserwerów był przeze mnie “wyklikany” w panelu dostawcy. Teraz pok…</div><div class=\"kg-bookmark-metadata\"><img class=\"kg-bookmark-icon\" src=\"https://gustawdaniel.com/favicon.ico\"><span class=\"kg-bookmark-author\">Daniel Gustaw</span><span class=\"kg-bookmark-publisher\">Daniel Gustaw</span></div></div><div class=\"kg-bookmark-thumbnail\"><img src=\"https://gustawdaniel.com/content/images/2021/04/image6-1.png\"></div></a></figure><p>Now we will focus on competitor of Terraform. Lets discuss pulumi.</p><figure class=\"kg-card kg-image-card\"><img src=\"__GHOST_URL__/content/images/2022/11/72cy2v.jpg\" class=\"kg-image\" alt loading=\"lazy\" width=\"750\" height=\"500\" srcset=\"__GHOST_URL__/content/images/size/w600/2022/11/72cy2v.jpg 600w, __GHOST_URL__/content/images/2022/11/72cy2v.jpg 750w\" sizes=\"(min-width: 720px) 720px\"></figure><h1 id=\"pulumi\">Pulumi</h1><p>Pulumi is plafrom to define infrastructure by programs written in:</p><ul><li>typescript</li><li>python</li><li>go</li><li>c#</li><li>java</li><li>yaml</li></ul><p>It supports over 70 cloud providers. Key difference between terraform is simplicity of customization obtained by processing data used to define infrastructure parameters.</p><p>Instead of file with <code>init-script</code> to execute on new <code>vps</code> I can use template and render it with my env variables. Instead of copy config, I can loop over environments connecting subdomains to proper servers.</p><p>To install pulumi cli run command:</p><pre><code>curl -sSL https://get.pulumi.com | sh</code></pre><p>We can start from creation directory for our config:</p><pre><code>mkdir pulumi &amp;&amp; cd pulumi\n</code></pre><p>Now we want to create new project using template. To list typescript templates we can type:</p><pre><code>pulumi new -l | grep typescript\n</code></pre><p>Lets create config for Digital Ocean</p><pre><code>pulumi new digitalocean-typescript\n</code></pre><p>Now we will install two packages:</p><ul><li>dotenv - to use values defined in .env file and append them to <code>process</code></li><li>jsrender - to render template of script to prepare server</li></ul><pre><code>npm i dotenv jsrender\n</code></pre><p>Now we can create <code>.env</code> file with two values:</p><pre><code>DOCKER_REGISTRY_DOMAIN=___ \nDOCKER_TOKEN=__\n</code></pre><p>We need all servers with the same initial preparation. Below I lising our requirements:</p><ul><li>we need to be logged in to docker registry</li><li>tmux have to be configured with proper key binding</li><li>snap have to be disable and removed to avoid 100% cpu bug</li><li>python with <code>docker</code> and <code>docker-compose</code> packages for ansible installed</li><li><code>nginx-proxy-automation</code> installed and started</li></ul><p>To satisfy them lets create <code>userData.sh</code> with content:</p><pre><code class=\"language-bash\">#!/bin/bash\n\nexport DOCKER_REGISTRY_DOMAIN={{:DOCKER_REGISTRY_DOMAIN}}\nexport DOCKER_TOKEN={{:DOCKER_TOKEN}}\n\ncat &lt;&lt;EOT &gt;&gt; ~/.bashrc\nexport DOCKER_REGISTRY_DOMAIN={{:DOCKER_REGISTRY_DOMAIN}}\nexport DOCKER_TOKEN={{:DOCKER_TOKEN}}\nEOT\n\ncat &lt;&lt;EOT &gt;&gt; ~/.tmux.conf\nset -g terminal-overrides 'xterm*:smcup@:rmcup@'\n\n# remap prefix from 'C-b' to 'C-a'\nunbind C-b\nset-option -g prefix C-a\nbind-key C-a send-prefix\n\n# switch panes using Alt-arrow without prefix\nbind -n M-Left select-pane -L\nbind -n M-Right select-pane -R\nbind -n M-Up select-pane -U\nbind -n M-Down select-pane -D\n\n# Enable mouse control (clickable windows, panes, resizable panes)\n#set -g mouse-select-window on\n#set -g mouse-select-pane on\n#set -g mouse-resize-pane on\n\n# Enable mouse mode (tmux 2.1 and above)\nset -g mouse on\n\nset -g pane-border-format \"#{pane_index}#{?@custom_pane_title,:#{@custom_pane_title},}:#{pane_title}\"\n\nbind e set-window-option synchronize-panes\nEOT\n\nsudo systemctl disable snapd.service\nsudo systemctl disable snapd.socket\nsudo systemctl disable snapd.seeded.service\n\nsudo apt autoremove --purge snapd -y\nsudo rm -rf /var/cache/snapd/\nrm -rf ~/snap\n\necho \"${DOCKER_TOKEN}\" | docker login -u \"${DOCKER_TOKEN}\" \"${DOCKER_REGISTRY_DOMAIN}\" --password-stdin;\n\napt -y update\napt -y install python3 python3-pip\npip3 install docker docker-compose\n\ngit clone --recurse-submodules https://github.com/evertramos/nginx-proxy-automation.git ~/proxy &amp;&amp; cd ~/proxy/bin &amp;&amp; ./fresh-start.sh --yes -e gustaw.daniel@gmail.com --use-nginx-conf-files\n</code></pre><h3 id=\"digital-ocean-personal-token\">Digital Ocean Personal Token</h3><p>Now we have to select ssh keys for server. To do it we need <code>doctl</code> - cli for digital ocean. In this platform you can have account that belong to different teams (contexts). To list contexts use</p><pre><code>doctl auth ls</code></pre><p>We can select context by:</p><pre><code>doctl auth switch --context preciselab\n</code></pre><p>Lets check if we have correct access:</p><pre><code>doctl account get\n</code></pre><p>if you will see error, we can login by token</p><pre><code>doctl auth init\n</code></pre><p>You will need token that can be generated on in <code>API</code> tab in Digital Ocean Panel</p><figure class=\"kg-card kg-image-card\"><img src=\"__GHOST_URL__/content/images/2022/11/2022-11-26_16-57-1.png\" class=\"kg-image\" alt loading=\"lazy\" width=\"1252\" height=\"615\" srcset=\"__GHOST_URL__/content/images/size/w600/2022/11/2022-11-26_16-57-1.png 600w, __GHOST_URL__/content/images/size/w1000/2022/11/2022-11-26_16-57-1.png 1000w, __GHOST_URL__/content/images/2022/11/2022-11-26_16-57-1.png 1252w\" sizes=\"(min-width: 720px) 720px\"></figure><p>The same token should be used to connect pulumi with your digital ocean:</p><pre><code>pulumi config set digitalocean:token TOKEN_VALUE --secret\n</code></pre><h3 id=\"ssh-keys\">SSH Keys</h3><p>In this team you have to store your ssh keys. To list them use:</p><pre><code>doctl compute ssh-key list\n</code></pre><p>in new project it will be empty list, so create keys. If you want to isolate keys in CI/CD from your personal as file name you can use your project.</p><pre><code>ssh-keygen -t ed25519 -C \"gustaw.daniel@gmail.com\" -f ~/.ssh/id_ed25519\n</code></pre><p>add public keys to security settings in digital ocean:</p><figure class=\"kg-card kg-image-card\"><img src=\"__GHOST_URL__/content/images/2022/11/2022-11-26_18-25.png\" class=\"kg-image\" alt loading=\"lazy\" width=\"1242\" height=\"414\" srcset=\"__GHOST_URL__/content/images/size/w600/2022/11/2022-11-26_18-25.png 600w, __GHOST_URL__/content/images/size/w1000/2022/11/2022-11-26_18-25.png 1000w, __GHOST_URL__/content/images/2022/11/2022-11-26_18-25.png 1242w\" sizes=\"(min-width: 720px) 720px\"></figure><p>After adding you can again ask about keys because you will need these numbers returned by command:</p><pre><code>doctl compute ssh-key list\n</code></pre><h3 id=\"pulumi-indexts-config\">Pulumi index.ts config</h3><p>To use import withou stars we need to add two <code>compilerOptions</code> to your <code>tsconfig.json</code></p><pre><code class=\"language-json\">\"allowSyntheticDefaultImports\": true, \n\"esModuleInterop\": true\n</code></pre><p>And finally creme de la creme - <code>index.ts</code> file</p><pre><code class=\"language-typescript\">import 'dotenv/config'\nimport * as pulumi from \"@pulumi/pulumi\";\nimport * as digitalocean from \"@pulumi/digitalocean\";\nimport fs from 'fs';\nimport {templates} from 'jsrender';\n\n// we reading template ( there are no secretes )\nconst userDataTemplate = fs.readFileSync('./userData.sh').toString();\n\n// secretes are injected during render\nconst userData = templates(userDataTemplate).render(process.env)\n\n// this is our default droplet config\nconst dropletConfig = {\n    image: \"docker-20-04\",\n    region: \"fra1\",\n    size: \"s-1vcpu-1gb-intel\",\n    monitoring: true,\n    backups: false,\n    userData, // there is rendered script to initiate server\n    sshKeys: [\n        // here are ids of keys saved on digital ocean\n        '36403277', //    Github Actions\n        '34336169', //    Daniel Laptop\n    ]\n};\n\n// now we defining that we need two servers\nconst dropletApi = new digitalocean.Droplet(\"xue-api\", dropletConfig);\nconst dropletUi = new digitalocean.Droplet(\"xue-ui\", dropletConfig);\n\n// and single main domain\nconst domain = new digitalocean.Domain(\"xue.academy\", {\n    name: \"xue.academy\",\n}, {deleteBeforeReplace: true});\n\n// two environments:\n// a) production without subdomain \n// b) staging with subdomain stag\nconst envs:Array&lt;{name: 'stag' | 'prod', subdomain: string}&gt; = [{\n    subdomain: '',\n    name: 'prod'\n}, {\n    subdomain: 'stag',\n    name: 'stag'\n}]\n\n// there are helpers function to name resources correctly\nfunction recordName(envName: 'prod' | 'stag', name: string) {\n    return envName === 'prod' ? name : `${name}-${envName}`;\n}\n\n// and simplify subdomain selecton\nfunction subdomainName(envName: 'prod' | 'stag', name: string) {\n    return envName === 'prod' ? name : (name === '@' ? `${envName}` : `${name}.${envName}`);\n}\n\n// we can iterate over environments connecting domains with servers\nfor(let env of envs) {\n    const dnsUi = new digitalocean.DnsRecord(recordName(env.name, `xue.academy`), {\n        name: subdomainName(env.name, \"@\"),\n        domain: domain.id,\n        value: dropletUi.ipv4Address,\n        type: 'A'\n    }, {deleteBeforeReplace: true})\n\n    const dnsApi = new digitalocean.DnsRecord(recordName(env.name, \"api.xue.academy\"), {\n        name: subdomainName(env.name, \"api\"),\n        domain: domain.id,\n        value: dropletApi.ipv4Address,\n        type: 'A'\n    }, {deleteBeforeReplace: true})\n}\n\n// Export the name of the domain\nexport const ipUi = dropletUi.ipv4Address;\nexport const ipApi = dropletApi.ipv4Address;\n</code></pre><p>This in super simple config but we can easy add mysql databse</p><pre><code class=\"language-typescript\">const mysql = new digitalocean.DatabaseCluster(\"mysql\", {\n  engine: \"mysql\",\n  nodeCount: 1,\n  region: \"fra1\",\n  size: \"db-s-1vcpu-1gb\",\n  version: \"8\",\n}, {parent: playground});\n\nconst coreDatabase = new digitalocean.DatabaseDb(\"database-core\", {clusterId: mysql.id});\n\nexport const mysqlId = mysql.id;\nexport const mysqlHost = mysql.host;\nexport const mysqlUser = mysql.user;\nexport const mysqlPassword = mysql.password;\nexport const mysqlPort = mysql.port;\nexport const mysqlUri = mysql.uri;</code></pre><p>or redis instance</p><pre><code class=\"language-typescript\">const redis = new digitalocean.DatabaseCluster(\"redis\", {\n  engine: \"redis\",\n  nodeCount: 1,\n  region: \"fra1\",\n  size: \"db-s-1vcpu-1gb\",\n  version: \"6\",\n}, {parent: playground});\n\nexport const redisHost = redis.host;\nexport const redisUser = redis.user;\nexport const redisPassword = redis.password;\nexport const redisPort = redis.port;\nexport const redisUri = redis.uri;</code></pre><p>I hope this article will help you start with pulumi on Digital Ocean and follow primary devops rule:</p><blockquote>Better spend 10 hours failing to automate, than do task manually.</blockquote><figure class=\"kg-card kg-image-card\"><img src=\"__GHOST_URL__/content/images/2022/11/72ccir.jpg\" class=\"kg-image\" alt loading=\"lazy\" width=\"500\" height=\"500\"></figure><p>Lets sum up advantages of IaC approach.</p><ul><li>more reliable infrastructure management</li><li>you can use the same approval / testing flow than for code to infrastructure</li><li>you can easy multiply environments without clicking in admin panels of providers</li><li>migrations of project to clients account indepenedent from infrastructure provider migration mechanism</li></ul>","comment_id":"6379e4e9f20ac751bf7a5ee3","plaintext":"How deployment evolved by years?\nInitially (70 years ago) computers was programmed by manual change of cables\nconnections. There was no personal desktop so programs was written on\nproduction. No deployment - no problem.\n\nfirst digital computer programmersAbout decade later IBM introduced punched\ncards so deployment or installation was performed by insert of card with program\nto a reader.\n\nNext breakthrough - internet and ftp (1971) protocols changed everything. To\nmove programs to other machines you stopped needing physical driver other than\ncables connecting with network.\n\nGenerally process was simple. You had to copy binaries to mainframe and start\nyour program here.\n\nThere was only one problem. Cost of computers was huge, so to utilize them\noptimally and get return of investment there was introduced virtualisation -\nlogical dividing resources of machine between processes.\n\nUnfortunatelly on x86 machines there was problem with virtualisation some\nprocessor instructions and in decade 1980-1990 this method was abandoned with\nthe end of supercomputers epoch.\n\nWe come back to virtualisation in 1990 not only because of increasing cost and\ninefectivness of infrastructure maintainance but also thanks to adaptive\nvirtualisation technique introduced by VMware. They detected instructions that\nwas problematic during virtualisation and convert them to these safe\nequivalents. \n\nIn my opinion, for deployment process this is revolution similar to internet.\nInternet digitalised a carrier of program during deployment, but virtualization\nallowed to change parameters of server without touching hardware.\n\nThese changes was important for cloud providers and IaaS branch, but developers\nwas divided on these that putting on servers his own virtual machines or these\nthat using ftp or scp to copy programs to vps delivered by his providers.\n\nNext huge revolution was Docker written in Go in 2013, and using namespaces\navailable from linux kernel 2.6.24  2008. His popularity exploded in 2017. Main\nproblem of time before docker was configuration of server to use our\napplication. When runtime environment was configured on server, then two\ndifferent applications with different version or configuration of runtime\ncouldn't be installed on the same host. If they was packed as virtual machines,\nthen all operating system layer was duplicated. Docker solved these problems.\n\nBut it is not the end. When people learned how to use Docker and created CI/CD\nflows to automate deployment and testing processes they realised that server\nmanagements can be done also on code layer. \n\nInfrastructure as a code has the same advantage on admin panel to manage servers\nas commanline over gui in managing personal desktop - is universal and can be\neasy managed by scripts written by end user.\n\nDominating possition among IaC products have Terraform developed by Hashicorp.\nIt is easy to learn but require custom config language. \n\nthis is examplary config:\n\nprovider \"aws\" {\n  region = \"us-west-2\"\n}\n\nprovider \"random\" {}\n\nresource \"random_pet\" \"name\" {}\n\nresource \"aws_instance\" \"web\" {\n  ami           = \"ami-a0cfeed8\"\n  instance_type = \"t2.micro\"\n  user_data     = file(\"init-script.sh\")\n\n  tags = {\n    Name = random_pet.name.id\n  }\n}\n\nWe will not focus on any line of this code. If you are interesed in this and\nknow polish language I wrote article about terraform here:\n\nInfrastrukura defniowana przez kod (terraform + digital ocean)W scrapingu\nważnym\nczynnikiem jest skala do jakiej możemy rozszerzyć tempopobierania i\nprzetwarzania danych. Kiedy kilka lat temu pisałem swój pierwszysystem, który\nrównolegle zbierał dane używając kilkunastu serwerów, każdy z tychserwerów był\nprzeze mnie “wyklikany” w panelu dostawcy. Teraz pok…Daniel GustawDaniel Gustaw\n[https://gustawdaniel.com/infrastrukura-defniowana-jako-kod/]Now we will focus\non competitor of Terraform. Lets discuss pulumi.\n\nPulumi\nPulumi is plafrom to define infrastructure by programs written in:\n\n * typescript\n * python\n * go\n * c#\n * java\n * yaml\n\nIt supports over 70 cloud providers. Key difference between terraform is\nsimplicity of customization obtained by processing data used to define\ninfrastructure parameters.\n\nInstead of file with init-script to execute on new vps I can use template and\nrender it with my env variables. Instead of copy config, I can loop over\nenvironments connecting subdomains to proper servers.\n\nTo install pulumi cli run command:\n\ncurl -sSL https://get.pulumi.com | sh\n\nWe can start from creation directory for our config:\n\nmkdir pulumi && cd pulumi\n\n\nNow we want to create new project using template. To list typescript templates\nwe can type:\n\npulumi new -l | grep typescript\n\n\nLets create config for Digital Ocean\n\npulumi new digitalocean-typescript\n\n\nNow we will install two packages:\n\n * dotenv - to use values defined in .env file and append them to process\n * jsrender - to render template of script to prepare server\n\nnpm i dotenv jsrender\n\n\nNow we can create .env file with two values:\n\nDOCKER_REGISTRY_DOMAIN=___ \nDOCKER_TOKEN=__\n\n\nWe need all servers with the same initial preparation. Below I lising our\nrequirements:\n\n * we need to be logged in to docker registry\n * tmux have to be configured with proper key binding\n * snap have to be disable and removed to avoid 100% cpu bug\n * python with docker and docker-compose packages for ansible installed\n * nginx-proxy-automation installed and started\n\nTo satisfy them lets create userData.sh with content:\n\n#!/bin/bash\n\nexport DOCKER_REGISTRY_DOMAIN={{:DOCKER_REGISTRY_DOMAIN}}\nexport DOCKER_TOKEN={{:DOCKER_TOKEN}}\n\ncat <<EOT >> ~/.bashrc\nexport DOCKER_REGISTRY_DOMAIN={{:DOCKER_REGISTRY_DOMAIN}}\nexport DOCKER_TOKEN={{:DOCKER_TOKEN}}\nEOT\n\ncat <<EOT >> ~/.tmux.conf\nset -g terminal-overrides 'xterm*:smcup@:rmcup@'\n\n# remap prefix from 'C-b' to 'C-a'\nunbind C-b\nset-option -g prefix C-a\nbind-key C-a send-prefix\n\n# switch panes using Alt-arrow without prefix\nbind -n M-Left select-pane -L\nbind -n M-Right select-pane -R\nbind -n M-Up select-pane -U\nbind -n M-Down select-pane -D\n\n# Enable mouse control (clickable windows, panes, resizable panes)\n#set -g mouse-select-window on\n#set -g mouse-select-pane on\n#set -g mouse-resize-pane on\n\n# Enable mouse mode (tmux 2.1 and above)\nset -g mouse on\n\nset -g pane-border-format \"#{pane_index}#{?@custom_pane_title,:#{@custom_pane_title},}:#{pane_title}\"\n\nbind e set-window-option synchronize-panes\nEOT\n\nsudo systemctl disable snapd.service\nsudo systemctl disable snapd.socket\nsudo systemctl disable snapd.seeded.service\n\nsudo apt autoremove --purge snapd -y\nsudo rm -rf /var/cache/snapd/\nrm -rf ~/snap\n\necho \"${DOCKER_TOKEN}\" | docker login -u \"${DOCKER_TOKEN}\" \"${DOCKER_REGISTRY_DOMAIN}\" --password-stdin;\n\napt -y update\napt -y install python3 python3-pip\npip3 install docker docker-compose\n\ngit clone --recurse-submodules https://github.com/evertramos/nginx-proxy-automation.git ~/proxy && cd ~/proxy/bin && ./fresh-start.sh --yes -e gustaw.daniel@gmail.com --use-nginx-conf-files\n\n\nDigital Ocean Personal Token\nNow we have to select ssh keys for server. To do it we need doctl - cli for\ndigital ocean. In this platform you can have account that belong to different\nteams (contexts). To list contexts use\n\ndoctl auth ls\n\nWe can select context by:\n\ndoctl auth switch --context preciselab\n\n\nLets check if we have correct access:\n\ndoctl account get\n\n\nif you will see error, we can login by token\n\ndoctl auth init\n\n\nYou will need token that can be generated on in API tab in Digital Ocean Panel\n\nThe same token should be used to connect pulumi with your digital ocean:\n\npulumi config set digitalocean:token TOKEN_VALUE --secret\n\n\nSSH Keys\nIn this team you have to store your ssh keys. To list them use:\n\ndoctl compute ssh-key list\n\n\nin new project it will be empty list, so create keys. If you want to isolate\nkeys in CI/CD from your personal as file name you can use your project.\n\nssh-keygen -t ed25519 -C \"gustaw.daniel@gmail.com\" -f ~/.ssh/id_ed25519\n\n\nadd public keys to security settings in digital ocean:\n\nAfter adding you can again ask about keys because you will need these numbers\nreturned by command:\n\ndoctl compute ssh-key list\n\n\nPulumi index.ts config\nTo use import withou stars we need to add two compilerOptions to your \ntsconfig.json\n\n\"allowSyntheticDefaultImports\": true, \n\"esModuleInterop\": true\n\n\nAnd finally creme de la creme - index.ts file\n\nimport 'dotenv/config'\nimport * as pulumi from \"@pulumi/pulumi\";\nimport * as digitalocean from \"@pulumi/digitalocean\";\nimport fs from 'fs';\nimport {templates} from 'jsrender';\n\n// we reading template ( there are no secretes )\nconst userDataTemplate = fs.readFileSync('./userData.sh').toString();\n\n// secretes are injected during render\nconst userData = templates(userDataTemplate).render(process.env)\n\n// this is our default droplet config\nconst dropletConfig = {\n    image: \"docker-20-04\",\n    region: \"fra1\",\n    size: \"s-1vcpu-1gb-intel\",\n    monitoring: true,\n    backups: false,\n    userData, // there is rendered script to initiate server\n    sshKeys: [\n        // here are ids of keys saved on digital ocean\n        '36403277', //    Github Actions\n        '34336169', //    Daniel Laptop\n    ]\n};\n\n// now we defining that we need two servers\nconst dropletApi = new digitalocean.Droplet(\"xue-api\", dropletConfig);\nconst dropletUi = new digitalocean.Droplet(\"xue-ui\", dropletConfig);\n\n// and single main domain\nconst domain = new digitalocean.Domain(\"xue.academy\", {\n    name: \"xue.academy\",\n}, {deleteBeforeReplace: true});\n\n// two environments:\n// a) production without subdomain \n// b) staging with subdomain stag\nconst envs:Array<{name: 'stag' | 'prod', subdomain: string}> = [{\n    subdomain: '',\n    name: 'prod'\n}, {\n    subdomain: 'stag',\n    name: 'stag'\n}]\n\n// there are helpers function to name resources correctly\nfunction recordName(envName: 'prod' | 'stag', name: string) {\n    return envName === 'prod' ? name : `${name}-${envName}`;\n}\n\n// and simplify subdomain selecton\nfunction subdomainName(envName: 'prod' | 'stag', name: string) {\n    return envName === 'prod' ? name : (name === '@' ? `${envName}` : `${name}.${envName}`);\n}\n\n// we can iterate over environments connecting domains with servers\nfor(let env of envs) {\n    const dnsUi = new digitalocean.DnsRecord(recordName(env.name, `xue.academy`), {\n        name: subdomainName(env.name, \"@\"),\n        domain: domain.id,\n        value: dropletUi.ipv4Address,\n        type: 'A'\n    }, {deleteBeforeReplace: true})\n\n    const dnsApi = new digitalocean.DnsRecord(recordName(env.name, \"api.xue.academy\"), {\n        name: subdomainName(env.name, \"api\"),\n        domain: domain.id,\n        value: dropletApi.ipv4Address,\n        type: 'A'\n    }, {deleteBeforeReplace: true})\n}\n\n// Export the name of the domain\nexport const ipUi = dropletUi.ipv4Address;\nexport const ipApi = dropletApi.ipv4Address;\n\n\nThis in super simple config but we can easy add mysql databse\n\nconst mysql = new digitalocean.DatabaseCluster(\"mysql\", {\n  engine: \"mysql\",\n  nodeCount: 1,\n  region: \"fra1\",\n  size: \"db-s-1vcpu-1gb\",\n  version: \"8\",\n}, {parent: playground});\n\nconst coreDatabase = new digitalocean.DatabaseDb(\"database-core\", {clusterId: mysql.id});\n\nexport const mysqlId = mysql.id;\nexport const mysqlHost = mysql.host;\nexport const mysqlUser = mysql.user;\nexport const mysqlPassword = mysql.password;\nexport const mysqlPort = mysql.port;\nexport const mysqlUri = mysql.uri;\n\nor redis instance\n\nconst redis = new digitalocean.DatabaseCluster(\"redis\", {\n  engine: \"redis\",\n  nodeCount: 1,\n  region: \"fra1\",\n  size: \"db-s-1vcpu-1gb\",\n  version: \"6\",\n}, {parent: playground});\n\nexport const redisHost = redis.host;\nexport const redisUser = redis.user;\nexport const redisPassword = redis.password;\nexport const redisPort = redis.port;\nexport const redisUri = redis.uri;\n\nI hope this article will help you start with pulumi on Digital Ocean and follow\nprimary devops rule:\n\n> Better spend 10 hours failing to automate, than do task manually.\nLets sum up advantages of IaC approach.\n\n * more reliable infrastructure management\n * you can use the same approval / testing flow than for code to infrastructure\n * you can easy multiply environments without clicking in admin panels of\n   providers\n * migrations of project to clients account indepenedent from infrastructure\n   provider migration mechanism","feature_image":"__GHOST_URL__/content/images/2022/11/sci-fi-futuristic-studio-stage-dark-room-space-station-with-glowing-neon-lights-background-min.jpg","featured":0,"type":"post","status":"published","locale":null,"visibility":"public","email_recipient_filter":"all","created_at":"2022-11-20T08:27:21.000Z","updated_at":"2022-11-28T12:53:23.000Z","published_at":"2022-11-28T12:52:11.000Z","custom_excerpt":"With Pulumi you can define your it infrastructure in your file described by your favourite programming language. This article shows how to do it.","codeinjection_head":null,"codeinjection_foot":null,"custom_template":null,"canonical_url":null,"newsletter_id":null,"lexical":null},{"id":"6384c8a2f20ac751bf7a621a","uuid":"30b91007-966c-4829-9c8c-2cf991405cd1","title":"Maximum Inequality [Linear Search] rust and typescript","slug":"maximum-inequality","mobiledoc":"{\"version\":\"0.3.1\",\"atoms\":[[\"soft-return\",\"\",{}]],\"cards\":[[\"code\",{\"code\":\"1≤T≤10^5\\n1≤N≤10^5\\n∣S∣=N $$\\nS contains characters ′0′ and ′1′.\\nSum of N over all test cases does not exceed 2 ⋅ 10^5.\"}],[\"code\",{\"code\":\"3\\n3\\n011\\n4\\n1100\\n5\\n11111\"}],[\"code\",{\"code\":\"1\\n2\\n0\"}],[\"code\",{\"code\":\"const readline = require('readline');\\n\\nconst rl = readline.createInterface({\\n    input: process.stdin,\\n    output: process.stdout,\\n    terminal: false\\n});\",\"language\":\"typescript\"}],[\"code\",{\"code\":\"const input_array:string[] = []\\n\",\"language\":\"typescript\"}],[\"code\",{\"code\":\"rl.on('line', (line: string) => {\\n    input_array.push(line);\\n});\",\"language\":\"typescript\"}],[\"code\",{\"code\":\"rl.once('close', () => {\\n    let index = 0;\\n    let T = parseInt(input_array[index++].trim(), 10);\\n    for (let t_i = 0; t_i < T; t_i++) {\\n        let N = parseInt(input_array[index++].trim(), 10);\\n        let S = input_array[index++].trim();\\n\\n        let out_ = solve(N, S);\\n        rl.output.write(out_.toString());\\n        rl.output.write('\\\\n');\\n    }\\n\\n    process.exit();\\n});\",\"language\":\"typescript\"}],[\"code\",{\"code\":\"function solve(N: number, S: string) {\\n    let s1: string = '';\\n    let s2: string = '';\\n    let changes = 0;\\n\\n    for (let i=0; i<N; i++) {\\n        const v = S[i];\\n        if (!s1) {\\n            s1 = v;\\n        } else if (!s2 && v === s1) {\\n            s2 = v;\\n        } else if (s1 !== v) {\\n            s1 = v;\\n            changes++;\\n        } else if (s2 && s2 !== v) {\\n            s2 = v;\\n            changes++;\\n        }\\n    }\\n\\n    return changes;\\n}\\n\",\"language\":\"typescript\"}],[\"code\",{\"code\":\"3\\n3\\n011\\n4\\n1100\\n5\\n11111\",\"language\":\"text\"}],[\"code\",{\"code\":\"#! /bin/sh\\n\\ntestEquality() {\\n  RES=$(cat < text | ts-node index.ts)\\n  EXP=$(printf \\\"1\\\\n2\\\\n0\\\")\\n  assertEquals \\\"${EXP}\\\" \\\"${RES}\\\"\\n}\\n\\n# Load shUnit2.\\n. /usr/share/shunit2/shunit2\",\"language\":\"bash\"}],[\"code\",{\"code\":\"name: Node.js CI\\n\\non:\\n  push:\\n    branches: [ \\\"main\\\" ]\\n    paths: [ \\\"node\\\" ]\\n\\nenv:\\n  working-directory: ./node\\n\\njobs:\\n  build:\\n\\n    runs-on: ubuntu-latest\\n\\n    defaults:\\n      run:\\n        working-directory: ${{ env.working-directory }}\\n\\n    strategy:\\n      matrix:\\n        node-version: [14.x, 16.x, 18.x]\\n\\n    steps:\\n      - uses: actions/checkout@v3\\n      - name: Install shunit\\n        run: sudo apt install -y shunit2\\n      - name: Use Node.js ${{ matrix.node-version }}\\n        uses: actions/setup-node@v3\\n        with:\\n          node-version: ${{ matrix.node-version }}\\n          cache: 'npm'\\n          cache-dependency-path: ${{ env.working-directory }}/package-lock.json\\n      - run: npm ci\\n      - run: npm install -g ts-node\\n      - run: npm run build --if-present\\n      - run: npm test\\n\",\"language\":\"yml\"}],[\"code\",{\"code\":\"use linear_search_max_inequality::max_inequality;\\nuse std::io;\\n\\nfn main() -> io::Result<()>{\\n    max_inequality(&mut io::stdin(), &mut io::stdout())\\n}\",\"language\":\"rust\"}],[\"code\",{\"code\":\"use std::io::{Write, Read, Error};\\nuse std::fmt::{Display, Formatter};\\n\\n#[cfg(test)]\\nmod tests {\\n    use super::*;\\n\\n    #[test]\\n    fn printing_in_new_lines_test() {\\n        let vec = NumVec(vec![0,1,2]);\\n        assert_eq!(format!(\\\"{}\\\", vec), \\\"0\\\\n1\\\\n2\\\");\\n    }\\n\\n    #[test]\\n    fn test_of_single_series_001_test() {\\n        let res = compute_max_inequality(3, \\\"001\\\");\\n        assert_eq!(res, 1);\\n    }\\n\\n    #[test]\\n    fn test_of_single_series_1100_test() {\\n        let res = compute_max_inequality(4, \\\"1100\\\");\\n        assert_eq!(res, 2);\\n    }\\n\\n    #[test]\\n    fn test_of_single_series_11111_test() {\\n        let res = compute_max_inequality(5, \\\"11111\\\");\\n        assert_eq!(res, 0);\\n    }\\n\\n\\n    #[test]\\n    fn string_new_test() {\\n        let s1 = String::new();\\n        assert_eq!(s1, \\\"\\\".to_string());\\n    }\\n\\n    #[test]\\n    fn max_inequality_001_test() {\\n        let mut out: Vec<u8> = Vec::new();\\n\\n        max_inequality(&mut \\\"1\\n3\\n001\\\".as_bytes(), &mut out).unwrap();\\n\\n        assert_eq!(out, b\\\"1\\\\n\\\");\\n    }\\n}\",\"language\":\"rust\"}],[\"code\",{\"code\":\"fn compute_max_inequality(_length: u32, series: &str) -> u32 {\\n    let mut s1:String = String::new();\\n    let mut s2:String = String::new();\\n    let mut changes = 0u32;\\n\\n    for c in series.chars() {\\n        let v = c.to_string();\\n        if s1 == \\\"\\\" {\\n            s1 = v;\\n        } else if s2 == \\\"\\\" && s1 == v {\\n            s2 = v\\n        } else if s1 != v {\\n            s1 = v;\\n            changes+=1;\\n        } else if s2 != \\\"\\\" && s2 != v {\\n            s2 = v;\\n            changes+=1;\\n        }\\n    }\\n\\n    changes\\n}\",\"language\":\"rust\"}],[\"code\",{\"code\":\"struct NumVec(Vec<u32>);\\n\\nimpl Display for NumVec {\\n    fn fmt(&self, f: &mut Formatter) -> Result<(), std::fmt::Error> {\\n        let mut out = String::new();\\n\\n        for num in &self.0[0..self.0.len() - 1] {\\n            out.push_str(&num.to_string());\\n            out.push_str(\\\"\\\\n\\\");\\n        }\\n\\n        out.push_str(&self.0[self.0.len() - 1].to_string());\\n        write!(f, \\\"{}\\\", out)\\n    }\\n}\",\"language\":\"rust\"}],[\"code\",{\"code\":\"pub fn max_inequality(\\n    input: &mut impl Read,\\n    output: &mut impl Write,\\n) -> Result<(), Error> {\\n    let mut buffer = \\\"\\\".to_string();\\n\\n    input.read_to_string(&mut buffer)?;\\n    \\n    let mut iterator = buffer.split(\\\"\\\\n\\\");\\n\\n    iterator.next();\\n\\n    let mut results:Vec<u32> = vec![];\\n\\n    while let Some(length) = iterator.next() {\\n        let length: u32 = length.parse().unwrap();\\n        let series = if let Some(series) = iterator.next() { series } else { \\\"\\\" };\\n        results.push(compute_max_inequality(length, series));\\n    }\\n\\n    let out = format!(\\\"{}\\\\n\\\", NumVec(results));\\n\\n    output.write_all(out.as_bytes())?;\\n\\n    Ok(())\\n}\"}],[\"code\",{\"code\":\"name: Rust\\n\\non:\\n  push:\\n    branches: [ \\\"main\\\" ]\\n    paths: [ \\\"rust\\\" ]\\n\\nenv:\\n  CARGO_TERM_COLOR: always\\n  working-directory: ./rust\\n\\njobs:\\n  build:\\n    runs-on: ubuntu-latest\\n\\n    steps:\\n      - uses: actions/checkout@v3\\n      - name: Build\\n        run: cargo build --verbose\\n        working-directory: ${{ env.working-directory }}\\n\\n  test:\\n    runs-on: ubuntu-latest\\n\\n    steps:\\n      - uses: actions/checkout@v3\\n      - name: Run tests\\n        run: cargo test --verbose\\n        working-directory: ${{ env.working-directory }}\\n\",\"language\":\"yaml\"}],[\"bookmark\",{\"type\":\"bookmark\",\"url\":\"https://github.com/gustawdaniel/linear-sort-maximum-inequality-rust-node\",\"metadata\":{\"url\":\"https://github.com/gustawdaniel/linear-sort-maximum-inequality-rust-node\",\"title\":\"GitHub - gustawdaniel/linear-sort-maximum-inequality-rust-node: Hack Earth problem with solution.\",\"description\":\"Hack Earth problem with solution. . Contribute to gustawdaniel/linear-sort-maximum-inequality-rust-node development by creating an account on GitHub.\",\"author\":\"gustawdaniel\",\"publisher\":\"GitHub\",\"thumbnail\":\"https://opengraph.githubassets.com/46206ad525ed8fc27c996a0b9789df18bebeb483bc4fc0eeb6ac06b62f1c7efd/gustawdaniel/linear-sort-maximum-inequality-rust-node\",\"icon\":\"https://github.githubassets.com/favicons/favicon.svg\"}}]],\"markups\":[[\"strong\"],[\"em\"],[\"code\"]],\"sections\":[[1,\"p\",[[0,[0],1,\"Problem\"]]],[1,\"p\",[[0,[],0,\"A function on a binary string \"],[0,[1],1,\"T\"],[0,[],0,\" of length \"],[0,[1],1,\"M\"],[0,[],0,\" is defined as follows:\"]]],[1,\"p\",[[0,[1],1,\"F(T)\"],[0,[],0,\" = number of indices\"],[0,[1],1,\" i (1≤i<M)\"],[0,[],0,\" such that Ti≠Ti+1.\"]]],[1,\"p\",[[0,[],0,\"You are given a binary string \"],[0,[1],1,\"S \"],[0,[],0,\"of length \"],[0,[1],1,\"N\"],[0,[],0,\". You have to divide string \"],[0,[1],1,\"S\"],[0,[],0,\" into two subsequences\"],[0,[1],1,\" S1,S2\"],[0,[],0,\" such that:\"]]],[3,\"ul\",[[[0,[],0,\"Each character of string \"],[0,[1],1,\"S\"],[0,[],0,\" belongs to one of S1 and S2.\"]],[[0,[],0,\"The characters of S1and S2.must occur in the order they appear in \"],[0,[1],1,\"S.\"]]]],[1,\"p\",[[0,[],0,\"Find the maximum possible value of F(S1)+F(S2).\"]]],[1,\"p\",[[0,[0],1,\"NOTE: \"],[0,[],0,\"A binary string is a string that consists of characters `\"],[0,[1],1,\"0\"],[0,[],0,\"` and `\"],[0,[1],1,\"1\"],[0,[],0,\"`. One of the strings S1, S2 can be empty.\"]]],[1,\"p\",[[0,[0],1,\"Input format\"]]],[3,\"ul\",[[[0,[],0,\"The first line contains \"],[0,[1],1,\"T \"],[0,[],0,\"denoting\"],[0,[1],1,\" \"],[0,[],0,\"the number\"],[0,[1],1,\" \"],[0,[],0,\"of test cases. The description of \"],[0,[1],1,\"T\"],[0,[],0,\" test cases is as follows:\"]],[[0,[],0,\"For each test case:\"]],[[0,[],0,\"The first line contains \"],[0,[1],1,\"N \"],[0,[],0,\"denoting the size of string \"],[0,[1],1,\"S\"],[0,[],0,\".\"]],[[0,[],0,\"The second line contains the string \"],[0,[1],1,\"S.\"]]]],[1,\"p\",[[0,[0],1,\"Output format\"],[1,[],0,0],[0,[],0,\"For each test case, print the maximum possible value of F(S1)+F(S2) in a separate line.\"]]],[1,\"p\",[[0,[0],1,\"Constraints\"]]],[10,0],[1,\"p\",[[0,[],0,\"Sample Input\"]]],[10,1],[1,\"p\",[[0,[],0,\"Sample Output\"]]],[10,2],[1,\"p\",[[0,[0],1,\"Explanation\"]]],[1,\"p\",[[0,[0],1,\"The first test case\"]]],[3,\"ul\",[[[0,[],0,\"One possible division is S1=011,S2=\\\"\\\" (empty string). Here F(S1)+F(S2)=1+0=1. There is no way to divide the given string to obtain a greater answer.\"]]]],[1,\"p\",[[0,[0],1,\"The second test case\"]]],[3,\"ul\",[[[0,[],0,\"The optimal division is S1=10,S2=10. Here F(S1)+F(S2)=1+1=2. There is no way to divide the given string to obtain a greater answer.\"]]]],[1,\"p\",[[0,[0],1,\"The third test case\"]]],[3,\"ul\",[[[0,[],0,\"For any possible division of \"],[0,[1],1,\"S\"],[0,[],0,\", F(S1)+F(S2)=0.\"]]]],[1,\"h1\",[[0,[],0,\"Solution\"]]],[1,\"p\",[[0,[],0,\"I will describe method and then present code in javascript and rust.\"]]],[1,\"h2\",[[0,[],0,\"Method\"]]],[1,\"p\",[[0,[],0,\"To solve this problem we can create two pointers - one for any head of subsequence. Then we changing first sequence value as soon as possible. In other case we changing second. Any change should increment counter of changes. This simple algorithm has O(n) complexity.\"]]],[1,\"h2\",[[0,[],0,\"Node JS Solution\"]]],[1,\"p\",[[0,[],0,\"In \"],[0,[2],1,\"node\"],[0,[],0,\" solution we will use \"],[0,[2],1,\"readline\"],[0,[],0,\" module. It allow to create interface which throws events connected with reading from standard input.\"]]],[10,3],[1,\"p\",[[0,[],0,\"We will be able to add event listeners on \"],[0,[2],1,\"rl\"],[0,[],0,\" object but now lets create \"],[0,[2],1,\"input_array\"],[0,[],0,\" which will be filled by subsequent lines.  \"]]],[10,4],[1,\"p\",[[0,[],0,\"Now we can listen on any added line in standard input, and append them to this array.\"]]],[10,5],[1,\"p\",[[0,[],0,\"When input will be closed then We want to build output and pass it to standard output:\"]]],[10,6],[1,\"p\",[[0,[],0,\"we are using there \"],[0,[2],1,\"solve\"],[0,[],0,\" function that will find maximum number of changes in both. So there is implementation of \"],[0,[2],1,\"solve\"],[0,[],0,\" function.\"]]],[10,7],[1,\"p\",[[0,[],0,\"This is end of typescript, but worth to present test. We will not use \"],[0,[2],1,\"jest\"],[0,[],0,\", \"],[0,[2],1,\"ava\"],[0,[],0,\" or \"],[0,[2],1,\"mocha\"],[0,[],0,\" that are designed to test code internally. Instead I decided to test program by blackbox test written in \"],[0,[2],1,\"shunit2\"],[0,[],0,\". There is \"],[0,[2],1,\"text\"],[0,[],0,\" file with test data\"]]],[10,8],[1,\"p\",[[0,[],0,\"From exercise content we know that solutions are \"],[0,[2],1,\"1\"],[0,[],0,\" ,\"],[0,[2],1,\"2\"],[0,[],0,\" and \"],[0,[2],1,\"0\"],[0,[],0,\". So my test is written in \"],[0,[2],1,\"equality_test.sh\"]]],[10,9],[1,\"p\",[[0,[],0,\"Finally github action workflow\"]]],[10,10],[1,\"h2\",[[0,[],0,\"Rust Solution\"]]],[1,\"p\",[[0,[],0,\"In rust we divided project to 2 files. Almost empty \"],[0,[2],1,\"main.rs\"]]],[10,11],[1,\"p\",[[0,[],0,\"and \"],[0,[2],1,\"lib.rs\"],[0,[],0,\" with all logics and unit tests. Lets start from tests\"]]],[10,12],[1,\"p\",[[0,[],0,\"Reading tests we can see that there is function \"],[0,[2],1,\"compute_max_inequality\"],[0,[],0,\" that solving main problem and \"],[0,[2],1,\"max_inequality\"],[0,[],0,\" to handle input and output properly.\"]]],[1,\"p\",[[0,[],0,\"Solving problem is generally copy from node solution with a little complications from necessity of conversion chars to strings.\"]]],[10,13],[1,\"p\",[[0,[],0,\"other problem that was typical only for rust is a little overengineered printing vector to new lines\"]]],[10,14],[1,\"p\",[[0,[],0,\"Finally main function that read lines and compute results.\"]]],[10,15],[1,\"p\",[[0,[],0,\"Rust workflow in github is pretty standard\"]]],[10,16],[10,17],[1,\"p\",[]]],\"ghostVersion\":\"4.0\"}","html":"<p><strong>Problem</strong></p><p>A function on a binary string <em>T</em> of length <em>M</em> is defined as follows:</p><p><em>F(T)</em> = number of indices<em> i (1≤i&lt;M)</em> such that Ti≠Ti+1.</p><p>You are given a binary string <em>S </em>of length <em>N</em>. You have to divide string <em>S</em> into two subsequences<em> S1,S2</em> such that:</p><ul><li>Each character of string <em>S</em> belongs to one of S1 and S2.</li><li>The characters of S1and S2.must occur in the order they appear in <em>S.</em></li></ul><p>Find the maximum possible value of F(S1)+F(S2).</p><p><strong>NOTE: </strong>A binary string is a string that consists of characters `<em>0</em>` and `<em>1</em>`. One of the strings S1, S2 can be empty.</p><p><strong>Input format</strong></p><ul><li>The first line contains <em>T </em>denoting<em> </em>the number<em> </em>of test cases. The description of <em>T</em> test cases is as follows:</li><li>For each test case:</li><li>The first line contains <em>N </em>denoting the size of string <em>S</em>.</li><li>The second line contains the string <em>S.</em></li></ul><p><strong>Output format</strong><br>For each test case, print the maximum possible value of F(S1)+F(S2) in a separate line.</p><p><strong>Constraints</strong></p><pre><code>1≤T≤10^5\n1≤N≤10^5\n∣S∣=N $$\nS contains characters ′0′ and ′1′.\nSum of N over all test cases does not exceed 2 ⋅ 10^5.</code></pre><p>Sample Input</p><pre><code>3\n3\n011\n4\n1100\n5\n11111</code></pre><p>Sample Output</p><pre><code>1\n2\n0</code></pre><p><strong>Explanation</strong></p><p><strong>The first test case</strong></p><ul><li>One possible division is S1=011,S2=\"\" (empty string). Here F(S1)+F(S2)=1+0=1. There is no way to divide the given string to obtain a greater answer.</li></ul><p><strong>The second test case</strong></p><ul><li>The optimal division is S1=10,S2=10. Here F(S1)+F(S2)=1+1=2. There is no way to divide the given string to obtain a greater answer.</li></ul><p><strong>The third test case</strong></p><ul><li>For any possible division of <em>S</em>, F(S1)+F(S2)=0.</li></ul><h1 id=\"solution\">Solution</h1><p>I will describe method and then present code in javascript and rust.</p><h2 id=\"method\">Method</h2><p>To solve this problem we can create two pointers - one for any head of subsequence. Then we changing first sequence value as soon as possible. In other case we changing second. Any change should increment counter of changes. This simple algorithm has O(n) complexity.</p><h2 id=\"node-js-solution\">Node JS Solution</h2><p>In <code>node</code> solution we will use <code>readline</code> module. It allow to create interface which throws events connected with reading from standard input.</p><pre><code class=\"language-typescript\">const readline = require('readline');\n\nconst rl = readline.createInterface({\n    input: process.stdin,\n    output: process.stdout,\n    terminal: false\n});</code></pre><p>We will be able to add event listeners on <code>rl</code> object but now lets create <code>input_array</code> which will be filled by subsequent lines.  </p><pre><code class=\"language-typescript\">const input_array:string[] = []\n</code></pre><p>Now we can listen on any added line in standard input, and append them to this array.</p><pre><code class=\"language-typescript\">rl.on('line', (line: string) =&gt; {\n    input_array.push(line);\n});</code></pre><p>When input will be closed then We want to build output and pass it to standard output:</p><pre><code class=\"language-typescript\">rl.once('close', () =&gt; {\n    let index = 0;\n    let T = parseInt(input_array[index++].trim(), 10);\n    for (let t_i = 0; t_i &lt; T; t_i++) {\n        let N = parseInt(input_array[index++].trim(), 10);\n        let S = input_array[index++].trim();\n\n        let out_ = solve(N, S);\n        rl.output.write(out_.toString());\n        rl.output.write('\\n');\n    }\n\n    process.exit();\n});</code></pre><p>we are using there <code>solve</code> function that will find maximum number of changes in both. So there is implementation of <code>solve</code> function.</p><pre><code class=\"language-typescript\">function solve(N: number, S: string) {\n    let s1: string = '';\n    let s2: string = '';\n    let changes = 0;\n\n    for (let i=0; i&lt;N; i++) {\n        const v = S[i];\n        if (!s1) {\n            s1 = v;\n        } else if (!s2 &amp;&amp; v === s1) {\n            s2 = v;\n        } else if (s1 !== v) {\n            s1 = v;\n            changes++;\n        } else if (s2 &amp;&amp; s2 !== v) {\n            s2 = v;\n            changes++;\n        }\n    }\n\n    return changes;\n}\n</code></pre><p>This is end of typescript, but worth to present test. We will not use <code>jest</code>, <code>ava</code> or <code>mocha</code> that are designed to test code internally. Instead I decided to test program by blackbox test written in <code>shunit2</code>. There is <code>text</code> file with test data</p><pre><code class=\"language-text\">3\n3\n011\n4\n1100\n5\n11111</code></pre><p>From exercise content we know that solutions are <code>1</code> ,<code>2</code> and <code>0</code>. So my test is written in <code>equality_test.sh</code></p><pre><code class=\"language-bash\">#! /bin/sh\n\ntestEquality() {\n  RES=$(cat &lt; text | ts-node index.ts)\n  EXP=$(printf \"1\\n2\\n0\")\n  assertEquals \"${EXP}\" \"${RES}\"\n}\n\n# Load shUnit2.\n. /usr/share/shunit2/shunit2</code></pre><p>Finally github action workflow</p><pre><code class=\"language-yml\">name: Node.js CI\n\non:\n  push:\n    branches: [ \"main\" ]\n    paths: [ \"node\" ]\n\nenv:\n  working-directory: ./node\n\njobs:\n  build:\n\n    runs-on: ubuntu-latest\n\n    defaults:\n      run:\n        working-directory: ${{ env.working-directory }}\n\n    strategy:\n      matrix:\n        node-version: [14.x, 16.x, 18.x]\n\n    steps:\n      - uses: actions/checkout@v3\n      - name: Install shunit\n        run: sudo apt install -y shunit2\n      - name: Use Node.js ${{ matrix.node-version }}\n        uses: actions/setup-node@v3\n        with:\n          node-version: ${{ matrix.node-version }}\n          cache: 'npm'\n          cache-dependency-path: ${{ env.working-directory }}/package-lock.json\n      - run: npm ci\n      - run: npm install -g ts-node\n      - run: npm run build --if-present\n      - run: npm test\n</code></pre><h2 id=\"rust-solution\">Rust Solution</h2><p>In rust we divided project to 2 files. Almost empty <code>main.rs</code></p><pre><code class=\"language-rust\">use linear_search_max_inequality::max_inequality;\nuse std::io;\n\nfn main() -&gt; io::Result&lt;()&gt;{\n    max_inequality(&amp;mut io::stdin(), &amp;mut io::stdout())\n}</code></pre><p>and <code>lib.rs</code> with all logics and unit tests. Lets start from tests</p><pre><code class=\"language-rust\">use std::io::{Write, Read, Error};\nuse std::fmt::{Display, Formatter};\n\n#[cfg(test)]\nmod tests {\n    use super::*;\n\n    #[test]\n    fn printing_in_new_lines_test() {\n        let vec = NumVec(vec![0,1,2]);\n        assert_eq!(format!(\"{}\", vec), \"0\\n1\\n2\");\n    }\n\n    #[test]\n    fn test_of_single_series_001_test() {\n        let res = compute_max_inequality(3, \"001\");\n        assert_eq!(res, 1);\n    }\n\n    #[test]\n    fn test_of_single_series_1100_test() {\n        let res = compute_max_inequality(4, \"1100\");\n        assert_eq!(res, 2);\n    }\n\n    #[test]\n    fn test_of_single_series_11111_test() {\n        let res = compute_max_inequality(5, \"11111\");\n        assert_eq!(res, 0);\n    }\n\n\n    #[test]\n    fn string_new_test() {\n        let s1 = String::new();\n        assert_eq!(s1, \"\".to_string());\n    }\n\n    #[test]\n    fn max_inequality_001_test() {\n        let mut out: Vec&lt;u8&gt; = Vec::new();\n\n        max_inequality(&amp;mut \"1\n3\n001\".as_bytes(), &amp;mut out).unwrap();\n\n        assert_eq!(out, b\"1\\n\");\n    }\n}</code></pre><p>Reading tests we can see that there is function <code>compute_max_inequality</code> that solving main problem and <code>max_inequality</code> to handle input and output properly.</p><p>Solving problem is generally copy from node solution with a little complications from necessity of conversion chars to strings.</p><pre><code class=\"language-rust\">fn compute_max_inequality(_length: u32, series: &amp;str) -&gt; u32 {\n    let mut s1:String = String::new();\n    let mut s2:String = String::new();\n    let mut changes = 0u32;\n\n    for c in series.chars() {\n        let v = c.to_string();\n        if s1 == \"\" {\n            s1 = v;\n        } else if s2 == \"\" &amp;&amp; s1 == v {\n            s2 = v\n        } else if s1 != v {\n            s1 = v;\n            changes+=1;\n        } else if s2 != \"\" &amp;&amp; s2 != v {\n            s2 = v;\n            changes+=1;\n        }\n    }\n\n    changes\n}</code></pre><p>other problem that was typical only for rust is a little overengineered printing vector to new lines</p><pre><code class=\"language-rust\">struct NumVec(Vec&lt;u32&gt;);\n\nimpl Display for NumVec {\n    fn fmt(&amp;self, f: &amp;mut Formatter) -&gt; Result&lt;(), std::fmt::Error&gt; {\n        let mut out = String::new();\n\n        for num in &amp;self.0[0..self.0.len() - 1] {\n            out.push_str(&amp;num.to_string());\n            out.push_str(\"\\n\");\n        }\n\n        out.push_str(&amp;self.0[self.0.len() - 1].to_string());\n        write!(f, \"{}\", out)\n    }\n}</code></pre><p>Finally main function that read lines and compute results.</p><pre><code>pub fn max_inequality(\n    input: &amp;mut impl Read,\n    output: &amp;mut impl Write,\n) -&gt; Result&lt;(), Error&gt; {\n    let mut buffer = \"\".to_string();\n\n    input.read_to_string(&amp;mut buffer)?;\n    \n    let mut iterator = buffer.split(\"\\n\");\n\n    iterator.next();\n\n    let mut results:Vec&lt;u32&gt; = vec![];\n\n    while let Some(length) = iterator.next() {\n        let length: u32 = length.parse().unwrap();\n        let series = if let Some(series) = iterator.next() { series } else { \"\" };\n        results.push(compute_max_inequality(length, series));\n    }\n\n    let out = format!(\"{}\\n\", NumVec(results));\n\n    output.write_all(out.as_bytes())?;\n\n    Ok(())\n}</code></pre><p>Rust workflow in github is pretty standard</p><pre><code class=\"language-yaml\">name: Rust\n\non:\n  push:\n    branches: [ \"main\" ]\n    paths: [ \"rust\" ]\n\nenv:\n  CARGO_TERM_COLOR: always\n  working-directory: ./rust\n\njobs:\n  build:\n    runs-on: ubuntu-latest\n\n    steps:\n      - uses: actions/checkout@v3\n      - name: Build\n        run: cargo build --verbose\n        working-directory: ${{ env.working-directory }}\n\n  test:\n    runs-on: ubuntu-latest\n\n    steps:\n      - uses: actions/checkout@v3\n      - name: Run tests\n        run: cargo test --verbose\n        working-directory: ${{ env.working-directory }}\n</code></pre><figure class=\"kg-card kg-bookmark-card\"><a class=\"kg-bookmark-container\" href=\"https://github.com/gustawdaniel/linear-sort-maximum-inequality-rust-node\"><div class=\"kg-bookmark-content\"><div class=\"kg-bookmark-title\">GitHub - gustawdaniel/linear-sort-maximum-inequality-rust-node: Hack Earth problem with solution.</div><div class=\"kg-bookmark-description\">Hack Earth problem with solution. . Contribute to gustawdaniel/linear-sort-maximum-inequality-rust-node development by creating an account on GitHub.</div><div class=\"kg-bookmark-metadata\"><img class=\"kg-bookmark-icon\" src=\"https://github.githubassets.com/favicons/favicon.svg\"><span class=\"kg-bookmark-author\">GitHub</span><span class=\"kg-bookmark-publisher\">gustawdaniel</span></div></div><div class=\"kg-bookmark-thumbnail\"><img src=\"https://opengraph.githubassets.com/46206ad525ed8fc27c996a0b9789df18bebeb483bc4fc0eeb6ac06b62f1c7efd/gustawdaniel/linear-sort-maximum-inequality-rust-node\"></div></a></figure>","comment_id":"6384c8a2f20ac751bf7a621a","plaintext":"Problem\n\nA function on a binary string T of length M is defined as follows:\n\nF(T) = number of indices i (1≤i<M) such that Ti≠Ti+1.\n\nYou are given a binary string S of length N. You have to divide string S into\ntwo subsequences S1,S2 such that:\n\n * Each character of string S belongs to one of S1 and S2.\n * The characters of S1and S2.must occur in the order they appear in S.\n\nFind the maximum possible value of F(S1)+F(S2).\n\nNOTE: A binary string is a string that consists of characters `0` and `1`. One\nof the strings S1, S2 can be empty.\n\nInput format\n\n * The first line contains T denoting the number of test cases. The description\n   of T test cases is as follows:\n * For each test case:\n * The first line contains N denoting the size of string S.\n * The second line contains the string S.\n\nOutput format\nFor each test case, print the maximum possible value of F(S1)+F(S2) in a\nseparate line.\n\nConstraints\n\n1≤T≤10^5\n1≤N≤10^5\n∣S∣=N $$\nS contains characters ′0′ and ′1′.\nSum of N over all test cases does not exceed 2 ⋅ 10^5.\n\nSample Input\n\n3\n3\n011\n4\n1100\n5\n11111\n\nSample Output\n\n1\n2\n0\n\nExplanation\n\nThe first test case\n\n * One possible division is S1=011,S2=\"\" (empty string). Here F(S1)+F(S2)=1+0=1.\n   There is no way to divide the given string to obtain a greater answer.\n\nThe second test case\n\n * The optimal division is S1=10,S2=10. Here F(S1)+F(S2)=1+1=2. There is no way\n   to divide the given string to obtain a greater answer.\n\nThe third test case\n\n * For any possible division of S, F(S1)+F(S2)=0.\n\nSolution\nI will describe method and then present code in javascript and rust.\n\nMethod\nTo solve this problem we can create two pointers - one for any head of\nsubsequence. Then we changing first sequence value as soon as possible. In other\ncase we changing second. Any change should increment counter of changes. This\nsimple algorithm has O(n) complexity.\n\nNode JS Solution\nIn node solution we will use readline module. It allow to create interface which\nthrows events connected with reading from standard input.\n\nconst readline = require('readline');\n\nconst rl = readline.createInterface({\n    input: process.stdin,\n    output: process.stdout,\n    terminal: false\n});\n\nWe will be able to add event listeners on rl object but now lets create \ninput_array which will be filled by subsequent lines.\n\nconst input_array:string[] = []\n\n\nNow we can listen on any added line in standard input, and append them to this\narray.\n\nrl.on('line', (line: string) => {\n    input_array.push(line);\n});\n\nWhen input will be closed then We want to build output and pass it to standard\noutput:\n\nrl.once('close', () => {\n    let index = 0;\n    let T = parseInt(input_array[index++].trim(), 10);\n    for (let t_i = 0; t_i < T; t_i++) {\n        let N = parseInt(input_array[index++].trim(), 10);\n        let S = input_array[index++].trim();\n\n        let out_ = solve(N, S);\n        rl.output.write(out_.toString());\n        rl.output.write('\\n');\n    }\n\n    process.exit();\n});\n\nwe are using there solve function that will find maximum number of changes in\nboth. So there is implementation of solve function.\n\nfunction solve(N: number, S: string) {\n    let s1: string = '';\n    let s2: string = '';\n    let changes = 0;\n\n    for (let i=0; i<N; i++) {\n        const v = S[i];\n        if (!s1) {\n            s1 = v;\n        } else if (!s2 && v === s1) {\n            s2 = v;\n        } else if (s1 !== v) {\n            s1 = v;\n            changes++;\n        } else if (s2 && s2 !== v) {\n            s2 = v;\n            changes++;\n        }\n    }\n\n    return changes;\n}\n\n\nThis is end of typescript, but worth to present test. We will not use jest, ava \nor mocha that are designed to test code internally. Instead I decided to test\nprogram by blackbox test written in shunit2. There is text file with test data\n\n3\n3\n011\n4\n1100\n5\n11111\n\nFrom exercise content we know that solutions are 1 ,2 and 0. So my test is\nwritten in equality_test.sh\n\n#! /bin/sh\n\ntestEquality() {\n  RES=$(cat < text | ts-node index.ts)\n  EXP=$(printf \"1\\n2\\n0\")\n  assertEquals \"${EXP}\" \"${RES}\"\n}\n\n# Load shUnit2.\n. /usr/share/shunit2/shunit2\n\nFinally github action workflow\n\nname: Node.js CI\n\non:\n  push:\n    branches: [ \"main\" ]\n    paths: [ \"node\" ]\n\nenv:\n  working-directory: ./node\n\njobs:\n  build:\n\n    runs-on: ubuntu-latest\n\n    defaults:\n      run:\n        working-directory: ${{ env.working-directory }}\n\n    strategy:\n      matrix:\n        node-version: [14.x, 16.x, 18.x]\n\n    steps:\n      - uses: actions/checkout@v3\n      - name: Install shunit\n        run: sudo apt install -y shunit2\n      - name: Use Node.js ${{ matrix.node-version }}\n        uses: actions/setup-node@v3\n        with:\n          node-version: ${{ matrix.node-version }}\n          cache: 'npm'\n          cache-dependency-path: ${{ env.working-directory }}/package-lock.json\n      - run: npm ci\n      - run: npm install -g ts-node\n      - run: npm run build --if-present\n      - run: npm test\n\n\nRust Solution\nIn rust we divided project to 2 files. Almost empty main.rs\n\nuse linear_search_max_inequality::max_inequality;\nuse std::io;\n\nfn main() -> io::Result<()>{\n    max_inequality(&mut io::stdin(), &mut io::stdout())\n}\n\nand lib.rs with all logics and unit tests. Lets start from tests\n\nuse std::io::{Write, Read, Error};\nuse std::fmt::{Display, Formatter};\n\n#[cfg(test)]\nmod tests {\n    use super::*;\n\n    #[test]\n    fn printing_in_new_lines_test() {\n        let vec = NumVec(vec![0,1,2]);\n        assert_eq!(format!(\"{}\", vec), \"0\\n1\\n2\");\n    }\n\n    #[test]\n    fn test_of_single_series_001_test() {\n        let res = compute_max_inequality(3, \"001\");\n        assert_eq!(res, 1);\n    }\n\n    #[test]\n    fn test_of_single_series_1100_test() {\n        let res = compute_max_inequality(4, \"1100\");\n        assert_eq!(res, 2);\n    }\n\n    #[test]\n    fn test_of_single_series_11111_test() {\n        let res = compute_max_inequality(5, \"11111\");\n        assert_eq!(res, 0);\n    }\n\n\n    #[test]\n    fn string_new_test() {\n        let s1 = String::new();\n        assert_eq!(s1, \"\".to_string());\n    }\n\n    #[test]\n    fn max_inequality_001_test() {\n        let mut out: Vec<u8> = Vec::new();\n\n        max_inequality(&mut \"1\n3\n001\".as_bytes(), &mut out).unwrap();\n\n        assert_eq!(out, b\"1\\n\");\n    }\n}\n\nReading tests we can see that there is function compute_max_inequality that\nsolving main problem and max_inequality to handle input and output properly.\n\nSolving problem is generally copy from node solution with a little complications\nfrom necessity of conversion chars to strings.\n\nfn compute_max_inequality(_length: u32, series: &str) -> u32 {\n    let mut s1:String = String::new();\n    let mut s2:String = String::new();\n    let mut changes = 0u32;\n\n    for c in series.chars() {\n        let v = c.to_string();\n        if s1 == \"\" {\n            s1 = v;\n        } else if s2 == \"\" && s1 == v {\n            s2 = v\n        } else if s1 != v {\n            s1 = v;\n            changes+=1;\n        } else if s2 != \"\" && s2 != v {\n            s2 = v;\n            changes+=1;\n        }\n    }\n\n    changes\n}\n\nother problem that was typical only for rust is a little overengineered printing\nvector to new lines\n\nstruct NumVec(Vec<u32>);\n\nimpl Display for NumVec {\n    fn fmt(&self, f: &mut Formatter) -> Result<(), std::fmt::Error> {\n        let mut out = String::new();\n\n        for num in &self.0[0..self.0.len() - 1] {\n            out.push_str(&num.to_string());\n            out.push_str(\"\\n\");\n        }\n\n        out.push_str(&self.0[self.0.len() - 1].to_string());\n        write!(f, \"{}\", out)\n    }\n}\n\nFinally main function that read lines and compute results.\n\npub fn max_inequality(\n    input: &mut impl Read,\n    output: &mut impl Write,\n) -> Result<(), Error> {\n    let mut buffer = \"\".to_string();\n\n    input.read_to_string(&mut buffer)?;\n    \n    let mut iterator = buffer.split(\"\\n\");\n\n    iterator.next();\n\n    let mut results:Vec<u32> = vec![];\n\n    while let Some(length) = iterator.next() {\n        let length: u32 = length.parse().unwrap();\n        let series = if let Some(series) = iterator.next() { series } else { \"\" };\n        results.push(compute_max_inequality(length, series));\n    }\n\n    let out = format!(\"{}\\n\", NumVec(results));\n\n    output.write_all(out.as_bytes())?;\n\n    Ok(())\n}\n\nRust workflow in github is pretty standard\n\nname: Rust\n\non:\n  push:\n    branches: [ \"main\" ]\n    paths: [ \"rust\" ]\n\nenv:\n  CARGO_TERM_COLOR: always\n  working-directory: ./rust\n\njobs:\n  build:\n    runs-on: ubuntu-latest\n\n    steps:\n      - uses: actions/checkout@v3\n      - name: Build\n        run: cargo build --verbose\n        working-directory: ${{ env.working-directory }}\n\n  test:\n    runs-on: ubuntu-latest\n\n    steps:\n      - uses: actions/checkout@v3\n      - name: Run tests\n        run: cargo test --verbose\n        working-directory: ${{ env.working-directory }}\n\n\nGitHub - gustawdaniel/linear-sort-maximum-inequality-rust-node: Hack Earth\nproblem with solution.Hack Earth problem with solution. . Contribute to\ngustawdaniel/linear-sort-maximum-inequality-rust-node development by creating\nan\naccount on GitHub.GitHubgustawdaniel\n[https://github.com/gustawdaniel/linear-sort-maximum-inequality-rust-node]","feature_image":"__GHOST_URL__/content/images/2022/11/rust-min-max-min.jpg","featured":0,"type":"post","status":"published","locale":null,"visibility":"public","email_recipient_filter":"all","created_at":"2022-11-28T14:41:38.000Z","updated_at":"2022-11-28T16:54:20.000Z","published_at":"2022-11-28T16:54:21.000Z","custom_excerpt":"Simple hackeartch task solved in node js and rust. You con compare these two languages on example of this problem. I recommend to solve it independently before reading solutions.","codeinjection_head":null,"codeinjection_foot":null,"custom_template":null,"canonical_url":null,"newsletter_id":null,"lexical":null},{"id":"6384f541f20ac751bf7a62f3","uuid":"e130def6-580c-46c1-b094-fdc6dd932630","title":"Login Component in Nuxt (Rest Strapi)","slug":"login-page-in-nuxt3","mobiledoc":"{\"version\":\"0.3.1\",\"atoms\":[],\"cards\":[[\"image\",{\"src\":\"__GHOST_URL__/content/images/2022/11/when-you-have-5b9bfb.jpg\",\"width\":600,\"height\":418}],[\"code\",{\"code\":\"npx nuxi init front_nuxt\",\"language\":\"bash\"}],[\"code\",{\"code\":\"node_modules: package.json\\n\\tnpm i\\n\\nup: node_modules\\n\\tnpm run dev\\n\",\"language\":\"makefile\"}],[\"code\",{\"code\":\"<NuxtWelcome />\"}],[\"code\",{\"code\":\"    <NuxtPage />\\n\"}],[\"code\",{\"code\":\"npx nuxi add page login\"}],[\"code\",{\"code\":\"NUXT_PUBLIC_BASE_URL=http://localhsot:1337\\n\"}],[\"code\",{\"code\":\"include .env\\nexport\"}],[\"code\",{\"code\":\"    runtimeConfig: {\\n        public: {\\n            baseUrl: process.env.NUXT_PUBLIC_BASE_URL,\\n        },\\n    },\"}],[\"code\",{\"code\":\"import {ref, useLazyFetch, useRuntimeConfig} from \\\"#imports\\\";\\n\\nconst config = useRuntimeConfig();\\n\\nconst formBody = ref<{ identifier: string, password: string }>({\\n  identifier: 'user@ok.com',\\n  password: 'pass'\\n});\\n\\nconst requestBody = ref<{ identifier: string, password: string }>({\\n  identifier: '',\\n  password: ''\\n});\",\"language\":\"typescript\"}],[\"code\",{\"code\":\"const {data, error, pending} = await useLazyFetch(`${config.public.baseUrl}/api/auth/local`, {\\n  body: requestBody,\\n  method: 'post',\\n  immediate: false,\\n  watch: [],\\n})\\n\",\"language\":\"typescript\"}],[\"code\",{\"code\":\"async function login() {\\n  requestBody.value = formBody.value;\\n}\",\"language\":\"typescript\"}],[\"code\",{\"code\":\"<template>\\n  <div>\\n    <pre>PENDING: {{ pending }}</pre>\\n    <pre>DATA: {{ data }}</pre>\\n    <pre>ERROR: {{ error }}</pre>\\n    <hr>\\n\\n    <form @submit.prevent=\\\"login\\\">\\n      <label for=\\\"email\\\">\\n        Email\\n        <input type=\\\"text\\\" v-model.lazy=\\\"formBody.identifier\\\">\\n      </label>\\n      <label for=\\\"password\\\">\\n        Password\\n        <input type=\\\"password\\\" v-model.lazy=\\\"formBody.password\\\">\\n      </label>\\n\\n      <button>Login</button>\\n    </form>\\n  </div>\\n</template>\",\"language\":\"html\"}],[\"image\",{\"src\":\"__GHOST_URL__/content/images/2022/11/yet-another-login.jpg\",\"width\":600,\"height\":337}],[\"code\",{\"code\":\"const token = useCookie('token');\\nconst user = useCookie('user');\",\"language\":\"typescript\"}],[\"code\",{\"code\":\"watch(data, (value) => {\\n  token.value = value.jwt;\\n  user.value = value.user;\\n})\",\"language\":\"typescript\"}],[\"code\",{\"code\":\"const {data, error, execute, pending} = await useLazyFetch...\",\"language\":\"typescript\"}],[\"code\",{\"code\":\"function login() {\\n  if(JSON.stringify(requestBody.value) === JSON.stringify(formBody.value)) {\\n    execute()\\n  } else {\\n    requestBody.value = formBody.value;\\n  }\\n}\",\"language\":\"typescript\"}],[\"image\",{\"src\":\"__GHOST_URL__/content/images/2022/11/93yay.jpg\",\"width\":490,\"height\":296}],[\"code\",{\"code\":\"function logout() {\\n  token.value = '';\\n  user.value = '';\\n}\",\"language\":\"typescript\"}],[\"code\",{\"code\":\"<template>\\n  <div>\\n    <pre>{{ token }}</pre>\\n    <hr>\\n    <pre>PENDING: {{ pending }}</pre>\\n    <pre>DATA: {{ data }}</pre>\\n    <pre>ERROR: {{ error }}</pre>\\n    <hr>\\n\\n    <div v-if=\\\"token\\\">\\n\\n      <pre>{{user}}</pre>\\n\\n      <button @click=\\\"logout\\\">Logout</button>\\n    </div>\\n    <div v-else>\\n      <form @submit.prevent=\\\"login\\\">\\n        <label for=\\\"email\\\">\\n          Email\\n          <input type=\\\"text\\\" v-model.lazy=\\\"formBody.identifier\\\">\\n        </label>\\n        <label for=\\\"password\\\">\\n          Password\\n          <input type=\\\"password\\\" v-model.lazy=\\\"formBody.password\\\">\\n        </label>\\n\\n        <button>Login</button>\\n      </form>\\n    </div>\\n  </div>\\n</template>\\n\",\"language\":\"html\"}],[\"code\",{\"code\":\"npx nuxi add page profile\"}],[\"code\",{\"code\":\"import {useCookie, useRouter} from \\\"#imports\\\";\\n\\nconst user = useCookie('user');\\nconst router = useRouter();\\n\\nif(!user.value) {\\n  router.push('/login');\\n}\",\"language\":\"typescript\"}],[\"code\",{\"code\":\"<template>\\n  <div v-if=\\\"user\\\">\\n    <p>Email: {{user.email}}</p>\\n  </div>\\n</template>\",\"language\":\"html\"}],[\"image\",{\"src\":\"__GHOST_URL__/content/images/2022/11/xy5zc.jpg\",\"width\":568,\"height\":335}]],\"markups\":[[\"code\"]],\"sections\":[[1,\"p\",[[0,[],0,\"How many times in your live did you implemented login view? I did it too much times. Finally to no search code to copy in my projects I decided to paste here easy instruction how to build simple login component in nuxt.\"]]],[10,0],[1,\"p\",[[0,[],0,\"This setup using strapi as backend, but I will works with any rest API after body and url modifications. In next part we will create nuxt3 project, build login page and pass info about user by cookie to profile component. \"]]],[1,\"h3\",[[0,[],0,\"Setup Nuxt project \"]]],[1,\"p\",[[0,[],0,\"To create project:\"]]],[10,1],[1,\"p\",[[0,[],0,\"We can create universal \"],[0,[0],1,\"Makefile\"],[0,[],0,\" to start project by \"],[0,[0],1,\"make up\"]]],[10,2],[1,\"p\",[[0,[],0,\"Now to start coding we have to replace:\"]]],[10,3],[1,\"p\",[[0,[],0,\"in \"],[0,[0],1,\"app.vue\"],[0,[],0,\" by\"]]],[10,4],[1,\"h3\",[[0,[],0,\"First page (login)\"]]],[1,\"p\",[[0,[],0,\"Now create first page\"]]],[10,5],[1,\"p\",[[0,[],0,\"We need to login by \"],[0,[0],1,\"REST\"],[0,[],0,\" api but instead of \"],[0,[0],1,\"axios\"],[0,[],0,\" we will use \"],[0,[0],1,\"useFetch\"],[0,[],0,\" available in nuxt. To achieve this goal we have to add \"],[0,[0],1,\".env\"],[0,[],0,\" file with\"]]],[10,6],[1,\"p\",[[0,[],0,\"and prepend lines\"]]],[10,7],[1,\"p\",[[0,[],0,\"to the \"],[0,[0],1,\"Makefile\"],[0,[],0,\" to read \"],[0,[0],1,\".env\"],[0,[],0,\" without \"],[0,[0],1,\"dotenv\"],[0,[],0,\" package.\"]]],[1,\"p\",[[0,[],0,\"To \"],[0,[0],1,\"nuxt.config.ts\"],[0,[],0,\" we have to add\"]]],[10,8],[1,\"p\",[[0,[],0,\"Now in \"],[0,[0],1,\"script\"],[0,[],0,\" of \"],[0,[0],1,\"pages/login.vue\"],[0,[],0,\" we can define \"],[0,[0],1,\"formBody\"],[0,[],0,\" and \"],[0,[0],1,\"requestBody\"]]],[10,9],[1,\"p\",[[0,[],0,\"different variables are consequence of reactivity of \"],[0,[0],1,\"useLazyFetch\"],[0,[],0,\" method that will automatically send http request when \"],[0,[0],1,\"requestBody\"],[0,[],0,\" will be changed. So to allow modify \"],[0,[0],1,\"formBody\"],[0,[],0,\" without sending \"],[0,[0],1,\"http\"],[0,[],0,\" requests we have to split them to two distinct reactive references.\"]]],[1,\"p\",[[0,[],0,\"Our request will be performed by \"],[0,[0],1,\"useLazyFetch\"]]],[10,10],[1,\"p\",[[0,[],0,\"finally we can define \"],[0,[0],1,\"login\"],[0,[],0,\" function that trigger http request simply changing body in \"],[0,[0],1,\"useLazyFetch\"],[0,[],0,\" options.\"]]],[10,11],[1,\"p\",[[0,[],0,\"In template we adding super minimalistic frontend with login form and \"],[0,[0],1,\"pre\"],[0,[],0,\" tags to present data:\"]]],[10,12],[10,13],[1,\"h3\",[[0,[],0,\"Passing user token between components\"]]],[1,\"p\",[[0,[],0,\"To share state between components we can use store like \"],[0,[0],1,\"pinia\"],[0,[],0,\", that can be persisted by \"],[0,[0],1,\"local-sorage\"],[0,[],0,\". Other solution is \"],[0,[0],1,\"cookie\"],[0,[],0,\". In our case we will show cokkie implementation because it is build in nuxt and require less lines of code. In biger projects you should consider pinia as more extendable and solution but cookies also have advantages in security area.\"]]],[1,\"p\",[[0,[],0,\"Lets create two variables by \"],[0,[0],1,\"useCookie\"],[0,[],0,\" function.\"]]],[10,14],[1,\"p\",[[0,[],0,\"now we will watch on data returned from login request\"]]],[10,15],[1,\"p\",[[0,[],0,\"our \"],[0,[0],1,\"useLazyFetch\"],[0,[],0,\" result is now extended by \"],[0,[0],1,\"execute\"]]],[10,16],[1,\"p\",[[0,[],0,\"so login function can be rewritten\"]]],[10,17],[1,\"p\",[[0,[],0,\"this change allow to execute login many times with she same payload. \"]]],[10,18],[1,\"p\",[[0,[],0,\"It is especially important to avoid bugs, because we now added also \"],[0,[0],1,\"logout\"],[0,[],0,\" function\"]]],[10,19],[1,\"p\",[[0,[],0,\"In template we added \"],[0,[0],1,\"token\"],[0,[],0,\" and \"],[0,[0],1,\"v-if\"],[0,[],0,\" to display login form for not logged in and logout button for logged in users.\"]]],[10,20],[1,\"p\",[[0,[],0,\"We can now create second page\"]]],[10,21],[1,\"p\",[[0,[],0,\"and in script get user and router and then decide if we need to redirect to login\"]]],[10,22],[1,\"p\",[[0,[],0,\"our symbolic template can have form\"]]],[10,23],[1,\"p\",[[0,[],0,\"Thats it. We builded super simple front with login and profile pages. There is no styling, no registration and even I skipped part with strapi setup. But thanks to these simplifications it is useful as base to speedup setting up new nuxt3 projects. I hope it will be usful for you and help to avoid situations like on image below:\"]]],[10,24],[1,\"p\",[]]],\"ghostVersion\":\"4.0\"}","html":"<p>How many times in your live did you implemented login view? I did it too much times. Finally to no search code to copy in my projects I decided to paste here easy instruction how to build simple login component in nuxt.</p><figure class=\"kg-card kg-image-card\"><img src=\"__GHOST_URL__/content/images/2022/11/when-you-have-5b9bfb.jpg\" class=\"kg-image\" alt loading=\"lazy\" width=\"600\" height=\"418\" srcset=\"__GHOST_URL__/content/images/2022/11/when-you-have-5b9bfb.jpg 600w\"></figure><p>This setup using strapi as backend, but I will works with any rest API after body and url modifications. In next part we will create nuxt3 project, build login page and pass info about user by cookie to profile component. </p><h3 id=\"setup-nuxt-project\">Setup Nuxt project </h3><p>To create project:</p><pre><code class=\"language-bash\">npx nuxi init front_nuxt</code></pre><p>We can create universal <code>Makefile</code> to start project by <code>make up</code></p><pre><code class=\"language-makefile\">node_modules: package.json\n\tnpm i\n\nup: node_modules\n\tnpm run dev\n</code></pre><p>Now to start coding we have to replace:</p><pre><code>&lt;NuxtWelcome /&gt;</code></pre><p>in <code>app.vue</code> by</p><pre><code>    &lt;NuxtPage /&gt;\n</code></pre><h3 id=\"first-page-login\">First page (login)</h3><p>Now create first page</p><pre><code>npx nuxi add page login</code></pre><p>We need to login by <code>REST</code> api but instead of <code>axios</code> we will use <code>useFetch</code> available in nuxt. To achieve this goal we have to add <code>.env</code> file with</p><pre><code>NUXT_PUBLIC_BASE_URL=http://localhsot:1337\n</code></pre><p>and prepend lines</p><pre><code>include .env\nexport</code></pre><p>to the <code>Makefile</code> to read <code>.env</code> without <code>dotenv</code> package.</p><p>To <code>nuxt.config.ts</code> we have to add</p><pre><code>    runtimeConfig: {\n        public: {\n            baseUrl: process.env.NUXT_PUBLIC_BASE_URL,\n        },\n    },</code></pre><p>Now in <code>script</code> of <code>pages/login.vue</code> we can define <code>formBody</code> and <code>requestBody</code></p><pre><code class=\"language-typescript\">import {ref, useLazyFetch, useRuntimeConfig} from \"#imports\";\n\nconst config = useRuntimeConfig();\n\nconst formBody = ref&lt;{ identifier: string, password: string }&gt;({\n  identifier: 'user@ok.com',\n  password: 'pass'\n});\n\nconst requestBody = ref&lt;{ identifier: string, password: string }&gt;({\n  identifier: '',\n  password: ''\n});</code></pre><p>different variables are consequence of reactivity of <code>useLazyFetch</code> method that will automatically send http request when <code>requestBody</code> will be changed. So to allow modify <code>formBody</code> without sending <code>http</code> requests we have to split them to two distinct reactive references.</p><p>Our request will be performed by <code>useLazyFetch</code></p><pre><code class=\"language-typescript\">const {data, error, pending} = await useLazyFetch(`${config.public.baseUrl}/api/auth/local`, {\n  body: requestBody,\n  method: 'post',\n  immediate: false,\n  watch: [],\n})\n</code></pre><p>finally we can define <code>login</code> function that trigger http request simply changing body in <code>useLazyFetch</code> options.</p><pre><code class=\"language-typescript\">async function login() {\n  requestBody.value = formBody.value;\n}</code></pre><p>In template we adding super minimalistic frontend with login form and <code>pre</code> tags to present data:</p><pre><code class=\"language-html\">&lt;template&gt;\n  &lt;div&gt;\n    &lt;pre&gt;PENDING: {{ pending }}&lt;/pre&gt;\n    &lt;pre&gt;DATA: {{ data }}&lt;/pre&gt;\n    &lt;pre&gt;ERROR: {{ error }}&lt;/pre&gt;\n    &lt;hr&gt;\n\n    &lt;form @submit.prevent=\"login\"&gt;\n      &lt;label for=\"email\"&gt;\n        Email\n        &lt;input type=\"text\" v-model.lazy=\"formBody.identifier\"&gt;\n      &lt;/label&gt;\n      &lt;label for=\"password\"&gt;\n        Password\n        &lt;input type=\"password\" v-model.lazy=\"formBody.password\"&gt;\n      &lt;/label&gt;\n\n      &lt;button&gt;Login&lt;/button&gt;\n    &lt;/form&gt;\n  &lt;/div&gt;\n&lt;/template&gt;</code></pre><figure class=\"kg-card kg-image-card\"><img src=\"__GHOST_URL__/content/images/2022/11/yet-another-login.jpg\" class=\"kg-image\" alt loading=\"lazy\" width=\"600\" height=\"337\" srcset=\"__GHOST_URL__/content/images/2022/11/yet-another-login.jpg 600w\"></figure><h3 id=\"passing-user-token-between-components\">Passing user token between components</h3><p>To share state between components we can use store like <code>pinia</code>, that can be persisted by <code>local-sorage</code>. Other solution is <code>cookie</code>. In our case we will show cokkie implementation because it is build in nuxt and require less lines of code. In biger projects you should consider pinia as more extendable and solution but cookies also have advantages in security area.</p><p>Lets create two variables by <code>useCookie</code> function.</p><pre><code class=\"language-typescript\">const token = useCookie('token');\nconst user = useCookie('user');</code></pre><p>now we will watch on data returned from login request</p><pre><code class=\"language-typescript\">watch(data, (value) =&gt; {\n  token.value = value.jwt;\n  user.value = value.user;\n})</code></pre><p>our <code>useLazyFetch</code> result is now extended by <code>execute</code></p><pre><code class=\"language-typescript\">const {data, error, execute, pending} = await useLazyFetch...</code></pre><p>so login function can be rewritten</p><pre><code class=\"language-typescript\">function login() {\n  if(JSON.stringify(requestBody.value) === JSON.stringify(formBody.value)) {\n    execute()\n  } else {\n    requestBody.value = formBody.value;\n  }\n}</code></pre><p>this change allow to execute login many times with she same payload. </p><figure class=\"kg-card kg-image-card\"><img src=\"__GHOST_URL__/content/images/2022/11/93yay.jpg\" class=\"kg-image\" alt loading=\"lazy\" width=\"490\" height=\"296\"></figure><p>It is especially important to avoid bugs, because we now added also <code>logout</code> function</p><pre><code class=\"language-typescript\">function logout() {\n  token.value = '';\n  user.value = '';\n}</code></pre><p>In template we added <code>token</code> and <code>v-if</code> to display login form for not logged in and logout button for logged in users.</p><pre><code class=\"language-html\">&lt;template&gt;\n  &lt;div&gt;\n    &lt;pre&gt;{{ token }}&lt;/pre&gt;\n    &lt;hr&gt;\n    &lt;pre&gt;PENDING: {{ pending }}&lt;/pre&gt;\n    &lt;pre&gt;DATA: {{ data }}&lt;/pre&gt;\n    &lt;pre&gt;ERROR: {{ error }}&lt;/pre&gt;\n    &lt;hr&gt;\n\n    &lt;div v-if=\"token\"&gt;\n\n      &lt;pre&gt;{{user}}&lt;/pre&gt;\n\n      &lt;button @click=\"logout\"&gt;Logout&lt;/button&gt;\n    &lt;/div&gt;\n    &lt;div v-else&gt;\n      &lt;form @submit.prevent=\"login\"&gt;\n        &lt;label for=\"email\"&gt;\n          Email\n          &lt;input type=\"text\" v-model.lazy=\"formBody.identifier\"&gt;\n        &lt;/label&gt;\n        &lt;label for=\"password\"&gt;\n          Password\n          &lt;input type=\"password\" v-model.lazy=\"formBody.password\"&gt;\n        &lt;/label&gt;\n\n        &lt;button&gt;Login&lt;/button&gt;\n      &lt;/form&gt;\n    &lt;/div&gt;\n  &lt;/div&gt;\n&lt;/template&gt;\n</code></pre><p>We can now create second page</p><pre><code>npx nuxi add page profile</code></pre><p>and in script get user and router and then decide if we need to redirect to login</p><pre><code class=\"language-typescript\">import {useCookie, useRouter} from \"#imports\";\n\nconst user = useCookie('user');\nconst router = useRouter();\n\nif(!user.value) {\n  router.push('/login');\n}</code></pre><p>our symbolic template can have form</p><pre><code class=\"language-html\">&lt;template&gt;\n  &lt;div v-if=\"user\"&gt;\n    &lt;p&gt;Email: {{user.email}}&lt;/p&gt;\n  &lt;/div&gt;\n&lt;/template&gt;</code></pre><p>Thats it. We builded super simple front with login and profile pages. There is no styling, no registration and even I skipped part with strapi setup. But thanks to these simplifications it is useful as base to speedup setting up new nuxt3 projects. I hope it will be usful for you and help to avoid situations like on image below:</p><figure class=\"kg-card kg-image-card\"><img src=\"__GHOST_URL__/content/images/2022/11/xy5zc.jpg\" class=\"kg-image\" alt loading=\"lazy\" width=\"568\" height=\"335\"></figure>","comment_id":"6384f541f20ac751bf7a62f3","plaintext":"How many times in your live did you implemented login view? I did it too much\ntimes. Finally to no search code to copy in my projects I decided to paste here\neasy instruction how to build simple login component in nuxt.\n\nThis setup using strapi as backend, but I will works with any rest API after\nbody and url modifications. In next part we will create nuxt3 project, build\nlogin page and pass info about user by cookie to profile component. \n\nSetup Nuxt project \nTo create project:\n\nnpx nuxi init front_nuxt\n\nWe can create universal Makefile to start project by make up\n\nnode_modules: package.json\n\tnpm i\n\nup: node_modules\n\tnpm run dev\n\n\nNow to start coding we have to replace:\n\n<NuxtWelcome />\n\nin app.vue by\n\n    <NuxtPage />\n\n\nFirst page (login)\nNow create first page\n\nnpx nuxi add page login\n\nWe need to login by REST api but instead of axios we will use useFetch available\nin nuxt. To achieve this goal we have to add .env file with\n\nNUXT_PUBLIC_BASE_URL=http://localhsot:1337\n\n\nand prepend lines\n\ninclude .env\nexport\n\nto the Makefile to read .env without dotenv package.\n\nTo nuxt.config.ts we have to add\n\n    runtimeConfig: {\n        public: {\n            baseUrl: process.env.NUXT_PUBLIC_BASE_URL,\n        },\n    },\n\nNow in script of pages/login.vue we can define formBody and requestBody\n\nimport {ref, useLazyFetch, useRuntimeConfig} from \"#imports\";\n\nconst config = useRuntimeConfig();\n\nconst formBody = ref<{ identifier: string, password: string }>({\n  identifier: 'user@ok.com',\n  password: 'pass'\n});\n\nconst requestBody = ref<{ identifier: string, password: string }>({\n  identifier: '',\n  password: ''\n});\n\ndifferent variables are consequence of reactivity of useLazyFetch method that\nwill automatically send http request when requestBody will be changed. So to\nallow modify formBody without sending http requests we have to split them to two\ndistinct reactive references.\n\nOur request will be performed by useLazyFetch\n\nconst {data, error, pending} = await useLazyFetch(`${config.public.baseUrl}/api/auth/local`, {\n  body: requestBody,\n  method: 'post',\n  immediate: false,\n  watch: [],\n})\n\n\nfinally we can define login function that trigger http request simply changing\nbody in useLazyFetch options.\n\nasync function login() {\n  requestBody.value = formBody.value;\n}\n\nIn template we adding super minimalistic frontend with login form and pre tags\nto present data:\n\n<template>\n  <div>\n    <pre>PENDING: {{ pending }}</pre>\n    <pre>DATA: {{ data }}</pre>\n    <pre>ERROR: {{ error }}</pre>\n    <hr>\n\n    <form @submit.prevent=\"login\">\n      <label for=\"email\">\n        Email\n        <input type=\"text\" v-model.lazy=\"formBody.identifier\">\n      </label>\n      <label for=\"password\">\n        Password\n        <input type=\"password\" v-model.lazy=\"formBody.password\">\n      </label>\n\n      <button>Login</button>\n    </form>\n  </div>\n</template>\n\nPassing user token between components\nTo share state between components we can use store like pinia, that can be\npersisted by local-sorage. Other solution is cookie. In our case we will show\ncokkie implementation because it is build in nuxt and require less lines of\ncode. In biger projects you should consider pinia as more extendable and\nsolution but cookies also have advantages in security area.\n\nLets create two variables by useCookie function.\n\nconst token = useCookie('token');\nconst user = useCookie('user');\n\nnow we will watch on data returned from login request\n\nwatch(data, (value) => {\n  token.value = value.jwt;\n  user.value = value.user;\n})\n\nour useLazyFetch result is now extended by execute\n\nconst {data, error, execute, pending} = await useLazyFetch...\n\nso login function can be rewritten\n\nfunction login() {\n  if(JSON.stringify(requestBody.value) === JSON.stringify(formBody.value)) {\n    execute()\n  } else {\n    requestBody.value = formBody.value;\n  }\n}\n\nthis change allow to execute login many times with she same payload. \n\nIt is especially important to avoid bugs, because we now added also logout \nfunction\n\nfunction logout() {\n  token.value = '';\n  user.value = '';\n}\n\nIn template we added token and v-if to display login form for not logged in and\nlogout button for logged in users.\n\n<template>\n  <div>\n    <pre>{{ token }}</pre>\n    <hr>\n    <pre>PENDING: {{ pending }}</pre>\n    <pre>DATA: {{ data }}</pre>\n    <pre>ERROR: {{ error }}</pre>\n    <hr>\n\n    <div v-if=\"token\">\n\n      <pre>{{user}}</pre>\n\n      <button @click=\"logout\">Logout</button>\n    </div>\n    <div v-else>\n      <form @submit.prevent=\"login\">\n        <label for=\"email\">\n          Email\n          <input type=\"text\" v-model.lazy=\"formBody.identifier\">\n        </label>\n        <label for=\"password\">\n          Password\n          <input type=\"password\" v-model.lazy=\"formBody.password\">\n        </label>\n\n        <button>Login</button>\n      </form>\n    </div>\n  </div>\n</template>\n\n\nWe can now create second page\n\nnpx nuxi add page profile\n\nand in script get user and router and then decide if we need to redirect to\nlogin\n\nimport {useCookie, useRouter} from \"#imports\";\n\nconst user = useCookie('user');\nconst router = useRouter();\n\nif(!user.value) {\n  router.push('/login');\n}\n\nour symbolic template can have form\n\n<template>\n  <div v-if=\"user\">\n    <p>Email: {{user.email}}</p>\n  </div>\n</template>\n\nThats it. We builded super simple front with login and profile pages. There is\nno styling, no registration and even I skipped part with strapi setup. But\nthanks to these simplifications it is useful as base to speedup setting up new\nnuxt3 projects. I hope it will be usful for you and help to avoid situations\nlike on image below:","feature_image":"__GHOST_URL__/content/images/2022/11/9f763a5d299cdb4e0cb731386f96c18d-1.jpg","featured":0,"type":"post","status":"published","locale":null,"visibility":"public","email_recipient_filter":"all","created_at":"2022-11-28T17:52:01.000Z","updated_at":"2022-11-29T19:22:30.000Z","published_at":"2022-11-29T19:22:30.000Z","custom_excerpt":"Simple example of login page in nuxt3 written as base to copy and paste in many similar projects.","codeinjection_head":null,"codeinjection_foot":null,"custom_template":null,"canonical_url":null,"newsletter_id":null,"lexical":null},{"id":"6386ffb8bbda300a2f29c029","uuid":"1e975f41-dc68-43c3-975a-808677a7e9aa","title":"Login by Metamask - Rest Backend in Fastify (Node, Typescript, Prisma) Part 1/2","slug":"login-by-metamask-rest-backend-in-fastify","mobiledoc":"{\"version\":\"0.3.1\",\"atoms\":[],\"cards\":[[\"code\",{\"code\":\"npm init -y\"}],[\"code\",{\"code\":\"tsc --init\"}],[\"code\",{\"code\":\"    \\\"dev\\\": \\\"ts-node-dev --no-notify --respawn --transpile-only src/index.ts\\\",\\n\"}],[\"code\",{\"code\":\"npm i -D ts-node-dev\"}],[\"code\",{\"code\":\"async function main() {\\n    console.log(\\\"ok\\\");\\n}\\n\\nmain().catch(console.error)\\n\",\"language\":\"typescript\"}],[\"code\",{\"code\":\"npm run dev\"}],[\"image\",{\"src\":\"__GHOST_URL__/content/images/2022/11/javascript-typescript-its-just-so-much-better-19507603.png\",\"width\":500,\"height\":441}],[\"image\",{\"src\":\"__GHOST_URL__/content/images/2022/11/1-3qbtNFz7J9yVzt06fAoM5A.png\",\"width\":549,\"height\":173}],[\"code\",{\"code\":\"npm i fastify\"}],[\"code\",{\"code\":\"import fastify, {FastifyInstance} from \\\"fastify\\\";\\n\\nexport function getFastifyServer(): FastifyInstance {\\n    const app = fastify({})\\n    \\n    // there add \\n    // - endpoints\\n    // - hooks\\n    // - middlewares\\n    \\n    return app\\n}\\n\",\"language\":\"typescript\"}],[\"code\",{\"code\":\"import { getFastifyServer } from './fastify'\\n\\nasync function main() {\\n    const app = await getFastifyServer()\\n    await app.listen({ port: 4200, host: '0.0.0.0' })\\n    console.log(`Fastify listen on http://localhost:4200/`)\\n}\\n\\nmain().catch(console.error)\\n\",\"language\":\"typescript\"}],[\"code\",{\"code\":\"import pJson from '../../package.json'\\n\\nexport class Version {\\n    static async root() {\\n        return {\\n            name: pJson.name,\\n            version: pJson.version,\\n        }\\n    }\\n}\\n\",\"language\":\"typescript\"}],[\"code\",{\"code\":\"     \\\"resolveJsonModule\\\": true,                        /* Enable importing .json files. */\\n\",\"language\":\"json\"}],[\"code\",{\"code\":\"    app.get('/', Version.root)\"}],[\"code\",{\"code\":\" http -b localhost:4200\"}],[\"code\",{\"code\":\"{\\n    \\\"name\\\": \\\"metamask-fastify-rest-api\\\",\\n    \\\"version\\\": \\\"1.0.0\\\"\\n}\\n\",\"language\":\"json\"}],[\"image\",{\"src\":\"__GHOST_URL__/content/images/2022/11/EEq5-clUcAEV8Nm.jpg\",\"width\":1080,\"height\":1074}],[\"image\",{\"src\":\"__GHOST_URL__/content/images/2022/11/6b4upqv6at321.jpg\",\"width\":600,\"height\":600}],[\"image\",{\"src\":\"__GHOST_URL__/content/images/2022/11/1642781701974.jpeg\",\"width\":469,\"height\":631}],[\"code\",{\"code\":\"module.exports = {\\n  roots: ['<rootDir>'],\\n  testMatch: ['**/__tests__/**/*.+(ts|tsx)', '**/?(*.)+(spec|test).+(ts|tsx)'],\\n  transform: {\\n    '^.+\\\\\\\\.(ts|tsx)$': 'jest-esbuild',\\n  },\\n  setupFilesAfterEnv: [],\\n  testEnvironment: 'node',\\n}\\n\",\"language\":\"typescript\"}],[\"code\",{\"code\":\"npm i -D jest @types/jest jest-esbuild\"}],[\"code\",{\"code\":\"import pJson from '../package.json'\\nimport { getFastifyServer } from '../src/fastify'\\n\\nconst correctVersion = { name: pJson.name, version: pJson.version }\\n\\ndescribe('i can read version', () => {\\n  it('from rest api', async () => {\\n    const server = await getFastifyServer()\\n    const result = await server.inject({\\n      method: 'GET',\\n      path: '/',\\n    })\\n\\n    expect(result.body).toEqual(JSON.stringify(correctVersion))\\n    expect(result.statusCode).toEqual(200)\\n    expect(result.headers['content-type']).toContain('application/json')\\n  })\\n})\\n\",\"language\":\"typescript\"}],[\"code\",{\"code\":\"npm test\"}],[\"code\",{\"code\":\" PASS  test/version.test.ts\\n  i can read version\\n    ✓ from rest api (14 ms)\\n\\nTest Suites: 1 passed, 1 total\\nTests:       1 passed, 1 total\\nSnapshots:   0 total\\nTime:        0.222 s, estimated 1 s\\nRan all test suites.\",\"language\":\"bash\"}],[\"image\",{\"src\":\"__GHOST_URL__/content/images/2022/11/6unvjk.jpg\",\"width\":500,\"height\":680}],[\"image\",{\"src\":\"__GHOST_URL__/content/images/2022/11/2022-11-30_13-47_1.png\",\"width\":533,\"height\":744}],[\"code\",{\"code\":\"npm i prisma @prisma/client\"}],[\"code\",{\"code\":\"npx prisma init\"}],[\"code\",{\"code\":\"generator client {\\n  provider = \\\"prisma-client-js\\\"\\n}\\n\\ndatasource db {\\n  provider = \\\"mongodb\\\"\\n  url      = env(\\\"DATABASE_URL\\\")\\n}\\n\\nmodel users {\\n  id      String @id @default(auto()) @map(\\\"_id\\\") @db.ObjectId\\n  address String @unique\\n  nonce   String\\n}\\n\",\"language\":\"prisma\"}],[\"code\",{\"code\":\"DATABASE_URL=mongodb://localhost:27017/web3_bdl\"}],[\"image\",{\"src\":\"__GHOST_URL__/content/images/2022/11/anMGwKn_460s.jpg\",\"width\":460,\"height\":291}],[\"bookmark\",{\"type\":\"bookmark\",\"url\":\"https://www.mongodb.com/docs/manual/replication/\",\"metadata\":{\"url\":\"https://www.mongodb.com/docs/manual/replication/\",\"title\":\"Replication — MongoDB Manual\",\"description\":null,\"author\":null,\"publisher\":null,\"thumbnail\":\"https://www.mongodb.com/docs/assets/meta_generic.png\",\"icon\":\"https://www.mongodb.com/docs/assets/favicon.ico\"}}],[\"code\",{\"code\":\"replication:\\n  replSetName: rs0\"}],[\"code\",{\"code\":\"rs.initiate()\"}],[\"code\",{\"code\":\"rs.status()\"}],[\"code\",{\"code\":\"npx prisma generate\"}],[\"code\",{\"code\":\"import {PrismaClient} from \\\"@prisma/client\\\";\\n\\nfunction dbUrl() {\\n    const url = process.env.DATABASE_URL;\\n\\n    if(!url) throw new Error(`No db url`);\\n\\n    if(process.env.NODE_ENV === 'test') {\\n        if(url.includes('?')) {\\n            throw new Error('test url not implemented for this db')\\n        }\\n        return url + '_test'\\n    } else {\\n        return url;\\n    }\\n}\\n\\nconst prisma = new PrismaClient({\\n    datasources: {\\n        db: {\\n            url: dbUrl()\\n        }\\n    }\\n})\\n\\nexport {\\n    prisma,\\n    PrismaClient\\n}\\n\",\"language\":\"typescript\"}],[\"image\",{\"src\":\"__GHOST_URL__/content/images/2022/11/b5867e5f337d3e62328e6a2c3a78c250d0f7ab511cf53864d6d5099f946ba055_3.jpg\",\"width\":460,\"height\":376}],[\"code\",{\"code\":\"include .env\\nexport\\n\\nnode_modules: package.json\\n\\tnpm i\\n\\nup: node_modules\\n\\tnpm run dev\\n\",\"language\":\"makefile\"}],[\"code\",{\"code\":\"npm run dev\"}],[\"code\",{\"code\":\"make up\"}],[\"code\",{\"code\":\"npm i @fastify/sensible\"}],[\"code\",{\"code\":\"import fastifySensible from '@fastify/sensible'\\n\",\"language\":\"typescript\"}],[\"code\",{\"code\":\"    app.register(fastifySensible)\\n\"}],[\"code\",{\"code\":\"    app.get('/users/:address/nonce', User.getNonce)\\n\",\"language\":\"typescript\"}],[\"code\",{\"code\":\"import {FastifyRequest} from \\\"fastify\\\";\\nimport {prisma} from \\\"../storage/prisma\\\";\\n\\nexport class User {\\n    static async getNonce(req: FastifyRequest<{ Params: { address: string } }>, res: FastifyReply) {\\n        const address = req.params.address;\\n\\n        const user = await prisma.users.findUnique({\\n            where: {\\n                address\\n            }\\n        })\\n\\n        if (!user) return res.notFound()\\n\\n        return {\\n            nonce: user.nonce\\n        }\\n    }\\n}\\n\",\"language\":\"typescript\"}],[\"code\",{\"code\":\"http -b localhost:4200/users/123/nonce\\n{\\n    \\\"error\\\": \\\"Not Found\\\",\\n    \\\"message\\\": \\\"Not Found\\\",\\n    \\\"statusCode\\\": 404\\n}\"}],[\"code\",{\"code\":\"import {prisma} from \\\"./prisma\\\";\\n\\nexport async function seed() {\\n    await prisma.users.deleteMany();\\n}\\n\",\"language\":\"typescript\"}],[\"code\",{\"code\":\"import { getFastifyServer } from '../src/fastify'\\nimport {seed} from \\\"../src/storage/seed\\\";\\nimport {prisma} from \\\"../src/storage/prisma\\\";\\n\\ndescribe('searching user by address', () => {\\n  it('address not found', async () => {\\n    await seed();\\n\\n    const server = await getFastifyServer()\\n    const result = await server.inject({\\n      method: 'GET',\\n      path: '/users/abc/nonce',\\n    })\\n\\n\\n    expect(result.statusCode).toEqual(404);\\n    expect(result.body).toEqual(JSON.stringify({\\n      statusCode: 404,\\n      error: \\\"Not Found\\\",\\n      message: \\\"Not Found\\\"\\n    }))\\n  })\\n\\n  it('address found and nonce is correct', async () => {\\n    await prisma.users.upsert({\\n      where: {\\n        address: \\\"abc\\\"\\n      },\\n      create: {\\n        address: \\\"abc\\\",\\n        nonce: \\\"secret\\\"\\n      },\\n      update: {\\n        nonce: \\\"secret\\\"\\n      }\\n    })\\n\\n    const server = await getFastifyServer()\\n    const result = await server.inject({\\n      method: 'GET',\\n      path: '/users/abc/nonce',\\n    })\\n\\n    expect(result.statusCode).toEqual(200);\\n    expect(result.body).toEqual(JSON.stringify({\\n      nonce: 'secret'\\n    }))\\n\\n  })\\n})\\n\",\"language\":\"typescript\"}],[\"image\",{\"src\":\"__GHOST_URL__/content/images/2022/11/android-mocking.jpg\",\"width\":1344,\"height\":900}],[\"code\",{\"code\":\"npm i uid\"}],[\"code\",{\"code\":\"    static async register(req: FastifyRequest<{\\n        Body: {\\n            address: string\\n        }\\n    }>, res: FastifyReply) {\\n        const found = await prisma.users.findUnique({\\n            where: {\\n                address: req.body.address\\n            }\\n        })\\n\\n        if (found) return res.code(200).send({\\n            nonce: found.nonce\\n        });\\n\\n        const nonce = uid(20);\\n        await prisma.users.create({\\n            data: {\\n                address: req.body.address,\\n                nonce,\\n            }\\n        })\\n\\n        return res.code(201).send({\\n            nonce\\n        });\\n    }\",\"language\":\"typescript\"}],[\"code\",{\"code\":\"    app.post('/register', User.register)\\n\",\"language\":\"typescript\"}],[\"code\",{\"code\":\"import { getFastifyServer } from '../src/fastify'\\nimport {seed} from \\\"../src/storage/seed\\\";\\nimport {Response } from \\\"light-my-request\\\";\\n\\ndescribe('user can register account', () => {\\n  it('first and second registration', async () => {\\n    await seed();\\n\\n    async function registerUser(address: string): Promise<Response> {\\n      return server.inject({\\n        method: 'POST',\\n        path: '/register',\\n        payload: {\\n          'address': address\\n        }\\n      })\\n    }\\n\\n    const server = await getFastifyServer()\\n    const result1 =await registerUser(\\\"abc\\\")\\n\\n    expect(result1.statusCode).toEqual(201);\\n    expect(result1.headers['content-type']).toContain(\\\"application/json\\\");\\n\\n    const result2 =await registerUser(\\\"abc\\\")\\n\\n    expect(result2.statusCode).toEqual(200);\\n    expect(result2.body).toEqual(result1.body);\\n  })\\n})\\n\",\"language\":\"typescript\"}],[\"image\",{\"src\":\"__GHOST_URL__/content/images/2022/11/1-xwScPTcIGgjWfZIcEeR2oA.png\",\"width\":610,\"height\":343}],[\"code\",{\"code\":\"npm i ethers\"}],[\"code\",{\"code\":\"import {utils} from \\\"ethers\\\";\\nimport { users} from \\\"@prisma/client\\\";\\n\\nexport function getAddress(nonce: string, signature: string): string {\\n    return utils.verifyMessage(nonce, signature).toLowerCase()\\n}\\n\\nexport function verifyUser(user: Pick<users, 'nonce' | 'address'>, signature: string): boolean {\\n    try {\\n        return getAddress(user.nonce, signature) === user.address;\\n    } catch {\\n        return false;\\n    }\\n}\\n\",\"language\":\"typescript\"}],[\"code\",{\"code\":\"import {verifyUser, getAddress} from \\\"../src/auth/getUser\\\";\\n\\nconst address = '0xa68701d9b3eb52f0a7248e7b57d484411a60b045';\\nconst nonce = '14b2a79636d81fbb10f9';\\nconst signature = '0x5d8f425c91437148b65f47e9444d91e868d3566d868649fec58c76010c8f01992edd2db3284088d5f5048fc3bc9eff307e0cd1b8b1a2e6c96a2784eb5fd5358d1b';\\n\\n\\ndescribe('i can authenticate signature', () => {\\n    it('auth', () => {\\n        expect(getAddress(nonce, signature)).toEqual(address)\\n        expect(verifyUser({nonce, address}, signature)).toBeTruthy();\\n    })\\n});\\n\",\"language\":\"typescript\"}],[\"code\",{\"code\":\"ethereum.enable()\",\"language\":\"javascript\"}],[\"code\",{\"code\":\"ethereum.selectedAddress\",\"language\":\"javascript\"}],[\"code\",{\"code\":\"function utf8ToHex(str) {\\n  return Array.from(str).map(c =>\\n      c.charCodeAt(0) < 128 ? c.charCodeAt(0).toString(16) :\\n          encodeURIComponent(c).replace(/\\\\%/g, '').toLowerCase()\\n  ).join('');\\n}\",\"language\":\"javascript\"}],[\"code\",{\"code\":\"nonce = 'abc'\",\"language\":\"javascript\"}],[\"code\",{\"code\":\"await ethereum.request({\\n    method: \\\"personal_sign\\\",\\n    params: [utf8ToHex(nonce), ethereum.selectedAddress],\\n  })\",\"language\":\"javascript\"}],[\"code\",{\"code\":\"npm i jsonwebtoken dayjs\\nnpm i --save-dev @types/jsonwebtoken\"}],[\"code\",{\"code\":\"import dayjs from \\\"dayjs\\\";\\nimport jwt from 'jsonwebtoken'\\n\\nconst jwtKey = process.env.JWT_SECRET_KEY ?? 'test';\\nconst issuer = 'I <3 web3'; // name of organization\\n\\n\\nexport function tokenizeUser(user: Pick<users, 'address'>): string {\\n    return jwt.sign({\\n        sub: user.address,\\n        iss: issuer,\\n        exp: dayjs().add(1, 'month').unix()\\n    }, jwtKey)\\n}\",\"language\":\"typescript\"}],[\"code\",{\"code\":\"JWT_SECRET_KEY=123\"}],[\"code\",{\"code\":\"import {tokenizeUser, verifyUser} from \\\"../auth/getUser\\\";\\n\\n// ...\\n\\n    static async login(req: FastifyRequest<{\\n        Body: { address: string, sig: string, nonce: string }\\n    }>, res: FastifyReply) {\\n        const {address, sig, nonce} = req.body\\n\\n        if (!address || !sig || !nonce) return res.expectationFailed('invalid body');\\n\\n        const verified = verifyUser({address, nonce}, sig);\\n        if (!verified) return res.unauthorized();\\n\\n\\n        return {\\n            token: tokenizeUser({address})\\n        }\\n    }\",\"language\":\"typescript\"}],[\"code\",{\"code\":\"    app.post('/login', User.login)\\n\",\"language\":\"typescript\"}],[\"code\",{\"code\":\"import {getFastifyServer} from \\\"../src/fastify\\\";\\nimport {seed} from \\\"../src/storage/seed\\\";\\nimport {prisma} from \\\"../src/storage/prisma\\\";\\nimport {Response} from \\\"light-my-request\\\";\\n\\n\\n    it('and see his token', async () => {\\n        await seed();\\n        await prisma.users.create({\\n            data: {\\n                address,\\n                nonce\\n            },\\n        })\\n\\n        async function login(signature: string): Promise<Response> {\\n            return server.inject({\\n                method: 'POST',\\n                path: '/login',\\n                payload: {\\n                    address,\\n                    sig: signature,\\n                    nonce\\n                }\\n            })\\n        }\\n\\n        const server = await getFastifyServer()\\n        const result1 = await login(\\\"abc\\\")\\n\\n        expect(result1.statusCode).toEqual(401);\\n        expect(result1.body).toEqual(JSON.stringify({\\n            statusCode: 401, error: \\\"Unauthorized\\\", message: \\\"Unauthorized\\\"\\n        }));\\n\\n        const result2 = await login(signature)\\n\\n        expect(result2.statusCode).toEqual(200);\\n        expect(result2.body).toEqual(JSON.stringify({\\n            token: tokenizeUser({address})\\n        }));\\n    })\",\"language\":\"typescript\"}],[\"image\",{\"src\":\"__GHOST_URL__/content/images/2022/11/5834555ede7a912e00000942.png\",\"width\":477,\"height\":207}],[\"code\",{\"code\":\"interface JwtPayloadCustomer {\\n    iss: string\\n    iat: number\\n    exp: number\\n    sub: string\\n}\\n\\nfunction getExpDate(jwtPayload: { exp: number }): Date {\\n    return dayjs.unix(jwtPayload.exp).toDate()\\n}\\n\\nexport function getUser(token?: string): JWTUser | null {\\n    if (!token) {\\n        return null\\n    } else {\\n        token = token.replace(/^Bearer\\\\s+/, '')\\n\\n        const jwtPayload = jwt.verify(token, jwtKey) as unknown as JwtPayloadCustomer\\n\\n        const sub = jwtPayload.sub\\n\\n        return {\\n            address: sub,\\n            token_expiring_at: getExpDate(jwtPayload),\\n        }\\n    }\\n}\",\"language\":\"typescript\"}],[\"code\",{\"code\":\"import { PrismaClient } from '../storage/prisma'\\n\\nexport interface JWTUser {\\n  address: string\\n  token_expiring_at: Date\\n}\\n\",\"language\":\"typescript\"}],[\"code\",{\"code\":\"declare module 'fastify' {\\n    interface FastifyRequest {\\n        user: JWTUser | null\\n    }\\n}\",\"language\":\"typescript\"}],[\"code\",{\"code\":\"async function auth(request: FastifyRequest, reply: FastifyReply) {\\n    const token = (request.headers.authorization || '').replace(/Bearer\\\\s+/, '') || undefined\\n    request.user = getUser(token)\\n    if (!request.user) reply.unauthorized()\\n}\",\"language\":\"typescript\"}],[\"code\",{\"code\":\"    app.get('/me', {preValidation: [auth]}, User.root)\",\"language\":\"typescript\"}],[\"code\",{\"code\":\"    static async root(req: FastifyRequest, res: FastifyReply) {\\n        return req.user;\\n    }\"}],[\"image\",{\"src\":\"__GHOST_URL__/content/images/2022/11/2022-11-30_18-57.png\",\"width\":1184,\"height\":183}],[\"image\",{\"src\":\"__GHOST_URL__/content/images/2022/11/2022-11-30_18-59.png\",\"width\":941,\"height\":138}],[\"image\",{\"src\":\"__GHOST_URL__/content/images/2022/11/2022-11-30_19-00.png\",\"width\":1607,\"height\":242}],[\"image\",{\"src\":\"__GHOST_URL__/content/images/2022/11/2022-11-30_19-01.png\",\"width\":1602,\"height\":249}],[\"code\",{\"code\":\"import { getFastifyServer } from '../src/fastify'\\nimport {seed} from \\\"../src/storage/seed\\\";\\nimport {prisma} from \\\"../src/storage/prisma\\\";\\nimport {tokenizeUser} from \\\"../src/auth/getUser\\\";\\n\\nconst address = 'abc';\\n\\ndescribe('i can see my account', () => {\\n    it('using token', async () => {\\n        await seed();\\n        prisma.users.create({\\n            data: {\\n                address,\\n                nonce: 'secret'\\n            }\\n        })\\n\\n        const server = await getFastifyServer()\\n        const result = await server.inject({\\n            method: 'GET',\\n            path: '/me',\\n            headers: {\\n                authorization: `Bearer ${tokenizeUser({address})}`\\n            }\\n        })\\n\\n        expect(JSON.parse(result.body)).toMatchObject({\\n            address\\n        })\\n        expect(result.statusCode).toEqual(200)\\n        expect(result.headers['content-type']).toContain('application/json')\\n    })\\n})\\n\",\"language\":\"typescript\"}],[\"code\",{\"code\":\"Invalid `prisma.users.deleteMany()` i\\nnvocation:\\n\\n\\n    Transaction failed due to a write con\\nflict or a deadlock. Please retry your tr\\nansaction\"}],[\"code\",{\"code\":\"    \\\"test\\\": \\\"jest --runInBand\\\",\\n\"}],[\"code\",{\"code\":\"npm i @fastify/cors\"}],[\"code\",{\"code\":\"import cors from '@fastify/cors'\\n\\n//...\\n\\n    app.register(cors)\\n\",\"language\":\"typescript\"}],[\"code\",{\"code\":\"import {getFastifyServer} from '../src/fastify'\\n\\ndescribe('cors', () => {\\n    it('for get I have access-control-allow-origin', async () => {\\n        const server = await getFastifyServer()\\n        const result = await server.inject({\\n            method: 'GET',\\n            path: '/',\\n        })\\n\\n        expect(result.statusCode).toEqual(200)\\n        expect(result.headers['access-control-allow-origin']).toEqual('*')\\n    })\\n\\n    it('for options I see cors headers', async () => {\\n        const server = await getFastifyServer()\\n        const result = await server.inject({\\n            method: 'OPTIONS',\\n            path: '/',\\n            headers: {\\n                'Access-Control-Request-Method': 'GET',\\n                'Origin': 'https://ilove.ethereum'\\n            }\\n        })\\n\\n        expect(result.statusCode).toEqual(204)\\n        expect(result.headers['access-control-allow-origin']).toEqual('*')\\n\\n    })\\n})\\n\",\"language\":\"typescript\"}],[\"image\",{\"src\":\"__GHOST_URL__/content/images/2022/11/cw7i8et55g551.jpg\",\"width\":1024,\"height\":919}],[\"code\",{\"code\":\"npm i cli-color\\nnpm i -D @types/cli-color\"}],[\"code\",{\"code\":\"function shouldPrintError(error: FastifyError) {\\n    return process.env.NODE_ENV !== 'test' && (!error.statusCode || !(error.statusCode >= 400 && error.statusCode < 500))\\n}\",\"language\":\"typescript\"}],[\"code\",{\"code\":\"import {red, yellow} from 'cli-color'\\n\\n\\n    app.addHook('onError', async (request, reply, error) => {\\n        if (shouldPrintError(error)) {\\n            console.log(red(error), yellow(String(error.stack).replace(`Error: ${error.message}`, '')))\\n        }\\n        if (isNativeError(error)) {\\n            return reply.internalServerError(error.message)\\n        }\\n        throw error\\n    })\",\"language\":\"typescript\"}],[\"image\",{\"src\":\"__GHOST_URL__/content/images/2022/11/2022-11-30_20-25.png\",\"width\":720,\"height\":154}],[\"code\",{\"code\":\"\\\"build\\\": \\\"tsc\\\"\"}],[\"code\",{\"code\":\"tsc --build --clean\"}],[\"code\",{\"code\":\"name: Node.js CI\\n\\non:\\n  push:\\n    branches: [ \\\"main\\\" ]\\n  pull_request:\\n    branches: [ \\\"main\\\" ]\\n\\njobs:\\n  build:\\n\\n    runs-on: ubuntu-latest\\n\\n    strategy:\\n      matrix:\\n        node-version: [18.x]\\n        # See supported Node.js release schedule at https://nodejs.org/en/about/releases/\\n\\n    steps:\\n    - uses: actions/checkout@v3\\n    - name: Use Node.js ${{ matrix.node-version }}\\n      uses: actions/setup-node@v3\\n      with:\\n        node-version: ${{ matrix.node-version }}\\n        cache: 'npm'\\n    - run: npm ci\\n    - run: npm run build --if-present\\n    - run: npm test\\n\",\"language\":\"yml\"}],[\"code\",{\"code\":\"name: Node.js CI\\n\\non:\\n  push:\\n    branches: [ \\\"main\\\" ]\\n  pull_request:\\n    branches: [ \\\"main\\\" ]\\n\\nenv:\\n  JWT_SECRET_KEY: 123\\n  DATABASE_URL: mongodb://localhost:27017/web3_bdl\\n\\njobs:\\n  build:\\n\\n    runs-on: ubuntu-latest\\n\\n    strategy:\\n      matrix:\\n        node-version: [18.x]\\n        mongodb-version: ['5.0']\\n\\n    steps:\\n    - uses: actions/checkout@v3\\n    - name: Use Node.js ${{ matrix.node-version }}\\n      uses: actions/setup-node@v3\\n      with:\\n        node-version: ${{ matrix.node-version }}\\n        cache: 'npm'\\n\\n    - name: Start MongoDB\\n      uses: supercharge/mongodb-github-action@1.8.0\\n      with:\\n        mongodb-version: ${{ matrix.mongodb-version }}\\n        mongodb-replica-set: rs-test\\n\\n    - run: npm ci\\n    - run: npm test\\n    - run: npm run build --if-present\\n\",\"language\":\"yml\"}],[\"bookmark\",{\"type\":\"bookmark\",\"url\":\"https://github.com/gustawdaniel/metamask-fastify-rest-api\",\"metadata\":{\"url\":\"https://github.com/gustawdaniel/metamask-fastify-rest-api\",\"title\":\"GitHub - gustawdaniel/metamask-fastify-rest-api\",\"description\":\"Contribute to gustawdaniel/metamask-fastify-rest-api development by creating an account on GitHub.\",\"author\":\"gustawdaniel\",\"publisher\":\"GitHub\",\"thumbnail\":\"https://opengraph.githubassets.com/f01f87b773a73f3bad53b83e622cfd82a917f3c0110cec2b4b9a6e7dee7d9cac/gustawdaniel/metamask-fastify-rest-api\",\"icon\":\"https://github.githubassets.com/favicons/favicon.svg\"}}]],\"markups\":[[\"code\"]],\"sections\":[[1,\"p\",[[0,[],0,\"Metamask is a crypto wallet & gateway to blockchain apps. It can be installed as mobile app or browser extension. Maetmask can be used to build costless, cryptograficly secure authorization flow without processing personal data.\"]]],[1,\"p\",[[0,[],0,\"In this blog I will show you how to prepare rest api in fastify. To test we will use \"],[0,[0],1,\"jest\"],[0,[],0,\". As db we select \"],[0,[0],1,\"mongodb\"],[0,[],0,\" connected by \"],[0,[0],1,\"prisma\"],[0,[],0,\". First part describes setup \"],[0,[0],1,\"version\"],[0,[],0,\" endpoint and configuration of environement. Then we will show diagram of auth flow, connect database and implement all endpoints.\"]]],[1,\"h2\",[[0,[],0,\"Setup Node Project with Typescript\"]]],[1,\"p\",[[0,[],0,\"Firsts commands in new \"],[0,[0],1,\"nodejs\"],[0,[],0,\" project with \"],[0,[0],1,\"typescript\"],[0,[],0,\" are always initialization of \"],[0,[0],1,\"package.json\"]]],[10,0],[1,\"p\",[[0,[],0,\"and \"],[0,[0],1,\"tsconfig.json\"]]],[10,1],[1,\"p\",[[0,[],0,\"Now we have to decide, how to run our project. Ancient methods like \"],[0,[0],1,\"ts-node\"],[0,[],0,\" with \"],[0,[0],1,\"nodemon\"],[0,[],0,\" was abandoned by me when I meet \"],[0,[0],1,\"ts-node-dev\"],[0,[],0,\". It restarts target node process when any of required files changes (as standard node-dev) but shares Typescript compilation process between restarts. This significantly increases speed of restarting comparing to mentioned solutions. In \"],[0,[0],1,\"package.json\"],[0,[],0,\" scripts we can add line:\"]]],[10,2],[1,\"p\",[[0,[],0,\"lets install \"],[0,[0],1,\"ts-node-dev\"]]],[10,3],[1,\"p\",[[0,[],0,\"in \"],[0,[0],1,\"src/index.ts\"],[0,[],0,\" we can add content\"]]],[10,4],[1,\"p\",[[0,[],0,\"and run it by\"]]],[10,5],[1,\"p\",[[0,[],0,\"It will show \\\"ok\\\" and will wait for changes to react on them in real time.\"]]],[10,6],[1,\"h2\",[[0,[],0,\"Add Fastify with first endpoint\"]]],[1,\"p\",[[0,[],0,\"Fastify is framework similar to express but with two advantages\"]]],[3,\"ul\",[[[0,[],0,\"it is about 20% faster in requests processing\"]]]],[10,7],[3,\"ul\",[[[0,[],0,\"it is faster in developemnt thanks to useful simplifications in his API\"]]]],[1,\"p\",[[0,[],0,\"One disadvantage of fastify is smaller comunity (32 times smaller now).\"]]],[1,\"p\",[[0,[],0,\"To install \"],[0,[0],1,\"fastify\"],[0,[],0,\" type:\"]]],[10,8],[1,\"p\",[[0,[],0,\"Now we can create \"],[0,[0],1,\"src/fastify.ts\"],[0,[],0,\"  with content:\"]]],[10,9],[1,\"p\",[[0,[],0,\"and in \"],[0,[0],1,\"src/index.ts\"],[0,[],0,\" import it and use to run server on selected port\"]]],[10,10],[1,\"p\",[[0,[],0,\"Now it is not very useful, because we did not defined any route, middleware or hook to process requests. Lets do it and define \"],[0,[0],1,\"/\"],[0,[],0,\" endpoint.\"]]],[1,\"h2\",[[0,[],0,\"First endpoint in Fastify - project version\"]]],[1,\"p\",[[0,[],0,\" This will be public route but to no litter \"],[0,[0],1,\"fastify.ts\"],[0,[],0,\" file we will create next one \"],[0,[0],1,\"src/routes/version.ts\"],[0,[],0,\" with content\"]]],[10,11],[1,\"p\",[[0,[],0,\"It is simple class with static method that returns object. Fastify will convert it to response with content type \"],[0,[0],1,\"application/json\"],[0,[],0,\" for us, but we have to enable \"],[0,[0],1,\"resolveJsonModule\"],[0,[],0,\" option in \"],[0,[0],1,\"tsconfig.json\"]]],[10,12],[1,\"p\",[[0,[],0,\"now in center of \"],[0,[0],1,\"fastify.ts\"],[0,[],0,\" file we can add\"]]],[10,13],[1,\"p\",[[0,[],0,\"and request to main route of our server\"]]],[10,14],[1,\"p\",[[0,[],0,\"starts return response\"]]],[10,15],[10,16],[1,\"h2\",[[0,[],0,\"Tests in Jest with esbuild\"]]],[1,\"p\",[[0,[],0,\"If you are programmer more time, than one day you are aware how easy is break up your working program changing something in source code in random places. Fortunately we can write test that prove that code is working as we expecting.\"]]],[10,17],[1,\"p\",[[0,[],0,\"In node js word one of best testing frameworks is \"],[0,[0],1,\"jest\"],[0,[],0,\". But to connect it with typescript we need plugin that will transform \"],[0,[0],1,\"ts\"],[0,[],0,\" files.  It is terrible that most popular \"],[0,[0],1,\"ts-jest\"],[0,[],0,\" is 2000 times more frequently used that about 26 times faster \"],[0,[0],1,\"jest-ebuild\"],[0,[],0,\". But lets use technology from the future - esbuild.\"]]],[10,18],[1,\"p\",[[0,[],0,\"Our \"],[0,[0],1,\"jest.config.ts\"],[0,[],0,\" will contain\"]]],[10,19],[1,\"p\",[[0,[],0,\"Lets install packages\"]]],[10,20],[1,\"p\",[[0,[],0,\"and add \"],[0,[0],1,\"test\"],[0,[],0,\" script in \"],[0,[0],1,\"package.json\"]]],[1,\"p\",[[0,[],0,\"our first test file \"],[0,[0],1,\"test/version.test.ts\"],[0,[],0,\" can look as follow:\"]]],[10,21],[1,\"p\",[[0,[],0,\"Now when you type\"]]],[10,22],[1,\"p\",[[0,[],0,\"you should see\"]]],[10,23],[10,24],[1,\"p\",[[0,[],0,\"We have configured fastify server with live reload development environment and super fast tests configured in jest. We created first endpoint that returns name and version of server on root endpoint. It is time to describe auth flow and implement required routes.\"]]],[1,\"h2\",[[0,[],0,\"Auth flow diagram\"]]],[1,\"p\",[[0,[],0,\"Generally idea is the following. User has private key connected with his wallet address. We can save this address to database as his unique id and generate nonce for him. Nonce is simple random phrase generated to check if user can correctly sing it using his own address. If nonce will leak, it is nothing scarry, because nobody will be able to sign it with correct address is he does not possess private key. Below we presenting diagram:  \"]]],[10,25],[1,\"p\",[[0,[],0,\"So we need users collection only with \"],[0,[0],1,\"address\"],[0,[],0,\" and \"],[0,[0],1,\"nonce\"],[0,[],0,\" and 4 endpoints\"]]],[3,\"ul\",[[[0,[],0,\"to get nonce for given address\"]],[[0,[],0,\"to register new address and assign him nonce\"]],[[0,[],0,\"to login using address, nonce and signature\"]],[[0,[],0,\"to get my account details using JWT token\"]]]],[1,\"h2\",[[0,[],0,\"DB model with prisma\"]]],[1,\"p\",[[0,[],0,\"Prisma is greate pice of software that helps to use database in reliable way thanks to great types and interfaces allowing to staticly validate all places in code when we using database. \"]]],[1,\"p\",[[0,[],0,\"To install prisma we will need two libraries\"]]],[10,26],[1,\"p\",[[0,[],0,\"Now typing:\"]]],[10,27],[1,\"p\",[[0,[],0,\"we can generate initial setup.\"]]],[1,\"p\",[[0,[],0,\"There was created \"],[0,[0],1,\".env\"],[0,[],0,\" with \"],[0,[0],1,\"DATABASE_URL\"],[0,[],0,\" and \"],[0,[0],1,\"prisma/schema.prisma\"],[0,[],0,\", that by default use postgresql. We need mongo so lets modify file with schema\"]]],[10,28],[1,\"p\",[[0,[],0,\"and in \"],[0,[0],1,\".env\"],[0,[],0,\" we can select address to our mongo database\"]]],[10,29],[10,30],[1,\"h3\",[[0,[],0,\"Mongo in Replica Set Mode\"]]],[1,\"p\",[[0,[],0,\"It is important, that prisma now using mongo in replica mode.\"]]],[10,31],[1,\"p\",[[0,[],0,\"to configure it you will need add lines\"]]],[10,32],[1,\"p\",[[0,[],0,\"to your mongodb config \"],[0,[0],1,\"/etc/mongod.conf\"],[0,[],0,\". This path depent from your OS.\"]]],[1,\"p\",[[0,[],0,\"In \"],[0,[0],1,\"mongo\"],[0,[],0,\" cli you should execute\"]]],[10,33],[1,\"p\",[[0,[],0,\"to setup replica set and \"]]],[10,34],[1,\"p\",[[0,[],0,\"to check it. You will have to restart your mongo service to read changes from config.\"]]],[1,\"h3\",[[0,[],0,\"Generation typescript from prisma\"]]],[1,\"p\",[[0,[],0,\"If you have correctly configured mongo and created user models, run\"]]],[10,35],[1,\"p\",[[0,[],0,\"this command will generate typescript to help with autocompletion and static validation your further code.\"]]],[1,\"h3\",[[0,[],0,\"Single prisma client for all application\"]]],[1,\"p\",[[0,[],0,\"It is rather good practice to configure db access point in single place and import it from this file than use library. In our case it will be file \"],[0,[0],1,\"src/storage/prisma.ts\"],[0,[],0,\". In this file we will modify \"],[0,[0],1,\"DATABASE_URL\"],[0,[],0,\" adding \"],[0,[0],1,\"_test\"],[0,[],0,\" at the end in test environment. Thanks to this modification we can do not care about distinct set of env for test and can avoid overriding our local data during tests written in jest.\"]]],[10,36],[1,\"p\",[[0,[],0,\"Now we can import prisma from this place and get access to proper database in dependence from \"],[0,[0],1,\"NODE_ENV\"],[0,[],0,\".\"]]],[10,37],[1,\"h3\",[[0,[],0,\"Passing env to process\"]]],[1,\"p\",[[0,[],0,\"Not there is last challenge connected with databae - passing db address to program in secure way. We can do it by \"],[0,[0],1,\"dotenv\"],[0,[],0,\" library but I prefer \"],[0,[0],1,\"Makefile\"],[0,[],0,\" as access point ot application because it is more universal way and can be applied with \"],[0,[0],1,\"python\"],[0,[],0,\", \"],[0,[0],1,\"go\"],[0,[],0,\", \"],[0,[0],1,\"ruby\"],[0,[],0,\" and other languages in the same way. This is my \"],[0,[0],1,\"Makefile\"]]],[10,38],[1,\"p\",[[0,[],0,\"so from now, instead of writing\"]]],[10,39],[1,\"p\",[[0,[],0,\"you can write\"]]],[10,40],[1,\"p\",[[0,[],0,\"of course it is only solution in development mode. In production it is better pass environment variables using docker or similar solution.\"]]],[1,\"h2\",[[0,[],0,\"Checking if user with address exists\"]]],[1,\"p\",[[0,[],0,\"First step in our diagram was checking is user with given address exists and get his nonce. If address no exists we want to return \"],[0,[0],1,\"Not Found\"],[0,[],0,\" answer. We can use helper to create \"],[0,[0],1,\"notFound\"],[0,[],0,\" answer using \"],[0,[0],1,\"@fastify/sensible\"],[0,[],0,\". Lets install it:\"]]],[10,41],[1,\"p\",[[0,[],0,\"now we can import it in \"],[0,[0],1,\"src/fastify.ts\"]]],[10,42],[1,\"p\",[[0,[],0,\"and register in body of \"],[0,[0],1,\"getFastifyServer\"],[0,[],0,\" function\"]]],[10,43],[1,\"p\",[[0,[],0,\"To add endpoint finding users by address add here also line\"]]],[10,44],[1,\"p\",[[0,[],0,\"We will need to import user from \"],[0,[0],1,\"routes\"],[0,[],0,\" so in \"],[0,[0],1,\"src/routes/user.ts\"],[0,[],0,\" lets create class \"],[0,[0],1,\"User\"],[0,[],0,\" with static method \"],[0,[0],1,\"getNonce\"],[0,[],0,\" like before we done with \"],[0,[0],1,\"version\"],[0,[],0,\".\"]]],[10,45],[1,\"p\",[[0,[],0,\"Now we can test it manually\"]]],[10,46],[1,\"p\",[[0,[],0,\"but it is better to write tests in \"],[0,[0],1,\"jest\"],[0,[],0,\". Before writing tests we will prepare \"],[0,[0],1,\"src/storage/seed.ts\"],[0,[],0,\" file with function \"],[0,[0],1,\"seed\"],[0,[],0,\" to clear our database.\"]]],[10,47],[1,\"p\",[[0,[],0,\"Now in \"],[0,[0],1,\"test/address.test.ts\"],[0,[],0,\" we can write tests to check if this endpoint is working.\"]]],[10,48],[1,\"p\",[[0,[],0,\"Here we covered all possible scenarios. \"]]],[10,49],[1,\"h2\",[[0,[],0,\"Register user using wallet address\"]]],[1,\"p\",[[0,[],0,\"Now user can check if his address is registered. Of course if he will see our app first time, he will not be registered, so he will get 404 and will try to register his address. Lets implement registration.\"]]],[1,\"p\",[[0,[],0,\"Nonce have to be random string. To generate it we will use \"],[0,[0],1,\"uid\"],[0,[],0,\" package.\"]]],[10,50],[1,\"p\",[[0,[],0,\"In \"],[0,[0],1,\"src/routes/user.ts\"],[0,[],0,\" we adding new static method do \"],[0,[0],1,\"User\"],[0,[],0,\" class\"]]],[10,51],[1,\"p\",[[0,[],0,\"Logic here is super simple. We are seraching for user. If exists response code is 200. If no, then user is created and response code is 201. In any case we want to return user nonce.\"]]],[1,\"p\",[[0,[],0,\"In \"],[0,[0],1,\"src/fastify.ts\"],[0,[],0,\" we adding line that will register this handler\"]]],[10,52],[1,\"p\",[[0,[],0,\"We can cover it by test similarly like before\"]]],[10,53],[10,54],[1,\"h2\",[[0,[],0,\"Login user by signed message\"]]],[1,\"p\",[[0,[],0,\"Now we have to implement verification of signature created by metamask. We can do it using function \"],[0,[0],1,\"verifyMessage\"],[0,[],0,\" delivered by library \"],[0,[0],1,\"etherjs\"],[0,[],0,\".\"]]],[1,\"h3\",[[0,[],0,\"Verification of signature with etherjs\"]]],[10,55],[1,\"p\",[[0,[],0,\"in new file \"],[0,[0],1,\"src/auth/getUser.ts\"],[0,[],0,\" we can create some auxiliary functions. \"]]],[10,56],[1,\"p\",[[0,[],0,\"first one give us address used to sign message. Second check if this address is the same like possessed by our user. In \"],[0,[0],1,\"test/auth.test.ts\"],[0,[],0,\" we can check if it works.\"]]],[10,57],[1,\"p\",[[0,[],0,\"values in test \"],[0,[0],1,\"address\"],[0,[],0,\", \"],[0,[0],1,\"nonce\"],[0,[],0,\" and \"],[0,[0],1,\"signature\"],[0,[],0,\" are prepared in browser. \"]]],[1,\"h3\",[[0,[],0,\"Signing nonce in browser using metamask\"]]],[1,\"p\",[[0,[],0,\"If do you \"],[0,[0],1,\"metamask\"],[0,[],0,\" you can get signature address typing in browser console:\"]]],[10,58],[1,\"p\",[[0,[],0,\"and then\"]]],[10,59],[1,\"p\",[[0,[],0,\"If you want to sign nonce lets create helper in browser console:\"]]],[10,60],[1,\"p\",[[0,[],0,\"then define nonce\"]]],[10,61],[1,\"p\",[[0,[],0,\"and finally\"]]],[10,62],[1,\"h3\",[[0,[],0,\"Generation JWT token with user's data\"]]],[1,\"p\",[[0,[],0,\"Our next challenge is sending \"],[0,[0],1,\"jwt\"],[0,[],0,\" token. To create it lets install two libraries\"]]],[10,63],[1,\"p\",[[0,[],0,\"In \"],[0,[0],1,\"src/auth/getUser.ts\"],[0,[],0,\" we can define next helper to create tokens\"]]],[10,64],[1,\"p\",[[0,[],0,\"These tokens will have \"],[0,[0],1,\"1\"],[0,[],0,\" month lifetime and will contain user address and info about organization. In \"],[0,[0],1,\".env\"],[0,[],0,\" we have to add line with our jwt secret key.\"]]],[10,65],[1,\"h3\",[[0,[],0,\"Login endpoint in REST api\"]]],[1,\"p\",[[0,[],0,\"Now we are ready to add \"],[0,[0],1,\"login\"],[0,[],0,\" function to \"],[0,[0],1,\"src/routes/user.ts\"]]],[10,66],[1,\"p\",[[0,[],0,\"in \"],[0,[0],1,\"src/fastify.ts\"],[0,[],0,\" we need register \"],[0,[0],1,\"/login\"],[0,[],0,\" route\"]]],[10,67],[1,\"p\",[[0,[],0,\" Now we can add next test in \"],[0,[0],1,\"test/auth.test.ts\"]]],[10,68],[10,69],[1,\"h2\",[[0,[],0,\"Getting user data from JWT token\"]]],[1,\"p\",[[0,[],0,\"Finally we are ready to implement \"],[0,[0],1,\"/me\"],[0,[],0,\" route, but It will be differ than any previous. It will not be public route. We are going to create middleware to guard this route. In this middleware we will recognize user and append them to \"],[0,[0],1,\"request\"],[0,[],0,\" object living during this request processing. \"]]],[1,\"p\",[[0,[],0,\"First lacking element is function \"],[0,[0],1,\"getUser\"],[0,[],0,\". Lets define it in \"],[0,[0],1,\"src/auth/getUser.ts\"],[0,[],0,\" file\"]]],[10,70],[1,\"p\",[[0,[],0,\"returned interface \"],[0,[0],1,\"JWTUser\"],[0,[],0,\" can be defined in \"],[0,[0],1,\"src/interfaces/context.ts\"],[0,[],0,\" as\"]]],[10,71],[1,\"p\",[[0,[],0,\"Second lacking element is extension of \"],[0,[0],1,\"FastifyRequest\"],[0,[],0,\" allowing to save user among request properties. In \"],[0,[0],1,\"src/fastify.ts\"],[0,[],0,\" we can declare \"],[0,[0],1,\"fastify\"],[0,[],0,\" module extending \"],[0,[0],1,\"FastifyRequest\"],[0,[],0,\".\"]]],[10,72],[1,\"p\",[[0,[],0,\"Now we can define function \"],[0,[0],1,\"auth\"],[0,[],0,\" that will be used in \"],[0,[0],1,\"preValidation\"],[0,[],0,\" array as guard for any private routes.\"]]],[10,73],[1,\"p\",[[0,[],0,\"This \"],[0,[0],1,\"auth\"],[0,[],0,\" middleware will assign usser to request if token is valid. In other way It will replay with 401.\"]]],[1,\"p\",[[0,[],0,\"Formally 401 Unauthorized is the status code to return when the client provides no credentials or invalid credentials. 403 Forbidden is the status code to return when a client has valid credentials but not enough privileges to perform an action on a resource.\"]]],[1,\"p\",[[0,[],0,\"But for the sake of simplicity we will skip this nuance. Now we can register \"],[0,[0],1,\"/me\"],[0,[],0,\" with pre validation guard.\"]]],[10,74],[1,\"p\",[[0,[],0,\"and in \"],[0,[0],1,\"src/route/user.ts\"],[0,[],0,\" add controller with name \"],[0,[0],1,\"root\"],[0,[],0,\".\"]]],[10,75],[1,\"p\",[[0,[],0,\"Now lets try to use it. First register account with address from my browser\"]]],[10,76],[1,\"p\",[[0,[],0,\"Then sign \"],[0,[0],1,\"nonce\"],[0,[],0,\" in browser\"]]],[10,77],[1,\"p\",[[0,[],0,\"Login using signature to get jwt token\"]]],[10,78],[1,\"p\",[[0,[],0,\"And finally get user data using private route \"],[0,[0],1,\"/me\"]]],[10,79],[1,\"p\",[[0,[],0,\"We can cover it by test in \"],[0,[0],1,\"jest\"],[0,[],0,\" in file \"],[0,[0],1,\"test/account.test.ts\"]]],[10,80],[1,\"p\",[[0,[],0,\"Unfortunately this leads to deadlock in tests, that are executed simultaneously:\"]]],[10,81],[1,\"p\",[[0,[],0,\"We can solve it simply adding \"],[0,[0],1,\"--runInBand\"],[0,[],0,\" to jest command.\"]]],[10,82],[1,\"h2\",[[0,[],0,\"General improvements in Fastify project\"]]],[1,\"p\",[[0,[],0,\"There are three improvements that are can add. \"]]],[3,\"ul\",[[[0,[],0,\"cors\"]],[[0,[],0,\"colorful errors in logs\"]],[[0,[],0,\"testing in github workflow\"]]]],[1,\"h3\",[[0,[],0,\"Cors\"]]],[1,\"p\",[[0,[],0,\"We want to make this api open to accept requests from all domains.  Lets install \"],[0,[0],1,\"@fastify/cors\"],[0,[],0,\" package\"]]],[10,83],[1,\"p\",[[0,[],0,\"and in \"],[0,[0],1,\"src/fastify.ts\"],[0,[],0,\" simply register it like \"],[0,[0],1,\"fastifySensible\"]]],[10,84],[1,\"p\",[[0,[],0,\"we can add cors tests in file \"],[0,[0],1,\"test/cors.test.ts\"]]],[10,85],[1,\"h3\",[[0,[],0,\"Colorful error logs\"]]],[1,\"p\",[[0,[],0,\"To find problems in our code easier we can use colors to print errors:\"]]],[10,86],[1,\"p\",[[0,[],0,\"Lets install \"],[0,[0],1,\"cli-color\"],[0,[],0,\" library:\"]]],[10,87],[1,\"p\",[[0,[],0,\"now in \"],[0,[0],1,\"src/fastify.ts\"],[0,[],0,\" we can define function \"],[0,[0],1,\"shouldPrintError\"]]],[10,88],[1,\"p\",[[0,[],0,\"it decide that we want to print only errors without status code (not handled) or with code other than \"],[0,[0],1,\"4xx\"],[0,[],0,\". Additionally we not want to see errors in test mode. You can set these conditions as you want, but it is important than we want to treat different types of errors in different manner. \"]]],[1,\"p\",[[0,[],0,\"Now we can add \"],[0,[0],1,\"hook\"],[0,[],0,\" in body od \"],[0,[0],1,\"getFastifyServer\"]]],[10,89],[1,\"p\",[[0,[],0,\"now our errors will be easy to find and analyze in console.\"]]],[10,90],[1,\"h3\",[[0,[],0,\"Github workflows\"]]],[1,\"p\",[[0,[],0,\"Lets start from checking if our project can be build. In \"],[0,[0],1,\"package.json\"],[0,[],0,\" we can add script\"]]],[10,91],[1,\"p\",[[0,[],0,\"to remove js files created by this command you can type\"]]],[10,92],[1,\"p\",[[0,[],0,\"In github you can create basic workflow for node js using gui.\"]]],[10,93],[1,\"p\",[[0,[],0,\"But it will not work because there is not mongodb in replica set mode.\"]]],[1,\"p\",[[0,[],0,\"Fortunatlley configuration on github actions is super easy and after small fixes our workflow looks as follw:\"]]],[10,94],[1,\"p\",[[0,[],0,\"All presented code can be found in repository:\"]]],[10,95],[1,\"p\",[[0,[],0,\"I hope that you liked this form of publication when we covered all parts from scratch to working demo. Let me know if do you see how can I make my code better or if something presented here helped in your projects.\"]]]],\"ghostVersion\":\"4.0\"}","html":"<p>Metamask is a crypto wallet &amp; gateway to blockchain apps. It can be installed as mobile app or browser extension. Maetmask can be used to build costless, cryptograficly secure authorization flow without processing personal data.</p><p>In this blog I will show you how to prepare rest api in fastify. To test we will use <code>jest</code>. As db we select <code>mongodb</code> connected by <code>prisma</code>. First part describes setup <code>version</code> endpoint and configuration of environement. Then we will show diagram of auth flow, connect database and implement all endpoints.</p><h2 id=\"setup-node-project-with-typescript\">Setup Node Project with Typescript</h2><p>Firsts commands in new <code>nodejs</code> project with <code>typescript</code> are always initialization of <code>package.json</code></p><pre><code>npm init -y</code></pre><p>and <code>tsconfig.json</code></p><pre><code>tsc --init</code></pre><p>Now we have to decide, how to run our project. Ancient methods like <code>ts-node</code> with <code>nodemon</code> was abandoned by me when I meet <code>ts-node-dev</code>. It restarts target node process when any of required files changes (as standard node-dev) but shares Typescript compilation process between restarts. This significantly increases speed of restarting comparing to mentioned solutions. In <code>package.json</code> scripts we can add line:</p><pre><code>    \"dev\": \"ts-node-dev --no-notify --respawn --transpile-only src/index.ts\",\n</code></pre><p>lets install <code>ts-node-dev</code></p><pre><code>npm i -D ts-node-dev</code></pre><p>in <code>src/index.ts</code> we can add content</p><pre><code class=\"language-typescript\">async function main() {\n    console.log(\"ok\");\n}\n\nmain().catch(console.error)\n</code></pre><p>and run it by</p><pre><code>npm run dev</code></pre><p>It will show \"ok\" and will wait for changes to react on them in real time.</p><figure class=\"kg-card kg-image-card\"><img src=\"__GHOST_URL__/content/images/2022/11/javascript-typescript-its-just-so-much-better-19507603.png\" class=\"kg-image\" alt loading=\"lazy\" width=\"500\" height=\"441\"></figure><h2 id=\"add-fastify-with-first-endpoint\">Add Fastify with first endpoint</h2><p>Fastify is framework similar to express but with two advantages</p><ul><li>it is about 20% faster in requests processing</li></ul><figure class=\"kg-card kg-image-card\"><img src=\"__GHOST_URL__/content/images/2022/11/1-3qbtNFz7J9yVzt06fAoM5A.png\" class=\"kg-image\" alt loading=\"lazy\" width=\"549\" height=\"173\"></figure><ul><li>it is faster in developemnt thanks to useful simplifications in his API</li></ul><p>One disadvantage of fastify is smaller comunity (32 times smaller now).</p><p>To install <code>fastify</code> type:</p><pre><code>npm i fastify</code></pre><p>Now we can create <code>src/fastify.ts</code>  with content:</p><pre><code class=\"language-typescript\">import fastify, {FastifyInstance} from \"fastify\";\n\nexport function getFastifyServer(): FastifyInstance {\n    const app = fastify({})\n    \n    // there add \n    // - endpoints\n    // - hooks\n    // - middlewares\n    \n    return app\n}\n</code></pre><p>and in <code>src/index.ts</code> import it and use to run server on selected port</p><pre><code class=\"language-typescript\">import { getFastifyServer } from './fastify'\n\nasync function main() {\n    const app = await getFastifyServer()\n    await app.listen({ port: 4200, host: '0.0.0.0' })\n    console.log(`Fastify listen on http://localhost:4200/`)\n}\n\nmain().catch(console.error)\n</code></pre><p>Now it is not very useful, because we did not defined any route, middleware or hook to process requests. Lets do it and define <code>/</code> endpoint.</p><h2 id=\"first-endpoint-in-fastifyproject-version\">First endpoint in Fastify - project version</h2><p> This will be public route but to no litter <code>fastify.ts</code> file we will create next one <code>src/routes/version.ts</code> with content</p><pre><code class=\"language-typescript\">import pJson from '../../package.json'\n\nexport class Version {\n    static async root() {\n        return {\n            name: pJson.name,\n            version: pJson.version,\n        }\n    }\n}\n</code></pre><p>It is simple class with static method that returns object. Fastify will convert it to response with content type <code>application/json</code> for us, but we have to enable <code>resolveJsonModule</code> option in <code>tsconfig.json</code></p><pre><code class=\"language-json\">     \"resolveJsonModule\": true,                        /* Enable importing .json files. */\n</code></pre><p>now in center of <code>fastify.ts</code> file we can add</p><pre><code>    app.get('/', Version.root)</code></pre><p>and request to main route of our server</p><pre><code> http -b localhost:4200</code></pre><p>starts return response</p><pre><code class=\"language-json\">{\n    \"name\": \"metamask-fastify-rest-api\",\n    \"version\": \"1.0.0\"\n}\n</code></pre><figure class=\"kg-card kg-image-card\"><img src=\"__GHOST_URL__/content/images/2022/11/EEq5-clUcAEV8Nm.jpg\" class=\"kg-image\" alt loading=\"lazy\" width=\"1080\" height=\"1074\" srcset=\"__GHOST_URL__/content/images/size/w600/2022/11/EEq5-clUcAEV8Nm.jpg 600w, __GHOST_URL__/content/images/size/w1000/2022/11/EEq5-clUcAEV8Nm.jpg 1000w, __GHOST_URL__/content/images/2022/11/EEq5-clUcAEV8Nm.jpg 1080w\" sizes=\"(min-width: 720px) 720px\"></figure><h2 id=\"tests-in-jest-with-esbuild\">Tests in Jest with esbuild</h2><p>If you are programmer more time, than one day you are aware how easy is break up your working program changing something in source code in random places. Fortunately we can write test that prove that code is working as we expecting.</p><figure class=\"kg-card kg-image-card\"><img src=\"__GHOST_URL__/content/images/2022/11/6b4upqv6at321.jpg\" class=\"kg-image\" alt loading=\"lazy\" width=\"600\" height=\"600\" srcset=\"__GHOST_URL__/content/images/2022/11/6b4upqv6at321.jpg 600w\"></figure><p>In node js word one of best testing frameworks is <code>jest</code>. But to connect it with typescript we need plugin that will transform <code>ts</code> files.  It is terrible that most popular <code>ts-jest</code> is 2000 times more frequently used that about 26 times faster <code>jest-ebuild</code>. But lets use technology from the future - esbuild.</p><figure class=\"kg-card kg-image-card\"><img src=\"__GHOST_URL__/content/images/2022/11/1642781701974.jpeg\" class=\"kg-image\" alt loading=\"lazy\" width=\"469\" height=\"631\"></figure><p>Our <code>jest.config.ts</code> will contain</p><pre><code class=\"language-typescript\">module.exports = {\n  roots: ['&lt;rootDir&gt;'],\n  testMatch: ['**/__tests__/**/*.+(ts|tsx)', '**/?(*.)+(spec|test).+(ts|tsx)'],\n  transform: {\n    '^.+\\\\.(ts|tsx)$': 'jest-esbuild',\n  },\n  setupFilesAfterEnv: [],\n  testEnvironment: 'node',\n}\n</code></pre><p>Lets install packages</p><pre><code>npm i -D jest @types/jest jest-esbuild</code></pre><p>and add <code>test</code> script in <code>package.json</code></p><p>our first test file <code>test/version.test.ts</code> can look as follow:</p><pre><code class=\"language-typescript\">import pJson from '../package.json'\nimport { getFastifyServer } from '../src/fastify'\n\nconst correctVersion = { name: pJson.name, version: pJson.version }\n\ndescribe('i can read version', () =&gt; {\n  it('from rest api', async () =&gt; {\n    const server = await getFastifyServer()\n    const result = await server.inject({\n      method: 'GET',\n      path: '/',\n    })\n\n    expect(result.body).toEqual(JSON.stringify(correctVersion))\n    expect(result.statusCode).toEqual(200)\n    expect(result.headers['content-type']).toContain('application/json')\n  })\n})\n</code></pre><p>Now when you type</p><pre><code>npm test</code></pre><p>you should see</p><pre><code class=\"language-bash\"> PASS  test/version.test.ts\n  i can read version\n    ✓ from rest api (14 ms)\n\nTest Suites: 1 passed, 1 total\nTests:       1 passed, 1 total\nSnapshots:   0 total\nTime:        0.222 s, estimated 1 s\nRan all test suites.</code></pre><figure class=\"kg-card kg-image-card\"><img src=\"__GHOST_URL__/content/images/2022/11/6unvjk.jpg\" class=\"kg-image\" alt loading=\"lazy\" width=\"500\" height=\"680\"></figure><p>We have configured fastify server with live reload development environment and super fast tests configured in jest. We created first endpoint that returns name and version of server on root endpoint. It is time to describe auth flow and implement required routes.</p><h2 id=\"auth-flow-diagram\">Auth flow diagram</h2><p>Generally idea is the following. User has private key connected with his wallet address. We can save this address to database as his unique id and generate nonce for him. Nonce is simple random phrase generated to check if user can correctly sing it using his own address. If nonce will leak, it is nothing scarry, because nobody will be able to sign it with correct address is he does not possess private key. Below we presenting diagram:  </p><figure class=\"kg-card kg-image-card\"><img src=\"__GHOST_URL__/content/images/2022/11/2022-11-30_13-47_1.png\" class=\"kg-image\" alt loading=\"lazy\" width=\"533\" height=\"744\"></figure><p>So we need users collection only with <code>address</code> and <code>nonce</code> and 4 endpoints</p><ul><li>to get nonce for given address</li><li>to register new address and assign him nonce</li><li>to login using address, nonce and signature</li><li>to get my account details using JWT token</li></ul><h2 id=\"db-model-with-prisma\">DB model with prisma</h2><p>Prisma is greate pice of software that helps to use database in reliable way thanks to great types and interfaces allowing to staticly validate all places in code when we using database. </p><p>To install prisma we will need two libraries</p><pre><code>npm i prisma @prisma/client</code></pre><p>Now typing:</p><pre><code>npx prisma init</code></pre><p>we can generate initial setup.</p><p>There was created <code>.env</code> with <code>DATABASE_URL</code> and <code>prisma/schema.prisma</code>, that by default use postgresql. We need mongo so lets modify file with schema</p><pre><code class=\"language-prisma\">generator client {\n  provider = \"prisma-client-js\"\n}\n\ndatasource db {\n  provider = \"mongodb\"\n  url      = env(\"DATABASE_URL\")\n}\n\nmodel users {\n  id      String @id @default(auto()) @map(\"_id\") @db.ObjectId\n  address String @unique\n  nonce   String\n}\n</code></pre><p>and in <code>.env</code> we can select address to our mongo database</p><pre><code>DATABASE_URL=mongodb://localhost:27017/web3_bdl</code></pre><figure class=\"kg-card kg-image-card\"><img src=\"__GHOST_URL__/content/images/2022/11/anMGwKn_460s.jpg\" class=\"kg-image\" alt loading=\"lazy\" width=\"460\" height=\"291\"></figure><h3 id=\"mongo-in-replica-set-mode\">Mongo in Replica Set Mode</h3><p>It is important, that prisma now using mongo in replica mode.</p><figure class=\"kg-card kg-bookmark-card\"><a class=\"kg-bookmark-container\" href=\"https://www.mongodb.com/docs/manual/replication/\"><div class=\"kg-bookmark-content\"><div class=\"kg-bookmark-title\">Replication — MongoDB Manual</div><div class=\"kg-bookmark-description\"></div><div class=\"kg-bookmark-metadata\"><img class=\"kg-bookmark-icon\" src=\"https://www.mongodb.com/docs/assets/favicon.ico\"></div></div><div class=\"kg-bookmark-thumbnail\"><img src=\"https://www.mongodb.com/docs/assets/meta_generic.png\"></div></a></figure><p>to configure it you will need add lines</p><pre><code>replication:\n  replSetName: rs0</code></pre><p>to your mongodb config <code>/etc/mongod.conf</code>. This path depent from your OS.</p><p>In <code>mongo</code> cli you should execute</p><pre><code>rs.initiate()</code></pre><p>to setup replica set and </p><pre><code>rs.status()</code></pre><p>to check it. You will have to restart your mongo service to read changes from config.</p><h3 id=\"generation-typescript-from-prisma\">Generation typescript from prisma</h3><p>If you have correctly configured mongo and created user models, run</p><pre><code>npx prisma generate</code></pre><p>this command will generate typescript to help with autocompletion and static validation your further code.</p><h3 id=\"single-prisma-client-for-all-application\">Single prisma client for all application</h3><p>It is rather good practice to configure db access point in single place and import it from this file than use library. In our case it will be file <code>src/storage/prisma.ts</code>. In this file we will modify <code>DATABASE_URL</code> adding <code>_test</code> at the end in test environment. Thanks to this modification we can do not care about distinct set of env for test and can avoid overriding our local data during tests written in jest.</p><pre><code class=\"language-typescript\">import {PrismaClient} from \"@prisma/client\";\n\nfunction dbUrl() {\n    const url = process.env.DATABASE_URL;\n\n    if(!url) throw new Error(`No db url`);\n\n    if(process.env.NODE_ENV === 'test') {\n        if(url.includes('?')) {\n            throw new Error('test url not implemented for this db')\n        }\n        return url + '_test'\n    } else {\n        return url;\n    }\n}\n\nconst prisma = new PrismaClient({\n    datasources: {\n        db: {\n            url: dbUrl()\n        }\n    }\n})\n\nexport {\n    prisma,\n    PrismaClient\n}\n</code></pre><p>Now we can import prisma from this place and get access to proper database in dependence from <code>NODE_ENV</code>.</p><figure class=\"kg-card kg-image-card\"><img src=\"__GHOST_URL__/content/images/2022/11/b5867e5f337d3e62328e6a2c3a78c250d0f7ab511cf53864d6d5099f946ba055_3.jpg\" class=\"kg-image\" alt loading=\"lazy\" width=\"460\" height=\"376\"></figure><h3 id=\"passing-env-to-process\">Passing env to process</h3><p>Not there is last challenge connected with databae - passing db address to program in secure way. We can do it by <code>dotenv</code> library but I prefer <code>Makefile</code> as access point ot application because it is more universal way and can be applied with <code>python</code>, <code>go</code>, <code>ruby</code> and other languages in the same way. This is my <code>Makefile</code></p><pre><code class=\"language-makefile\">include .env\nexport\n\nnode_modules: package.json\n\tnpm i\n\nup: node_modules\n\tnpm run dev\n</code></pre><p>so from now, instead of writing</p><pre><code>npm run dev</code></pre><p>you can write</p><pre><code>make up</code></pre><p>of course it is only solution in development mode. In production it is better pass environment variables using docker or similar solution.</p><h2 id=\"checking-if-user-with-address-exists\">Checking if user with address exists</h2><p>First step in our diagram was checking is user with given address exists and get his nonce. If address no exists we want to return <code>Not Found</code> answer. We can use helper to create <code>notFound</code> answer using <code>@fastify/sensible</code>. Lets install it:</p><pre><code>npm i @fastify/sensible</code></pre><p>now we can import it in <code>src/fastify.ts</code></p><pre><code class=\"language-typescript\">import fastifySensible from '@fastify/sensible'\n</code></pre><p>and register in body of <code>getFastifyServer</code> function</p><pre><code>    app.register(fastifySensible)\n</code></pre><p>To add endpoint finding users by address add here also line</p><pre><code class=\"language-typescript\">    app.get('/users/:address/nonce', User.getNonce)\n</code></pre><p>We will need to import user from <code>routes</code> so in <code>src/routes/user.ts</code> lets create class <code>User</code> with static method <code>getNonce</code> like before we done with <code>version</code>.</p><pre><code class=\"language-typescript\">import {FastifyRequest} from \"fastify\";\nimport {prisma} from \"../storage/prisma\";\n\nexport class User {\n    static async getNonce(req: FastifyRequest&lt;{ Params: { address: string } }&gt;, res: FastifyReply) {\n        const address = req.params.address;\n\n        const user = await prisma.users.findUnique({\n            where: {\n                address\n            }\n        })\n\n        if (!user) return res.notFound()\n\n        return {\n            nonce: user.nonce\n        }\n    }\n}\n</code></pre><p>Now we can test it manually</p><pre><code>http -b localhost:4200/users/123/nonce\n{\n    \"error\": \"Not Found\",\n    \"message\": \"Not Found\",\n    \"statusCode\": 404\n}</code></pre><p>but it is better to write tests in <code>jest</code>. Before writing tests we will prepare <code>src/storage/seed.ts</code> file with function <code>seed</code> to clear our database.</p><pre><code class=\"language-typescript\">import {prisma} from \"./prisma\";\n\nexport async function seed() {\n    await prisma.users.deleteMany();\n}\n</code></pre><p>Now in <code>test/address.test.ts</code> we can write tests to check if this endpoint is working.</p><pre><code class=\"language-typescript\">import { getFastifyServer } from '../src/fastify'\nimport {seed} from \"../src/storage/seed\";\nimport {prisma} from \"../src/storage/prisma\";\n\ndescribe('searching user by address', () =&gt; {\n  it('address not found', async () =&gt; {\n    await seed();\n\n    const server = await getFastifyServer()\n    const result = await server.inject({\n      method: 'GET',\n      path: '/users/abc/nonce',\n    })\n\n\n    expect(result.statusCode).toEqual(404);\n    expect(result.body).toEqual(JSON.stringify({\n      statusCode: 404,\n      error: \"Not Found\",\n      message: \"Not Found\"\n    }))\n  })\n\n  it('address found and nonce is correct', async () =&gt; {\n    await prisma.users.upsert({\n      where: {\n        address: \"abc\"\n      },\n      create: {\n        address: \"abc\",\n        nonce: \"secret\"\n      },\n      update: {\n        nonce: \"secret\"\n      }\n    })\n\n    const server = await getFastifyServer()\n    const result = await server.inject({\n      method: 'GET',\n      path: '/users/abc/nonce',\n    })\n\n    expect(result.statusCode).toEqual(200);\n    expect(result.body).toEqual(JSON.stringify({\n      nonce: 'secret'\n    }))\n\n  })\n})\n</code></pre><p>Here we covered all possible scenarios. </p><figure class=\"kg-card kg-image-card\"><img src=\"__GHOST_URL__/content/images/2022/11/android-mocking.jpg\" class=\"kg-image\" alt loading=\"lazy\" width=\"1344\" height=\"900\" srcset=\"__GHOST_URL__/content/images/size/w600/2022/11/android-mocking.jpg 600w, __GHOST_URL__/content/images/size/w1000/2022/11/android-mocking.jpg 1000w, __GHOST_URL__/content/images/2022/11/android-mocking.jpg 1344w\" sizes=\"(min-width: 720px) 720px\"></figure><h2 id=\"register-user-using-wallet-address\">Register user using wallet address</h2><p>Now user can check if his address is registered. Of course if he will see our app first time, he will not be registered, so he will get 404 and will try to register his address. Lets implement registration.</p><p>Nonce have to be random string. To generate it we will use <code>uid</code> package.</p><pre><code>npm i uid</code></pre><p>In <code>src/routes/user.ts</code> we adding new static method do <code>User</code> class</p><pre><code class=\"language-typescript\">    static async register(req: FastifyRequest&lt;{\n        Body: {\n            address: string\n        }\n    }&gt;, res: FastifyReply) {\n        const found = await prisma.users.findUnique({\n            where: {\n                address: req.body.address\n            }\n        })\n\n        if (found) return res.code(200).send({\n            nonce: found.nonce\n        });\n\n        const nonce = uid(20);\n        await prisma.users.create({\n            data: {\n                address: req.body.address,\n                nonce,\n            }\n        })\n\n        return res.code(201).send({\n            nonce\n        });\n    }</code></pre><p>Logic here is super simple. We are seraching for user. If exists response code is 200. If no, then user is created and response code is 201. In any case we want to return user nonce.</p><p>In <code>src/fastify.ts</code> we adding line that will register this handler</p><pre><code class=\"language-typescript\">    app.post('/register', User.register)\n</code></pre><p>We can cover it by test similarly like before</p><pre><code class=\"language-typescript\">import { getFastifyServer } from '../src/fastify'\nimport {seed} from \"../src/storage/seed\";\nimport {Response } from \"light-my-request\";\n\ndescribe('user can register account', () =&gt; {\n  it('first and second registration', async () =&gt; {\n    await seed();\n\n    async function registerUser(address: string): Promise&lt;Response&gt; {\n      return server.inject({\n        method: 'POST',\n        path: '/register',\n        payload: {\n          'address': address\n        }\n      })\n    }\n\n    const server = await getFastifyServer()\n    const result1 =await registerUser(\"abc\")\n\n    expect(result1.statusCode).toEqual(201);\n    expect(result1.headers['content-type']).toContain(\"application/json\");\n\n    const result2 =await registerUser(\"abc\")\n\n    expect(result2.statusCode).toEqual(200);\n    expect(result2.body).toEqual(result1.body);\n  })\n})\n</code></pre><figure class=\"kg-card kg-image-card\"><img src=\"__GHOST_URL__/content/images/2022/11/1-xwScPTcIGgjWfZIcEeR2oA.png\" class=\"kg-image\" alt loading=\"lazy\" width=\"610\" height=\"343\" srcset=\"__GHOST_URL__/content/images/size/w600/2022/11/1-xwScPTcIGgjWfZIcEeR2oA.png 600w, __GHOST_URL__/content/images/2022/11/1-xwScPTcIGgjWfZIcEeR2oA.png 610w\"></figure><h2 id=\"login-user-by-signed-message\">Login user by signed message</h2><p>Now we have to implement verification of signature created by metamask. We can do it using function <code>verifyMessage</code> delivered by library <code>etherjs</code>.</p><h3 id=\"verification-of-signature-with-etherjs\">Verification of signature with etherjs</h3><pre><code>npm i ethers</code></pre><p>in new file <code>src/auth/getUser.ts</code> we can create some auxiliary functions. </p><pre><code class=\"language-typescript\">import {utils} from \"ethers\";\nimport { users} from \"@prisma/client\";\n\nexport function getAddress(nonce: string, signature: string): string {\n    return utils.verifyMessage(nonce, signature).toLowerCase()\n}\n\nexport function verifyUser(user: Pick&lt;users, 'nonce' | 'address'&gt;, signature: string): boolean {\n    try {\n        return getAddress(user.nonce, signature) === user.address;\n    } catch {\n        return false;\n    }\n}\n</code></pre><p>first one give us address used to sign message. Second check if this address is the same like possessed by our user. In <code>test/auth.test.ts</code> we can check if it works.</p><pre><code class=\"language-typescript\">import {verifyUser, getAddress} from \"../src/auth/getUser\";\n\nconst address = '0xa68701d9b3eb52f0a7248e7b57d484411a60b045';\nconst nonce = '14b2a79636d81fbb10f9';\nconst signature = '0x5d8f425c91437148b65f47e9444d91e868d3566d868649fec58c76010c8f01992edd2db3284088d5f5048fc3bc9eff307e0cd1b8b1a2e6c96a2784eb5fd5358d1b';\n\n\ndescribe('i can authenticate signature', () =&gt; {\n    it('auth', () =&gt; {\n        expect(getAddress(nonce, signature)).toEqual(address)\n        expect(verifyUser({nonce, address}, signature)).toBeTruthy();\n    })\n});\n</code></pre><p>values in test <code>address</code>, <code>nonce</code> and <code>signature</code> are prepared in browser. </p><h3 id=\"signing-nonce-in-browser-using-metamask\">Signing nonce in browser using metamask</h3><p>If do you <code>metamask</code> you can get signature address typing in browser console:</p><pre><code class=\"language-javascript\">ethereum.enable()</code></pre><p>and then</p><pre><code class=\"language-javascript\">ethereum.selectedAddress</code></pre><p>If you want to sign nonce lets create helper in browser console:</p><pre><code class=\"language-javascript\">function utf8ToHex(str) {\n  return Array.from(str).map(c =&gt;\n      c.charCodeAt(0) &lt; 128 ? c.charCodeAt(0).toString(16) :\n          encodeURIComponent(c).replace(/\\%/g, '').toLowerCase()\n  ).join('');\n}</code></pre><p>then define nonce</p><pre><code class=\"language-javascript\">nonce = 'abc'</code></pre><p>and finally</p><pre><code class=\"language-javascript\">await ethereum.request({\n    method: \"personal_sign\",\n    params: [utf8ToHex(nonce), ethereum.selectedAddress],\n  })</code></pre><h3 id=\"generation-jwt-token-with-users-data\">Generation JWT token with user's data</h3><p>Our next challenge is sending <code>jwt</code> token. To create it lets install two libraries</p><pre><code>npm i jsonwebtoken dayjs\nnpm i --save-dev @types/jsonwebtoken</code></pre><p>In <code>src/auth/getUser.ts</code> we can define next helper to create tokens</p><pre><code class=\"language-typescript\">import dayjs from \"dayjs\";\nimport jwt from 'jsonwebtoken'\n\nconst jwtKey = process.env.JWT_SECRET_KEY ?? 'test';\nconst issuer = 'I &lt;3 web3'; // name of organization\n\n\nexport function tokenizeUser(user: Pick&lt;users, 'address'&gt;): string {\n    return jwt.sign({\n        sub: user.address,\n        iss: issuer,\n        exp: dayjs().add(1, 'month').unix()\n    }, jwtKey)\n}</code></pre><p>These tokens will have <code>1</code> month lifetime and will contain user address and info about organization. In <code>.env</code> we have to add line with our jwt secret key.</p><pre><code>JWT_SECRET_KEY=123</code></pre><h3 id=\"login-endpoint-in-rest-api\">Login endpoint in REST api</h3><p>Now we are ready to add <code>login</code> function to <code>src/routes/user.ts</code></p><pre><code class=\"language-typescript\">import {tokenizeUser, verifyUser} from \"../auth/getUser\";\n\n// ...\n\n    static async login(req: FastifyRequest&lt;{\n        Body: { address: string, sig: string, nonce: string }\n    }&gt;, res: FastifyReply) {\n        const {address, sig, nonce} = req.body\n\n        if (!address || !sig || !nonce) return res.expectationFailed('invalid body');\n\n        const verified = verifyUser({address, nonce}, sig);\n        if (!verified) return res.unauthorized();\n\n\n        return {\n            token: tokenizeUser({address})\n        }\n    }</code></pre><p>in <code>src/fastify.ts</code> we need register <code>/login</code> route</p><pre><code class=\"language-typescript\">    app.post('/login', User.login)\n</code></pre><p> Now we can add next test in <code>test/auth.test.ts</code></p><pre><code class=\"language-typescript\">import {getFastifyServer} from \"../src/fastify\";\nimport {seed} from \"../src/storage/seed\";\nimport {prisma} from \"../src/storage/prisma\";\nimport {Response} from \"light-my-request\";\n\n\n    it('and see his token', async () =&gt; {\n        await seed();\n        await prisma.users.create({\n            data: {\n                address,\n                nonce\n            },\n        })\n\n        async function login(signature: string): Promise&lt;Response&gt; {\n            return server.inject({\n                method: 'POST',\n                path: '/login',\n                payload: {\n                    address,\n                    sig: signature,\n                    nonce\n                }\n            })\n        }\n\n        const server = await getFastifyServer()\n        const result1 = await login(\"abc\")\n\n        expect(result1.statusCode).toEqual(401);\n        expect(result1.body).toEqual(JSON.stringify({\n            statusCode: 401, error: \"Unauthorized\", message: \"Unauthorized\"\n        }));\n\n        const result2 = await login(signature)\n\n        expect(result2.statusCode).toEqual(200);\n        expect(result2.body).toEqual(JSON.stringify({\n            token: tokenizeUser({address})\n        }));\n    })</code></pre><figure class=\"kg-card kg-image-card\"><img src=\"__GHOST_URL__/content/images/2022/11/5834555ede7a912e00000942.png\" class=\"kg-image\" alt loading=\"lazy\" width=\"477\" height=\"207\"></figure><h2 id=\"getting-user-data-from-jwt-token\">Getting user data from JWT token</h2><p>Finally we are ready to implement <code>/me</code> route, but It will be differ than any previous. It will not be public route. We are going to create middleware to guard this route. In this middleware we will recognize user and append them to <code>request</code> object living during this request processing. </p><p>First lacking element is function <code>getUser</code>. Lets define it in <code>src/auth/getUser.ts</code> file</p><pre><code class=\"language-typescript\">interface JwtPayloadCustomer {\n    iss: string\n    iat: number\n    exp: number\n    sub: string\n}\n\nfunction getExpDate(jwtPayload: { exp: number }): Date {\n    return dayjs.unix(jwtPayload.exp).toDate()\n}\n\nexport function getUser(token?: string): JWTUser | null {\n    if (!token) {\n        return null\n    } else {\n        token = token.replace(/^Bearer\\s+/, '')\n\n        const jwtPayload = jwt.verify(token, jwtKey) as unknown as JwtPayloadCustomer\n\n        const sub = jwtPayload.sub\n\n        return {\n            address: sub,\n            token_expiring_at: getExpDate(jwtPayload),\n        }\n    }\n}</code></pre><p>returned interface <code>JWTUser</code> can be defined in <code>src/interfaces/context.ts</code> as</p><pre><code class=\"language-typescript\">import { PrismaClient } from '../storage/prisma'\n\nexport interface JWTUser {\n  address: string\n  token_expiring_at: Date\n}\n</code></pre><p>Second lacking element is extension of <code>FastifyRequest</code> allowing to save user among request properties. In <code>src/fastify.ts</code> we can declare <code>fastify</code> module extending <code>FastifyRequest</code>.</p><pre><code class=\"language-typescript\">declare module 'fastify' {\n    interface FastifyRequest {\n        user: JWTUser | null\n    }\n}</code></pre><p>Now we can define function <code>auth</code> that will be used in <code>preValidation</code> array as guard for any private routes.</p><pre><code class=\"language-typescript\">async function auth(request: FastifyRequest, reply: FastifyReply) {\n    const token = (request.headers.authorization || '').replace(/Bearer\\s+/, '') || undefined\n    request.user = getUser(token)\n    if (!request.user) reply.unauthorized()\n}</code></pre><p>This <code>auth</code> middleware will assign usser to request if token is valid. In other way It will replay with 401.</p><p>Formally 401 Unauthorized is the status code to return when the client provides no credentials or invalid credentials. 403 Forbidden is the status code to return when a client has valid credentials but not enough privileges to perform an action on a resource.</p><p>But for the sake of simplicity we will skip this nuance. Now we can register <code>/me</code> with pre validation guard.</p><pre><code class=\"language-typescript\">    app.get('/me', {preValidation: [auth]}, User.root)</code></pre><p>and in <code>src/route/user.ts</code> add controller with name <code>root</code>.</p><pre><code>    static async root(req: FastifyRequest, res: FastifyReply) {\n        return req.user;\n    }</code></pre><p>Now lets try to use it. First register account with address from my browser</p><figure class=\"kg-card kg-image-card\"><img src=\"__GHOST_URL__/content/images/2022/11/2022-11-30_18-57.png\" class=\"kg-image\" alt loading=\"lazy\" width=\"1184\" height=\"183\" srcset=\"__GHOST_URL__/content/images/size/w600/2022/11/2022-11-30_18-57.png 600w, __GHOST_URL__/content/images/size/w1000/2022/11/2022-11-30_18-57.png 1000w, __GHOST_URL__/content/images/2022/11/2022-11-30_18-57.png 1184w\" sizes=\"(min-width: 720px) 720px\"></figure><p>Then sign <code>nonce</code> in browser</p><figure class=\"kg-card kg-image-card\"><img src=\"__GHOST_URL__/content/images/2022/11/2022-11-30_18-59.png\" class=\"kg-image\" alt loading=\"lazy\" width=\"941\" height=\"138\" srcset=\"__GHOST_URL__/content/images/size/w600/2022/11/2022-11-30_18-59.png 600w, __GHOST_URL__/content/images/2022/11/2022-11-30_18-59.png 941w\" sizes=\"(min-width: 720px) 720px\"></figure><p>Login using signature to get jwt token</p><figure class=\"kg-card kg-image-card\"><img src=\"__GHOST_URL__/content/images/2022/11/2022-11-30_19-00.png\" class=\"kg-image\" alt loading=\"lazy\" width=\"1607\" height=\"242\" srcset=\"__GHOST_URL__/content/images/size/w600/2022/11/2022-11-30_19-00.png 600w, __GHOST_URL__/content/images/size/w1000/2022/11/2022-11-30_19-00.png 1000w, __GHOST_URL__/content/images/size/w1600/2022/11/2022-11-30_19-00.png 1600w, __GHOST_URL__/content/images/2022/11/2022-11-30_19-00.png 1607w\" sizes=\"(min-width: 720px) 720px\"></figure><p>And finally get user data using private route <code>/me</code></p><figure class=\"kg-card kg-image-card\"><img src=\"__GHOST_URL__/content/images/2022/11/2022-11-30_19-01.png\" class=\"kg-image\" alt loading=\"lazy\" width=\"1602\" height=\"249\" srcset=\"__GHOST_URL__/content/images/size/w600/2022/11/2022-11-30_19-01.png 600w, __GHOST_URL__/content/images/size/w1000/2022/11/2022-11-30_19-01.png 1000w, __GHOST_URL__/content/images/size/w1600/2022/11/2022-11-30_19-01.png 1600w, __GHOST_URL__/content/images/2022/11/2022-11-30_19-01.png 1602w\" sizes=\"(min-width: 720px) 720px\"></figure><p>We can cover it by test in <code>jest</code> in file <code>test/account.test.ts</code></p><pre><code class=\"language-typescript\">import { getFastifyServer } from '../src/fastify'\nimport {seed} from \"../src/storage/seed\";\nimport {prisma} from \"../src/storage/prisma\";\nimport {tokenizeUser} from \"../src/auth/getUser\";\n\nconst address = 'abc';\n\ndescribe('i can see my account', () =&gt; {\n    it('using token', async () =&gt; {\n        await seed();\n        prisma.users.create({\n            data: {\n                address,\n                nonce: 'secret'\n            }\n        })\n\n        const server = await getFastifyServer()\n        const result = await server.inject({\n            method: 'GET',\n            path: '/me',\n            headers: {\n                authorization: `Bearer ${tokenizeUser({address})}`\n            }\n        })\n\n        expect(JSON.parse(result.body)).toMatchObject({\n            address\n        })\n        expect(result.statusCode).toEqual(200)\n        expect(result.headers['content-type']).toContain('application/json')\n    })\n})\n</code></pre><p>Unfortunately this leads to deadlock in tests, that are executed simultaneously:</p><pre><code>Invalid `prisma.users.deleteMany()` i\nnvocation:\n\n\n    Transaction failed due to a write con\nflict or a deadlock. Please retry your tr\nansaction</code></pre><p>We can solve it simply adding <code>--runInBand</code> to jest command.</p><pre><code>    \"test\": \"jest --runInBand\",\n</code></pre><h2 id=\"general-improvements-in-fastify-project\">General improvements in Fastify project</h2><p>There are three improvements that are can add. </p><ul><li>cors</li><li>colorful errors in logs</li><li>testing in github workflow</li></ul><h3 id=\"cors\">Cors</h3><p>We want to make this api open to accept requests from all domains.  Lets install <code>@fastify/cors</code> package</p><pre><code>npm i @fastify/cors</code></pre><p>and in <code>src/fastify.ts</code> simply register it like <code>fastifySensible</code></p><pre><code class=\"language-typescript\">import cors from '@fastify/cors'\n\n//...\n\n    app.register(cors)\n</code></pre><p>we can add cors tests in file <code>test/cors.test.ts</code></p><pre><code class=\"language-typescript\">import {getFastifyServer} from '../src/fastify'\n\ndescribe('cors', () =&gt; {\n    it('for get I have access-control-allow-origin', async () =&gt; {\n        const server = await getFastifyServer()\n        const result = await server.inject({\n            method: 'GET',\n            path: '/',\n        })\n\n        expect(result.statusCode).toEqual(200)\n        expect(result.headers['access-control-allow-origin']).toEqual('*')\n    })\n\n    it('for options I see cors headers', async () =&gt; {\n        const server = await getFastifyServer()\n        const result = await server.inject({\n            method: 'OPTIONS',\n            path: '/',\n            headers: {\n                'Access-Control-Request-Method': 'GET',\n                'Origin': 'https://ilove.ethereum'\n            }\n        })\n\n        expect(result.statusCode).toEqual(204)\n        expect(result.headers['access-control-allow-origin']).toEqual('*')\n\n    })\n})\n</code></pre><h3 id=\"colorful-error-logs\">Colorful error logs</h3><p>To find problems in our code easier we can use colors to print errors:</p><figure class=\"kg-card kg-image-card\"><img src=\"__GHOST_URL__/content/images/2022/11/cw7i8et55g551.jpg\" class=\"kg-image\" alt loading=\"lazy\" width=\"1024\" height=\"919\" srcset=\"__GHOST_URL__/content/images/size/w600/2022/11/cw7i8et55g551.jpg 600w, __GHOST_URL__/content/images/size/w1000/2022/11/cw7i8et55g551.jpg 1000w, __GHOST_URL__/content/images/2022/11/cw7i8et55g551.jpg 1024w\" sizes=\"(min-width: 720px) 720px\"></figure><p>Lets install <code>cli-color</code> library:</p><pre><code>npm i cli-color\nnpm i -D @types/cli-color</code></pre><p>now in <code>src/fastify.ts</code> we can define function <code>shouldPrintError</code></p><pre><code class=\"language-typescript\">function shouldPrintError(error: FastifyError) {\n    return process.env.NODE_ENV !== 'test' &amp;&amp; (!error.statusCode || !(error.statusCode &gt;= 400 &amp;&amp; error.statusCode &lt; 500))\n}</code></pre><p>it decide that we want to print only errors without status code (not handled) or with code other than <code>4xx</code>. Additionally we not want to see errors in test mode. You can set these conditions as you want, but it is important than we want to treat different types of errors in different manner. </p><p>Now we can add <code>hook</code> in body od <code>getFastifyServer</code></p><pre><code class=\"language-typescript\">import {red, yellow} from 'cli-color'\n\n\n    app.addHook('onError', async (request, reply, error) =&gt; {\n        if (shouldPrintError(error)) {\n            console.log(red(error), yellow(String(error.stack).replace(`Error: ${error.message}`, '')))\n        }\n        if (isNativeError(error)) {\n            return reply.internalServerError(error.message)\n        }\n        throw error\n    })</code></pre><p>now our errors will be easy to find and analyze in console.</p><figure class=\"kg-card kg-image-card\"><img src=\"__GHOST_URL__/content/images/2022/11/2022-11-30_20-25.png\" class=\"kg-image\" alt loading=\"lazy\" width=\"720\" height=\"154\" srcset=\"__GHOST_URL__/content/images/size/w600/2022/11/2022-11-30_20-25.png 600w, __GHOST_URL__/content/images/2022/11/2022-11-30_20-25.png 720w\" sizes=\"(min-width: 720px) 720px\"></figure><h3 id=\"github-workflows\">Github workflows</h3><p>Lets start from checking if our project can be build. In <code>package.json</code> we can add script</p><pre><code>\"build\": \"tsc\"</code></pre><p>to remove js files created by this command you can type</p><pre><code>tsc --build --clean</code></pre><p>In github you can create basic workflow for node js using gui.</p><pre><code class=\"language-yml\">name: Node.js CI\n\non:\n  push:\n    branches: [ \"main\" ]\n  pull_request:\n    branches: [ \"main\" ]\n\njobs:\n  build:\n\n    runs-on: ubuntu-latest\n\n    strategy:\n      matrix:\n        node-version: [18.x]\n        # See supported Node.js release schedule at https://nodejs.org/en/about/releases/\n\n    steps:\n    - uses: actions/checkout@v3\n    - name: Use Node.js ${{ matrix.node-version }}\n      uses: actions/setup-node@v3\n      with:\n        node-version: ${{ matrix.node-version }}\n        cache: 'npm'\n    - run: npm ci\n    - run: npm run build --if-present\n    - run: npm test\n</code></pre><p>But it will not work because there is not mongodb in replica set mode.</p><p>Fortunatlley configuration on github actions is super easy and after small fixes our workflow looks as follw:</p><pre><code class=\"language-yml\">name: Node.js CI\n\non:\n  push:\n    branches: [ \"main\" ]\n  pull_request:\n    branches: [ \"main\" ]\n\nenv:\n  JWT_SECRET_KEY: 123\n  DATABASE_URL: mongodb://localhost:27017/web3_bdl\n\njobs:\n  build:\n\n    runs-on: ubuntu-latest\n\n    strategy:\n      matrix:\n        node-version: [18.x]\n        mongodb-version: ['5.0']\n\n    steps:\n    - uses: actions/checkout@v3\n    - name: Use Node.js ${{ matrix.node-version }}\n      uses: actions/setup-node@v3\n      with:\n        node-version: ${{ matrix.node-version }}\n        cache: 'npm'\n\n    - name: Start MongoDB\n      uses: supercharge/mongodb-github-action@1.8.0\n      with:\n        mongodb-version: ${{ matrix.mongodb-version }}\n        mongodb-replica-set: rs-test\n\n    - run: npm ci\n    - run: npm test\n    - run: npm run build --if-present\n</code></pre><p>All presented code can be found in repository:</p><figure class=\"kg-card kg-bookmark-card\"><a class=\"kg-bookmark-container\" href=\"https://github.com/gustawdaniel/metamask-fastify-rest-api\"><div class=\"kg-bookmark-content\"><div class=\"kg-bookmark-title\">GitHub - gustawdaniel/metamask-fastify-rest-api</div><div class=\"kg-bookmark-description\">Contribute to gustawdaniel/metamask-fastify-rest-api development by creating an account on GitHub.</div><div class=\"kg-bookmark-metadata\"><img class=\"kg-bookmark-icon\" src=\"https://github.githubassets.com/favicons/favicon.svg\"><span class=\"kg-bookmark-author\">GitHub</span><span class=\"kg-bookmark-publisher\">gustawdaniel</span></div></div><div class=\"kg-bookmark-thumbnail\"><img src=\"https://opengraph.githubassets.com/f01f87b773a73f3bad53b83e622cfd82a917f3c0110cec2b4b9a6e7dee7d9cac/gustawdaniel/metamask-fastify-rest-api\"></div></a></figure><p>I hope that you liked this form of publication when we covered all parts from scratch to working demo. Let me know if do you see how can I make my code better or if something presented here helped in your projects.</p>","comment_id":"6386ffb8bbda300a2f29c029","plaintext":"Metamask is a crypto wallet & gateway to blockchain apps. It can be installed as\nmobile app or browser extension. Maetmask can be used to build costless,\ncryptograficly secure authorization flow without processing personal data.\n\nIn this blog I will show you how to prepare rest api in fastify. To test we will\nuse jest. As db we select mongodb connected by prisma. First part describes\nsetup version endpoint and configuration of environement. Then we will show\ndiagram of auth flow, connect database and implement all endpoints.\n\nSetup Node Project with Typescript\nFirsts commands in new nodejs project with typescript are always initialization\nof package.json\n\nnpm init -y\n\nand tsconfig.json\n\ntsc --init\n\nNow we have to decide, how to run our project. Ancient methods like ts-node with \nnodemon was abandoned by me when I meet ts-node-dev. It restarts target node\nprocess when any of required files changes (as standard node-dev) but shares\nTypescript compilation process between restarts. This significantly increases\nspeed of restarting comparing to mentioned solutions. In package.json scripts we\ncan add line:\n\n    \"dev\": \"ts-node-dev --no-notify --respawn --transpile-only src/index.ts\",\n\n\nlets install ts-node-dev\n\nnpm i -D ts-node-dev\n\nin src/index.ts we can add content\n\nasync function main() {\n    console.log(\"ok\");\n}\n\nmain().catch(console.error)\n\n\nand run it by\n\nnpm run dev\n\nIt will show \"ok\" and will wait for changes to react on them in real time.\n\nAdd Fastify with first endpoint\nFastify is framework similar to express but with two advantages\n\n * it is about 20% faster in requests processing\n\n * it is faster in developemnt thanks to useful simplifications in his API\n\nOne disadvantage of fastify is smaller comunity (32 times smaller now).\n\nTo install fastify type:\n\nnpm i fastify\n\nNow we can create src/fastify.ts with content:\n\nimport fastify, {FastifyInstance} from \"fastify\";\n\nexport function getFastifyServer(): FastifyInstance {\n    const app = fastify({})\n    \n    // there add \n    // - endpoints\n    // - hooks\n    // - middlewares\n    \n    return app\n}\n\n\nand in src/index.ts import it and use to run server on selected port\n\nimport { getFastifyServer } from './fastify'\n\nasync function main() {\n    const app = await getFastifyServer()\n    await app.listen({ port: 4200, host: '0.0.0.0' })\n    console.log(`Fastify listen on http://localhost:4200/`)\n}\n\nmain().catch(console.error)\n\n\nNow it is not very useful, because we did not defined any route, middleware or\nhook to process requests. Lets do it and define / endpoint.\n\nFirst endpoint in Fastify - project version\n This will be public route but to no litter fastify.ts file we will create next\none src/routes/version.ts with content\n\nimport pJson from '../../package.json'\n\nexport class Version {\n    static async root() {\n        return {\n            name: pJson.name,\n            version: pJson.version,\n        }\n    }\n}\n\n\nIt is simple class with static method that returns object. Fastify will convert\nit to response with content type application/json for us, but we have to enable \nresolveJsonModule option in tsconfig.json\n\n     \"resolveJsonModule\": true,                        /* Enable importing .json files. */\n\n\nnow in center of fastify.ts file we can add\n\n    app.get('/', Version.root)\n\nand request to main route of our server\n\n http -b localhost:4200\n\nstarts return response\n\n{\n    \"name\": \"metamask-fastify-rest-api\",\n    \"version\": \"1.0.0\"\n}\n\n\nTests in Jest with esbuild\nIf you are programmer more time, than one day you are aware how easy is break up\nyour working program changing something in source code in random places.\nFortunately we can write test that prove that code is working as we expecting.\n\nIn node js word one of best testing frameworks is jest. But to connect it with\ntypescript we need plugin that will transform ts files.  It is terrible that\nmost popular ts-jest is 2000 times more frequently used that about 26 times\nfaster jest-ebuild. But lets use technology from the future - esbuild.\n\nOur jest.config.ts will contain\n\nmodule.exports = {\n  roots: ['<rootDir>'],\n  testMatch: ['**/__tests__/**/*.+(ts|tsx)', '**/?(*.)+(spec|test).+(ts|tsx)'],\n  transform: {\n    '^.+\\\\.(ts|tsx)$': 'jest-esbuild',\n  },\n  setupFilesAfterEnv: [],\n  testEnvironment: 'node',\n}\n\n\nLets install packages\n\nnpm i -D jest @types/jest jest-esbuild\n\nand add test script in package.json\n\nour first test file test/version.test.ts can look as follow:\n\nimport pJson from '../package.json'\nimport { getFastifyServer } from '../src/fastify'\n\nconst correctVersion = { name: pJson.name, version: pJson.version }\n\ndescribe('i can read version', () => {\n  it('from rest api', async () => {\n    const server = await getFastifyServer()\n    const result = await server.inject({\n      method: 'GET',\n      path: '/',\n    })\n\n    expect(result.body).toEqual(JSON.stringify(correctVersion))\n    expect(result.statusCode).toEqual(200)\n    expect(result.headers['content-type']).toContain('application/json')\n  })\n})\n\n\nNow when you type\n\nnpm test\n\nyou should see\n\n PASS  test/version.test.ts\n  i can read version\n    ✓ from rest api (14 ms)\n\nTest Suites: 1 passed, 1 total\nTests:       1 passed, 1 total\nSnapshots:   0 total\nTime:        0.222 s, estimated 1 s\nRan all test suites.\n\nWe have configured fastify server with live reload development environment and\nsuper fast tests configured in jest. We created first endpoint that returns name\nand version of server on root endpoint. It is time to describe auth flow and\nimplement required routes.\n\nAuth flow diagram\nGenerally idea is the following. User has private key connected with his wallet\naddress. We can save this address to database as his unique id and generate\nnonce for him. Nonce is simple random phrase generated to check if user can\ncorrectly sing it using his own address. If nonce will leak, it is nothing\nscarry, because nobody will be able to sign it with correct address is he does\nnot possess private key. Below we presenting diagram:\n\nSo we need users collection only with address and nonce and 4 endpoints\n\n * to get nonce for given address\n * to register new address and assign him nonce\n * to login using address, nonce and signature\n * to get my account details using JWT token\n\nDB model with prisma\nPrisma is greate pice of software that helps to use database in reliable way\nthanks to great types and interfaces allowing to staticly validate all places in\ncode when we using database. \n\nTo install prisma we will need two libraries\n\nnpm i prisma @prisma/client\n\nNow typing:\n\nnpx prisma init\n\nwe can generate initial setup.\n\nThere was created .env with DATABASE_URL and prisma/schema.prisma, that by\ndefault use postgresql. We need mongo so lets modify file with schema\n\ngenerator client {\n  provider = \"prisma-client-js\"\n}\n\ndatasource db {\n  provider = \"mongodb\"\n  url      = env(\"DATABASE_URL\")\n}\n\nmodel users {\n  id      String @id @default(auto()) @map(\"_id\") @db.ObjectId\n  address String @unique\n  nonce   String\n}\n\n\nand in .env we can select address to our mongo database\n\nDATABASE_URL=mongodb://localhost:27017/web3_bdl\n\nMongo in Replica Set Mode\nIt is important, that prisma now using mongo in replica mode.\n\nReplication — MongoDB Manual [https://www.mongodb.com/docs/manual/replication/]\nto configure it you will need add lines\n\nreplication:\n  replSetName: rs0\n\nto your mongodb config /etc/mongod.conf. This path depent from your OS.\n\nIn mongo cli you should execute\n\nrs.initiate()\n\nto setup replica set and \n\nrs.status()\n\nto check it. You will have to restart your mongo service to read changes from\nconfig.\n\nGeneration typescript from prisma\nIf you have correctly configured mongo and created user models, run\n\nnpx prisma generate\n\nthis command will generate typescript to help with autocompletion and static\nvalidation your further code.\n\nSingle prisma client for all application\nIt is rather good practice to configure db access point in single place and\nimport it from this file than use library. In our case it will be file \nsrc/storage/prisma.ts. In this file we will modify DATABASE_URL adding _test at\nthe end in test environment. Thanks to this modification we can do not care\nabout distinct set of env for test and can avoid overriding our local data\nduring tests written in jest.\n\nimport {PrismaClient} from \"@prisma/client\";\n\nfunction dbUrl() {\n    const url = process.env.DATABASE_URL;\n\n    if(!url) throw new Error(`No db url`);\n\n    if(process.env.NODE_ENV === 'test') {\n        if(url.includes('?')) {\n            throw new Error('test url not implemented for this db')\n        }\n        return url + '_test'\n    } else {\n        return url;\n    }\n}\n\nconst prisma = new PrismaClient({\n    datasources: {\n        db: {\n            url: dbUrl()\n        }\n    }\n})\n\nexport {\n    prisma,\n    PrismaClient\n}\n\n\nNow we can import prisma from this place and get access to proper database in\ndependence from NODE_ENV.\n\nPassing env to process\nNot there is last challenge connected with databae - passing db address to\nprogram in secure way. We can do it by dotenv library but I prefer Makefile as\naccess point ot application because it is more universal way and can be applied\nwith python, go, ruby and other languages in the same way. This is my Makefile\n\ninclude .env\nexport\n\nnode_modules: package.json\n\tnpm i\n\nup: node_modules\n\tnpm run dev\n\n\nso from now, instead of writing\n\nnpm run dev\n\nyou can write\n\nmake up\n\nof course it is only solution in development mode. In production it is better\npass environment variables using docker or similar solution.\n\nChecking if user with address exists\nFirst step in our diagram was checking is user with given address exists and get\nhis nonce. If address no exists we want to return Not Found answer. We can use\nhelper to create notFound answer using @fastify/sensible. Lets install it:\n\nnpm i @fastify/sensible\n\nnow we can import it in src/fastify.ts\n\nimport fastifySensible from '@fastify/sensible'\n\n\nand register in body of getFastifyServer function\n\n    app.register(fastifySensible)\n\n\nTo add endpoint finding users by address add here also line\n\n    app.get('/users/:address/nonce', User.getNonce)\n\n\nWe will need to import user from routes so in src/routes/user.ts lets create\nclass User with static method getNonce like before we done with version.\n\nimport {FastifyRequest} from \"fastify\";\nimport {prisma} from \"../storage/prisma\";\n\nexport class User {\n    static async getNonce(req: FastifyRequest<{ Params: { address: string } }>, res: FastifyReply) {\n        const address = req.params.address;\n\n        const user = await prisma.users.findUnique({\n            where: {\n                address\n            }\n        })\n\n        if (!user) return res.notFound()\n\n        return {\n            nonce: user.nonce\n        }\n    }\n}\n\n\nNow we can test it manually\n\nhttp -b localhost:4200/users/123/nonce\n{\n    \"error\": \"Not Found\",\n    \"message\": \"Not Found\",\n    \"statusCode\": 404\n}\n\nbut it is better to write tests in jest. Before writing tests we will prepare \nsrc/storage/seed.ts file with function seed to clear our database.\n\nimport {prisma} from \"./prisma\";\n\nexport async function seed() {\n    await prisma.users.deleteMany();\n}\n\n\nNow in test/address.test.ts we can write tests to check if this endpoint is\nworking.\n\nimport { getFastifyServer } from '../src/fastify'\nimport {seed} from \"../src/storage/seed\";\nimport {prisma} from \"../src/storage/prisma\";\n\ndescribe('searching user by address', () => {\n  it('address not found', async () => {\n    await seed();\n\n    const server = await getFastifyServer()\n    const result = await server.inject({\n      method: 'GET',\n      path: '/users/abc/nonce',\n    })\n\n\n    expect(result.statusCode).toEqual(404);\n    expect(result.body).toEqual(JSON.stringify({\n      statusCode: 404,\n      error: \"Not Found\",\n      message: \"Not Found\"\n    }))\n  })\n\n  it('address found and nonce is correct', async () => {\n    await prisma.users.upsert({\n      where: {\n        address: \"abc\"\n      },\n      create: {\n        address: \"abc\",\n        nonce: \"secret\"\n      },\n      update: {\n        nonce: \"secret\"\n      }\n    })\n\n    const server = await getFastifyServer()\n    const result = await server.inject({\n      method: 'GET',\n      path: '/users/abc/nonce',\n    })\n\n    expect(result.statusCode).toEqual(200);\n    expect(result.body).toEqual(JSON.stringify({\n      nonce: 'secret'\n    }))\n\n  })\n})\n\n\nHere we covered all possible scenarios. \n\nRegister user using wallet address\nNow user can check if his address is registered. Of course if he will see our\napp first time, he will not be registered, so he will get 404 and will try to\nregister his address. Lets implement registration.\n\nNonce have to be random string. To generate it we will use uid package.\n\nnpm i uid\n\nIn src/routes/user.ts we adding new static method do User class\n\n    static async register(req: FastifyRequest<{\n        Body: {\n            address: string\n        }\n    }>, res: FastifyReply) {\n        const found = await prisma.users.findUnique({\n            where: {\n                address: req.body.address\n            }\n        })\n\n        if (found) return res.code(200).send({\n            nonce: found.nonce\n        });\n\n        const nonce = uid(20);\n        await prisma.users.create({\n            data: {\n                address: req.body.address,\n                nonce,\n            }\n        })\n\n        return res.code(201).send({\n            nonce\n        });\n    }\n\nLogic here is super simple. We are seraching for user. If exists response code\nis 200. If no, then user is created and response code is 201. In any case we\nwant to return user nonce.\n\nIn src/fastify.ts we adding line that will register this handler\n\n    app.post('/register', User.register)\n\n\nWe can cover it by test similarly like before\n\nimport { getFastifyServer } from '../src/fastify'\nimport {seed} from \"../src/storage/seed\";\nimport {Response } from \"light-my-request\";\n\ndescribe('user can register account', () => {\n  it('first and second registration', async () => {\n    await seed();\n\n    async function registerUser(address: string): Promise<Response> {\n      return server.inject({\n        method: 'POST',\n        path: '/register',\n        payload: {\n          'address': address\n        }\n      })\n    }\n\n    const server = await getFastifyServer()\n    const result1 =await registerUser(\"abc\")\n\n    expect(result1.statusCode).toEqual(201);\n    expect(result1.headers['content-type']).toContain(\"application/json\");\n\n    const result2 =await registerUser(\"abc\")\n\n    expect(result2.statusCode).toEqual(200);\n    expect(result2.body).toEqual(result1.body);\n  })\n})\n\n\nLogin user by signed message\nNow we have to implement verification of signature created by metamask. We can\ndo it using function verifyMessage delivered by library etherjs.\n\nVerification of signature with etherjs\nnpm i ethers\n\nin new file src/auth/getUser.ts we can create some auxiliary functions. \n\nimport {utils} from \"ethers\";\nimport { users} from \"@prisma/client\";\n\nexport function getAddress(nonce: string, signature: string): string {\n    return utils.verifyMessage(nonce, signature).toLowerCase()\n}\n\nexport function verifyUser(user: Pick<users, 'nonce' | 'address'>, signature: string): boolean {\n    try {\n        return getAddress(user.nonce, signature) === user.address;\n    } catch {\n        return false;\n    }\n}\n\n\nfirst one give us address used to sign message. Second check if this address is\nthe same like possessed by our user. In test/auth.test.ts we can check if it\nworks.\n\nimport {verifyUser, getAddress} from \"../src/auth/getUser\";\n\nconst address = '0xa68701d9b3eb52f0a7248e7b57d484411a60b045';\nconst nonce = '14b2a79636d81fbb10f9';\nconst signature = '0x5d8f425c91437148b65f47e9444d91e868d3566d868649fec58c76010c8f01992edd2db3284088d5f5048fc3bc9eff307e0cd1b8b1a2e6c96a2784eb5fd5358d1b';\n\n\ndescribe('i can authenticate signature', () => {\n    it('auth', () => {\n        expect(getAddress(nonce, signature)).toEqual(address)\n        expect(verifyUser({nonce, address}, signature)).toBeTruthy();\n    })\n});\n\n\nvalues in test address, nonce and signature are prepared in browser. \n\nSigning nonce in browser using metamask\nIf do you metamask you can get signature address typing in browser console:\n\nethereum.enable()\n\nand then\n\nethereum.selectedAddress\n\nIf you want to sign nonce lets create helper in browser console:\n\nfunction utf8ToHex(str) {\n  return Array.from(str).map(c =>\n      c.charCodeAt(0) < 128 ? c.charCodeAt(0).toString(16) :\n          encodeURIComponent(c).replace(/\\%/g, '').toLowerCase()\n  ).join('');\n}\n\nthen define nonce\n\nnonce = 'abc'\n\nand finally\n\nawait ethereum.request({\n    method: \"personal_sign\",\n    params: [utf8ToHex(nonce), ethereum.selectedAddress],\n  })\n\nGeneration JWT token with user's data\nOur next challenge is sending jwt token. To create it lets install two libraries\n\nnpm i jsonwebtoken dayjs\nnpm i --save-dev @types/jsonwebtoken\n\nIn src/auth/getUser.ts we can define next helper to create tokens\n\nimport dayjs from \"dayjs\";\nimport jwt from 'jsonwebtoken'\n\nconst jwtKey = process.env.JWT_SECRET_KEY ?? 'test';\nconst issuer = 'I <3 web3'; // name of organization\n\n\nexport function tokenizeUser(user: Pick<users, 'address'>): string {\n    return jwt.sign({\n        sub: user.address,\n        iss: issuer,\n        exp: dayjs().add(1, 'month').unix()\n    }, jwtKey)\n}\n\nThese tokens will have 1 month lifetime and will contain user address and info\nabout organization. In .env we have to add line with our jwt secret key.\n\nJWT_SECRET_KEY=123\n\nLogin endpoint in REST api\nNow we are ready to add login function to src/routes/user.ts\n\nimport {tokenizeUser, verifyUser} from \"../auth/getUser\";\n\n// ...\n\n    static async login(req: FastifyRequest<{\n        Body: { address: string, sig: string, nonce: string }\n    }>, res: FastifyReply) {\n        const {address, sig, nonce} = req.body\n\n        if (!address || !sig || !nonce) return res.expectationFailed('invalid body');\n\n        const verified = verifyUser({address, nonce}, sig);\n        if (!verified) return res.unauthorized();\n\n\n        return {\n            token: tokenizeUser({address})\n        }\n    }\n\nin src/fastify.ts we need register /login route\n\n    app.post('/login', User.login)\n\n\n Now we can add next test in test/auth.test.ts\n\nimport {getFastifyServer} from \"../src/fastify\";\nimport {seed} from \"../src/storage/seed\";\nimport {prisma} from \"../src/storage/prisma\";\nimport {Response} from \"light-my-request\";\n\n\n    it('and see his token', async () => {\n        await seed();\n        await prisma.users.create({\n            data: {\n                address,\n                nonce\n            },\n        })\n\n        async function login(signature: string): Promise<Response> {\n            return server.inject({\n                method: 'POST',\n                path: '/login',\n                payload: {\n                    address,\n                    sig: signature,\n                    nonce\n                }\n            })\n        }\n\n        const server = await getFastifyServer()\n        const result1 = await login(\"abc\")\n\n        expect(result1.statusCode).toEqual(401);\n        expect(result1.body).toEqual(JSON.stringify({\n            statusCode: 401, error: \"Unauthorized\", message: \"Unauthorized\"\n        }));\n\n        const result2 = await login(signature)\n\n        expect(result2.statusCode).toEqual(200);\n        expect(result2.body).toEqual(JSON.stringify({\n            token: tokenizeUser({address})\n        }));\n    })\n\nGetting user data from JWT token\nFinally we are ready to implement /me route, but It will be differ than any\nprevious. It will not be public route. We are going to create middleware to\nguard this route. In this middleware we will recognize user and append them to \nrequest object living during this request processing. \n\nFirst lacking element is function getUser. Lets define it in src/auth/getUser.ts \nfile\n\ninterface JwtPayloadCustomer {\n    iss: string\n    iat: number\n    exp: number\n    sub: string\n}\n\nfunction getExpDate(jwtPayload: { exp: number }): Date {\n    return dayjs.unix(jwtPayload.exp).toDate()\n}\n\nexport function getUser(token?: string): JWTUser | null {\n    if (!token) {\n        return null\n    } else {\n        token = token.replace(/^Bearer\\s+/, '')\n\n        const jwtPayload = jwt.verify(token, jwtKey) as unknown as JwtPayloadCustomer\n\n        const sub = jwtPayload.sub\n\n        return {\n            address: sub,\n            token_expiring_at: getExpDate(jwtPayload),\n        }\n    }\n}\n\nreturned interface JWTUser can be defined in src/interfaces/context.ts as\n\nimport { PrismaClient } from '../storage/prisma'\n\nexport interface JWTUser {\n  address: string\n  token_expiring_at: Date\n}\n\n\nSecond lacking element is extension of FastifyRequest allowing to save user\namong request properties. In src/fastify.ts we can declare fastify module\nextending FastifyRequest.\n\ndeclare module 'fastify' {\n    interface FastifyRequest {\n        user: JWTUser | null\n    }\n}\n\nNow we can define function auth that will be used in preValidation array as\nguard for any private routes.\n\nasync function auth(request: FastifyRequest, reply: FastifyReply) {\n    const token = (request.headers.authorization || '').replace(/Bearer\\s+/, '') || undefined\n    request.user = getUser(token)\n    if (!request.user) reply.unauthorized()\n}\n\nThis auth middleware will assign usser to request if token is valid. In other\nway It will replay with 401.\n\nFormally 401 Unauthorized is the status code to return when the client provides\nno credentials or invalid credentials. 403 Forbidden is the status code to\nreturn when a client has valid credentials but not enough privileges to perform\nan action on a resource.\n\nBut for the sake of simplicity we will skip this nuance. Now we can register /me \nwith pre validation guard.\n\n    app.get('/me', {preValidation: [auth]}, User.root)\n\nand in src/route/user.ts add controller with name root.\n\n    static async root(req: FastifyRequest, res: FastifyReply) {\n        return req.user;\n    }\n\nNow lets try to use it. First register account with address from my browser\n\nThen sign nonce in browser\n\nLogin using signature to get jwt token\n\nAnd finally get user data using private route /me\n\nWe can cover it by test in jest in file test/account.test.ts\n\nimport { getFastifyServer } from '../src/fastify'\nimport {seed} from \"../src/storage/seed\";\nimport {prisma} from \"../src/storage/prisma\";\nimport {tokenizeUser} from \"../src/auth/getUser\";\n\nconst address = 'abc';\n\ndescribe('i can see my account', () => {\n    it('using token', async () => {\n        await seed();\n        prisma.users.create({\n            data: {\n                address,\n                nonce: 'secret'\n            }\n        })\n\n        const server = await getFastifyServer()\n        const result = await server.inject({\n            method: 'GET',\n            path: '/me',\n            headers: {\n                authorization: `Bearer ${tokenizeUser({address})}`\n            }\n        })\n\n        expect(JSON.parse(result.body)).toMatchObject({\n            address\n        })\n        expect(result.statusCode).toEqual(200)\n        expect(result.headers['content-type']).toContain('application/json')\n    })\n})\n\n\nUnfortunately this leads to deadlock in tests, that are executed simultaneously:\n\nInvalid `prisma.users.deleteMany()` i\nnvocation:\n\n\n    Transaction failed due to a write con\nflict or a deadlock. Please retry your tr\nansaction\n\nWe can solve it simply adding --runInBand to jest command.\n\n    \"test\": \"jest --runInBand\",\n\n\nGeneral improvements in Fastify project\nThere are three improvements that are can add. \n\n * cors\n * colorful errors in logs\n * testing in github workflow\n\nCors\nWe want to make this api open to accept requests from all domains.  Lets install \n@fastify/cors package\n\nnpm i @fastify/cors\n\nand in src/fastify.ts simply register it like fastifySensible\n\nimport cors from '@fastify/cors'\n\n//...\n\n    app.register(cors)\n\n\nwe can add cors tests in file test/cors.test.ts\n\nimport {getFastifyServer} from '../src/fastify'\n\ndescribe('cors', () => {\n    it('for get I have access-control-allow-origin', async () => {\n        const server = await getFastifyServer()\n        const result = await server.inject({\n            method: 'GET',\n            path: '/',\n        })\n\n        expect(result.statusCode).toEqual(200)\n        expect(result.headers['access-control-allow-origin']).toEqual('*')\n    })\n\n    it('for options I see cors headers', async () => {\n        const server = await getFastifyServer()\n        const result = await server.inject({\n            method: 'OPTIONS',\n            path: '/',\n            headers: {\n                'Access-Control-Request-Method': 'GET',\n                'Origin': 'https://ilove.ethereum'\n            }\n        })\n\n        expect(result.statusCode).toEqual(204)\n        expect(result.headers['access-control-allow-origin']).toEqual('*')\n\n    })\n})\n\n\nColorful error logs\nTo find problems in our code easier we can use colors to print errors:\n\nLets install cli-color library:\n\nnpm i cli-color\nnpm i -D @types/cli-color\n\nnow in src/fastify.ts we can define function shouldPrintError\n\nfunction shouldPrintError(error: FastifyError) {\n    return process.env.NODE_ENV !== 'test' && (!error.statusCode || !(error.statusCode >= 400 && error.statusCode < 500))\n}\n\nit decide that we want to print only errors without status code (not handled) or\nwith code other than 4xx. Additionally we not want to see errors in test mode.\nYou can set these conditions as you want, but it is important than we want to\ntreat different types of errors in different manner. \n\nNow we can add hook in body od getFastifyServer\n\nimport {red, yellow} from 'cli-color'\n\n\n    app.addHook('onError', async (request, reply, error) => {\n        if (shouldPrintError(error)) {\n            console.log(red(error), yellow(String(error.stack).replace(`Error: ${error.message}`, '')))\n        }\n        if (isNativeError(error)) {\n            return reply.internalServerError(error.message)\n        }\n        throw error\n    })\n\nnow our errors will be easy to find and analyze in console.\n\nGithub workflows\nLets start from checking if our project can be build. In package.json we can add\nscript\n\n\"build\": \"tsc\"\n\nto remove js files created by this command you can type\n\ntsc --build --clean\n\nIn github you can create basic workflow for node js using gui.\n\nname: Node.js CI\n\non:\n  push:\n    branches: [ \"main\" ]\n  pull_request:\n    branches: [ \"main\" ]\n\njobs:\n  build:\n\n    runs-on: ubuntu-latest\n\n    strategy:\n      matrix:\n        node-version: [18.x]\n        # See supported Node.js release schedule at https://nodejs.org/en/about/releases/\n\n    steps:\n    - uses: actions/checkout@v3\n    - name: Use Node.js ${{ matrix.node-version }}\n      uses: actions/setup-node@v3\n      with:\n        node-version: ${{ matrix.node-version }}\n        cache: 'npm'\n    - run: npm ci\n    - run: npm run build --if-present\n    - run: npm test\n\n\nBut it will not work because there is not mongodb in replica set mode.\n\nFortunatlley configuration on github actions is super easy and after small fixes\nour workflow looks as follw:\n\nname: Node.js CI\n\non:\n  push:\n    branches: [ \"main\" ]\n  pull_request:\n    branches: [ \"main\" ]\n\nenv:\n  JWT_SECRET_KEY: 123\n  DATABASE_URL: mongodb://localhost:27017/web3_bdl\n\njobs:\n  build:\n\n    runs-on: ubuntu-latest\n\n    strategy:\n      matrix:\n        node-version: [18.x]\n        mongodb-version: ['5.0']\n\n    steps:\n    - uses: actions/checkout@v3\n    - name: Use Node.js ${{ matrix.node-version }}\n      uses: actions/setup-node@v3\n      with:\n        node-version: ${{ matrix.node-version }}\n        cache: 'npm'\n\n    - name: Start MongoDB\n      uses: supercharge/mongodb-github-action@1.8.0\n      with:\n        mongodb-version: ${{ matrix.mongodb-version }}\n        mongodb-replica-set: rs-test\n\n    - run: npm ci\n    - run: npm test\n    - run: npm run build --if-present\n\n\nAll presented code can be found in repository:\n\nGitHub - gustawdaniel/metamask-fastify-rest-apiContribute to\ngustawdaniel/metamask-fastify-rest-api development by creating an account on\nGitHub.GitHubgustawdaniel\n[https://github.com/gustawdaniel/metamask-fastify-rest-api]I hope that you liked\nthis form of publication when we covered all parts from scratch to working demo.\nLet me know if do you see how can I make my code better or if something\npresented here helped in your projects.","feature_image":"__GHOST_URL__/content/images/2022/11/metamask-fastify-min.jpg","featured":0,"type":"post","status":"published","locale":null,"visibility":"public","email_recipient_filter":"all","created_at":"2022-11-30T07:01:12.000Z","updated_at":"2022-11-30T17:23:41.000Z","published_at":"2022-11-30T17:23:41.000Z","custom_excerpt":"We building from scratch rest api in fastify using mongodb connected by prisma as database, jest as test framework and etherjs to verify signatures signed by metamask.","codeinjection_head":null,"codeinjection_foot":null,"custom_template":null,"canonical_url":null,"newsletter_id":null,"lexical":null},{"id":"638e0843bbda300a2f29c425","uuid":"6bfbf34f-626d-4256-b4e4-fe0ccecc3b71","title":"Scrabble","slug":"scrabble","mobiledoc":"{\"version\":\"0.3.1\",\"atoms\":[],\"cards\":[[\"image\",{\"src\":\"__GHOST_URL__/content/images/2022/12/1024px-Blank_Scrabble_board_with_coordinates.svg.png\",\"width\":1024,\"height\":985}],[\"image\",{\"src\":\"__GHOST_URL__/content/images/2022/12/2022-12-05_21-09.png\",\"width\":513,\"height\":504}],[\"code\",{\"code\":\"#include <ncurses.h>\\n\\nstruct Map {\\npublic:\\n    int size = 15;\\n\\n    void init() {\\n        initscr();\\n        // printing letters from A to O\\n        for (int i = 2; i < size + 2; i++) {\\n            const char c[] = {static_cast<char>(65 + i - 2), '\\\\0'};\\n            mvprintw(0, i, \\\"%s\\\", c);\\n            mvprintw(size + 1, i, \\\"%s\\\", c);\\n        }\\n        // printing numbers from 1 to 15\\n        for (int i = 1; i < size + 1; i++) {\\n            mvprintw(i, 0, \\\"%2d\\\", i);\\n            mvprintw(i, 0 + size + 2, \\\"%d\\\", i);\\n        }\\n    }\\n};\\n\\nstruct Game {\\n    void init() {\\n        Map *map = new Map();\\n        map->init();\\n    }\\n\\n    int end() {\\n        getch();\\n        endwin();\\n        return 0;\\n    }\\n};\\n\\n\\nint main() {\\n    Game *g = new Game();\\n    g->init();\\n    return g->end();\\n}\",\"language\":\"c++\"}],[\"code\",{\"code\":\"make run\"}],[\"code\",{\"code\":\"build:\\n\\tg++ -lncursesw -o main main.cpp\\n\\nrun: build\\n\\t./main\"}],[\"code\",{\"code\":\"noecho();\"}],[\"code\",{\"code\":\"keypad(stdscr, TRUE);\"}],[\"code\",{\"code\":\"struct Pos {\\n    int x;\\n    int y;\\n};\\n\\nstruct Player {\\n    Pos pos;\\n}\",\"language\":\"c++\"}],[\"code\",{\"code\":\"    void init() {\\n        pos.x = 2;\\n        pos.y = 1;\\n        mvprintw(pos.y, pos.x, \\\"\\\");\\n    }\"}],[\"code\",{\"code\":\"    void setPosition() {\\n        while (int c = getch()) {\\n            switch (c) {\\n                case KEY_LEFT: {\\n                    pos.x--;\\n                    break;\\n                }\\n                case KEY_RIGHT: {\\n                    pos.x++;\\n                    break;\\n                }\\n                case KEY_UP: {\\n                    pos.y--;\\n                    break;\\n                }\\n                case KEY_DOWN: {\\n                    pos.y++;\\n                    break;\\n                }\\n                default: {}\\n            }\\n            mvprintw(pos.y, pos.x, \\\"\\\");\\n        }\\n    }\"}],[\"bookmark\",{\"type\":\"bookmark\",\"url\":\"https://github.com/gustawdaniel/scrabble-cpp-game/commit/7a8c64dcf43462a81511cb7a36888e16559fd9d4\",\"metadata\":{\"url\":\"https://github.com/gustawdaniel/scrabble-cpp-game/commit/7a8c64dcf43462a81511cb7a36888e16559fd9d4\",\"title\":\"added positions selection · gustawdaniel/scrabble-cpp-game@7a8c64d\",\"description\":\"Contribute to gustawdaniel/scrabble-cpp-game development by creating an account on GitHub.\",\"author\":\"gustawdaniel\",\"publisher\":\"GitHub\",\"thumbnail\":\"https://opengraph.githubassets.com/3d7f31640b4135d1e2dc4ab09bf7d6c66804697953574998f1cf9dfc200f799e/gustawdaniel/scrabble-cpp-game/commit/7a8c64dcf43462a81511cb7a36888e16559fd9d4\",\"icon\":\"https://github.githubassets.com/favicons/favicon.svg\"}}],[\"image\",{\"src\":\"__GHOST_URL__/content/images/2022/12/2022-12-05_23-51.png\",\"width\":958,\"height\":517}],[\"bookmark\",{\"type\":\"bookmark\",\"url\":\"https://github.com/gustawdaniel/scrabble-cpp-game/commit/e588a0c5feeed51cb325f347c849f2576241ddd4\",\"metadata\":{\"url\":\"https://github.com/gustawdaniel/scrabble-cpp-game/commit/e588a0c5feeed51cb325f347c849f2576241ddd4\",\"title\":\"direction possible to select · gustawdaniel/scrabble-cpp-game@e588a0c\",\"description\":\"Contribute to gustawdaniel/scrabble-cpp-game development by creating an account on GitHub.\",\"author\":\"gustawdaniel\",\"publisher\":\"GitHub\",\"thumbnail\":\"https://opengraph.githubassets.com/937172a67972e75c3ebed38c9cca17478dc0811b25a3e0526ba06412b3e042c2/gustawdaniel/scrabble-cpp-game/commit/e588a0c5feeed51cb325f347c849f2576241ddd4\",\"icon\":\"https://github.githubassets.com/favicons/favicon.svg\"}}],[\"code\",{\"code\":\"    static char get_letter(int from_a) {\\n        return static_cast<char>(65 + from_a - 2);\\n    }\",\"caption\":\"\",\"language\":\"c++\"}],[\"code\",{\"code\":\"    static void showUserName(const Player *p) {\\n        mvprintw(0, size + 5, \\\"Name: %s\\\", p->name.c_str());\\n        mvprintw(p->pos.y, p->pos.x, \\\"\\\");\\n    }\\n\\n    static void showUserPosition(const Player *p) {\\n        const char x[] = {get_letter(p->pos.x)};\\n        mvprintw(1, size + 5, \\\"Pos : %s%d \\\", x, p->pos.y);\\n        mvprintw(p->pos.y, p->pos.x, \\\"\\\");\\n    }\\n\\n    static void showUserDirection(const Player *p) {\\n        mvprintw(2, size + 5, \\\"Dir : %s \\\", p->direction == 'R' ? \\\"Right\\\" : \\\"Down\\\");\\n        mvprintw(p->pos.y, p->pos.x, \\\"\\\");\\n    }\",\"language\":\"c++\"}],[\"code\",{\"code\":\"void Player::init() {\\n    pos.x = 2 + 7;\\n    pos.y = 1 + 7;\\n    mvprintw(pos.y, pos.x, \\\"\\\");\\n    Map::showUserName(this);\\n    Map::showUserPosition(this);\\n    Map::showUserDirection(this);\\n}\",\"language\":\"c++\"}],[\"code\",{\"code\":\"void Player::setPosition() {\\n    while (int c = getch()) {\\n        switch (c) {\\n            case KEY_LEFT: {\\n                pos.x--;\\n                break;\\n            }\\n            case KEY_RIGHT: {\\n                if (direction == 'R') {\\n                    pos.x++;\\n                } else {\\n                    direction = 'R';\\n                }\\n                break;\\n            }\\n            case KEY_UP: {\\n                pos.y--;\\n                break;\\n            }\\n            case KEY_DOWN: {\\n                if (direction == 'D') {\\n                    pos.y++;\\n                } else {\\n                    direction = 'D';\\n                }\\n                break;\\n            }\\n            default: {\\n            }\\n        }\\n        Map::showUserPosition(this);\\n        Map::showUserDirection(this);\\n        mvprintw(pos.y, pos.x, \\\"\\\");\\n    }\\n}\",\"language\":\"c++\"}],[\"code\",{\"code\":\"struct Player {\\npublic:\\n    std::string name;\\n    Pos pos{};\\n    char direction = 'R';\\n\\n    explicit Player(std::string init_name) {\\n        name = std::move(init_name);\\n    }\\n\\n    void init();\\n\\n    void setPosition();\\n};\",\"language\":\"c++\"}],[\"code\",{\"code\":\"struct Game {\\n    static void init() {\\n        Map::init();\\n\\n        auto *p1 = new Player(\\\"Player 1\\\");\\n        p1->init();\\n\\n        p1->setPosition();\\n    }\\n\\n    static int end() {\\n        getch();\\n        endwin();\\n        return 0;\\n    }\\n};\"}],[\"bookmark\",{\"type\":\"bookmark\",\"url\":\"https://en.wikipedia.org/wiki/Scrabble_letter_distributions#English\",\"metadata\":{\"url\":\"https://en.wikipedia.org/wiki/Scrabble_letter_distributions\",\"title\":\"Scrabble letter distributions - Wikipedia\",\"description\":null,\"author\":\"Contributors to Wikimedia projects\",\"publisher\":\"Wikimedia Foundation, Inc.\",\"thumbnail\":\"https://upload.wikimedia.org/wikipedia/commons/b/b8/Scrabble_tiles_en.jpg\",\"icon\":\"https://en.wikipedia.org/static/apple-touch/wikipedia.png\"}}],[\"code\",{\"code\":\"#include <ctime>\"}],[\"code\",{\"code\":\"struct LettersSet {\\n    int size = 100;\\n\\n    char letters[100] = {\\n            'k',\\n            'j',\\n            'x',\\n            'q',\\n            'z',\\n            'b', 'b',\\n            'c', 'c',\\n            'm', 'm',\\n            'p', 'p',\\n            'f', 'f',\\n            'h', 'h',\\n            'v', 'v',\\n            'w', 'w',\\n            'y', 'y',\\n            'g', 'g', 'g',\\n            'l', 'l', 'l', 'l',\\n            's', 's', 's', 's',\\n            'u', 'u', 'u', 'u',\\n            'd', 'd', 'd', 'd',\\n            'n', 'n', 'n', 'n', 'n', 'n',\\n            'r', 'r', 'r', 'r', 'r', 'r',\\n            't', 't', 't', 't', 't', 't',\\n            'o', 'o', 'o', 'o', 'o', 'o', 'o', 'o',\\n            'a', 'a', 'a', 'a', 'a', 'a', 'a', 'a', 'a',\\n            'i', 'i', 'i', 'i', 'i', 'i', 'i', 'i', 'i',\\n            'e', 'e', 'e', 'e', 'e', 'e', 'e', 'e', 'e', 'e', 'e', 'e',\\n            '_', '_'\\n    };\\n\\n    char getRandomLetter() {\\n        if(!size) return '#';\\n        int index = rand() % size;\\n        char c = letters[index];\\n\\n        for(int i=index; i<size; i++)\\n            letters[i] = letters[i + 1];\\n\\n        size--;\\n\\n        return c;\\n    }\\n};\"}],[\"code\",{\"code\":\"    char letters[8];\",\"caption\":\"\"}],[\"code\",{\"code\":\"    void init(LettersSet *ls);\"}],[\"code\",{\"code\":\"    static void showUserLetters(const Player *p) {\\n        mvprintw(3, size + 5, \\\"Lett: %s \\\", p->letters);\\n        mvprintw(p->pos.y, p->pos.x, \\\"\\\");\\n    }\\n\\n    static void showLeftLetters(const Player *p, const LettersSet *ls) {\\n        mvprintw(4, size + 5, \\\"Left: %d   \\\", ls->size);\\n        mvprintw(p->pos.y, p->pos.x, \\\"\\\");\\n    }\",\"caption\":\"\"}],[\"code\",{\"code\":\"void Player::init(LettersSet *ls) {\\n    pos.x = 2 + 7;\\n    pos.y = 1 + 7;\\n    for (char &letter: letters) {\\n        letter = ls->getRandomLetter();\\n    }\\n    mvprintw(pos.y, pos.x, \\\"\\\");\\n    Map::showUserName(this);\\n    Map::showUserPosition(this);\\n    Map::showUserDirection(this);\\n    Map::showUserLetters(this);\\n    Map::showLeftLetters(this, ls);\\n}\"}],[\"code\",{\"code\":\"if(c >= 97 && c <= 122) {\\n            mvprintw(pos.y, pos.x, \\\"%c\\\", c);\\n            if(direction == 'R') {\\n                pos.x++;\\n            } else {\\n                pos.y++;\\n            }\\n        }\"}],[\"code\",{\"code\":\"    static void init() {\\n        srand(time(nullptr));\\n\\n        auto *ls = new LettersSet();\\n\\n        Map::init();\\n\\n        auto *p1 = new Player(\\\"Player 1\\\");\\n        p1->init(ls);\\n\\n        p1->setPosition();\\n    }\"}],[\"bookmark\",{\"type\":\"bookmark\",\"url\":\"https://github.com/gustawdaniel/scrabble-cpp-game/commit/23cf4b2fd8ae84e6d01bb71e805ed21edc656513\",\"metadata\":{\"url\":\"https://github.com/gustawdaniel/scrabble-cpp-game/commit/23cf4b2fd8ae84e6d01bb71e805ed21edc656513\",\"title\":\"letters selection and basic writing · gustawdaniel/scrabble-cpp-game@23cf4b2\",\"description\":\"Contribute to gustawdaniel/scrabble-cpp-game development by creating an account on GitHub.\",\"author\":\"gustawdaniel\",\"publisher\":\"GitHub\",\"thumbnail\":\"https://opengraph.githubassets.com/6e5342cff403334fa4d589fcd7d54312830772e0a72d0c56f7950adfe1c141e0/gustawdaniel/scrabble-cpp-game/commit/23cf4b2fd8ae84e6d01bb71e805ed21edc656513\",\"icon\":\"https://github.githubassets.com/favicons/favicon.svg\"}}],[\"image\",{\"src\":\"__GHOST_URL__/content/images/2022/12/2022-12-06_18-39.png\",\"width\":550,\"height\":388}],[\"code\",{\"code\":\"    int lettersSize = 8;\"}],[\"code\",{\"code\":\"    static void showUserLetters(const Player *p) {\\n        mvprintw(3, size + 5, \\\"Lett: \\\");\\n        for (int i = 0; i < 8; i++) {\\n            mvprintw(3, size + 5 + 6 + i, \\\"%c \\\", i < p->lettersSize ? p->letters[i] : ' ');\\n        }\\n        mvprintw(p->pos.y, p->pos.x, \\\"\\\");\\n    }\"}],[\"code\",{\"code\":\"int indexOf(const char *arr, int len, char target) {\\n    int dashIndex = -1;\\n    for (int i = 0; i < len; i++) {\\n        if (arr[i] == target)\\n            return i;\\n        if(arr[i] == '_')\\n            dashIndex = i;\\n    }\\n    if(dashIndex != -1)\\n        return dashIndex;\\n    return -1;\\n}\"}],[\"code\",{\"code\":\"if (c >= 97 && c <= 122) {\\n            int charPos = indexOf(letters, lettersSize, (char) c);\\n            if (charPos != -1) {\\n                mvprintw(pos.y, pos.x, \\\"%c\\\", c);\\n                if (direction == 'R') {\\n                    pos.x++;\\n                } else {\\n                    pos.y++;\\n                }\\n                for (int i = charPos; i < lettersSize; i++)\\n                    letters[i] = letters[i + 1];\\n\\n                lettersSize--;\\n            }\\n        }\"}],[\"code\",{\"code\":\"        Map::showUserLetters(this);\"}],[\"bookmark\",{\"type\":\"bookmark\",\"url\":\"https://github.com/gustawdaniel/scrabble-cpp-game/commit/f3bc5616d10e56dc3a281059b5bc1a2e8c263269\",\"metadata\":{\"url\":\"https://github.com/gustawdaniel/scrabble-cpp-game/commit/f3bc5616d10e56dc3a281059b5bc1a2e8c263269\",\"title\":\"writing with letters belonging to user · gustawdaniel/scrabble-cpp-game@f3bc561\",\"description\":\"Contribute to gustawdaniel/scrabble-cpp-game development by creating an account on GitHub.\",\"author\":\"gustawdaniel\",\"publisher\":\"GitHub\",\"thumbnail\":\"https://opengraph.githubassets.com/8274655d227c3ea8e834e2cbd4efff253f9280b5f4ad786ba6b145ac75e23989/gustawdaniel/scrabble-cpp-game/commit/f3bc5616d10e56dc3a281059b5bc1a2e8c263269\",\"icon\":\"https://github.githubassets.com/favicons/favicon.svg\"}}],[\"bookmark\",{\"type\":\"bookmark\",\"url\":\"https://github.com/gustawdaniel/scrabble-cpp-game/commit/9b6d5fe9263a1ad95352a4cae1770e4d2343e466\",\"metadata\":{\"url\":\"https://github.com/gustawdaniel/scrabble-cpp-game/commit/9b6d5fe9263a1ad95352a4cae1770e4d2343e466\",\"title\":\"added two players handling · gustawdaniel/scrabble-cpp-game@9b6d5fe\",\"description\":\"Contribute to gustawdaniel/scrabble-cpp-game development by creating an account on GitHub.\",\"author\":\"gustawdaniel\",\"publisher\":\"GitHub\",\"thumbnail\":\"https://opengraph.githubassets.com/2531fa42b40ddf6a15f967b751cda181a9b230060731da74063bd230177ecc49/gustawdaniel/scrabble-cpp-game/commit/9b6d5fe9263a1ad95352a4cae1770e4d2343e466\",\"icon\":\"https://github.githubassets.com/favicons/favicon.svg\"}}],[\"bookmark\",{\"type\":\"bookmark\",\"url\":\"https://github.com/gustawdaniel/scrabble-cpp-game/commit/803648fcbcb8c23741358d3196008f720ff0ab3d\",\"metadata\":{\"url\":\"https://github.com/gustawdaniel/scrabble-cpp-game/commit/803648fcbcb8c23741358d3196008f720ff0ab3d\",\"title\":\"adding letters from set after turn · gustawdaniel/scrabble-cpp-game@803648f\",\"description\":\"Contribute to gustawdaniel/scrabble-cpp-game development by creating an account on GitHub.\",\"author\":\"gustawdaniel\",\"publisher\":\"GitHub\",\"thumbnail\":\"https://opengraph.githubassets.com/40385e482c8b7c84210dbca15e8401265992e88993a7b73bd40a608e09d25d57/gustawdaniel/scrabble-cpp-game/commit/803648fcbcb8c23741358d3196008f720ff0ab3d\",\"icon\":\"https://github.githubassets.com/favicons/favicon.svg\"}}]],\"markups\":[[\"code\"]],\"sections\":[[1,\"p\",[]],[1,\"h2\",[[0,[],0,\"Board generation\"]]],[1,\"p\",[[0,[],0,\"As many games \"],[0,[0],1,\"scrabble\"],[0,[],0,\" is played on the board. \"]]],[10,0],[1,\"p\",[[0,[],0,\"In our case we want to play in terminal so it will looks like this:\"]]],[10,1],[1,\"p\",[[0,[],0,\"To draw it we need only 33 lines of \"],[0,[0],1,\"c++\"],[0,[],0,\" code. In \"],[0,[0],1,\"main.cpp\"],[0,[],0,\" we defining \"],[0,[0],1,\"Game\"],[0,[],0,\" and \"],[0,[0],1,\"Map\"],[0,[],0,\" structures. Using \"],[0,[0],1,\"mvprintw\"],[0,[],0,\" function from \"],[0,[0],1,\"ncurses\"],[0,[],0,\" we can print all coordinates around map.\"]]],[10,2],[1,\"p\",[[0,[],0,\"So initially our game is initialised. Then Map is initialised, all coordinates are printed and in function that will end game there is \"],[0,[0],1,\"getch\"],[0,[],0,\" that wait for characted from keyboard.\"]]],[1,\"p\",[[0,[],0,\"To compile and run you can write\"]]],[10,3],[1,\"p\",[[0,[],0,\"with \"],[0,[0],1,\"Makefile\"]]],[10,4],[1,\"h2\",[[0,[],0,\"Cursor positioning\"]]],[1,\"p\",[[0,[],0,\"Now we have to allow for user to decide where he will type word. To do this we will show cursor on position \"],[0,[0],1,\"A1\"],[0,[],0,\" and allow for changing them using arrows. \"]]],[1,\"p\",[[0,[],0,\"But there are some problems:\"]]],[3,\"ol\",[[[0,[],0,\"We do not want to print arrows on screen. So we will use\"]]]],[10,5],[1,\"p\",[[0,[],0,\"from \"],[0,[0],1,\"ncurses\"],[0,[],0,\".\"]]],[1,\"p\",[[0,[],0,\"2. We want to intercept special keys like arrows. So we have to set modifier\"]]],[10,6],[1,\"p\",[[0,[],0,\"Position of cursor is assigned to user in our game so we created additiona structures:\"]]],[10,7],[1,\"p\",[[0,[],0,\"user will have \"],[0,[0],1,\"init\"],[0,[],0,\" method to set his cursor on \"],[0,[0],1,\"A1\"]]],[10,8],[1,\"p\",[[0,[],0,\"and \"],[0,[0],1,\"setPosition\"],[0,[],0,\" to allow to decide which position should be used as start of first word: \"]]],[10,9],[1,\"p\",[[0,[],0,\"In this loop we supporting all arrows. Currently do not worry about bounds of board.\"]]],[1,\"p\",[[0,[],0,\"All changes from previous step can be found in commit:\"]]],[10,10],[1,\"h2\",[[0,[],0,\"Writing direction\"]]],[1,\"p\",[[0,[],0,\"Now we have to decide in which direction we will write our sentence. Unfortunately \"],[0,[0],1,\"ncurses\"],[0,[],0,\" do not support special keys properly and I do not want to hack it. So I decided to support the following controll convention:\"]]],[1,\"p\",[[0,[],0,\"User can use arrows to select position of initial letter. But if he changing direction from \"],[0,[0],1,\"down\"],[0,[],0,\" to \"],[0,[0],1,\"right\"],[0,[],0,\" of inversely, then changing direction has hgher priority but can be done also only by arrows.\"]]],[1,\"p\",[[0,[],0,\"It would be confusing if user would not be able to see feedback. So in this step I added right panel with basic info about current position and direction. \"]]],[10,11],[1,\"p\",[[0,[],0,\"Because \"],[0,[0],1,\"Map\"],[0,[],0,\" uses \"],[0,[0],1,\"Player\"],[0,[],0,\" and \"],[0,[0],1,\"Player\"],[0,[],0,\" uses \"],[0,[0],1,\"Map\"],[0,[],0,\" I splited declarations from definitions of some methods in \"],[0,[0],1,\"Player\"],[0,[],0,\".\"]]],[1,\"p\",[[0,[],0,\"All changes are available here:\"]]],[10,12],[1,\"p\",[[0,[],0,\"But the most important are these:\"]]],[1,\"p\",[[0,[],0,\"In \"],[0,[0],1,\"Map\"],[0,[],0,\" there is function that gets letter for given position\"]]],[10,13],[1,\"p\",[[0,[],0,\"This function is used in other methods in \"],[0,[0],1,\"Map\"],[0,[],0,\" that allows to print right panel with informations about user's name, position and direction of writing.\"]]],[10,14],[1,\"p\",[[0,[],0,\"Init function in \"],[0,[0],1,\"Player\"],[0,[],0,\" is moved out of \"],[0,[0],1,\"Player\"],[0,[],0,\" struct definition and uses \"],[0,[0],1,\"Map\"],[0,[],0,\" functions mentioned above to display right panel.\"]]],[10,15],[1,\"p\",[[0,[],0,\"Finally in \"],[0,[0],1,\"setPosition\"],[0,[],0,\" we handling change of direction and updating position and direction after any change.\"]]],[10,16],[1,\"p\",[[0,[],0,\"Player has constructor with name and \"],[0,[0],1,\"Right\"],[0,[],0,\" direction as default\"]]],[10,17],[1,\"p\",[[0,[],0,\"Game now create new Player with name.\"]]],[10,18],[1,\"p\",[[0,[],0,\"Our next challenge will be writing words.\"]]],[1,\"h2\",[[0,[],0,\"Writing words\"]]],[1,\"p\",[[0,[],0,\"To write words we have to split game on phases. First phase was selection of position and direction. Second will be writing words, last one will be checking answers and changing player. Now we will focus on \\\"writing words\\\" phase. Because of positioning can be done only by arrows it is enough to write one letter to change phase to writing. Confirmation will be done by \"],[0,[0],1,\"Enter\"],[0,[],0,\".\"]]],[1,\"p\",[[0,[],0,\"To write words user have to possess set of letters. So before writing words we will implement also letters assignment.\"]]],[1,\"p\",[[0,[],0,\"We can't select them randomly with equal probability for any letters. Instead we will use probabilities assigned to language. In our example it will be english. Rules are described here:\"]]],[10,19],[1,\"p\",[[0,[],0,\"To support random number we adding\"]]],[10,20],[1,\"p\",[[0,[],0,\"that allows to set seed basing on time.\"]]],[1,\"p\",[[0,[],0,\"Set with letters can be represented by struct \"],[0,[0],1,\"LettersSet\"]]],[10,21],[1,\"p\",[[0,[],0,\"Here is applied technique of removing element by move of elements and decrement of integer with size. Real size of array with letters is constant and memory is not freed when we selecting letter. We applying convention when no available letters are marked by \"],[0,[0],1,\"#\"],[0,[],0,\".\"]]],[1,\"p\",[[0,[],0,\"So now any user has his own letters\"]]],[10,22],[1,\"p\",[[0,[],0,\"and \"],[0,[0],1,\"LettersSet\"],[0,[],0,\" is passed to \"],[0,[0],1,\"init\"],[0,[],0,\" function on \"],[0,[0],1,\"Player\"],[0,[],0,\".\"]]],[10,23],[1,\"p\",[[0,[],0,\"Our \"],[0,[0],1,\"Map\"],[0,[],0,\" structure can be extended and gain two additional functions\"]]],[10,24],[1,\"p\",[[0,[],0,\"that can be used in \"],[0,[0],1,\"Player::init\"]]],[10,25],[1,\"p\",[[0,[],0,\"From now we have info about available letters on the right on panel.\"]]],[1,\"p\",[[0,[],0,\"To write letters we can add\"]]],[10,26],[1,\"p\",[[0,[],0,\"to \"],[0,[0],1,\"Player::setPosition\"],[0,[],0,\". Numbers 97 and 122 are bounds of small letters alphabed i ASCI.\"]]],[1,\"p\",[[0,[],0,\"To use random generator correctly we have to add \"],[0,[0],1,\"srand\"],[0,[],0,\", for example in \"],[0,[0],1,\"Game::init\"],[0,[],0,\".\"]]],[10,27],[1,\"p\",[[0,[],0,\"details in commit:\"]]],[10,28],[1,\"p\",[[0,[],0,\"Now you can write words on board, but they do not use sets generated for users.\"]]],[10,29],[1,\"p\",[[0,[],0,\"It is time to join these elements. So now we want to:\"]]],[3,\"ul\",[[[0,[],0,\"allow for writing only by letters in users sets\"]],[[0,[],0,\"remove letters from sets after usage\"]]]],[1,\"p\",[[0,[],0,\"in \"],[0,[0],1,\"Player\"],[0,[],0,\" we can add size of letters array. Thanks to this we will be able remove letters from array (without acutal changing array length).\"]]],[10,30],[1,\"p\",[[0,[],0,\"our function to show letters can be improved and print letters one by one.\"]]],[10,31],[1,\"p\",[[0,[],0,\"We need function that will check if letter can be used. It will return index of this letter in players \"],[0,[0],1,\"letters\"],[0,[],0,\" array or \"],[0,[0],1,\"-1\"],[0,[],0,\" if letter is unavailable.\"]]],[10,32],[1,\"p\",[[0,[],0,\"special feature of this function in treating \"],[0,[0],1,\"_\"],[0,[],0,\" as any other characted but only if all other options was checked before.\"]]],[1,\"p\",[[0,[],0,\"Improved version of typing can be written as\"]]],[10,33],[1,\"p\",[[0,[],0,\"So here we writing only if user posses selected letter or potentially \"],[0,[0],1,\"_\"],[0,[],0,\". We also removing this letter from his set.\"]]],[1,\"p\",[[0,[],0,\"In \"],[0,[0],1,\"setPosition\"],[0,[],0,\" function we can add update of available letters list after any typed character.\"]]],[10,34],[10,35],[1,\"p\",[[0,[],0,\"After some small cleanup in commits:\"]]],[10,36],[1,\"p\",[[0,[],0,\"and\"]]],[10,37],[1,\"p\",[[0,[],0,\"it is time to check if our words are correct.\"]]],[1,\"h2\",[[0,[],0,\"Words checking\"]]],[1,\"p\",[[0,[],0,\"But there are two problems:\"]]],[3,\"ul\",[[[0,[],0,\"where is our source of true, are we going to download dictonary or use http to check answer\"]],[[0,[],0,\"where words starts and ends\"]]]],[1,\"p\",[[0,[],0,\"Not counting first word, any other will have some letters from other words, so we have to detect bounds of words and move cursor if we meet other letters on our road. Additionally we should ensure that written letters are not mutable.\"]]],[1,\"p\",[]],[1,\"p\",[]],[1,\"h2\",[[0,[],0,\"Words erasing\"]]],[1,\"p\",[]],[1,\"h2\",[[0,[],0,\"Player change\"]]],[1,\"p\",[]],[1,\"h2\",[[0,[],0,\"Points multipliers\"]]],[1,\"p\",[]],[1,\"h2\",[[0,[],0,\"Win/loose conditions\"]]]],\"ghostVersion\":\"4.0\"}","html":"<p></p><h2 id=\"board-generation\">Board generation</h2><p>As many games <code>scrabble</code> is played on the board. </p><figure class=\"kg-card kg-image-card\"><img src=\"__GHOST_URL__/content/images/2022/12/1024px-Blank_Scrabble_board_with_coordinates.svg.png\" class=\"kg-image\" alt loading=\"lazy\" width=\"1024\" height=\"985\" srcset=\"__GHOST_URL__/content/images/size/w600/2022/12/1024px-Blank_Scrabble_board_with_coordinates.svg.png 600w, __GHOST_URL__/content/images/size/w1000/2022/12/1024px-Blank_Scrabble_board_with_coordinates.svg.png 1000w, __GHOST_URL__/content/images/2022/12/1024px-Blank_Scrabble_board_with_coordinates.svg.png 1024w\" sizes=\"(min-width: 720px) 720px\"></figure><p>In our case we want to play in terminal so it will looks like this:</p><figure class=\"kg-card kg-image-card\"><img src=\"__GHOST_URL__/content/images/2022/12/2022-12-05_21-09.png\" class=\"kg-image\" alt loading=\"lazy\" width=\"513\" height=\"504\"></figure><p>To draw it we need only 33 lines of <code>c++</code> code. In <code>main.cpp</code> we defining <code>Game</code> and <code>Map</code> structures. Using <code>mvprintw</code> function from <code>ncurses</code> we can print all coordinates around map.</p><pre><code class=\"language-c++\">#include &lt;ncurses.h&gt;\n\nstruct Map {\npublic:\n    int size = 15;\n\n    void init() {\n        initscr();\n        // printing letters from A to O\n        for (int i = 2; i &lt; size + 2; i++) {\n            const char c[] = {static_cast&lt;char&gt;(65 + i - 2), '\\0'};\n            mvprintw(0, i, \"%s\", c);\n            mvprintw(size + 1, i, \"%s\", c);\n        }\n        // printing numbers from 1 to 15\n        for (int i = 1; i &lt; size + 1; i++) {\n            mvprintw(i, 0, \"%2d\", i);\n            mvprintw(i, 0 + size + 2, \"%d\", i);\n        }\n    }\n};\n\nstruct Game {\n    void init() {\n        Map *map = new Map();\n        map-&gt;init();\n    }\n\n    int end() {\n        getch();\n        endwin();\n        return 0;\n    }\n};\n\n\nint main() {\n    Game *g = new Game();\n    g-&gt;init();\n    return g-&gt;end();\n}</code></pre><p>So initially our game is initialised. Then Map is initialised, all coordinates are printed and in function that will end game there is <code>getch</code> that wait for characted from keyboard.</p><p>To compile and run you can write</p><pre><code>make run</code></pre><p>with <code>Makefile</code></p><pre><code>build:\n\tg++ -lncursesw -o main main.cpp\n\nrun: build\n\t./main</code></pre><h2 id=\"cursor-positioning\">Cursor positioning</h2><p>Now we have to allow for user to decide where he will type word. To do this we will show cursor on position <code>A1</code> and allow for changing them using arrows. </p><p>But there are some problems:</p><ol><li>We do not want to print arrows on screen. So we will use</li></ol><pre><code>noecho();</code></pre><p>from <code>ncurses</code>.</p><p>2. We want to intercept special keys like arrows. So we have to set modifier</p><pre><code>keypad(stdscr, TRUE);</code></pre><p>Position of cursor is assigned to user in our game so we created additiona structures:</p><pre><code class=\"language-c++\">struct Pos {\n    int x;\n    int y;\n};\n\nstruct Player {\n    Pos pos;\n}</code></pre><p>user will have <code>init</code> method to set his cursor on <code>A1</code></p><pre><code>    void init() {\n        pos.x = 2;\n        pos.y = 1;\n        mvprintw(pos.y, pos.x, \"\");\n    }</code></pre><p>and <code>setPosition</code> to allow to decide which position should be used as start of first word: </p><pre><code>    void setPosition() {\n        while (int c = getch()) {\n            switch (c) {\n                case KEY_LEFT: {\n                    pos.x--;\n                    break;\n                }\n                case KEY_RIGHT: {\n                    pos.x++;\n                    break;\n                }\n                case KEY_UP: {\n                    pos.y--;\n                    break;\n                }\n                case KEY_DOWN: {\n                    pos.y++;\n                    break;\n                }\n                default: {}\n            }\n            mvprintw(pos.y, pos.x, \"\");\n        }\n    }</code></pre><p>In this loop we supporting all arrows. Currently do not worry about bounds of board.</p><p>All changes from previous step can be found in commit:</p><figure class=\"kg-card kg-bookmark-card\"><a class=\"kg-bookmark-container\" href=\"https://github.com/gustawdaniel/scrabble-cpp-game/commit/7a8c64dcf43462a81511cb7a36888e16559fd9d4\"><div class=\"kg-bookmark-content\"><div class=\"kg-bookmark-title\">added positions selection · gustawdaniel/scrabble-cpp-game@7a8c64d</div><div class=\"kg-bookmark-description\">Contribute to gustawdaniel/scrabble-cpp-game development by creating an account on GitHub.</div><div class=\"kg-bookmark-metadata\"><img class=\"kg-bookmark-icon\" src=\"https://github.githubassets.com/favicons/favicon.svg\"><span class=\"kg-bookmark-author\">GitHub</span><span class=\"kg-bookmark-publisher\">gustawdaniel</span></div></div><div class=\"kg-bookmark-thumbnail\"><img src=\"https://opengraph.githubassets.com/3d7f31640b4135d1e2dc4ab09bf7d6c66804697953574998f1cf9dfc200f799e/gustawdaniel/scrabble-cpp-game/commit/7a8c64dcf43462a81511cb7a36888e16559fd9d4\"></div></a></figure><h2 id=\"writing-direction\">Writing direction</h2><p>Now we have to decide in which direction we will write our sentence. Unfortunately <code>ncurses</code> do not support special keys properly and I do not want to hack it. So I decided to support the following controll convention:</p><p>User can use arrows to select position of initial letter. But if he changing direction from <code>down</code> to <code>right</code> of inversely, then changing direction has hgher priority but can be done also only by arrows.</p><p>It would be confusing if user would not be able to see feedback. So in this step I added right panel with basic info about current position and direction. </p><figure class=\"kg-card kg-image-card\"><img src=\"__GHOST_URL__/content/images/2022/12/2022-12-05_23-51.png\" class=\"kg-image\" alt loading=\"lazy\" width=\"958\" height=\"517\" srcset=\"__GHOST_URL__/content/images/size/w600/2022/12/2022-12-05_23-51.png 600w, __GHOST_URL__/content/images/2022/12/2022-12-05_23-51.png 958w\" sizes=\"(min-width: 720px) 720px\"></figure><p>Because <code>Map</code> uses <code>Player</code> and <code>Player</code> uses <code>Map</code> I splited declarations from definitions of some methods in <code>Player</code>.</p><p>All changes are available here:</p><figure class=\"kg-card kg-bookmark-card\"><a class=\"kg-bookmark-container\" href=\"https://github.com/gustawdaniel/scrabble-cpp-game/commit/e588a0c5feeed51cb325f347c849f2576241ddd4\"><div class=\"kg-bookmark-content\"><div class=\"kg-bookmark-title\">direction possible to select · gustawdaniel/scrabble-cpp-game@e588a0c</div><div class=\"kg-bookmark-description\">Contribute to gustawdaniel/scrabble-cpp-game development by creating an account on GitHub.</div><div class=\"kg-bookmark-metadata\"><img class=\"kg-bookmark-icon\" src=\"https://github.githubassets.com/favicons/favicon.svg\"><span class=\"kg-bookmark-author\">GitHub</span><span class=\"kg-bookmark-publisher\">gustawdaniel</span></div></div><div class=\"kg-bookmark-thumbnail\"><img src=\"https://opengraph.githubassets.com/937172a67972e75c3ebed38c9cca17478dc0811b25a3e0526ba06412b3e042c2/gustawdaniel/scrabble-cpp-game/commit/e588a0c5feeed51cb325f347c849f2576241ddd4\"></div></a></figure><p>But the most important are these:</p><p>In <code>Map</code> there is function that gets letter for given position</p><pre><code class=\"language-c++\">    static char get_letter(int from_a) {\n        return static_cast&lt;char&gt;(65 + from_a - 2);\n    }</code></pre><p>This function is used in other methods in <code>Map</code> that allows to print right panel with informations about user's name, position and direction of writing.</p><pre><code class=\"language-c++\">    static void showUserName(const Player *p) {\n        mvprintw(0, size + 5, \"Name: %s\", p-&gt;name.c_str());\n        mvprintw(p-&gt;pos.y, p-&gt;pos.x, \"\");\n    }\n\n    static void showUserPosition(const Player *p) {\n        const char x[] = {get_letter(p-&gt;pos.x)};\n        mvprintw(1, size + 5, \"Pos : %s%d \", x, p-&gt;pos.y);\n        mvprintw(p-&gt;pos.y, p-&gt;pos.x, \"\");\n    }\n\n    static void showUserDirection(const Player *p) {\n        mvprintw(2, size + 5, \"Dir : %s \", p-&gt;direction == 'R' ? \"Right\" : \"Down\");\n        mvprintw(p-&gt;pos.y, p-&gt;pos.x, \"\");\n    }</code></pre><p>Init function in <code>Player</code> is moved out of <code>Player</code> struct definition and uses <code>Map</code> functions mentioned above to display right panel.</p><pre><code class=\"language-c++\">void Player::init() {\n    pos.x = 2 + 7;\n    pos.y = 1 + 7;\n    mvprintw(pos.y, pos.x, \"\");\n    Map::showUserName(this);\n    Map::showUserPosition(this);\n    Map::showUserDirection(this);\n}</code></pre><p>Finally in <code>setPosition</code> we handling change of direction and updating position and direction after any change.</p><pre><code class=\"language-c++\">void Player::setPosition() {\n    while (int c = getch()) {\n        switch (c) {\n            case KEY_LEFT: {\n                pos.x--;\n                break;\n            }\n            case KEY_RIGHT: {\n                if (direction == 'R') {\n                    pos.x++;\n                } else {\n                    direction = 'R';\n                }\n                break;\n            }\n            case KEY_UP: {\n                pos.y--;\n                break;\n            }\n            case KEY_DOWN: {\n                if (direction == 'D') {\n                    pos.y++;\n                } else {\n                    direction = 'D';\n                }\n                break;\n            }\n            default: {\n            }\n        }\n        Map::showUserPosition(this);\n        Map::showUserDirection(this);\n        mvprintw(pos.y, pos.x, \"\");\n    }\n}</code></pre><p>Player has constructor with name and <code>Right</code> direction as default</p><pre><code class=\"language-c++\">struct Player {\npublic:\n    std::string name;\n    Pos pos{};\n    char direction = 'R';\n\n    explicit Player(std::string init_name) {\n        name = std::move(init_name);\n    }\n\n    void init();\n\n    void setPosition();\n};</code></pre><p>Game now create new Player with name.</p><pre><code>struct Game {\n    static void init() {\n        Map::init();\n\n        auto *p1 = new Player(\"Player 1\");\n        p1-&gt;init();\n\n        p1-&gt;setPosition();\n    }\n\n    static int end() {\n        getch();\n        endwin();\n        return 0;\n    }\n};</code></pre><p>Our next challenge will be writing words.</p><h2 id=\"writing-words\">Writing words</h2><p>To write words we have to split game on phases. First phase was selection of position and direction. Second will be writing words, last one will be checking answers and changing player. Now we will focus on \"writing words\" phase. Because of positioning can be done only by arrows it is enough to write one letter to change phase to writing. Confirmation will be done by <code>Enter</code>.</p><p>To write words user have to possess set of letters. So before writing words we will implement also letters assignment.</p><p>We can't select them randomly with equal probability for any letters. Instead we will use probabilities assigned to language. In our example it will be english. Rules are described here:</p><figure class=\"kg-card kg-bookmark-card\"><a class=\"kg-bookmark-container\" href=\"https://en.wikipedia.org/wiki/Scrabble_letter_distributions#English\"><div class=\"kg-bookmark-content\"><div class=\"kg-bookmark-title\">Scrabble letter distributions - Wikipedia</div><div class=\"kg-bookmark-description\"></div><div class=\"kg-bookmark-metadata\"><img class=\"kg-bookmark-icon\" src=\"https://en.wikipedia.org/static/apple-touch/wikipedia.png\"><span class=\"kg-bookmark-author\">Wikimedia Foundation, Inc.</span><span class=\"kg-bookmark-publisher\">Contributors to Wikimedia projects</span></div></div><div class=\"kg-bookmark-thumbnail\"><img src=\"https://upload.wikimedia.org/wikipedia/commons/b/b8/Scrabble_tiles_en.jpg\"></div></a></figure><p>To support random number we adding</p><pre><code>#include &lt;ctime&gt;</code></pre><p>that allows to set seed basing on time.</p><p>Set with letters can be represented by struct <code>LettersSet</code></p><pre><code>struct LettersSet {\n    int size = 100;\n\n    char letters[100] = {\n            'k',\n            'j',\n            'x',\n            'q',\n            'z',\n            'b', 'b',\n            'c', 'c',\n            'm', 'm',\n            'p', 'p',\n            'f', 'f',\n            'h', 'h',\n            'v', 'v',\n            'w', 'w',\n            'y', 'y',\n            'g', 'g', 'g',\n            'l', 'l', 'l', 'l',\n            's', 's', 's', 's',\n            'u', 'u', 'u', 'u',\n            'd', 'd', 'd', 'd',\n            'n', 'n', 'n', 'n', 'n', 'n',\n            'r', 'r', 'r', 'r', 'r', 'r',\n            't', 't', 't', 't', 't', 't',\n            'o', 'o', 'o', 'o', 'o', 'o', 'o', 'o',\n            'a', 'a', 'a', 'a', 'a', 'a', 'a', 'a', 'a',\n            'i', 'i', 'i', 'i', 'i', 'i', 'i', 'i', 'i',\n            'e', 'e', 'e', 'e', 'e', 'e', 'e', 'e', 'e', 'e', 'e', 'e',\n            '_', '_'\n    };\n\n    char getRandomLetter() {\n        if(!size) return '#';\n        int index = rand() % size;\n        char c = letters[index];\n\n        for(int i=index; i&lt;size; i++)\n            letters[i] = letters[i + 1];\n\n        size--;\n\n        return c;\n    }\n};</code></pre><p>Here is applied technique of removing element by move of elements and decrement of integer with size. Real size of array with letters is constant and memory is not freed when we selecting letter. We applying convention when no available letters are marked by <code>#</code>.</p><p>So now any user has his own letters</p><pre><code>    char letters[8];</code></pre><p>and <code>LettersSet</code> is passed to <code>init</code> function on <code>Player</code>.</p><pre><code>    void init(LettersSet *ls);</code></pre><p>Our <code>Map</code> structure can be extended and gain two additional functions</p><pre><code>    static void showUserLetters(const Player *p) {\n        mvprintw(3, size + 5, \"Lett: %s \", p-&gt;letters);\n        mvprintw(p-&gt;pos.y, p-&gt;pos.x, \"\");\n    }\n\n    static void showLeftLetters(const Player *p, const LettersSet *ls) {\n        mvprintw(4, size + 5, \"Left: %d   \", ls-&gt;size);\n        mvprintw(p-&gt;pos.y, p-&gt;pos.x, \"\");\n    }</code></pre><p>that can be used in <code>Player::init</code></p><pre><code>void Player::init(LettersSet *ls) {\n    pos.x = 2 + 7;\n    pos.y = 1 + 7;\n    for (char &amp;letter: letters) {\n        letter = ls-&gt;getRandomLetter();\n    }\n    mvprintw(pos.y, pos.x, \"\");\n    Map::showUserName(this);\n    Map::showUserPosition(this);\n    Map::showUserDirection(this);\n    Map::showUserLetters(this);\n    Map::showLeftLetters(this, ls);\n}</code></pre><p>From now we have info about available letters on the right on panel.</p><p>To write letters we can add</p><pre><code>if(c &gt;= 97 &amp;&amp; c &lt;= 122) {\n            mvprintw(pos.y, pos.x, \"%c\", c);\n            if(direction == 'R') {\n                pos.x++;\n            } else {\n                pos.y++;\n            }\n        }</code></pre><p>to <code>Player::setPosition</code>. Numbers 97 and 122 are bounds of small letters alphabed i ASCI.</p><p>To use random generator correctly we have to add <code>srand</code>, for example in <code>Game::init</code>.</p><pre><code>    static void init() {\n        srand(time(nullptr));\n\n        auto *ls = new LettersSet();\n\n        Map::init();\n\n        auto *p1 = new Player(\"Player 1\");\n        p1-&gt;init(ls);\n\n        p1-&gt;setPosition();\n    }</code></pre><p>details in commit:</p><figure class=\"kg-card kg-bookmark-card\"><a class=\"kg-bookmark-container\" href=\"https://github.com/gustawdaniel/scrabble-cpp-game/commit/23cf4b2fd8ae84e6d01bb71e805ed21edc656513\"><div class=\"kg-bookmark-content\"><div class=\"kg-bookmark-title\">letters selection and basic writing · gustawdaniel/scrabble-cpp-game@23cf4b2</div><div class=\"kg-bookmark-description\">Contribute to gustawdaniel/scrabble-cpp-game development by creating an account on GitHub.</div><div class=\"kg-bookmark-metadata\"><img class=\"kg-bookmark-icon\" src=\"https://github.githubassets.com/favicons/favicon.svg\"><span class=\"kg-bookmark-author\">GitHub</span><span class=\"kg-bookmark-publisher\">gustawdaniel</span></div></div><div class=\"kg-bookmark-thumbnail\"><img src=\"https://opengraph.githubassets.com/6e5342cff403334fa4d589fcd7d54312830772e0a72d0c56f7950adfe1c141e0/gustawdaniel/scrabble-cpp-game/commit/23cf4b2fd8ae84e6d01bb71e805ed21edc656513\"></div></a></figure><p>Now you can write words on board, but they do not use sets generated for users.</p><figure class=\"kg-card kg-image-card\"><img src=\"__GHOST_URL__/content/images/2022/12/2022-12-06_18-39.png\" class=\"kg-image\" alt loading=\"lazy\" width=\"550\" height=\"388\"></figure><p>It is time to join these elements. So now we want to:</p><ul><li>allow for writing only by letters in users sets</li><li>remove letters from sets after usage</li></ul><p>in <code>Player</code> we can add size of letters array. Thanks to this we will be able remove letters from array (without acutal changing array length).</p><pre><code>    int lettersSize = 8;</code></pre><p>our function to show letters can be improved and print letters one by one.</p><pre><code>    static void showUserLetters(const Player *p) {\n        mvprintw(3, size + 5, \"Lett: \");\n        for (int i = 0; i &lt; 8; i++) {\n            mvprintw(3, size + 5 + 6 + i, \"%c \", i &lt; p-&gt;lettersSize ? p-&gt;letters[i] : ' ');\n        }\n        mvprintw(p-&gt;pos.y, p-&gt;pos.x, \"\");\n    }</code></pre><p>We need function that will check if letter can be used. It will return index of this letter in players <code>letters</code> array or <code>-1</code> if letter is unavailable.</p><pre><code>int indexOf(const char *arr, int len, char target) {\n    int dashIndex = -1;\n    for (int i = 0; i &lt; len; i++) {\n        if (arr[i] == target)\n            return i;\n        if(arr[i] == '_')\n            dashIndex = i;\n    }\n    if(dashIndex != -1)\n        return dashIndex;\n    return -1;\n}</code></pre><p>special feature of this function in treating <code>_</code> as any other characted but only if all other options was checked before.</p><p>Improved version of typing can be written as</p><pre><code>if (c &gt;= 97 &amp;&amp; c &lt;= 122) {\n            int charPos = indexOf(letters, lettersSize, (char) c);\n            if (charPos != -1) {\n                mvprintw(pos.y, pos.x, \"%c\", c);\n                if (direction == 'R') {\n                    pos.x++;\n                } else {\n                    pos.y++;\n                }\n                for (int i = charPos; i &lt; lettersSize; i++)\n                    letters[i] = letters[i + 1];\n\n                lettersSize--;\n            }\n        }</code></pre><p>So here we writing only if user posses selected letter or potentially <code>_</code>. We also removing this letter from his set.</p><p>In <code>setPosition</code> function we can add update of available letters list after any typed character.</p><pre><code>        Map::showUserLetters(this);</code></pre><figure class=\"kg-card kg-bookmark-card\"><a class=\"kg-bookmark-container\" href=\"https://github.com/gustawdaniel/scrabble-cpp-game/commit/f3bc5616d10e56dc3a281059b5bc1a2e8c263269\"><div class=\"kg-bookmark-content\"><div class=\"kg-bookmark-title\">writing with letters belonging to user · gustawdaniel/scrabble-cpp-game@f3bc561</div><div class=\"kg-bookmark-description\">Contribute to gustawdaniel/scrabble-cpp-game development by creating an account on GitHub.</div><div class=\"kg-bookmark-metadata\"><img class=\"kg-bookmark-icon\" src=\"https://github.githubassets.com/favicons/favicon.svg\"><span class=\"kg-bookmark-author\">GitHub</span><span class=\"kg-bookmark-publisher\">gustawdaniel</span></div></div><div class=\"kg-bookmark-thumbnail\"><img src=\"https://opengraph.githubassets.com/8274655d227c3ea8e834e2cbd4efff253f9280b5f4ad786ba6b145ac75e23989/gustawdaniel/scrabble-cpp-game/commit/f3bc5616d10e56dc3a281059b5bc1a2e8c263269\"></div></a></figure><p>After some small cleanup in commits:</p><figure class=\"kg-card kg-bookmark-card\"><a class=\"kg-bookmark-container\" href=\"https://github.com/gustawdaniel/scrabble-cpp-game/commit/9b6d5fe9263a1ad95352a4cae1770e4d2343e466\"><div class=\"kg-bookmark-content\"><div class=\"kg-bookmark-title\">added two players handling · gustawdaniel/scrabble-cpp-game@9b6d5fe</div><div class=\"kg-bookmark-description\">Contribute to gustawdaniel/scrabble-cpp-game development by creating an account on GitHub.</div><div class=\"kg-bookmark-metadata\"><img class=\"kg-bookmark-icon\" src=\"https://github.githubassets.com/favicons/favicon.svg\"><span class=\"kg-bookmark-author\">GitHub</span><span class=\"kg-bookmark-publisher\">gustawdaniel</span></div></div><div class=\"kg-bookmark-thumbnail\"><img src=\"https://opengraph.githubassets.com/2531fa42b40ddf6a15f967b751cda181a9b230060731da74063bd230177ecc49/gustawdaniel/scrabble-cpp-game/commit/9b6d5fe9263a1ad95352a4cae1770e4d2343e466\"></div></a></figure><p>and</p><figure class=\"kg-card kg-bookmark-card\"><a class=\"kg-bookmark-container\" href=\"https://github.com/gustawdaniel/scrabble-cpp-game/commit/803648fcbcb8c23741358d3196008f720ff0ab3d\"><div class=\"kg-bookmark-content\"><div class=\"kg-bookmark-title\">adding letters from set after turn · gustawdaniel/scrabble-cpp-game@803648f</div><div class=\"kg-bookmark-description\">Contribute to gustawdaniel/scrabble-cpp-game development by creating an account on GitHub.</div><div class=\"kg-bookmark-metadata\"><img class=\"kg-bookmark-icon\" src=\"https://github.githubassets.com/favicons/favicon.svg\"><span class=\"kg-bookmark-author\">GitHub</span><span class=\"kg-bookmark-publisher\">gustawdaniel</span></div></div><div class=\"kg-bookmark-thumbnail\"><img src=\"https://opengraph.githubassets.com/40385e482c8b7c84210dbca15e8401265992e88993a7b73bd40a608e09d25d57/gustawdaniel/scrabble-cpp-game/commit/803648fcbcb8c23741358d3196008f720ff0ab3d\"></div></a></figure><p>it is time to check if our words are correct.</p><h2 id=\"words-checking\">Words checking</h2><p>But there are two problems:</p><ul><li>where is our source of true, are we going to download dictonary or use http to check answer</li><li>where words starts and ends</li></ul><p>Not counting first word, any other will have some letters from other words, so we have to detect bounds of words and move cursor if we meet other letters on our road. Additionally we should ensure that written letters are not mutable.</p><p></p><p></p><h2 id=\"words-erasing\">Words erasing</h2><p></p><h2 id=\"player-change\">Player change</h2><p></p><h2 id=\"points-multipliers\">Points multipliers</h2><p></p><h2 id=\"winloose-conditions\">Win/loose conditions</h2>","comment_id":"638e0843bbda300a2f29c425","plaintext":"\n\nBoard generation\nAs many games scrabble is played on the board. \n\nIn our case we want to play in terminal so it will looks like this:\n\nTo draw it we need only 33 lines of c++ code. In main.cpp we defining Game and \nMap structures. Using mvprintw function from ncurses we can print all\ncoordinates around map.\n\n#include <ncurses.h>\n\nstruct Map {\npublic:\n    int size = 15;\n\n    void init() {\n        initscr();\n        // printing letters from A to O\n        for (int i = 2; i < size + 2; i++) {\n            const char c[] = {static_cast<char>(65 + i - 2), '\\0'};\n            mvprintw(0, i, \"%s\", c);\n            mvprintw(size + 1, i, \"%s\", c);\n        }\n        // printing numbers from 1 to 15\n        for (int i = 1; i < size + 1; i++) {\n            mvprintw(i, 0, \"%2d\", i);\n            mvprintw(i, 0 + size + 2, \"%d\", i);\n        }\n    }\n};\n\nstruct Game {\n    void init() {\n        Map *map = new Map();\n        map->init();\n    }\n\n    int end() {\n        getch();\n        endwin();\n        return 0;\n    }\n};\n\n\nint main() {\n    Game *g = new Game();\n    g->init();\n    return g->end();\n}\n\nSo initially our game is initialised. Then Map is initialised, all coordinates\nare printed and in function that will end game there is getch that wait for\ncharacted from keyboard.\n\nTo compile and run you can write\n\nmake run\n\nwith Makefile\n\nbuild:\n\tg++ -lncursesw -o main main.cpp\n\nrun: build\n\t./main\n\nCursor positioning\nNow we have to allow for user to decide where he will type word. To do this we\nwill show cursor on position A1 and allow for changing them using arrows. \n\nBut there are some problems:\n\n 1. We do not want to print arrows on screen. So we will use\n\nnoecho();\n\nfrom ncurses.\n\n2. We want to intercept special keys like arrows. So we have to set modifier\n\nkeypad(stdscr, TRUE);\n\nPosition of cursor is assigned to user in our game so we created additiona\nstructures:\n\nstruct Pos {\n    int x;\n    int y;\n};\n\nstruct Player {\n    Pos pos;\n}\n\nuser will have init method to set his cursor on A1\n\n    void init() {\n        pos.x = 2;\n        pos.y = 1;\n        mvprintw(pos.y, pos.x, \"\");\n    }\n\nand setPosition to allow to decide which position should be used as start of\nfirst word: \n\n    void setPosition() {\n        while (int c = getch()) {\n            switch (c) {\n                case KEY_LEFT: {\n                    pos.x--;\n                    break;\n                }\n                case KEY_RIGHT: {\n                    pos.x++;\n                    break;\n                }\n                case KEY_UP: {\n                    pos.y--;\n                    break;\n                }\n                case KEY_DOWN: {\n                    pos.y++;\n                    break;\n                }\n                default: {}\n            }\n            mvprintw(pos.y, pos.x, \"\");\n        }\n    }\n\nIn this loop we supporting all arrows. Currently do not worry about bounds of\nboard.\n\nAll changes from previous step can be found in commit:\n\nadded positions selection · gustawdaniel/scrabble-cpp-game@7a8c64dContribute to\ngustawdaniel/scrabble-cpp-game development by creating an account on GitHub.\nGitHubgustawdaniel\n[https://github.com/gustawdaniel/scrabble-cpp-game/commit/7a8c64dcf43462a81511cb7a36888e16559fd9d4]\nWriting direction\nNow we have to decide in which direction we will write our sentence.\nUnfortunately ncurses do not support special keys properly and I do not want to\nhack it. So I decided to support the following controll convention:\n\nUser can use arrows to select position of initial letter. But if he changing\ndirection from down to right of inversely, then changing direction has hgher\npriority but can be done also only by arrows.\n\nIt would be confusing if user would not be able to see feedback. So in this step\nI added right panel with basic info about current position and direction. \n\nBecause Map uses Player and Player uses Map I splited declarations from\ndefinitions of some methods in Player.\n\nAll changes are available here:\n\ndirection possible to select · gustawdaniel/scrabble-cpp-game@e588a0cContribute\nto gustawdaniel/scrabble-cpp-game development by creating an account on GitHub.\nGitHubgustawdaniel\n[https://github.com/gustawdaniel/scrabble-cpp-game/commit/e588a0c5feeed51cb325f347c849f2576241ddd4]\nBut the most important are these:\n\nIn Map there is function that gets letter for given position\n\n    static char get_letter(int from_a) {\n        return static_cast<char>(65 + from_a - 2);\n    }\n\nThis function is used in other methods in Map that allows to print right panel\nwith informations about user's name, position and direction of writing.\n\n    static void showUserName(const Player *p) {\n        mvprintw(0, size + 5, \"Name: %s\", p->name.c_str());\n        mvprintw(p->pos.y, p->pos.x, \"\");\n    }\n\n    static void showUserPosition(const Player *p) {\n        const char x[] = {get_letter(p->pos.x)};\n        mvprintw(1, size + 5, \"Pos : %s%d \", x, p->pos.y);\n        mvprintw(p->pos.y, p->pos.x, \"\");\n    }\n\n    static void showUserDirection(const Player *p) {\n        mvprintw(2, size + 5, \"Dir : %s \", p->direction == 'R' ? \"Right\" : \"Down\");\n        mvprintw(p->pos.y, p->pos.x, \"\");\n    }\n\nInit function in Player is moved out of Player struct definition and uses Map \nfunctions mentioned above to display right panel.\n\nvoid Player::init() {\n    pos.x = 2 + 7;\n    pos.y = 1 + 7;\n    mvprintw(pos.y, pos.x, \"\");\n    Map::showUserName(this);\n    Map::showUserPosition(this);\n    Map::showUserDirection(this);\n}\n\nFinally in setPosition we handling change of direction and updating position and\ndirection after any change.\n\nvoid Player::setPosition() {\n    while (int c = getch()) {\n        switch (c) {\n            case KEY_LEFT: {\n                pos.x--;\n                break;\n            }\n            case KEY_RIGHT: {\n                if (direction == 'R') {\n                    pos.x++;\n                } else {\n                    direction = 'R';\n                }\n                break;\n            }\n            case KEY_UP: {\n                pos.y--;\n                break;\n            }\n            case KEY_DOWN: {\n                if (direction == 'D') {\n                    pos.y++;\n                } else {\n                    direction = 'D';\n                }\n                break;\n            }\n            default: {\n            }\n        }\n        Map::showUserPosition(this);\n        Map::showUserDirection(this);\n        mvprintw(pos.y, pos.x, \"\");\n    }\n}\n\nPlayer has constructor with name and Right direction as default\n\nstruct Player {\npublic:\n    std::string name;\n    Pos pos{};\n    char direction = 'R';\n\n    explicit Player(std::string init_name) {\n        name = std::move(init_name);\n    }\n\n    void init();\n\n    void setPosition();\n};\n\nGame now create new Player with name.\n\nstruct Game {\n    static void init() {\n        Map::init();\n\n        auto *p1 = new Player(\"Player 1\");\n        p1->init();\n\n        p1->setPosition();\n    }\n\n    static int end() {\n        getch();\n        endwin();\n        return 0;\n    }\n};\n\nOur next challenge will be writing words.\n\nWriting words\nTo write words we have to split game on phases. First phase was selection of\nposition and direction. Second will be writing words, last one will be checking\nanswers and changing player. Now we will focus on \"writing words\" phase. Because\nof positioning can be done only by arrows it is enough to write one letter to\nchange phase to writing. Confirmation will be done by Enter.\n\nTo write words user have to possess set of letters. So before writing words we\nwill implement also letters assignment.\n\nWe can't select them randomly with equal probability for any letters. Instead we\nwill use probabilities assigned to language. In our example it will be english.\nRules are described here:\n\nScrabble letter distributions - WikipediaWikimedia Foundation, Inc.Contributors\nto Wikimedia projects\n[https://en.wikipedia.org/wiki/Scrabble_letter_distributions#English]To support\nrandom number we adding\n\n#include <ctime>\n\nthat allows to set seed basing on time.\n\nSet with letters can be represented by struct LettersSet\n\nstruct LettersSet {\n    int size = 100;\n\n    char letters[100] = {\n            'k',\n            'j',\n            'x',\n            'q',\n            'z',\n            'b', 'b',\n            'c', 'c',\n            'm', 'm',\n            'p', 'p',\n            'f', 'f',\n            'h', 'h',\n            'v', 'v',\n            'w', 'w',\n            'y', 'y',\n            'g', 'g', 'g',\n            'l', 'l', 'l', 'l',\n            's', 's', 's', 's',\n            'u', 'u', 'u', 'u',\n            'd', 'd', 'd', 'd',\n            'n', 'n', 'n', 'n', 'n', 'n',\n            'r', 'r', 'r', 'r', 'r', 'r',\n            't', 't', 't', 't', 't', 't',\n            'o', 'o', 'o', 'o', 'o', 'o', 'o', 'o',\n            'a', 'a', 'a', 'a', 'a', 'a', 'a', 'a', 'a',\n            'i', 'i', 'i', 'i', 'i', 'i', 'i', 'i', 'i',\n            'e', 'e', 'e', 'e', 'e', 'e', 'e', 'e', 'e', 'e', 'e', 'e',\n            '_', '_'\n    };\n\n    char getRandomLetter() {\n        if(!size) return '#';\n        int index = rand() % size;\n        char c = letters[index];\n\n        for(int i=index; i<size; i++)\n            letters[i] = letters[i + 1];\n\n        size--;\n\n        return c;\n    }\n};\n\nHere is applied technique of removing element by move of elements and decrement\nof integer with size. Real size of array with letters is constant and memory is\nnot freed when we selecting letter. We applying convention when no available\nletters are marked by #.\n\nSo now any user has his own letters\n\n    char letters[8];\n\nand LettersSet is passed to init function on Player.\n\n    void init(LettersSet *ls);\n\nOur Map structure can be extended and gain two additional functions\n\n    static void showUserLetters(const Player *p) {\n        mvprintw(3, size + 5, \"Lett: %s \", p->letters);\n        mvprintw(p->pos.y, p->pos.x, \"\");\n    }\n\n    static void showLeftLetters(const Player *p, const LettersSet *ls) {\n        mvprintw(4, size + 5, \"Left: %d   \", ls->size);\n        mvprintw(p->pos.y, p->pos.x, \"\");\n    }\n\nthat can be used in Player::init\n\nvoid Player::init(LettersSet *ls) {\n    pos.x = 2 + 7;\n    pos.y = 1 + 7;\n    for (char &letter: letters) {\n        letter = ls->getRandomLetter();\n    }\n    mvprintw(pos.y, pos.x, \"\");\n    Map::showUserName(this);\n    Map::showUserPosition(this);\n    Map::showUserDirection(this);\n    Map::showUserLetters(this);\n    Map::showLeftLetters(this, ls);\n}\n\nFrom now we have info about available letters on the right on panel.\n\nTo write letters we can add\n\nif(c >= 97 && c <= 122) {\n            mvprintw(pos.y, pos.x, \"%c\", c);\n            if(direction == 'R') {\n                pos.x++;\n            } else {\n                pos.y++;\n            }\n        }\n\nto Player::setPosition. Numbers 97 and 122 are bounds of small letters alphabed\ni ASCI.\n\nTo use random generator correctly we have to add srand, for example in \nGame::init.\n\n    static void init() {\n        srand(time(nullptr));\n\n        auto *ls = new LettersSet();\n\n        Map::init();\n\n        auto *p1 = new Player(\"Player 1\");\n        p1->init(ls);\n\n        p1->setPosition();\n    }\n\ndetails in commit:\n\nletters selection and basic writing · gustawdaniel/scrabble-cpp-game@23cf4b2\nContribute to gustawdaniel/scrabble-cpp-game development by creating an account\non GitHub.GitHubgustawdaniel\n[https://github.com/gustawdaniel/scrabble-cpp-game/commit/23cf4b2fd8ae84e6d01bb71e805ed21edc656513]\nNow you can write words on board, but they do not use sets generated for users.\n\nIt is time to join these elements. So now we want to:\n\n * allow for writing only by letters in users sets\n * remove letters from sets after usage\n\nin Player we can add size of letters array. Thanks to this we will be able\nremove letters from array (without acutal changing array length).\n\n    int lettersSize = 8;\n\nour function to show letters can be improved and print letters one by one.\n\n    static void showUserLetters(const Player *p) {\n        mvprintw(3, size + 5, \"Lett: \");\n        for (int i = 0; i < 8; i++) {\n            mvprintw(3, size + 5 + 6 + i, \"%c \", i < p->lettersSize ? p->letters[i] : ' ');\n        }\n        mvprintw(p->pos.y, p->pos.x, \"\");\n    }\n\nWe need function that will check if letter can be used. It will return index of\nthis letter in players letters array or -1 if letter is unavailable.\n\nint indexOf(const char *arr, int len, char target) {\n    int dashIndex = -1;\n    for (int i = 0; i < len; i++) {\n        if (arr[i] == target)\n            return i;\n        if(arr[i] == '_')\n            dashIndex = i;\n    }\n    if(dashIndex != -1)\n        return dashIndex;\n    return -1;\n}\n\nspecial feature of this function in treating _ as any other characted but only\nif all other options was checked before.\n\nImproved version of typing can be written as\n\nif (c >= 97 && c <= 122) {\n            int charPos = indexOf(letters, lettersSize, (char) c);\n            if (charPos != -1) {\n                mvprintw(pos.y, pos.x, \"%c\", c);\n                if (direction == 'R') {\n                    pos.x++;\n                } else {\n                    pos.y++;\n                }\n                for (int i = charPos; i < lettersSize; i++)\n                    letters[i] = letters[i + 1];\n\n                lettersSize--;\n            }\n        }\n\nSo here we writing only if user posses selected letter or potentially _. We also\nremoving this letter from his set.\n\nIn setPosition function we can add update of available letters list after any\ntyped character.\n\n        Map::showUserLetters(this);\n\nwriting with letters belonging to user · gustawdaniel/scrabble-cpp-game@f3bc561\nContribute to gustawdaniel/scrabble-cpp-game development by creating an account\non GitHub.GitHubgustawdaniel\n[https://github.com/gustawdaniel/scrabble-cpp-game/commit/f3bc5616d10e56dc3a281059b5bc1a2e8c263269]\nAfter some small cleanup in commits:\n\nadded two players handling · gustawdaniel/scrabble-cpp-game@9b6d5feContribute\nto\ngustawdaniel/scrabble-cpp-game development by creating an account on GitHub.\nGitHubgustawdaniel\n[https://github.com/gustawdaniel/scrabble-cpp-game/commit/9b6d5fe9263a1ad95352a4cae1770e4d2343e466]\nand\n\nadding letters from set after turn · gustawdaniel/scrabble-cpp-game@803648f\nContribute to gustawdaniel/scrabble-cpp-game development by creating an account\non GitHub.GitHubgustawdaniel\n[https://github.com/gustawdaniel/scrabble-cpp-game/commit/803648fcbcb8c23741358d3196008f720ff0ab3d]\nit is time to check if our words are correct.\n\nWords checking\nBut there are two problems:\n\n * where is our source of true, are we going to download dictonary or use http\n   to check answer\n * where words starts and ends\n\nNot counting first word, any other will have some letters from other words, so\nwe have to detect bounds of words and move cursor if we meet other letters on\nour road. Additionally we should ensure that written letters are not mutable.\n\n\n\n\n\nWords erasing\n\n\nPlayer change\n\n\nPoints multipliers\n\n\nWin/loose conditions","feature_image":null,"featured":0,"type":"post","status":"draft","locale":null,"visibility":"public","email_recipient_filter":"all","created_at":"2022-12-05T15:03:31.000Z","updated_at":"2022-12-06T16:02:47.000Z","published_at":null,"custom_excerpt":null,"codeinjection_head":null,"codeinjection_foot":null,"custom_template":null,"canonical_url":null,"newsletter_id":null,"lexical":null},{"id":"638f7123bbda300a2f29c5b7","uuid":"24fb3b4a-e52f-43d0-8347-b1755b5b2c3b","title":"Performance of SQLite, Redis and Text search in Rust","slug":"performance-of-sqlite-redis-and-text-search-in-rust","mobiledoc":"{\"version\":\"0.3.1\",\"atoms\":[],\"cards\":[[\"bookmark\",{\"type\":\"bookmark\",\"url\":\"https://github.com/gonsie/wwfred\",\"metadata\":{\"url\":\"https://github.com/gonsie/wwfred\",\"title\":\"GitHub - gonsie/wwfred: Words With Friends RegExp Dictionary\",\"description\":\"Words With Friends RegExp Dictionary. Contribute to gonsie/wwfred development by creating an account on GitHub.\",\"author\":\"gonsie\",\"publisher\":\"GitHub\",\"thumbnail\":\"https://opengraph.githubassets.com/f97300f56c2cee93b137b3e0e5a0b248ec5f4c49314b86bbde0bb4d3575e25d5/gonsie/wwfred\",\"icon\":\"https://github.githubassets.com/favicons/favicon.svg\"}}],[\"code\",{\"code\":\"wc collins-scrabble-2019.txt \\n279496  279496 3103753 collins-scrabble-2019.txt\\n\"}],[\"code\",{\"code\":\"du -h collins-scrabble-2019.txt \\n3,0M    collins-scrabble-2019.txt\\n\"}],[\"code\",{\"code\":\"METHOD=sqlite cargo run -- hello\"}],[\"code\",{\"code\":\"use std::env;\\n\\nfn main() {\\n    let args: Vec<String> = env::args().collect();\\n    let method = env::var(\\\"METHOD\\\").unwrap_or(\\\"file\\\".to_string());\\n    println!(\\\"{:?}\\\", args);\\n    println!(\\\"{:?}\\\", method);\\n}\\n\",\"language\":\"rust\"}],[\"code\",{\"code\":\"[\\\"target/debug/rust-sqlite-file-redis\\\", \\\"hello\\\"]\\n\\\"sqlite\\\"\\n\"}],[\"code\",{\"code\":\"fn main() {\\n    let args: Vec<String> = env::args().collect();\\n    let method = env::var(\\\"METHOD\\\").unwrap_or(\\\"file\\\".to_string());\\n\\n    let res:bool = match args[1].as_str()  {\\n        \\\"text\\\" => find_using_text(args[1].as_str()),\\n        _ => find_using_text(args[1].as_str())\\n    };\\n\\n    println!(\\\"{:?}\\\", args);\\n    println!(\\\"{:?}\\\", method);\\n    println!(\\\"{:?}\\\", res);\\n}\\n\",\"language\":\"rust\"}],[\"code\",{\"code\":\"#[cfg(test)]\\nmod tests {\\n    use super::*;\\n\\n    #[test]\\n    fn find_using_text_exists() {\\n        assert_eq!(find_using_text(\\\"hello\\\"), true);\\n    }\\n\\n    #[test]\\n    fn find_using_text_non_exists() {\\n        assert_eq!(find_using_text(\\\"olleh\\\"), false);\\n    }\\n}\",\"language\":\"rust\"}],[\"code\",{\"code\":\"use std::fs::File;\\nuse std::io::{self, BufRead};\\nuse std::path::Path;\",\"language\":\"rust\"}],[\"code\",{\"code\":\"// The output is wrapped in a Result to allow matching on errors\\n// Returns an Iterator to the Reader of the lines of the file.\\nfn read_lines<P>(filename: P) -> io::Result<io::Lines<io::BufReader<File>>>\\n    where P: AsRef<Path>, {\\n    let file = File::open(filename)?;\\n    Ok(io::BufReader::new(file).lines())\\n}\\n\",\"language\":\"rust\"}],[\"code\",{\"code\":\"fn find_using_text(word: &str) -> bool {\\n    let word = word.to_uppercase();\\n    if let Ok(lines) = read_lines(\\\"./collins-head.txt\\\") {\\n        // Consumes the iterator, returns an (Optional) String\\n        for line in lines {\\n            if let Ok(line) = line {\\n                if line == word {\\n                    return true\\n                }\\n            }\\n        }\\n    }\\n\\n    false\\n}\"}],[\"code\",{\"code\":\"(head collins-scrabble-2019.txt; echo \\\"HELLO\\\") > collins-head.txt\"}],[\"image\",{\"src\":\"__GHOST_URL__/content/images/2022/12/2022-12-15_21-05.png\",\"width\":1920,\"height\":1200}]],\"markups\":[[\"code\"]],\"sections\":[[1,\"p\",[[0,[],0,\"We have sorted dictionary with English words. Our goal is write program that check if words is present in dictionary. Open question remains which tools should be selected. We will consider comparison of:\"]]],[3,\"ul\",[[[0,[],0,\"searching in text file - word by word O(n)\"]],[[0,[],0,\"searching in text file - words using newton method O(ln(n))\"]],[[0,[],0,\"searching in sqlite - unindexed O(n)\"]],[[0,[],0,\"searching in sqlite - indexed O(ln(n))\"]],[[0,[],0,\"redis\"]]]],[1,\"p\",[[0,[],0,\"We have got dictionary from repository \"],[0,[0],1,\"wwfred\"]]],[10,0],[1,\"p\",[[0,[],0,\"Stats of file:\"]]],[10,1],[10,2],[1,\"h2\",[[0,[],0,\"Access to parameter and ENV variable in Rust\"]]],[1,\"p\",[[0,[],0,\"Interface of our file will be following\"]]],[10,3],[1,\"p\",[[0,[],0,\"we will choose method of searching using env variable and word to search as first parameter.\"]]],[1,\"p\",[[0,[],0,\"to have access to method and word we can write simple program\"]]],[10,4],[1,\"p\",[[0,[],0,\"that will print\"]]],[10,5],[1,\"h2\",[[0,[],0,\"Reading file line by line\"]]],[1,\"p\",[[0,[],0,\"First naive approach assume that we will read all file line by line and check if we found searched word.\"]]],[1,\"p\",[[0,[],0,\"We will use \"],[0,[0],1,\"match\"],[0,[],0,\" to check if \"],[0,[0],1,\"method\"],[0,[],0,\" is \"],[0,[0],1,\"text\"],[0,[],0,\".\"]]],[1,\"p\",[[0,[],0,\"Currently there is only function \"],[0,[0],1,\"find_using_text\"],[0,[],0,\" so our \"],[0,[0],1,\"main\"],[0,[],0,\" can looks like this\"]]],[10,6],[1,\"p\",[[0,[],0,\"we can write tests to develop this function using TDD\"]]],[10,7],[1,\"p\",[[0,[],0,\"finally lets implement \"],[0,[0],1,\"find_using_text\"],[0,[],0,\".\"]]],[1,\"p\",[[0,[],0,\"Lets start from \"],[0,[0],1,\"use\"],[0,[],0,\" declaration\"]]],[10,8],[1,\"p\",[[0,[],0,\"we can write helping function \"],[0,[0],1,\"read_lines\"]]],[10,9],[1,\"p\",[[0,[],0,\"and our function that search text in file\"]]],[10,10],[1,\"p\",[[0,[],0,\"file \"],[0,[0],1,\"collins-head.txt\"],[0,[],0,\" was created by command\"]]],[10,11],[1,\"h2\",[[0,[],0,\"Newton method of searching\"]]],[1,\"p\",[]],[1,\"p\",[]],[10,12],[1,\"p\",[]]],\"ghostVersion\":\"4.0\"}","html":"<p>We have sorted dictionary with English words. Our goal is write program that check if words is present in dictionary. Open question remains which tools should be selected. We will consider comparison of:</p><ul><li>searching in text file - word by word O(n)</li><li>searching in text file - words using newton method O(ln(n))</li><li>searching in sqlite - unindexed O(n)</li><li>searching in sqlite - indexed O(ln(n))</li><li>redis</li></ul><p>We have got dictionary from repository <code>wwfred</code></p><figure class=\"kg-card kg-bookmark-card\"><a class=\"kg-bookmark-container\" href=\"https://github.com/gonsie/wwfred\"><div class=\"kg-bookmark-content\"><div class=\"kg-bookmark-title\">GitHub - gonsie/wwfred: Words With Friends RegExp Dictionary</div><div class=\"kg-bookmark-description\">Words With Friends RegExp Dictionary. Contribute to gonsie/wwfred development by creating an account on GitHub.</div><div class=\"kg-bookmark-metadata\"><img class=\"kg-bookmark-icon\" src=\"https://github.githubassets.com/favicons/favicon.svg\"><span class=\"kg-bookmark-author\">GitHub</span><span class=\"kg-bookmark-publisher\">gonsie</span></div></div><div class=\"kg-bookmark-thumbnail\"><img src=\"https://opengraph.githubassets.com/f97300f56c2cee93b137b3e0e5a0b248ec5f4c49314b86bbde0bb4d3575e25d5/gonsie/wwfred\"></div></a></figure><p>Stats of file:</p><pre><code>wc collins-scrabble-2019.txt \n279496  279496 3103753 collins-scrabble-2019.txt\n</code></pre><pre><code>du -h collins-scrabble-2019.txt \n3,0M    collins-scrabble-2019.txt\n</code></pre><h2 id=\"access-to-parameter-and-env-variable-in-rust\">Access to parameter and ENV variable in Rust</h2><p>Interface of our file will be following</p><pre><code>METHOD=sqlite cargo run -- hello</code></pre><p>we will choose method of searching using env variable and word to search as first parameter.</p><p>to have access to method and word we can write simple program</p><pre><code class=\"language-rust\">use std::env;\n\nfn main() {\n    let args: Vec&lt;String&gt; = env::args().collect();\n    let method = env::var(\"METHOD\").unwrap_or(\"file\".to_string());\n    println!(\"{:?}\", args);\n    println!(\"{:?}\", method);\n}\n</code></pre><p>that will print</p><pre><code>[\"target/debug/rust-sqlite-file-redis\", \"hello\"]\n\"sqlite\"\n</code></pre><h2 id=\"reading-file-line-by-line\">Reading file line by line</h2><p>First naive approach assume that we will read all file line by line and check if we found searched word.</p><p>We will use <code>match</code> to check if <code>method</code> is <code>text</code>.</p><p>Currently there is only function <code>find_using_text</code> so our <code>main</code> can looks like this</p><pre><code class=\"language-rust\">fn main() {\n    let args: Vec&lt;String&gt; = env::args().collect();\n    let method = env::var(\"METHOD\").unwrap_or(\"file\".to_string());\n\n    let res:bool = match args[1].as_str()  {\n        \"text\" =&gt; find_using_text(args[1].as_str()),\n        _ =&gt; find_using_text(args[1].as_str())\n    };\n\n    println!(\"{:?}\", args);\n    println!(\"{:?}\", method);\n    println!(\"{:?}\", res);\n}\n</code></pre><p>we can write tests to develop this function using TDD</p><pre><code class=\"language-rust\">#[cfg(test)]\nmod tests {\n    use super::*;\n\n    #[test]\n    fn find_using_text_exists() {\n        assert_eq!(find_using_text(\"hello\"), true);\n    }\n\n    #[test]\n    fn find_using_text_non_exists() {\n        assert_eq!(find_using_text(\"olleh\"), false);\n    }\n}</code></pre><p>finally lets implement <code>find_using_text</code>.</p><p>Lets start from <code>use</code> declaration</p><pre><code class=\"language-rust\">use std::fs::File;\nuse std::io::{self, BufRead};\nuse std::path::Path;</code></pre><p>we can write helping function <code>read_lines</code></p><pre><code class=\"language-rust\">// The output is wrapped in a Result to allow matching on errors\n// Returns an Iterator to the Reader of the lines of the file.\nfn read_lines&lt;P&gt;(filename: P) -&gt; io::Result&lt;io::Lines&lt;io::BufReader&lt;File&gt;&gt;&gt;\n    where P: AsRef&lt;Path&gt;, {\n    let file = File::open(filename)?;\n    Ok(io::BufReader::new(file).lines())\n}\n</code></pre><p>and our function that search text in file</p><pre><code>fn find_using_text(word: &amp;str) -&gt; bool {\n    let word = word.to_uppercase();\n    if let Ok(lines) = read_lines(\"./collins-head.txt\") {\n        // Consumes the iterator, returns an (Optional) String\n        for line in lines {\n            if let Ok(line) = line {\n                if line == word {\n                    return true\n                }\n            }\n        }\n    }\n\n    false\n}</code></pre><p>file <code>collins-head.txt</code> was created by command</p><pre><code>(head collins-scrabble-2019.txt; echo \"HELLO\") &gt; collins-head.txt</code></pre><h2 id=\"newton-method-of-searching\">Newton method of searching</h2><p></p><p></p><figure class=\"kg-card kg-image-card\"><img src=\"__GHOST_URL__/content/images/2022/12/2022-12-15_21-05.png\" class=\"kg-image\" alt loading=\"lazy\" width=\"1920\" height=\"1200\" srcset=\"__GHOST_URL__/content/images/size/w600/2022/12/2022-12-15_21-05.png 600w, __GHOST_URL__/content/images/size/w1000/2022/12/2022-12-15_21-05.png 1000w, __GHOST_URL__/content/images/size/w1600/2022/12/2022-12-15_21-05.png 1600w, __GHOST_URL__/content/images/2022/12/2022-12-15_21-05.png 1920w\" sizes=\"(min-width: 720px) 720px\"></figure>","comment_id":"638f7123bbda300a2f29c5b7","plaintext":"We have sorted dictionary with English words. Our goal is write program that\ncheck if words is present in dictionary. Open question remains which tools\nshould be selected. We will consider comparison of:\n\n * searching in text file - word by word O(n)\n * searching in text file - words using newton method O(ln(n))\n * searching in sqlite - unindexed O(n)\n * searching in sqlite - indexed O(ln(n))\n * redis\n\nWe have got dictionary from repository wwfred\n\nGitHub - gonsie/wwfred: Words With Friends RegExp DictionaryWords With Friends\nRegExp Dictionary. Contribute to gonsie/wwfred development by creating an\naccount on GitHub.GitHubgonsie [https://github.com/gonsie/wwfred]Stats of file:\n\nwc collins-scrabble-2019.txt \n279496  279496 3103753 collins-scrabble-2019.txt\n\n\ndu -h collins-scrabble-2019.txt \n3,0M    collins-scrabble-2019.txt\n\n\nAccess to parameter and ENV variable in Rust\nInterface of our file will be following\n\nMETHOD=sqlite cargo run -- hello\n\nwe will choose method of searching using env variable and word to search as\nfirst parameter.\n\nto have access to method and word we can write simple program\n\nuse std::env;\n\nfn main() {\n    let args: Vec<String> = env::args().collect();\n    let method = env::var(\"METHOD\").unwrap_or(\"file\".to_string());\n    println!(\"{:?}\", args);\n    println!(\"{:?}\", method);\n}\n\n\nthat will print\n\n[\"target/debug/rust-sqlite-file-redis\", \"hello\"]\n\"sqlite\"\n\n\nReading file line by line\nFirst naive approach assume that we will read all file line by line and check if\nwe found searched word.\n\nWe will use match to check if method is text.\n\nCurrently there is only function find_using_text so our main can looks like this\n\nfn main() {\n    let args: Vec<String> = env::args().collect();\n    let method = env::var(\"METHOD\").unwrap_or(\"file\".to_string());\n\n    let res:bool = match args[1].as_str()  {\n        \"text\" => find_using_text(args[1].as_str()),\n        _ => find_using_text(args[1].as_str())\n    };\n\n    println!(\"{:?}\", args);\n    println!(\"{:?}\", method);\n    println!(\"{:?}\", res);\n}\n\n\nwe can write tests to develop this function using TDD\n\n#[cfg(test)]\nmod tests {\n    use super::*;\n\n    #[test]\n    fn find_using_text_exists() {\n        assert_eq!(find_using_text(\"hello\"), true);\n    }\n\n    #[test]\n    fn find_using_text_non_exists() {\n        assert_eq!(find_using_text(\"olleh\"), false);\n    }\n}\n\nfinally lets implement find_using_text.\n\nLets start from use declaration\n\nuse std::fs::File;\nuse std::io::{self, BufRead};\nuse std::path::Path;\n\nwe can write helping function read_lines\n\n// The output is wrapped in a Result to allow matching on errors\n// Returns an Iterator to the Reader of the lines of the file.\nfn read_lines<P>(filename: P) -> io::Result<io::Lines<io::BufReader<File>>>\n    where P: AsRef<Path>, {\n    let file = File::open(filename)?;\n    Ok(io::BufReader::new(file).lines())\n}\n\n\nand our function that search text in file\n\nfn find_using_text(word: &str) -> bool {\n    let word = word.to_uppercase();\n    if let Ok(lines) = read_lines(\"./collins-head.txt\") {\n        // Consumes the iterator, returns an (Optional) String\n        for line in lines {\n            if let Ok(line) = line {\n                if line == word {\n                    return true\n                }\n            }\n        }\n    }\n\n    false\n}\n\nfile collins-head.txt was created by command\n\n(head collins-scrabble-2019.txt; echo \"HELLO\") > collins-head.txt\n\nNewton method of searching","feature_image":"__GHOST_URL__/content/images/2022/12/2022-12-15_21-05-1.png","featured":0,"type":"post","status":"draft","locale":null,"visibility":"public","email_recipient_filter":"all","created_at":"2022-12-06T16:43:15.000Z","updated_at":"2022-12-15T17:06:59.000Z","published_at":null,"custom_excerpt":null,"codeinjection_head":null,"codeinjection_foot":null,"custom_template":null,"canonical_url":null,"newsletter_id":null,"lexical":null},{"id":"639a2d70bbda300a2f29c627","uuid":"1f389cfa-a012-428d-b352-1764870712ee","title":"Overload Signatures in Typescript","slug":"overload-signatures-in-typescript","mobiledoc":"{\"version\":\"0.3.1\",\"atoms\":[],\"cards\":[[\"code\",{\"code\":\"interface HyperCube {\\n    size: number\\n    dimension: number\\n}\\n\\nexport function volume(cube: HyperCube): number {\\n    return Math.pow(cube.size, cube.dimension);\\n}\",\"language\":\"typescript\"}],[\"code\",{\"code\":\"export function formatNumber(num: number): string {\\n    return num.toString().replace(/(\\\\d)(?=(\\\\d{3})+(?!\\\\d))/g, '$1_')\\n}\",\"language\":\"typescript\"}],[\"code\",{\"code\":\"export function volume(cube: HyperCube, asString: boolean = false): string | number {\\n    const volume = Math.pow(cube.size, cube.dimension);\\n    return asString ? formatNumber(volume) : volume;\\n}\",\"language\":\"typescript\"}],[\"image\",{\"src\":\"__GHOST_URL__/content/images/2022/12/meme-dev-humor-for-any-emergency-in-typescript-222.jpg\",\"width\":576,\"height\":505}],[\"code\",{\"code\":\"export function volume(cube: HyperCube, asString: false): number\\nexport function volume(cube: HyperCube, asString: true): string\\nexport function volume(cube: HyperCube, asString: boolean = false): string | number {\\n    const volume = Math.pow(cube.size, cube.dimension);\\n    return asString ? formatNumber(volume) : volume;\\n}\",\"language\":\"typescript\"}],[\"bookmark\",{\"type\":\"bookmark\",\"url\":\"https://stackoverflow.com/questions/54165536/typescript-function-return-type-based-on-input-parameter\",\"metadata\":{\"url\":\"https://stackoverflow.com/questions/54165536/typescript-function-return-type-based-on-input-parameter\",\"title\":\"TypeScript function return type based on input parameter\",\"description\":\"I have a few different interfaces and objects that each have a type property. Let’s say these are objects stored in a NoSQL db. How can I create a generic getItem function with a deterministic return\",\"author\":\"Arash Motamedi\",\"publisher\":\"Stack Overflow\",\"thumbnail\":\"https://cdn.sstatic.net/Sites/stackoverflow/Img/apple-touch-icon@2.png?v=73d79a89bded\",\"icon\":\"https://cdn.sstatic.net/Sites/stackoverflow/Img/apple-touch-icon.png?v=c78bd457575a\"}}],[\"bookmark\",{\"type\":\"bookmark\",\"url\":\"https://www.typescriptlang.org/docs/handbook/2/functions.html#function-overloads\",\"metadata\":{\"url\":\"https://www.typescriptlang.org/docs/handbook/2/functions.html#function-overloads\",\"title\":\"Documentation - More on Functions\",\"description\":\"Learn about how Functions work in TypeScript.\",\"author\":null,\"publisher\":\"More on Functions\",\"thumbnail\":\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAALgAAAAmCAYAAAB3X1H0AAAACXBIWXMAABYlAAAWJQFJUiTwAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAApYSURBVHgB7VwJsBXFFb1PFCSIBHGJRg0hkagJoayoX4KGUEncIJRJKospU4SkTEXLfS+13MpCccMFRcUCF9xwKUXFHdFyQ6RcUBE3QPTrB76CiAIC4zl2j++++2d7/81Xa/6cqvPndU9335meO9237+35EuSHqQLgeFCQH34rJUo0gA2kRIkCo1TwEoVGqeAlCo1SwUsUGhtKiRLfccDZsCkOfwC3A7uCi8FHK5XKorS6pYLnADyArXHYCXwenf6JlMgF6Ffq57HgKWBPc/oI8LK0Ngqj4OgMvtk3gX3Mqc/BYVC8QOoA2vspDrdEnJqMti5W5f6NwwRxfbkE6X1w/gUpkQeowP+XBlCkEbwbOATcPOLcn8A7pT4cCf4qIn9G+APKvBEOp0u1H7cAzwL/KCUaAvp2EA7/NdnN4OviBrH1EXU2w+Dykc7rLCbKoVKHgnubb/8MRbt4amwsJfLAIeBGKj0FPBoK3Izn00PcgMZnxUHlQHHPqy+4o26ksyh4Ezpie3TOuxnL7wP+OK0Q2luFds/BzzHibMT54JlSIg/8zqTHULn5A8eVOKxE33MknwNu5cussI0U2U2oF3ubgP/IUgmdVhE3elR81oqk8ujs8TgMFvdSNCH9pJTIA1ub9OvSDhRZwZeBLSrNPTK9MtTbFfyNSr+WVgFKPQd8CFwiJfJCxaTXSjtQZBOFXpOHwH/59ABwL/DelHqHS9WuXg6+AjbFCgmCbcTNECHe91NoXHn2+a/FvUhbeFmLvZxHUHetKkszSduhC3B+DfK74/cI8Ac+7+4IORt4GbuJW3hTLmc1joT0IX8mKfCzGRfanKE4ojK9FHwRnI421qXU39HXZR/RZma/LAQfjhoMIu5Xoz/OrzF5vUz5LijTXzcpQX74VncTomxPcImquxAcYtp7IKWNbcEPVfk7wFNMGxeYOreb83+JabsXOApsCeJB2YNVnafVubXgIPYJuExXMnI2Af8Hzk+Q8wl4deAWaHF9sRP4bEIbc8EuEfU2BPcF5yTUXQ3eE9Qqo73fPLCqyCYKR5uZUmu7DQ2cfzsOw6S6YCEulRy8IpD5MxxuByeCWyYUpezeuqo5z3ZuEzdyRcn5IQ53gVeJ8yjEgQvig8EZqDMgoh26W9l3TQlt9Iiox7wrwGngLxLqMmYxHJyOOn/WTUjOKJqCW7vtC/A6lWbHHpRQ/xD1+w3wGWnrBqwLeIB8Qeii/L09Bb4nzjRZKtkeLiN6m8fI4XXeKm29Dwx0MfD0PGjNgp3BG1F3M9MOA1c6csj1DJX2fnBewrUyBsAXRz8Hmlz0dMwCPzDl+UJOgMykl6Eh0C5rkXwQei1W5thmvYjq+CvBM8T7TYG/okPP1rbuVxWDgKPVQJV1hbd3pUFcIk6RQvCloyKejvbf8bKpEHuIC0trgVpRqHicfVp8m4+LG8lDhaarcrAqz4DHNeBpkLPay6G9egJ4qlRnpgE+fYxPN3k5IWaDjM62hhl+FhypyjCPwa0jVNYqcDJ4UljX3+ffwIvE2eUEXy6aS7yPfcUNQsRSqUU/cX2nwbrTpRq9/lDcmqPmwvrkxB6+vY1zbDPzIjhoa4O/60cjnhuv8mn/jYioP1mV+RjcweePDmqR2QbH737gOnP+NP+go+6ha+AWkGH6KVP3C3D/iHpbBrVrB+L4GBmVwNnoGq1gX39+pDl3paT3Pe3uB0298Qnl9/P3EmI9ONSUsega0U4fc9/v2zJ5mijhana9fPdwg1TdTOyoUVrJArd6H6bKP4BR501pHDSHdB+/LS5gETktcMYAP5d4TMH5aRH5HP312oEzw0SJlkHZk/y1hOBIGJoJraYK1y39JRkcXfdSad7DWXGFcQ00dZ7SWeCe0gHgCPmq5INHxD1QjmBjJR9w2psljYNtzBU3HRN7g9uC4XZLLni+73/zBZ0g+WCISd8cmgvtxF0x+QNN+jltUljgHEdP2uU/Udm/FOdCZV8xuBXa4FRuelPYJ+NRd0FEk3QHdlfpuSj3gSSD+qL7J+0laheo4FtJPtjUH7vk2GYPyQH+gdKzMM5nfU/cy3hO4BaBf1fF6XV5TBqEnyF+ZLJnSvvBkTcukGSjfq9IOuwM1Zd/0Fd0Y9J7dLJU1wD07NB2Pwrn+BKcgHJ6BrDbGhZKOl4y6W2kA9CZvujhZp0FKj3SK+Eu4CCVP67erbUx4ODR3eSlBlcSwJllTcy5bia9StJhZxK93uF+Gi48l5syNO/o1uOIfqSyi+19xl2nxmcJ8nNDp1FwHzl7WGXRp8wp8j9S7QeWSYt0ZgVfEhvp6ymNIe7Fs8qa5GuPK/Nx+IMzHjhanEeFnhjr0aCrkmZoOPPZyG2W++xt0q3SAehs32SONukDpHZb7NQsn0FlgXdDLjbZu0vHoNmks/iVdzbpNntucA/zQPq1uYika1K7Vjn7cbHOkfc9U7V/kO4B282k35YOQKdScL9Auk9l8WuR0PYLvQt54jmTpnuum2RHJWO52Sa9B+T8PK5w4EL0u6osmjSx6wP02wrwKGm7I5OKz304DORos4TfTu6ZIJ8L+uEm+2lpHHSz1mR0xq/qtftMKxsXZnl0sgZ9yLrHObVPCnzMwILuOLCfzpJsoILrve50+40J3H5pK4MvDX35eoPYo+JHcJzfARwYI+c1c00MvHBUp1tyuspnv16AdranwhlSPgNCegbhovQJqR+rpXZWYf/WyCx6qD4K7MjmiPxJOS0uqxdTqbyMw/Umm1+fPO6DLQMCFww6ALxcnG9YP/hMIzjk0BQ6W2qVj379qWj3cHAXKi04StwM9k9Vjos9RnbD+AU9IjMDF/g6ENwucBvFuAPyfHNNdDGv9HXPkNqFI3ch0ht1ojhbni5a2uw3gzoIxWsem+TWTLjvT6Xt+oCDyu5e3mFF3k34dSQzouyZRg7Lxu3xaHck05/vDb4YZMdwVVdHMr/aTZhw/93AKUF9oPv0YNPO3hnrLg+c0uu6J/nrrAfjYu7HomtMuYsS2i70bsIkXCu1rrRpGA2WSgcA7dI7wa0BHfqljw8g0SN0ecYq3DtE3/Y1Uj84ch4HmdakO4/5ku3jBEY7L/XlG8G5Eh8fKNwHDwxehBE0ekPiQuLzA7fHosmXmZjQJu3LGSptV/tvmfOLIuRxhqBLkl4bfq3PKVRvw6VCcJfeheJ2MIZgtDFcvNHlmPg/VzhlQw7t22vFbdyiTB0E4r3yu1H+ew3++4t5Ec0wkknF50tJW1zb6tzoxW2/Y8ONYkY+TZWLAzebUz7/WQ+jpdqsoTl1h7gF/ewEs9AG2yK3gNA8gzxuVaCHbD+puihpLs3ixpu87M57IGwEmmOE8AbJB0PR5gwpGPx0ywfP6C9Hw3dS9qA0IoseE/q8+YIsSvraKKJuxdelkrei7jKpE4H7TJCeKrbV3J426pBFi4QenHVe1vryP1t9C+CmKnF7Y74JWZy+2/WtqB9dW6SB7c9og9HQ5fINwM8gNdsEyn++WaLQKBW8RKFRKniJQqNU8BKFRqngJQqNLwEZWErzngOVuwAAAABJRU5ErkJggg==\",\"icon\":\"https://www.typescriptlang.org/icons/icon-512x512.png?v=8944a05a8b601855de116c8a56d3b3ae\"}}]],\"markups\":[[\"code\"]],\"sections\":[[1,\"p\",[[0,[],0,\"When do you have function that returns different types in dependence from parameter values \"],[0,[0],1,\"overload signatures\"],[0,[],0,\" can be exactly what do you need.\"]]],[1,\"p\",[[0,[],0,\"Let me introduce context.\"]]],[1,\"p\",[[0,[],0,\"We have super simple function that computes volume of hypercube:\"]]],[10,0],[1,\"p\",[[0,[],0,\"But because of our volumes are really huge we need display them in snake case notation. Eg.: \"],[0,[0],1,\"1_000_000_000\"],[0,[],0,\" instead of \"],[0,[0],1,\"1000000000\"],[0,[],0,\".\"]]],[1,\"p\",[[0,[],0,\"We can add function to format\"]]],[10,1],[1,\"p\",[[0,[],0,\"but we do not want to write this \"],[0,[0],1,\"formatNumber\"],[0,[],0,\" function always when we using conversion to string. Instead we would like to add second parameter to \"],[0,[0],1,\"volume\"],[0,[],0,\" function to decide if we returning string or number.\"]]],[10,2],[1,\"p\",[[0,[],0,\"Unfortunately now using \"],[0,[0],1,\"volume\"],[0,[],0,\" function we do not know if we will get \"],[0,[0],1,\"string\"],[0,[],0,\" or \"],[0,[0],1,\"number\"],[0,[],0,\". We do not want to use \"],[0,[0],1,\".toString\"],[0,[],0,\" or \"],[0,[0],1,\"parseInt\"],[0,[],0,\" any time.\"]]],[10,3],[1,\"p\",[[0,[],0,\"Fortunately there is concept called overload signatures. It allows to select returned type in dependence from parameters values.\"]]],[1,\"p\",[[0,[],0,\"In our case we want \"],[0,[0],1,\"number\"],[0,[],0,\" is \"],[0,[0],1,\"asString\"],[0,[],0,\" is false, in other case we need return \"],[0,[0],1,\"string\"],[0,[],0,\". To apply overload signature we can use the following syntax\"]]],[10,4],[1,\"p\",[[0,[],0,\"now our returned type is correct and depend from \"],[0,[0],1,\"asString\"],[0,[],0,\" value.\"]]],[1,\"p\",[[0,[],0,\"Sources:\"]]],[10,5],[10,6],[1,\"p\",[]]],\"ghostVersion\":\"4.0\"}","html":"<p>When do you have function that returns different types in dependence from parameter values <code>overload signatures</code> can be exactly what do you need.</p><p>Let me introduce context.</p><p>We have super simple function that computes volume of hypercube:</p><pre><code class=\"language-typescript\">interface HyperCube {\n    size: number\n    dimension: number\n}\n\nexport function volume(cube: HyperCube): number {\n    return Math.pow(cube.size, cube.dimension);\n}</code></pre><p>But because of our volumes are really huge we need display them in snake case notation. Eg.: <code>1_000_000_000</code> instead of <code>1000000000</code>.</p><p>We can add function to format</p><pre><code class=\"language-typescript\">export function formatNumber(num: number): string {\n    return num.toString().replace(/(\\d)(?=(\\d{3})+(?!\\d))/g, '$1_')\n}</code></pre><p>but we do not want to write this <code>formatNumber</code> function always when we using conversion to string. Instead we would like to add second parameter to <code>volume</code> function to decide if we returning string or number.</p><pre><code class=\"language-typescript\">export function volume(cube: HyperCube, asString: boolean = false): string | number {\n    const volume = Math.pow(cube.size, cube.dimension);\n    return asString ? formatNumber(volume) : volume;\n}</code></pre><p>Unfortunately now using <code>volume</code> function we do not know if we will get <code>string</code> or <code>number</code>. We do not want to use <code>.toString</code> or <code>parseInt</code> any time.</p><figure class=\"kg-card kg-image-card\"><img src=\"__GHOST_URL__/content/images/2022/12/meme-dev-humor-for-any-emergency-in-typescript-222.jpg\" class=\"kg-image\" alt loading=\"lazy\" width=\"576\" height=\"505\"></figure><p>Fortunately there is concept called overload signatures. It allows to select returned type in dependence from parameters values.</p><p>In our case we want <code>number</code> is <code>asString</code> is false, in other case we need return <code>string</code>. To apply overload signature we can use the following syntax</p><pre><code class=\"language-typescript\">export function volume(cube: HyperCube, asString: false): number\nexport function volume(cube: HyperCube, asString: true): string\nexport function volume(cube: HyperCube, asString: boolean = false): string | number {\n    const volume = Math.pow(cube.size, cube.dimension);\n    return asString ? formatNumber(volume) : volume;\n}</code></pre><p>now our returned type is correct and depend from <code>asString</code> value.</p><p>Sources:</p><figure class=\"kg-card kg-bookmark-card\"><a class=\"kg-bookmark-container\" href=\"https://stackoverflow.com/questions/54165536/typescript-function-return-type-based-on-input-parameter\"><div class=\"kg-bookmark-content\"><div class=\"kg-bookmark-title\">TypeScript function return type based on input parameter</div><div class=\"kg-bookmark-description\">I have a few different interfaces and objects that each have a type property. Let’s say these are objects stored in a NoSQL db. How can I create a generic getItem function with a deterministic return</div><div class=\"kg-bookmark-metadata\"><img class=\"kg-bookmark-icon\" src=\"https://cdn.sstatic.net/Sites/stackoverflow/Img/apple-touch-icon.png?v&#x3D;c78bd457575a\"><span class=\"kg-bookmark-author\">Stack Overflow</span><span class=\"kg-bookmark-publisher\">Arash Motamedi</span></div></div><div class=\"kg-bookmark-thumbnail\"><img src=\"https://cdn.sstatic.net/Sites/stackoverflow/Img/apple-touch-icon@2.png?v&#x3D;73d79a89bded\"></div></a></figure><figure class=\"kg-card kg-bookmark-card\"><a class=\"kg-bookmark-container\" href=\"https://www.typescriptlang.org/docs/handbook/2/functions.html#function-overloads\"><div class=\"kg-bookmark-content\"><div class=\"kg-bookmark-title\">Documentation - More on Functions</div><div class=\"kg-bookmark-description\">Learn about how Functions work in TypeScript.</div><div class=\"kg-bookmark-metadata\"><img class=\"kg-bookmark-icon\" src=\"https://www.typescriptlang.org/icons/icon-512x512.png?v&#x3D;8944a05a8b601855de116c8a56d3b3ae\"><span class=\"kg-bookmark-author\">More on Functions</span></div></div><div class=\"kg-bookmark-thumbnail\"><img src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAALgAAAAmCAYAAAB3X1H0AAAACXBIWXMAABYlAAAWJQFJUiTwAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAApYSURBVHgB7VwJsBXFFb1PFCSIBHGJRg0hkagJoayoX4KGUEncIJRJKospU4SkTEXLfS+13MpCccMFRcUCF9xwKUXFHdFyQ6RcUBE3QPTrB76CiAIC4zl2j++++2d7/81Xa/6cqvPndU9335meO9237+35EuSHqQLgeFCQH34rJUo0gA2kRIkCo1TwEoVGqeAlCo1SwUsUGhtKiRLfccDZsCkOfwC3A7uCi8FHK5XKorS6pYLnADyArXHYCXwenf6JlMgF6Ffq57HgKWBPc/oI8LK0Ngqj4OgMvtk3gX3Mqc/BYVC8QOoA2vspDrdEnJqMti5W5f6NwwRxfbkE6X1w/gUpkQeowP+XBlCkEbwbOATcPOLcn8A7pT4cCf4qIn9G+APKvBEOp0u1H7cAzwL/KCUaAvp2EA7/NdnN4OviBrH1EXU2w+Dykc7rLCbKoVKHgnubb/8MRbt4amwsJfLAIeBGKj0FPBoK3Izn00PcgMZnxUHlQHHPqy+4o26ksyh4Ezpie3TOuxnL7wP+OK0Q2luFds/BzzHibMT54JlSIg/8zqTHULn5A8eVOKxE33MknwNu5cussI0U2U2oF3ubgP/IUgmdVhE3elR81oqk8ujs8TgMFvdSNCH9pJTIA1ub9OvSDhRZwZeBLSrNPTK9MtTbFfyNSr+WVgFKPQd8CFwiJfJCxaTXSjtQZBOFXpOHwH/59ABwL/DelHqHS9WuXg6+AjbFCgmCbcTNECHe91NoXHn2+a/FvUhbeFmLvZxHUHetKkszSduhC3B+DfK74/cI8Ac+7+4IORt4GbuJW3hTLmc1joT0IX8mKfCzGRfanKE4ojK9FHwRnI421qXU39HXZR/RZma/LAQfjhoMIu5Xoz/OrzF5vUz5LijTXzcpQX74VncTomxPcImquxAcYtp7IKWNbcEPVfk7wFNMGxeYOreb83+JabsXOApsCeJB2YNVnafVubXgIPYJuExXMnI2Af8Hzk+Q8wl4deAWaHF9sRP4bEIbc8EuEfU2BPcF5yTUXQ3eE9Qqo73fPLCqyCYKR5uZUmu7DQ2cfzsOw6S6YCEulRy8IpD5MxxuByeCWyYUpezeuqo5z3ZuEzdyRcn5IQ53gVeJ8yjEgQvig8EZqDMgoh26W9l3TQlt9Iiox7wrwGngLxLqMmYxHJyOOn/WTUjOKJqCW7vtC/A6lWbHHpRQ/xD1+w3wGWnrBqwLeIB8Qeii/L09Bb4nzjRZKtkeLiN6m8fI4XXeKm29Dwx0MfD0PGjNgp3BG1F3M9MOA1c6csj1DJX2fnBewrUyBsAXRz8Hmlz0dMwCPzDl+UJOgMykl6Eh0C5rkXwQei1W5thmvYjq+CvBM8T7TYG/okPP1rbuVxWDgKPVQJV1hbd3pUFcIk6RQvCloyKejvbf8bKpEHuIC0trgVpRqHicfVp8m4+LG8lDhaarcrAqz4DHNeBpkLPay6G9egJ4qlRnpgE+fYxPN3k5IWaDjM62hhl+FhypyjCPwa0jVNYqcDJ4UljX3+ffwIvE2eUEXy6aS7yPfcUNQsRSqUU/cX2nwbrTpRq9/lDcmqPmwvrkxB6+vY1zbDPzIjhoa4O/60cjnhuv8mn/jYioP1mV+RjcweePDmqR2QbH737gOnP+NP+go+6ha+AWkGH6KVP3C3D/iHpbBrVrB+L4GBmVwNnoGq1gX39+pDl3paT3Pe3uB0298Qnl9/P3EmI9ONSUsega0U4fc9/v2zJ5mijhana9fPdwg1TdTOyoUVrJArd6H6bKP4BR501pHDSHdB+/LS5gETktcMYAP5d4TMH5aRH5HP312oEzw0SJlkHZk/y1hOBIGJoJraYK1y39JRkcXfdSad7DWXGFcQ00dZ7SWeCe0gHgCPmq5INHxD1QjmBjJR9w2psljYNtzBU3HRN7g9uC4XZLLni+73/zBZ0g+WCISd8cmgvtxF0x+QNN+jltUljgHEdP2uU/Udm/FOdCZV8xuBXa4FRuelPYJ+NRd0FEk3QHdlfpuSj3gSSD+qL7J+0laheo4FtJPtjUH7vk2GYPyQH+gdKzMM5nfU/cy3hO4BaBf1fF6XV5TBqEnyF+ZLJnSvvBkTcukGSjfq9IOuwM1Zd/0Fd0Y9J7dLJU1wD07NB2Pwrn+BKcgHJ6BrDbGhZKOl4y6W2kA9CZvujhZp0FKj3SK+Eu4CCVP67erbUx4ODR3eSlBlcSwJllTcy5bia9StJhZxK93uF+Gi48l5syNO/o1uOIfqSyi+19xl2nxmcJ8nNDp1FwHzl7WGXRp8wp8j9S7QeWSYt0ZgVfEhvp6ymNIe7Fs8qa5GuPK/Nx+IMzHjhanEeFnhjr0aCrkmZoOPPZyG2W++xt0q3SAehs32SONukDpHZb7NQsn0FlgXdDLjbZu0vHoNmks/iVdzbpNntucA/zQPq1uYika1K7Vjn7cbHOkfc9U7V/kO4B282k35YOQKdScL9Auk9l8WuR0PYLvQt54jmTpnuum2RHJWO52Sa9B+T8PK5w4EL0u6osmjSx6wP02wrwKGm7I5OKz304DORos4TfTu6ZIJ8L+uEm+2lpHHSz1mR0xq/qtftMKxsXZnl0sgZ9yLrHObVPCnzMwILuOLCfzpJsoILrve50+40J3H5pK4MvDX35eoPYo+JHcJzfARwYI+c1c00MvHBUp1tyuspnv16AdranwhlSPgNCegbhovQJqR+rpXZWYf/WyCx6qD4K7MjmiPxJOS0uqxdTqbyMw/Umm1+fPO6DLQMCFww6ALxcnG9YP/hMIzjk0BQ6W2qVj379qWj3cHAXKi04StwM9k9Vjos9RnbD+AU9IjMDF/g6ENwucBvFuAPyfHNNdDGv9HXPkNqFI3ch0ht1ojhbni5a2uw3gzoIxWsem+TWTLjvT6Xt+oCDyu5e3mFF3k34dSQzouyZRg7Lxu3xaHck05/vDb4YZMdwVVdHMr/aTZhw/93AKUF9oPv0YNPO3hnrLg+c0uu6J/nrrAfjYu7HomtMuYsS2i70bsIkXCu1rrRpGA2WSgcA7dI7wa0BHfqljw8g0SN0ecYq3DtE3/Y1Uj84ch4HmdakO4/5ku3jBEY7L/XlG8G5Eh8fKNwHDwxehBE0ekPiQuLzA7fHosmXmZjQJu3LGSptV/tvmfOLIuRxhqBLkl4bfq3PKVRvw6VCcJfeheJ2MIZgtDFcvNHlmPg/VzhlQw7t22vFbdyiTB0E4r3yu1H+ew3++4t5Ec0wkknF50tJW1zb6tzoxW2/Y8ONYkY+TZWLAzebUz7/WQ+jpdqsoTl1h7gF/ewEs9AG2yK3gNA8gzxuVaCHbD+puihpLs3ixpu87M57IGwEmmOE8AbJB0PR5gwpGPx0ywfP6C9Hw3dS9qA0IoseE/q8+YIsSvraKKJuxdelkrei7jKpE4H7TJCeKrbV3J426pBFi4QenHVe1vryP1t9C+CmKnF7Y74JWZy+2/WtqB9dW6SB7c9og9HQ5fINwM8gNdsEyn++WaLQKBW8RKFRKniJQqNU8BKFRqngJQqNLwEZWErzngOVuwAAAABJRU5ErkJggg&#x3D;&#x3D;\"></div></a></figure>","comment_id":"639a2d70bbda300a2f29c627","plaintext":"When do you have function that returns different types in dependence from\nparameter values overload signatures can be exactly what do you need.\n\nLet me introduce context.\n\nWe have super simple function that computes volume of hypercube:\n\ninterface HyperCube {\n    size: number\n    dimension: number\n}\n\nexport function volume(cube: HyperCube): number {\n    return Math.pow(cube.size, cube.dimension);\n}\n\nBut because of our volumes are really huge we need display them in snake case\nnotation. Eg.: 1_000_000_000 instead of 1000000000.\n\nWe can add function to format\n\nexport function formatNumber(num: number): string {\n    return num.toString().replace(/(\\d)(?=(\\d{3})+(?!\\d))/g, '$1_')\n}\n\nbut we do not want to write this formatNumber function always when we using\nconversion to string. Instead we would like to add second parameter to volume \nfunction to decide if we returning string or number.\n\nexport function volume(cube: HyperCube, asString: boolean = false): string | number {\n    const volume = Math.pow(cube.size, cube.dimension);\n    return asString ? formatNumber(volume) : volume;\n}\n\nUnfortunately now using volume function we do not know if we will get string or \nnumber. We do not want to use .toString or parseInt any time.\n\nFortunately there is concept called overload signatures. It allows to select\nreturned type in dependence from parameters values.\n\nIn our case we want number is asString is false, in other case we need return \nstring. To apply overload signature we can use the following syntax\n\nexport function volume(cube: HyperCube, asString: false): number\nexport function volume(cube: HyperCube, asString: true): string\nexport function volume(cube: HyperCube, asString: boolean = false): string | number {\n    const volume = Math.pow(cube.size, cube.dimension);\n    return asString ? formatNumber(volume) : volume;\n}\n\nnow our returned type is correct and depend from asString value.\n\nSources:\n\nTypeScript function return type based on input parameterI have a few different\ninterfaces and objects that each have a type property. Let’s say these are\nobjects stored in a NoSQL db. How can I create a generic getItem function with\na\ndeterministic returnStack OverflowArash Motamedi\n[https://stackoverflow.com/questions/54165536/typescript-function-return-type-based-on-input-parameter]\nDocumentation - More on FunctionsLearn about how Functions work in TypeScript.\nMore on Functions\n[https://www.typescriptlang.org/docs/handbook/2/functions.html#function-overloads]","feature_image":"__GHOST_URL__/content/images/2022/12/assets.euromoneydigital.jpg","featured":0,"type":"post","status":"published","locale":null,"visibility":"public","email_recipient_filter":"all","created_at":"2022-12-14T20:09:20.000Z","updated_at":"2022-12-14T21:02:01.000Z","published_at":"2022-12-14T21:02:01.000Z","custom_excerpt":"In TypeScript, we can specify a function that can be called in different ways by writing overload signatures. You can use this to define functions with returned type dependent from arguments values.","codeinjection_head":null,"codeinjection_foot":null,"custom_template":null,"canonical_url":null,"newsletter_id":null,"lexical":null},{"id":"63c6d6b0bbda300a2f29c6c6","uuid":"ddc25529-f84e-4699-a949-4c644aca70d1","title":"CodinGame: ASCI Art - Rust, NodeJs - Strings, Arrays, Loops","slug":"asci-art-rust-nodejs","mobiledoc":"{\"version\":\"0.3.1\",\"atoms\":[[\"soft-return\",\"\",{}],[\"soft-return\",\"\",{}],[\"soft-return\",\"\",{}],[\"soft-return\",\"\",{}],[\"soft-return\",\"\",{}],[\"soft-return\",\"\",{}]],\"cards\":[[\"image\",{\"src\":\"__GHOST_URL__/content/images/2023/01/led_display.jpg\",\"width\":332,\"height\":97}],[\"code\",{\"code\":\"# #  #  ### # #  #  ### ###  #  ###\\n### # # # # # # # #  #   #  # # # #\\n### ### # # ### ###  #   #  ### # #\\n# # # # # # # # # #  #   #  # # # #\\n# # # # # # # # # #  #   #  # # # #\"}],[\"code\",{\"code\":\"4\\n5 \\nE\\n #  ##   ## ##  ### ###  ## # # ###  ## # # #   # # ###  #  ##   #  ##   ## ### # # # # # # # # # # ### ### \\n# # # # #   # # #   #   #   # #  #    # # # #   ### # # # # # # # # # # #    #  # # # # # # # # # #   #   # \\n### ##  #   # # ##  ##  # # ###  #    # ##  #   ### # # # # ##  # # ##   #   #  # # # # ###  #   #   #   ## \\n# # # # #   # # #   #   # # # #  #  # # # # #   # # # # # # #    ## # #   #  #  # # # # ### # #  #  #       \\n# # ##   ## ##  ### #    ## # # ###  #  # # ### # # # #  #  #     # # # ##   #  ###  #  # # # #  #  ###  #  \"}],[\"code\",{\"code\":\"### \\n#   \\n##  \\n#   \\n### \"}],[\"code\",{\"code\":\"4\\n5\\nMANHATTAN\\n #  ##   ## ##  ### ###  ## # # ###  ## # # #   # # ###  #  ##   #  ##   ## ### # # # # # # # # # # ### ### \\n# # # # #   # # #   #   #   # #  #    # # # #   ### # # # # # # # # # # #    #  # # # # # # # # # #   #   # \\n### ##  #   # # ##  ##  # # ###  #    # ##  #   ### # # # # ##  # # ##   #   #  # # # # ###  #   #   #   ## \\n# # # # #   # # #   #   # # # #  #  # # # # #   # # # # # # #    ## # #   #  #  # # # # ### # #  #  #       \\n# # ##   ## ##  ### #    ## # # ###  #  # # ### # # # #  #  #     # # # ##   #  ###  #  # # # #  #  ###  #  \"}],[\"code\",{\"code\":\"# #  #  ### # #  #  ### ###  #  ###  \\n### # # # # # # # #  #   #  # # # #  \\n### ### # # ### ###  #   #  ### # #  \\n# # # # # # # # # #  #   #  # # # #  \\n# # # # # # # # # #  #   #  # # # # \"}],[\"bookmark\",{\"type\":\"bookmark\",\"url\":\"https://www.codingame.com/ide/puzzle/ascii-art\",\"metadata\":{\"url\":\"https://www.codingame.com/ide/puzzle/ascii-art\",\"title\":\"Coding Games and Programming Challenges to Code Better\",\"description\":\"CodinGame is a challenge-based training platform for programmers where you can play with the hottest programming topics. Solve games, code AI bots, learn from your peers, have fun.\",\"author\":null,\"publisher\":\"CodinGame\",\"thumbnail\":\"https://files.codingame.com/codingame/codingame_share_pics.jpg\",\"icon\":\"https://static.codingame.com/assets/apple-touch-icon-152x152-precomposed.5cb052db.png\"}}],[\"code\",{\"code\":\"npm init -y\\ntsc --init\"}],[\"code\",{\"code\":\"npm i -D @types/node typescript\"}],[\"code\",{\"code\":\"import readlineModule from \\\"readline\\\";\\n\\nconst rl = readlineModule.createInterface({\\n    input: process.stdin,\\n    output: process.stdout,\\n    terminal: false\\n});\\n\\nconst lines: string[] = [];\\nlet readIndex = 0;\\n\\nrl.on('line', (line: string) => {\\n    lines.push(line)\\n});\\n\\nrl.on('close', () => {\\n    start();\\n})\\n\\nfunction readline() {\\n    return lines[readIndex++];\\n}\",\"language\":\"typescript\"}],[\"code\",{\"code\":\"function start() {\\n    const L: number = parseInt(readline());\\n    const H: number = parseInt(readline());\\n    const T: string = readline();\\n\\n    const a = new Alphabet(L, H);\\n    for (let i = 0; i < H; i++) {\\n        const ROW: string = readline();\\n        a.setRow(ROW);\\n    }\\n\\n    const res = a.get(T);\\n    res.forEach((row) => {\\n        console.log(row.replace(/\\\\s+$/, ''));\\n    });\\n}\",\"language\":\"typescript\"}],[\"code\",{\"code\":\"class Alphabet {\\n    l: number = 0;\\n    h: number = 0;\\n    rows: string[] = []\\n\\n    constructor(L: number, H: number) {\\n        this.l = L;\\n        this.h = H;\\n    }\\n\\n    setRow(line: string) {\\n        this.rows.push(line.padEnd((25 + 2) * this.l, \\\" \\\"));\\n    }\\n\\n    get(word: string): string[] {\\n        const aPosition = 'A'.charCodeAt(0);\\n        let rows = [...new Array(this.h)].map(() => '');\\n        for (let letter of word) {\\n            let pos: number = letter.toUpperCase().charCodeAt(0) - aPosition;\\n            if (pos < 0 || pos > 25) pos = this.rows[0].length / this.l - 1;\\n            for (let i = 0; i < this.h; i++) {\\n                rows[i] += this.rows[i].substring(pos * this.l, (pos + 1) * this.l);\\n            }\\n        }\\n        return rows;\\n    }\\n}\",\"language\":\"typescript\"}],[\"code\",{\"code\":\"#!/bin/bash\\n\\ntestInOut() {\\n  for file in `ls ../cases/in*`\\n  do\\n    RES=$(cat < ${file} | ts-node index.ts)\\n    EXP=$(cat \\\"${file/in/\\\"out\\\"}\\\")\\n    assertEquals \\\"${EXP}\\\" \\\"${RES}\\\"\\n  done;\\n}\\n\\n# Load shUnit2.\\n. /usr/share/shunit2/shunit2\",\"language\":\"bash\"}],[\"bookmark\",{\"type\":\"bookmark\",\"url\":\"https://github.com/gustawdaniel/asci-art-rust-node-js/tree/main/cases\",\"metadata\":{\"url\":\"https://github.com/gustawdaniel/asci-art-rust-node-js\",\"title\":\"asci-art-rust-node-js/cases at main · gustawdaniel/asci-art-rust-node-js\",\"description\":\"Contribute to gustawdaniel/asci-art-rust-node-js development by creating an account on GitHub.\",\"author\":\"gustawdaniel\",\"publisher\":\"GitHub\",\"thumbnail\":\"https://opengraph.githubassets.com/eab81b748e6df897c8f1f504304f64535b3fe2515345883fefb716d3ffe7889d/gustawdaniel/asci-art-rust-node-js\",\"icon\":\"https://github.githubassets.com/favicons/favicon.svg\"}}],[\"code\",{\"code\":\"name: Node.js CI\\n\\non:\\n  push:\\n    branches: [ \\\"main\\\" ]\\n    paths: [ \\\"node/**\\\" ]\\n\\nenv:\\n  working-directory: ./node\\n\\njobs:\\n  build:\\n    runs-on: ubuntu-latest\\n\\n    defaults:\\n      run:\\n        working-directory: ${{ env.working-directory }}\\n\\n    strategy:\\n      matrix:\\n        node-version: [14.x, 16.x, 18.x]\\n\\n    steps:\\n      - uses: actions/checkout@v3\\n      - name: Install shunit\\n        run: sudo apt install -y shunit2\\n      - name: Use Node.js ${{ matrix.node-version }}\\n        uses: actions/setup-node@v3\\n        with:\\n          node-version: ${{ matrix.node-version }}\\n          cache: 'npm'\\n          cache-dependency-path: ${{ env.working-directory }}/package-lock.json\\n      - run: npm ci\\n      - run: npm install -g ts-node\\n      - run: npm run build --if-present\\n      - run: npm test\\n\",\"language\":\"yml\"}],[\"code\",{\"code\":\"  \\\"scripts\\\": {\\n    \\\"test\\\": \\\"./shunit.sh\\\"\\n  },\",\"language\":\"json\"}],[\"code\",{\"code\":\"use std::io;\\n\\nmacro_rules! parse_input {\\n    ($x:expr, $t:ident) => ($x.trim().parse::<$t>().unwrap())\\n}\\n\\nfn char_code_at(letter: char) -> u32 {\\n    u32::from(letter)\\n}\\n\\nfn lpad(word: String, len: usize) -> String {\\n    format!(\\\"{:<1$}\\\", word, len)\\n}\\n\\nfn concat_str(a: &str, b: &str) -> String {\\n    a.to_string() + b\\n}\\n\\n#[cfg(test)]\\nmod tests {\\n    use crate::{char_code_at, concat_str, lpad};\\n\\n    #[test]\\n    fn char_code_at_test() {\\n        assert_eq!(char_code_at('A'), 65);\\n    }\\n\\n    #[test]\\n    fn pad() {\\n        assert_eq!(lpad(String::from(\\\"ab\\\"), 3).len(), 3);\\n    }\\n\\n    #[test]\\n    fn concat() {\\n        assert_eq!(concat_str(\\\"a\\\", \\\"b\\\"), \\\"ab\\\");\\n    }\\n}\",\"language\":\"rust\"}],[\"code\",{\"code\":\"fn main() {\\n    let mut input_line = String::new();\\n    io::stdin().read_line(&mut input_line).unwrap();\\n    let l = parse_input!(input_line, i32);\\n    let mut input_line = String::new();\\n    io::stdin().read_line(&mut input_line).unwrap();\\n    let h = parse_input!(input_line, i32);\\n    let mut input_line = String::new();\\n    io::stdin().read_line(&mut input_line).unwrap();\\n    let t = input_line.trim_matches('\\\\n').to_string();\\n\\n    let mut a = Alphabet::new(l, h);\\n\\n    for _i in 0..h {\\n        let mut input_line = String::new();\\n        io::stdin().read_line(&mut input_line).unwrap();\\n        let row = input_line.trim_matches('\\\\n').to_string();\\n        a.set_row(row)\\n    }\\n\\n    let res = a.get(t);\\n    for r in res {\\n        println!(\\\"{}\\\", r.trim_end_matches(\\\" \\\"));\\n    }\\n}\",\"language\":\"rust\"}],[\"code\",{\"code\":\"struct Alphabet {\\n    h: usize,\\n    l: usize,\\n    rows: Vec<String>,\\n}\",\"language\":\"rust\"}],[\"code\",{\"code\":\"impl Alphabet {\\n    fn new(l: i32, h: i32) -> Alphabet {\\n        Alphabet {\\n            l: l as usize,\\n            h: h as usize,\\n            rows: vec![],\\n        }\\n    }\",\"language\":\"rust\"}],[\"code\",{\"code\":\"    fn set_row(&mut self, row: String) -> () {\\n        let line = lpad(row, (25 + 2) * self.l);\\n        self.rows.push(line);\\n    }\",\"language\":\"rust\"}],[\"code\",{\"code\":\"fn get(&self, word: String) -> Vec<String> {\\n        let a_position = char_code_at('A');\\n        let mut rows: Vec<String> = std::iter::repeat(String::from(\\\"\\\")).take(self.h).collect();\\n        for letter in word.chars() {\\n            let mut pos: i32 = char_code_at(letter.to_ascii_uppercase()) as i32 - a_position as i32;\\n            if pos < 0 || pos > 25 {\\n                pos = (self.rows[0].len() / self.l - 1) as i32\\n            }\\n            let pos: usize = pos as usize;\\n\\n            for i in 0..self.h {\\n                rows[i as usize] = concat_str(\\n                    &rows[i],\\n                    &self.rows[i as usize][pos * self.l..(pos + 1) * self.l],\\n                )\\n            }\\n        }\\n\\n        rows\\n    }\\n}\",\"language\":\"rust\"}],[\"code\",{\"code\":\"name: Rust\\n\\non:\\n  push:\\n    branches: [ \\\"main\\\" ]\\n    paths: [ \\\"rust/**\\\" ]\\n\\nenv:\\n  CARGO_TERM_COLOR: always\\n  working-directory: ./rust\\n\\njobs:\\n  build:\\n    runs-on: ubuntu-latest\\n    steps:\\n      - uses: actions/checkout@v3\\n      - name: Build\\n        run: cargo build --verbose\\n        working-directory: ${{ env.working-directory }}\\n\\n  test:\\n    runs-on: ubuntu-latest\\n    steps:\\n      - uses: actions/checkout@v3\\n      - name: Run tests\\n        run: cargo test --verbose\\n        working-directory: ${{ env.working-directory }}\\n\\n  e2e:\\n    runs-on: ubuntu-latest\\n    steps:\\n      - uses: actions/checkout@v3\\n      - name: Install shunit\\n        run: sudo apt install -y shunit2\\n      - name: Check files\\n        run: ls ../cases/in*\\n        working-directory: ${{ env.working-directory }}\\n      - name: Test with shunit\\n        run: ./shunit.sh\\n        working-directory: ${{ env.working-directory }}\\n\\n\",\"language\":\"yml\"}],[\"bookmark\",{\"type\":\"bookmark\",\"url\":\"https://github.com/gustawdaniel/asci-art-rust-node-js\",\"metadata\":{\"url\":\"https://github.com/gustawdaniel/asci-art-rust-node-js\",\"title\":\"GitHub - gustawdaniel/asci-art-rust-node-js\",\"description\":\"Contribute to gustawdaniel/asci-art-rust-node-js development by creating an account on GitHub.\",\"author\":\"gustawdaniel\",\"publisher\":\"GitHub\",\"thumbnail\":\"https://opengraph.githubassets.com/eab81b748e6df897c8f1f504304f64535b3fe2515345883fefb716d3ffe7889d/gustawdaniel/asci-art-rust-node-js\",\"icon\":\"https://github.githubassets.com/favicons/favicon.svg\"}}]],\"markups\":[[\"a\",[\"href\",\"https://www.codingame.com/learn/strings\"]],[\"a\",[\"href\",\"https://www.codingame.com/learn/arrays\"]],[\"a\",[\"href\",\"https://www.codingame.com/learn/loops\"]],[\"strong\"],[\"code\"],[\"a\",[\"href\",\"https://www.codingame.com/servlet/urlinvite?u=5287657\"]]],\"sections\":[[1,\"p\",[[0,[],0,\"The goal of the problem is to simulate an old airport terminal display: your program must display a line of text in ASCII art.\"]]],[1,\"p\",[[0,[],0,\"You have to split strings, store them and recreate others. You can use data structures like arrays or hash tables.\"]]],[1,\"p\",[[0,[],0,\"It can be solved using the following concepts. \"]]],[3,\"ul\",[[[0,[0],1,\"Strings\"]],[[0,[1],1,\"Arrays\"]],[[0,[2],1,\"Loops\"]]]],[1,\"h2\",[[0,[3],1,\"The Goal\"]]],[1,\"p\",[[1,[],0,0],[0,[],0,\"In stations and airports you often see this type of screen:\"]]],[10,0],[1,\"p\",[[0,[],0,\"Have you ever asked yourself how it might be possible to simulate this display on a good old terminal? We have: with ASCII art!\"]]],[1,\"h2\",[[0,[],0,\"Rules\"]]],[1,\"p\",[[0,[],0,\"ASCII art allows you to represent forms by using characters. To be precise, in our case, these forms are words. For example, the word \\\"MANHATTAN\\\" could be displayed as follows in ASCII art:\"]]],[10,1],[1,\"p\",[[0,[],0,\"​Your mission is to write a program that can display a line of text in ASCII art in a style you are given as input.\"]]],[1,\"h2\",[[0,[],0,\"Game Input\"]]],[1,\"p\",[[1,[],0,1],[0,[3],1,\"Input\"]]],[1,\"p\",[[0,[3],1,\"Line 1: \"],[0,[],0,\"the width \"],[0,[4],1,\"L\"],[0,[],0,\" of a letter represented in ASCII art. All letters are the same width.\"]]],[1,\"p\",[[0,[3],1,\"Line 2: \"],[0,[],0,\"the height \"],[0,[4],1,\"H\"],[0,[],0,\" of a letter represented in ASCII art. All letters are the same height.\"]]],[1,\"p\",[[0,[3],1,\"Line 3: \"],[0,[],0,\"The line of text \"],[0,[4],1,\"T\"],[0,[],0,\", composed of \"],[0,[4],1,\"N\"],[0,[],0,\" ASCII characters.\"]]],[1,\"p\",[[0,[3],1,\"Following lines: \"],[0,[],0,\"the string of characters ABCDEFGHIJKLMNOPQRSTUVWXYZ? Represented in ASCII art.\"]]],[1,\"p\",[[0,[3],1,\"Output\"]]],[1,\"p\",[[0,[],0,\"The text \"],[0,[4],1,\"T\"],[0,[],0,\" in ASCII art.\"],[1,[],0,2],[0,[],0,\"The characters a to z are shown in ASCII art by their equivalent in upper case.\"],[1,[],0,3],[0,[],0,\"The characters that are not in the intervals [a-z] or [A-Z] will be shown as a question mark in ASCII art.\"]]],[1,\"p\",[[0,[3],1,\"Constraints\"]]],[1,\"p\",[[0,[],0,\"0 < \"],[0,[4],1,\"L\"],[0,[],0,\" < 30\"],[1,[],0,4],[0,[],0,\"0 < \"],[0,[4],1,\"H\"],[0,[],0,\" < 30\"],[1,[],0,5],[0,[],0,\"0 < \"],[0,[4],1,\"N\"],[0,[],0,\" < 200\"]]],[1,\"p\",[[0,[3],1,\"Example 1\"]]],[1,\"p\",[[0,[3],1,\"Input\"]]],[10,2],[1,\"p\",[[0,[3],1,\"Output\"]]],[10,3],[1,\"p\",[[0,[3],1,\"Example 2\"]]],[1,\"p\",[[0,[3],1,\"Input\"]]],[10,4],[1,\"p\",[[0,[3],1,\"Output\"]]],[10,5],[1,\"h2\",[[0,[],0,\"Source\"]]],[1,\"p\",[[0,[],0,\"This exercise can be found on codingame.com\"]]],[10,6],[1,\"h2\",[[0,[],0,\"Solution in NodeJs\"]]],[1,\"p\",[[0,[],0,\"We will have three directories: \"],[0,[4],1,\"node\"],[0,[],0,\", \"],[0,[4],1,\"rust\"],[0,[],0,\" and \"],[0,[4],1,\"cases\"],[0,[],0,\" with text inputs and outputs files. In \"],[0,[4],1,\"node\"],[0,[],0,\" we can setup project using commands\"]]],[10,7],[1,\"p\",[[0,[],0,\"in \"],[0,[4],1,\"tsconfig.json\"],[0,[],0,\" we will change \"],[0,[4],1,\"target\"],[0,[],0,\" to \"],[0,[4],1,\"ESNext\"],[0,[],0,\" to be able to use \"],[0,[4],1,\"padEnd\"],[0,[],0,\" in our code. Additionally we should install dev dependencies:\"]]],[10,8],[1,\"h3\",[[0,[],0,\"Reading lines\"]]],[1,\"p\",[[0,[],0,\"We want to pass input by standard input to program. Using module \"],[0,[4],1,\"readline\"],[0,[],0,\" we can listen on lines and end of input. Any line will be added to \"],[0,[4],1,\"lines\"],[0,[],0,\" array. When all input will be read, we will call \"],[0,[4],1,\"start\"],[0,[],0,\" function that we will define later. \"]]],[10,9],[1,\"p\",[[0,[],0,\"Additionally we defined \"],[0,[4],1,\"readline\"],[0,[],0,\" function that will give us next lines from \"],[0,[4],1,\"lines\"],[0,[],0,\" array.\"]]],[1,\"h3\",[[0,[],0,\"Interface of class that process input\"]]],[1,\"p\",[[0,[],0,\"We will create class \"],[0,[4],1,\"Alphabet\"],[0,[],0,\" that will need size of letter in \"],[0,[4],1,\"constructor\"],[0,[],0,\". Then we will save rows one by one and finally we need get array of rows for given string. We will focus on implementation later, but now let's see \"],[0,[4],1,\"start\"],[0,[],0,\" function mentioned before: \"]]],[10,10],[1,\"p\",[[0,[],0,\"this function will be called when input will be saved to \"],[0,[4],1,\"lines\"],[0,[],0,\". Now we can focus on implementation of \"],[0,[4],1,\"Alphabet\"]]],[1,\"h3\",[[0,[],0,\"Processing rows\"]]],[1,\"p\",[[0,[],0,\"In \"],[0,[4],1,\"setRow\"],[0,[],0,\" we adding lines to \"],[0,[4],1,\"rows\"],[0,[],0,\" property, but \"],[0,[4],1,\"padEnd\"],[0,[],0,\" allow to append spaces at the end of rows to simplify further processing.\"]]],[10,11],[1,\"p\",[[0,[],0,\"Function \"],[0,[4],1,\"get\"],[0,[],0,\" starts from getting asci code of \"],[0,[4],1,\"A\"],[0,[],0,\". Then we preparing empty output rows. For any letters from expected word we are computing position in our alphabeth using asci codes. Substrings correcponding to these letters are added to rows. Finally fulfilled rows are returned from method \"],[0,[4],1,\"get\"],[0,[],0,\".\"]]],[1,\"h3\",[[0,[],0,\"Shunit for node js\"]]],[1,\"p\",[[0,[],0,\"To test we can use \"],[0,[4],1,\"shunit2\"],[0,[],0,\" because this framework can be applied to any language and is great to use in cases where we have to test input and output of bash commands.\"]]],[1,\"p\",[[0,[],0,\"This is our \"],[0,[4],1,\"shunit.sh\"],[0,[],0,\" content\"]]],[10,12],[1,\"p\",[[0,[],0,\"There is fragment \"],[0,[4],1,\"${file/in/\\\"out\\\"}\"],[0,[],0,\" - it means that we replacing \"],[0,[4],1,\"in\"],[0,[],0,\" by \"],[0,[4],1,\"out\"],[0,[],0,\" in paths to files. Files in \"],[0,[4],1,\"cases\"],[0,[],0,\" are starting from \"],[0,[4],1,\"in\"],[0,[],0,\" or \"],[0,[4],1,\"out\"],[0,[],0,\" having rest of names the same. You can check them in github repository:\"]]],[10,13],[1,\"p\",[[0,[],0,\"Node workflow is the following\"]]],[10,14],[1,\"p\",[[0,[],0,\"to make it working we should add proper \"],[0,[4],1,\"scripts\"],[0,[],0,\" in \"],[0,[4],1,\"package.json\"]]],[10,15],[1,\"h2\",[[0,[],0,\"Solution in Rust\"]]],[1,\"p\",[[0,[],0,\"We will follow the same schema as in NodeJs. Our code can be divide to helpers, input/output processing and struct \"],[0,[4],1,\"Alphabet\"],[0,[],0,\" with their methods.\"]]],[1,\"h3\",[[0,[],0,\"Helpers for string\"]]],[1,\"p\",[[0,[],0,\"In \"],[0,[4],1,\"src/main.rs\"],[0,[],0,\" we can start file from\"]]],[10,16],[1,\"p\",[[0,[],0,\"there are one macro and test for three operations:\"]]],[3,\"ul\",[[[0,[],0,\"getting ASCI code for character\"]],[[0,[],0,\"left pad that use \"],[0,[4],1,\"format\"]],[[0,[],0,\"concatenation to merge two strings\"]]]],[1,\"h3\",[[0,[],0,\"Input and output processing\"]]],[1,\"p\",[[0,[],0,\"Our \"],[0,[4],1,\"main\"],[0,[],0,\" function will be responsible for reading input and printing output. Rest of login si moved to \"],[0,[4],1,\"Alphabet\"],[0,[],0,\" structure. Now we will show \"],[0,[4],1,\"main\"],[0,[],0,\" function:\"]]],[10,17],[1,\"p\",[[0,[],0,\"It is quite simple, so we can go to \"],[0,[4],1,\"Alphabet\"],[0,[],0,\" implementation.\"]]],[1,\"h3\",[[0,[],0,\"ASCI Art in rust\"]]],[1,\"p\",[[0,[],0,\"Struct can be declared as\"]]],[10,18],[1,\"p\",[[0,[],0,\"We will get \"],[0,[4],1,\"i32\"],[0,[],0,\" in \"],[0,[4],1,\"main\"],[0,[],0,\" so to convert them to \"],[0,[4],1,\"usize\"],[0,[],0,\" we adding casting to constructor\"]]],[10,19],[1,\"p\",[[0,[],0,\"when we adding rows we will need \"],[0,[4],1,\"lpad\"]]],[10,20],[1,\"p\",[[0,[],0,\"finally implementation of \"],[0,[4],1,\"get\"],[0,[],0,\" can be written in following way:\"]]],[10,21],[1,\"h3\",[[0,[],0,\"Tests in rust\"]]],[1,\"p\",[[0,[],0,\"Our shunit will be almost the same as in \"],[0,[4],1,\"node\"],[0,[],0,\". Only difference is \"],[0,[4],1,\"cargo run\"],[0,[],0,\" instead of \"],[0,[4],1,\"ts-node index.ts\"],[0,[],0,\". Workflow can be divided to building, unit tests and e2e tests\"]]],[10,22],[1,\"h3\",[[0,[],0,\"Summary\"]]],[1,\"p\",[[0,[],0,\"I hope this article will be helpful for learning basic concepts from rust or javascript. Full code can be seen here:\"]]],[10,23],[1,\"p\",[[0,[],0,\"If you want to solve similar problems you can create account on \"],[0,[4],1,\"codingame\"],[0,[],0,\" using link:\"]]],[1,\"p\",[[0,[5],1,\"https://www.codingame.com/servlet/urlinvite?u=5287657\"]]]],\"ghostVersion\":\"4.0\"}","html":"<p>The goal of the problem is to simulate an old airport terminal display: your program must display a line of text in ASCII art.</p><p>You have to split strings, store them and recreate others. You can use data structures like arrays or hash tables.</p><p>It can be solved using the following concepts. </p><ul><li><a href=\"https://www.codingame.com/learn/strings\">Strings</a></li><li><a href=\"https://www.codingame.com/learn/arrays\">Arrays</a></li><li><a href=\"https://www.codingame.com/learn/loops\">Loops</a></li></ul><h2 id=\"the-goal\"><strong>The Goal</strong></h2><p><br>In stations and airports you often see this type of screen:</p><figure class=\"kg-card kg-image-card\"><img src=\"__GHOST_URL__/content/images/2023/01/led_display.jpg\" class=\"kg-image\" alt loading=\"lazy\" width=\"332\" height=\"97\"></figure><p>Have you ever asked yourself how it might be possible to simulate this display on a good old terminal? We have: with ASCII art!</p><h2 id=\"rules\">Rules</h2><p>ASCII art allows you to represent forms by using characters. To be precise, in our case, these forms are words. For example, the word \"MANHATTAN\" could be displayed as follows in ASCII art:</p><pre><code># #  #  ### # #  #  ### ###  #  ###\n### # # # # # # # #  #   #  # # # #\n### ### # # ### ###  #   #  ### # #\n# # # # # # # # # #  #   #  # # # #\n# # # # # # # # # #  #   #  # # # #</code></pre><p>​Your mission is to write a program that can display a line of text in ASCII art in a style you are given as input.</p><h2 id=\"game-input\">Game Input</h2><p><br><strong>Input</strong></p><p><strong>Line 1: </strong>the width <code>L</code> of a letter represented in ASCII art. All letters are the same width.</p><p><strong>Line 2: </strong>the height <code>H</code> of a letter represented in ASCII art. All letters are the same height.</p><p><strong>Line 3: </strong>The line of text <code>T</code>, composed of <code>N</code> ASCII characters.</p><p><strong>Following lines: </strong>the string of characters ABCDEFGHIJKLMNOPQRSTUVWXYZ? Represented in ASCII art.</p><p><strong>Output</strong></p><p>The text <code>T</code> in ASCII art.<br>The characters a to z are shown in ASCII art by their equivalent in upper case.<br>The characters that are not in the intervals [a-z] or [A-Z] will be shown as a question mark in ASCII art.</p><p><strong>Constraints</strong></p><p>0 &lt; <code>L</code> &lt; 30<br>0 &lt; <code>H</code> &lt; 30<br>0 &lt; <code>N</code> &lt; 200</p><p><strong>Example 1</strong></p><p><strong>Input</strong></p><pre><code>4\n5 \nE\n #  ##   ## ##  ### ###  ## # # ###  ## # # #   # # ###  #  ##   #  ##   ## ### # # # # # # # # # # ### ### \n# # # # #   # # #   #   #   # #  #    # # # #   ### # # # # # # # # # # #    #  # # # # # # # # # #   #   # \n### ##  #   # # ##  ##  # # ###  #    # ##  #   ### # # # # ##  # # ##   #   #  # # # # ###  #   #   #   ## \n# # # # #   # # #   #   # # # #  #  # # # # #   # # # # # # #    ## # #   #  #  # # # # ### # #  #  #       \n# # ##   ## ##  ### #    ## # # ###  #  # # ### # # # #  #  #     # # # ##   #  ###  #  # # # #  #  ###  #  </code></pre><p><strong>Output</strong></p><pre><code>### \n#   \n##  \n#   \n### </code></pre><p><strong>Example 2</strong></p><p><strong>Input</strong></p><pre><code>4\n5\nMANHATTAN\n #  ##   ## ##  ### ###  ## # # ###  ## # # #   # # ###  #  ##   #  ##   ## ### # # # # # # # # # # ### ### \n# # # # #   # # #   #   #   # #  #    # # # #   ### # # # # # # # # # # #    #  # # # # # # # # # #   #   # \n### ##  #   # # ##  ##  # # ###  #    # ##  #   ### # # # # ##  # # ##   #   #  # # # # ###  #   #   #   ## \n# # # # #   # # #   #   # # # #  #  # # # # #   # # # # # # #    ## # #   #  #  # # # # ### # #  #  #       \n# # ##   ## ##  ### #    ## # # ###  #  # # ### # # # #  #  #     # # # ##   #  ###  #  # # # #  #  ###  #  </code></pre><p><strong>Output</strong></p><pre><code># #  #  ### # #  #  ### ###  #  ###  \n### # # # # # # # #  #   #  # # # #  \n### ### # # ### ###  #   #  ### # #  \n# # # # # # # # # #  #   #  # # # #  \n# # # # # # # # # #  #   #  # # # # </code></pre><h2 id=\"source\">Source</h2><p>This exercise can be found on codingame.com</p><figure class=\"kg-card kg-bookmark-card\"><a class=\"kg-bookmark-container\" href=\"https://www.codingame.com/ide/puzzle/ascii-art\"><div class=\"kg-bookmark-content\"><div class=\"kg-bookmark-title\">Coding Games and Programming Challenges to Code Better</div><div class=\"kg-bookmark-description\">CodinGame is a challenge-based training platform for programmers where you can play with the hottest programming topics. Solve games, code AI bots, learn from your peers, have fun.</div><div class=\"kg-bookmark-metadata\"><img class=\"kg-bookmark-icon\" src=\"https://static.codingame.com/assets/apple-touch-icon-152x152-precomposed.5cb052db.png\"><span class=\"kg-bookmark-author\">CodinGame</span></div></div><div class=\"kg-bookmark-thumbnail\"><img src=\"https://files.codingame.com/codingame/codingame_share_pics.jpg\"></div></a></figure><h2 id=\"solution-in-nodejs\">Solution in NodeJs</h2><p>We will have three directories: <code>node</code>, <code>rust</code> and <code>cases</code> with text inputs and outputs files. In <code>node</code> we can setup project using commands</p><pre><code>npm init -y\ntsc --init</code></pre><p>in <code>tsconfig.json</code> we will change <code>target</code> to <code>ESNext</code> to be able to use <code>padEnd</code> in our code. Additionally we should install dev dependencies:</p><pre><code>npm i -D @types/node typescript</code></pre><h3 id=\"reading-lines\">Reading lines</h3><p>We want to pass input by standard input to program. Using module <code>readline</code> we can listen on lines and end of input. Any line will be added to <code>lines</code> array. When all input will be read, we will call <code>start</code> function that we will define later. </p><pre><code class=\"language-typescript\">import readlineModule from \"readline\";\n\nconst rl = readlineModule.createInterface({\n    input: process.stdin,\n    output: process.stdout,\n    terminal: false\n});\n\nconst lines: string[] = [];\nlet readIndex = 0;\n\nrl.on('line', (line: string) =&gt; {\n    lines.push(line)\n});\n\nrl.on('close', () =&gt; {\n    start();\n})\n\nfunction readline() {\n    return lines[readIndex++];\n}</code></pre><p>Additionally we defined <code>readline</code> function that will give us next lines from <code>lines</code> array.</p><h3 id=\"interface-of-class-that-process-input\">Interface of class that process input</h3><p>We will create class <code>Alphabet</code> that will need size of letter in <code>constructor</code>. Then we will save rows one by one and finally we need get array of rows for given string. We will focus on implementation later, but now let's see <code>start</code> function mentioned before: </p><pre><code class=\"language-typescript\">function start() {\n    const L: number = parseInt(readline());\n    const H: number = parseInt(readline());\n    const T: string = readline();\n\n    const a = new Alphabet(L, H);\n    for (let i = 0; i &lt; H; i++) {\n        const ROW: string = readline();\n        a.setRow(ROW);\n    }\n\n    const res = a.get(T);\n    res.forEach((row) =&gt; {\n        console.log(row.replace(/\\s+$/, ''));\n    });\n}</code></pre><p>this function will be called when input will be saved to <code>lines</code>. Now we can focus on implementation of <code>Alphabet</code></p><h3 id=\"processing-rows\">Processing rows</h3><p>In <code>setRow</code> we adding lines to <code>rows</code> property, but <code>padEnd</code> allow to append spaces at the end of rows to simplify further processing.</p><pre><code class=\"language-typescript\">class Alphabet {\n    l: number = 0;\n    h: number = 0;\n    rows: string[] = []\n\n    constructor(L: number, H: number) {\n        this.l = L;\n        this.h = H;\n    }\n\n    setRow(line: string) {\n        this.rows.push(line.padEnd((25 + 2) * this.l, \" \"));\n    }\n\n    get(word: string): string[] {\n        const aPosition = 'A'.charCodeAt(0);\n        let rows = [...new Array(this.h)].map(() =&gt; '');\n        for (let letter of word) {\n            let pos: number = letter.toUpperCase().charCodeAt(0) - aPosition;\n            if (pos &lt; 0 || pos &gt; 25) pos = this.rows[0].length / this.l - 1;\n            for (let i = 0; i &lt; this.h; i++) {\n                rows[i] += this.rows[i].substring(pos * this.l, (pos + 1) * this.l);\n            }\n        }\n        return rows;\n    }\n}</code></pre><p>Function <code>get</code> starts from getting asci code of <code>A</code>. Then we preparing empty output rows. For any letters from expected word we are computing position in our alphabeth using asci codes. Substrings correcponding to these letters are added to rows. Finally fulfilled rows are returned from method <code>get</code>.</p><h3 id=\"shunit-for-node-js\">Shunit for node js</h3><p>To test we can use <code>shunit2</code> because this framework can be applied to any language and is great to use in cases where we have to test input and output of bash commands.</p><p>This is our <code>shunit.sh</code> content</p><pre><code class=\"language-bash\">#!/bin/bash\n\ntestInOut() {\n  for file in `ls ../cases/in*`\n  do\n    RES=$(cat &lt; ${file} | ts-node index.ts)\n    EXP=$(cat \"${file/in/\"out\"}\")\n    assertEquals \"${EXP}\" \"${RES}\"\n  done;\n}\n\n# Load shUnit2.\n. /usr/share/shunit2/shunit2</code></pre><p>There is fragment <code>${file/in/\"out\"}</code> - it means that we replacing <code>in</code> by <code>out</code> in paths to files. Files in <code>cases</code> are starting from <code>in</code> or <code>out</code> having rest of names the same. You can check them in github repository:</p><figure class=\"kg-card kg-bookmark-card\"><a class=\"kg-bookmark-container\" href=\"https://github.com/gustawdaniel/asci-art-rust-node-js/tree/main/cases\"><div class=\"kg-bookmark-content\"><div class=\"kg-bookmark-title\">asci-art-rust-node-js/cases at main · gustawdaniel/asci-art-rust-node-js</div><div class=\"kg-bookmark-description\">Contribute to gustawdaniel/asci-art-rust-node-js development by creating an account on GitHub.</div><div class=\"kg-bookmark-metadata\"><img class=\"kg-bookmark-icon\" src=\"https://github.githubassets.com/favicons/favicon.svg\"><span class=\"kg-bookmark-author\">GitHub</span><span class=\"kg-bookmark-publisher\">gustawdaniel</span></div></div><div class=\"kg-bookmark-thumbnail\"><img src=\"https://opengraph.githubassets.com/eab81b748e6df897c8f1f504304f64535b3fe2515345883fefb716d3ffe7889d/gustawdaniel/asci-art-rust-node-js\"></div></a></figure><p>Node workflow is the following</p><pre><code class=\"language-yml\">name: Node.js CI\n\non:\n  push:\n    branches: [ \"main\" ]\n    paths: [ \"node/**\" ]\n\nenv:\n  working-directory: ./node\n\njobs:\n  build:\n    runs-on: ubuntu-latest\n\n    defaults:\n      run:\n        working-directory: ${{ env.working-directory }}\n\n    strategy:\n      matrix:\n        node-version: [14.x, 16.x, 18.x]\n\n    steps:\n      - uses: actions/checkout@v3\n      - name: Install shunit\n        run: sudo apt install -y shunit2\n      - name: Use Node.js ${{ matrix.node-version }}\n        uses: actions/setup-node@v3\n        with:\n          node-version: ${{ matrix.node-version }}\n          cache: 'npm'\n          cache-dependency-path: ${{ env.working-directory }}/package-lock.json\n      - run: npm ci\n      - run: npm install -g ts-node\n      - run: npm run build --if-present\n      - run: npm test\n</code></pre><p>to make it working we should add proper <code>scripts</code> in <code>package.json</code></p><pre><code class=\"language-json\">  \"scripts\": {\n    \"test\": \"./shunit.sh\"\n  },</code></pre><h2 id=\"solution-in-rust\">Solution in Rust</h2><p>We will follow the same schema as in NodeJs. Our code can be divide to helpers, input/output processing and struct <code>Alphabet</code> with their methods.</p><h3 id=\"helpers-for-string\">Helpers for string</h3><p>In <code>src/main.rs</code> we can start file from</p><pre><code class=\"language-rust\">use std::io;\n\nmacro_rules! parse_input {\n    ($x:expr, $t:ident) =&gt; ($x.trim().parse::&lt;$t&gt;().unwrap())\n}\n\nfn char_code_at(letter: char) -&gt; u32 {\n    u32::from(letter)\n}\n\nfn lpad(word: String, len: usize) -&gt; String {\n    format!(\"{:&lt;1$}\", word, len)\n}\n\nfn concat_str(a: &amp;str, b: &amp;str) -&gt; String {\n    a.to_string() + b\n}\n\n#[cfg(test)]\nmod tests {\n    use crate::{char_code_at, concat_str, lpad};\n\n    #[test]\n    fn char_code_at_test() {\n        assert_eq!(char_code_at('A'), 65);\n    }\n\n    #[test]\n    fn pad() {\n        assert_eq!(lpad(String::from(\"ab\"), 3).len(), 3);\n    }\n\n    #[test]\n    fn concat() {\n        assert_eq!(concat_str(\"a\", \"b\"), \"ab\");\n    }\n}</code></pre><p>there are one macro and test for three operations:</p><ul><li>getting ASCI code for character</li><li>left pad that use <code>format</code></li><li>concatenation to merge two strings</li></ul><h3 id=\"input-and-output-processing\">Input and output processing</h3><p>Our <code>main</code> function will be responsible for reading input and printing output. Rest of login si moved to <code>Alphabet</code> structure. Now we will show <code>main</code> function:</p><pre><code class=\"language-rust\">fn main() {\n    let mut input_line = String::new();\n    io::stdin().read_line(&amp;mut input_line).unwrap();\n    let l = parse_input!(input_line, i32);\n    let mut input_line = String::new();\n    io::stdin().read_line(&amp;mut input_line).unwrap();\n    let h = parse_input!(input_line, i32);\n    let mut input_line = String::new();\n    io::stdin().read_line(&amp;mut input_line).unwrap();\n    let t = input_line.trim_matches('\\n').to_string();\n\n    let mut a = Alphabet::new(l, h);\n\n    for _i in 0..h {\n        let mut input_line = String::new();\n        io::stdin().read_line(&amp;mut input_line).unwrap();\n        let row = input_line.trim_matches('\\n').to_string();\n        a.set_row(row)\n    }\n\n    let res = a.get(t);\n    for r in res {\n        println!(\"{}\", r.trim_end_matches(\" \"));\n    }\n}</code></pre><p>It is quite simple, so we can go to <code>Alphabet</code> implementation.</p><h3 id=\"asci-art-in-rust\">ASCI Art in rust</h3><p>Struct can be declared as</p><pre><code class=\"language-rust\">struct Alphabet {\n    h: usize,\n    l: usize,\n    rows: Vec&lt;String&gt;,\n}</code></pre><p>We will get <code>i32</code> in <code>main</code> so to convert them to <code>usize</code> we adding casting to constructor</p><pre><code class=\"language-rust\">impl Alphabet {\n    fn new(l: i32, h: i32) -&gt; Alphabet {\n        Alphabet {\n            l: l as usize,\n            h: h as usize,\n            rows: vec![],\n        }\n    }</code></pre><p>when we adding rows we will need <code>lpad</code></p><pre><code class=\"language-rust\">    fn set_row(&amp;mut self, row: String) -&gt; () {\n        let line = lpad(row, (25 + 2) * self.l);\n        self.rows.push(line);\n    }</code></pre><p>finally implementation of <code>get</code> can be written in following way:</p><pre><code class=\"language-rust\">fn get(&amp;self, word: String) -&gt; Vec&lt;String&gt; {\n        let a_position = char_code_at('A');\n        let mut rows: Vec&lt;String&gt; = std::iter::repeat(String::from(\"\")).take(self.h).collect();\n        for letter in word.chars() {\n            let mut pos: i32 = char_code_at(letter.to_ascii_uppercase()) as i32 - a_position as i32;\n            if pos &lt; 0 || pos &gt; 25 {\n                pos = (self.rows[0].len() / self.l - 1) as i32\n            }\n            let pos: usize = pos as usize;\n\n            for i in 0..self.h {\n                rows[i as usize] = concat_str(\n                    &amp;rows[i],\n                    &amp;self.rows[i as usize][pos * self.l..(pos + 1) * self.l],\n                )\n            }\n        }\n\n        rows\n    }\n}</code></pre><h3 id=\"tests-in-rust\">Tests in rust</h3><p>Our shunit will be almost the same as in <code>node</code>. Only difference is <code>cargo run</code> instead of <code>ts-node index.ts</code>. Workflow can be divided to building, unit tests and e2e tests</p><pre><code class=\"language-yml\">name: Rust\n\non:\n  push:\n    branches: [ \"main\" ]\n    paths: [ \"rust/**\" ]\n\nenv:\n  CARGO_TERM_COLOR: always\n  working-directory: ./rust\n\njobs:\n  build:\n    runs-on: ubuntu-latest\n    steps:\n      - uses: actions/checkout@v3\n      - name: Build\n        run: cargo build --verbose\n        working-directory: ${{ env.working-directory }}\n\n  test:\n    runs-on: ubuntu-latest\n    steps:\n      - uses: actions/checkout@v3\n      - name: Run tests\n        run: cargo test --verbose\n        working-directory: ${{ env.working-directory }}\n\n  e2e:\n    runs-on: ubuntu-latest\n    steps:\n      - uses: actions/checkout@v3\n      - name: Install shunit\n        run: sudo apt install -y shunit2\n      - name: Check files\n        run: ls ../cases/in*\n        working-directory: ${{ env.working-directory }}\n      - name: Test with shunit\n        run: ./shunit.sh\n        working-directory: ${{ env.working-directory }}\n\n</code></pre><h3 id=\"summary\">Summary</h3><p>I hope this article will be helpful for learning basic concepts from rust or javascript. Full code can be seen here:</p><figure class=\"kg-card kg-bookmark-card\"><a class=\"kg-bookmark-container\" href=\"https://github.com/gustawdaniel/asci-art-rust-node-js\"><div class=\"kg-bookmark-content\"><div class=\"kg-bookmark-title\">GitHub - gustawdaniel/asci-art-rust-node-js</div><div class=\"kg-bookmark-description\">Contribute to gustawdaniel/asci-art-rust-node-js development by creating an account on GitHub.</div><div class=\"kg-bookmark-metadata\"><img class=\"kg-bookmark-icon\" src=\"https://github.githubassets.com/favicons/favicon.svg\"><span class=\"kg-bookmark-author\">GitHub</span><span class=\"kg-bookmark-publisher\">gustawdaniel</span></div></div><div class=\"kg-bookmark-thumbnail\"><img src=\"https://opengraph.githubassets.com/eab81b748e6df897c8f1f504304f64535b3fe2515345883fefb716d3ffe7889d/gustawdaniel/asci-art-rust-node-js\"></div></a></figure><p>If you want to solve similar problems you can create account on <code>codingame</code> using link:</p><p><a href=\"https://www.codingame.com/servlet/urlinvite?u=5287657\">https://www.codingame.com/servlet/urlinvite?u=5287657</a></p>","comment_id":"63c6d6b0bbda300a2f29c6c6","plaintext":"The goal of the problem is to simulate an old airport terminal display: your\nprogram must display a line of text in ASCII art.\n\nYou have to split strings, store them and recreate others. You can use data\nstructures like arrays or hash tables.\n\nIt can be solved using the following concepts. \n\n * Strings [https://www.codingame.com/learn/strings]\n * Arrays [https://www.codingame.com/learn/arrays]\n * Loops [https://www.codingame.com/learn/loops]\n\nThe Goal\n\nIn stations and airports you often see this type of screen:\n\nHave you ever asked yourself how it might be possible to simulate this display\non a good old terminal? We have: with ASCII art!\n\nRules\nASCII art allows you to represent forms by using characters. To be precise, in\nour case, these forms are words. For example, the word \"MANHATTAN\" could be\ndisplayed as follows in ASCII art:\n\n# #  #  ### # #  #  ### ###  #  ###\n### # # # # # # # #  #   #  # # # #\n### ### # # ### ###  #   #  ### # #\n# # # # # # # # # #  #   #  # # # #\n# # # # # # # # # #  #   #  # # # #\n\n​Your mission is to write a program that can display a line of text in ASCII art\nin a style you are given as input.\n\nGame Input\n\nInput\n\nLine 1: the width L of a letter represented in ASCII art. All letters are the\nsame width.\n\nLine 2: the height H of a letter represented in ASCII art. All letters are the\nsame height.\n\nLine 3: The line of text T, composed of N ASCII characters.\n\nFollowing lines: the string of characters ABCDEFGHIJKLMNOPQRSTUVWXYZ?\nRepresented in ASCII art.\n\nOutput\n\nThe text T in ASCII art.\nThe characters a to z are shown in ASCII art by their equivalent in upper case.\nThe characters that are not in the intervals [a-z] or [A-Z] will be shown as a\nquestion mark in ASCII art.\n\nConstraints\n\n0 < L < 30\n0 < H < 30\n0 < N < 200\n\nExample 1\n\nInput\n\n4\n5 \nE\n #  ##   ## ##  ### ###  ## # # ###  ## # # #   # # ###  #  ##   #  ##   ## ### # # # # # # # # # # ### ### \n# # # # #   # # #   #   #   # #  #    # # # #   ### # # # # # # # # # # #    #  # # # # # # # # # #   #   # \n### ##  #   # # ##  ##  # # ###  #    # ##  #   ### # # # # ##  # # ##   #   #  # # # # ###  #   #   #   ## \n# # # # #   # # #   #   # # # #  #  # # # # #   # # # # # # #    ## # #   #  #  # # # # ### # #  #  #       \n# # ##   ## ##  ### #    ## # # ###  #  # # ### # # # #  #  #     # # # ##   #  ###  #  # # # #  #  ###  #  \n\nOutput\n\n### \n#   \n##  \n#   \n### \n\nExample 2\n\nInput\n\n4\n5\nMANHATTAN\n #  ##   ## ##  ### ###  ## # # ###  ## # # #   # # ###  #  ##   #  ##   ## ### # # # # # # # # # # ### ### \n# # # # #   # # #   #   #   # #  #    # # # #   ### # # # # # # # # # # #    #  # # # # # # # # # #   #   # \n### ##  #   # # ##  ##  # # ###  #    # ##  #   ### # # # # ##  # # ##   #   #  # # # # ###  #   #   #   ## \n# # # # #   # # #   #   # # # #  #  # # # # #   # # # # # # #    ## # #   #  #  # # # # ### # #  #  #       \n# # ##   ## ##  ### #    ## # # ###  #  # # ### # # # #  #  #     # # # ##   #  ###  #  # # # #  #  ###  #  \n\nOutput\n\n# #  #  ### # #  #  ### ###  #  ###  \n### # # # # # # # #  #   #  # # # #  \n### ### # # ### ###  #   #  ### # #  \n# # # # # # # # # #  #   #  # # # #  \n# # # # # # # # # #  #   #  # # # # \n\nSource\nThis exercise can be found on codingame.com\n\nCoding Games and Programming Challenges to Code BetterCodinGame is a\nchallenge-based training platform for programmers where you can play with the\nhottest programming topics. Solve games, code AI bots, learn from your peers,\nhave fun.CodinGame [https://www.codingame.com/ide/puzzle/ascii-art]Solution in\nNodeJs\nWe will have three directories: node, rust and cases with text inputs and\noutputs files. In node we can setup project using commands\n\nnpm init -y\ntsc --init\n\nin tsconfig.json we will change target to ESNext to be able to use padEnd in our\ncode. Additionally we should install dev dependencies:\n\nnpm i -D @types/node typescript\n\nReading lines\nWe want to pass input by standard input to program. Using module readline we can\nlisten on lines and end of input. Any line will be added to lines array. When\nall input will be read, we will call start function that we will define later. \n\nimport readlineModule from \"readline\";\n\nconst rl = readlineModule.createInterface({\n    input: process.stdin,\n    output: process.stdout,\n    terminal: false\n});\n\nconst lines: string[] = [];\nlet readIndex = 0;\n\nrl.on('line', (line: string) => {\n    lines.push(line)\n});\n\nrl.on('close', () => {\n    start();\n})\n\nfunction readline() {\n    return lines[readIndex++];\n}\n\nAdditionally we defined readline function that will give us next lines from \nlines array.\n\nInterface of class that process input\nWe will create class Alphabet that will need size of letter in constructor. Then\nwe will save rows one by one and finally we need get array of rows for given\nstring. We will focus on implementation later, but now let's see start function\nmentioned before: \n\nfunction start() {\n    const L: number = parseInt(readline());\n    const H: number = parseInt(readline());\n    const T: string = readline();\n\n    const a = new Alphabet(L, H);\n    for (let i = 0; i < H; i++) {\n        const ROW: string = readline();\n        a.setRow(ROW);\n    }\n\n    const res = a.get(T);\n    res.forEach((row) => {\n        console.log(row.replace(/\\s+$/, ''));\n    });\n}\n\nthis function will be called when input will be saved to lines. Now we can focus\non implementation of Alphabet\n\nProcessing rows\nIn setRow we adding lines to rows property, but padEnd allow to append spaces at\nthe end of rows to simplify further processing.\n\nclass Alphabet {\n    l: number = 0;\n    h: number = 0;\n    rows: string[] = []\n\n    constructor(L: number, H: number) {\n        this.l = L;\n        this.h = H;\n    }\n\n    setRow(line: string) {\n        this.rows.push(line.padEnd((25 + 2) * this.l, \" \"));\n    }\n\n    get(word: string): string[] {\n        const aPosition = 'A'.charCodeAt(0);\n        let rows = [...new Array(this.h)].map(() => '');\n        for (let letter of word) {\n            let pos: number = letter.toUpperCase().charCodeAt(0) - aPosition;\n            if (pos < 0 || pos > 25) pos = this.rows[0].length / this.l - 1;\n            for (let i = 0; i < this.h; i++) {\n                rows[i] += this.rows[i].substring(pos * this.l, (pos + 1) * this.l);\n            }\n        }\n        return rows;\n    }\n}\n\nFunction get starts from getting asci code of A. Then we preparing empty output\nrows. For any letters from expected word we are computing position in our\nalphabeth using asci codes. Substrings correcponding to these letters are added\nto rows. Finally fulfilled rows are returned from method get.\n\nShunit for node js\nTo test we can use shunit2 because this framework can be applied to any language\nand is great to use in cases where we have to test input and output of bash\ncommands.\n\nThis is our shunit.sh content\n\n#!/bin/bash\n\ntestInOut() {\n  for file in `ls ../cases/in*`\n  do\n    RES=$(cat < ${file} | ts-node index.ts)\n    EXP=$(cat \"${file/in/\"out\"}\")\n    assertEquals \"${EXP}\" \"${RES}\"\n  done;\n}\n\n# Load shUnit2.\n. /usr/share/shunit2/shunit2\n\nThere is fragment ${file/in/\"out\"} - it means that we replacing in by out in\npaths to files. Files in cases are starting from in or out having rest of names\nthe same. You can check them in github repository:\n\nasci-art-rust-node-js/cases at main · gustawdaniel/asci-art-rust-node-js\nContribute to gustawdaniel/asci-art-rust-node-js development by creating an\naccount on GitHub.GitHubgustawdaniel\n[https://github.com/gustawdaniel/asci-art-rust-node-js/tree/main/cases]Node\nworkflow is the following\n\nname: Node.js CI\n\non:\n  push:\n    branches: [ \"main\" ]\n    paths: [ \"node/**\" ]\n\nenv:\n  working-directory: ./node\n\njobs:\n  build:\n    runs-on: ubuntu-latest\n\n    defaults:\n      run:\n        working-directory: ${{ env.working-directory }}\n\n    strategy:\n      matrix:\n        node-version: [14.x, 16.x, 18.x]\n\n    steps:\n      - uses: actions/checkout@v3\n      - name: Install shunit\n        run: sudo apt install -y shunit2\n      - name: Use Node.js ${{ matrix.node-version }}\n        uses: actions/setup-node@v3\n        with:\n          node-version: ${{ matrix.node-version }}\n          cache: 'npm'\n          cache-dependency-path: ${{ env.working-directory }}/package-lock.json\n      - run: npm ci\n      - run: npm install -g ts-node\n      - run: npm run build --if-present\n      - run: npm test\n\n\nto make it working we should add proper scripts in package.json\n\n  \"scripts\": {\n    \"test\": \"./shunit.sh\"\n  },\n\nSolution in Rust\nWe will follow the same schema as in NodeJs. Our code can be divide to helpers,\ninput/output processing and struct Alphabet with their methods.\n\nHelpers for string\nIn src/main.rs we can start file from\n\nuse std::io;\n\nmacro_rules! parse_input {\n    ($x:expr, $t:ident) => ($x.trim().parse::<$t>().unwrap())\n}\n\nfn char_code_at(letter: char) -> u32 {\n    u32::from(letter)\n}\n\nfn lpad(word: String, len: usize) -> String {\n    format!(\"{:<1$}\", word, len)\n}\n\nfn concat_str(a: &str, b: &str) -> String {\n    a.to_string() + b\n}\n\n#[cfg(test)]\nmod tests {\n    use crate::{char_code_at, concat_str, lpad};\n\n    #[test]\n    fn char_code_at_test() {\n        assert_eq!(char_code_at('A'), 65);\n    }\n\n    #[test]\n    fn pad() {\n        assert_eq!(lpad(String::from(\"ab\"), 3).len(), 3);\n    }\n\n    #[test]\n    fn concat() {\n        assert_eq!(concat_str(\"a\", \"b\"), \"ab\");\n    }\n}\n\nthere are one macro and test for three operations:\n\n * getting ASCI code for character\n * left pad that use format\n * concatenation to merge two strings\n\nInput and output processing\nOur main function will be responsible for reading input and printing output.\nRest of login si moved to Alphabet structure. Now we will show main function:\n\nfn main() {\n    let mut input_line = String::new();\n    io::stdin().read_line(&mut input_line).unwrap();\n    let l = parse_input!(input_line, i32);\n    let mut input_line = String::new();\n    io::stdin().read_line(&mut input_line).unwrap();\n    let h = parse_input!(input_line, i32);\n    let mut input_line = String::new();\n    io::stdin().read_line(&mut input_line).unwrap();\n    let t = input_line.trim_matches('\\n').to_string();\n\n    let mut a = Alphabet::new(l, h);\n\n    for _i in 0..h {\n        let mut input_line = String::new();\n        io::stdin().read_line(&mut input_line).unwrap();\n        let row = input_line.trim_matches('\\n').to_string();\n        a.set_row(row)\n    }\n\n    let res = a.get(t);\n    for r in res {\n        println!(\"{}\", r.trim_end_matches(\" \"));\n    }\n}\n\nIt is quite simple, so we can go to Alphabet implementation.\n\nASCI Art in rust\nStruct can be declared as\n\nstruct Alphabet {\n    h: usize,\n    l: usize,\n    rows: Vec<String>,\n}\n\nWe will get i32 in main so to convert them to usize we adding casting to\nconstructor\n\nimpl Alphabet {\n    fn new(l: i32, h: i32) -> Alphabet {\n        Alphabet {\n            l: l as usize,\n            h: h as usize,\n            rows: vec![],\n        }\n    }\n\nwhen we adding rows we will need lpad\n\n    fn set_row(&mut self, row: String) -> () {\n        let line = lpad(row, (25 + 2) * self.l);\n        self.rows.push(line);\n    }\n\nfinally implementation of get can be written in following way:\n\nfn get(&self, word: String) -> Vec<String> {\n        let a_position = char_code_at('A');\n        let mut rows: Vec<String> = std::iter::repeat(String::from(\"\")).take(self.h).collect();\n        for letter in word.chars() {\n            let mut pos: i32 = char_code_at(letter.to_ascii_uppercase()) as i32 - a_position as i32;\n            if pos < 0 || pos > 25 {\n                pos = (self.rows[0].len() / self.l - 1) as i32\n            }\n            let pos: usize = pos as usize;\n\n            for i in 0..self.h {\n                rows[i as usize] = concat_str(\n                    &rows[i],\n                    &self.rows[i as usize][pos * self.l..(pos + 1) * self.l],\n                )\n            }\n        }\n\n        rows\n    }\n}\n\nTests in rust\nOur shunit will be almost the same as in node. Only difference is cargo run \ninstead of ts-node index.ts. Workflow can be divided to building, unit tests and\ne2e tests\n\nname: Rust\n\non:\n  push:\n    branches: [ \"main\" ]\n    paths: [ \"rust/**\" ]\n\nenv:\n  CARGO_TERM_COLOR: always\n  working-directory: ./rust\n\njobs:\n  build:\n    runs-on: ubuntu-latest\n    steps:\n      - uses: actions/checkout@v3\n      - name: Build\n        run: cargo build --verbose\n        working-directory: ${{ env.working-directory }}\n\n  test:\n    runs-on: ubuntu-latest\n    steps:\n      - uses: actions/checkout@v3\n      - name: Run tests\n        run: cargo test --verbose\n        working-directory: ${{ env.working-directory }}\n\n  e2e:\n    runs-on: ubuntu-latest\n    steps:\n      - uses: actions/checkout@v3\n      - name: Install shunit\n        run: sudo apt install -y shunit2\n      - name: Check files\n        run: ls ../cases/in*\n        working-directory: ${{ env.working-directory }}\n      - name: Test with shunit\n        run: ./shunit.sh\n        working-directory: ${{ env.working-directory }}\n\n\n\nSummary\nI hope this article will be helpful for learning basic concepts from rust or\njavascript. Full code can be seen here:\n\nGitHub - gustawdaniel/asci-art-rust-node-jsContribute to\ngustawdaniel/asci-art-rust-node-js development by creating an account on\nGitHub.\nGitHubgustawdaniel [https://github.com/gustawdaniel/asci-art-rust-node-js]If you\nwant to solve similar problems you can create account on codingame using link:\n\nhttps://www.codingame.com/servlet/urlinvite?u=5287657","feature_image":"__GHOST_URL__/content/images/2023/01/yy833vobjocvewej4az0.png","featured":0,"type":"post","status":"published","locale":null,"visibility":"public","email_recipient_filter":"all","created_at":"2023-01-17T17:11:12.000Z","updated_at":"2023-01-17T18:31:50.000Z","published_at":"2023-01-17T18:31:50.000Z","custom_excerpt":"Solving this puzzle teaches how to manage strings and array arithmetics.\nYou'll know how to split a string into separate parts and concatenate them into a new one.\nYou can use indexes of arrays","codeinjection_head":null,"codeinjection_foot":null,"custom_template":null,"canonical_url":null,"newsletter_id":null,"lexical":null},{"id":"63c9d7b4bbda300a2f29c85f","uuid":"d783262a-0884-435d-baec-8edf15bd78e6","title":"CodinGame: Quaternion Multiplication - Rust, NodeJS - Parsing, Algebra, Mathematics","slug":"quaternion-multiplication","mobiledoc":"{\"version\":\"0.3.1\",\"atoms\":[[\"soft-return\",\"\",{}],[\"soft-return\",\"\",{}],[\"soft-return\",\"\",{}],[\"soft-return\",\"\",{}],[\"soft-return\",\"\",{}],[\"soft-return\",\"\",{}],[\"soft-return\",\"\",{}],[\"soft-return\",\"\",{}],[\"soft-return\",\"\",{}],[\"soft-return\",\"\",{}],[\"soft-return\",\"\",{}],[\"soft-return\",\"\",{}],[\"soft-return\",\"\",{}],[\"soft-return\",\"\",{}],[\"soft-return\",\"\",{}],[\"soft-return\",\"\",{}],[\"soft-return\",\"\",{}],[\"soft-return\",\"\",{}],[\"soft-return\",\"\",{}],[\"soft-return\",\"\",{}],[\"soft-return\",\"\",{}],[\"soft-return\",\"\",{}],[\"soft-return\",\"\",{}],[\"soft-return\",\"\",{}]],\"cards\":[[\"bookmark\",{\"type\":\"bookmark\",\"url\":\"https://www.codingame.com/training/medium/quaternion-multiplication\",\"metadata\":{\"url\":\"https://www.codingame.com/training/medium/quaternion-multiplication\",\"title\":\"Coding Games and Programming Challenges to Code Better\",\"description\":\"CodinGame is a challenge-based training platform for programmers where you can play with the hottest programming topics. Solve games, code AI bots, learn from your peers, have fun.\",\"author\":null,\"publisher\":\"CodinGame\",\"thumbnail\":\"https://files.codingame.com/codingame/codingame_share_pics.jpg\",\"icon\":\"https://static.codingame.com/assets/apple-touch-icon-152x152-precomposed.5cb052db.png\"}}],[\"bookmark\",{\"type\":\"bookmark\",\"url\":\"https://mathworld.wolfram.com/Quaternion.html\",\"metadata\":{\"url\":\"https://mathworld.wolfram.com\",\"title\":\"Quaternion -- from Wolfram MathWorld\",\"description\":\"The quaternions are members of a noncommutative division algebra first invented by William Rowan Hamilton. The idea for quaternions occurred to him while he was walking along the Royal Canal on his way to a meeting of the Irish Academy, and Hamilton was so pleased with his discovery that he scratche…\",\"author\":null,\"publisher\":\"from Wolfram MathWorld\",\"thumbnail\":\"https://mathworld.wolfram.com/images/socialmedia/share.png\",\"icon\":null}}],[\"hr\",{}],[\"code\",{\"code\":\"(i+j)(k)\"}],[\"code\",{\"code\":\"i-j\"}],[\"bookmark\",{\"type\":\"bookmark\",\"url\":\"https://github.com/gustawdaniel/codingame-quaternion-multiplication\",\"metadata\":{\"url\":\"https://github.com/gustawdaniel/codingame-quaternion-multiplication\",\"title\":\"GitHub - gustawdaniel/codingame-quaternion-multiplication\",\"description\":\"Contribute to gustawdaniel/codingame-quaternion-multiplication development by creating an account on GitHub.\",\"author\":\"gustawdaniel\",\"publisher\":\"GitHub\",\"thumbnail\":\"https://opengraph.githubassets.com/85682fcbd54214a903a6cb968a0137db1d1243d42b118b9e0764ac9229c76d63/gustawdaniel/codingame-quaternion-multiplication\",\"icon\":\"https://github.githubassets.com/favicons/favicon.svg\"}}],[\"image\",{\"src\":\"__GHOST_URL__/content/images/2023/01/2023-01-20_01-02.png\",\"width\":487,\"height\":273}],[\"code\",{\"code\":\"import {Quaternion} from \\\"./lib\\\";\\n\\nprocess.stdin.on('data', (buff) => {\\n    const line = buff.toString();\\n    const qs = Quaternion.parse(line);\\n    process.stdout.write(qs.reduce((p, n) => p.multiply(n)).format());\\n})\",\"language\":\"typescript\"}],[\"code\",{\"code\":\"fn main() {\\n    let mut input_line = String::new();\\n    io::stdin().read_line(&mut input_line).unwrap();\\n    let expr = input_line.trim_matches('\\\\n').to_string();\\n\\n    let qs = Quaternion::parse(&expr);\\n    let out = qs.into_iter().reduce(|p, n| p.multiply(n)).unwrap();\\n    println!(\\\"{}\\\", out);\\n}\",\"language\":\"rust\"}],[\"code\",{\"code\":\"(i+j)(k)\"}],[\"image\",{\"src\":\"__GHOST_URL__/content/images/2023/01/2023-01-20_01-35.png\",\"width\":631,\"height\":88}],[\"code\",{\"code\":\"    it('simple parse', () => {\\n        const qs = Quaternion.parse('(i+j)');\\n        expect(qs.length).toEqual(1);\\n        expect(qs[0].r).toEqual(0);\\n        expect(qs[0].i).toEqual(1);\\n        expect(qs[0].j).toEqual(1);\\n        expect(qs[0].k).toEqual(0);\\n    });\",\"language\":\"typescript\"}],[\"code\",{\"code\":\"    it('complex parse', () => {\\n        const qs = Quaternion.parse('(9+i-j)(k-8.4j)');\\n        expect(qs.length).toEqual(2);\\n        expect(qs[0].r).toEqual(9);\\n        expect(qs[0].i).toEqual(1);\\n        expect(qs[0].j).toEqual(-1);\\n        expect(qs[0].k).toEqual(0);\\n\\n        expect(qs[1].r).toEqual(0);\\n        expect(qs[1].i).toEqual(0);\\n        expect(qs[1].j).toEqual(-8.4);\\n        expect(qs[1].k).toEqual(1);\\n    });\",\"language\":\"typescript\"}],[\"code\",{\"code\":\"#[cfg(test)]\\nmod tests {\\n    use crate::{Quaternion};\\n\\n\\n    #[test]\\n    fn simple_parse() {\\n        let qs = Quaternion::parse(\\\"(i+j)\\\");\\n        assert_eq!(qs.len(), 1);\\n        assert_eq!(qs[0].r, 0f64);\\n        assert_eq!(qs[0].i, 1f64);\\n        assert_eq!(qs[0].j, 1f64);\\n        assert_eq!(qs[0].k, 0f64);\\n    }\\n\\n    #[test]\\n    fn complex_parse() {\\n        let qs = Quaternion::parse(\\\"(9+i-j)(k-8.4j)\\\");\\n        assert_eq!(qs.len(), 2);\\n        assert_eq!(qs[0].r, 9f64);\\n        assert_eq!(qs[0].i, 1f64);\\n        assert_eq!(qs[0].j, -1f64);\\n        assert_eq!(qs[0].k, 0f64);\\n\\n        assert_eq!(qs[1].r, 0f64);\\n        assert_eq!(qs[1].i, 0f64);\\n        assert_eq!(qs[1].j, -8.4f64);\\n        assert_eq!(qs[1].k, 1f64);\\n    }\\n}\",\"language\":\"rust\"}],[\"code\",{\"code\":\"export class Quaternion {\\n    r: number = 0;\\n    i: number = 0;\\n    j: number = 0;\\n    k: number = 0;\\n}\",\"language\":\"typescript\"}],[\"code\",{\"code\":\"#[derive(Debug)]\\nstruct Quaternion {\\n    r: f64,\\n    i: f64,\\n    j: f64,\\n    k: f64,\\n}\",\"language\":\"rust\"}],[\"code\",{\"code\":\"    static parse(input: string): Quaternion[] {\\n        const qs = (input.match(/\\\\(.*?\\\\)/g) ?? []).map(\\n            (e: string) => (e\\n                    .replace('(', '')\\n                    .replace(')', '')\\n                    .match(/[-+]?[\\\\d.]*[ijk]?/g) ?? []\\n            ).filter(v => v).map(\\n                v => v.replace(/^\\\\+/, '')\\n            )\\n        );\\n        return qs.map((q) => new Quaternion(q));\\n    }\\n\",\"language\":\"typescript\"}],[\"code\",{\"code\":\"impl Quaternion {\\n    fn parse(input: &str) -> Vec<Quaternion> {\\n        let re = Regex::new(r\\\"\\\\((.*?)\\\\)\\\").expect(\\\"can't create regex\\\");\\n\\n        let qs = re.captures_iter(input).filter_map(|cap| Some(cap.get(1)?.as_str()))\\n            .map(|m| m.to_string()).collect::<Vec<_>>();\\n\\n        let re = Regex::new(r\\\"\\\\+?(-?[\\\\d.]*[ijk]?)\\\").expect(\\\"can't create regex\\\");\\n\\n        let res = qs.iter().map(|q| {\\n            let args = re.captures_iter(&q).filter_map(|cap| Some(cap.get(1)?.as_str()))\\n                .map(|m| m.to_string()).collect::<Vec<_>>();\\n            Quaternion::new(args)\\n        });\\n\\n        res.collect::<Vec<_>>()\\n    }\\n}\",\"language\":\"rust\"}],[\"code\",{\"code\":\"    static getCoefficient(type: string, input: string): number {\\n        const coefficient = input.replace(type, '');\\n        return Number.parseFloat(/\\\\d$/.test(coefficient) ? coefficient : coefficient + '1')\\n    }\",\"language\":\"typescript\"}],[\"code\",{\"code\":\"    fn get_coefficient(t: &str, input: String) -> f64 {\\n        let c = input.replace(t, \\\"\\\");\\n        if Regex::new(r\\\"\\\\d$\\\").expect(\\\"ff\\\").is_match(&c) {\\n            c.parse::<f64>().unwrap()\\n        } else {\\n            (c + \\\"1\\\").parse::<f64>().unwrap()\\n        }\\n    }\",\"language\":\"rust\"}],[\"code\",{\"code\":\"    constructor(args: Array<string>) {\\n        for (let arg of args) {\\n            if (arg.includes('i')) {\\n                this.i = Quaternion.getCoefficient('i', arg);\\n            } else if (arg.includes('j')) {\\n                this.j = Quaternion.getCoefficient('j', arg);\\n            } else if (arg.includes('k')) {\\n                this.k = Quaternion.getCoefficient('k', arg);\\n            } else {\\n                this.r = Number.parseFloat(arg);\\n            }\\n        }\\n    }\",\"language\":\"typescript\"}],[\"code\",{\"code\":\"    fn new(args: Vec<String>) -> Quaternion {\\n        let mut q = Quaternion {\\n            i: 0f64,\\n            j: 0f64,\\n            k: 0f64,\\n            r: 0f64,\\n        };\\n\\n        for arg in args {\\n            if arg.contains(\\\"i\\\") {\\n                q.i = Quaternion::get_coefficient(\\\"i\\\", arg)\\n            } else if arg.contains(\\\"j\\\") {\\n                q.j = Quaternion::get_coefficient(\\\"j\\\", arg)\\n            } else if arg.contains(\\\"k\\\") {\\n                q.k = Quaternion::get_coefficient(\\\"k\\\", arg)\\n            } else {\\n                q.r = arg.parse::<f64>().unwrap()\\n            }\\n        }\\n\\n        q\\n    }\",\"language\":\"rust\"}],[\"image\",{\"src\":\"__GHOST_URL__/content/images/2023/01/2023-01-20_02-10.png\",\"width\":184,\"height\":194}],[\"code\",{\"code\":\"    it('multiply base', () => {\\n        expect(Quaternion.multiplyBase('r', 'r')).toEqual({c: 1, d: 'r'});\\n        expect(Quaternion.multiplyBase('r', 'i')).toEqual({c: 1, d: 'i'});\\n        expect(Quaternion.multiplyBase('r', 'j')).toEqual({c: 1, d: 'j'});\\n        expect(Quaternion.multiplyBase('r', 'k')).toEqual({c: 1, d: 'k'});\\n\\n        expect(Quaternion.multiplyBase('i', 'r')).toEqual({c: 1, d: 'i'});\\n        expect(Quaternion.multiplyBase('i', 'i')).toEqual({c: -1, d: 'r'});\\n        expect(Quaternion.multiplyBase('i', 'j')).toEqual({c: 1, d: 'k'});\\n        expect(Quaternion.multiplyBase('i', 'k')).toEqual({c: -1, d: 'j'});\\n\\n        expect(Quaternion.multiplyBase('j', 'r')).toEqual({c: 1, d: 'j'});\\n        expect(Quaternion.multiplyBase('j', 'i')).toEqual({c: -1, d: 'k'});\\n        expect(Quaternion.multiplyBase('j', 'j')).toEqual({c: -1, d: 'r'});\\n        expect(Quaternion.multiplyBase('j', 'k')).toEqual({c: 1, d: 'i'});\\n\\n        expect(Quaternion.multiplyBase('k', 'r')).toEqual({c: 1, d: 'k'});\\n        expect(Quaternion.multiplyBase('k', 'i')).toEqual({c: 1, d: 'j'});\\n        expect(Quaternion.multiplyBase('k', 'j')).toEqual({c: -1, d: 'i'});\\n        expect(Quaternion.multiplyBase('k', 'k')).toEqual({c: -1, d: 'r'});\\n    })\",\"language\":\"typescript\"}],[\"code\",{\"code\":\"    #[test]\\n    fn multiply_base() {\\n        assert_eq!(Quaternion::multiply_base('r', 'r'), SignedCoefficient { c: 1f64, d: 'r' });\\n        assert_eq!(Quaternion::multiply_base('r', 'i'), SignedCoefficient { c: 1f64, d: 'i' });\\n        assert_eq!(Quaternion::multiply_base('r', 'j'), SignedCoefficient { c: 1f64, d: 'j' });\\n        assert_eq!(Quaternion::multiply_base('r', 'k'), SignedCoefficient { c: 1f64, d: 'k' });\\n\\n        assert_eq!(Quaternion::multiply_base('i', 'r'), SignedCoefficient { c: 1f64, d: 'i' });\\n        assert_eq!(Quaternion::multiply_base('i', 'i'), SignedCoefficient { c: -1f64, d: 'r' });\\n        assert_eq!(Quaternion::multiply_base('i', 'j'), SignedCoefficient { c: 1f64, d: 'k' });\\n        assert_eq!(Quaternion::multiply_base('i', 'k'), SignedCoefficient { c: -1f64, d: 'j' });\\n\\n        assert_eq!(Quaternion::multiply_base('j', 'r'), SignedCoefficient { c: 1f64, d: 'j' });\\n        assert_eq!(Quaternion::multiply_base('j', 'i'), SignedCoefficient { c: -1f64, d: 'k' });\\n        assert_eq!(Quaternion::multiply_base('j', 'j'), SignedCoefficient { c: -1f64, d: 'r' });\\n        assert_eq!(Quaternion::multiply_base('j', 'k'), SignedCoefficient { c: 1f64, d: 'i' });\\n\\n        assert_eq!(Quaternion::multiply_base('k', 'r'), SignedCoefficient { c: 1f64, d: 'k' });\\n        assert_eq!(Quaternion::multiply_base('k', 'i'), SignedCoefficient { c: 1f64, d: 'j' });\\n        assert_eq!(Quaternion::multiply_base('k', 'j'), SignedCoefficient { c: -1f64, d: 'i' });\\n        assert_eq!(Quaternion::multiply_base('k', 'k'), SignedCoefficient { c: -1f64, d: 'r' });\\n    }\",\"language\":\"rust\"}],[\"code\",{\"code\":\"#[derive(Debug)]\\nstruct SignedCoefficient {\\n    c: f64,\\n    d: char,\\n}\",\"language\":\"rust\"}],[\"code\",{\"code\":\"impl PartialEq<SignedCoefficient> for SignedCoefficient {\\n    fn eq(&self, other: &SignedCoefficient) -> bool {\\n        self.c == other.c && self.d == other.d\\n    }\\n}\",\"language\":\"rust\"}],[\"code\",{\"code\":\"    static multiplyBase(a: Base, b: Base): { c: -1 | 1, d: Base } {\\n        if (a === 'r') return {c: 1, d: b};\\n        if (b === 'r') return {c: 1, d: a};\\n        if (a === b) return {c: -1, d: 'r'};\\n        const diff = a.charCodeAt(0) - b.charCodeAt(0);\\n        return {\\n            c: (diff > 0 ? -1 : 1) * ((diff + 2) % 2 === 0 ? -1 : 1) as -1 | 1,\\n            d: ['i', 'j', 'k'].find((e) => e !== a && e !== b) as Base\\n        }\\n    }\",\"language\":\"typescript\"}],[\"code\",{\"code\":\"    fn multiply_base(a: char, b: char) -> SignedCoefficient {\\n        if a == 'r' { return SignedCoefficient { c: 1f64, d: b }; }\\n        if b == 'r' { return SignedCoefficient { c: 1f64, d: a }; }\\n        if a == b { return SignedCoefficient { c: -1f64, d: 'r' }; }\\n        let diff = u32::from(a) as i32 - u32::from(b) as i32;\\n\\n        SignedCoefficient {\\n            c: (if diff > 0 { -1f64 } else { 1f64 }) * (if (diff + 2i32) % 2 == 0 { -1f64 } else { 1f64 }),\\n            d: vec!['i', 'j', 'k'].iter().find(|&&e| e != a && e != b).unwrap().to_owned(),\\n        }\\n    }\",\"language\":\"rust\"}],[\"code\",{\"code\":\"    it('simple multiply', () => {\\n        const res = (new Quaternion(['1']))\\n            .multiply(new Quaternion(['1']))\\n\\n        expect(res.r).toEqual(1);\\n        expect(res.i).toEqual(0);\\n        expect(res.j).toEqual(0);\\n        expect(res.k).toEqual(0);\\n    })\\n\\n    it('complex multiply', () => {\\n        const res = (new Quaternion(['2i', '2j']))\\n            .multiply(new Quaternion(['j', '1']))\\n\\n        expect(res.r).toEqual(-2);\\n        expect(res.i).toEqual(2);\\n        expect(res.j).toEqual(2);\\n        expect(res.k).toEqual(2);\\n    })\",\"language\":\"typescript\"}],[\"code\",{\"code\":\"    #[test]\\n    fn simple_multiply() {\\n        let res = Quaternion::new(vec![String::from(\\\"1\\\")])\\n            .multiply(Quaternion::new(vec![String::from(\\\"1\\\")]));\\n\\n        assert_eq!(res, Quaternion {\\n            r: 1f64,\\n            i: 0f64,\\n            j: 0f64,\\n            k: 0f64,\\n        })\\n    }\\n\\n    #[test]\\n    fn complex_multiply() {\\n        let res = Quaternion::new(vec![String::from(\\\"2i\\\"), String::from(\\\"2j\\\")])\\n            .multiply(Quaternion::new(vec![String::from(\\\"j\\\"), String::from(\\\"1\\\")]));\\n\\n        assert_eq!(res, Quaternion {\\n            r: -2f64,\\n            i: 2f64,\\n            j: 2f64,\\n            k: 2f64,\\n        })\\n    }\",\"language\":\"rust\"}],[\"code\",{\"code\":\"impl PartialEq<Quaternion> for Quaternion {\\n    fn eq(&self, other: &Quaternion) -> bool {\\n        self.r == other.r && self.i == other.i && self.j == other.j && self.k == other.k\\n    }\\n}\\n\",\"language\":\"rust\"}],[\"code\",{\"code\":\"    multiply(a: Quaternion): Quaternion {\\n        const res = new Quaternion([]);\\n        for (let p of ['r', 'i', 'j', 'k'] as Array<Base>) {\\n            for (let n of ['r', 'i', 'j', 'k'] as Array<Base>) {\\n                const {c, d} = Quaternion.multiplyBase(p, n);\\n                res[d] += c * this[p] * a[n];\\n            }\\n        }\\n        return res;\\n    }\",\"language\":\"typescript\"}],[\"code\",{\"code\":\"    fn get(&self, key: char) -> f64 {\\n        match key {\\n            'r' => self.r,\\n            'i' => self.i,\\n            'j' => self.j,\\n            'k' => self.k,\\n            _ => 0f64\\n        }\\n    }\\n\\n    fn set(&mut self, key: char, value: f64) -> &Quaternion {\\n        match key {\\n            'r' => self.r = value,\\n            'i' => self.i = value,\\n            'j' => self.j = value,\\n            'k' => self.k = value,\\n            _ => ()\\n        }\\n\\n        self\\n    }\\n\\n    fn multiply(&self, a: Quaternion) -> Quaternion {\\n        let mut res = Quaternion::new(vec![]);\\n        for p in vec!['r', 'i', 'j', 'k'] {\\n            for n in vec!['r', 'i', 'j', 'k'] {\\n                let SignedCoefficient { c, d } = Quaternion::multiply_base(p, n);\\n                res.set(d, res.get(d) + c * self.get(p) * a.get(n));\\n            }\\n        }\\n        res\\n    }\",\"language\":\"rust\"}],[\"image\",{\"src\":\"__GHOST_URL__/content/images/2023/01/maxresdefault.jpg\",\"width\":1280,\"height\":720}],[\"code\",{\"code\":\"    it('format coefficient', () => {\\n       expect(Quaternion.formatCoefficient('i', 20)).toEqual('20i');\\n       expect(Quaternion.formatCoefficient('i', 1)).toEqual('i');\\n       expect(Quaternion.formatCoefficient('', 0)).toEqual('0');\\n    });\\n\\n    it('format', () => {\\n        expect((new Quaternion([]).format())).toEqual('0');\\n        expect((new Quaternion(['1']).format())).toEqual('1');\\n        expect((new Quaternion(['i', '1']).format())).toEqual('i+1');\\n        expect((new Quaternion(['i', '-3.4j', '1']).format())).toEqual('i-3.4j+1');\\n        expect((new Quaternion(['j', 'k']).format())).toEqual('j+k');\\n\\n    })\",\"language\":\"typescript\"}],[\"code\",{\"code\":\"    #[test]\\n    fn format_coefficient() {\\n        assert_eq!(Quaternion::format_coefficient('i', 20f64), String::from(\\\"20i\\\"));\\n        assert_eq!(Quaternion::format_coefficient('i', 1f64), String::from(\\\"i\\\"));\\n        assert_eq!(Quaternion::format_coefficient(' ', 0f64), String::from(\\\"0\\\"));\\n    }\\n\\n    #[test]\\n    fn format() {\\n        assert_eq!(format!(\\\"{}\\\", Quaternion::new(vec![])), String::from(\\\"0\\\"));\\n        assert_eq!(format!(\\\"{}\\\", Quaternion::new(vec![String::from(\\\"1\\\")])), String::from(\\\"1\\\"));\\n        assert_eq!(format!(\\\"{}\\\", Quaternion::new(vec![String::from(\\\"i\\\"), String::from(\\\"1\\\")])), String::from(\\\"i+1\\\"));\\n        assert_eq!(format!(\\\"{}\\\", Quaternion::new(vec![String::from(\\\"i\\\"), String::from(\\\"-3.4j\\\"), String::from(\\\"1\\\")])), String::from(\\\"i-3.4j+1\\\"));\\n        assert_eq!(format!(\\\"{}\\\", Quaternion::new(vec![String::from(\\\"j\\\"), String::from(\\\"k\\\")])), String::from(\\\"j+k\\\"));\\n    }\",\"language\":\"rust\"}],[\"code\",{\"code\":\"    static formatCoefficient(type: Base | '', value: number) {\\n        const out = `${Math.abs(value) === 1 ? (\\n            Math.sign(value) === 1 ? '' : '-'\\n        ) : value}${type}`;\\n        return /[\\\\dijk]$/.test(out) ? out : `${out}1`;\\n    }\",\"language\":\"typescript\"}],[\"code\",{\"code\":\"    fn format_coefficient(t: char, value: f64) -> String {\\n        let out = if f64::abs(value) == 1f64 {\\n            if f64::signum(value) == 1f64 {\\n                String::from(\\\"\\\") + &t.to_string()[..].trim()\\n            } else {\\n                String::from(\\\"-\\\") + &t.to_string()[..].trim()\\n            }\\n        } else {\\n            format!(\\\"{}\\\", value) + &t.to_string()[..].trim()\\n        };\\n\\n        match Regex::new(r\\\"[\\\\dijk]$\\\").unwrap().captures(&out[..]) {\\n            Some(_) => out,\\n            None => out + \\\"1\\\"\\n        }\\n    }\\n}\",\"language\":\"rust\"}],[\"code\",{\"code\":\"    format(): string {\\n        let out = [];\\n        if (this.i) {\\n            out.push(Quaternion.formatCoefficient('i', this.i));\\n        }\\n        if (this.j) {\\n            out.push(Quaternion.formatCoefficient('j', this.j));\\n        }\\n        if (this.k) {\\n            out.push(Quaternion.formatCoefficient('k', this.k));\\n        }\\n        if (this.r) {\\n            out.push(Quaternion.formatCoefficient('', this.r));\\n        }\\n\\n        if (!out.length) return '0';\\n\\n        return out.reduce((p, n) => p + (\\n            p.length && Quaternion.getCoefficient('',n.replace(/[kij]/, '')) > 0 ? `+${n}` : `${n}`), ''\\n        );\\n    }\",\"language\":\"typescript\"}],[\"code\",{\"code\":\"impl fmt::Display for Quaternion {\\n    fn fmt(&self, f: &mut fmt::Formatter<'_>) -> fmt::Result {\\n        let mut out: Vec<String> = vec![];\\n        if self.i != 0f64 {\\n            out.push(Quaternion::format_coefficient('i', self.i))\\n        }\\n        if self.j != 0f64 {\\n            out.push(Quaternion::format_coefficient('j', self.j))\\n        }\\n        if self.k != 0f64 {\\n            out.push(Quaternion::format_coefficient('k', self.k))\\n        }\\n        if self.r != 0f64 {\\n            out.push(Quaternion::format_coefficient(' ', self.r))\\n        }\\n\\n        let out = out.into_iter().reduce(\\n            |p, n| format!(\\n                \\\"{}{}\\\",\\n                p.clone(),\\n                if p.len() > 0 && Quaternion::get_coefficient(&\\\"\\\", n.replace(\\\"i\\\", \\\"\\\").replace(\\\"j\\\", \\\"\\\").replace(\\\"k\\\", \\\"\\\")) > 0f64 {\\n                    format!(\\\"{}{}\\\", \\\"+\\\", n)\\n                } else {\\n                    n\\n                }\\n            )\\n        );\\n\\n        write!(f, \\\"{}\\\", out.unwrap_or(String::from(\\\"0\\\")))\\n    }\\n}\\n\",\"language\":\"rust\"}],[\"code\",{\"code\":\"    it('e2e', () => {\\n        const cases = [\\n            {\\n                in: '(i+j)(k)',\\n                out: 'i-j'\\n            },\\n            {\\n                in: '(i+j+20)(j-9)',\\n                out: '-9i+11j+k-181'\\n            },\\n            {\\n                in: '(10i)(10j-k+1)(-99i+j-10k+7)(4)',\\n                out: '-520i-38920j+6800k+7920'\\n            },\\n            {\\n                in: '(i+j+k+1)(i+2j+4k+8)(i+3j+9k+27)(i+j+8k+8)(i-j+k-10)(99i-j+k-1)(k)(j)(i)(3)',\\n                out: '11415288i-8751432j-5206896k+9766704'\\n            }\\n        ]\\n        for (const c of cases) {\\n            const qs = Quaternion.parse(c.in);\\n            const out = qs.reduce((p, n) => p.multiply(n)).format();\\n            expect(out).toEqual(c.out);\\n        }\\n    })\",\"language\":\"typescript\"}],[\"code\",{\"code\":\"#[test]\\n    fn e2e() {\\n        struct Case {\\n            input: String,\\n            output: String,\\n        }\\n\\n        let cases: Vec<Case> = vec![\\n            Case {\\n                input: String::from(\\\"(i+j)(k)\\\"),\\n                output: String::from(\\\"i-j\\\"),\\n            },\\n            Case {\\n                input: String::from(\\\"(i+j+20)(j-9)\\\"),\\n                output: String::from(\\\"-9i+11j+k-181\\\"),\\n            },\\n            Case {\\n                input: String::from(\\\"(10i)(10j-k+1)(-99i+j-10k+7)(4)\\\"),\\n                output: String::from(\\\"-520i-38920j+6800k+7920\\\"),\\n            },\\n            Case {\\n                input: String::from(\\\"(i+j+k+1)(i+2j+4k+8)(i+3j+9k+27)(i+j+8k+8)(i-j+k-10)(99i-j+k-1)(k)(j)(i)(3)\\\"),\\n                output: String::from(\\\"11415288i-8751432j-5206896k+9766704\\\"),\\n            },\\n        ];\\n        for c in cases {\\n            let qs = Quaternion::parse(&c.input[..]);\\n            let out = qs.into_iter().reduce(|p, n| p.multiply(n)).unwrap();\\n            assert_eq!(format!(\\\"{}\\\", out), c.output);\\n        }\\n    }\",\"language\":\"rust\"}],[\"embed\",{\"url\":\"https://www.youtube.com/watch?v=d4EgbgTm0Bg\",\"html\":\"<iframe width=\\\"200\\\" height=\\\"113\\\" src=\\\"https://www.youtube.com/embed/d4EgbgTm0Bg?feature=oembed\\\" frameborder=\\\"0\\\" allow=\\\"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share\\\" allowfullscreen title=\\\"Visualizing quaternions (4d numbers) with stereographic projection\\\"></iframe>\",\"type\":\"video\",\"metadata\":{\"title\":\"Visualizing quaternions (4d numbers) with stereographic projection\",\"author_name\":\"3Blue1Brown\",\"author_url\":\"https://www.youtube.com/@3blue1brown\",\"height\":113,\"width\":200,\"version\":\"1.0\",\"provider_name\":\"YouTube\",\"provider_url\":\"https://www.youtube.com/\",\"thumbnail_height\":360,\"thumbnail_width\":480,\"thumbnail_url\":\"https://i.ytimg.com/vi/d4EgbgTm0Bg/hqdefault.jpg\"}}]],\"markups\":[[\"strong\"],[\"code\"]],\"sections\":[[1,\"p\",[[0,[],0,\"In this article we will see how to implement the multiplication of quaternions in Rust and NodeJS. I encourage you to try solve this problem before seeing solutions. Below I attaching link to this exercise:\"]]],[10,0],[1,\"p\",[[0,[],0,\"The quaternions belong to a number system that extends the complex numbers. A quaternion is defined by the sum of scalar multiples of the constants \"],[0,[0],1,\"i\"],[0,[],0,\",\"],[0,[0],1,\"j\"],[0,[],0,\",\"],[0,[0],1,\"k\"],[0,[],0,\" and \"],[0,[0],1,\"1\"],[0,[],0,\".\"],[1,[],0,0],[0,[],0,\"More information is available at:\"]]],[10,1],[1,\"p\",[[0,[],0,\"Consider the following properties:\"],[1,[],0,1],[0,[0],1,\"jk\"],[0,[],0,\" = \"],[0,[0],1,\"i\"],[1,[],0,2],[0,[0],1,\"ki\"],[0,[],0,\" = \"],[0,[0],1,\"j\"],[1,[],0,3],[0,[0],1,\"ij\"],[0,[],0,\" = \"],[0,[0],1,\"k\"],[1,[],0,4],[0,[0],1,\"i\"],[0,[],0,\"² = \"],[0,[0],1,\"j\"],[0,[],0,\"² = \"],[0,[0],1,\"k\"],[0,[],0,\"² = \"],[0,[0],1,\"-1\"],[1,[],0,5],[1,[],0,6],[0,[],0,\"These properties also imply that:\"],[1,[],0,7],[0,[0],1,\"kj\"],[0,[],0,\" = \"],[0,[0],1,\"-i\"],[1,[],0,8],[0,[0],1,\"ik\"],[0,[],0,\" = \"],[0,[0],1,\"-j\"],[1,[],0,9],[0,[0],1,\"ji\"],[0,[],0,\" = \"],[0,[0],1,\"-k\"],[1,[],0,10],[1,[],0,11],[0,[],0,\"The order of multiplication is important.\"],[1,[],0,12],[1,[],0,13],[0,[],0,\"Your program must output the result of the product of a number of bracketed simplified quaternions.\"],[1,[],0,14],[1,[],0,15],[0,[0],1,\"Pay attention to the formatting\"],[1,[],0,16],[0,[],0,\"The coefficient is appended to the left of the constant.\"],[1,[],0,17],[0,[],0,\"If a coefficient is \"],[0,[0],1,\"1\"],[0,[],0,\" or \"],[0,[0],1,\"-1\"],[0,[],0,\", don't include the \"],[0,[0],1,\"1\"],[0,[],0,\" symbol.\"],[1,[],0,18],[0,[],0,\"If a coefficient or scalar term is \"],[0,[0],1,\"0\"],[0,[],0,\", don't include it.\"],[1,[],0,19],[0,[],0,\"The terms must be displayed in order: a\"],[0,[0],1,\"i\"],[0,[],0,\" + b\"],[0,[0],1,\"j\"],[0,[],0,\" + c\"],[0,[0],1,\"k\"],[0,[],0,\" + d.\"],[1,[],0,20],[1,[],0,21],[0,[0],1,\"Example Multiplication\"],[1,[],0,22],[0,[],0,\"(2i+2j)(j+1) = (2ij+2i+2j² +2j) = (2k+2i-2+2j) = (2i+2j+2k-2)\"]]],[10,2],[1,\"p\",[[0,[0],1,\"Input:\"]]],[1,\"p\",[[0,[0],1,\"Line 1\"],[0,[],0,\": The expression expr to evaluate. This will always be the product of simplified bracketed expressions.\"]]],[1,\"p\",[[0,[0],1,\"Output: \"],[0,[],0,\"A single line containing the simplified result of the product expression. No brackets are required.\"]]],[1,\"p\",[[0,[0],1,\"Constraints: \"],[0,[],0,\"All coefficients in any part of evaluation will be less than \"],[0,[0],1,\"10^9\"],[1,[],0,23],[0,[],0,\"The input contains no more than 10 simplified bracketed expressions\"]]],[1,\"p\",[[0,[0],1,\"Example\"]]],[1,\"p\",[[0,[0],1,\"Input\"]]],[10,3],[1,\"p\",[[0,[0],1,\"Output\"]]],[10,4],[1,\"h1\",[[0,[],0,\"Solution\"]]],[1,\"p\",[[0,[],0,\"I decided to present only most important parts here. Full solution can be found in repository:\"]]],[10,5],[1,\"p\",[[0,[],0,\"We can divide our problem to three steps:\"]]],[3,\"ul\",[[[0,[],0,\"parsing input to Quaternion structure\"]],[[0,[],0,\"multiplication of Quaternions\"]],[[0,[],0,\"formatting Quaternion again to string\"]]]],[10,6],[1,\"p\",[[0,[],0,\"These high-level operations can be implemented in NodeJS\"]]],[10,7],[1,\"p\",[[0,[],0,\"and in Rust\"]]],[10,8],[1,\"p\",[[0,[],0,\"You can see that this code is really similar but in both cases we have to implement \"],[0,[1],1,\"Struct/Class\"],[0,[],0,\" named \"],[0,[1],1,\"Quaternion\"],[0,[],0,\". Now we will go through three steps mentioned before using \"],[0,[1],1,\"TDD\"],[0,[],0,\". Tests are natively supported in rust, but in \"],[0,[1],1,\"NodeJS\"],[0,[],0,\" I decided to use \"],[0,[1],1,\"jest\"],[0,[],0,\" as testing framework.\"]]],[1,\"h2\",[[0,[],0,\"Parsing input to Quaternion structure\"]]],[1,\"p\",[[0,[],0,\"Our input\"]]],[10,9],[1,\"p\",[[0,[],0,\"should be treated as array of quaternions - separated by brackets. In any brackets we have array of coefficients. So we can divide our parsing to 4 parts:\"]]],[3,\"ul\",[[[0,[],0,\"spliting by brackets\"]],[[0,[],0,\"splitings any bracket to coefficients\"]],[[0,[],0,\"creating Quaternions from arrays of coefficients \"]],[[0,[],0,\"extracing number from coefficient\"]]]],[10,10],[1,\"p\",[[0,[],0,\"In NodeJS we can start from two tests. First for simple cases:\"]]],[10,11],[1,\"p\",[[0,[],0,\"Second for more advanced coefficients:\"]]],[10,12],[1,\"p\",[[0,[],0,\"The same tests in \"],[0,[1],1,\"rust\"],[0,[],0,\" can be written as\"]]],[10,13],[1,\"p\",[[0,[],0,\"Our base \"],[0,[1],1,\"Quaternion\"],[0,[],0,\" class will have \"],[0,[1],1,\"4\"],[0,[],0,\" properties. In NodeJS:\"]]],[10,14],[1,\"p\",[[0,[],0,\"where \"],[0,[1],1,\"r\"],[0,[],0,\" means \"],[0,[1],1,\"real\"],[0,[],0,\" part that inherits arithmetic from real numbers. In \"],[0,[1],1,\"rust\"],[0,[],0,\" we are using \"],[0,[1],1,\"struct\"],[0,[],0,\" keyword instead of \"],[0,[1],1,\"class\"]]],[10,15],[1,\"h3\",[[0,[],0,\"Splitting string using regular expressions\"]]],[1,\"p\",[[0,[],0,\"To split input and provide arrays of coefficients to Quaternion constructors we can write methods in NodeJS:\"]]],[10,16],[1,\"p\",[[0,[],0,\"and Rust\"]]],[10,17],[1,\"p\",[[0,[],0,\"Generally there are the same regex expressions but \"],[0,[1],1,\"rust\"],[0,[],0,\" requires here external library called \"],[0,[1],1,\"regex\"],[0,[],0,\". Additionally \"],[0,[1],1,\"rust\"],[0,[],0,\" checks correctness of regex expressions and ensure handling errors in them, that can be skipped by default in \"],[0,[1],1,\"node js\"],[0,[],0,\" code. Generally I feel that \"],[0,[1],1,\"node js\"],[0,[],0,\" approach to regex is more clean and readable.\"]]],[1,\"p\",[[0,[],0,\"Now we have the following problem. Our coefficients can contains numbers, numbers with names of component like: \"],[0,[1],1,\"i\"],[0,[],0,\", \"],[0,[1],1,\"j\"],[0,[],0,\" or \"],[0,[1],1,\"k\"],[0,[],0,\", or even lonely letters like \"],[0,[1],1,\"i\"],[0,[],0,\" what means \"],[0,[1],1,\"1i\"],[0,[],0,\". There are also possible signs like \"],[0,[1],1,\"-k\"],[0,[],0,\".\"]]],[1,\"p\",[[0,[],0,\"We need code that will extract numbers from them. Lets name \"],[0,[1],1,\"i\"],[0,[],0,\", \"],[0,[1],1,\"j\"],[0,[],0,\" or \"],[0,[1],1,\"k\"],[0,[],0,\" as \"],[0,[1],1,\"type\"],[0,[],0,\" and full coefficient string as \"],[0,[1],1,\"input\"],[0,[],0,\". Then extracting number can be considered as:\"]]],[3,\"ul\",[[[0,[],0,\"removing \"],[0,[1],1,\"type\"],[0,[],0,\" from \"],[0,[1],1,\"input\"]],[[0,[],0,\"if rest not end with digit then add \"],[0,[1],1,\"1\"],[0,[],0,\" on the end ( example is \"],[0,[1],1,\"-\"],[0,[],0,\" )\"]],[[0,[],0,\"finally parse it as float\"]]]],[1,\"p\",[[0,[],0,\"Implementation in \"],[0,[1],1,\"node js\"]]],[10,18],[1,\"p\",[[0,[],0,\"and analogical in rust\"]]],[10,19],[1,\"p\",[[0,[],0,\"In rust generally handling conversions between types require more characters but is more reliable. In this case writing \"],[0,[1],1,\"unwrap\"],[0,[],0,\" we are enforced to think about possible ways of handle problems with parsing.\"]]],[1,\"p\",[[0,[],0,\"Now we can present constructors. In them we will pass array of strings with coefficients like \"],[0,[1],1,\"8\"],[0,[],0,\", \"],[0,[1],1,\"-9k\"],[0,[],0,\", or \"],[0,[1],1,\"i\"],[0,[],0,\". In \"],[0,[1],1,\"node js\"],[0,[],0,\":\"]]],[10,20],[1,\"p\",[[0,[],0,\"or in \"],[0,[1],1,\"rust\"],[0,[],0,\":\"]]],[10,21],[1,\"h2\",[[0,[],0,\"Multiplication of Quaternions\"]]],[1,\"p\",[[0,[],0,\"Multiplication of two quaternions is similar to multiplication of polynomials. Firstly we muliply any components pairs each other. Then we can group them by component type and finally add coefficients. Difference is that in polynomial multiplication we always adding powers, but in Quaternions we using noncommutative division algebra presented on table:\"]]],[10,22],[1,\"p\",[[0,[],0,\"So basically we can divide our problem to:\"]]],[3,\"ul\",[[[0,[],0,\"multiplication of base elements\"]],[[0,[],0,\"multiplication of linear combinations of base elements\"]]]],[1,\"h3\",[[0,[],0,\"Multiplication of base elements\"]]],[1,\"p\",[[0,[],0,\"I rewrote all possible cases in test file in \"],[0,[1],1,\"NodeJS\"]]],[10,23],[1,\"p\",[[0,[],0,\"and \"],[0,[1],1,\"Rust\"]]],[10,24],[1,\"p\",[[0,[],0,\"In \"],[0,[1],1,\"Rust\"],[0,[],0,\" I have to define \"],[0,[1],1,\"SignedCoefficient\"],[0,[],0,\" that was simple anonymous objects in \"],[0,[1],1,\"node\"]]],[10,25],[1,\"p\",[[0,[],0,\"additionally I have to implement equation relation on them to use \"],[0,[1],1,\"assert_eq\"],[0,[],0,\".\"]]],[10,26],[1,\"p\",[[0,[],0,\"Function \"],[0,[1],1,\"multiplyBase\"],[0,[],0,\" is super simple and to build it we have to see that:\"]]],[3,\"ul\",[[[0,[],0,\"multiplication by 1 is always the other element. \"],[0,[1],1,\"a * 1 = a\"],[0,[],0,\" and \"],[0,[1],1,\"1 * a = a\"]],[[0,[],0,\"excluding 1 we always have \"],[0,[1],1,\"a * a = -1\"]],[[0,[],0,\"excluding 1 and diagonal we always receive coefficient different that these used to multiply, sign can be determined using \"],[0,[1],1,\"%2\"],[0,[],0,\" operation and direction of multiplication.\"]]]],[1,\"p\",[[0,[],0,\"Using these observations we can define multiplication in \"],[0,[1],1,\"node\"],[0,[],0,\" as\"]]],[10,27],[1,\"p\",[[0,[],0,\"and in \"],[0,[1],1,\"rust\"]]],[10,28],[1,\"h3\",[[0,[],0,\"Multiplication of linear combinations\"]]],[1,\"p\",[[0,[],0,\"I divided multiplication tests to simple and complex cases\"]]],[10,29],[1,\"p\",[[0,[],0,\"and\"]]],[10,30],[1,\"p\",[[0,[],0,\"here to compare Quaternions we have to implement \"],[0,[1],1,\"PartialEq\"]]],[10,31],[1,\"p\",[[0,[],0,\"In \"],[0,[1],1,\"NodeJS\"],[0,[],0,\" is can be reduced to nested loop like this\"]]],[10,32],[1,\"p\",[[0,[1],1,\"c\"],[0,[],0,\" is sign, \"],[0,[1],1,\"d\"],[0,[],0,\" is name of coefficient. \"]]],[1,\"p\",[[0,[],0,\"In \"],[0,[1],1,\"Rust\"],[0,[],0,\" we cant have access to dynamic properties that are chars so we have to add two auxiliary methods to get and set values using chars\"]]],[10,33],[1,\"p\",[[0,[],0,\"but generally idea is the same.\"]]],[1,\"p\",[[0,[],0,\"Now we have program that can read input, convert it to array of Quaternions and multiply them.\"]]],[10,34],[1,\"p\",[[0,[],0,\"Last lacking element is formatting result as string.\"]]],[1,\"h2\",[[0,[],0,\"Formatting Quaternion to strings\"]]],[1,\"p\",[[0,[],0,\"Formatting results can be considered as:\"]]],[3,\"ul\",[[[0,[],0,\"formatting any single coefficient using special treatments for \"],[0,[1],1,\"1\"]],[[0,[],0,\"building ordered array of coefficients that is joined as sting\"]]]],[1,\"p\",[[0,[],0,\"These operations are inversion of parsing presented in first part. Lest start from tests in \"],[0,[1],1,\"node js\"]]],[10,35],[1,\"p\",[[0,[],0,\"Analogical tests in \"],[0,[1],1,\"rust\"]]],[10,36],[1,\"p\",[[0,[],0,\"In function \"],[0,[1],1,\"formatCoefficient\"],[0,[],0,\" we carry about cases like \"],[0,[1],1,\"1\"],[0,[],0,\", \"],[0,[1],1,\"-\"],[0,[],0,\" and deciding if component name like \"],[0,[1],1,\"i\"],[0,[],0,\", \"],[0,[1],1,\"j\"],[0,[],0,\" or \"],[0,[1],1,\"k\"],[0,[],0,\" should be added to result.\"]]],[10,37],[1,\"p\",[[0,[],0,\"and\"]]],[10,38],[1,\"p\",[[0,[],0,\"In function \"],[0,[1],1,\"format\"],[0,[],0,\" we collecting these components and decide about joining. We can't join by \"],[0,[1],1,\"+\"],[0,[],0,\" because of some elements starts from \"],[0,[1],1,\"-\"],[0,[],0,\". But we have to handle case of \"],[0,[1],1,\"0\"],[0,[],0,\". Finally in \"],[0,[1],1,\"NodeJS\"],[0,[],0,\" we have:\"]]],[10,39],[1,\"p\",[[0,[],0,\"while in \"],[0,[1],1,\"rust\"],[0,[],0,\" implementation of formatting can be done by \"],[0,[1],1,\"fmt\"],[0,[],0,\" function\"]]],[10,40],[1,\"h3\",[[0,[],0,\"Final e2e tests\"]]],[1,\"p\",[[0,[],0,\"To check if all parts of programs match to each other we can prepare some \"],[0,[1],1,\"e2e\"],[0,[],0,\" test cases in \"],[0,[1],1,\"node\"]]],[10,41],[1,\"p\",[[0,[],0,\"and analogically in \"],[0,[1],1,\"rust\"]]],[10,42],[1,\"p\",[[0,[],0,\"It is the end of this exercise. If you are interested in learning more about Quaternions multiplication and how it is connected with geometry I recommend you video:\"]]],[10,43],[1,\"p\",[[0,[],0,\"As you can see \"],[0,[1],1,\"rust\"],[0,[],0,\" and \"],[0,[1],1,\"typescript\"],[0,[],0,\" have a lot of similar elements. All descriptions and logic elements are identical and only differences can be seen on level of syntax, that is more focused on elimination of undefined behaviors in rust. On the other hand in typescript code can be written in a little more concise way that can improve readability.\"]]]],\"ghostVersion\":\"4.0\"}","html":"<p>In this article we will see how to implement the multiplication of quaternions in Rust and NodeJS. I encourage you to try solve this problem before seeing solutions. Below I attaching link to this exercise:</p><figure class=\"kg-card kg-bookmark-card\"><a class=\"kg-bookmark-container\" href=\"https://www.codingame.com/training/medium/quaternion-multiplication\"><div class=\"kg-bookmark-content\"><div class=\"kg-bookmark-title\">Coding Games and Programming Challenges to Code Better</div><div class=\"kg-bookmark-description\">CodinGame is a challenge-based training platform for programmers where you can play with the hottest programming topics. Solve games, code AI bots, learn from your peers, have fun.</div><div class=\"kg-bookmark-metadata\"><img class=\"kg-bookmark-icon\" src=\"https://static.codingame.com/assets/apple-touch-icon-152x152-precomposed.5cb052db.png\"><span class=\"kg-bookmark-author\">CodinGame</span></div></div><div class=\"kg-bookmark-thumbnail\"><img src=\"https://files.codingame.com/codingame/codingame_share_pics.jpg\"></div></a></figure><p>The quaternions belong to a number system that extends the complex numbers. A quaternion is defined by the sum of scalar multiples of the constants <strong>i</strong>,<strong>j</strong>,<strong>k</strong> and <strong>1</strong>.<br>More information is available at:</p><figure class=\"kg-card kg-bookmark-card\"><a class=\"kg-bookmark-container\" href=\"https://mathworld.wolfram.com/Quaternion.html\"><div class=\"kg-bookmark-content\"><div class=\"kg-bookmark-title\">Quaternion -- from Wolfram MathWorld</div><div class=\"kg-bookmark-description\">The quaternions are members of a noncommutative division algebra first invented by William Rowan Hamilton. The idea for quaternions occurred to him while he was walking along the Royal Canal on his way to a meeting of the Irish Academy, and Hamilton was so pleased with his discovery that he scratche…</div><div class=\"kg-bookmark-metadata\"><span class=\"kg-bookmark-author\">from Wolfram MathWorld</span></div></div><div class=\"kg-bookmark-thumbnail\"><img src=\"https://mathworld.wolfram.com/images/socialmedia/share.png\"></div></a></figure><p>Consider the following properties:<br><strong>jk</strong> = <strong>i</strong><br><strong>ki</strong> = <strong>j</strong><br><strong>ij</strong> = <strong>k</strong><br><strong>i</strong>² = <strong>j</strong>² = <strong>k</strong>² = <strong>-1</strong><br><br>These properties also imply that:<br><strong>kj</strong> = <strong>-i</strong><br><strong>ik</strong> = <strong>-j</strong><br><strong>ji</strong> = <strong>-k</strong><br><br>The order of multiplication is important.<br><br>Your program must output the result of the product of a number of bracketed simplified quaternions.<br><br><strong>Pay attention to the formatting</strong><br>The coefficient is appended to the left of the constant.<br>If a coefficient is <strong>1</strong> or <strong>-1</strong>, don't include the <strong>1</strong> symbol.<br>If a coefficient or scalar term is <strong>0</strong>, don't include it.<br>The terms must be displayed in order: a<strong>i</strong> + b<strong>j</strong> + c<strong>k</strong> + d.<br><br><strong>Example Multiplication</strong><br>(2i+2j)(j+1) = (2ij+2i+2j² +2j) = (2k+2i-2+2j) = (2i+2j+2k-2)</p><hr><p><strong>Input:</strong></p><p><strong>Line 1</strong>: The expression expr to evaluate. This will always be the product of simplified bracketed expressions.</p><p><strong>Output: </strong>A single line containing the simplified result of the product expression. No brackets are required.</p><p><strong>Constraints: </strong>All coefficients in any part of evaluation will be less than <strong>10^9</strong><br>The input contains no more than 10 simplified bracketed expressions</p><p><strong>Example</strong></p><p><strong>Input</strong></p><pre><code>(i+j)(k)</code></pre><p><strong>Output</strong></p><pre><code>i-j</code></pre><h1 id=\"solution\">Solution</h1><p>I decided to present only most important parts here. Full solution can be found in repository:</p><figure class=\"kg-card kg-bookmark-card\"><a class=\"kg-bookmark-container\" href=\"https://github.com/gustawdaniel/codingame-quaternion-multiplication\"><div class=\"kg-bookmark-content\"><div class=\"kg-bookmark-title\">GitHub - gustawdaniel/codingame-quaternion-multiplication</div><div class=\"kg-bookmark-description\">Contribute to gustawdaniel/codingame-quaternion-multiplication development by creating an account on GitHub.</div><div class=\"kg-bookmark-metadata\"><img class=\"kg-bookmark-icon\" src=\"https://github.githubassets.com/favicons/favicon.svg\"><span class=\"kg-bookmark-author\">GitHub</span><span class=\"kg-bookmark-publisher\">gustawdaniel</span></div></div><div class=\"kg-bookmark-thumbnail\"><img src=\"https://opengraph.githubassets.com/85682fcbd54214a903a6cb968a0137db1d1243d42b118b9e0764ac9229c76d63/gustawdaniel/codingame-quaternion-multiplication\"></div></a></figure><p>We can divide our problem to three steps:</p><ul><li>parsing input to Quaternion structure</li><li>multiplication of Quaternions</li><li>formatting Quaternion again to string</li></ul><figure class=\"kg-card kg-image-card\"><img src=\"__GHOST_URL__/content/images/2023/01/2023-01-20_01-02.png\" class=\"kg-image\" alt loading=\"lazy\" width=\"487\" height=\"273\"></figure><p>These high-level operations can be implemented in NodeJS</p><pre><code class=\"language-typescript\">import {Quaternion} from \"./lib\";\n\nprocess.stdin.on('data', (buff) =&gt; {\n    const line = buff.toString();\n    const qs = Quaternion.parse(line);\n    process.stdout.write(qs.reduce((p, n) =&gt; p.multiply(n)).format());\n})</code></pre><p>and in Rust</p><pre><code class=\"language-rust\">fn main() {\n    let mut input_line = String::new();\n    io::stdin().read_line(&amp;mut input_line).unwrap();\n    let expr = input_line.trim_matches('\\n').to_string();\n\n    let qs = Quaternion::parse(&amp;expr);\n    let out = qs.into_iter().reduce(|p, n| p.multiply(n)).unwrap();\n    println!(\"{}\", out);\n}</code></pre><p>You can see that this code is really similar but in both cases we have to implement <code>Struct/Class</code> named <code>Quaternion</code>. Now we will go through three steps mentioned before using <code>TDD</code>. Tests are natively supported in rust, but in <code>NodeJS</code> I decided to use <code>jest</code> as testing framework.</p><h2 id=\"parsing-input-to-quaternion-structure\">Parsing input to Quaternion structure</h2><p>Our input</p><pre><code>(i+j)(k)</code></pre><p>should be treated as array of quaternions - separated by brackets. In any brackets we have array of coefficients. So we can divide our parsing to 4 parts:</p><ul><li>spliting by brackets</li><li>splitings any bracket to coefficients</li><li>creating Quaternions from arrays of coefficients </li><li>extracing number from coefficient</li></ul><figure class=\"kg-card kg-image-card\"><img src=\"__GHOST_URL__/content/images/2023/01/2023-01-20_01-35.png\" class=\"kg-image\" alt loading=\"lazy\" width=\"631\" height=\"88\" srcset=\"__GHOST_URL__/content/images/size/w600/2023/01/2023-01-20_01-35.png 600w, __GHOST_URL__/content/images/2023/01/2023-01-20_01-35.png 631w\"></figure><p>In NodeJS we can start from two tests. First for simple cases:</p><pre><code class=\"language-typescript\">    it('simple parse', () =&gt; {\n        const qs = Quaternion.parse('(i+j)');\n        expect(qs.length).toEqual(1);\n        expect(qs[0].r).toEqual(0);\n        expect(qs[0].i).toEqual(1);\n        expect(qs[0].j).toEqual(1);\n        expect(qs[0].k).toEqual(0);\n    });</code></pre><p>Second for more advanced coefficients:</p><pre><code class=\"language-typescript\">    it('complex parse', () =&gt; {\n        const qs = Quaternion.parse('(9+i-j)(k-8.4j)');\n        expect(qs.length).toEqual(2);\n        expect(qs[0].r).toEqual(9);\n        expect(qs[0].i).toEqual(1);\n        expect(qs[0].j).toEqual(-1);\n        expect(qs[0].k).toEqual(0);\n\n        expect(qs[1].r).toEqual(0);\n        expect(qs[1].i).toEqual(0);\n        expect(qs[1].j).toEqual(-8.4);\n        expect(qs[1].k).toEqual(1);\n    });</code></pre><p>The same tests in <code>rust</code> can be written as</p><pre><code class=\"language-rust\">#[cfg(test)]\nmod tests {\n    use crate::{Quaternion};\n\n\n    #[test]\n    fn simple_parse() {\n        let qs = Quaternion::parse(\"(i+j)\");\n        assert_eq!(qs.len(), 1);\n        assert_eq!(qs[0].r, 0f64);\n        assert_eq!(qs[0].i, 1f64);\n        assert_eq!(qs[0].j, 1f64);\n        assert_eq!(qs[0].k, 0f64);\n    }\n\n    #[test]\n    fn complex_parse() {\n        let qs = Quaternion::parse(\"(9+i-j)(k-8.4j)\");\n        assert_eq!(qs.len(), 2);\n        assert_eq!(qs[0].r, 9f64);\n        assert_eq!(qs[0].i, 1f64);\n        assert_eq!(qs[0].j, -1f64);\n        assert_eq!(qs[0].k, 0f64);\n\n        assert_eq!(qs[1].r, 0f64);\n        assert_eq!(qs[1].i, 0f64);\n        assert_eq!(qs[1].j, -8.4f64);\n        assert_eq!(qs[1].k, 1f64);\n    }\n}</code></pre><p>Our base <code>Quaternion</code> class will have <code>4</code> properties. In NodeJS:</p><pre><code class=\"language-typescript\">export class Quaternion {\n    r: number = 0;\n    i: number = 0;\n    j: number = 0;\n    k: number = 0;\n}</code></pre><p>where <code>r</code> means <code>real</code> part that inherits arithmetic from real numbers. In <code>rust</code> we are using <code>struct</code> keyword instead of <code>class</code></p><pre><code class=\"language-rust\">#[derive(Debug)]\nstruct Quaternion {\n    r: f64,\n    i: f64,\n    j: f64,\n    k: f64,\n}</code></pre><h3 id=\"splitting-string-using-regular-expressions\">Splitting string using regular expressions</h3><p>To split input and provide arrays of coefficients to Quaternion constructors we can write methods in NodeJS:</p><pre><code class=\"language-typescript\">    static parse(input: string): Quaternion[] {\n        const qs = (input.match(/\\(.*?\\)/g) ?? []).map(\n            (e: string) =&gt; (e\n                    .replace('(', '')\n                    .replace(')', '')\n                    .match(/[-+]?[\\d.]*[ijk]?/g) ?? []\n            ).filter(v =&gt; v).map(\n                v =&gt; v.replace(/^\\+/, '')\n            )\n        );\n        return qs.map((q) =&gt; new Quaternion(q));\n    }\n</code></pre><p>and Rust</p><pre><code class=\"language-rust\">impl Quaternion {\n    fn parse(input: &amp;str) -&gt; Vec&lt;Quaternion&gt; {\n        let re = Regex::new(r\"\\((.*?)\\)\").expect(\"can't create regex\");\n\n        let qs = re.captures_iter(input).filter_map(|cap| Some(cap.get(1)?.as_str()))\n            .map(|m| m.to_string()).collect::&lt;Vec&lt;_&gt;&gt;();\n\n        let re = Regex::new(r\"\\+?(-?[\\d.]*[ijk]?)\").expect(\"can't create regex\");\n\n        let res = qs.iter().map(|q| {\n            let args = re.captures_iter(&amp;q).filter_map(|cap| Some(cap.get(1)?.as_str()))\n                .map(|m| m.to_string()).collect::&lt;Vec&lt;_&gt;&gt;();\n            Quaternion::new(args)\n        });\n\n        res.collect::&lt;Vec&lt;_&gt;&gt;()\n    }\n}</code></pre><p>Generally there are the same regex expressions but <code>rust</code> requires here external library called <code>regex</code>. Additionally <code>rust</code> checks correctness of regex expressions and ensure handling errors in them, that can be skipped by default in <code>node js</code> code. Generally I feel that <code>node js</code> approach to regex is more clean and readable.</p><p>Now we have the following problem. Our coefficients can contains numbers, numbers with names of component like: <code>i</code>, <code>j</code> or <code>k</code>, or even lonely letters like <code>i</code> what means <code>1i</code>. There are also possible signs like <code>-k</code>.</p><p>We need code that will extract numbers from them. Lets name <code>i</code>, <code>j</code> or <code>k</code> as <code>type</code> and full coefficient string as <code>input</code>. Then extracting number can be considered as:</p><ul><li>removing <code>type</code> from <code>input</code></li><li>if rest not end with digit then add <code>1</code> on the end ( example is <code>-</code> )</li><li>finally parse it as float</li></ul><p>Implementation in <code>node js</code></p><pre><code class=\"language-typescript\">    static getCoefficient(type: string, input: string): number {\n        const coefficient = input.replace(type, '');\n        return Number.parseFloat(/\\d$/.test(coefficient) ? coefficient : coefficient + '1')\n    }</code></pre><p>and analogical in rust</p><pre><code class=\"language-rust\">    fn get_coefficient(t: &amp;str, input: String) -&gt; f64 {\n        let c = input.replace(t, \"\");\n        if Regex::new(r\"\\d$\").expect(\"ff\").is_match(&amp;c) {\n            c.parse::&lt;f64&gt;().unwrap()\n        } else {\n            (c + \"1\").parse::&lt;f64&gt;().unwrap()\n        }\n    }</code></pre><p>In rust generally handling conversions between types require more characters but is more reliable. In this case writing <code>unwrap</code> we are enforced to think about possible ways of handle problems with parsing.</p><p>Now we can present constructors. In them we will pass array of strings with coefficients like <code>8</code>, <code>-9k</code>, or <code>i</code>. In <code>node js</code>:</p><pre><code class=\"language-typescript\">    constructor(args: Array&lt;string&gt;) {\n        for (let arg of args) {\n            if (arg.includes('i')) {\n                this.i = Quaternion.getCoefficient('i', arg);\n            } else if (arg.includes('j')) {\n                this.j = Quaternion.getCoefficient('j', arg);\n            } else if (arg.includes('k')) {\n                this.k = Quaternion.getCoefficient('k', arg);\n            } else {\n                this.r = Number.parseFloat(arg);\n            }\n        }\n    }</code></pre><p>or in <code>rust</code>:</p><pre><code class=\"language-rust\">    fn new(args: Vec&lt;String&gt;) -&gt; Quaternion {\n        let mut q = Quaternion {\n            i: 0f64,\n            j: 0f64,\n            k: 0f64,\n            r: 0f64,\n        };\n\n        for arg in args {\n            if arg.contains(\"i\") {\n                q.i = Quaternion::get_coefficient(\"i\", arg)\n            } else if arg.contains(\"j\") {\n                q.j = Quaternion::get_coefficient(\"j\", arg)\n            } else if arg.contains(\"k\") {\n                q.k = Quaternion::get_coefficient(\"k\", arg)\n            } else {\n                q.r = arg.parse::&lt;f64&gt;().unwrap()\n            }\n        }\n\n        q\n    }</code></pre><h2 id=\"multiplication-of-quaternions\">Multiplication of Quaternions</h2><p>Multiplication of two quaternions is similar to multiplication of polynomials. Firstly we muliply any components pairs each other. Then we can group them by component type and finally add coefficients. Difference is that in polynomial multiplication we always adding powers, but in Quaternions we using noncommutative division algebra presented on table:</p><figure class=\"kg-card kg-image-card\"><img src=\"__GHOST_URL__/content/images/2023/01/2023-01-20_02-10.png\" class=\"kg-image\" alt loading=\"lazy\" width=\"184\" height=\"194\"></figure><p>So basically we can divide our problem to:</p><ul><li>multiplication of base elements</li><li>multiplication of linear combinations of base elements</li></ul><h3 id=\"multiplication-of-base-elements\">Multiplication of base elements</h3><p>I rewrote all possible cases in test file in <code>NodeJS</code></p><pre><code class=\"language-typescript\">    it('multiply base', () =&gt; {\n        expect(Quaternion.multiplyBase('r', 'r')).toEqual({c: 1, d: 'r'});\n        expect(Quaternion.multiplyBase('r', 'i')).toEqual({c: 1, d: 'i'});\n        expect(Quaternion.multiplyBase('r', 'j')).toEqual({c: 1, d: 'j'});\n        expect(Quaternion.multiplyBase('r', 'k')).toEqual({c: 1, d: 'k'});\n\n        expect(Quaternion.multiplyBase('i', 'r')).toEqual({c: 1, d: 'i'});\n        expect(Quaternion.multiplyBase('i', 'i')).toEqual({c: -1, d: 'r'});\n        expect(Quaternion.multiplyBase('i', 'j')).toEqual({c: 1, d: 'k'});\n        expect(Quaternion.multiplyBase('i', 'k')).toEqual({c: -1, d: 'j'});\n\n        expect(Quaternion.multiplyBase('j', 'r')).toEqual({c: 1, d: 'j'});\n        expect(Quaternion.multiplyBase('j', 'i')).toEqual({c: -1, d: 'k'});\n        expect(Quaternion.multiplyBase('j', 'j')).toEqual({c: -1, d: 'r'});\n        expect(Quaternion.multiplyBase('j', 'k')).toEqual({c: 1, d: 'i'});\n\n        expect(Quaternion.multiplyBase('k', 'r')).toEqual({c: 1, d: 'k'});\n        expect(Quaternion.multiplyBase('k', 'i')).toEqual({c: 1, d: 'j'});\n        expect(Quaternion.multiplyBase('k', 'j')).toEqual({c: -1, d: 'i'});\n        expect(Quaternion.multiplyBase('k', 'k')).toEqual({c: -1, d: 'r'});\n    })</code></pre><p>and <code>Rust</code></p><pre><code class=\"language-rust\">    #[test]\n    fn multiply_base() {\n        assert_eq!(Quaternion::multiply_base('r', 'r'), SignedCoefficient { c: 1f64, d: 'r' });\n        assert_eq!(Quaternion::multiply_base('r', 'i'), SignedCoefficient { c: 1f64, d: 'i' });\n        assert_eq!(Quaternion::multiply_base('r', 'j'), SignedCoefficient { c: 1f64, d: 'j' });\n        assert_eq!(Quaternion::multiply_base('r', 'k'), SignedCoefficient { c: 1f64, d: 'k' });\n\n        assert_eq!(Quaternion::multiply_base('i', 'r'), SignedCoefficient { c: 1f64, d: 'i' });\n        assert_eq!(Quaternion::multiply_base('i', 'i'), SignedCoefficient { c: -1f64, d: 'r' });\n        assert_eq!(Quaternion::multiply_base('i', 'j'), SignedCoefficient { c: 1f64, d: 'k' });\n        assert_eq!(Quaternion::multiply_base('i', 'k'), SignedCoefficient { c: -1f64, d: 'j' });\n\n        assert_eq!(Quaternion::multiply_base('j', 'r'), SignedCoefficient { c: 1f64, d: 'j' });\n        assert_eq!(Quaternion::multiply_base('j', 'i'), SignedCoefficient { c: -1f64, d: 'k' });\n        assert_eq!(Quaternion::multiply_base('j', 'j'), SignedCoefficient { c: -1f64, d: 'r' });\n        assert_eq!(Quaternion::multiply_base('j', 'k'), SignedCoefficient { c: 1f64, d: 'i' });\n\n        assert_eq!(Quaternion::multiply_base('k', 'r'), SignedCoefficient { c: 1f64, d: 'k' });\n        assert_eq!(Quaternion::multiply_base('k', 'i'), SignedCoefficient { c: 1f64, d: 'j' });\n        assert_eq!(Quaternion::multiply_base('k', 'j'), SignedCoefficient { c: -1f64, d: 'i' });\n        assert_eq!(Quaternion::multiply_base('k', 'k'), SignedCoefficient { c: -1f64, d: 'r' });\n    }</code></pre><p>In <code>Rust</code> I have to define <code>SignedCoefficient</code> that was simple anonymous objects in <code>node</code></p><pre><code class=\"language-rust\">#[derive(Debug)]\nstruct SignedCoefficient {\n    c: f64,\n    d: char,\n}</code></pre><p>additionally I have to implement equation relation on them to use <code>assert_eq</code>.</p><pre><code class=\"language-rust\">impl PartialEq&lt;SignedCoefficient&gt; for SignedCoefficient {\n    fn eq(&amp;self, other: &amp;SignedCoefficient) -&gt; bool {\n        self.c == other.c &amp;&amp; self.d == other.d\n    }\n}</code></pre><p>Function <code>multiplyBase</code> is super simple and to build it we have to see that:</p><ul><li>multiplication by 1 is always the other element. <code>a * 1 = a</code> and <code>1 * a = a</code></li><li>excluding 1 we always have <code>a * a = -1</code></li><li>excluding 1 and diagonal we always receive coefficient different that these used to multiply, sign can be determined using <code>%2</code> operation and direction of multiplication.</li></ul><p>Using these observations we can define multiplication in <code>node</code> as</p><pre><code class=\"language-typescript\">    static multiplyBase(a: Base, b: Base): { c: -1 | 1, d: Base } {\n        if (a === 'r') return {c: 1, d: b};\n        if (b === 'r') return {c: 1, d: a};\n        if (a === b) return {c: -1, d: 'r'};\n        const diff = a.charCodeAt(0) - b.charCodeAt(0);\n        return {\n            c: (diff &gt; 0 ? -1 : 1) * ((diff + 2) % 2 === 0 ? -1 : 1) as -1 | 1,\n            d: ['i', 'j', 'k'].find((e) =&gt; e !== a &amp;&amp; e !== b) as Base\n        }\n    }</code></pre><p>and in <code>rust</code></p><pre><code class=\"language-rust\">    fn multiply_base(a: char, b: char) -&gt; SignedCoefficient {\n        if a == 'r' { return SignedCoefficient { c: 1f64, d: b }; }\n        if b == 'r' { return SignedCoefficient { c: 1f64, d: a }; }\n        if a == b { return SignedCoefficient { c: -1f64, d: 'r' }; }\n        let diff = u32::from(a) as i32 - u32::from(b) as i32;\n\n        SignedCoefficient {\n            c: (if diff &gt; 0 { -1f64 } else { 1f64 }) * (if (diff + 2i32) % 2 == 0 { -1f64 } else { 1f64 }),\n            d: vec!['i', 'j', 'k'].iter().find(|&amp;&amp;e| e != a &amp;&amp; e != b).unwrap().to_owned(),\n        }\n    }</code></pre><h3 id=\"multiplication-of-linear-combinations\">Multiplication of linear combinations</h3><p>I divided multiplication tests to simple and complex cases</p><pre><code class=\"language-typescript\">    it('simple multiply', () =&gt; {\n        const res = (new Quaternion(['1']))\n            .multiply(new Quaternion(['1']))\n\n        expect(res.r).toEqual(1);\n        expect(res.i).toEqual(0);\n        expect(res.j).toEqual(0);\n        expect(res.k).toEqual(0);\n    })\n\n    it('complex multiply', () =&gt; {\n        const res = (new Quaternion(['2i', '2j']))\n            .multiply(new Quaternion(['j', '1']))\n\n        expect(res.r).toEqual(-2);\n        expect(res.i).toEqual(2);\n        expect(res.j).toEqual(2);\n        expect(res.k).toEqual(2);\n    })</code></pre><p>and</p><pre><code class=\"language-rust\">    #[test]\n    fn simple_multiply() {\n        let res = Quaternion::new(vec![String::from(\"1\")])\n            .multiply(Quaternion::new(vec![String::from(\"1\")]));\n\n        assert_eq!(res, Quaternion {\n            r: 1f64,\n            i: 0f64,\n            j: 0f64,\n            k: 0f64,\n        })\n    }\n\n    #[test]\n    fn complex_multiply() {\n        let res = Quaternion::new(vec![String::from(\"2i\"), String::from(\"2j\")])\n            .multiply(Quaternion::new(vec![String::from(\"j\"), String::from(\"1\")]));\n\n        assert_eq!(res, Quaternion {\n            r: -2f64,\n            i: 2f64,\n            j: 2f64,\n            k: 2f64,\n        })\n    }</code></pre><p>here to compare Quaternions we have to implement <code>PartialEq</code></p><pre><code class=\"language-rust\">impl PartialEq&lt;Quaternion&gt; for Quaternion {\n    fn eq(&amp;self, other: &amp;Quaternion) -&gt; bool {\n        self.r == other.r &amp;&amp; self.i == other.i &amp;&amp; self.j == other.j &amp;&amp; self.k == other.k\n    }\n}\n</code></pre><p>In <code>NodeJS</code> is can be reduced to nested loop like this</p><pre><code class=\"language-typescript\">    multiply(a: Quaternion): Quaternion {\n        const res = new Quaternion([]);\n        for (let p of ['r', 'i', 'j', 'k'] as Array&lt;Base&gt;) {\n            for (let n of ['r', 'i', 'j', 'k'] as Array&lt;Base&gt;) {\n                const {c, d} = Quaternion.multiplyBase(p, n);\n                res[d] += c * this[p] * a[n];\n            }\n        }\n        return res;\n    }</code></pre><p><code>c</code> is sign, <code>d</code> is name of coefficient. </p><p>In <code>Rust</code> we cant have access to dynamic properties that are chars so we have to add two auxiliary methods to get and set values using chars</p><pre><code class=\"language-rust\">    fn get(&amp;self, key: char) -&gt; f64 {\n        match key {\n            'r' =&gt; self.r,\n            'i' =&gt; self.i,\n            'j' =&gt; self.j,\n            'k' =&gt; self.k,\n            _ =&gt; 0f64\n        }\n    }\n\n    fn set(&amp;mut self, key: char, value: f64) -&gt; &amp;Quaternion {\n        match key {\n            'r' =&gt; self.r = value,\n            'i' =&gt; self.i = value,\n            'j' =&gt; self.j = value,\n            'k' =&gt; self.k = value,\n            _ =&gt; ()\n        }\n\n        self\n    }\n\n    fn multiply(&amp;self, a: Quaternion) -&gt; Quaternion {\n        let mut res = Quaternion::new(vec![]);\n        for p in vec!['r', 'i', 'j', 'k'] {\n            for n in vec!['r', 'i', 'j', 'k'] {\n                let SignedCoefficient { c, d } = Quaternion::multiply_base(p, n);\n                res.set(d, res.get(d) + c * self.get(p) * a.get(n));\n            }\n        }\n        res\n    }</code></pre><p>but generally idea is the same.</p><p>Now we have program that can read input, convert it to array of Quaternions and multiply them.</p><figure class=\"kg-card kg-image-card\"><img src=\"__GHOST_URL__/content/images/2023/01/maxresdefault.jpg\" class=\"kg-image\" alt loading=\"lazy\" width=\"1280\" height=\"720\" srcset=\"__GHOST_URL__/content/images/size/w600/2023/01/maxresdefault.jpg 600w, __GHOST_URL__/content/images/size/w1000/2023/01/maxresdefault.jpg 1000w, __GHOST_URL__/content/images/2023/01/maxresdefault.jpg 1280w\" sizes=\"(min-width: 720px) 720px\"></figure><p>Last lacking element is formatting result as string.</p><h2 id=\"formatting-quaternion-to-strings\">Formatting Quaternion to strings</h2><p>Formatting results can be considered as:</p><ul><li>formatting any single coefficient using special treatments for <code>1</code></li><li>building ordered array of coefficients that is joined as sting</li></ul><p>These operations are inversion of parsing presented in first part. Lest start from tests in <code>node js</code></p><pre><code class=\"language-typescript\">    it('format coefficient', () =&gt; {\n       expect(Quaternion.formatCoefficient('i', 20)).toEqual('20i');\n       expect(Quaternion.formatCoefficient('i', 1)).toEqual('i');\n       expect(Quaternion.formatCoefficient('', 0)).toEqual('0');\n    });\n\n    it('format', () =&gt; {\n        expect((new Quaternion([]).format())).toEqual('0');\n        expect((new Quaternion(['1']).format())).toEqual('1');\n        expect((new Quaternion(['i', '1']).format())).toEqual('i+1');\n        expect((new Quaternion(['i', '-3.4j', '1']).format())).toEqual('i-3.4j+1');\n        expect((new Quaternion(['j', 'k']).format())).toEqual('j+k');\n\n    })</code></pre><p>Analogical tests in <code>rust</code></p><pre><code class=\"language-rust\">    #[test]\n    fn format_coefficient() {\n        assert_eq!(Quaternion::format_coefficient('i', 20f64), String::from(\"20i\"));\n        assert_eq!(Quaternion::format_coefficient('i', 1f64), String::from(\"i\"));\n        assert_eq!(Quaternion::format_coefficient(' ', 0f64), String::from(\"0\"));\n    }\n\n    #[test]\n    fn format() {\n        assert_eq!(format!(\"{}\", Quaternion::new(vec![])), String::from(\"0\"));\n        assert_eq!(format!(\"{}\", Quaternion::new(vec![String::from(\"1\")])), String::from(\"1\"));\n        assert_eq!(format!(\"{}\", Quaternion::new(vec![String::from(\"i\"), String::from(\"1\")])), String::from(\"i+1\"));\n        assert_eq!(format!(\"{}\", Quaternion::new(vec![String::from(\"i\"), String::from(\"-3.4j\"), String::from(\"1\")])), String::from(\"i-3.4j+1\"));\n        assert_eq!(format!(\"{}\", Quaternion::new(vec![String::from(\"j\"), String::from(\"k\")])), String::from(\"j+k\"));\n    }</code></pre><p>In function <code>formatCoefficient</code> we carry about cases like <code>1</code>, <code>-</code> and deciding if component name like <code>i</code>, <code>j</code> or <code>k</code> should be added to result.</p><pre><code class=\"language-typescript\">    static formatCoefficient(type: Base | '', value: number) {\n        const out = `${Math.abs(value) === 1 ? (\n            Math.sign(value) === 1 ? '' : '-'\n        ) : value}${type}`;\n        return /[\\dijk]$/.test(out) ? out : `${out}1`;\n    }</code></pre><p>and</p><pre><code class=\"language-rust\">    fn format_coefficient(t: char, value: f64) -&gt; String {\n        let out = if f64::abs(value) == 1f64 {\n            if f64::signum(value) == 1f64 {\n                String::from(\"\") + &amp;t.to_string()[..].trim()\n            } else {\n                String::from(\"-\") + &amp;t.to_string()[..].trim()\n            }\n        } else {\n            format!(\"{}\", value) + &amp;t.to_string()[..].trim()\n        };\n\n        match Regex::new(r\"[\\dijk]$\").unwrap().captures(&amp;out[..]) {\n            Some(_) =&gt; out,\n            None =&gt; out + \"1\"\n        }\n    }\n}</code></pre><p>In function <code>format</code> we collecting these components and decide about joining. We can't join by <code>+</code> because of some elements starts from <code>-</code>. But we have to handle case of <code>0</code>. Finally in <code>NodeJS</code> we have:</p><pre><code class=\"language-typescript\">    format(): string {\n        let out = [];\n        if (this.i) {\n            out.push(Quaternion.formatCoefficient('i', this.i));\n        }\n        if (this.j) {\n            out.push(Quaternion.formatCoefficient('j', this.j));\n        }\n        if (this.k) {\n            out.push(Quaternion.formatCoefficient('k', this.k));\n        }\n        if (this.r) {\n            out.push(Quaternion.formatCoefficient('', this.r));\n        }\n\n        if (!out.length) return '0';\n\n        return out.reduce((p, n) =&gt; p + (\n            p.length &amp;&amp; Quaternion.getCoefficient('',n.replace(/[kij]/, '')) &gt; 0 ? `+${n}` : `${n}`), ''\n        );\n    }</code></pre><p>while in <code>rust</code> implementation of formatting can be done by <code>fmt</code> function</p><pre><code class=\"language-rust\">impl fmt::Display for Quaternion {\n    fn fmt(&amp;self, f: &amp;mut fmt::Formatter&lt;'_&gt;) -&gt; fmt::Result {\n        let mut out: Vec&lt;String&gt; = vec![];\n        if self.i != 0f64 {\n            out.push(Quaternion::format_coefficient('i', self.i))\n        }\n        if self.j != 0f64 {\n            out.push(Quaternion::format_coefficient('j', self.j))\n        }\n        if self.k != 0f64 {\n            out.push(Quaternion::format_coefficient('k', self.k))\n        }\n        if self.r != 0f64 {\n            out.push(Quaternion::format_coefficient(' ', self.r))\n        }\n\n        let out = out.into_iter().reduce(\n            |p, n| format!(\n                \"{}{}\",\n                p.clone(),\n                if p.len() &gt; 0 &amp;&amp; Quaternion::get_coefficient(&amp;\"\", n.replace(\"i\", \"\").replace(\"j\", \"\").replace(\"k\", \"\")) &gt; 0f64 {\n                    format!(\"{}{}\", \"+\", n)\n                } else {\n                    n\n                }\n            )\n        );\n\n        write!(f, \"{}\", out.unwrap_or(String::from(\"0\")))\n    }\n}\n</code></pre><h3 id=\"final-e2e-tests\">Final e2e tests</h3><p>To check if all parts of programs match to each other we can prepare some <code>e2e</code> test cases in <code>node</code></p><pre><code class=\"language-typescript\">    it('e2e', () =&gt; {\n        const cases = [\n            {\n                in: '(i+j)(k)',\n                out: 'i-j'\n            },\n            {\n                in: '(i+j+20)(j-9)',\n                out: '-9i+11j+k-181'\n            },\n            {\n                in: '(10i)(10j-k+1)(-99i+j-10k+7)(4)',\n                out: '-520i-38920j+6800k+7920'\n            },\n            {\n                in: '(i+j+k+1)(i+2j+4k+8)(i+3j+9k+27)(i+j+8k+8)(i-j+k-10)(99i-j+k-1)(k)(j)(i)(3)',\n                out: '11415288i-8751432j-5206896k+9766704'\n            }\n        ]\n        for (const c of cases) {\n            const qs = Quaternion.parse(c.in);\n            const out = qs.reduce((p, n) =&gt; p.multiply(n)).format();\n            expect(out).toEqual(c.out);\n        }\n    })</code></pre><p>and analogically in <code>rust</code></p><pre><code class=\"language-rust\">#[test]\n    fn e2e() {\n        struct Case {\n            input: String,\n            output: String,\n        }\n\n        let cases: Vec&lt;Case&gt; = vec![\n            Case {\n                input: String::from(\"(i+j)(k)\"),\n                output: String::from(\"i-j\"),\n            },\n            Case {\n                input: String::from(\"(i+j+20)(j-9)\"),\n                output: String::from(\"-9i+11j+k-181\"),\n            },\n            Case {\n                input: String::from(\"(10i)(10j-k+1)(-99i+j-10k+7)(4)\"),\n                output: String::from(\"-520i-38920j+6800k+7920\"),\n            },\n            Case {\n                input: String::from(\"(i+j+k+1)(i+2j+4k+8)(i+3j+9k+27)(i+j+8k+8)(i-j+k-10)(99i-j+k-1)(k)(j)(i)(3)\"),\n                output: String::from(\"11415288i-8751432j-5206896k+9766704\"),\n            },\n        ];\n        for c in cases {\n            let qs = Quaternion::parse(&amp;c.input[..]);\n            let out = qs.into_iter().reduce(|p, n| p.multiply(n)).unwrap();\n            assert_eq!(format!(\"{}\", out), c.output);\n        }\n    }</code></pre><p>It is the end of this exercise. If you are interested in learning more about Quaternions multiplication and how it is connected with geometry I recommend you video:</p><figure class=\"kg-card kg-embed-card\"><iframe width=\"200\" height=\"113\" src=\"https://www.youtube.com/embed/d4EgbgTm0Bg?feature=oembed\" frameborder=\"0\" allow=\"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share\" allowfullscreen title=\"Visualizing quaternions (4d numbers) with stereographic projection\"></iframe></figure><p>As you can see <code>rust</code> and <code>typescript</code> have a lot of similar elements. All descriptions and logic elements are identical and only differences can be seen on level of syntax, that is more focused on elimination of undefined behaviors in rust. On the other hand in typescript code can be written in a little more concise way that can improve readability.</p>","comment_id":"63c9d7b4bbda300a2f29c85f","plaintext":"In this article we will see how to implement the multiplication of quaternions\nin Rust and NodeJS. I encourage you to try solve this problem before seeing\nsolutions. Below I attaching link to this exercise:\n\nCoding Games and Programming Challenges to Code BetterCodinGame is a\nchallenge-based training platform for programmers where you can play with the\nhottest programming topics. Solve games, code AI bots, learn from your peers,\nhave fun.CodinGame\n[https://www.codingame.com/training/medium/quaternion-multiplication]The\nquaternions belong to a number system that extends the complex numbers. A\nquaternion is defined by the sum of scalar multiples of the constants i,j,k and \n1.\nMore information is available at:\n\nQuaternion -- from Wolfram MathWorldThe quaternions are members of a\nnoncommutative division algebra first invented by William Rowan Hamilton. The\nidea for quaternions occurred to him while he was walking along the Royal Canal\non his way to a meeting of the Irish Academy, and Hamilton was so pleased with\nhis discovery that he scratche…from Wolfram MathWorld\n[https://mathworld.wolfram.com/Quaternion.html]Consider the following\nproperties:\njk = i\nki = j\nij = k\ni² = j² = k² = -1\n\nThese properties also imply that:\nkj = -i\nik = -j\nji = -k\n\nThe order of multiplication is important.\n\nYour program must output the result of the product of a number of bracketed\nsimplified quaternions.\n\nPay attention to the formatting\nThe coefficient is appended to the left of the constant.\nIf a coefficient is 1 or -1, don't include the 1 symbol.\nIf a coefficient or scalar term is 0, don't include it.\nThe terms must be displayed in order: ai + bj + ck + d.\n\nExample Multiplication\n(2i+2j)(j+1) = (2ij+2i+2j² +2j) = (2k+2i-2+2j) = (2i+2j+2k-2)\n\n\n--------------------------------------------------------------------------------\n\nInput:\n\nLine 1: The expression expr to evaluate. This will always be the product of\nsimplified bracketed expressions.\n\nOutput: A single line containing the simplified result of the product\nexpression. No brackets are required.\n\nConstraints: All coefficients in any part of evaluation will be less than 10^9\nThe input contains no more than 10 simplified bracketed expressions\n\nExample\n\nInput\n\n(i+j)(k)\n\nOutput\n\ni-j\n\nSolution\nI decided to present only most important parts here. Full solution can be found\nin repository:\n\nGitHub - gustawdaniel/codingame-quaternion-multiplicationContribute to\ngustawdaniel/codingame-quaternion-multiplication development by creating an\naccount on GitHub.GitHubgustawdaniel\n[https://github.com/gustawdaniel/codingame-quaternion-multiplication]We can\ndivide our problem to three steps:\n\n * parsing input to Quaternion structure\n * multiplication of Quaternions\n * formatting Quaternion again to string\n\nThese high-level operations can be implemented in NodeJS\n\nimport {Quaternion} from \"./lib\";\n\nprocess.stdin.on('data', (buff) => {\n    const line = buff.toString();\n    const qs = Quaternion.parse(line);\n    process.stdout.write(qs.reduce((p, n) => p.multiply(n)).format());\n})\n\nand in Rust\n\nfn main() {\n    let mut input_line = String::new();\n    io::stdin().read_line(&mut input_line).unwrap();\n    let expr = input_line.trim_matches('\\n').to_string();\n\n    let qs = Quaternion::parse(&expr);\n    let out = qs.into_iter().reduce(|p, n| p.multiply(n)).unwrap();\n    println!(\"{}\", out);\n}\n\nYou can see that this code is really similar but in both cases we have to\nimplement Struct/Class named Quaternion. Now we will go through three steps\nmentioned before using TDD. Tests are natively supported in rust, but in NodeJS \nI decided to use jest as testing framework.\n\nParsing input to Quaternion structure\nOur input\n\n(i+j)(k)\n\nshould be treated as array of quaternions - separated by brackets. In any\nbrackets we have array of coefficients. So we can divide our parsing to 4 parts:\n\n * spliting by brackets\n * splitings any bracket to coefficients\n * creating Quaternions from arrays of coefficients \n * extracing number from coefficient\n\nIn NodeJS we can start from two tests. First for simple cases:\n\n    it('simple parse', () => {\n        const qs = Quaternion.parse('(i+j)');\n        expect(qs.length).toEqual(1);\n        expect(qs[0].r).toEqual(0);\n        expect(qs[0].i).toEqual(1);\n        expect(qs[0].j).toEqual(1);\n        expect(qs[0].k).toEqual(0);\n    });\n\nSecond for more advanced coefficients:\n\n    it('complex parse', () => {\n        const qs = Quaternion.parse('(9+i-j)(k-8.4j)');\n        expect(qs.length).toEqual(2);\n        expect(qs[0].r).toEqual(9);\n        expect(qs[0].i).toEqual(1);\n        expect(qs[0].j).toEqual(-1);\n        expect(qs[0].k).toEqual(0);\n\n        expect(qs[1].r).toEqual(0);\n        expect(qs[1].i).toEqual(0);\n        expect(qs[1].j).toEqual(-8.4);\n        expect(qs[1].k).toEqual(1);\n    });\n\nThe same tests in rust can be written as\n\n#[cfg(test)]\nmod tests {\n    use crate::{Quaternion};\n\n\n    #[test]\n    fn simple_parse() {\n        let qs = Quaternion::parse(\"(i+j)\");\n        assert_eq!(qs.len(), 1);\n        assert_eq!(qs[0].r, 0f64);\n        assert_eq!(qs[0].i, 1f64);\n        assert_eq!(qs[0].j, 1f64);\n        assert_eq!(qs[0].k, 0f64);\n    }\n\n    #[test]\n    fn complex_parse() {\n        let qs = Quaternion::parse(\"(9+i-j)(k-8.4j)\");\n        assert_eq!(qs.len(), 2);\n        assert_eq!(qs[0].r, 9f64);\n        assert_eq!(qs[0].i, 1f64);\n        assert_eq!(qs[0].j, -1f64);\n        assert_eq!(qs[0].k, 0f64);\n\n        assert_eq!(qs[1].r, 0f64);\n        assert_eq!(qs[1].i, 0f64);\n        assert_eq!(qs[1].j, -8.4f64);\n        assert_eq!(qs[1].k, 1f64);\n    }\n}\n\nOur base Quaternion class will have 4 properties. In NodeJS:\n\nexport class Quaternion {\n    r: number = 0;\n    i: number = 0;\n    j: number = 0;\n    k: number = 0;\n}\n\nwhere r means real part that inherits arithmetic from real numbers. In rust we\nare using struct keyword instead of class\n\n#[derive(Debug)]\nstruct Quaternion {\n    r: f64,\n    i: f64,\n    j: f64,\n    k: f64,\n}\n\nSplitting string using regular expressions\nTo split input and provide arrays of coefficients to Quaternion constructors we\ncan write methods in NodeJS:\n\n    static parse(input: string): Quaternion[] {\n        const qs = (input.match(/\\(.*?\\)/g) ?? []).map(\n            (e: string) => (e\n                    .replace('(', '')\n                    .replace(')', '')\n                    .match(/[-+]?[\\d.]*[ijk]?/g) ?? []\n            ).filter(v => v).map(\n                v => v.replace(/^\\+/, '')\n            )\n        );\n        return qs.map((q) => new Quaternion(q));\n    }\n\n\nand Rust\n\nimpl Quaternion {\n    fn parse(input: &str) -> Vec<Quaternion> {\n        let re = Regex::new(r\"\\((.*?)\\)\").expect(\"can't create regex\");\n\n        let qs = re.captures_iter(input).filter_map(|cap| Some(cap.get(1)?.as_str()))\n            .map(|m| m.to_string()).collect::<Vec<_>>();\n\n        let re = Regex::new(r\"\\+?(-?[\\d.]*[ijk]?)\").expect(\"can't create regex\");\n\n        let res = qs.iter().map(|q| {\n            let args = re.captures_iter(&q).filter_map(|cap| Some(cap.get(1)?.as_str()))\n                .map(|m| m.to_string()).collect::<Vec<_>>();\n            Quaternion::new(args)\n        });\n\n        res.collect::<Vec<_>>()\n    }\n}\n\nGenerally there are the same regex expressions but rust requires here external\nlibrary called regex. Additionally rust checks correctness of regex expressions\nand ensure handling errors in them, that can be skipped by default in node js \ncode. Generally I feel that node js approach to regex is more clean and\nreadable.\n\nNow we have the following problem. Our coefficients can contains numbers,\nnumbers with names of component like: i, j or k, or even lonely letters like i \nwhat means 1i. There are also possible signs like -k.\n\nWe need code that will extract numbers from them. Lets name i, j or k as type \nand full coefficient string as input. Then extracting number can be considered\nas:\n\n * removing type from input\n * if rest not end with digit then add 1 on the end ( example is - )\n * finally parse it as float\n\nImplementation in node js\n\n    static getCoefficient(type: string, input: string): number {\n        const coefficient = input.replace(type, '');\n        return Number.parseFloat(/\\d$/.test(coefficient) ? coefficient : coefficient + '1')\n    }\n\nand analogical in rust\n\n    fn get_coefficient(t: &str, input: String) -> f64 {\n        let c = input.replace(t, \"\");\n        if Regex::new(r\"\\d$\").expect(\"ff\").is_match(&c) {\n            c.parse::<f64>().unwrap()\n        } else {\n            (c + \"1\").parse::<f64>().unwrap()\n        }\n    }\n\nIn rust generally handling conversions between types require more characters but\nis more reliable. In this case writing unwrap we are enforced to think about\npossible ways of handle problems with parsing.\n\nNow we can present constructors. In them we will pass array of strings with\ncoefficients like 8, -9k, or i. In node js:\n\n    constructor(args: Array<string>) {\n        for (let arg of args) {\n            if (arg.includes('i')) {\n                this.i = Quaternion.getCoefficient('i', arg);\n            } else if (arg.includes('j')) {\n                this.j = Quaternion.getCoefficient('j', arg);\n            } else if (arg.includes('k')) {\n                this.k = Quaternion.getCoefficient('k', arg);\n            } else {\n                this.r = Number.parseFloat(arg);\n            }\n        }\n    }\n\nor in rust:\n\n    fn new(args: Vec<String>) -> Quaternion {\n        let mut q = Quaternion {\n            i: 0f64,\n            j: 0f64,\n            k: 0f64,\n            r: 0f64,\n        };\n\n        for arg in args {\n            if arg.contains(\"i\") {\n                q.i = Quaternion::get_coefficient(\"i\", arg)\n            } else if arg.contains(\"j\") {\n                q.j = Quaternion::get_coefficient(\"j\", arg)\n            } else if arg.contains(\"k\") {\n                q.k = Quaternion::get_coefficient(\"k\", arg)\n            } else {\n                q.r = arg.parse::<f64>().unwrap()\n            }\n        }\n\n        q\n    }\n\nMultiplication of Quaternions\nMultiplication of two quaternions is similar to multiplication of polynomials.\nFirstly we muliply any components pairs each other. Then we can group them by\ncomponent type and finally add coefficients. Difference is that in polynomial\nmultiplication we always adding powers, but in Quaternions we using\nnoncommutative division algebra presented on table:\n\nSo basically we can divide our problem to:\n\n * multiplication of base elements\n * multiplication of linear combinations of base elements\n\nMultiplication of base elements\nI rewrote all possible cases in test file in NodeJS\n\n    it('multiply base', () => {\n        expect(Quaternion.multiplyBase('r', 'r')).toEqual({c: 1, d: 'r'});\n        expect(Quaternion.multiplyBase('r', 'i')).toEqual({c: 1, d: 'i'});\n        expect(Quaternion.multiplyBase('r', 'j')).toEqual({c: 1, d: 'j'});\n        expect(Quaternion.multiplyBase('r', 'k')).toEqual({c: 1, d: 'k'});\n\n        expect(Quaternion.multiplyBase('i', 'r')).toEqual({c: 1, d: 'i'});\n        expect(Quaternion.multiplyBase('i', 'i')).toEqual({c: -1, d: 'r'});\n        expect(Quaternion.multiplyBase('i', 'j')).toEqual({c: 1, d: 'k'});\n        expect(Quaternion.multiplyBase('i', 'k')).toEqual({c: -1, d: 'j'});\n\n        expect(Quaternion.multiplyBase('j', 'r')).toEqual({c: 1, d: 'j'});\n        expect(Quaternion.multiplyBase('j', 'i')).toEqual({c: -1, d: 'k'});\n        expect(Quaternion.multiplyBase('j', 'j')).toEqual({c: -1, d: 'r'});\n        expect(Quaternion.multiplyBase('j', 'k')).toEqual({c: 1, d: 'i'});\n\n        expect(Quaternion.multiplyBase('k', 'r')).toEqual({c: 1, d: 'k'});\n        expect(Quaternion.multiplyBase('k', 'i')).toEqual({c: 1, d: 'j'});\n        expect(Quaternion.multiplyBase('k', 'j')).toEqual({c: -1, d: 'i'});\n        expect(Quaternion.multiplyBase('k', 'k')).toEqual({c: -1, d: 'r'});\n    })\n\nand Rust\n\n    #[test]\n    fn multiply_base() {\n        assert_eq!(Quaternion::multiply_base('r', 'r'), SignedCoefficient { c: 1f64, d: 'r' });\n        assert_eq!(Quaternion::multiply_base('r', 'i'), SignedCoefficient { c: 1f64, d: 'i' });\n        assert_eq!(Quaternion::multiply_base('r', 'j'), SignedCoefficient { c: 1f64, d: 'j' });\n        assert_eq!(Quaternion::multiply_base('r', 'k'), SignedCoefficient { c: 1f64, d: 'k' });\n\n        assert_eq!(Quaternion::multiply_base('i', 'r'), SignedCoefficient { c: 1f64, d: 'i' });\n        assert_eq!(Quaternion::multiply_base('i', 'i'), SignedCoefficient { c: -1f64, d: 'r' });\n        assert_eq!(Quaternion::multiply_base('i', 'j'), SignedCoefficient { c: 1f64, d: 'k' });\n        assert_eq!(Quaternion::multiply_base('i', 'k'), SignedCoefficient { c: -1f64, d: 'j' });\n\n        assert_eq!(Quaternion::multiply_base('j', 'r'), SignedCoefficient { c: 1f64, d: 'j' });\n        assert_eq!(Quaternion::multiply_base('j', 'i'), SignedCoefficient { c: -1f64, d: 'k' });\n        assert_eq!(Quaternion::multiply_base('j', 'j'), SignedCoefficient { c: -1f64, d: 'r' });\n        assert_eq!(Quaternion::multiply_base('j', 'k'), SignedCoefficient { c: 1f64, d: 'i' });\n\n        assert_eq!(Quaternion::multiply_base('k', 'r'), SignedCoefficient { c: 1f64, d: 'k' });\n        assert_eq!(Quaternion::multiply_base('k', 'i'), SignedCoefficient { c: 1f64, d: 'j' });\n        assert_eq!(Quaternion::multiply_base('k', 'j'), SignedCoefficient { c: -1f64, d: 'i' });\n        assert_eq!(Quaternion::multiply_base('k', 'k'), SignedCoefficient { c: -1f64, d: 'r' });\n    }\n\nIn Rust I have to define SignedCoefficient that was simple anonymous objects in \nnode\n\n#[derive(Debug)]\nstruct SignedCoefficient {\n    c: f64,\n    d: char,\n}\n\nadditionally I have to implement equation relation on them to use assert_eq.\n\nimpl PartialEq<SignedCoefficient> for SignedCoefficient {\n    fn eq(&self, other: &SignedCoefficient) -> bool {\n        self.c == other.c && self.d == other.d\n    }\n}\n\nFunction multiplyBase is super simple and to build it we have to see that:\n\n * multiplication by 1 is always the other element. a * 1 = a and 1 * a = a\n * excluding 1 we always have a * a = -1\n * excluding 1 and diagonal we always receive coefficient different that these\n   used to multiply, sign can be determined using %2 operation and direction of\n   multiplication.\n\nUsing these observations we can define multiplication in node as\n\n    static multiplyBase(a: Base, b: Base): { c: -1 | 1, d: Base } {\n        if (a === 'r') return {c: 1, d: b};\n        if (b === 'r') return {c: 1, d: a};\n        if (a === b) return {c: -1, d: 'r'};\n        const diff = a.charCodeAt(0) - b.charCodeAt(0);\n        return {\n            c: (diff > 0 ? -1 : 1) * ((diff + 2) % 2 === 0 ? -1 : 1) as -1 | 1,\n            d: ['i', 'j', 'k'].find((e) => e !== a && e !== b) as Base\n        }\n    }\n\nand in rust\n\n    fn multiply_base(a: char, b: char) -> SignedCoefficient {\n        if a == 'r' { return SignedCoefficient { c: 1f64, d: b }; }\n        if b == 'r' { return SignedCoefficient { c: 1f64, d: a }; }\n        if a == b { return SignedCoefficient { c: -1f64, d: 'r' }; }\n        let diff = u32::from(a) as i32 - u32::from(b) as i32;\n\n        SignedCoefficient {\n            c: (if diff > 0 { -1f64 } else { 1f64 }) * (if (diff + 2i32) % 2 == 0 { -1f64 } else { 1f64 }),\n            d: vec!['i', 'j', 'k'].iter().find(|&&e| e != a && e != b).unwrap().to_owned(),\n        }\n    }\n\nMultiplication of linear combinations\nI divided multiplication tests to simple and complex cases\n\n    it('simple multiply', () => {\n        const res = (new Quaternion(['1']))\n            .multiply(new Quaternion(['1']))\n\n        expect(res.r).toEqual(1);\n        expect(res.i).toEqual(0);\n        expect(res.j).toEqual(0);\n        expect(res.k).toEqual(0);\n    })\n\n    it('complex multiply', () => {\n        const res = (new Quaternion(['2i', '2j']))\n            .multiply(new Quaternion(['j', '1']))\n\n        expect(res.r).toEqual(-2);\n        expect(res.i).toEqual(2);\n        expect(res.j).toEqual(2);\n        expect(res.k).toEqual(2);\n    })\n\nand\n\n    #[test]\n    fn simple_multiply() {\n        let res = Quaternion::new(vec![String::from(\"1\")])\n            .multiply(Quaternion::new(vec![String::from(\"1\")]));\n\n        assert_eq!(res, Quaternion {\n            r: 1f64,\n            i: 0f64,\n            j: 0f64,\n            k: 0f64,\n        })\n    }\n\n    #[test]\n    fn complex_multiply() {\n        let res = Quaternion::new(vec![String::from(\"2i\"), String::from(\"2j\")])\n            .multiply(Quaternion::new(vec![String::from(\"j\"), String::from(\"1\")]));\n\n        assert_eq!(res, Quaternion {\n            r: -2f64,\n            i: 2f64,\n            j: 2f64,\n            k: 2f64,\n        })\n    }\n\nhere to compare Quaternions we have to implement PartialEq\n\nimpl PartialEq<Quaternion> for Quaternion {\n    fn eq(&self, other: &Quaternion) -> bool {\n        self.r == other.r && self.i == other.i && self.j == other.j && self.k == other.k\n    }\n}\n\n\nIn NodeJS is can be reduced to nested loop like this\n\n    multiply(a: Quaternion): Quaternion {\n        const res = new Quaternion([]);\n        for (let p of ['r', 'i', 'j', 'k'] as Array<Base>) {\n            for (let n of ['r', 'i', 'j', 'k'] as Array<Base>) {\n                const {c, d} = Quaternion.multiplyBase(p, n);\n                res[d] += c * this[p] * a[n];\n            }\n        }\n        return res;\n    }\n\nc is sign, d is name of coefficient. \n\nIn Rust we cant have access to dynamic properties that are chars so we have to\nadd two auxiliary methods to get and set values using chars\n\n    fn get(&self, key: char) -> f64 {\n        match key {\n            'r' => self.r,\n            'i' => self.i,\n            'j' => self.j,\n            'k' => self.k,\n            _ => 0f64\n        }\n    }\n\n    fn set(&mut self, key: char, value: f64) -> &Quaternion {\n        match key {\n            'r' => self.r = value,\n            'i' => self.i = value,\n            'j' => self.j = value,\n            'k' => self.k = value,\n            _ => ()\n        }\n\n        self\n    }\n\n    fn multiply(&self, a: Quaternion) -> Quaternion {\n        let mut res = Quaternion::new(vec![]);\n        for p in vec!['r', 'i', 'j', 'k'] {\n            for n in vec!['r', 'i', 'j', 'k'] {\n                let SignedCoefficient { c, d } = Quaternion::multiply_base(p, n);\n                res.set(d, res.get(d) + c * self.get(p) * a.get(n));\n            }\n        }\n        res\n    }\n\nbut generally idea is the same.\n\nNow we have program that can read input, convert it to array of Quaternions and\nmultiply them.\n\nLast lacking element is formatting result as string.\n\nFormatting Quaternion to strings\nFormatting results can be considered as:\n\n * formatting any single coefficient using special treatments for 1\n * building ordered array of coefficients that is joined as sting\n\nThese operations are inversion of parsing presented in first part. Lest start\nfrom tests in node js\n\n    it('format coefficient', () => {\n       expect(Quaternion.formatCoefficient('i', 20)).toEqual('20i');\n       expect(Quaternion.formatCoefficient('i', 1)).toEqual('i');\n       expect(Quaternion.formatCoefficient('', 0)).toEqual('0');\n    });\n\n    it('format', () => {\n        expect((new Quaternion([]).format())).toEqual('0');\n        expect((new Quaternion(['1']).format())).toEqual('1');\n        expect((new Quaternion(['i', '1']).format())).toEqual('i+1');\n        expect((new Quaternion(['i', '-3.4j', '1']).format())).toEqual('i-3.4j+1');\n        expect((new Quaternion(['j', 'k']).format())).toEqual('j+k');\n\n    })\n\nAnalogical tests in rust\n\n    #[test]\n    fn format_coefficient() {\n        assert_eq!(Quaternion::format_coefficient('i', 20f64), String::from(\"20i\"));\n        assert_eq!(Quaternion::format_coefficient('i', 1f64), String::from(\"i\"));\n        assert_eq!(Quaternion::format_coefficient(' ', 0f64), String::from(\"0\"));\n    }\n\n    #[test]\n    fn format() {\n        assert_eq!(format!(\"{}\", Quaternion::new(vec![])), String::from(\"0\"));\n        assert_eq!(format!(\"{}\", Quaternion::new(vec![String::from(\"1\")])), String::from(\"1\"));\n        assert_eq!(format!(\"{}\", Quaternion::new(vec![String::from(\"i\"), String::from(\"1\")])), String::from(\"i+1\"));\n        assert_eq!(format!(\"{}\", Quaternion::new(vec![String::from(\"i\"), String::from(\"-3.4j\"), String::from(\"1\")])), String::from(\"i-3.4j+1\"));\n        assert_eq!(format!(\"{}\", Quaternion::new(vec![String::from(\"j\"), String::from(\"k\")])), String::from(\"j+k\"));\n    }\n\nIn function formatCoefficient we carry about cases like 1, - and deciding if\ncomponent name like i, j or k should be added to result.\n\n    static formatCoefficient(type: Base | '', value: number) {\n        const out = `${Math.abs(value) === 1 ? (\n            Math.sign(value) === 1 ? '' : '-'\n        ) : value}${type}`;\n        return /[\\dijk]$/.test(out) ? out : `${out}1`;\n    }\n\nand\n\n    fn format_coefficient(t: char, value: f64) -> String {\n        let out = if f64::abs(value) == 1f64 {\n            if f64::signum(value) == 1f64 {\n                String::from(\"\") + &t.to_string()[..].trim()\n            } else {\n                String::from(\"-\") + &t.to_string()[..].trim()\n            }\n        } else {\n            format!(\"{}\", value) + &t.to_string()[..].trim()\n        };\n\n        match Regex::new(r\"[\\dijk]$\").unwrap().captures(&out[..]) {\n            Some(_) => out,\n            None => out + \"1\"\n        }\n    }\n}\n\nIn function format we collecting these components and decide about joining. We\ncan't join by + because of some elements starts from -. But we have to handle\ncase of 0. Finally in NodeJS we have:\n\n    format(): string {\n        let out = [];\n        if (this.i) {\n            out.push(Quaternion.formatCoefficient('i', this.i));\n        }\n        if (this.j) {\n            out.push(Quaternion.formatCoefficient('j', this.j));\n        }\n        if (this.k) {\n            out.push(Quaternion.formatCoefficient('k', this.k));\n        }\n        if (this.r) {\n            out.push(Quaternion.formatCoefficient('', this.r));\n        }\n\n        if (!out.length) return '0';\n\n        return out.reduce((p, n) => p + (\n            p.length && Quaternion.getCoefficient('',n.replace(/[kij]/, '')) > 0 ? `+${n}` : `${n}`), ''\n        );\n    }\n\nwhile in rust implementation of formatting can be done by fmt function\n\nimpl fmt::Display for Quaternion {\n    fn fmt(&self, f: &mut fmt::Formatter<'_>) -> fmt::Result {\n        let mut out: Vec<String> = vec![];\n        if self.i != 0f64 {\n            out.push(Quaternion::format_coefficient('i', self.i))\n        }\n        if self.j != 0f64 {\n            out.push(Quaternion::format_coefficient('j', self.j))\n        }\n        if self.k != 0f64 {\n            out.push(Quaternion::format_coefficient('k', self.k))\n        }\n        if self.r != 0f64 {\n            out.push(Quaternion::format_coefficient(' ', self.r))\n        }\n\n        let out = out.into_iter().reduce(\n            |p, n| format!(\n                \"{}{}\",\n                p.clone(),\n                if p.len() > 0 && Quaternion::get_coefficient(&\"\", n.replace(\"i\", \"\").replace(\"j\", \"\").replace(\"k\", \"\")) > 0f64 {\n                    format!(\"{}{}\", \"+\", n)\n                } else {\n                    n\n                }\n            )\n        );\n\n        write!(f, \"{}\", out.unwrap_or(String::from(\"0\")))\n    }\n}\n\n\nFinal e2e tests\nTo check if all parts of programs match to each other we can prepare some e2e \ntest cases in node\n\n    it('e2e', () => {\n        const cases = [\n            {\n                in: '(i+j)(k)',\n                out: 'i-j'\n            },\n            {\n                in: '(i+j+20)(j-9)',\n                out: '-9i+11j+k-181'\n            },\n            {\n                in: '(10i)(10j-k+1)(-99i+j-10k+7)(4)',\n                out: '-520i-38920j+6800k+7920'\n            },\n            {\n                in: '(i+j+k+1)(i+2j+4k+8)(i+3j+9k+27)(i+j+8k+8)(i-j+k-10)(99i-j+k-1)(k)(j)(i)(3)',\n                out: '11415288i-8751432j-5206896k+9766704'\n            }\n        ]\n        for (const c of cases) {\n            const qs = Quaternion.parse(c.in);\n            const out = qs.reduce((p, n) => p.multiply(n)).format();\n            expect(out).toEqual(c.out);\n        }\n    })\n\nand analogically in rust\n\n#[test]\n    fn e2e() {\n        struct Case {\n            input: String,\n            output: String,\n        }\n\n        let cases: Vec<Case> = vec![\n            Case {\n                input: String::from(\"(i+j)(k)\"),\n                output: String::from(\"i-j\"),\n            },\n            Case {\n                input: String::from(\"(i+j+20)(j-9)\"),\n                output: String::from(\"-9i+11j+k-181\"),\n            },\n            Case {\n                input: String::from(\"(10i)(10j-k+1)(-99i+j-10k+7)(4)\"),\n                output: String::from(\"-520i-38920j+6800k+7920\"),\n            },\n            Case {\n                input: String::from(\"(i+j+k+1)(i+2j+4k+8)(i+3j+9k+27)(i+j+8k+8)(i-j+k-10)(99i-j+k-1)(k)(j)(i)(3)\"),\n                output: String::from(\"11415288i-8751432j-5206896k+9766704\"),\n            },\n        ];\n        for c in cases {\n            let qs = Quaternion::parse(&c.input[..]);\n            let out = qs.into_iter().reduce(|p, n| p.multiply(n)).unwrap();\n            assert_eq!(format!(\"{}\", out), c.output);\n        }\n    }\n\nIt is the end of this exercise. If you are interested in learning more about\nQuaternions multiplication and how it is connected with geometry I recommend you\nvideo:\n\nAs you can see rust and typescript have a lot of similar elements. All\ndescriptions and logic elements are identical and only differences can be seen\non level of syntax, that is more focused on elimination of undefined behaviors\nin rust. On the other hand in typescript code can be written in a little more\nconcise way that can improve readability.","feature_image":"__GHOST_URL__/content/images/2023/01/8-fQUrNOmQldF0U1F.png","featured":0,"type":"post","status":"published","locale":null,"visibility":"public","email_recipient_filter":"all","created_at":"2023-01-19T23:52:20.000Z","updated_at":"2023-01-20T02:19:57.000Z","published_at":"2023-01-20T02:19:57.000Z","custom_excerpt":"In this article, we will see how to implement the multiplication of quaternions in Rust and NodeJS. You will learn about parsing and algebra.","codeinjection_head":null,"codeinjection_foot":null,"custom_template":null,"canonical_url":null,"newsletter_id":null,"lexical":null},{"id":"63cbdf03bbda300a2f29ca63","uuid":"cec01818-d004-4b9d-8ae2-f06e84096742","title":"How I used GPT-3 to solve my issues with OBS and Davinci Resolve problems with MKV format","slug":"how-i-used-gpt-3-to-solve-my-issues-with-obs-and-davinci-resolve-problems-with-mkv-format","mobiledoc":"{\"version\":\"0.3.1\",\"atoms\":[],\"cards\":[[\"bookmark\",{\"type\":\"bookmark\",\"url\":\"https://www.easefab.com/mkv-tips/import-mkv-to-davinci-resolve.html\",\"metadata\":{\"url\":\"https://www.easefab.com/mkv-tips/import-mkv-to-davinci-resolve.html\",\"title\":\"Transcode and Import MKV to DaVinci Resolve\",\"description\":\"Failed to import MKV files to DaVinci Resolve 10/11/12/13/14/15/16 for further editing? Don’t worry! An easy way is to transcode MKV to DaVinci Resolve compatible video formats. Below is the how to.\",\"author\":\"MKV Tips\",\"publisher\":\"EaseFab - Best DVD/Blu-ray Ripper/Copy Software, Video Converter and iPhone Data Recovery Software Provider | OFFICIAL\",\"thumbnail\":\"https://www.easefab.com/images/icon_download.png\",\"icon\":\"https://www.easefab.com/favicon.ico\"}}],[\"code\",{\"code\":\"davinci resolve alternatives\"}],[\"image\",{\"src\":\"__GHOST_URL__/content/images/2023/01/Zrzut-ekranu-z-2023-01-21-14-01-42.png\",\"width\":1774,\"height\":1165}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"code\",{\"code\":\"#!/bin/bash\\n\\n# Add Lightworks repository\\nsudo dnf config-manager --add-repo https://lwks.com/rpm/lwks-repo.fedora.repo\\n\\n# Add Shotcut repository\\nsudo dnf config-manager --add-repo https://dl.fedoraproject.org/pub/fedora/linux/updates/32/Everything/x86_64/Packages/s/shotcut-20.12.31-1.fc32.x86_64.rpm\\n\\n# Add OpenShot repository\\nsudo dnf config-manager --add-repo https://openshot.org/download/openshot.repo\\n\\n# Update package list\\nsudo dnf update\\n\\n# Install Lightworks\\nsudo dnf install lightworks\\n\\n# Install Shotcut\\nsudo dnf install shotcut\\n\\n# Install OpenShot\\nsudo dnf install openshot-qt\",\"language\":\"bash\"}],[\"hr\",{}],[\"code\",{\"code\":\"#!/bin/bash\\n\\n# Add Lightworks repository\\nsudo dnf config-manager --add-repo https://lwks.com/rpm/lwks-repo.fedora.repo\\n\\n# Add Shotcut repository\\nsudo dnf config-manager --add-repo https://dl.fedoraproject.org/pub/fedora/linux/updates/32/Everything/x86_64/Packages/s/shotcut-20.12.31-1.fc32.x86_64.rpm\\n\\n# Add OpenShot repository\\nsudo dnf config-manager --add-repo https://openshot.org/download/openshot.repo\\n\\n# Update package list\\nsudo dnf update -y\\n\\n# Install Lightworks\\nsudo dnf install lightworks -y\\n\\n# Install Shotcut\\nsudo dnf install shotcut -y\\n\\n# Install OpenShot\\nsudo dnf install openshot-qt -y\",\"language\":\"bash\"}],[\"code\",{\"code\":\"cat /etc/fedora-release\"}],[\"code\",{\"code\":\"#!/bin/bash\\n\\n# Add Lightworks repository\\nsudo dnf config-manager --add-repo https://lwks.com/rpm/lwks-repo.fedora.repo\\n\\n# Add Shotcut repository\\nsudo dnf config-manager --add-repo https://dl.fedoraproject.org/pub/fedora/linux/updates/36/Everything/x86_64/Packages/s/shotcut-20.12.31-1.fc36.x86_64.rpm\\n\\n# Add OpenShot repository\\nsudo dnf config-manager --add-repo https://openshot.org/download/openshot.repo\\n\\n# Update package list\\nsudo dnf update -y\\n\\n# Install Lightworks\\nsudo dnf install lightworks -y\\n\\n# Install Shotcut\\nsudo dnf install shotcut -y\\n\\n# Install OpenShot\\nsudo dnf install openshot-qt -y\"}],[\"code\",{\"code\":\"sudo snap install shotcut --classic\"}]],\"markups\":[[\"code\"],[\"strong\"],[\"a\",[\"href\",\"http://www.lwks.com/\"]],[\"a\",[\"href\",\"http://www.openshot.org/\"]],[\"a\",[\"href\",\"http://www.pitivi.org/\"]]],\"sections\":[[1,\"p\",[[0,[],0,\"I see value in creation content that in affordable and helpful for other people. From this reason I switched from Polish language to English and now considering move from text content to video.\"]]],[1,\"p\",[[0,[],0,\"I did research in topics of software to screen-cast and edit videos. Best options that I found were:\"]]],[3,\"ul\",[[[0,[],0,\"OBS - for screen and camera recording\"]],[[0,[],0,\"Davinci Resolve - for editing\"]]]],[1,\"p\",[[0,[],0,\"Unfortunately my screen-casting program OBS produce \"],[0,[0],1,\"mkv\"],[0,[],0,\" format, that is too complicated for Davinci Resolve. Exact reason:\"]]],[1,\"blockquote\",[[0,[],0,\"One of the greatest things about MKV as a format is the sheer amount of stuff it can contain - you can have multiple subtitles in there, multiple audio tracks and even multiple video tracks. But that's just a bloody nightmare to try to handle in editing software.\"]]],[1,\"p\",[[0,[],0,\"is explained here:\"]]],[10,0],[1,\"p\",[[0,[],0,\"I was trying to change settings of \"],[0,[0],1,\"OBS\"],[0,[],0,\" to produce formats supported by \"],[0,[0],1,\"Davinci Resolve\"],[0,[],0,\" but without success. I was trying to convert \"],[0,[0],1,\"MKV\"],[0,[],0,\" to different formats and then import them, but this also failed. Additionally Davinci Resolve 100% load on 2 CPU cores on my computer, even in iddle state so finally I decided to find replacement for it.\"]]],[1,\"h2\",[[0,[],0,\"Why using google failed\"]]],[1,\"p\",[[0,[],0,\"I started as usual from typing\"]]],[10,1],[1,\"p\",[[0,[],0,\"to google and seen this:\"]]],[10,2],[1,\"p\",[[0,[],0,\"from my previous research I remembered that for many people these programs can satisfy criteria, but i wanted:\"]]],[3,\"ul\",[[[0,[],0,\"free software\"]],[[0,[],0,\"programs working on linux\"]]]],[1,\"p\",[[0,[],0,\"I know that in case of \"],[0,[1,0],1,\"Adobe Premiere Pro\"],[0,[],1,\" \"],[0,[],0,\"it is both paid and does not support linux. It is easy to check that further programs also have paid versions or trial and I can expect only part of them works on linux.\"]]],[1,\"p\",[[0,[],0,\"Google is great tool but these results are not personalized. It build average ranking of pages. On these pages authors build average ranking of programs. For any of these programs I have to build my own ranking reading about them, but it takes time, so cost of research like this can be huge.\"]]],[1,\"h2\",[[0,[],0,\"In this moment magic with GPT-3 started\"]]],[1,\"p\",[[0,[],0,\"I remembered how GPT-3 helped me pick queue system worth to learn and decide to use them as searching engine with filters defined by natural language.\"]]],[1,\"p\",[[0,[],0,\"My firs question was:\"]]],[1,\"blockquote\",[[0,[],0,\"software similar to davinci resolve that is free and works on linux\"]]],[1,\"p\",[[0,[],0,\"GPT answered:\"]]],[1,\"p\",[[0,[],0,\"Some free, open-source video editing software that works on Linux include:\"]]],[3,\"ul\",[[[0,[],0,\"Blender (blender.org)\"]],[[0,[],0,\"Lightworks (\"],[0,[2],1,\"www.lwks.com\"],[0,[],0,\")\"]],[[0,[],0,\"Shotcut (shotcut.org)\"]],[[0,[],0,\"OpenShot (\"],[0,[3],1,\"www.openshot.org\"],[0,[],0,\")\"]],[[0,[],0,\"Pitivi (\"],[0,[4],1,\"www.pitivi.org\"],[0,[],0,\")\"]]]],[1,\"p\",[[0,[],0,\"Please note that some of them may have different capabilities and workflows compared to DaVinci Resolve. It's recommended to check their features and compatibility with your system before installing.\"]]],[10,3],[1,\"p\",[[0,[],0,\"This list looks nice, but I rememer that \"],[0,[0],1,\"Blender\"],[0,[],0,\" was good for \"],[0,[0],1,\"3D\"],[0,[],0,\" and animations, physics. Every tutorial of blender starts from drawing sphere and lighting them from differens sides and finish on building tower and destroying them by spherical bullets.\"]]],[1,\"p\",[[0,[],0,\"So I described to GPT-3 what exactly content I want to produce.\"]]],[1,\"blockquote\",[[0,[],0,\"i am going to edit video with my screencast, please describe programs mentioned in previous answer in this context and select best one \"]]],[1,\"p\",[[0,[],0,\"Now answer was more comprehensive:\"]]],[1,\"p\",[[0,[],0,\"All of the programs I mentioned previously are capable of editing video, including screencasts. However, some may be more suitable for your specific needs than others. Here is a brief overview of each program and how they might be useful for editing screencasts:\"]]],[3,\"ul\",[[[0,[],0,\"Blender: Blender is a powerful 3D animation and modeling program, but it also has a built-in video editor that can handle screencasts. It is a versatile and customizable tool that can handle multiple video and audio tracks, effects, and compositing. However, it has a steeper learning curve than other options, which may make it more challenging for beginners.\"]],[[0,[],0,\"Lightworks: Lightworks is a professional-grade video editing software, it is a cross-platform software and it has a free version that can be used to edit screencasts. It has advanced video and audio editing tools, effects, and support for multiple video and audio tracks. It is designed for experienced video editors and may not be as user-friendly for beginners.\"]],[[0,[],0,\"Shotcut: Shotcut is a free, open-source video editor that works on Linux. It has a simple and intuitive interface that is easy to use. It can handle multiple video and audio tracks, effects, and compositing. It also supports a wide variety of file formats, including screencasts. However, it may not have as many advanced features as some of the other options.\"]],[[0,[],0,\"OpenShot: OpenShot is a free, open-source video editor that works on Linux. It has a user-friendly interface and can handle multiple video and audio tracks, effects, and compositing. It also supports a wide variety of file formats, including screencasts. It is a good option for beginners, but may not have as many advanced features as some of the other options.\"]],[[0,[],0,\"Pitivi: Pitivi is a free, open-source video editor that works on Linux. It has a user-friendly interface and can handle multiple video and audio tracks, effects, and compositing. It also supports a wide variety of file formats, including screencasts. It is a good option for beginners, but may not have as many advanced features as some of the other options.\"]]]],[1,\"p\",[[0,[],0,\"Based on your needs and the level of expertise, I would recommend Shotcut and OpenShot as they are easy to use and beginner friendly, while Lightworks can be a good option if you need more professional features, Lightworks is a powerful software, but it may be harder to use for someone who is new to video editing.\"]]],[10,4],[1,\"p\",[[0,[],0,\"I was able to recognize in which programs should I focus and decided to install some of them.\"]]],[1,\"p\",[[0,[],0,\"But to install these programs I probably should go to these home pages, and find instalation instructions. \"]]],[1,\"h2\",[[0,[],0,\"I overestimated GPT-3 forgetting how it works\"]]],[1,\"p\",[[0,[],0,\"I assumed that I will take more time than asking \"],[0,[0],1,\"GPT-3\"],[0,[],0,\" one more time: \"]]],[1,\"blockquote\",[[0,[],0,\"how to install Lightworks, shotcut and openshot on fedora linux?\"]]],[1,\"p\",[[0,[],0,\"Again I was \"],[0,[1],1,\"surprised positively\"],[0,[],0,\" by answer, but did not know how wrong it is:\"]]],[1,\"p\",[[0,[],0,\"Installing Lightworks, Shotcut, and OpenShot on Fedora Linux can be done through the command line using the package manager. Here's how to install each of them:\"]]],[1,\"p\",[[0,[],0,\"Lightworks:\"]]],[3,\"ol\",[[[0,[],0,\"Add the Lightworks repository to your system by running the following command: \"],[0,[0],1,\"sudo dnf config-manager --add-repo https://lwks.com/rpm/lwks-repo.fedora.repo\"]],[[0,[],0,\"Update your package list by running: \"],[0,[0],1,\"sudo dnf update\"]],[[0,[],0,\"Install Lightworks by running: \"],[0,[0],1,\"sudo dnf install lightworks\"]]]],[1,\"p\",[[0,[],0,\"Shotcut:\"]]],[3,\"ol\",[[[0,[],0,\"Add the Shotcut repository to your system by running the following command: \"],[0,[0],1,\"sudo dnf config-manager --add-repo https://dl.fedoraproject.org/pub/fedora/linux/updates/32/Everything/x86_64/Packages/s/shotcut-20.12.31-1.fc32.x86_64.rpm\"]],[[0,[],0,\"Update your package list by running: \"],[0,[0],1,\"sudo dnf update\"]],[[0,[],0,\"Install Shotcut by running: \"],[0,[0],1,\"sudo dnf install shotcut\"]]]],[1,\"p\",[[0,[],0,\"OpenShot:\"]]],[3,\"ol\",[[[0,[],0,\"Add the OpenShot repository to your system by running the following command: \"],[0,[0],1,\"sudo dnf config-manager --add-repo https://openshot.org/download/openshot.repo\"]],[[0,[],0,\"Update your package list by running: \"],[0,[0],1,\"sudo dnf update\"]],[[0,[],0,\"Install OpenShot by running: \"],[0,[0],1,\"sudo dnf install openshot-qt\"]]]],[1,\"p\",[[0,[],0,\"Please note that the commands above are for Fedora 32, for other versions of Fedora you need to use the appropriate repository. Additionally, these commands also assume that you have administrative privileges on your system.\"]]],[10,5],[1,\"p\",[[0,[],0,\"All these methods was incorrect or outdated. But I asked about script to install them:\"]]],[1,\"blockquote\",[[0,[],0,\"prepare bash script that execute all commands mentioned in previous answer\"]]],[1,\"p\",[[0,[],0,\"and recived\"]]],[1,\"p\",[[0,[],0,\"Here is a bash script that will install Lightworks, Shotcut, and OpenShot on Fedora Linux using the commands I provided in my previous answer:\"]]],[10,6],[1,\"p\",[[0,[],0,\"Please note that the script above is for Fedora 32, for other versions of Fedora you need to use the appropriate repository. Additionally, these commands also assume that you have administrative privileges on your system.\"]]],[1,\"p\",[[0,[],0,\"You can save the script on your computer with the .sh extension, for example \\\"install_editors.sh\\\" and then make it executable by running \"],[0,[0],1,\"chmod +x install_editors.sh\"],[0,[],0,\" and then you can run it by \"],[0,[0],1,\"./install_editors.sh\"]]],[10,7],[1,\"p\",[[0,[],0,\"It is nice but I fixed it by\"]]],[1,\"blockquote\",[[0,[],0,\"fix it adding option to dnf that will automaticly install packages without asking for confirmations\"]]],[1,\"p\",[[0,[],0,\"now I received better script:\"]]],[10,8],[1,\"p\",[[0,[],0,\"I forget on which version of fedora I am working so I asked as total noob:\"]]],[1,\"blockquote\",[[0,[],0,\"how to check my fedora version, show only command without description\"]]],[1,\"p\",[[0,[],0,\"answer was:\"]]],[10,9],[1,\"p\",[[0,[],0,\"so in next iteration a send command:\"]]],[1,\"blockquote\",[[0,[],0,\"update previous script to fedora 36\"]]],[1,\"p\",[[0,[],0,\"and now I have seen\"]]],[10,10],[1,\"p\",[[0,[],0,\"After executing this and seeing a lot of errors I finished asking \"],[0,[0],1,\"GPT-3\"],[0,[],0,\" about\"]]],[3,\"ul\",[[[0,[],0,\"how to remove old repository from fedora\"]],[[0,[],0,\"how to automatically remove failing repositories in fedora linux\"]]]],[1,\"p\",[[0,[],0,\"these responses are trash and does not works... so making long story short I installed these programs using google and checking homepages.\"]]],[1,\"p\",[[0,[],0,\"Shotout by \"],[0,[0],1,\"snap\"]]],[10,11],[1,\"p\",[[0,[],0,\"Lightworks following after https://computingforgeeks.com/install-lightworks-video-editor-on-fedora/\"]]],[1,\"p\",[[0,[],0,\" \"]]]],\"ghostVersion\":\"4.0\"}","html":"<p>I see value in creation content that in affordable and helpful for other people. From this reason I switched from Polish language to English and now considering move from text content to video.</p><p>I did research in topics of software to screen-cast and edit videos. Best options that I found were:</p><ul><li>OBS - for screen and camera recording</li><li>Davinci Resolve - for editing</li></ul><p>Unfortunately my screen-casting program OBS produce <code>mkv</code> format, that is too complicated for Davinci Resolve. Exact reason:</p><blockquote>One of the greatest things about MKV as a format is the sheer amount of stuff it can contain - you can have multiple subtitles in there, multiple audio tracks and even multiple video tracks. But that's just a bloody nightmare to try to handle in editing software.</blockquote><p>is explained here:</p><figure class=\"kg-card kg-bookmark-card\"><a class=\"kg-bookmark-container\" href=\"https://www.easefab.com/mkv-tips/import-mkv-to-davinci-resolve.html\"><div class=\"kg-bookmark-content\"><div class=\"kg-bookmark-title\">Transcode and Import MKV to DaVinci Resolve</div><div class=\"kg-bookmark-description\">Failed to import MKV files to DaVinci Resolve 10/11/12/13/14/15/16 for further editing? Don’t worry! An easy way is to transcode MKV to DaVinci Resolve compatible video formats. Below is the how to.</div><div class=\"kg-bookmark-metadata\"><img class=\"kg-bookmark-icon\" src=\"https://www.easefab.com/favicon.ico\"><span class=\"kg-bookmark-author\">EaseFab - Best DVD/Blu-ray Ripper/Copy Software, Video Converter and iPhone Data Recovery Software Provider | OFFICIAL</span><span class=\"kg-bookmark-publisher\">MKV Tips</span></div></div><div class=\"kg-bookmark-thumbnail\"><img src=\"https://www.easefab.com/images/icon_download.png\"></div></a></figure><p>I was trying to change settings of <code>OBS</code> to produce formats supported by <code>Davinci Resolve</code> but without success. I was trying to convert <code>MKV</code> to different formats and then import them, but this also failed. Additionally Davinci Resolve 100% load on 2 CPU cores on my computer, even in iddle state so finally I decided to find replacement for it.</p><h2 id=\"why-using-google-failed\">Why using google failed</h2><p>I started as usual from typing</p><pre><code>davinci resolve alternatives</code></pre><p>to google and seen this:</p><figure class=\"kg-card kg-image-card\"><img src=\"__GHOST_URL__/content/images/2023/01/Zrzut-ekranu-z-2023-01-21-14-01-42.png\" class=\"kg-image\" alt loading=\"lazy\" width=\"1774\" height=\"1165\" srcset=\"__GHOST_URL__/content/images/size/w600/2023/01/Zrzut-ekranu-z-2023-01-21-14-01-42.png 600w, __GHOST_URL__/content/images/size/w1000/2023/01/Zrzut-ekranu-z-2023-01-21-14-01-42.png 1000w, __GHOST_URL__/content/images/size/w1600/2023/01/Zrzut-ekranu-z-2023-01-21-14-01-42.png 1600w, __GHOST_URL__/content/images/2023/01/Zrzut-ekranu-z-2023-01-21-14-01-42.png 1774w\" sizes=\"(min-width: 720px) 720px\"></figure><p>from my previous research I remembered that for many people these programs can satisfy criteria, but i wanted:</p><ul><li>free software</li><li>programs working on linux</li></ul><p>I know that in case of <strong><code>Adobe Premiere Pro</code> </strong>it is both paid and does not support linux. It is easy to check that further programs also have paid versions or trial and I can expect only part of them works on linux.</p><p>Google is great tool but these results are not personalized. It build average ranking of pages. On these pages authors build average ranking of programs. For any of these programs I have to build my own ranking reading about them, but it takes time, so cost of research like this can be huge.</p><h2 id=\"in-this-moment-magic-with-gpt-3-started\">In this moment magic with GPT-3 started</h2><p>I remembered how GPT-3 helped me pick queue system worth to learn and decide to use them as searching engine with filters defined by natural language.</p><p>My firs question was:</p><blockquote>software similar to davinci resolve that is free and works on linux</blockquote><p>GPT answered:</p><p>Some free, open-source video editing software that works on Linux include:</p><ul><li>Blender (blender.org)</li><li>Lightworks (<a href=\"http://www.lwks.com/\">www.lwks.com</a>)</li><li>Shotcut (shotcut.org)</li><li>OpenShot (<a href=\"http://www.openshot.org/\">www.openshot.org</a>)</li><li>Pitivi (<a href=\"http://www.pitivi.org/\">www.pitivi.org</a>)</li></ul><p>Please note that some of them may have different capabilities and workflows compared to DaVinci Resolve. It's recommended to check their features and compatibility with your system before installing.</p><hr><p>This list looks nice, but I rememer that <code>Blender</code> was good for <code>3D</code> and animations, physics. Every tutorial of blender starts from drawing sphere and lighting them from differens sides and finish on building tower and destroying them by spherical bullets.</p><p>So I described to GPT-3 what exactly content I want to produce.</p><blockquote>i am going to edit video with my screencast, please describe programs mentioned in previous answer in this context and select best one </blockquote><p>Now answer was more comprehensive:</p><p>All of the programs I mentioned previously are capable of editing video, including screencasts. However, some may be more suitable for your specific needs than others. Here is a brief overview of each program and how they might be useful for editing screencasts:</p><ul><li>Blender: Blender is a powerful 3D animation and modeling program, but it also has a built-in video editor that can handle screencasts. It is a versatile and customizable tool that can handle multiple video and audio tracks, effects, and compositing. However, it has a steeper learning curve than other options, which may make it more challenging for beginners.</li><li>Lightworks: Lightworks is a professional-grade video editing software, it is a cross-platform software and it has a free version that can be used to edit screencasts. It has advanced video and audio editing tools, effects, and support for multiple video and audio tracks. It is designed for experienced video editors and may not be as user-friendly for beginners.</li><li>Shotcut: Shotcut is a free, open-source video editor that works on Linux. It has a simple and intuitive interface that is easy to use. It can handle multiple video and audio tracks, effects, and compositing. It also supports a wide variety of file formats, including screencasts. However, it may not have as many advanced features as some of the other options.</li><li>OpenShot: OpenShot is a free, open-source video editor that works on Linux. It has a user-friendly interface and can handle multiple video and audio tracks, effects, and compositing. It also supports a wide variety of file formats, including screencasts. It is a good option for beginners, but may not have as many advanced features as some of the other options.</li><li>Pitivi: Pitivi is a free, open-source video editor that works on Linux. It has a user-friendly interface and can handle multiple video and audio tracks, effects, and compositing. It also supports a wide variety of file formats, including screencasts. It is a good option for beginners, but may not have as many advanced features as some of the other options.</li></ul><p>Based on your needs and the level of expertise, I would recommend Shotcut and OpenShot as they are easy to use and beginner friendly, while Lightworks can be a good option if you need more professional features, Lightworks is a powerful software, but it may be harder to use for someone who is new to video editing.</p><hr><p>I was able to recognize in which programs should I focus and decided to install some of them.</p><p>But to install these programs I probably should go to these home pages, and find instalation instructions. </p><h2 id=\"i-overestimated-gpt-3-forgetting-how-it-works\">I overestimated GPT-3 forgetting how it works</h2><p>I assumed that I will take more time than asking <code>GPT-3</code> one more time: </p><blockquote>how to install Lightworks, shotcut and openshot on fedora linux?</blockquote><p>Again I was <strong>surprised positively</strong> by answer, but did not know how wrong it is:</p><p>Installing Lightworks, Shotcut, and OpenShot on Fedora Linux can be done through the command line using the package manager. Here's how to install each of them:</p><p>Lightworks:</p><ol><li>Add the Lightworks repository to your system by running the following command: <code>sudo dnf config-manager --add-repo https://lwks.com/rpm/lwks-repo.fedora.repo</code></li><li>Update your package list by running: <code>sudo dnf update</code></li><li>Install Lightworks by running: <code>sudo dnf install lightworks</code></li></ol><p>Shotcut:</p><ol><li>Add the Shotcut repository to your system by running the following command: <code>sudo dnf config-manager --add-repo https://dl.fedoraproject.org/pub/fedora/linux/updates/32/Everything/x86_64/Packages/s/shotcut-20.12.31-1.fc32.x86_64.rpm</code></li><li>Update your package list by running: <code>sudo dnf update</code></li><li>Install Shotcut by running: <code>sudo dnf install shotcut</code></li></ol><p>OpenShot:</p><ol><li>Add the OpenShot repository to your system by running the following command: <code>sudo dnf config-manager --add-repo https://openshot.org/download/openshot.repo</code></li><li>Update your package list by running: <code>sudo dnf update</code></li><li>Install OpenShot by running: <code>sudo dnf install openshot-qt</code></li></ol><p>Please note that the commands above are for Fedora 32, for other versions of Fedora you need to use the appropriate repository. Additionally, these commands also assume that you have administrative privileges on your system.</p><hr><p>All these methods was incorrect or outdated. But I asked about script to install them:</p><blockquote>prepare bash script that execute all commands mentioned in previous answer</blockquote><p>and recived</p><p>Here is a bash script that will install Lightworks, Shotcut, and OpenShot on Fedora Linux using the commands I provided in my previous answer:</p><pre><code class=\"language-bash\">#!/bin/bash\n\n# Add Lightworks repository\nsudo dnf config-manager --add-repo https://lwks.com/rpm/lwks-repo.fedora.repo\n\n# Add Shotcut repository\nsudo dnf config-manager --add-repo https://dl.fedoraproject.org/pub/fedora/linux/updates/32/Everything/x86_64/Packages/s/shotcut-20.12.31-1.fc32.x86_64.rpm\n\n# Add OpenShot repository\nsudo dnf config-manager --add-repo https://openshot.org/download/openshot.repo\n\n# Update package list\nsudo dnf update\n\n# Install Lightworks\nsudo dnf install lightworks\n\n# Install Shotcut\nsudo dnf install shotcut\n\n# Install OpenShot\nsudo dnf install openshot-qt</code></pre><p>Please note that the script above is for Fedora 32, for other versions of Fedora you need to use the appropriate repository. Additionally, these commands also assume that you have administrative privileges on your system.</p><p>You can save the script on your computer with the .sh extension, for example \"install_editors.sh\" and then make it executable by running <code>chmod +x install_editors.sh</code> and then you can run it by <code>./install_editors.sh</code></p><hr><p>It is nice but I fixed it by</p><blockquote>fix it adding option to dnf that will automaticly install packages without asking for confirmations</blockquote><p>now I received better script:</p><pre><code class=\"language-bash\">#!/bin/bash\n\n# Add Lightworks repository\nsudo dnf config-manager --add-repo https://lwks.com/rpm/lwks-repo.fedora.repo\n\n# Add Shotcut repository\nsudo dnf config-manager --add-repo https://dl.fedoraproject.org/pub/fedora/linux/updates/32/Everything/x86_64/Packages/s/shotcut-20.12.31-1.fc32.x86_64.rpm\n\n# Add OpenShot repository\nsudo dnf config-manager --add-repo https://openshot.org/download/openshot.repo\n\n# Update package list\nsudo dnf update -y\n\n# Install Lightworks\nsudo dnf install lightworks -y\n\n# Install Shotcut\nsudo dnf install shotcut -y\n\n# Install OpenShot\nsudo dnf install openshot-qt -y</code></pre><p>I forget on which version of fedora I am working so I asked as total noob:</p><blockquote>how to check my fedora version, show only command without description</blockquote><p>answer was:</p><pre><code>cat /etc/fedora-release</code></pre><p>so in next iteration a send command:</p><blockquote>update previous script to fedora 36</blockquote><p>and now I have seen</p><pre><code>#!/bin/bash\n\n# Add Lightworks repository\nsudo dnf config-manager --add-repo https://lwks.com/rpm/lwks-repo.fedora.repo\n\n# Add Shotcut repository\nsudo dnf config-manager --add-repo https://dl.fedoraproject.org/pub/fedora/linux/updates/36/Everything/x86_64/Packages/s/shotcut-20.12.31-1.fc36.x86_64.rpm\n\n# Add OpenShot repository\nsudo dnf config-manager --add-repo https://openshot.org/download/openshot.repo\n\n# Update package list\nsudo dnf update -y\n\n# Install Lightworks\nsudo dnf install lightworks -y\n\n# Install Shotcut\nsudo dnf install shotcut -y\n\n# Install OpenShot\nsudo dnf install openshot-qt -y</code></pre><p>After executing this and seeing a lot of errors I finished asking <code>GPT-3</code> about</p><ul><li>how to remove old repository from fedora</li><li>how to automatically remove failing repositories in fedora linux</li></ul><p>these responses are trash and does not works... so making long story short I installed these programs using google and checking homepages.</p><p>Shotout by <code>snap</code></p><pre><code>sudo snap install shotcut --classic</code></pre><p>Lightworks following after https://computingforgeeks.com/install-lightworks-video-editor-on-fedora/</p><p> </p>","comment_id":"63cbdf03bbda300a2f29ca63","plaintext":"I see value in creation content that in affordable and helpful for other people.\nFrom this reason I switched from Polish language to English and now considering\nmove from text content to video.\n\nI did research in topics of software to screen-cast and edit videos. Best\noptions that I found were:\n\n * OBS - for screen and camera recording\n * Davinci Resolve - for editing\n\nUnfortunately my screen-casting program OBS produce mkv format, that is too\ncomplicated for Davinci Resolve. Exact reason:\n\n> One of the greatest things about MKV as a format is the sheer amount of stuff it\ncan contain - you can have multiple subtitles in there, multiple audio tracks\nand even multiple video tracks. But that's just a bloody nightmare to try to\nhandle in editing software.\nis explained here:\n\nTranscode and Import MKV to DaVinci ResolveFailed to import MKV files to\nDaVinci\nResolve 10/11/12/13/14/15/16 for further editing? Don’t worry! An easy way is\nto\ntranscode MKV to DaVinci Resolve compatible video formats. Below is the how to.\nEaseFab - Best DVD/Blu-ray Ripper/Copy Software, Video Converter and iPhone\nData\nRecovery Software Provider | OFFICIALMKV Tips\n[https://www.easefab.com/mkv-tips/import-mkv-to-davinci-resolve.html]I was\ntrying to change settings of OBS to produce formats supported by Davinci Resolve \nbut without success. I was trying to convert MKV to different formats and then\nimport them, but this also failed. Additionally Davinci Resolve 100% load on 2\nCPU cores on my computer, even in iddle state so finally I decided to find\nreplacement for it.\n\nWhy using google failed\nI started as usual from typing\n\ndavinci resolve alternatives\n\nto google and seen this:\n\nfrom my previous research I remembered that for many people these programs can\nsatisfy criteria, but i wanted:\n\n * free software\n * programs working on linux\n\nI know that in case of Adobe Premiere Pro it is both paid and does not support\nlinux. It is easy to check that further programs also have paid versions or\ntrial and I can expect only part of them works on linux.\n\nGoogle is great tool but these results are not personalized. It build average\nranking of pages. On these pages authors build average ranking of programs. For\nany of these programs I have to build my own ranking reading about them, but it\ntakes time, so cost of research like this can be huge.\n\nIn this moment magic with GPT-3 started\nI remembered how GPT-3 helped me pick queue system worth to learn and decide to\nuse them as searching engine with filters defined by natural language.\n\nMy firs question was:\n\n> software similar to davinci resolve that is free and works on linux\nGPT answered:\n\nSome free, open-source video editing software that works on Linux include:\n\n * Blender (blender.org)\n * Lightworks (www.lwks.com [http://www.lwks.com/])\n * Shotcut (shotcut.org)\n * OpenShot (www.openshot.org [http://www.openshot.org/])\n * Pitivi (www.pitivi.org [http://www.pitivi.org/])\n\nPlease note that some of them may have different capabilities and workflows\ncompared to DaVinci Resolve. It's recommended to check their features and\ncompatibility with your system before installing.\n\n\n--------------------------------------------------------------------------------\n\nThis list looks nice, but I rememer that Blender was good for 3D and animations,\nphysics. Every tutorial of blender starts from drawing sphere and lighting them\nfrom differens sides and finish on building tower and destroying them by\nspherical bullets.\n\nSo I described to GPT-3 what exactly content I want to produce.\n\n> i am going to edit video with my screencast, please describe programs mentioned\nin previous answer in this context and select best one \nNow answer was more comprehensive:\n\nAll of the programs I mentioned previously are capable of editing video,\nincluding screencasts. However, some may be more suitable for your specific\nneeds than others. Here is a brief overview of each program and how they might\nbe useful for editing screencasts:\n\n * Blender: Blender is a powerful 3D animation and modeling program, but it also\n   has a built-in video editor that can handle screencasts. It is a versatile\n   and customizable tool that can handle multiple video and audio tracks,\n   effects, and compositing. However, it has a steeper learning curve than other\n   options, which may make it more challenging for beginners.\n * Lightworks: Lightworks is a professional-grade video editing software, it is\n   a cross-platform software and it has a free version that can be used to edit\n   screencasts. It has advanced video and audio editing tools, effects, and\n   support for multiple video and audio tracks. It is designed for experienced\n   video editors and may not be as user-friendly for beginners.\n * Shotcut: Shotcut is a free, open-source video editor that works on Linux. It\n   has a simple and intuitive interface that is easy to use. It can handle\n   multiple video and audio tracks, effects, and compositing. It also supports a\n   wide variety of file formats, including screencasts. However, it may not have\n   as many advanced features as some of the other options.\n * OpenShot: OpenShot is a free, open-source video editor that works on Linux.\n   It has a user-friendly interface and can handle multiple video and audio\n   tracks, effects, and compositing. It also supports a wide variety of file\n   formats, including screencasts. It is a good option for beginners, but may\n   not have as many advanced features as some of the other options.\n * Pitivi: Pitivi is a free, open-source video editor that works on Linux. It\n   has a user-friendly interface and can handle multiple video and audio tracks,\n   effects, and compositing. It also supports a wide variety of file formats,\n   including screencasts. It is a good option for beginners, but may not have as\n   many advanced features as some of the other options.\n\nBased on your needs and the level of expertise, I would recommend Shotcut and\nOpenShot as they are easy to use and beginner friendly, while Lightworks can be\na good option if you need more professional features, Lightworks is a powerful\nsoftware, but it may be harder to use for someone who is new to video editing.\n\n\n--------------------------------------------------------------------------------\n\nI was able to recognize in which programs should I focus and decided to install\nsome of them.\n\nBut to install these programs I probably should go to these home pages, and find\ninstalation instructions. \n\nI overestimated GPT-3 forgetting how it works\nI assumed that I will take more time than asking GPT-3 one more time: \n\n> how to install Lightworks, shotcut and openshot on fedora linux?\nAgain I was surprised positively by answer, but did not know how wrong it is:\n\nInstalling Lightworks, Shotcut, and OpenShot on Fedora Linux can be done through\nthe command line using the package manager. Here's how to install each of them:\n\nLightworks:\n\n 1. Add the Lightworks repository to your system by running the following\n    command: sudo dnf config-manager --add-repo\n    https://lwks.com/rpm/lwks-repo.fedora.repo\n 2. Update your package list by running: sudo dnf update\n 3. Install Lightworks by running: sudo dnf install lightworks\n\nShotcut:\n\n 1. Add the Shotcut repository to your system by running the following command: \n    sudo dnf config-manager --add-repo\n    https://dl.fedoraproject.org/pub/fedora/linux/updates/32/Everything/x86_64/Packages/s/shotcut-20.12.31-1.fc32.x86_64.rpm\n 2. Update your package list by running: sudo dnf update\n 3. Install Shotcut by running: sudo dnf install shotcut\n\nOpenShot:\n\n 1. Add the OpenShot repository to your system by running the following command: \n    sudo dnf config-manager --add-repo\n    https://openshot.org/download/openshot.repo\n 2. Update your package list by running: sudo dnf update\n 3. Install OpenShot by running: sudo dnf install openshot-qt\n\nPlease note that the commands above are for Fedora 32, for other versions of\nFedora you need to use the appropriate repository. Additionally, these commands\nalso assume that you have administrative privileges on your system.\n\n\n--------------------------------------------------------------------------------\n\nAll these methods was incorrect or outdated. But I asked about script to install\nthem:\n\n> prepare bash script that execute all commands mentioned in previous answer\nand recived\n\nHere is a bash script that will install Lightworks, Shotcut, and OpenShot on\nFedora Linux using the commands I provided in my previous answer:\n\n#!/bin/bash\n\n# Add Lightworks repository\nsudo dnf config-manager --add-repo https://lwks.com/rpm/lwks-repo.fedora.repo\n\n# Add Shotcut repository\nsudo dnf config-manager --add-repo https://dl.fedoraproject.org/pub/fedora/linux/updates/32/Everything/x86_64/Packages/s/shotcut-20.12.31-1.fc32.x86_64.rpm\n\n# Add OpenShot repository\nsudo dnf config-manager --add-repo https://openshot.org/download/openshot.repo\n\n# Update package list\nsudo dnf update\n\n# Install Lightworks\nsudo dnf install lightworks\n\n# Install Shotcut\nsudo dnf install shotcut\n\n# Install OpenShot\nsudo dnf install openshot-qt\n\nPlease note that the script above is for Fedora 32, for other versions of Fedora\nyou need to use the appropriate repository. Additionally, these commands also\nassume that you have administrative privileges on your system.\n\nYou can save the script on your computer with the .sh extension, for example\n\"install_editors.sh\" and then make it executable by running chmod +x\ninstall_editors.sh and then you can run it by ./install_editors.sh\n\n\n--------------------------------------------------------------------------------\n\nIt is nice but I fixed it by\n\n> fix it adding option to dnf that will automaticly install packages without\nasking for confirmations\nnow I received better script:\n\n#!/bin/bash\n\n# Add Lightworks repository\nsudo dnf config-manager --add-repo https://lwks.com/rpm/lwks-repo.fedora.repo\n\n# Add Shotcut repository\nsudo dnf config-manager --add-repo https://dl.fedoraproject.org/pub/fedora/linux/updates/32/Everything/x86_64/Packages/s/shotcut-20.12.31-1.fc32.x86_64.rpm\n\n# Add OpenShot repository\nsudo dnf config-manager --add-repo https://openshot.org/download/openshot.repo\n\n# Update package list\nsudo dnf update -y\n\n# Install Lightworks\nsudo dnf install lightworks -y\n\n# Install Shotcut\nsudo dnf install shotcut -y\n\n# Install OpenShot\nsudo dnf install openshot-qt -y\n\nI forget on which version of fedora I am working so I asked as total noob:\n\n> how to check my fedora version, show only command without description\nanswer was:\n\ncat /etc/fedora-release\n\nso in next iteration a send command:\n\n> update previous script to fedora 36\nand now I have seen\n\n#!/bin/bash\n\n# Add Lightworks repository\nsudo dnf config-manager --add-repo https://lwks.com/rpm/lwks-repo.fedora.repo\n\n# Add Shotcut repository\nsudo dnf config-manager --add-repo https://dl.fedoraproject.org/pub/fedora/linux/updates/36/Everything/x86_64/Packages/s/shotcut-20.12.31-1.fc36.x86_64.rpm\n\n# Add OpenShot repository\nsudo dnf config-manager --add-repo https://openshot.org/download/openshot.repo\n\n# Update package list\nsudo dnf update -y\n\n# Install Lightworks\nsudo dnf install lightworks -y\n\n# Install Shotcut\nsudo dnf install shotcut -y\n\n# Install OpenShot\nsudo dnf install openshot-qt -y\n\nAfter executing this and seeing a lot of errors I finished asking GPT-3 about\n\n * how to remove old repository from fedora\n * how to automatically remove failing repositories in fedora linux\n\nthese responses are trash and does not works... so making long story short I\ninstalled these programs using google and checking homepages.\n\nShotout by snap\n\nsudo snap install shotcut --classic\n\nLightworks following after\nhttps://computingforgeeks.com/install-lightworks-video-editor-on-fedora/","feature_image":null,"featured":0,"type":"post","status":"draft","locale":null,"visibility":"public","email_recipient_filter":"all","created_at":"2023-01-21T12:48:03.000Z","updated_at":"2023-01-21T13:56:18.000Z","published_at":null,"custom_excerpt":null,"codeinjection_head":null,"codeinjection_foot":null,"custom_template":null,"canonical_url":null,"newsletter_id":null,"lexical":null},{"id":"63cc1ff5bbda300a2f29cb53","uuid":"258c057a-750b-493d-923d-7ed0a7863fad","title":"CodinGame: Derivative Time - Part 1, Recursion (Typescript)","slug":"codingame-derivative-part-1","mobiledoc":"{\"version\":\"0.3.1\",\"atoms\":[[\"soft-return\",\"\",{}],[\"soft-return\",\"\",{}],[\"soft-return\",\"\",{}],[\"soft-return\",\"\",{}],[\"soft-return\",\"\",{}],[\"soft-return\",\"\",{}],[\"soft-return\",\"\",{}],[\"soft-return\",\"\",{}],[\"soft-return\",\"\",{}],[\"soft-return\",\"\",{}],[\"soft-return\",\"\",{}]],\"cards\":[[\"bookmark\",{\"type\":\"bookmark\",\"url\":\"https://www.codingame.com/training/medium/derivative-time---part1\",\"metadata\":{\"url\":\"https://www.codingame.com/training/medium/derivative-time---part1\",\"title\":\"Coding Games and Programming Challenges to Code Better\",\"description\":\"CodinGame is a challenge-based training platform for programmers where you can play with the hottest programming topics. Solve games, code AI bots, learn from your peers, have fun.\",\"author\":null,\"publisher\":\"CodinGame\",\"thumbnail\":\"https://files.codingame.com/codingame/codingame_share_pics.jpg\",\"icon\":\"https://static.codingame.com/assets/apple-touch-icon-152x152-precomposed.5cb052db.png\"}}],[\"code\",{\"code\":\"   d²f(x,y)   \\n  ----------\\n    dxdy\"}],[\"bookmark\",{\"type\":\"bookmark\",\"url\":\"https://en.wikipedia.org/wiki/Differentiation_rules\",\"metadata\":{\"url\":\"https://en.wikipedia.org/wiki/Differentiation_rules\",\"title\":\"Differentiation rules - Wikipedia\",\"description\":null,\"author\":\"Contributors to Wikimedia projects\",\"publisher\":\"Wikimedia Foundation, Inc.\",\"thumbnail\":\"https://wikimedia.org/api/rest_v1/media/math/render/svg/86a67b81c2de995bd608d5b2df50cd8cd7d92455\",\"icon\":\"https://en.wikipedia.org/static/apple-touch/wikipedia.png\"}}],[\"code\",{\"code\":\"a'=0\\n(a*x)'=a\\n(x^a)'=a*x^(a-1) (when a is not 0)\\n(u+v)'=u'+v'\\n(u*v)'=u'*v+v'*u\"}],[\"bookmark\",{\"type\":\"bookmark\",\"url\":\"https://learnxinyminutes.com/docs/common-lisp/\",\"metadata\":{\"url\":\"https://learnxinyminutes.com/docs/common-lisp/\",\"title\":\"Learn Common Lisp in Y Minutes\",\"description\":null,\"author\":null,\"publisher\":null,\"thumbnail\":\"https://i.creativecommons.org/l/by-sa/3.0/88x31.png\",\"icon\":null}}],[\"code\",{\"code\":\"a + b\"}],[\"code\",{\"code\":\"(+ a b)\"}],[\"code\",{\"code\":\"const [operation, ...arguments] = expression;\",\"language\":\"typescript\"}],[\"code\",{\"code\":\"const res = arguments.reduce(fn, identity);\"}],[\"code\",{\"code\":\"npm init -y\\ntsc --init\"}],[\"code\",{\"code\":\"\\\"target\\\": \\\"ESNext\\\",\"}],[\"code\",{\"code\":\"\\\"test\\\": \\\"jest\\\"\"}],[\"code\",{\"code\":\"npm i -D @types/jest @types/node esbuild-jest jest ts-node typescript\"}],[\"code\",{\"code\":\"module.exports = {\\n    roots: ['<rootDir>'],\\n    testMatch: ['**/__tests__/**/*.+(ts|tsx)', '**/?(*.)+(spec|test).+(ts|tsx)'],\\n    transform: {\\n        '^.+\\\\\\\\.(ts|tsx)$': 'esbuild-jest',\\n    },\\n    setupFilesAfterEnv: [],\\n    testEnvironment: 'node',\\n}\\n\",\"language\":\"typescript\"}],[\"code\",{\"code\":\"export function run(input: string): string {\\n    return ''\\n}\\n\",\"language\":\"typescript\"}],[\"code\",{\"code\":\"import {run} from \\\"../lib\\\";\\n\\ndescribe('e2e', () => {\\n    it('temporary', () => {\\n        expect(run('')).toEqual('')\\n    })\\n});\",\"language\":\"typescript\"}],[\"code\",{\"code\":\"import {run} from \\\"./lib\\\";\\n\\nprocess.stdin.on('data', (buff) => {\\n    const input = buff.toString();\\n    process.stdout.write(run(input));\\n})\\n\",\"language\":\"typescript\"}],[\"code\",{\"code\":\"echo '' | ts-node index.ts\"}],[\"code\",{\"code\":\"npm run test\"}],[\"code\",{\"code\":\"(5*(x*y))\\nx\\nx 2 y 6\"}],[\"code\",{\"code\":\"30\"}],[\"code\",{\"code\":\"export function run(input: string): string {\\n    const [F, vs, dict] = input.split('\\\\n');\\n    const point = new Coordinate(dict);\\n    const diff = new DiffOperator(vs);\\n    const formula = new Formula(F, point.variables);\\n\\n    return diff.actOn(formula).evaluate(point).toString();\\n}\\n\",\"language\":\"typescript\"}],[\"code\",{\"code\":\"export class Coordinate {\\n    map: Map<string, number> = new Map();\\n\\n    constructor(input: string) {\\n        const pairs = input.split(' ');\\n        for (let i = 0; i < pairs.length / 2; i++) {\\n            const [key, value] = [pairs[i * 2], Number.parseFloat(pairs[i * 2 + 1])];\\n            this.map.set(key, value);\\n        }\\n    }\\n\\n    get variables(): string[] {\\n        return [...this.map.keys()]\\n    }\\n\\n    get(name): number {\\n        return this.map.get(name) ?? 0;\\n    }\\n}\",\"language\":\"typescript\"}],[\"code\",{\"code\":\"describe('coordinate', () => {\\n    it('parsing', () => {\\n        const point = new Coordinate('x 2 y 6');\\n        expect(point.variables).toEqual(['x', 'y']);\\n        expect(point.get('x')).toEqual(2);\\n        expect(point.get('y')).toEqual(6);\\n        expect(point.get('undefined')).toEqual(0);\\n    })\\n})\",\"language\":\"typescript\"}],[\"code\",{\"code\":\"type Operator = '*' | '^' | '+' | '-';\\ntype SubFormula = Array<string | number | SubFormula> | string | number\",\"language\":\"typescript\"}],[\"code\",{\"code\":\"export class Formula {\\n    f: SubFormula;\\n    v: string[] = [];\\n}\",\"language\":\"typescript\"}],[\"code\",{\"code\":\"    isDecomposable(input: string): boolean {\\n        return input.startsWith('(') && input.endsWith(')') && /[*^+-]/.test(input)\\n    }\",\"language\":\"typescript\"}],[\"code\",{\"code\":\"decomposeInput(input: string): SubFormula {\\n        let p: SubFormula = '', operator: Operator | '' = '', n: SubFormula = '', level: number = 0;\\n        if (!this.isDecomposable(input)) return [0];\\n        for (let i = 1; i < input.length - 1; i++) {\\n            if (level === 0 && !operator && /[*^+-]/.test(input[i])) {\\n                operator = input[i] as Operator;\\n                continue;\\n            } else if (input[i] === '(') {\\n                level++;\\n            } else if (input[i] === ')') {\\n                level--;\\n            }\\n            if (operator) {\\n                n += input[i];\\n            } else {\\n                p += input[i];\\n            }\\n        }\",\"language\":\"typescript\"}],[\"code\",{\"code\":\"        if (this.isDecomposable(p)) {\\n            p = this.decomposeInput(p);\\n        } else {\\n            if (!this.v.includes(p)) {\\n                p = Number.parseFloat(p);\\n            }\\n        }\\n        if (this.isDecomposable(n)) {\\n            n = this.decomposeInput(n);\\n        } else {\\n            if (!this.v.includes(n)) {\\n                n = Number.parseFloat(n);\\n            }\\n        }\\n        return [operator, p, n];\\n    }\",\"language\":\"typescript\"}],[\"code\",{\"code\":\"    constructor(input: string, variables: string[]) {\\n        this.v = variables;\\n        this.f = this.decomposeInput(input);\\n    }\",\"language\":\"typescript\"}],[\"code\",{\"code\":\"describe('formula', () => {\\n    const f = new Formula('(5*(x*y))', ['x', 'y']);\\n\\n    it('parse', () => {\\n        expect(f.f).toEqual(['*', 5, ['*', 'x', 'y']]);\\n        expect(f.v).toEqual(['x', 'y']);\\n    });\\n\\n    it('parse with many brackets', () => {\\n        const f = new Formula('((x^3)+(x^2))', ['x']);\\n        expect(f.f).toEqual(['+', ['^', 'x', 3], ['^', 'x', 2]])\\n    })\\n})\",\"language\":\"typescript\"}],[\"code\",{\"code\":\"export class DiffOperator {\\n    d: string[] = [];\\n\\n    constructor(input: string) {\\n        this.d = input.split(' ');\\n    }\\n}\",\"language\":\"typescript\"}],[\"code\",{\"code\":\"static compute(f: SubFormula | string | number, point: Coordinate): number\",\"language\":\"typescript\"}],[\"code\",{\"code\":\"evaluate(point: Coordinate): number \",\"language\":\"typescript\"}],[\"code\",{\"code\":\"diff.actOn(formula).evaluate(point)\",\"language\":\"typescript\"}],[\"code\",{\"code\":\"    evaluate(point: Coordinate): number {\\n        return Formula.compute(this.f, point);\\n    }\",\"language\":\"typescript\"}],[\"code\",{\"code\":\"    static compute(f: SubFormula | string | number, point: Coordinate): number {\\n        if (Array.isArray(f)) {\\n            // ... TO BE DEFINED IN NEXT STEP\\n        } else if (typeof f === 'number') {\\n            return f;\\n        } else {\\n            return point.get(f);\\n        }\\n    }\",\"language\":\"typescript\"}],[\"code\",{\"code\":\"const [op, ...rest] = f;\",\"language\":\"typescript\"}],[\"code\",{\"code\":\"switch (op) {\\n    case '+':\\n        return <number>rest.reduce((p: number, n: SubFormula): number => p + this.compute(n, point), 0);\\n    case '*':\\n        return <number>rest.reduce((p: number, n: SubFormula): number => p * this.compute(n, point), 1);\\n    case '^': {\\n        const [p, n] = rest;\\n        return Math.pow(this.compute(p, point), this.compute(n, point));\\n    }\\n    case '-': {\\n        const [p, n] = rest;\\n        return this.compute(p,point) - this.compute(n, point);\\n    }\\n    default:\\n        return 0;\\n}\",\"language\":\"typescript\"}],[\"code\",{\"code\":\"    it('evaluate', () => {\\n        expect(f.evaluate(new Coordinate('x 1 y 2'))).toStrictEqual(10);\\n    });\",\"language\":\"typescript\"}],[\"code\",{\"code\":\"actOn(f: Formula): Formula\",\"language\":\"typescript\"}],[\"code\",{\"code\":\"static derivative(s: SubFormula, dir: string): SubFormula\",\"language\":\"typescript\"}],[\"code\",{\"code\":\"static simplify(s: SubFormula): SubFormula \",\"language\":\"typescript\"}],[\"code\",{\"code\":\"    static simplify(s: SubFormula): SubFormula {\\n        if (Array.isArray(s)) {\\n            const [op, ...rest] = s;\\n            for (let i = 0; i < rest.length; i++) {\\n                rest[i] = this.simplify(rest[i]);\\n            }\\n            if (rest.every((r) => typeof r === 'number')) {\\n                return Formula.compute(s, new Coordinate(''));\\n            }\\n            if (rest[0] === 0) {\\n                if (op === '+') return rest[1]\\n                if (op === '*') return 0\\n                if (op === '^') return 0\\n            }\\n            if (rest[0] === 1) {\\n                if (op === '*') return rest[1]\\n                if (op === '^') return 1\\n            }\\n            if (rest[1] === 0) {\\n                if (op === '+') return rest[0]\\n                if (op === '*') return 0\\n                if (op === '^') return 1\\n            }\\n            if (rest[1] === 1) {\\n                if (op === '*') return rest[0]\\n                if (op === '^') return rest[0]\\n            }\\n            return [op, ...rest];\\n        } else {\\n            return s;\\n        }\\n    }\",\"language\":\"typescript\"}],[\"code\",{\"code\":\"static derivative(s: SubFormula, dir: string): SubFormula\",\"language\":\"typescript\"}],[\"code\",{\"code\":\"    static derivative(s: SubFormula, dir: string): SubFormula {\\n        if (Array.isArray(s)) {\\n            const [op, p, n] = s;\\n            switch (op) {\\n                case '*':\\n                    return ['+', ['*', p, this.derivative(n, dir)], ['*', this.derivative(p, dir), n]];\\n                case '+':\\n                    return ['+', this.derivative(p, dir), this.derivative(n, dir)];\\n                case '-':\\n                    return ['-', this.derivative(p, dir), this.derivative(n, dir)];\\n                case '^': {\\n                    if (p === dir) {\\n                        if (n === 0) return 0;\\n                        return typeof n === 'number' ? ['*', n, ['^', p, n - 1]] : ['*', n, ['^', p, ['+', n, -1]]]\\n                    } else {\\n                        return 0;\\n                    }\\n                }\\n            }\\n\\n        } else if (typeof s === 'string' && s === dir) {\\n            return 1\\n        } else {\\n            return 0;\\n        }\\n    }\",\"language\":\"typescript\"}],[\"code\",{\"code\":\"    clone(): Formula {\\n        const o = new Formula('', []);\\n        o.f = JSON.parse(JSON.stringify(this.f));\\n        o.v = JSON.parse(JSON.stringify(this.f));\\n        return o;\\n    }\",\"language\":\"typescript\"}],[\"code\",{\"code\":\"    actOn(f: Formula): Formula {\\n        const o = f.clone();\\n        return this.d.reduce((p, n) => {\\n            o.f = DiffOperator.simplify(DiffOperator.derivative(p.f, n));\\n            return o;\\n        }, o);\\n    }\",\"language\":\"typescript\"}],[\"code\",{\"code\":\"describe('diff operation', () => {\\n    it('simplify', () => {\\n        expect(DiffOperator.simplify([\\\"+\\\", [\\\"*\\\", 1, 0], [\\\"*\\\", 0, 1]])).toEqual(0);\\n        expect(DiffOperator.simplify(['^', 'x', 1])).toEqual('x');\\n        expect(DiffOperator.simplify(['*', 2, ['^', 'x', 1]])).toEqual(['*', 2, 'x']);\\n        expect(DiffOperator.simplify([\\\"*\\\", 5, [\\\"+\\\", [\\\"*\\\", \\\"x\\\", 0], [\\\"*\\\", 1, \\\"y\\\"]]])).toEqual(['*', 5, 'y'])\\n        expect(DiffOperator.simplify([\\\"+\\\", [\\\"*\\\", 5, [\\\"+\\\", [\\\"*\\\", \\\"x\\\", 0], [\\\"*\\\", 1, \\\"y\\\"]]], [\\\"*\\\", 0, [\\\"*\\\", \\\"x\\\", \\\"y\\\"]]])).toEqual(['*', 5, 'y'])\\n    });\\n    it('derivative', () => {\\n        expect(DiffOperator.simplify(DiffOperator.derivative(['*', 2, 'x'], 'x'))).toEqual(2);\\n        expect(DiffOperator.simplify(DiffOperator.derivative(['*', 5, ['*', 'x', 'y']], 'x'))).toEqual(['*', 5, 'y'])\\n    })\\n    it(\\\"a'=0\\\", () => {\\n        const f = new Formula('(1*1)', ['x']);\\n        const d = new DiffOperator('x');\\n        expect(d.actOn(f).f).toEqual(0);\\n    });\\n    it(\\\"(a*x)'=a\\\", () => {\\n        const f = new Formula('(4*x)', ['x']);\\n        const d = new DiffOperator('x');\\n        expect(d.actOn(f).f).toEqual(4);\\n    });\\n    it(\\\"(x^a)'=a*x^(a-1) (when a is not 0)\\\", () => {\\n        const cases = [\\n            {in: '(x^5)', out: ['*', 5, ['^', 'x', 4]]},\\n            {in: '(x^3)', out: ['*', 3, ['^', 'x', 2]]},\\n            {in: '(x^2)', out: ['*', 2, 'x']},\\n        ];\\n        for (const c of cases) {\\n            const f = new Formula(c.in, ['x']);\\n            const d = new DiffOperator('x');\\n            expect(d.actOn(f).f).toEqual(c.out);\\n        }\\n    });\\n    it(\\\"(u+v)'=u'+v for (x+(x^2))'\\\", () => {\\n        const f = new Formula('(x+(x^2))', ['x']);\\n        const d = new DiffOperator('x');\\n        expect(d.actOn(f).f).toEqual(['+', 1, ['*', 2, 'x']]);\\n    });\\n\\n    it(\\\"(u+v)'=u'+v'\\\", () => {\\n        const f = new Formula('((x^3)+(x^2))', ['x']);\\n        const d = new DiffOperator('x');\\n        console.log(\\\"f\\\", f);\\n        expect(d.actOn(f).f).toEqual(['+', ['*', 3, ['^', 'x', 2]], ['*', 2, 'x']]);\\n    });\\n    it(\\\"(u*v)'=u'*v+v'*u\\\", () => {\\n        const f = new Formula('(x*x)', ['x']);\\n        const d = new DiffOperator('x');\\n        console.log(\\\"f\\\", f);\\n        expect(d.actOn(f).f).toEqual(['+', 'x', 'x']);\\n    });\\n\\n    it('d(8*(y^x))/dy', () => {\\n        const f = new Formula('(8*(y^x))', ['x', 'y']);\\n        expect(f.f).toEqual(['*', 8, ['^', 'y', 'x']]);\\n        expect(DiffOperator.simplify(DiffOperator.derivative(['*', 8, ['^', 'y', 'x']], 'y'))).toEqual(['*', 8, ['*', 'x', ['^', 'y', ['+', 'x', -1]]]]);\\n    })\\n\\n    it('(18*(x^-1))',() => {\\n        const f = new Formula('(18*(x^-1))', ['x']);\\n        expect(f.f).toEqual(['*', 18, ['^', 'x', -1]]);\\n        expect(DiffOperator.simplify(DiffOperator.derivative(f.f, 'x'))).toEqual( ['*', 18, ['*', -1, ['^', 'x', -2]]]);\\n    });\\n\\n    it('d(((x^2)+(2*(z^5)))+(((18*(x^-1))+y)+z))/dx', () => {\\n        const f = new Formula('(((x^2)+(2*(z^5)))+(((18*(x^-1))+y)+z))', ['x', 'y', 'z']);\\n        expect(DiffOperator.simplify(DiffOperator.derivative(f.f, 'x'))).toEqual(['+', ['*', 2, 'x'], ['*', 18, ['*', -1, ['^', 'x', -2]]]]);\\n    })\\n})\",\"language\":\"typescript\"}],[\"code\",{\"code\":\"describe('e2e', () => {\\n    it('easy multiply', () => {\\n        expect(run('(5*(x*y))\\\\nx\\\\nx 2 y 6')).toEqual('30')\\n    })\\n    it(\\\"second derivative\\\", () => {\\n        expect(run('(5*((x^4)*(y^2)))\\\\nx x\\\\nx 2 y 6')).toEqual('8640')\\n    })\\n    it(\\\"second derivative mix\\\", () => {\\n        expect(run('(5*(x*(y^2)))\\\\ny x\\\\nx 2 y 6')).toEqual('60')\\n    })\\n    it(\\\"power with number\\\", () => {\\n        expect(run('((x^2)+(9*(x+y)))\\\\nx\\\\nx 1 y 2')).toEqual('11')\\n    })\\n    it(\\\"power with variable\\\", () => {\\n        expect(run('(8*(y^x))\\\\ny y\\\\nx -1 y 2')).toEqual('2')\\n    })\\n    it(\\\"3 variables\\\", () => {\\n        expect(run('(((x^2)+(2*(z^5)))+((x+y)+z))\\\\nz\\\\nx 2 y 3 z 4')).toEqual('2561')\\n    })\\n    it(\\\"fraction\\\", () => {\\n        expect(run('(((x^2)+(2*(z^5)))+(((18*(x^-1))+y)+z))\\\\nx\\\\nx 3 y 4 z 1')).toEqual('4')\\n    })\\n    it(\\\"longer multiply\\\", () => {\\n        expect(run('(((x^2)*(2*(z^5)))*((x+y)+z))\\\\nz\\\\nx 1 y 1 z 1')).toEqual('32')\\n    })\\n    it(\\\"3rd derivative\\\", () => {\\n        expect(run('(((y^6)*(z^5))*(((3*(x^4))+y)+z))\\\\ny y z\\\\nx 1 y 1 z 2')).toEqual('16320')\\n    })\\n    it(\\\"some Greek ;)\\\", () => {\\n        expect(run('(((Beta^6)*(Gamma^5))*(((3*(Alpha^4))+Beta)+Gamma))\\\\nBeta Beta Gamma\\\\nAlpha 1 Beta 1 Gamma 2')).toEqual('16320')\\n    })\\n    it(\\\"maybe not xyz ;)\\\", () => {\\n        expect(run('(((x2^6)*(x3^5))*(((3*(x1^4))+x2)+x3))\\\\nx2 x2 x3\\\\nx1 1 x2 1 x3 2')).toEqual('16320')\\n    })\\n    it(\\\"some Vars ;)))\\\", () => {\\n        expect(run('(((Var_2^6)*(Var_3^5))*(((3*(Var_1^4))+Var_2)+Var_3))\\\\nVar_2 Var_2 Var_3\\\\nVar_1 1 Var_2 1 Var_3 2')).toEqual('16320')\\n    })\\n    it(\\\"bigger constants\\\", () => {\\n        expect(run('(50*((x^40)*(y^20)))\\\\nx x\\\\nx 1 y 1')).toEqual('78000')\\n    })\\n    it(\\\"bigger power\\\", () => {\\n        expect(run('(x^(y^10))\\\\nx x\\\\nx 1 y 2')).toEqual('1047552')\\n    })\\n    it(\\\"cannot find\\\", () => {\\n        expect(run('(5*(x*(y^2)))\\\\nz\\\\nx 2 y 6')).toEqual('0')\\n    })\\n})\",\"language\":\"typescript\"}],[\"code\",{\"code\":\"name: Node.js CI\\n\\non:\\n  push:\\n    branches: [ \\\"main\\\" ]\\n\\njobs:\\n  build:\\n\\n    runs-on: ubuntu-latest\\n\\n    strategy:\\n      matrix:\\n        node-version: [14.x, 16.x, 18.x]\\n\\n    steps:\\n    - uses: actions/checkout@v3\\n    - name: Use Node.js ${{ matrix.node-version }}\\n      uses: actions/setup-node@v3\\n      with:\\n        node-version: ${{ matrix.node-version }}\\n        cache: 'npm'\\n    - run: npm ci\\n    - run: npm run build --if-present\\n    - run: npm test\\n\",\"language\":\"yml\"}],[\"bookmark\",{\"type\":\"bookmark\",\"url\":\"https://www.codingame.com/training/medium/derivative-time---part2\",\"metadata\":{\"url\":\"https://www.codingame.com/training/medium/derivative-time---part2\",\"title\":\"Coding Games and Programming Challenges to Code Better\",\"description\":\"CodinGame is a challenge-based training platform for programmers where you can play with the hottest programming topics. Solve games, code AI bots, learn from your peers, have fun.\",\"author\":null,\"publisher\":\"CodinGame\",\"thumbnail\":\"https://files.codingame.com/codingame/codingame_share_pics.jpg\",\"icon\":\"https://static.codingame.com/assets/apple-touch-icon-152x152-precomposed.5cb052db.png\"}}],[\"bookmark\",{\"type\":\"bookmark\",\"url\":\"https://github.com/gustawdaniel/codingame-derivative-time-part-1\",\"metadata\":{\"url\":\"https://github.com/gustawdaniel/codingame-derivative-time-part-1\",\"title\":\"GitHub - gustawdaniel/codingame-derivative-time-part-1\",\"description\":\"Contribute to gustawdaniel/codingame-derivative-time-part-1 development by creating an account on GitHub.\",\"author\":\"gustawdaniel\",\"publisher\":\"GitHub\",\"thumbnail\":\"https://opengraph.githubassets.com/f239053bc814122dc1c46e68d764599685c1bcf41c7c4651e8f19786982fa0db/gustawdaniel/codingame-derivative-time-part-1\",\"icon\":\"https://github.githubassets.com/favicons/favicon.svg\"}}]],\"markups\":[[\"code\"],[\"strong\"],[\"a\",[\"href\",\"https://mathworld.wolfram.com/Associative.html\"]],[\"a\",[\"href\",\"https://www.codingame.com/servlet/urlinvite?u=5287657\"]]],\"sections\":[[1,\"p\",[[0,[],0,\"Now we will solve exercise \"],[0,[0],1,\"DERIVATIVE TIME\"],[0,[],0,\":\"]]],[10,0],[1,\"p\",[[0,[],0,\"Our goal is, evaluate the partial derivative of a given formula.\"],[1,[],0,0],[1,[],0,1],[0,[],0,\"For instance, given the function formula \\\"(5*(x*(y^2)))\\\" and \\\"y x\\\", the variables in respect with you must derive it\"]]],[1,\"p\",[[0,[],0,\"So here f(x,y) = 5xy² and you have to calculate:\"]]],[10,1],[1,\"p\",[[0,[],0,\"it gives you the formula 10*y. At last \\\"x 2 y 6\\\" means x=2, y=6, gives you the values with which you must evaluate the obtained derivative. So the answer should be 60\"]]],[1,\"p\",[[0,[1],1,\"Note\"],[1,[],0,2],[0,[],0,\"To simplify the task, only consider \"],[0,[1],1,\"+\"],[0,[],0,\", \"],[0,[1],1,\"*\"],[0,[],0,\" and \"],[0,[1],1,\"^\"],[0,[],0,\". And assume that \"],[0,[1],1,\"+\"],[0,[],0,\", \"],[0,[1],1,\"*\"],[0,[],0,\" and \"],[0,[1],1,\"^\"],[0,[],0,\" always take two arguments and that expressions are fully parenthesized.\"],[1,[],0,3],[1,[],0,4],[0,[],0,\"Negative power has no parenthesis. e.g. (((18*(x^\"],[0,[1],1,\"-1\"],[0,[],0,\"))+y)+z)\"],[1,[],0,5],[1,[],0,6],[0,[],0,\"vars may be in other forms other than x, y, and z. Similar to identifiers in many programming languages, the var would be some letter followed by letters, numbers or underscore.\"],[1,[],0,7],[1,[],0,8],[0,[],0,\"link about calculus rules: \"]]],[10,2],[1,\"p\",[[0,[],0,\"The rules needed here:\"]]],[10,3],[1,\"h1\",[[0,[],0,\"Theoretical introduction to derivatives\"]]],[1,\"p\",[[0,[],0,\"To compute derivative of function we have to represent function as object possible to manipulate. One of possibilities is representing it as an array with operation placed on the beginning and with arguments occupying rest of positions.\"]]],[1,\"p\",[[0,[],0,\"This concept is intensively used in some of languages as Lisp or Scheme. If you do not know Lisp you can easy learn it in \"],[0,[0],1,\"y\"],[0,[],0,\" minutes on page:\"]]],[10,4],[1,\"p\",[[0,[],0,\"So instead of write\"]]],[10,5],[1,\"p\",[[0,[],0,\"in lisp you will write\"]]],[10,6],[1,\"p\",[[0,[],0,\"Our further solution will be heavily based on this concept of ordering. How advantages it have over \"],[0,[0],1,\"a + b\"],[0,[],0,\"? Firstly we can decompose our expressions by\"]]],[10,7],[1,\"p\",[[0,[],0,\"Secondly for \"],[0,[2],1,\"associative\"],[0,[],0,\" operations we can use \"],[0,[0],1,\"reduce\"],[0,[],0,\" function like\"]]],[10,8],[1,\"p\",[[0,[],0,\"In this case \"],[0,[0],1,\"identity\"],[0,[],0,\" is value that will not change result of operation, and \"],[0,[0],1,\"fn\"],[0,[],0,\" is function assigned to \"],[0,[0],1,\"operation\"],[0,[],0,\", eg \"],[0,[0],1,\"(a,b) => a+b\"],[0,[],0,\" for addition.\"]]],[1,\"p\",[[0,[],0,\"Having these basic concept in mind we can consider derivative as function that transform array representing mathematical formula to other array with other formula.\"]]],[1,\"p\",[[0,[],0,\"We know which transformations should be applied to addition, multiplication or powers. We also able to simplify result knowing derivatives of constant or identity function.\"]]],[1,\"p\",[[0,[],0,\"So lets divide our solution to four steps.\"]]],[3,\"ol\",[[[0,[],0,\"Setup project\"]],[[0,[],0,\"Parsing input\"]],[[0,[],0,\"Evaluating values\"]],[[0,[],0,\"Computing derivative\"]]]],[1,\"h2\",[[0,[],0,\"Setup NodeJS typescript project with jest\"]]],[1,\"p\",[[0,[],0,\"Lets init project\"]]],[10,9],[1,\"p\",[[0,[],0,\"in generated \"],[0,[0],1,\"tsconfigl.json\"],[0,[],0,\" we have to set\"]]],[10,10],[1,\"p\",[[0,[],0,\"to be albe to use \"],[0,[0],1,\"Map\"],[0,[],0,\" or other modern data structures or syntax.\"]]],[1,\"p\",[[0,[],0,\"In \"],[0,[0],1,\"package.json\"],[0,[],0,\" we should set\"]]],[10,11],[1,\"p\",[[0,[],0,\"in \"],[0,[0],1,\"scripts\"],[0,[],0,\" section and install required packages.\"]]],[10,12],[1,\"p\",[[0,[],0,\"Now lets create \"],[0,[0],1,\"jest\"],[0,[],0,\" config \"],[0,[0],1,\"jest.config.ts\"]]],[10,13],[1,\"p\",[[0,[],0,\"Finally we can create three files: \"],[0,[0],1,\"lib.ts\"],[0,[],0,\" with:\"]]],[10,14],[1,\"p\",[[0,[],0,\"Test \"],[0,[0],1,\"test/lib.test.ts\"],[0,[],0,\" with\"]]],[10,15],[1,\"p\",[[0,[],0,\"and \"],[0,[0],1,\"index.ts\"],[0,[],0,\" that is responsible for input/output operations\"]]],[10,16],[1,\"p\",[[0,[],0,\"Now we should be able to run program using\"]]],[10,17],[1,\"p\",[[0,[],0,\"and test by command\"]]],[10,18],[1,\"h2\",[[0,[],0,\"Parsing Input and building objects\"]]],[1,\"p\",[[0,[],0,\"Lets see on input\"]]],[1,\"p\",[[0,[],0,\"From content of this exercise we can read that input contains 3 lines:\"]]],[1,\"p\",[[0,[1],1,\"Line 1\"],[0,[],0,\": formula\"],[1,[],0,9],[0,[1],1,\"Line 2\"],[0,[],0,\": list of vars for partial derivative, separated by space, length of the list will be 1, 2 or 3.\"],[1,[],0,10],[0,[1],1,\"Line 3\"],[0,[],0,\": vars' values, paired and separated by space\"]]],[1,\"p\",[[0,[],0,\"Output is the result (always an integer).\"]]],[1,\"p\",[[0,[],0,\"So for example input\"]]],[10,19],[1,\"p\",[[0,[],0,\"we will have derivative by \"],[0,[0],1,\"x\"],[0,[],0,\" giving \"],[0,[0],1,\"(5*y)\"],[0,[],0,\", that in point \"],[0,[0],1,\"{x:2, y:6}\"],[0,[],0,\" is \"],[0,[0],1,\"5*6\"],[0,[],0,\" or simply\"]]],[10,20],[1,\"p\",[[0,[],0,\"Now we will introduce three objects that will refer to these lines:\"]]],[3,\"ul\",[[[0,[],0,\"Formula\"]],[[0,[],0,\"DiffOperator\"]],[[0,[],0,\"Coordinate\"]]]],[1,\"p\",[[0,[],0,\"Generally any of these object should be created basing on his line. Only exception is \"],[0,[0],1,\"Formula\"],[0,[],0,\" that require \"],[0,[0],1,\"variables\"],[0,[],0,\" from \"],[0,[0],1,\"coordinate\"],[0,[],0,\" to recognize on arguments and treat them in a special way.\"]]],[1,\"p\",[[0,[],0,\"Now \"],[0,[0],1,\"run\"],[0,[],0,\" function from \"],[0,[0],1,\"lib.ts\"],[0,[],0,\" can be rewritten as\"]]],[10,21],[1,\"p\",[[0,[],0,\"What can be explained as acting derivative operator on function and evaluating it at given point. It is exactly what we need to do in this task.\"]]],[1,\"p\",[[0,[],0,\"Now we will implement these classes and write some tests for them\"]]],[1,\"h3\",[[0,[],0,\"Coordinate implementation\"]]],[1,\"p\",[[0,[],0,\"Lets start from \"],[0,[0],1,\"coordinate\"]]],[10,22],[1,\"p\",[[0,[],0,\"It simply splits his string \"],[0,[0],1,\"x 2 y 6\"],[0,[],0,\" by spaces and move by pairs setting them as keys and values of internal \"],[0,[0],1,\"Map\"],[0,[],0,\". It can return both list of keys to help in \"],[0,[0],1,\"Formula\"],[0,[],0,\" initialization and get singe value of key that is useful in evaluating.\"]]],[1,\"p\",[[0,[],0,\"tests for coordinate are the following\"]]],[10,23],[1,\"h3\",[[0,[],0,\"Formula initialization\"]]],[1,\"p\",[[0,[],0,\"Next object is formula. We need two additional types\"]]],[10,24],[1,\"p\",[[0,[],0,\"and can write our formula class\"]]],[10,25],[1,\"p\",[[0,[],0,\"following functions will be placed inside of this class. We need constructor that will get formula string and list of variables. To operate on string form of formula we will define two functions:\"]]],[3,\"ul\",[[[0,[0],1,\"decomposeInput(input: string): SubFormula\"]],[[0,[0],1,\"isDecomposable(input: string): boolean\"]]]],[1,\"p\",[[0,[],0,\"Firs will do parsing, second will check if should we expand input to elements or should we left it as atomic part of formula.\"]]],[1,\"p\",[[0,[],0,\"In our case we need to decompose if string starts and ends with brackets and contains operator\"]]],[10,26],[1,\"p\",[[0,[],0,\"Decomposition contains part that prepare three elements \"],[0,[0],1,\"p\"],[0,[],0,\" like previous, \"],[0,[0],1,\"n\"],[0,[],0,\" like next, and operator.\"]]],[10,27],[1,\"p\",[[0,[],0,\"we are using \"],[0,[0],1,\"level\"],[0,[],0,\" to determine which sub bracket level we reaching during loop.\"]]],[1,\"p\",[[0,[],0,\"After loop over all characters and completing \"],[0,[0],1,\"p\"],[0,[],0,\", \"],[0,[0],1,\"n\"],[0,[],0,\", and \"],[0,[0],1,\"operator\"],[0,[],0,\" we have to check if should we decompose or parse these elements using code\"]]],[10,28],[1,\"p\",[[0,[],0,\"after defining these functions we can write constructor\"]]],[10,29],[1,\"p\",[[0,[],0,\"and test for them\"]]],[10,30],[1,\"h3\",[[0,[],0,\"DiffOperator (derivateve) initialization\"]]],[1,\"p\",[[0,[],0,\"Fortunatelly derivative is super easy to construct\"]]],[10,31],[1,\"p\",[[0,[],0,\"inside we want to store array of variables names that we will use seqentially acting on given function.\"]]],[1,\"p\",[[0,[],0,\"We can skip tests for it and go to next part - Evaluating values\"]]],[1,\"h2\",[[0,[],0,\"Evaluating values\"]]],[1,\"p\",[[0,[],0,\"Now we still will write code in \"],[0,[0],1,\"Formula\"],[0,[],0,\" class. \"]]],[1,\"p\",[[0,[],0,\"Our computing function will be able to call themself many times so to simply their interface we will split computation to:\"]]],[10,32],[1,\"p\",[[0,[],0,\"and\"]]],[10,33],[1,\"p\",[[0,[],0,\"first one will be used to operate directly on \"],[0,[0],1,\"SubFormula\"],[0,[],0,\", but second will be layer that was applied in \"],[0,[0],1,\"run\"],[0,[],0,\" in expression\"]]],[10,34],[1,\"p\",[[0,[],0,\"evaluate can be defined as\"]]],[10,35],[1,\"p\",[[0,[],0,\"But \"],[0,[0],1,\"compute\"],[0,[],0,\" should start from classification of his argument. It can be expression, then \"],[0,[0],1,\"Array.isArray(f)\"],[0,[],0,\" will be true, number, then this number should be returned od name of coordinate, then coordinate saved in \"],[0,[0],1,\"point\"],[0,[],0,\" can be returned.\"]]],[1,\"p\",[[0,[],0,\"Our code will be the following\"]]],[10,36],[1,\"p\",[[0,[],0,\"Most interesting is case when, \"],[0,[0],1,\"f\"],[0,[],0,\" is array. Then using theory from introduction we should decompose it to operator and arguments;\"]]],[10,37],[1,\"p\",[[0,[],0,\"and in next step in dependence from \"],[0,[0],1,\"operator\"],[0,[],0,\" arguments can be processed by different functions:\"]]],[10,38],[1,\"p\",[[0,[],0,\"For associative operations like \"],[0,[0],1,\"*\"],[0,[],0,\" and \"],[0,[0],1,\"+\"],[0,[],0,\" with existing identity value we used \"],[0,[0],1,\"reduce\"],[0,[],0,\". But for rest cases we assumed that there are two arguments and used destructuring.\"]]],[1,\"p\",[[0,[],0,\"To prove that it works we can add the following test to \"],[0,[0],1,\"formula\"],[0,[],0,\" section\"]]],[10,39],[1,\"p\",[[0,[],0,\"our formula defined ealier was \"],[0,[0],1,\"(5*(x*y))\"],[0,[],0,\" so we expect result \"],[0,[0],1,\"10\"],[0,[],0,\".\"]]],[1,\"p\",[[0,[],0,\"If you following all these concepts to this point, then next step will be easy logical continuation for you.\"]]],[1,\"h2\",[[0,[],0,\"Computing derivative\"]]],[1,\"p\",[[0,[],0,\"Computing derivative will be done in the same style like evaluating value of function. We will split it on two methods Dynamic \"],[0,[0],1,\"actOn\"],[0,[],0,\" with interface\"]]],[10,40],[1,\"p\",[[0,[],0,\"and static internal function\"]]],[10,41],[1,\"p\",[[0,[],0,\"First one will iterate over all directions saved in \"],[0,[0],1,\"d\"],[0,[],0,\" property. Second is first order derivative in direction passed by second argument. These functions works also on other levels: \"],[0,[0],1,\"actOn\"],[0,[],0,\" will use \"],[0,[0],1,\"Formula\"],[0,[],0,\" abstraction, but \"],[0,[0],1,\"derivative\"],[0,[],0,\" need and return \"],[0,[0],1,\"SubFormula\"],[0,[],0,\" to operate on more low level structure.\"]]],[1,\"p\",[[0,[],0,\"We will introduce also one more static function\"]]],[10,42],[1,\"p\",[[0,[],0,\"that will not need direction and use simple algebra rules to make computation partial results more human readable and easy to process. Simplify will return the same mathematical formula but written in most simple possible manner removing unnecessary additions of \"],[0,[0],1,\"0\"],[0,[],0,\" or multiplications by \"],[0,[0],1,\"1\"],[0,[],0,\".\"]]],[1,\"p\",[[0,[],0,\"Following functions are defined as methods of \"],[0,[0],1,\"DiffOperator\"],[0,[],0,\". \"]]],[1,\"h3\",[[0,[],0,\"Simplification of formula\"]]],[1,\"p\",[[0,[],0,\"Lets start from \"],[0,[0],1,\"simplify\"],[0,[],0,\" because of I started to explain it. To simplify formulas we will apply the folowing rules:\"]]],[3,\"ul\",[[[0,[],0,\"all subarguments should be simplified (recursive)\"]],[[0,[],0,\"if all subarguments are numbers, they should be computed\"]],[[0,[],0,\"if one of argument is \"],[0,[0],1,\"0\"],[0,[],0,\" or \"],[0,[0],1,\"1\"],[0,[],0,\" special treatment of second argument should be applied in dependence from \"],[0,[0],1,\"operator\"]]]],[1,\"p\",[[0,[],0,\"Code that implement described behavior is\"]]],[10,43],[1,\"h3\",[[0,[],0,\"Derivative of formula\"]]],[1,\"p\",[[0,[],0,\"To define derivative of first order on given direction:\"]]],[10,44],[1,\"p\",[[0,[],0,\"we have to assume that we can compute it on\"]]],[3,\"ul\",[[[0,[],0,\"expression\"]],[[0,[],0,\"our variable\"]],[[0,[],0,\"constant\"]]]],[1,\"p\",[[0,[],0,\"If it is executed on variable or constant then result will be \"],[0,[0],1,\"1\"],[0,[],0,\" or \"],[0,[0],1,\"0\"],[0,[],0,\", but on expression we have to check \"],[0,[0],1,\"operator\"],[0,[],0,\" and decide which rule should we apply. This part is exactly the same concept as with evaluation, but we returns arrays with operators that represents functions instead of numbers. Code below:\"]]],[10,45],[1,\"p\",[[0,[],0,\"we can see that only with powers there is a little confuction, because of I decided to evaluate subtraction \"],[0,[0],1,\"1\"],[0,[],0,\" on power if it is number. I decided to skip support for \"],[0,[0],1,\"a^x\"],[0,[],0,\" because of it is exponential function that is out of scope of first part of this exercise.\"]]],[1,\"p\",[[0,[],0,\"Finally to implement \"],[0,[0],1,\"actOn\"],[0,[],0,\" we will need clone of formula, so on formula we should implement\"]]],[10,46],[1,\"p\",[[0,[],0,\"and then on \"],[0,[0],1,\"DiffOperator\"]]],[10,47],[1,\"p\",[[0,[],0,\"to write stable, editable and working code we should add tests\"]]],[10,48],[1,\"p\",[[0,[],0,\"Finally all elements of program works so we can add also \"],[0,[0],1,\"e2e\"],[0,[],0,\" tests on \"],[0,[0],1,\"run\"],[0,[],0,\" function\"]]],[10,49],[1,\"p\",[[0,[],0,\"and proper github workflow\"]]],[10,50],[1,\"h2\",[[0,[],0,\"Further steps\"]]],[1,\"p\",[[0,[],0,\"In codingame there is also second part of this exercise:\"]]],[10,51],[1,\"p\",[[0,[],0,\"that will include trigonometric functions, logarithm, exponent and even the chain rule.\"]]],[1,\"p\",[[0,[],0,\"You can invite me to your friends on this platform using link:\"]]],[1,\"p\",[[0,[3],1,\"https://www.codingame.com/servlet/urlinvite?u=5287657\"]]],[1,\"p\",[[0,[],0,\"You can find all presented code on my github:\"]]],[10,52],[1,\"p\",[]]],\"ghostVersion\":\"4.0\"}","html":"<p>Now we will solve exercise <code>DERIVATIVE TIME</code>:</p><figure class=\"kg-card kg-bookmark-card\"><a class=\"kg-bookmark-container\" href=\"https://www.codingame.com/training/medium/derivative-time---part1\"><div class=\"kg-bookmark-content\"><div class=\"kg-bookmark-title\">Coding Games and Programming Challenges to Code Better</div><div class=\"kg-bookmark-description\">CodinGame is a challenge-based training platform for programmers where you can play with the hottest programming topics. Solve games, code AI bots, learn from your peers, have fun.</div><div class=\"kg-bookmark-metadata\"><img class=\"kg-bookmark-icon\" src=\"https://static.codingame.com/assets/apple-touch-icon-152x152-precomposed.5cb052db.png\"><span class=\"kg-bookmark-author\">CodinGame</span></div></div><div class=\"kg-bookmark-thumbnail\"><img src=\"https://files.codingame.com/codingame/codingame_share_pics.jpg\"></div></a></figure><p>Our goal is, evaluate the partial derivative of a given formula.<br><br>For instance, given the function formula \"(5*(x*(y^2)))\" and \"y x\", the variables in respect with you must derive it</p><p>So here f(x,y) = 5xy² and you have to calculate:</p><pre><code>   d²f(x,y)   \n  ----------\n    dxdy</code></pre><p>it gives you the formula 10*y. At last \"x 2 y 6\" means x=2, y=6, gives you the values with which you must evaluate the obtained derivative. So the answer should be 60</p><p><strong>Note</strong><br>To simplify the task, only consider <strong>+</strong>, <strong>*</strong> and <strong>^</strong>. And assume that <strong>+</strong>, <strong>*</strong> and <strong>^</strong> always take two arguments and that expressions are fully parenthesized.<br><br>Negative power has no parenthesis. e.g. (((18*(x^<strong>-1</strong>))+y)+z)<br><br>vars may be in other forms other than x, y, and z. Similar to identifiers in many programming languages, the var would be some letter followed by letters, numbers or underscore.<br><br>link about calculus rules: </p><figure class=\"kg-card kg-bookmark-card\"><a class=\"kg-bookmark-container\" href=\"https://en.wikipedia.org/wiki/Differentiation_rules\"><div class=\"kg-bookmark-content\"><div class=\"kg-bookmark-title\">Differentiation rules - Wikipedia</div><div class=\"kg-bookmark-description\"></div><div class=\"kg-bookmark-metadata\"><img class=\"kg-bookmark-icon\" src=\"https://en.wikipedia.org/static/apple-touch/wikipedia.png\"><span class=\"kg-bookmark-author\">Wikimedia Foundation, Inc.</span><span class=\"kg-bookmark-publisher\">Contributors to Wikimedia projects</span></div></div><div class=\"kg-bookmark-thumbnail\"><img src=\"https://wikimedia.org/api/rest_v1/media/math/render/svg/86a67b81c2de995bd608d5b2df50cd8cd7d92455\"></div></a></figure><p>The rules needed here:</p><pre><code>a'=0\n(a*x)'=a\n(x^a)'=a*x^(a-1) (when a is not 0)\n(u+v)'=u'+v'\n(u*v)'=u'*v+v'*u</code></pre><h1 id=\"theoretical-introduction-to-derivatives\">Theoretical introduction to derivatives</h1><p>To compute derivative of function we have to represent function as object possible to manipulate. One of possibilities is representing it as an array with operation placed on the beginning and with arguments occupying rest of positions.</p><p>This concept is intensively used in some of languages as Lisp or Scheme. If you do not know Lisp you can easy learn it in <code>y</code> minutes on page:</p><figure class=\"kg-card kg-bookmark-card\"><a class=\"kg-bookmark-container\" href=\"https://learnxinyminutes.com/docs/common-lisp/\"><div class=\"kg-bookmark-content\"><div class=\"kg-bookmark-title\">Learn Common Lisp in Y Minutes</div><div class=\"kg-bookmark-description\"></div><div class=\"kg-bookmark-metadata\"></div></div><div class=\"kg-bookmark-thumbnail\"><img src=\"https://i.creativecommons.org/l/by-sa/3.0/88x31.png\"></div></a></figure><p>So instead of write</p><pre><code>a + b</code></pre><p>in lisp you will write</p><pre><code>(+ a b)</code></pre><p>Our further solution will be heavily based on this concept of ordering. How advantages it have over <code>a + b</code>? Firstly we can decompose our expressions by</p><pre><code class=\"language-typescript\">const [operation, ...arguments] = expression;</code></pre><p>Secondly for <a href=\"https://mathworld.wolfram.com/Associative.html\">associative</a> operations we can use <code>reduce</code> function like</p><pre><code>const res = arguments.reduce(fn, identity);</code></pre><p>In this case <code>identity</code> is value that will not change result of operation, and <code>fn</code> is function assigned to <code>operation</code>, eg <code>(a,b) =&gt; a+b</code> for addition.</p><p>Having these basic concept in mind we can consider derivative as function that transform array representing mathematical formula to other array with other formula.</p><p>We know which transformations should be applied to addition, multiplication or powers. We also able to simplify result knowing derivatives of constant or identity function.</p><p>So lets divide our solution to four steps.</p><ol><li>Setup project</li><li>Parsing input</li><li>Evaluating values</li><li>Computing derivative</li></ol><h2 id=\"setup-nodejs-typescript-project-with-jest\">Setup NodeJS typescript project with jest</h2><p>Lets init project</p><pre><code>npm init -y\ntsc --init</code></pre><p>in generated <code>tsconfigl.json</code> we have to set</p><pre><code>\"target\": \"ESNext\",</code></pre><p>to be albe to use <code>Map</code> or other modern data structures or syntax.</p><p>In <code>package.json</code> we should set</p><pre><code>\"test\": \"jest\"</code></pre><p>in <code>scripts</code> section and install required packages.</p><pre><code>npm i -D @types/jest @types/node esbuild-jest jest ts-node typescript</code></pre><p>Now lets create <code>jest</code> config <code>jest.config.ts</code></p><pre><code class=\"language-typescript\">module.exports = {\n    roots: ['&lt;rootDir&gt;'],\n    testMatch: ['**/__tests__/**/*.+(ts|tsx)', '**/?(*.)+(spec|test).+(ts|tsx)'],\n    transform: {\n        '^.+\\\\.(ts|tsx)$': 'esbuild-jest',\n    },\n    setupFilesAfterEnv: [],\n    testEnvironment: 'node',\n}\n</code></pre><p>Finally we can create three files: <code>lib.ts</code> with:</p><pre><code class=\"language-typescript\">export function run(input: string): string {\n    return ''\n}\n</code></pre><p>Test <code>test/lib.test.ts</code> with</p><pre><code class=\"language-typescript\">import {run} from \"../lib\";\n\ndescribe('e2e', () =&gt; {\n    it('temporary', () =&gt; {\n        expect(run('')).toEqual('')\n    })\n});</code></pre><p>and <code>index.ts</code> that is responsible for input/output operations</p><pre><code class=\"language-typescript\">import {run} from \"./lib\";\n\nprocess.stdin.on('data', (buff) =&gt; {\n    const input = buff.toString();\n    process.stdout.write(run(input));\n})\n</code></pre><p>Now we should be able to run program using</p><pre><code>echo '' | ts-node index.ts</code></pre><p>and test by command</p><pre><code>npm run test</code></pre><h2 id=\"parsing-input-and-building-objects\">Parsing Input and building objects</h2><p>Lets see on input</p><p>From content of this exercise we can read that input contains 3 lines:</p><p><strong>Line 1</strong>: formula<br><strong>Line 2</strong>: list of vars for partial derivative, separated by space, length of the list will be 1, 2 or 3.<br><strong>Line 3</strong>: vars' values, paired and separated by space</p><p>Output is the result (always an integer).</p><p>So for example input</p><pre><code>(5*(x*y))\nx\nx 2 y 6</code></pre><p>we will have derivative by <code>x</code> giving <code>(5*y)</code>, that in point <code>{x:2, y:6}</code> is <code>5*6</code> or simply</p><pre><code>30</code></pre><p>Now we will introduce three objects that will refer to these lines:</p><ul><li>Formula</li><li>DiffOperator</li><li>Coordinate</li></ul><p>Generally any of these object should be created basing on his line. Only exception is <code>Formula</code> that require <code>variables</code> from <code>coordinate</code> to recognize on arguments and treat them in a special way.</p><p>Now <code>run</code> function from <code>lib.ts</code> can be rewritten as</p><pre><code class=\"language-typescript\">export function run(input: string): string {\n    const [F, vs, dict] = input.split('\\n');\n    const point = new Coordinate(dict);\n    const diff = new DiffOperator(vs);\n    const formula = new Formula(F, point.variables);\n\n    return diff.actOn(formula).evaluate(point).toString();\n}\n</code></pre><p>What can be explained as acting derivative operator on function and evaluating it at given point. It is exactly what we need to do in this task.</p><p>Now we will implement these classes and write some tests for them</p><h3 id=\"coordinate-implementation\">Coordinate implementation</h3><p>Lets start from <code>coordinate</code></p><pre><code class=\"language-typescript\">export class Coordinate {\n    map: Map&lt;string, number&gt; = new Map();\n\n    constructor(input: string) {\n        const pairs = input.split(' ');\n        for (let i = 0; i &lt; pairs.length / 2; i++) {\n            const [key, value] = [pairs[i * 2], Number.parseFloat(pairs[i * 2 + 1])];\n            this.map.set(key, value);\n        }\n    }\n\n    get variables(): string[] {\n        return [...this.map.keys()]\n    }\n\n    get(name): number {\n        return this.map.get(name) ?? 0;\n    }\n}</code></pre><p>It simply splits his string <code>x 2 y 6</code> by spaces and move by pairs setting them as keys and values of internal <code>Map</code>. It can return both list of keys to help in <code>Formula</code> initialization and get singe value of key that is useful in evaluating.</p><p>tests for coordinate are the following</p><pre><code class=\"language-typescript\">describe('coordinate', () =&gt; {\n    it('parsing', () =&gt; {\n        const point = new Coordinate('x 2 y 6');\n        expect(point.variables).toEqual(['x', 'y']);\n        expect(point.get('x')).toEqual(2);\n        expect(point.get('y')).toEqual(6);\n        expect(point.get('undefined')).toEqual(0);\n    })\n})</code></pre><h3 id=\"formula-initialization\">Formula initialization</h3><p>Next object is formula. We need two additional types</p><pre><code class=\"language-typescript\">type Operator = '*' | '^' | '+' | '-';\ntype SubFormula = Array&lt;string | number | SubFormula&gt; | string | number</code></pre><p>and can write our formula class</p><pre><code class=\"language-typescript\">export class Formula {\n    f: SubFormula;\n    v: string[] = [];\n}</code></pre><p>following functions will be placed inside of this class. We need constructor that will get formula string and list of variables. To operate on string form of formula we will define two functions:</p><ul><li><code>decomposeInput(input: string): SubFormula</code></li><li><code>isDecomposable(input: string): boolean</code></li></ul><p>Firs will do parsing, second will check if should we expand input to elements or should we left it as atomic part of formula.</p><p>In our case we need to decompose if string starts and ends with brackets and contains operator</p><pre><code class=\"language-typescript\">    isDecomposable(input: string): boolean {\n        return input.startsWith('(') &amp;&amp; input.endsWith(')') &amp;&amp; /[*^+-]/.test(input)\n    }</code></pre><p>Decomposition contains part that prepare three elements <code>p</code> like previous, <code>n</code> like next, and operator.</p><pre><code class=\"language-typescript\">decomposeInput(input: string): SubFormula {\n        let p: SubFormula = '', operator: Operator | '' = '', n: SubFormula = '', level: number = 0;\n        if (!this.isDecomposable(input)) return [0];\n        for (let i = 1; i &lt; input.length - 1; i++) {\n            if (level === 0 &amp;&amp; !operator &amp;&amp; /[*^+-]/.test(input[i])) {\n                operator = input[i] as Operator;\n                continue;\n            } else if (input[i] === '(') {\n                level++;\n            } else if (input[i] === ')') {\n                level--;\n            }\n            if (operator) {\n                n += input[i];\n            } else {\n                p += input[i];\n            }\n        }</code></pre><p>we are using <code>level</code> to determine which sub bracket level we reaching during loop.</p><p>After loop over all characters and completing <code>p</code>, <code>n</code>, and <code>operator</code> we have to check if should we decompose or parse these elements using code</p><pre><code class=\"language-typescript\">        if (this.isDecomposable(p)) {\n            p = this.decomposeInput(p);\n        } else {\n            if (!this.v.includes(p)) {\n                p = Number.parseFloat(p);\n            }\n        }\n        if (this.isDecomposable(n)) {\n            n = this.decomposeInput(n);\n        } else {\n            if (!this.v.includes(n)) {\n                n = Number.parseFloat(n);\n            }\n        }\n        return [operator, p, n];\n    }</code></pre><p>after defining these functions we can write constructor</p><pre><code class=\"language-typescript\">    constructor(input: string, variables: string[]) {\n        this.v = variables;\n        this.f = this.decomposeInput(input);\n    }</code></pre><p>and test for them</p><pre><code class=\"language-typescript\">describe('formula', () =&gt; {\n    const f = new Formula('(5*(x*y))', ['x', 'y']);\n\n    it('parse', () =&gt; {\n        expect(f.f).toEqual(['*', 5, ['*', 'x', 'y']]);\n        expect(f.v).toEqual(['x', 'y']);\n    });\n\n    it('parse with many brackets', () =&gt; {\n        const f = new Formula('((x^3)+(x^2))', ['x']);\n        expect(f.f).toEqual(['+', ['^', 'x', 3], ['^', 'x', 2]])\n    })\n})</code></pre><h3 id=\"diffoperator-derivateve-initialization\">DiffOperator (derivateve) initialization</h3><p>Fortunatelly derivative is super easy to construct</p><pre><code class=\"language-typescript\">export class DiffOperator {\n    d: string[] = [];\n\n    constructor(input: string) {\n        this.d = input.split(' ');\n    }\n}</code></pre><p>inside we want to store array of variables names that we will use seqentially acting on given function.</p><p>We can skip tests for it and go to next part - Evaluating values</p><h2 id=\"evaluating-values\">Evaluating values</h2><p>Now we still will write code in <code>Formula</code> class. </p><p>Our computing function will be able to call themself many times so to simply their interface we will split computation to:</p><pre><code class=\"language-typescript\">static compute(f: SubFormula | string | number, point: Coordinate): number</code></pre><p>and</p><pre><code class=\"language-typescript\">evaluate(point: Coordinate): number </code></pre><p>first one will be used to operate directly on <code>SubFormula</code>, but second will be layer that was applied in <code>run</code> in expression</p><pre><code class=\"language-typescript\">diff.actOn(formula).evaluate(point)</code></pre><p>evaluate can be defined as</p><pre><code class=\"language-typescript\">    evaluate(point: Coordinate): number {\n        return Formula.compute(this.f, point);\n    }</code></pre><p>But <code>compute</code> should start from classification of his argument. It can be expression, then <code>Array.isArray(f)</code> will be true, number, then this number should be returned od name of coordinate, then coordinate saved in <code>point</code> can be returned.</p><p>Our code will be the following</p><pre><code class=\"language-typescript\">    static compute(f: SubFormula | string | number, point: Coordinate): number {\n        if (Array.isArray(f)) {\n            // ... TO BE DEFINED IN NEXT STEP\n        } else if (typeof f === 'number') {\n            return f;\n        } else {\n            return point.get(f);\n        }\n    }</code></pre><p>Most interesting is case when, <code>f</code> is array. Then using theory from introduction we should decompose it to operator and arguments;</p><pre><code class=\"language-typescript\">const [op, ...rest] = f;</code></pre><p>and in next step in dependence from <code>operator</code> arguments can be processed by different functions:</p><pre><code class=\"language-typescript\">switch (op) {\n    case '+':\n        return &lt;number&gt;rest.reduce((p: number, n: SubFormula): number =&gt; p + this.compute(n, point), 0);\n    case '*':\n        return &lt;number&gt;rest.reduce((p: number, n: SubFormula): number =&gt; p * this.compute(n, point), 1);\n    case '^': {\n        const [p, n] = rest;\n        return Math.pow(this.compute(p, point), this.compute(n, point));\n    }\n    case '-': {\n        const [p, n] = rest;\n        return this.compute(p,point) - this.compute(n, point);\n    }\n    default:\n        return 0;\n}</code></pre><p>For associative operations like <code>*</code> and <code>+</code> with existing identity value we used <code>reduce</code>. But for rest cases we assumed that there are two arguments and used destructuring.</p><p>To prove that it works we can add the following test to <code>formula</code> section</p><pre><code class=\"language-typescript\">    it('evaluate', () =&gt; {\n        expect(f.evaluate(new Coordinate('x 1 y 2'))).toStrictEqual(10);\n    });</code></pre><p>our formula defined ealier was <code>(5*(x*y))</code> so we expect result <code>10</code>.</p><p>If you following all these concepts to this point, then next step will be easy logical continuation for you.</p><h2 id=\"computing-derivative\">Computing derivative</h2><p>Computing derivative will be done in the same style like evaluating value of function. We will split it on two methods Dynamic <code>actOn</code> with interface</p><pre><code class=\"language-typescript\">actOn(f: Formula): Formula</code></pre><p>and static internal function</p><pre><code class=\"language-typescript\">static derivative(s: SubFormula, dir: string): SubFormula</code></pre><p>First one will iterate over all directions saved in <code>d</code> property. Second is first order derivative in direction passed by second argument. These functions works also on other levels: <code>actOn</code> will use <code>Formula</code> abstraction, but <code>derivative</code> need and return <code>SubFormula</code> to operate on more low level structure.</p><p>We will introduce also one more static function</p><pre><code class=\"language-typescript\">static simplify(s: SubFormula): SubFormula </code></pre><p>that will not need direction and use simple algebra rules to make computation partial results more human readable and easy to process. Simplify will return the same mathematical formula but written in most simple possible manner removing unnecessary additions of <code>0</code> or multiplications by <code>1</code>.</p><p>Following functions are defined as methods of <code>DiffOperator</code>. </p><h3 id=\"simplification-of-formula\">Simplification of formula</h3><p>Lets start from <code>simplify</code> because of I started to explain it. To simplify formulas we will apply the folowing rules:</p><ul><li>all subarguments should be simplified (recursive)</li><li>if all subarguments are numbers, they should be computed</li><li>if one of argument is <code>0</code> or <code>1</code> special treatment of second argument should be applied in dependence from <code>operator</code></li></ul><p>Code that implement described behavior is</p><pre><code class=\"language-typescript\">    static simplify(s: SubFormula): SubFormula {\n        if (Array.isArray(s)) {\n            const [op, ...rest] = s;\n            for (let i = 0; i &lt; rest.length; i++) {\n                rest[i] = this.simplify(rest[i]);\n            }\n            if (rest.every((r) =&gt; typeof r === 'number')) {\n                return Formula.compute(s, new Coordinate(''));\n            }\n            if (rest[0] === 0) {\n                if (op === '+') return rest[1]\n                if (op === '*') return 0\n                if (op === '^') return 0\n            }\n            if (rest[0] === 1) {\n                if (op === '*') return rest[1]\n                if (op === '^') return 1\n            }\n            if (rest[1] === 0) {\n                if (op === '+') return rest[0]\n                if (op === '*') return 0\n                if (op === '^') return 1\n            }\n            if (rest[1] === 1) {\n                if (op === '*') return rest[0]\n                if (op === '^') return rest[0]\n            }\n            return [op, ...rest];\n        } else {\n            return s;\n        }\n    }</code></pre><h3 id=\"derivative-of-formula\">Derivative of formula</h3><p>To define derivative of first order on given direction:</p><pre><code class=\"language-typescript\">static derivative(s: SubFormula, dir: string): SubFormula</code></pre><p>we have to assume that we can compute it on</p><ul><li>expression</li><li>our variable</li><li>constant</li></ul><p>If it is executed on variable or constant then result will be <code>1</code> or <code>0</code>, but on expression we have to check <code>operator</code> and decide which rule should we apply. This part is exactly the same concept as with evaluation, but we returns arrays with operators that represents functions instead of numbers. Code below:</p><pre><code class=\"language-typescript\">    static derivative(s: SubFormula, dir: string): SubFormula {\n        if (Array.isArray(s)) {\n            const [op, p, n] = s;\n            switch (op) {\n                case '*':\n                    return ['+', ['*', p, this.derivative(n, dir)], ['*', this.derivative(p, dir), n]];\n                case '+':\n                    return ['+', this.derivative(p, dir), this.derivative(n, dir)];\n                case '-':\n                    return ['-', this.derivative(p, dir), this.derivative(n, dir)];\n                case '^': {\n                    if (p === dir) {\n                        if (n === 0) return 0;\n                        return typeof n === 'number' ? ['*', n, ['^', p, n - 1]] : ['*', n, ['^', p, ['+', n, -1]]]\n                    } else {\n                        return 0;\n                    }\n                }\n            }\n\n        } else if (typeof s === 'string' &amp;&amp; s === dir) {\n            return 1\n        } else {\n            return 0;\n        }\n    }</code></pre><p>we can see that only with powers there is a little confuction, because of I decided to evaluate subtraction <code>1</code> on power if it is number. I decided to skip support for <code>a^x</code> because of it is exponential function that is out of scope of first part of this exercise.</p><p>Finally to implement <code>actOn</code> we will need clone of formula, so on formula we should implement</p><pre><code class=\"language-typescript\">    clone(): Formula {\n        const o = new Formula('', []);\n        o.f = JSON.parse(JSON.stringify(this.f));\n        o.v = JSON.parse(JSON.stringify(this.f));\n        return o;\n    }</code></pre><p>and then on <code>DiffOperator</code></p><pre><code class=\"language-typescript\">    actOn(f: Formula): Formula {\n        const o = f.clone();\n        return this.d.reduce((p, n) =&gt; {\n            o.f = DiffOperator.simplify(DiffOperator.derivative(p.f, n));\n            return o;\n        }, o);\n    }</code></pre><p>to write stable, editable and working code we should add tests</p><pre><code class=\"language-typescript\">describe('diff operation', () =&gt; {\n    it('simplify', () =&gt; {\n        expect(DiffOperator.simplify([\"+\", [\"*\", 1, 0], [\"*\", 0, 1]])).toEqual(0);\n        expect(DiffOperator.simplify(['^', 'x', 1])).toEqual('x');\n        expect(DiffOperator.simplify(['*', 2, ['^', 'x', 1]])).toEqual(['*', 2, 'x']);\n        expect(DiffOperator.simplify([\"*\", 5, [\"+\", [\"*\", \"x\", 0], [\"*\", 1, \"y\"]]])).toEqual(['*', 5, 'y'])\n        expect(DiffOperator.simplify([\"+\", [\"*\", 5, [\"+\", [\"*\", \"x\", 0], [\"*\", 1, \"y\"]]], [\"*\", 0, [\"*\", \"x\", \"y\"]]])).toEqual(['*', 5, 'y'])\n    });\n    it('derivative', () =&gt; {\n        expect(DiffOperator.simplify(DiffOperator.derivative(['*', 2, 'x'], 'x'))).toEqual(2);\n        expect(DiffOperator.simplify(DiffOperator.derivative(['*', 5, ['*', 'x', 'y']], 'x'))).toEqual(['*', 5, 'y'])\n    })\n    it(\"a'=0\", () =&gt; {\n        const f = new Formula('(1*1)', ['x']);\n        const d = new DiffOperator('x');\n        expect(d.actOn(f).f).toEqual(0);\n    });\n    it(\"(a*x)'=a\", () =&gt; {\n        const f = new Formula('(4*x)', ['x']);\n        const d = new DiffOperator('x');\n        expect(d.actOn(f).f).toEqual(4);\n    });\n    it(\"(x^a)'=a*x^(a-1) (when a is not 0)\", () =&gt; {\n        const cases = [\n            {in: '(x^5)', out: ['*', 5, ['^', 'x', 4]]},\n            {in: '(x^3)', out: ['*', 3, ['^', 'x', 2]]},\n            {in: '(x^2)', out: ['*', 2, 'x']},\n        ];\n        for (const c of cases) {\n            const f = new Formula(c.in, ['x']);\n            const d = new DiffOperator('x');\n            expect(d.actOn(f).f).toEqual(c.out);\n        }\n    });\n    it(\"(u+v)'=u'+v for (x+(x^2))'\", () =&gt; {\n        const f = new Formula('(x+(x^2))', ['x']);\n        const d = new DiffOperator('x');\n        expect(d.actOn(f).f).toEqual(['+', 1, ['*', 2, 'x']]);\n    });\n\n    it(\"(u+v)'=u'+v'\", () =&gt; {\n        const f = new Formula('((x^3)+(x^2))', ['x']);\n        const d = new DiffOperator('x');\n        console.log(\"f\", f);\n        expect(d.actOn(f).f).toEqual(['+', ['*', 3, ['^', 'x', 2]], ['*', 2, 'x']]);\n    });\n    it(\"(u*v)'=u'*v+v'*u\", () =&gt; {\n        const f = new Formula('(x*x)', ['x']);\n        const d = new DiffOperator('x');\n        console.log(\"f\", f);\n        expect(d.actOn(f).f).toEqual(['+', 'x', 'x']);\n    });\n\n    it('d(8*(y^x))/dy', () =&gt; {\n        const f = new Formula('(8*(y^x))', ['x', 'y']);\n        expect(f.f).toEqual(['*', 8, ['^', 'y', 'x']]);\n        expect(DiffOperator.simplify(DiffOperator.derivative(['*', 8, ['^', 'y', 'x']], 'y'))).toEqual(['*', 8, ['*', 'x', ['^', 'y', ['+', 'x', -1]]]]);\n    })\n\n    it('(18*(x^-1))',() =&gt; {\n        const f = new Formula('(18*(x^-1))', ['x']);\n        expect(f.f).toEqual(['*', 18, ['^', 'x', -1]]);\n        expect(DiffOperator.simplify(DiffOperator.derivative(f.f, 'x'))).toEqual( ['*', 18, ['*', -1, ['^', 'x', -2]]]);\n    });\n\n    it('d(((x^2)+(2*(z^5)))+(((18*(x^-1))+y)+z))/dx', () =&gt; {\n        const f = new Formula('(((x^2)+(2*(z^5)))+(((18*(x^-1))+y)+z))', ['x', 'y', 'z']);\n        expect(DiffOperator.simplify(DiffOperator.derivative(f.f, 'x'))).toEqual(['+', ['*', 2, 'x'], ['*', 18, ['*', -1, ['^', 'x', -2]]]]);\n    })\n})</code></pre><p>Finally all elements of program works so we can add also <code>e2e</code> tests on <code>run</code> function</p><pre><code class=\"language-typescript\">describe('e2e', () =&gt; {\n    it('easy multiply', () =&gt; {\n        expect(run('(5*(x*y))\\nx\\nx 2 y 6')).toEqual('30')\n    })\n    it(\"second derivative\", () =&gt; {\n        expect(run('(5*((x^4)*(y^2)))\\nx x\\nx 2 y 6')).toEqual('8640')\n    })\n    it(\"second derivative mix\", () =&gt; {\n        expect(run('(5*(x*(y^2)))\\ny x\\nx 2 y 6')).toEqual('60')\n    })\n    it(\"power with number\", () =&gt; {\n        expect(run('((x^2)+(9*(x+y)))\\nx\\nx 1 y 2')).toEqual('11')\n    })\n    it(\"power with variable\", () =&gt; {\n        expect(run('(8*(y^x))\\ny y\\nx -1 y 2')).toEqual('2')\n    })\n    it(\"3 variables\", () =&gt; {\n        expect(run('(((x^2)+(2*(z^5)))+((x+y)+z))\\nz\\nx 2 y 3 z 4')).toEqual('2561')\n    })\n    it(\"fraction\", () =&gt; {\n        expect(run('(((x^2)+(2*(z^5)))+(((18*(x^-1))+y)+z))\\nx\\nx 3 y 4 z 1')).toEqual('4')\n    })\n    it(\"longer multiply\", () =&gt; {\n        expect(run('(((x^2)*(2*(z^5)))*((x+y)+z))\\nz\\nx 1 y 1 z 1')).toEqual('32')\n    })\n    it(\"3rd derivative\", () =&gt; {\n        expect(run('(((y^6)*(z^5))*(((3*(x^4))+y)+z))\\ny y z\\nx 1 y 1 z 2')).toEqual('16320')\n    })\n    it(\"some Greek ;)\", () =&gt; {\n        expect(run('(((Beta^6)*(Gamma^5))*(((3*(Alpha^4))+Beta)+Gamma))\\nBeta Beta Gamma\\nAlpha 1 Beta 1 Gamma 2')).toEqual('16320')\n    })\n    it(\"maybe not xyz ;)\", () =&gt; {\n        expect(run('(((x2^6)*(x3^5))*(((3*(x1^4))+x2)+x3))\\nx2 x2 x3\\nx1 1 x2 1 x3 2')).toEqual('16320')\n    })\n    it(\"some Vars ;)))\", () =&gt; {\n        expect(run('(((Var_2^6)*(Var_3^5))*(((3*(Var_1^4))+Var_2)+Var_3))\\nVar_2 Var_2 Var_3\\nVar_1 1 Var_2 1 Var_3 2')).toEqual('16320')\n    })\n    it(\"bigger constants\", () =&gt; {\n        expect(run('(50*((x^40)*(y^20)))\\nx x\\nx 1 y 1')).toEqual('78000')\n    })\n    it(\"bigger power\", () =&gt; {\n        expect(run('(x^(y^10))\\nx x\\nx 1 y 2')).toEqual('1047552')\n    })\n    it(\"cannot find\", () =&gt; {\n        expect(run('(5*(x*(y^2)))\\nz\\nx 2 y 6')).toEqual('0')\n    })\n})</code></pre><p>and proper github workflow</p><pre><code class=\"language-yml\">name: Node.js CI\n\non:\n  push:\n    branches: [ \"main\" ]\n\njobs:\n  build:\n\n    runs-on: ubuntu-latest\n\n    strategy:\n      matrix:\n        node-version: [14.x, 16.x, 18.x]\n\n    steps:\n    - uses: actions/checkout@v3\n    - name: Use Node.js ${{ matrix.node-version }}\n      uses: actions/setup-node@v3\n      with:\n        node-version: ${{ matrix.node-version }}\n        cache: 'npm'\n    - run: npm ci\n    - run: npm run build --if-present\n    - run: npm test\n</code></pre><h2 id=\"further-steps\">Further steps</h2><p>In codingame there is also second part of this exercise:</p><figure class=\"kg-card kg-bookmark-card\"><a class=\"kg-bookmark-container\" href=\"https://www.codingame.com/training/medium/derivative-time---part2\"><div class=\"kg-bookmark-content\"><div class=\"kg-bookmark-title\">Coding Games and Programming Challenges to Code Better</div><div class=\"kg-bookmark-description\">CodinGame is a challenge-based training platform for programmers where you can play with the hottest programming topics. Solve games, code AI bots, learn from your peers, have fun.</div><div class=\"kg-bookmark-metadata\"><img class=\"kg-bookmark-icon\" src=\"https://static.codingame.com/assets/apple-touch-icon-152x152-precomposed.5cb052db.png\"><span class=\"kg-bookmark-author\">CodinGame</span></div></div><div class=\"kg-bookmark-thumbnail\"><img src=\"https://files.codingame.com/codingame/codingame_share_pics.jpg\"></div></a></figure><p>that will include trigonometric functions, logarithm, exponent and even the chain rule.</p><p>You can invite me to your friends on this platform using link:</p><p><a href=\"https://www.codingame.com/servlet/urlinvite?u=5287657\">https://www.codingame.com/servlet/urlinvite?u=5287657</a></p><p>You can find all presented code on my github:</p><figure class=\"kg-card kg-bookmark-card\"><a class=\"kg-bookmark-container\" href=\"https://github.com/gustawdaniel/codingame-derivative-time-part-1\"><div class=\"kg-bookmark-content\"><div class=\"kg-bookmark-title\">GitHub - gustawdaniel/codingame-derivative-time-part-1</div><div class=\"kg-bookmark-description\">Contribute to gustawdaniel/codingame-derivative-time-part-1 development by creating an account on GitHub.</div><div class=\"kg-bookmark-metadata\"><img class=\"kg-bookmark-icon\" src=\"https://github.githubassets.com/favicons/favicon.svg\"><span class=\"kg-bookmark-author\">GitHub</span><span class=\"kg-bookmark-publisher\">gustawdaniel</span></div></div><div class=\"kg-bookmark-thumbnail\"><img src=\"https://opengraph.githubassets.com/f239053bc814122dc1c46e68d764599685c1bcf41c7c4651e8f19786982fa0db/gustawdaniel/codingame-derivative-time-part-1\"></div></a></figure>","comment_id":"63cc1ff5bbda300a2f29cb53","plaintext":"Now we will solve exercise DERIVATIVE TIME:\n\nCoding Games and Programming Challenges to Code BetterCodinGame is a\nchallenge-based training platform for programmers where you can play with the\nhottest programming topics. Solve games, code AI bots, learn from your peers,\nhave fun.CodinGame\n[https://www.codingame.com/training/medium/derivative-time---part1]Our goal is,\nevaluate the partial derivative of a given formula.\n\nFor instance, given the function formula \"(5*(x*(y^2)))\" and \"y x\", the\nvariables in respect with you must derive it\n\nSo here f(x,y) = 5xy² and you have to calculate:\n\n   d²f(x,y)   \n  ----------\n    dxdy\n\nit gives you the formula 10*y. At last \"x 2 y 6\" means x=2, y=6, gives you the\nvalues with which you must evaluate the obtained derivative. So the answer\nshould be 60\n\nNote\nTo simplify the task, only consider +, * and ^. And assume that +, * and ^ \nalways take two arguments and that expressions are fully parenthesized.\n\nNegative power has no parenthesis. e.g. (((18*(x^-1))+y)+z)\n\nvars may be in other forms other than x, y, and z. Similar to identifiers in\nmany programming languages, the var would be some letter followed by letters,\nnumbers or underscore.\n\nlink about calculus rules: \n\nDifferentiation rules - WikipediaWikimedia Foundation, Inc.Contributors to\nWikimedia projects [https://en.wikipedia.org/wiki/Differentiation_rules]The\nrules needed here:\n\na'=0\n(a*x)'=a\n(x^a)'=a*x^(a-1) (when a is not 0)\n(u+v)'=u'+v'\n(u*v)'=u'*v+v'*u\n\nTheoretical introduction to derivatives\nTo compute derivative of function we have to represent function as object\npossible to manipulate. One of possibilities is representing it as an array with\noperation placed on the beginning and with arguments occupying rest of\npositions.\n\nThis concept is intensively used in some of languages as Lisp or Scheme. If you\ndo not know Lisp you can easy learn it in y minutes on page:\n\nLearn Common Lisp in Y Minutes [https://learnxinyminutes.com/docs/common-lisp/]\nSo instead of write\n\na + b\n\nin lisp you will write\n\n(+ a b)\n\nOur further solution will be heavily based on this concept of ordering. How\nadvantages it have over a + b? Firstly we can decompose our expressions by\n\nconst [operation, ...arguments] = expression;\n\nSecondly for associative [https://mathworld.wolfram.com/Associative.html] \noperations we can use reduce function like\n\nconst res = arguments.reduce(fn, identity);\n\nIn this case identity is value that will not change result of operation, and fn \nis function assigned to operation, eg (a,b) => a+b for addition.\n\nHaving these basic concept in mind we can consider derivative as function that\ntransform array representing mathematical formula to other array with other\nformula.\n\nWe know which transformations should be applied to addition, multiplication or\npowers. We also able to simplify result knowing derivatives of constant or\nidentity function.\n\nSo lets divide our solution to four steps.\n\n 1. Setup project\n 2. Parsing input\n 3. Evaluating values\n 4. Computing derivative\n\nSetup NodeJS typescript project with jest\nLets init project\n\nnpm init -y\ntsc --init\n\nin generated tsconfigl.json we have to set\n\n\"target\": \"ESNext\",\n\nto be albe to use Map or other modern data structures or syntax.\n\nIn package.json we should set\n\n\"test\": \"jest\"\n\nin scripts section and install required packages.\n\nnpm i -D @types/jest @types/node esbuild-jest jest ts-node typescript\n\nNow lets create jest config jest.config.ts\n\nmodule.exports = {\n    roots: ['<rootDir>'],\n    testMatch: ['**/__tests__/**/*.+(ts|tsx)', '**/?(*.)+(spec|test).+(ts|tsx)'],\n    transform: {\n        '^.+\\\\.(ts|tsx)$': 'esbuild-jest',\n    },\n    setupFilesAfterEnv: [],\n    testEnvironment: 'node',\n}\n\n\nFinally we can create three files: lib.ts with:\n\nexport function run(input: string): string {\n    return ''\n}\n\n\nTest test/lib.test.ts with\n\nimport {run} from \"../lib\";\n\ndescribe('e2e', () => {\n    it('temporary', () => {\n        expect(run('')).toEqual('')\n    })\n});\n\nand index.ts that is responsible for input/output operations\n\nimport {run} from \"./lib\";\n\nprocess.stdin.on('data', (buff) => {\n    const input = buff.toString();\n    process.stdout.write(run(input));\n})\n\n\nNow we should be able to run program using\n\necho '' | ts-node index.ts\n\nand test by command\n\nnpm run test\n\nParsing Input and building objects\nLets see on input\n\nFrom content of this exercise we can read that input contains 3 lines:\n\nLine 1: formula\nLine 2: list of vars for partial derivative, separated by space, length of the\nlist will be 1, 2 or 3.\nLine 3: vars' values, paired and separated by space\n\nOutput is the result (always an integer).\n\nSo for example input\n\n(5*(x*y))\nx\nx 2 y 6\n\nwe will have derivative by x giving (5*y), that in point {x:2, y:6} is 5*6 or\nsimply\n\n30\n\nNow we will introduce three objects that will refer to these lines:\n\n * Formula\n * DiffOperator\n * Coordinate\n\nGenerally any of these object should be created basing on his line. Only\nexception is Formula that require variables from coordinate to recognize on\narguments and treat them in a special way.\n\nNow run function from lib.ts can be rewritten as\n\nexport function run(input: string): string {\n    const [F, vs, dict] = input.split('\\n');\n    const point = new Coordinate(dict);\n    const diff = new DiffOperator(vs);\n    const formula = new Formula(F, point.variables);\n\n    return diff.actOn(formula).evaluate(point).toString();\n}\n\n\nWhat can be explained as acting derivative operator on function and evaluating\nit at given point. It is exactly what we need to do in this task.\n\nNow we will implement these classes and write some tests for them\n\nCoordinate implementation\nLets start from coordinate\n\nexport class Coordinate {\n    map: Map<string, number> = new Map();\n\n    constructor(input: string) {\n        const pairs = input.split(' ');\n        for (let i = 0; i < pairs.length / 2; i++) {\n            const [key, value] = [pairs[i * 2], Number.parseFloat(pairs[i * 2 + 1])];\n            this.map.set(key, value);\n        }\n    }\n\n    get variables(): string[] {\n        return [...this.map.keys()]\n    }\n\n    get(name): number {\n        return this.map.get(name) ?? 0;\n    }\n}\n\nIt simply splits his string x 2 y 6 by spaces and move by pairs setting them as\nkeys and values of internal Map. It can return both list of keys to help in \nFormula initialization and get singe value of key that is useful in evaluating.\n\ntests for coordinate are the following\n\ndescribe('coordinate', () => {\n    it('parsing', () => {\n        const point = new Coordinate('x 2 y 6');\n        expect(point.variables).toEqual(['x', 'y']);\n        expect(point.get('x')).toEqual(2);\n        expect(point.get('y')).toEqual(6);\n        expect(point.get('undefined')).toEqual(0);\n    })\n})\n\nFormula initialization\nNext object is formula. We need two additional types\n\ntype Operator = '*' | '^' | '+' | '-';\ntype SubFormula = Array<string | number | SubFormula> | string | number\n\nand can write our formula class\n\nexport class Formula {\n    f: SubFormula;\n    v: string[] = [];\n}\n\nfollowing functions will be placed inside of this class. We need constructor\nthat will get formula string and list of variables. To operate on string form of\nformula we will define two functions:\n\n * decomposeInput(input: string): SubFormula\n * isDecomposable(input: string): boolean\n\nFirs will do parsing, second will check if should we expand input to elements or\nshould we left it as atomic part of formula.\n\nIn our case we need to decompose if string starts and ends with brackets and\ncontains operator\n\n    isDecomposable(input: string): boolean {\n        return input.startsWith('(') && input.endsWith(')') && /[*^+-]/.test(input)\n    }\n\nDecomposition contains part that prepare three elements p like previous, n like\nnext, and operator.\n\ndecomposeInput(input: string): SubFormula {\n        let p: SubFormula = '', operator: Operator | '' = '', n: SubFormula = '', level: number = 0;\n        if (!this.isDecomposable(input)) return [0];\n        for (let i = 1; i < input.length - 1; i++) {\n            if (level === 0 && !operator && /[*^+-]/.test(input[i])) {\n                operator = input[i] as Operator;\n                continue;\n            } else if (input[i] === '(') {\n                level++;\n            } else if (input[i] === ')') {\n                level--;\n            }\n            if (operator) {\n                n += input[i];\n            } else {\n                p += input[i];\n            }\n        }\n\nwe are using level to determine which sub bracket level we reaching during loop.\n\nAfter loop over all characters and completing p, n, and operator we have to\ncheck if should we decompose or parse these elements using code\n\n        if (this.isDecomposable(p)) {\n            p = this.decomposeInput(p);\n        } else {\n            if (!this.v.includes(p)) {\n                p = Number.parseFloat(p);\n            }\n        }\n        if (this.isDecomposable(n)) {\n            n = this.decomposeInput(n);\n        } else {\n            if (!this.v.includes(n)) {\n                n = Number.parseFloat(n);\n            }\n        }\n        return [operator, p, n];\n    }\n\nafter defining these functions we can write constructor\n\n    constructor(input: string, variables: string[]) {\n        this.v = variables;\n        this.f = this.decomposeInput(input);\n    }\n\nand test for them\n\ndescribe('formula', () => {\n    const f = new Formula('(5*(x*y))', ['x', 'y']);\n\n    it('parse', () => {\n        expect(f.f).toEqual(['*', 5, ['*', 'x', 'y']]);\n        expect(f.v).toEqual(['x', 'y']);\n    });\n\n    it('parse with many brackets', () => {\n        const f = new Formula('((x^3)+(x^2))', ['x']);\n        expect(f.f).toEqual(['+', ['^', 'x', 3], ['^', 'x', 2]])\n    })\n})\n\nDiffOperator (derivateve) initialization\nFortunatelly derivative is super easy to construct\n\nexport class DiffOperator {\n    d: string[] = [];\n\n    constructor(input: string) {\n        this.d = input.split(' ');\n    }\n}\n\ninside we want to store array of variables names that we will use seqentially\nacting on given function.\n\nWe can skip tests for it and go to next part - Evaluating values\n\nEvaluating values\nNow we still will write code in Formula class. \n\nOur computing function will be able to call themself many times so to simply\ntheir interface we will split computation to:\n\nstatic compute(f: SubFormula | string | number, point: Coordinate): number\n\nand\n\nevaluate(point: Coordinate): number \n\nfirst one will be used to operate directly on SubFormula, but second will be\nlayer that was applied in run in expression\n\ndiff.actOn(formula).evaluate(point)\n\nevaluate can be defined as\n\n    evaluate(point: Coordinate): number {\n        return Formula.compute(this.f, point);\n    }\n\nBut compute should start from classification of his argument. It can be\nexpression, then Array.isArray(f) will be true, number, then this number should\nbe returned od name of coordinate, then coordinate saved in point can be\nreturned.\n\nOur code will be the following\n\n    static compute(f: SubFormula | string | number, point: Coordinate): number {\n        if (Array.isArray(f)) {\n            // ... TO BE DEFINED IN NEXT STEP\n        } else if (typeof f === 'number') {\n            return f;\n        } else {\n            return point.get(f);\n        }\n    }\n\nMost interesting is case when, f is array. Then using theory from introduction\nwe should decompose it to operator and arguments;\n\nconst [op, ...rest] = f;\n\nand in next step in dependence from operator arguments can be processed by\ndifferent functions:\n\nswitch (op) {\n    case '+':\n        return <number>rest.reduce((p: number, n: SubFormula): number => p + this.compute(n, point), 0);\n    case '*':\n        return <number>rest.reduce((p: number, n: SubFormula): number => p * this.compute(n, point), 1);\n    case '^': {\n        const [p, n] = rest;\n        return Math.pow(this.compute(p, point), this.compute(n, point));\n    }\n    case '-': {\n        const [p, n] = rest;\n        return this.compute(p,point) - this.compute(n, point);\n    }\n    default:\n        return 0;\n}\n\nFor associative operations like * and + with existing identity value we used \nreduce. But for rest cases we assumed that there are two arguments and used\ndestructuring.\n\nTo prove that it works we can add the following test to formula section\n\n    it('evaluate', () => {\n        expect(f.evaluate(new Coordinate('x 1 y 2'))).toStrictEqual(10);\n    });\n\nour formula defined ealier was (5*(x*y)) so we expect result 10.\n\nIf you following all these concepts to this point, then next step will be easy\nlogical continuation for you.\n\nComputing derivative\nComputing derivative will be done in the same style like evaluating value of\nfunction. We will split it on two methods Dynamic actOn with interface\n\nactOn(f: Formula): Formula\n\nand static internal function\n\nstatic derivative(s: SubFormula, dir: string): SubFormula\n\nFirst one will iterate over all directions saved in d property. Second is first\norder derivative in direction passed by second argument. These functions works\nalso on other levels: actOn will use Formula abstraction, but derivative need\nand return SubFormula to operate on more low level structure.\n\nWe will introduce also one more static function\n\nstatic simplify(s: SubFormula): SubFormula \n\nthat will not need direction and use simple algebra rules to make computation\npartial results more human readable and easy to process. Simplify will return\nthe same mathematical formula but written in most simple possible manner\nremoving unnecessary additions of 0 or multiplications by 1.\n\nFollowing functions are defined as methods of DiffOperator. \n\nSimplification of formula\nLets start from simplify because of I started to explain it. To simplify\nformulas we will apply the folowing rules:\n\n * all subarguments should be simplified (recursive)\n * if all subarguments are numbers, they should be computed\n * if one of argument is 0 or 1 special treatment of second argument should be\n   applied in dependence from operator\n\nCode that implement described behavior is\n\n    static simplify(s: SubFormula): SubFormula {\n        if (Array.isArray(s)) {\n            const [op, ...rest] = s;\n            for (let i = 0; i < rest.length; i++) {\n                rest[i] = this.simplify(rest[i]);\n            }\n            if (rest.every((r) => typeof r === 'number')) {\n                return Formula.compute(s, new Coordinate(''));\n            }\n            if (rest[0] === 0) {\n                if (op === '+') return rest[1]\n                if (op === '*') return 0\n                if (op === '^') return 0\n            }\n            if (rest[0] === 1) {\n                if (op === '*') return rest[1]\n                if (op === '^') return 1\n            }\n            if (rest[1] === 0) {\n                if (op === '+') return rest[0]\n                if (op === '*') return 0\n                if (op === '^') return 1\n            }\n            if (rest[1] === 1) {\n                if (op === '*') return rest[0]\n                if (op === '^') return rest[0]\n            }\n            return [op, ...rest];\n        } else {\n            return s;\n        }\n    }\n\nDerivative of formula\nTo define derivative of first order on given direction:\n\nstatic derivative(s: SubFormula, dir: string): SubFormula\n\nwe have to assume that we can compute it on\n\n * expression\n * our variable\n * constant\n\nIf it is executed on variable or constant then result will be 1 or 0, but on\nexpression we have to check operator and decide which rule should we apply. This\npart is exactly the same concept as with evaluation, but we returns arrays with\noperators that represents functions instead of numbers. Code below:\n\n    static derivative(s: SubFormula, dir: string): SubFormula {\n        if (Array.isArray(s)) {\n            const [op, p, n] = s;\n            switch (op) {\n                case '*':\n                    return ['+', ['*', p, this.derivative(n, dir)], ['*', this.derivative(p, dir), n]];\n                case '+':\n                    return ['+', this.derivative(p, dir), this.derivative(n, dir)];\n                case '-':\n                    return ['-', this.derivative(p, dir), this.derivative(n, dir)];\n                case '^': {\n                    if (p === dir) {\n                        if (n === 0) return 0;\n                        return typeof n === 'number' ? ['*', n, ['^', p, n - 1]] : ['*', n, ['^', p, ['+', n, -1]]]\n                    } else {\n                        return 0;\n                    }\n                }\n            }\n\n        } else if (typeof s === 'string' && s === dir) {\n            return 1\n        } else {\n            return 0;\n        }\n    }\n\nwe can see that only with powers there is a little confuction, because of I\ndecided to evaluate subtraction 1 on power if it is number. I decided to skip\nsupport for a^x because of it is exponential function that is out of scope of\nfirst part of this exercise.\n\nFinally to implement actOn we will need clone of formula, so on formula we\nshould implement\n\n    clone(): Formula {\n        const o = new Formula('', []);\n        o.f = JSON.parse(JSON.stringify(this.f));\n        o.v = JSON.parse(JSON.stringify(this.f));\n        return o;\n    }\n\nand then on DiffOperator\n\n    actOn(f: Formula): Formula {\n        const o = f.clone();\n        return this.d.reduce((p, n) => {\n            o.f = DiffOperator.simplify(DiffOperator.derivative(p.f, n));\n            return o;\n        }, o);\n    }\n\nto write stable, editable and working code we should add tests\n\ndescribe('diff operation', () => {\n    it('simplify', () => {\n        expect(DiffOperator.simplify([\"+\", [\"*\", 1, 0], [\"*\", 0, 1]])).toEqual(0);\n        expect(DiffOperator.simplify(['^', 'x', 1])).toEqual('x');\n        expect(DiffOperator.simplify(['*', 2, ['^', 'x', 1]])).toEqual(['*', 2, 'x']);\n        expect(DiffOperator.simplify([\"*\", 5, [\"+\", [\"*\", \"x\", 0], [\"*\", 1, \"y\"]]])).toEqual(['*', 5, 'y'])\n        expect(DiffOperator.simplify([\"+\", [\"*\", 5, [\"+\", [\"*\", \"x\", 0], [\"*\", 1, \"y\"]]], [\"*\", 0, [\"*\", \"x\", \"y\"]]])).toEqual(['*', 5, 'y'])\n    });\n    it('derivative', () => {\n        expect(DiffOperator.simplify(DiffOperator.derivative(['*', 2, 'x'], 'x'))).toEqual(2);\n        expect(DiffOperator.simplify(DiffOperator.derivative(['*', 5, ['*', 'x', 'y']], 'x'))).toEqual(['*', 5, 'y'])\n    })\n    it(\"a'=0\", () => {\n        const f = new Formula('(1*1)', ['x']);\n        const d = new DiffOperator('x');\n        expect(d.actOn(f).f).toEqual(0);\n    });\n    it(\"(a*x)'=a\", () => {\n        const f = new Formula('(4*x)', ['x']);\n        const d = new DiffOperator('x');\n        expect(d.actOn(f).f).toEqual(4);\n    });\n    it(\"(x^a)'=a*x^(a-1) (when a is not 0)\", () => {\n        const cases = [\n            {in: '(x^5)', out: ['*', 5, ['^', 'x', 4]]},\n            {in: '(x^3)', out: ['*', 3, ['^', 'x', 2]]},\n            {in: '(x^2)', out: ['*', 2, 'x']},\n        ];\n        for (const c of cases) {\n            const f = new Formula(c.in, ['x']);\n            const d = new DiffOperator('x');\n            expect(d.actOn(f).f).toEqual(c.out);\n        }\n    });\n    it(\"(u+v)'=u'+v for (x+(x^2))'\", () => {\n        const f = new Formula('(x+(x^2))', ['x']);\n        const d = new DiffOperator('x');\n        expect(d.actOn(f).f).toEqual(['+', 1, ['*', 2, 'x']]);\n    });\n\n    it(\"(u+v)'=u'+v'\", () => {\n        const f = new Formula('((x^3)+(x^2))', ['x']);\n        const d = new DiffOperator('x');\n        console.log(\"f\", f);\n        expect(d.actOn(f).f).toEqual(['+', ['*', 3, ['^', 'x', 2]], ['*', 2, 'x']]);\n    });\n    it(\"(u*v)'=u'*v+v'*u\", () => {\n        const f = new Formula('(x*x)', ['x']);\n        const d = new DiffOperator('x');\n        console.log(\"f\", f);\n        expect(d.actOn(f).f).toEqual(['+', 'x', 'x']);\n    });\n\n    it('d(8*(y^x))/dy', () => {\n        const f = new Formula('(8*(y^x))', ['x', 'y']);\n        expect(f.f).toEqual(['*', 8, ['^', 'y', 'x']]);\n        expect(DiffOperator.simplify(DiffOperator.derivative(['*', 8, ['^', 'y', 'x']], 'y'))).toEqual(['*', 8, ['*', 'x', ['^', 'y', ['+', 'x', -1]]]]);\n    })\n\n    it('(18*(x^-1))',() => {\n        const f = new Formula('(18*(x^-1))', ['x']);\n        expect(f.f).toEqual(['*', 18, ['^', 'x', -1]]);\n        expect(DiffOperator.simplify(DiffOperator.derivative(f.f, 'x'))).toEqual( ['*', 18, ['*', -1, ['^', 'x', -2]]]);\n    });\n\n    it('d(((x^2)+(2*(z^5)))+(((18*(x^-1))+y)+z))/dx', () => {\n        const f = new Formula('(((x^2)+(2*(z^5)))+(((18*(x^-1))+y)+z))', ['x', 'y', 'z']);\n        expect(DiffOperator.simplify(DiffOperator.derivative(f.f, 'x'))).toEqual(['+', ['*', 2, 'x'], ['*', 18, ['*', -1, ['^', 'x', -2]]]]);\n    })\n})\n\nFinally all elements of program works so we can add also e2e tests on run \nfunction\n\ndescribe('e2e', () => {\n    it('easy multiply', () => {\n        expect(run('(5*(x*y))\\nx\\nx 2 y 6')).toEqual('30')\n    })\n    it(\"second derivative\", () => {\n        expect(run('(5*((x^4)*(y^2)))\\nx x\\nx 2 y 6')).toEqual('8640')\n    })\n    it(\"second derivative mix\", () => {\n        expect(run('(5*(x*(y^2)))\\ny x\\nx 2 y 6')).toEqual('60')\n    })\n    it(\"power with number\", () => {\n        expect(run('((x^2)+(9*(x+y)))\\nx\\nx 1 y 2')).toEqual('11')\n    })\n    it(\"power with variable\", () => {\n        expect(run('(8*(y^x))\\ny y\\nx -1 y 2')).toEqual('2')\n    })\n    it(\"3 variables\", () => {\n        expect(run('(((x^2)+(2*(z^5)))+((x+y)+z))\\nz\\nx 2 y 3 z 4')).toEqual('2561')\n    })\n    it(\"fraction\", () => {\n        expect(run('(((x^2)+(2*(z^5)))+(((18*(x^-1))+y)+z))\\nx\\nx 3 y 4 z 1')).toEqual('4')\n    })\n    it(\"longer multiply\", () => {\n        expect(run('(((x^2)*(2*(z^5)))*((x+y)+z))\\nz\\nx 1 y 1 z 1')).toEqual('32')\n    })\n    it(\"3rd derivative\", () => {\n        expect(run('(((y^6)*(z^5))*(((3*(x^4))+y)+z))\\ny y z\\nx 1 y 1 z 2')).toEqual('16320')\n    })\n    it(\"some Greek ;)\", () => {\n        expect(run('(((Beta^6)*(Gamma^5))*(((3*(Alpha^4))+Beta)+Gamma))\\nBeta Beta Gamma\\nAlpha 1 Beta 1 Gamma 2')).toEqual('16320')\n    })\n    it(\"maybe not xyz ;)\", () => {\n        expect(run('(((x2^6)*(x3^5))*(((3*(x1^4))+x2)+x3))\\nx2 x2 x3\\nx1 1 x2 1 x3 2')).toEqual('16320')\n    })\n    it(\"some Vars ;)))\", () => {\n        expect(run('(((Var_2^6)*(Var_3^5))*(((3*(Var_1^4))+Var_2)+Var_3))\\nVar_2 Var_2 Var_3\\nVar_1 1 Var_2 1 Var_3 2')).toEqual('16320')\n    })\n    it(\"bigger constants\", () => {\n        expect(run('(50*((x^40)*(y^20)))\\nx x\\nx 1 y 1')).toEqual('78000')\n    })\n    it(\"bigger power\", () => {\n        expect(run('(x^(y^10))\\nx x\\nx 1 y 2')).toEqual('1047552')\n    })\n    it(\"cannot find\", () => {\n        expect(run('(5*(x*(y^2)))\\nz\\nx 2 y 6')).toEqual('0')\n    })\n})\n\nand proper github workflow\n\nname: Node.js CI\n\non:\n  push:\n    branches: [ \"main\" ]\n\njobs:\n  build:\n\n    runs-on: ubuntu-latest\n\n    strategy:\n      matrix:\n        node-version: [14.x, 16.x, 18.x]\n\n    steps:\n    - uses: actions/checkout@v3\n    - name: Use Node.js ${{ matrix.node-version }}\n      uses: actions/setup-node@v3\n      with:\n        node-version: ${{ matrix.node-version }}\n        cache: 'npm'\n    - run: npm ci\n    - run: npm run build --if-present\n    - run: npm test\n\n\nFurther steps\nIn codingame there is also second part of this exercise:\n\nCoding Games and Programming Challenges to Code BetterCodinGame is a\nchallenge-based training platform for programmers where you can play with the\nhottest programming topics. Solve games, code AI bots, learn from your peers,\nhave fun.CodinGame\n[https://www.codingame.com/training/medium/derivative-time---part2]that will\ninclude trigonometric functions, logarithm, exponent and even the chain rule.\n\nYou can invite me to your friends on this platform using link:\n\nhttps://www.codingame.com/servlet/urlinvite?u=5287657\n\nYou can find all presented code on my github:\n\nGitHub - gustawdaniel/codingame-derivative-time-part-1Contribute to\ngustawdaniel/codingame-derivative-time-part-1 development by creating an\naccount\non GitHub.GitHubgustawdaniel\n[https://github.com/gustawdaniel/codingame-derivative-time-part-1]","feature_image":"__GHOST_URL__/content/images/2023/01/output--1-.jpg","featured":0,"type":"post","status":"published","locale":null,"visibility":"public","email_recipient_filter":"all","created_at":"2023-01-21T17:25:09.000Z","updated_at":"2023-01-21T20:31:28.000Z","published_at":"2023-01-21T20:31:28.000Z","custom_excerpt":"Solution of CodinGame exercise. Simple recursion example with typescript. Formula representation inspired by lisp.","codeinjection_head":null,"codeinjection_foot":null,"custom_template":null,"canonical_url":null,"newsletter_id":null,"lexical":null},{"id":"63cd9d9ebbda300a2f29cdc6","uuid":"0d603727-bb98-420b-a8c1-e6283697b41a","title":"CodinGame: Best fit to data - Rust - Regression Analysis","slug":"regression","mobiledoc":"{\"version\":\"0.3.1\",\"atoms\":[],\"cards\":[[\"bookmark\",{\"type\":\"bookmark\",\"url\":\"https://www.codingame.com/ide/puzzle/blunder-episode-3\",\"metadata\":{\"url\":\"https://www.codingame.com/ide/puzzle/blunder-episode-3\",\"title\":\"Coding Games and Programming Challenges to Code Better\",\"description\":\"CodinGame is a challenge-based training platform for programmers where you can play with the hottest programming topics. Solve games, code AI bots, learn from your peers, have fun.\",\"author\":null,\"publisher\":\"CodinGame\",\"thumbnail\":\"https://files.codingame.com/codingame/codingame_share_pics.jpg\",\"icon\":\"https://static.codingame.com/assets/apple-touch-icon-152x152-precomposed.5cb052db.png\"}}],[\"image\",{\"src\":\"__GHOST_URL__/content/images/2023/01/complexity_ms.jpg\",\"width\":436,\"height\":320}],[\"code\",{\"code\":\"5 < N < 1000\\n5 < num < 15000\\n0 < t < 10000000\"}],[\"code\",{\"code\":\"10\\n5 341\\n1005 26324\\n2005 52585\\n3005 78877\\n4005 104925\\n4805 125920\\n6105 159156\\n7205 188017\\n8105 211417\\n9905 258991\"}],[\"code\",{\"code\":\"O(n)\"}],[\"hr\",{}],[\"html\",{\"html\":\"$$ R^2 = \\\\sum_i \\\\left( t_i - f(n_i, a) \\\\right)^2 $$\"}],[\"bookmark\",{\"type\":\"bookmark\",\"url\":\"https://mathworld.wolfram.com/LeastSquaresFitting.html\",\"metadata\":{\"url\":\"https://mathworld.wolfram.com\",\"title\":\"Least Squares Fitting -- from Wolfram MathWorld\",\"description\":\"A mathematical procedure for finding the best-fitting curve to a given set of points by minimizing the sum of the squares of the offsets (“the residuals”) of the points from the curve. The sum of the squares of the offsets is used instead of the offset absolute values because this allows the residua…\",\"author\":null,\"publisher\":\"from Wolfram MathWorld\",\"thumbnail\":\"https://mathworld.wolfram.com/images/socialmedia/share.png\",\"icon\":null}}],[\"html\",{\"html\":\"$$ \\\\frac{\\\\partial (R^2)}{\\\\partial a} = - 2 \\\\sum_i \\\\left( t_i - f(n_i, a) \\\\right) \\\\frac{\\\\partial f(n_i, a)}{\\\\partial a} = 0 $$\"}],[\"html\",{\"html\":\"$$ f(n_i, a) = a * f(n_i) $$\"}],[\"html\",{\"html\":\"$$ \\\\frac{\\\\partial f(n_i, a)}{\\\\partial a} = \\\\frac{\\\\partial a f(n_i)}{\\\\partial a} = f(n_i) $$\"}],[\"html\",{\"html\":\"$$ \\\\sum_i \\\\left( t_i f(n_i) - a (f(n_i))^2 \\\\right) = 0 $$\"}],[\"html\",{\"html\":\"$$ a = \\\\frac{\\\\sum_i t_i f(n_i)}{\\\\sum (f(n_i))^2 } $$\"}],[\"html\",{\"html\":\"$$ R^2 = \\\\sum_i \\\\left( t_i - a f(n_i) \\\\right)^2 $$\"}],[\"code\",{\"code\":\"5 < N < 1000\\n5 < num < 15000\\n0 < t < 10000000\"}],[\"bookmark\",{\"type\":\"bookmark\",\"url\":\"https://doc.rust-lang.org/std/f64/constant.MAX.html\",\"metadata\":{\"url\":\"https://doc.rust-lang.org/std/f64/constant.MAX.html\",\"title\":\"MAX in std::f64 - Rust\",\"description\":\"Largest finite `f64` value. Use [`f64::MAX`] instead.\",\"author\":null,\"publisher\":\"logo\",\"thumbnail\":\"https://doc.rust-lang.org/rust-logo1.66.1.svg\",\"icon\":\"https://doc.rust-lang.org/favicon1.66.1.svg\"}}],[\"html\",{\"html\":\"$$ \\\\frac{\\\\partial (R^2)}{\\\\partial a} = - 2 \\\\sum_i \\\\left( log( t_i) - log(a f(n_i) ) \\\\right) \\\\frac{\\\\partial log( a f(n_i) )}{\\\\partial a} = 0 $$\"}],[\"html\",{\"html\":\"$$  \\\\sum_i \\\\left( log( t_i) - log(a) - log( f(n_i)) ) \\\\right) \\\\frac{\\\\partial log( a ) + log(f(n_i) )}{\\\\partial a} = 0 $$\"}],[\"html\",{\"html\":\"$$ \\\\sum_i \\\\left( log( t_i) - log(a) - log( f(n_i)) ) \\\\right) \\\\frac{1}{a} = 0 $$\"}],[\"html\",{\"html\":\"$$ a = exp( \\\\frac{\\\\sum_i log(t_i) - \\\\sum_i log(f(n_i))}{N} ) $$\"}],[\"html\",{\"html\":\"$$ N = \\\\sum_i 1 $$\"}],[\"html\",{\"html\":\"$$ R^2 = \\\\sum_i ( log( t_i) - log( a * f(n_i) ) )^2 =  \\\\sum_i ( log( t_i) - log( f(n_i) ) - log(a) )^2 $$\"}],[\"html\",{\"html\":\"$$ c = log(a) = 1/N ( \\\\sum_i log( t_i) - \\\\sum_i log( f(n_i)) ) ) $$\"}],[\"html\",{\"html\":\"$$ R^2 = \\\\sum_i ( log( t_i) - log( f(n_i) ) - c )^2 $$\"}],[\"image\",{\"src\":\"__GHOST_URL__/content/images/2023/01/1_7VUKHiY_oOPbyaIH-olkEQ.jpeg\",\"width\":400,\"height\":420}],[\"code\",{\"code\":\"#[derive(Debug)]\\nstruct Point {\\n    n: u32,\\n    t: u32,\\n}\",\"language\":\"rust\"}],[\"code\",{\"code\":\"fn main() {\\n    let mut buffer = String::new();\\n    std::io::stdin().read_to_string(&mut buffer).unwrap();\\n}\",\"language\":\"rust\"}],[\"code\",{\"code\":\"fn read_series(input: String) -> Vec<Point> {\\n    let mut iterator = input.lines();\\n    let n = iterator.next();\\n    let mut res: Vec<Point> = vec![];\\n\\n    if Some(n).is_some() {\\n        for line in iterator {\\n            if let Some((n, y)) = line.split_once(' ') {\\n                res.push(Point {\\n                    n: n.parse::<u32>().unwrap_or(0),\\n                    t: y.parse::<u32>().unwrap_or(0),\\n                });\\n            }\\n        }\\n        return res;\\n    }\\n\\n    return vec![];\\n}\",\"language\":\"rust\"}],[\"code\",{\"code\":\"    println!(\\\"{:?}\\\", read_series(buffer));\",\"language\":\"rust\"}],[\"code\",{\"code\":\"fn sum(series: &Vec<Point>, expression: impl Fn(&Point) -> f64) -> f64 {\\n    let mut res = 0f64;\\n    for point in series {\\n        res += expression(point)\\n    }\\n    res\\n}\",\"language\":\"rust\"}],[\"code\",{\"code\":\"fn sum(series: &Vec<Point>, expression: impl Fn(&Point) -> f64) -> f64 {\\n    series.into_iter().fold(0f64, |acc, point| { acc + expression(point) })\\n}\",\"language\":\"rust\"}],[\"code\",{\"code\":\"#[cfg(test)]\\nmod tests {\\n    use crate::{Point, sum};\\n\\n    #[test]\\n    fn sum_test() {\\n        assert_eq!(sum(\\n            &vec![Point { n: 0u32, t: 1u32 }, Point { n: 1u32, t: 2u32 }],\\n            |p: &Point| { f64::from(p.t) },\\n        ), 3f64);\\n    }\\n}\",\"language\":\"rust\"}],[\"code\",{\"code\":\"struct Model {\\n    name: String,\\n    fn_log: fn(u32) -> f64,\\n}\",\"language\":\"rust\"}],[\"code\",{\"code\":\"struct EvaluatedMode {\\n    name: String,\\n    r2_log: f64,\\n}\",\"language\":\"rust\"}],[\"code\",{\"code\":\"fn evaluate_r2(model: Model, series: &Vec<Point>) -> EvaluatedMode\",\"language\":\"rust\"}],[\"code\",{\"code\":\"fn evaluate_r2(model: Model, series: &Vec<Point>) -> EvaluatedMode {\\n    let Model { name, fn_log } = model;\\n    let c = 1.0 / series.len() as f64 * sum(\\n        &series,\\n        |p| { f64::ln(f64::from(p.t)) - fn_log(p.n) },\\n    );\\n    let r2_log = sum(\\n        &series,\\n        |p| f64::powi(f64::ln(f64::from(p.t)) - fn_log(p.n) - c, 2),\\n    );\\n    EvaluatedMode {\\n        name,\\n        r2_log,\\n    }\\n}\",\"language\":\"rust\"}],[\"code\",{\"code\":\"fn select_model(series: &Vec<Point>) -> String {\",\"language\":\"rust\"}],[\"code\",{\"code\":\"    let models: Vec<Model> = vec![\\n        Model {\\n            name: String::from(\\\"O(1)\\\"),\\n            fn_log: |_n| 0f64,\\n        },\\n        Model {\\n            name: String::from(\\\"O(log n)\\\"),\\n            fn_log: |n| f64::ln(f64::ln(f64::from(n))),\\n        },\\n        Model {\\n            name: String::from(\\\"O(n)\\\"),\\n            fn_log: |n| f64::ln(f64::from(n)),\\n        },\\n        Model {\\n            name: String::from(\\\"O(n log n)\\\"),\\n            fn_log: |n| f64::ln(f64::from(n)) + f64::ln(f64::ln(f64::from(n))),\\n        },\\n        Model {\\n            name: String::from(\\\"O(n^2)\\\"),\\n            fn_log: |n| 2.0 * f64::ln(f64::from(n)),\\n        },\\n        Model {\\n            name: String::from(\\\"O(n^2 log n)\\\"),\\n            fn_log: |n| 2.0 * f64::ln(f64::from(n)) + f64::ln(f64::ln(f64::from(n))),\\n        },\\n        Model {\\n            name: String::from(\\\"O(n^3)\\\"),\\n            fn_log: |n| 3.0 * f64::ln(f64::from(n)),\\n        },\\n        Model {\\n            name: String::from(\\\"O(2^n)\\\"),\\n            fn_log: |n| f64::from(n) * f64::ln(2.0),\\n        },\\n    ];\",\"language\":\"rust\"}],[\"code\",{\"code\":\"    models.into_iter().map(|m| { evaluate_r2(m, series) }).reduce(|p, n| {\\n        if p.r2_log < n.r2_log { p } else { n }\\n    }).unwrap().name\\n}\",\"language\":\"rust\"}],[\"code\",{\"code\":\"    println!(\\\"{}\\\", select_model(&read_series(buffer)));\\n\",\"language\":\"rust\"}],[\"bookmark\",{\"type\":\"bookmark\",\"url\":\"https://github.com/gustawdaniel/codingame-computational-complexity\",\"metadata\":{\"url\":\"https://github.com/gustawdaniel/codingame-computational-complexity\",\"title\":\"GitHub - gustawdaniel/codingame-computational-complexity\",\"description\":\"Contribute to gustawdaniel/codingame-computational-complexity development by creating an account on GitHub.\",\"author\":\"gustawdaniel\",\"publisher\":\"GitHub\",\"thumbnail\":\"https://opengraph.githubassets.com/b83a08ea9a2eb23cbe830b203c1492ccd02096878a68b63e97a8a741dd437a78/gustawdaniel/codingame-computational-complexity\",\"icon\":\"https://github.githubassets.com/favicons/favicon.svg\"}}],[\"image\",{\"src\":\"__GHOST_URL__/content/images/2023/01/curve_fitting_2x.png\",\"width\":1241,\"height\":1968}]],\"markups\":[[\"code\"]],\"sections\":[[1,\"p\",[[0,[],0,\"We will discuss exercise:\"]]],[10,0],[1,\"p\",[[0,[],0,\"Goal is find best fitting model for given dataset. For example for data:\"]]],[10,1],[1,\"p\",[[0,[],0,\"we should print \"],[0,[0],1,\"O(log n)\"],[0,[],0,\". We can select models from list:\"]]],[3,\"ul\",[[[0,[],0,\"O(1), \"]],[[0,[],0,\"O(log n), \"]],[[0,[],0,\"O(n), \"]],[[0,[],0,\"O(n log n), \"]],[[0,[],0,\"O(n^2), \"]],[[0,[],0,\"O(n^2 log n), \"]],[[0,[],0,\"O(n^3), \"]],[[0,[],0,\"O(2^n)\"]]]],[1,\"p\",[[0,[],0,\"Input of program will contain first line with number of next lines and any following line will contain \"],[0,[0],1,\"n\"],[0,[],0,\" and \"],[0,[0],1,\"t\"],[0,[],0,\" values.\"]]],[1,\"p\",[[0,[],0,\"There are constrains:\"]]],[10,2],[1,\"p\",[[0,[],0,\"and exemplary input:\"]]],[10,3],[1,\"p\",[[0,[],0,\"should give to us\"]]],[10,4],[1,\"p\",[[0,[],0,\"because of is is similar to linear growth.\"]]],[10,5],[1,\"h2\",[[0,[],0,\"Least Square Fitting\"]]],[1,\"p\",[[0,[],0,\"We can derive equation on coefficient and assuming that we want to minimize sum of second powers of differences between measurement and prediction of our model.\"]]],[10,6],[1,\"p\",[[0,[],0,\"This approach is called least squares fitting, and you can read more about it on MathWorld\"]]],[10,7],[1,\"p\",[[0,[],0,\"Minimal value means that partial derivative by parameter of model \"],[0,[0],1,\"a\"],[0,[],0,\" is 0.\"]]],[10,8],[1,\"h2\",[[0,[],0,\"Linear Regression\"]]],[1,\"p\",[[0,[],0,\"Now we can assume that function is linearly dependent from scaling parameter \"],[0,[0],1,\"a\"],[0,[],0,\".\"]]],[10,9],[1,\"p\",[[0,[],0,\"Our goal is find equation to compute \"],[0,[0],1,\"a\"],[0,[],0,\" and then \"],[0,[0],1,\"R^2\"],[0,[],0,\". Our derivative can be simplified:\"]]],[10,10],[1,\"p\",[[0,[],0,\"Using last equation from \"],[0,[0],1,\"Linear Square Fitting\"],[0,[],0,\" we can compute \"],[0,[0],1,\"a\"]]],[10,11],[1,\"p\",[[0,[],0,\"so\"]]],[10,12],[1,\"p\",[[0,[],0,\"and\"]]],[10,13],[1,\"p\",[[0,[],0,\"Our equations looks beautifully but the devil is in the details.\"]]],[1,\"p\",[[0,[],0,\"If we will look at constrains of data for this exercise:\"]]],[10,14],[1,\"p\",[[0,[],0,\"and remember models that we need to test it is easy too see that we will operate on huge numbers.\"]]],[1,\"p\",[[0,[],0,\"For example \"],[0,[0],1,\"2^n\"],[0,[],0,\" with \"],[0,[0],1,\"n = 15 000\"],[0,[],0,\" is much more than max range of 64 bit float\"]]],[10,15],[1,\"p\",[[0,[],0,\"that is constrained to \"],[0,[0],1,\"2^1024\"],[0,[],0,\". There are tricks that allow to operate on these ranges, but instead of hacking computers constrains we will use math.\"]]],[1,\"p\",[[0,[],0,\"Instead of operating on big numbers we will use their logarithm to computation.\"]]],[1,\"h2\",[[0,[],0,\"Logarithmic Regression\"]]],[1,\"p\",[[0,[],0,\"Our solution is consequence of observation that if we will match logarithms of models to logarithms of \"],[0,[0],1,\"t\"],[0,[],0,\" data then in result will will select the same model.\"]]],[1,\"p\",[[0,[],0,\"So adding \"],[0,[0],1,\"log\"],[0,[],0,\" both to data and function we getting equation:\"]]],[10,16],[1,\"p\",[[0,[],0,\"rewriting this equation we can obtain \"],[0,[0],1,\"a\"]]],[10,17],[10,18],[10,19],[1,\"p\",[[0,[],0,\"where\"]]],[10,20],[1,\"p\",[[0,[],0,\"and rewriting equation for \"],[0,[0],1,\"R^2\"],[0,[],0,\" we see:\"]]],[10,21],[1,\"p\",[[0,[],0,\"Lets introduce new variable \"],[0,[0],1,\"c\"],[0,[],0,\" defined as\"]]],[10,22],[1,\"p\",[[0,[],0,\"and then \"],[0,[0],1,\"R^2\"],[0,[],0,\" can be rewritten as\"]]],[10,23],[1,\"p\",[[0,[],0,\"we can see that now there is no chance to operate on too big numbers so we can start implementation of these equations.\"]]],[10,24],[1,\"h2\",[[0,[],0,\"Reading series of data from standard input\"]]],[1,\"p\",[[0,[],0,\"Lets start from definition of \"],[0,[0],1,\"Point\"],[0,[],0,\" structure that represents single measurement.\"]]],[10,25],[1,\"p\",[[0,[],0,\"in \"],[0,[0],1,\"main\"],[0,[],0,\" we will read standard input to \"],[0,[0],1,\"String\"],[0,[],0,\" named \"],[0,[0],1,\"buffer\"],[0,[],0,\".\"]]],[10,26],[1,\"p\",[[0,[],0,\"we want to process this buffer and obtain vector of \"],[0,[0],1,\"Points\"],[0,[],0,\". To do it we writing function:\"]]],[10,27],[1,\"p\",[[0,[],0,\"we can check if it works adding to \"],[0,[0],1,\"main\"],[0,[],0,\" line\"]]],[10,28],[1,\"h2\",[[0,[],0,\"Computing sum on series using closure\"]]],[1,\"p\",[[0,[],0,\"In presented equations we had some sums, so to simplify further code lets implement \"],[0,[0],1,\"sum\"],[0,[],0,\" function that can use closures to define operation what should be summed.\"]]],[1,\"p\",[[0,[],0,\"I initially wrote it as \"],[0,[0],1,\"noob\"]]],[10,29],[1,\"p\",[[0,[],0,\"but soon fixed as \"],[0,[0],1,\"hacker\"]]],[10,30],[1,\"p\",[[0,[],0,\"we can add test\"]]],[10,31],[1,\"h2\",[[0,[],0,\"Evaluating Sum of Least Squares\"]]],[1,\"p\",[[0,[],0,\"Our models to test can be represented using structure\"]]],[10,32],[1,\"p\",[[0,[],0,\"but after computing \"],[0,[0],1,\"R^2\"],[0,[],0,\" we can save result as\"]]],[10,33],[1,\"p\",[[0,[],0,\"this is convenient data organization because results of evaluation will be compared by \"],[0,[0],1,\"r2_log\"],[0,[],0,\" but then \"],[0,[0],1,\"name\"],[0,[],0,\" should be available to print as output.\"]]],[1,\"p\",[[0,[],0,\"Due to this reason we will select following signature for \"],[0,[0],1,\"R^2\"],[0,[],0,\" evaluation \"]]],[10,34],[1,\"p\",[[0,[],0,\"Series is passed by reference similarly like in \"],[0,[0],1,\"sum\"],[0,[],0,\". We do not want to change them or copy so operating on reference is preferred option for us.\"]]],[1,\"p\",[[0,[],0,\"Rewriting equations derived before to rust we can implement in this way\"]]],[10,35],[1,\"h2\",[[0,[],0,\"Selection best fitting model\"]]],[1,\"p\",[[0,[],0,\"To select model we starting from function signature\"]]],[10,36],[1,\"p\",[[0,[],0,\"and defining vector with models possible to select. Instead of original functions we adding \"],[0,[0],1,\"fn_log\"],[0,[],0,\" what are logharithms of these functions.\"]]],[10,37],[1,\"p\",[[0,[],0,\"finally we mapping these models to evaluated models and reducing result to model with smallest \"],[0,[0],1,\"r2_log\"]]],[10,38],[1,\"p\",[[0,[],0,\"its everything. Now we can change last line of \"],[0,[0],1,\"main\"],[0,[],0,\" to\"]]],[10,39],[1,\"p\",[[0,[],0,\"and our program works.\"]]],[1,\"p\",[[0,[],0,\"Traditionally you can check full code with test on my github\"]]],[10,40],[10,41],[1,\"p\",[]]],\"ghostVersion\":\"4.0\"}","html":"<p>We will discuss exercise:</p><figure class=\"kg-card kg-bookmark-card\"><a class=\"kg-bookmark-container\" href=\"https://www.codingame.com/ide/puzzle/blunder-episode-3\"><div class=\"kg-bookmark-content\"><div class=\"kg-bookmark-title\">Coding Games and Programming Challenges to Code Better</div><div class=\"kg-bookmark-description\">CodinGame is a challenge-based training platform for programmers where you can play with the hottest programming topics. Solve games, code AI bots, learn from your peers, have fun.</div><div class=\"kg-bookmark-metadata\"><img class=\"kg-bookmark-icon\" src=\"https://static.codingame.com/assets/apple-touch-icon-152x152-precomposed.5cb052db.png\"><span class=\"kg-bookmark-author\">CodinGame</span></div></div><div class=\"kg-bookmark-thumbnail\"><img src=\"https://files.codingame.com/codingame/codingame_share_pics.jpg\"></div></a></figure><p>Goal is find best fitting model for given dataset. For example for data:</p><figure class=\"kg-card kg-image-card\"><img src=\"__GHOST_URL__/content/images/2023/01/complexity_ms.jpg\" class=\"kg-image\" alt loading=\"lazy\" width=\"436\" height=\"320\"></figure><p>we should print <code>O(log n)</code>. We can select models from list:</p><ul><li>O(1), </li><li>O(log n), </li><li>O(n), </li><li>O(n log n), </li><li>O(n^2), </li><li>O(n^2 log n), </li><li>O(n^3), </li><li>O(2^n)</li></ul><p>Input of program will contain first line with number of next lines and any following line will contain <code>n</code> and <code>t</code> values.</p><p>There are constrains:</p><pre><code>5 &lt; N &lt; 1000\n5 &lt; num &lt; 15000\n0 &lt; t &lt; 10000000</code></pre><p>and exemplary input:</p><pre><code>10\n5 341\n1005 26324\n2005 52585\n3005 78877\n4005 104925\n4805 125920\n6105 159156\n7205 188017\n8105 211417\n9905 258991</code></pre><p>should give to us</p><pre><code>O(n)</code></pre><p>because of is is similar to linear growth.</p><hr><h2 id=\"least-square-fitting\">Least Square Fitting</h2><p>We can derive equation on coefficient and assuming that we want to minimize sum of second powers of differences between measurement and prediction of our model.</p><!--kg-card-begin: html-->$$ R^2 = \\sum_i \\left( t_i - f(n_i, a) \\right)^2 $$<!--kg-card-end: html--><p>This approach is called least squares fitting, and you can read more about it on MathWorld</p><figure class=\"kg-card kg-bookmark-card\"><a class=\"kg-bookmark-container\" href=\"https://mathworld.wolfram.com/LeastSquaresFitting.html\"><div class=\"kg-bookmark-content\"><div class=\"kg-bookmark-title\">Least Squares Fitting -- from Wolfram MathWorld</div><div class=\"kg-bookmark-description\">A mathematical procedure for finding the best-fitting curve to a given set of points by minimizing the sum of the squares of the offsets (“the residuals”) of the points from the curve. The sum of the squares of the offsets is used instead of the offset absolute values because this allows the residua…</div><div class=\"kg-bookmark-metadata\"><span class=\"kg-bookmark-author\">from Wolfram MathWorld</span></div></div><div class=\"kg-bookmark-thumbnail\"><img src=\"https://mathworld.wolfram.com/images/socialmedia/share.png\"></div></a></figure><p>Minimal value means that partial derivative by parameter of model <code>a</code> is 0.</p><!--kg-card-begin: html-->$$ \\frac{\\partial (R^2)}{\\partial a} = - 2 \\sum_i \\left( t_i - f(n_i, a) \\right) \\frac{\\partial f(n_i, a)}{\\partial a} = 0 $$<!--kg-card-end: html--><h2 id=\"linear-regression\">Linear Regression</h2><p>Now we can assume that function is linearly dependent from scaling parameter <code>a</code>.</p><!--kg-card-begin: html-->$$ f(n_i, a) = a * f(n_i) $$<!--kg-card-end: html--><p>Our goal is find equation to compute <code>a</code> and then <code>R^2</code>. Our derivative can be simplified:</p><!--kg-card-begin: html-->$$ \\frac{\\partial f(n_i, a)}{\\partial a} = \\frac{\\partial a f(n_i)}{\\partial a} = f(n_i) $$<!--kg-card-end: html--><p>Using last equation from <code>Linear Square Fitting</code> we can compute <code>a</code></p><!--kg-card-begin: html-->$$ \\sum_i \\left( t_i f(n_i) - a (f(n_i))^2 \\right) = 0 $$<!--kg-card-end: html--><p>so</p><!--kg-card-begin: html-->$$ a = \\frac{\\sum_i t_i f(n_i)}{\\sum (f(n_i))^2 } $$<!--kg-card-end: html--><p>and</p><!--kg-card-begin: html-->$$ R^2 = \\sum_i \\left( t_i - a f(n_i) \\right)^2 $$<!--kg-card-end: html--><p>Our equations looks beautifully but the devil is in the details.</p><p>If we will look at constrains of data for this exercise:</p><pre><code>5 &lt; N &lt; 1000\n5 &lt; num &lt; 15000\n0 &lt; t &lt; 10000000</code></pre><p>and remember models that we need to test it is easy too see that we will operate on huge numbers.</p><p>For example <code>2^n</code> with <code>n = 15 000</code> is much more than max range of 64 bit float</p><figure class=\"kg-card kg-bookmark-card\"><a class=\"kg-bookmark-container\" href=\"https://doc.rust-lang.org/std/f64/constant.MAX.html\"><div class=\"kg-bookmark-content\"><div class=\"kg-bookmark-title\">MAX in std::f64 - Rust</div><div class=\"kg-bookmark-description\">Largest finite &#x60;f64&#x60; value. Use [&#x60;f64::MAX&#x60;] instead.</div><div class=\"kg-bookmark-metadata\"><img class=\"kg-bookmark-icon\" src=\"https://doc.rust-lang.org/favicon1.66.1.svg\"><span class=\"kg-bookmark-author\">logo</span></div></div><div class=\"kg-bookmark-thumbnail\"><img src=\"https://doc.rust-lang.org/rust-logo1.66.1.svg\"></div></a></figure><p>that is constrained to <code>2^1024</code>. There are tricks that allow to operate on these ranges, but instead of hacking computers constrains we will use math.</p><p>Instead of operating on big numbers we will use their logarithm to computation.</p><h2 id=\"logarithmic-regression\">Logarithmic Regression</h2><p>Our solution is consequence of observation that if we will match logarithms of models to logarithms of <code>t</code> data then in result will will select the same model.</p><p>So adding <code>log</code> both to data and function we getting equation:</p><!--kg-card-begin: html-->$$ \\frac{\\partial (R^2)}{\\partial a} = - 2 \\sum_i \\left( log( t_i) - log(a f(n_i) ) \\right) \\frac{\\partial log( a f(n_i) )}{\\partial a} = 0 $$<!--kg-card-end: html--><p>rewriting this equation we can obtain <code>a</code></p><!--kg-card-begin: html-->$$  \\sum_i \\left( log( t_i) - log(a) - log( f(n_i)) ) \\right) \\frac{\\partial log( a ) + log(f(n_i) )}{\\partial a} = 0 $$<!--kg-card-end: html--><!--kg-card-begin: html-->$$ \\sum_i \\left( log( t_i) - log(a) - log( f(n_i)) ) \\right) \\frac{1}{a} = 0 $$<!--kg-card-end: html--><!--kg-card-begin: html-->$$ a = exp( \\frac{\\sum_i log(t_i) - \\sum_i log(f(n_i))}{N} ) $$<!--kg-card-end: html--><p>where</p><!--kg-card-begin: html-->$$ N = \\sum_i 1 $$<!--kg-card-end: html--><p>and rewriting equation for <code>R^2</code> we see:</p><!--kg-card-begin: html-->$$ R^2 = \\sum_i ( log( t_i) - log( a * f(n_i) ) )^2 =  \\sum_i ( log( t_i) - log( f(n_i) ) - log(a) )^2 $$<!--kg-card-end: html--><p>Lets introduce new variable <code>c</code> defined as</p><!--kg-card-begin: html-->$$ c = log(a) = 1/N ( \\sum_i log( t_i) - \\sum_i log( f(n_i)) ) ) $$<!--kg-card-end: html--><p>and then <code>R^2</code> can be rewritten as</p><!--kg-card-begin: html-->$$ R^2 = \\sum_i ( log( t_i) - log( f(n_i) ) - c )^2 $$<!--kg-card-end: html--><p>we can see that now there is no chance to operate on too big numbers so we can start implementation of these equations.</p><figure class=\"kg-card kg-image-card\"><img src=\"__GHOST_URL__/content/images/2023/01/1_7VUKHiY_oOPbyaIH-olkEQ.jpeg\" class=\"kg-image\" alt loading=\"lazy\" width=\"400\" height=\"420\"></figure><h2 id=\"reading-series-of-data-from-standard-input\">Reading series of data from standard input</h2><p>Lets start from definition of <code>Point</code> structure that represents single measurement.</p><pre><code class=\"language-rust\">#[derive(Debug)]\nstruct Point {\n    n: u32,\n    t: u32,\n}</code></pre><p>in <code>main</code> we will read standard input to <code>String</code> named <code>buffer</code>.</p><pre><code class=\"language-rust\">fn main() {\n    let mut buffer = String::new();\n    std::io::stdin().read_to_string(&amp;mut buffer).unwrap();\n}</code></pre><p>we want to process this buffer and obtain vector of <code>Points</code>. To do it we writing function:</p><pre><code class=\"language-rust\">fn read_series(input: String) -&gt; Vec&lt;Point&gt; {\n    let mut iterator = input.lines();\n    let n = iterator.next();\n    let mut res: Vec&lt;Point&gt; = vec![];\n\n    if Some(n).is_some() {\n        for line in iterator {\n            if let Some((n, y)) = line.split_once(' ') {\n                res.push(Point {\n                    n: n.parse::&lt;u32&gt;().unwrap_or(0),\n                    t: y.parse::&lt;u32&gt;().unwrap_or(0),\n                });\n            }\n        }\n        return res;\n    }\n\n    return vec![];\n}</code></pre><p>we can check if it works adding to <code>main</code> line</p><pre><code class=\"language-rust\">    println!(\"{:?}\", read_series(buffer));</code></pre><h2 id=\"computing-sum-on-series-using-closure\">Computing sum on series using closure</h2><p>In presented equations we had some sums, so to simplify further code lets implement <code>sum</code> function that can use closures to define operation what should be summed.</p><p>I initially wrote it as <code>noob</code></p><pre><code class=\"language-rust\">fn sum(series: &amp;Vec&lt;Point&gt;, expression: impl Fn(&amp;Point) -&gt; f64) -&gt; f64 {\n    let mut res = 0f64;\n    for point in series {\n        res += expression(point)\n    }\n    res\n}</code></pre><p>but soon fixed as <code>hacker</code></p><pre><code class=\"language-rust\">fn sum(series: &amp;Vec&lt;Point&gt;, expression: impl Fn(&amp;Point) -&gt; f64) -&gt; f64 {\n    series.into_iter().fold(0f64, |acc, point| { acc + expression(point) })\n}</code></pre><p>we can add test</p><pre><code class=\"language-rust\">#[cfg(test)]\nmod tests {\n    use crate::{Point, sum};\n\n    #[test]\n    fn sum_test() {\n        assert_eq!(sum(\n            &amp;vec![Point { n: 0u32, t: 1u32 }, Point { n: 1u32, t: 2u32 }],\n            |p: &amp;Point| { f64::from(p.t) },\n        ), 3f64);\n    }\n}</code></pre><h2 id=\"evaluating-sum-of-least-squares\">Evaluating Sum of Least Squares</h2><p>Our models to test can be represented using structure</p><pre><code class=\"language-rust\">struct Model {\n    name: String,\n    fn_log: fn(u32) -&gt; f64,\n}</code></pre><p>but after computing <code>R^2</code> we can save result as</p><pre><code class=\"language-rust\">struct EvaluatedMode {\n    name: String,\n    r2_log: f64,\n}</code></pre><p>this is convenient data organization because results of evaluation will be compared by <code>r2_log</code> but then <code>name</code> should be available to print as output.</p><p>Due to this reason we will select following signature for <code>R^2</code> evaluation </p><pre><code class=\"language-rust\">fn evaluate_r2(model: Model, series: &amp;Vec&lt;Point&gt;) -&gt; EvaluatedMode</code></pre><p>Series is passed by reference similarly like in <code>sum</code>. We do not want to change them or copy so operating on reference is preferred option for us.</p><p>Rewriting equations derived before to rust we can implement in this way</p><pre><code class=\"language-rust\">fn evaluate_r2(model: Model, series: &amp;Vec&lt;Point&gt;) -&gt; EvaluatedMode {\n    let Model { name, fn_log } = model;\n    let c = 1.0 / series.len() as f64 * sum(\n        &amp;series,\n        |p| { f64::ln(f64::from(p.t)) - fn_log(p.n) },\n    );\n    let r2_log = sum(\n        &amp;series,\n        |p| f64::powi(f64::ln(f64::from(p.t)) - fn_log(p.n) - c, 2),\n    );\n    EvaluatedMode {\n        name,\n        r2_log,\n    }\n}</code></pre><h2 id=\"selection-best-fitting-model\">Selection best fitting model</h2><p>To select model we starting from function signature</p><pre><code class=\"language-rust\">fn select_model(series: &amp;Vec&lt;Point&gt;) -&gt; String {</code></pre><p>and defining vector with models possible to select. Instead of original functions we adding <code>fn_log</code> what are logharithms of these functions.</p><pre><code class=\"language-rust\">    let models: Vec&lt;Model&gt; = vec![\n        Model {\n            name: String::from(\"O(1)\"),\n            fn_log: |_n| 0f64,\n        },\n        Model {\n            name: String::from(\"O(log n)\"),\n            fn_log: |n| f64::ln(f64::ln(f64::from(n))),\n        },\n        Model {\n            name: String::from(\"O(n)\"),\n            fn_log: |n| f64::ln(f64::from(n)),\n        },\n        Model {\n            name: String::from(\"O(n log n)\"),\n            fn_log: |n| f64::ln(f64::from(n)) + f64::ln(f64::ln(f64::from(n))),\n        },\n        Model {\n            name: String::from(\"O(n^2)\"),\n            fn_log: |n| 2.0 * f64::ln(f64::from(n)),\n        },\n        Model {\n            name: String::from(\"O(n^2 log n)\"),\n            fn_log: |n| 2.0 * f64::ln(f64::from(n)) + f64::ln(f64::ln(f64::from(n))),\n        },\n        Model {\n            name: String::from(\"O(n^3)\"),\n            fn_log: |n| 3.0 * f64::ln(f64::from(n)),\n        },\n        Model {\n            name: String::from(\"O(2^n)\"),\n            fn_log: |n| f64::from(n) * f64::ln(2.0),\n        },\n    ];</code></pre><p>finally we mapping these models to evaluated models and reducing result to model with smallest <code>r2_log</code></p><pre><code class=\"language-rust\">    models.into_iter().map(|m| { evaluate_r2(m, series) }).reduce(|p, n| {\n        if p.r2_log &lt; n.r2_log { p } else { n }\n    }).unwrap().name\n}</code></pre><p>its everything. Now we can change last line of <code>main</code> to</p><pre><code class=\"language-rust\">    println!(\"{}\", select_model(&amp;read_series(buffer)));\n</code></pre><p>and our program works.</p><p>Traditionally you can check full code with test on my github</p><figure class=\"kg-card kg-bookmark-card\"><a class=\"kg-bookmark-container\" href=\"https://github.com/gustawdaniel/codingame-computational-complexity\"><div class=\"kg-bookmark-content\"><div class=\"kg-bookmark-title\">GitHub - gustawdaniel/codingame-computational-complexity</div><div class=\"kg-bookmark-description\">Contribute to gustawdaniel/codingame-computational-complexity development by creating an account on GitHub.</div><div class=\"kg-bookmark-metadata\"><img class=\"kg-bookmark-icon\" src=\"https://github.githubassets.com/favicons/favicon.svg\"><span class=\"kg-bookmark-author\">GitHub</span><span class=\"kg-bookmark-publisher\">gustawdaniel</span></div></div><div class=\"kg-bookmark-thumbnail\"><img src=\"https://opengraph.githubassets.com/b83a08ea9a2eb23cbe830b203c1492ccd02096878a68b63e97a8a741dd437a78/gustawdaniel/codingame-computational-complexity\"></div></a></figure><figure class=\"kg-card kg-image-card\"><img src=\"__GHOST_URL__/content/images/2023/01/curve_fitting_2x.png\" class=\"kg-image\" alt loading=\"lazy\" width=\"1241\" height=\"1968\" srcset=\"__GHOST_URL__/content/images/size/w600/2023/01/curve_fitting_2x.png 600w, __GHOST_URL__/content/images/size/w1000/2023/01/curve_fitting_2x.png 1000w, __GHOST_URL__/content/images/2023/01/curve_fitting_2x.png 1241w\" sizes=\"(min-width: 720px) 720px\"></figure>","comment_id":"63cd9d9ebbda300a2f29cdc6","plaintext":"We will discuss exercise:\n\nCoding Games and Programming Challenges to Code BetterCodinGame is a\nchallenge-based training platform for programmers where you can play with the\nhottest programming topics. Solve games, code AI bots, learn from your peers,\nhave fun.CodinGame [https://www.codingame.com/ide/puzzle/blunder-episode-3]Goal\nis find best fitting model for given dataset. For example for data:\n\nwe should print O(log n). We can select models from list:\n\n * O(1), \n * O(log n), \n * O(n), \n * O(n log n), \n * O(n^2), \n * O(n^2 log n), \n * O(n^3), \n * O(2^n)\n\nInput of program will contain first line with number of next lines and any\nfollowing line will contain n and t values.\n\nThere are constrains:\n\n5 < N < 1000\n5 < num < 15000\n0 < t < 10000000\n\nand exemplary input:\n\n10\n5 341\n1005 26324\n2005 52585\n3005 78877\n4005 104925\n4805 125920\n6105 159156\n7205 188017\n8105 211417\n9905 258991\n\nshould give to us\n\nO(n)\n\nbecause of is is similar to linear growth.\n\n\n--------------------------------------------------------------------------------\n\nLeast Square Fitting\nWe can derive equation on coefficient and assuming that we want to minimize sum\nof second powers of differences between measurement and prediction of our model.\n\n$$ R^2 = \\sum_i \\left( t_i - f(n_i, a) \\right)^2 $$This approach is called least\nsquares fitting, and you can read more about it on MathWorld\n\nLeast Squares Fitting -- from Wolfram MathWorldA mathematical procedure for\nfinding the best-fitting curve to a given set of points by minimizing the sum\nof\nthe squares of the offsets (“the residuals”) of the points from the curve. The\nsum of the squares of the offsets is used instead of the offset absolute values\nbecause this allows the residua…from Wolfram MathWorld\n[https://mathworld.wolfram.com/LeastSquaresFitting.html]Minimal value means that\npartial derivative by parameter of model a is 0.\n\n$$ \\frac{\\partial (R^2)}{\\partial a} = - 2 \\sum_i \\left( t_i - f(n_i, a) \\right)\n\\frac{\\partial f(n_i, a)}{\\partial a} = 0 $$Linear Regression\nNow we can assume that function is linearly dependent from scaling parameter a.\n\n$$ f(n_i, a) = a * f(n_i) $$Our goal is find equation to compute a and then R^2. Our derivative can be\nsimplified:\n\n$$ \\frac{\\partial f(n_i, a)}{\\partial a} = \\frac{\\partial a f(n_i)}{\\partial a}\n= f(n_i) $$Using last equation from Linear Square Fitting we can compute a\n\n$$ \\sum_i \\left( t_i f(n_i) - a (f(n_i))^2 \\right) = 0 $$so\n\n$$ a = \\frac{\\sum_i t_i f(n_i)}{\\sum (f(n_i))^2 } $$and\n\n$$ R^2 = \\sum_i \\left( t_i - a f(n_i) \\right)^2 $$Our equations looks\nbeautifully but the devil is in the details.\n\nIf we will look at constrains of data for this exercise:\n\n5 < N < 1000\n5 < num < 15000\n0 < t < 10000000\n\nand remember models that we need to test it is easy too see that we will operate\non huge numbers.\n\nFor example 2^n with n = 15 000 is much more than max range of 64 bit float\n\nMAX in std::f64 - RustLargest finite `f64` value. Use [`f64::MAX`] instead.logo\n[https://doc.rust-lang.org/std/f64/constant.MAX.html]that is constrained to 2^1024. There are tricks that allow to operate on these\nranges, but instead of hacking computers constrains we will use math.\n\nInstead of operating on big numbers we will use their logarithm to computation.\n\nLogarithmic Regression\nOur solution is consequence of observation that if we will match logarithms of\nmodels to logarithms of t data then in result will will select the same model.\n\nSo adding log both to data and function we getting equation:\n\n$$ \\frac{\\partial (R^2)}{\\partial a} = - 2 \\sum_i \\left( log( t_i) - log(a\nf(n_i) ) \\right) \\frac{\\partial log( a f(n_i) )}{\\partial a} = 0 $$rewriting\nthis equation we can obtain a\n\n$$ \\sum_i \\left( log( t_i) - log(a) - log( f(n_i)) ) \\right) \\frac{\\partial log(\na ) + log(f(n_i) )}{\\partial a} = 0 $$$$ \\sum_i \\left( log( t_i) - log(a) - log(\nf(n_i)) ) \\right) \\frac{1}{a} = 0 $$$$ a = exp( \\frac{\\sum_i log(t_i) - \\sum_i\nlog(f(n_i))}{N} ) $$where\n\n$$ N = \\sum_i 1 $$and rewriting equation for R^2 we see:\n\n$$ R^2 = \\sum_i ( log( t_i) - log( a * f(n_i) ) )^2 = \\sum_i ( log( t_i) - log(\nf(n_i) ) - log(a) )^2 $$Lets introduce new variable c defined as\n\n$$ c = log(a) = 1/N ( \\sum_i log( t_i) - \\sum_i log( f(n_i)) ) ) $$and then R^2 can be rewritten as\n\n$$ R^2 = \\sum_i ( log( t_i) - log( f(n_i) ) - c )^2 $$we can see that now there\nis no chance to operate on too big numbers so we can start implementation of\nthese equations.\n\nReading series of data from standard input\nLets start from definition of Point structure that represents single\nmeasurement.\n\n#[derive(Debug)]\nstruct Point {\n    n: u32,\n    t: u32,\n}\n\nin main we will read standard input to String named buffer.\n\nfn main() {\n    let mut buffer = String::new();\n    std::io::stdin().read_to_string(&mut buffer).unwrap();\n}\n\nwe want to process this buffer and obtain vector of Points. To do it we writing\nfunction:\n\nfn read_series(input: String) -> Vec<Point> {\n    let mut iterator = input.lines();\n    let n = iterator.next();\n    let mut res: Vec<Point> = vec![];\n\n    if Some(n).is_some() {\n        for line in iterator {\n            if let Some((n, y)) = line.split_once(' ') {\n                res.push(Point {\n                    n: n.parse::<u32>().unwrap_or(0),\n                    t: y.parse::<u32>().unwrap_or(0),\n                });\n            }\n        }\n        return res;\n    }\n\n    return vec![];\n}\n\nwe can check if it works adding to main line\n\n    println!(\"{:?}\", read_series(buffer));\n\nComputing sum on series using closure\nIn presented equations we had some sums, so to simplify further code lets\nimplement sum function that can use closures to define operation what should be\nsummed.\n\nI initially wrote it as noob\n\nfn sum(series: &Vec<Point>, expression: impl Fn(&Point) -> f64) -> f64 {\n    let mut res = 0f64;\n    for point in series {\n        res += expression(point)\n    }\n    res\n}\n\nbut soon fixed as hacker\n\nfn sum(series: &Vec<Point>, expression: impl Fn(&Point) -> f64) -> f64 {\n    series.into_iter().fold(0f64, |acc, point| { acc + expression(point) })\n}\n\nwe can add test\n\n#[cfg(test)]\nmod tests {\n    use crate::{Point, sum};\n\n    #[test]\n    fn sum_test() {\n        assert_eq!(sum(\n            &vec![Point { n: 0u32, t: 1u32 }, Point { n: 1u32, t: 2u32 }],\n            |p: &Point| { f64::from(p.t) },\n        ), 3f64);\n    }\n}\n\nEvaluating Sum of Least Squares\nOur models to test can be represented using structure\n\nstruct Model {\n    name: String,\n    fn_log: fn(u32) -> f64,\n}\n\nbut after computing R^2 we can save result as\n\nstruct EvaluatedMode {\n    name: String,\n    r2_log: f64,\n}\n\nthis is convenient data organization because results of evaluation will be\ncompared by r2_log but then name should be available to print as output.\n\nDue to this reason we will select following signature for R^2 evaluation \n\nfn evaluate_r2(model: Model, series: &Vec<Point>) -> EvaluatedMode\n\nSeries is passed by reference similarly like in sum. We do not want to change\nthem or copy so operating on reference is preferred option for us.\n\nRewriting equations derived before to rust we can implement in this way\n\nfn evaluate_r2(model: Model, series: &Vec<Point>) -> EvaluatedMode {\n    let Model { name, fn_log } = model;\n    let c = 1.0 / series.len() as f64 * sum(\n        &series,\n        |p| { f64::ln(f64::from(p.t)) - fn_log(p.n) },\n    );\n    let r2_log = sum(\n        &series,\n        |p| f64::powi(f64::ln(f64::from(p.t)) - fn_log(p.n) - c, 2),\n    );\n    EvaluatedMode {\n        name,\n        r2_log,\n    }\n}\n\nSelection best fitting model\nTo select model we starting from function signature\n\nfn select_model(series: &Vec<Point>) -> String {\n\nand defining vector with models possible to select. Instead of original\nfunctions we adding fn_log what are logharithms of these functions.\n\n    let models: Vec<Model> = vec![\n        Model {\n            name: String::from(\"O(1)\"),\n            fn_log: |_n| 0f64,\n        },\n        Model {\n            name: String::from(\"O(log n)\"),\n            fn_log: |n| f64::ln(f64::ln(f64::from(n))),\n        },\n        Model {\n            name: String::from(\"O(n)\"),\n            fn_log: |n| f64::ln(f64::from(n)),\n        },\n        Model {\n            name: String::from(\"O(n log n)\"),\n            fn_log: |n| f64::ln(f64::from(n)) + f64::ln(f64::ln(f64::from(n))),\n        },\n        Model {\n            name: String::from(\"O(n^2)\"),\n            fn_log: |n| 2.0 * f64::ln(f64::from(n)),\n        },\n        Model {\n            name: String::from(\"O(n^2 log n)\"),\n            fn_log: |n| 2.0 * f64::ln(f64::from(n)) + f64::ln(f64::ln(f64::from(n))),\n        },\n        Model {\n            name: String::from(\"O(n^3)\"),\n            fn_log: |n| 3.0 * f64::ln(f64::from(n)),\n        },\n        Model {\n            name: String::from(\"O(2^n)\"),\n            fn_log: |n| f64::from(n) * f64::ln(2.0),\n        },\n    ];\n\nfinally we mapping these models to evaluated models and reducing result to model\nwith smallest r2_log\n\n    models.into_iter().map(|m| { evaluate_r2(m, series) }).reduce(|p, n| {\n        if p.r2_log < n.r2_log { p } else { n }\n    }).unwrap().name\n}\n\nits everything. Now we can change last line of main to\n\n    println!(\"{}\", select_model(&read_series(buffer)));\n\n\nand our program works.\n\nTraditionally you can check full code with test on my github\n\nGitHub - gustawdaniel/codingame-computational-complexityContribute to\ngustawdaniel/codingame-computational-complexity development by creating an\naccount on GitHub.GitHubgustawdaniel\n[https://github.com/gustawdaniel/codingame-computational-complexity]","feature_image":"__GHOST_URL__/content/images/2023/01/-s_711994708---gs_7---is_30--regression-graph-merged-in-galaxy-stars-in-cyberpunk-style-more-dark-and-with-cosmic-beauty.jpeg","featured":0,"type":"post","status":"published","locale":null,"visibility":"public","email_recipient_filter":"all","created_at":"2023-01-22T20:33:34.000Z","updated_at":"2023-01-22T23:09:20.000Z","published_at":"2023-01-22T23:09:20.000Z","custom_excerpt":"Linear and logarithmic regressions were derived here. Models were fitted in rust language. This article shows that sometimes it's worth improving the theoretical model before starting implementation.","codeinjection_head":null,"codeinjection_foot":null,"custom_template":null,"canonical_url":null,"newsletter_id":null,"lexical":null},{"id":"63e3962dbbda300a2f29cffd","uuid":"058aebf5-94d8-4898-9c90-81e73e2f1996","title":"Selected syntax in JavaScript ES2020, ES2021 and ES2022","slug":"syntax-in-javascript","mobiledoc":"{\"version\":\"0.3.1\",\"atoms\":[],\"cards\":[[\"image\",{\"src\":\"__GHOST_URL__/content/images/2023/02/rewriting-js-code-to-use-fancy-es6-features-what-it-46582018.png\",\"width\":500,\"height\":441}],[\"code\",{\"code\":\"let name = userName ?? 'default';\",\"language\":\"javascript\"}],[\"code\",{\"code\":\"let name = userName ?? 'default'; // using the nullish coalescing operator\\nlet name = userName || 'default'; // using the logical OR operator\",\"language\":\"javascript\"}],[\"image\",{\"src\":\"__GHOST_URL__/content/images/2023/02/best-js-meme-to-date-2.png\",\"width\":500,\"height\":760}],[\"code\",{\"code\":\"let obj = {\\n  prop1: {\\n    prop2: {\\n      prop3: 'value'\\n    }\\n  }\\n};\\n\\nlet value = obj?.prop1?.prop2?.prop3;\\nconsole.log(value); // Output: \\\"value\\\"\",\"language\":\"javascript\"}],[\"code\",{\"code\":\"let obj = {\\n  prop1: {\\n    prop2: {\\n      prop3: 'value'\\n    }\\n  }\\n};\\n\\nlet value = obj && obj.prop1 && obj.prop1.prop2 && obj.prop1.prop2.prop3;\\nconsole.log(value); // Output: \\\"value\\\"\",\"language\":\"javascript\"}],[\"code\",{\"code\":\"let target = { name: 'John Doe' };\\n\\nlet handler = {\\n  get: function(target, prop) {\\n    console.log(`Accessing property ${prop}`);\\n    return target[prop];\\n  }\\n};\\n\\nlet proxy = new Proxy(target, handler);\\n\\nconsole.log(proxy.name); // Output: Accessing property name\\n//                           John Doe\",\"language\":\"javascript\"}],[\"bookmark\",{\"type\":\"bookmark\",\"url\":\"https://www.digitalocean.com/community/tutorials/js-proxy-traps\",\"metadata\":{\"url\":\"https://www.digitalocean.com/community/tutorials/js-proxy-traps\",\"title\":\"Looking at All 13 JavaScript Proxy Traps | DigitalOcean\",\"description\":\"A collection of code snippets to show all 13 Javascript Proxy traps in action.\",\"author\":\"Jack Misteli\",\"publisher\":\"DigitalOcean\",\"thumbnail\":\"https://www.digitalocean.com/_next/static/media/intro-to-cloud.d49bc5f7.jpeg\",\"icon\":\"https://www.digitalocean.com/_next/static/media/android-chrome-512x512.5f2e6221.png\"}}],[\"code\",{\"code\":\"function invariant (key, action) {\\n  if (key[0] === '_') {\\n    throw new Error(`Invalid attempt to ${action} private \\\"${key}\\\" property`)\\n  }\\n}\\nvar handler = {\\n  get (target, key) {\\n    invariant(key, 'get')\\n    return target[key]\\n  },\\n  set (target, key, value) {\\n    invariant(key, 'set')\\n    return true\\n  },\\n  has (target, key) {\\n    if (key[0] === '_') {\\n      return false\\n    }\\n    return key in target\\n  }\\n}\",\"language\":\"javascript\"}],[\"image\",{\"src\":\"__GHOST_URL__/content/images/2023/02/1_NWihm7jnH3kqUyEBOSpwiw.jpeg\",\"width\":506,\"height\":500}],[\"code\",{\"code\":\"class Person {\\n  #name;\\n\\n  constructor(name) {\\n    this.#name = name;\\n  }\\n\\n  getName() {\\n    return this.#name;\\n  }\\n}\\n\\nlet person = new Person('John Doe');\\nconsole.log(person.getName()); // Output: \\\"John Doe\\\"\\nconsole.log(person.#name); // Output: SyntaxError: Private field '#name' must be accessed within the class declaration.\",\"language\":\"javascript\"}],[\"bookmark\",{\"type\":\"bookmark\",\"url\":\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Classes/Private_class_fields\",\"metadata\":{\"url\":\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Classes/Private_class_fields\",\"title\":\"Private class features - JavaScript | MDN\",\"description\":\"Class fields are public by default, but private class members can be created by using a hash # prefix. The privacy encapsulation of these class features is enforced by JavaScript itself.\",\"author\":null,\"publisher\":\"MDN Web Docs\",\"thumbnail\":\"https://developer.mozilla.org/mdn-social-share.cd6c4a5a.png\",\"icon\":\"https://developer.mozilla.org/apple-touch-icon.6803c6f0.png\"}}],[\"code\",{\"code\":\"let p1 = Promise.resolve(42);\\nlet p2 = Promise.reject(new Error('failed'));\\nlet p3 = Promise.resolve(10);\\n\\nPromise.allSettled([p1, p2, p3]).then((results) => {\\n  console.log(results);\\n  /* Output:\\n  [\\n    { status: 'fulfilled', value: 42 },\\n    { status: 'rejected', reason: Error: failed },\\n    { status: 'fulfilled', value: 10 }\\n  ]\\n  */\\n});\",\"language\":\"javascript\"}],[\"bookmark\",{\"type\":\"bookmark\",\"url\":\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise/allSettled\",\"metadata\":{\"url\":\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise/allSettled\",\"title\":\"Promise.allSettled() - JavaScript | MDN\",\"description\":\"The Promise.allSettled() static method takes an iterable of promises as input and returns a single Promise. This returned promise fulfills when all of the input’s promises settle (including when an empty iterable is passed), with an array of objects that describe the outcome of each promise.\",\"author\":null,\"publisher\":\"MDN Web Docs\",\"thumbnail\":\"https://developer.mozilla.org/mdn-social-share.cd6c4a5a.png\",\"icon\":\"https://developer.mozilla.org/apple-touch-icon.6803c6f0.png\"}}],[\"image\",{\"src\":\"__GHOST_URL__/content/images/2023/02/4014ebe135ed0321c2e4a4975a65a30251c5e44c0c5d3ca3e8fe879b75d309b6.jpg\",\"width\":625,\"height\":1039}],[\"code\",{\"code\":\"const a = BigInt(9007199254740992);\\nconst b = BigInt(1);\\nconsole.log(a + b); // Output: 9007199254740993n\",\"language\":\"javascript\"}],[\"code\",{\"code\":\"console.log(9007199254740992 + 1); // 9007199254740992\\n\",\"language\":\"javascript\"}],[\"code\",{\"code\":\"BigInt(1) / BigInt(0); // Uncaught RangeError: Division by zero\",\"language\":\"javascript\"}],[\"code\",{\"code\":\"BigInt(1) / 0; // Uncaught TypeError: Cannot mix BigInt and other types, use explicit conversions\",\"language\":\"javascript\"}],[\"bookmark\",{\"type\":\"bookmark\",\"url\":\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/BigInt\",\"metadata\":{\"url\":\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/BigInt\",\"title\":\"BigInt - JavaScript | MDN\",\"description\":\"BigInt values represent numeric values which are too large to be represented by the number primitive.\",\"author\":null,\"publisher\":\"MDN Web Docs\",\"thumbnail\":\"https://developer.mozilla.org/mdn-social-share.cd6c4a5a.png\",\"icon\":\"https://developer.mozilla.org/apple-touch-icon.6803c6f0.png\"}}],[\"image\",{\"src\":\"__GHOST_URL__/content/images/2023/02/ezgif-2-e3e834a0e1.jpg\",\"width\":720,\"height\":333}],[\"code\",{\"code\":\"// ? say.mjs\\nconsole.log(\\\"Now file is imported\\\");\\n\\nexport function hi() {\\n  console.log(`Hello`);\\n}\\n\\nexport function bye() {\\n  console.log(`Bye`);\\n}\\n\\n\",\"language\":\"javascript\"}],[\"code\",{\"code\":\"async function main() {\\n  let {hi, bye} = await import('./say.mjs');\\n\\n  hi();\\n  bye();\\n}\\n\\nconsole.log(\\\"Import not executed yet\\\");\\nmain().catch(console.error);\",\"language\":\"javascript\"}],[\"code\",{\"code\":\"Import not executed yet\\nNow file is imported\\nHello\\nBye\\n\"}],[\"bookmark\",{\"type\":\"bookmark\",\"url\":\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/import\",\"metadata\":{\"url\":\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/import\",\"title\":\"import - JavaScript | MDN\",\"description\":\"The static import declaration is used to import read-only live bindings which are exported by another module. The imported bindings are called live bindings because they are updated by the module that exported the binding, but cannot be re-assigned by the importing module.\",\"author\":null,\"publisher\":\"MDN Web Docs\",\"thumbnail\":\"https://developer.mozilla.org/mdn-social-share.cd6c4a5a.png\",\"icon\":\"https://developer.mozilla.org/apple-touch-icon.6803c6f0.png\"}}],[\"bookmark\",{\"type\":\"bookmark\",\"url\":\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/import\",\"metadata\":{\"url\":\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/import\",\"title\":\"import() - JavaScript | MDN\",\"description\":\"The import() syntax, commonly called dynamic import, is a function-like expression that allows loading an ECMAScript module asynchronously and dynamically into a potentially non-module environment.\",\"author\":null,\"publisher\":\"MDN Web Docs\",\"thumbnail\":\"https://developer.mozilla.org/mdn-social-share.cd6c4a5a.png\",\"icon\":\"https://developer.mozilla.org/apple-touch-icon.6803c6f0.png\"}}],[\"code\",{\"code\":\"const originalString = \\\"Hello world! Hello again.\\\";\\nconst newString = originalString.replaceAll(\\\"Hello\\\", \\\"Goodbye\\\");\\nconsole.log(newString); // Goodbye world! Goodbye again.\",\"language\":\"javascript\"}],[\"code\",{\"code\":\"const originalString = \\\"Hello world! Hello again.\\\";\\nconst newString = originalString.replace(/Hello/g, \\\"Goodbye\\\");\\nconsole.log(newString); // Goodbye world! Goodbye again.\",\"language\":\"javascript\"}],[\"code\",{\"code\":\"const x = 1000000000;\\n\",\"language\":\"javascript\"}],[\"code\",{\"code\":\"const x = 1_000_000_000;\",\"language\":\"javascript\"}],[\"code\",{\"code\":\"const y = 0b1010_0101_1001_0010;\",\"language\":\"javascript\"}],[\"code\",{\"code\":\"const z = 0xff_ff_ff;\",\"language\":\"javascript\"}],[\"image\",{\"src\":\"__GHOST_URL__/content/images/2023/02/7afbd5.jpg\",\"width\":500,\"height\":559}],[\"code\",{\"code\":\"const originalString = \\\"Hello world! Hello again.\\\";\\nconst regex = /Hello/g;\\nconst matches = originalString.matchAll(regex);\",\"language\":\"javascript\"}],[\"image\",{\"src\":\"__GHOST_URL__/content/images/2023/02/Zrzut-ekranu-z-2023-02-08-21-08-00.png\",\"width\":399,\"height\":124}],[\"code\",{\"code\":\"m = matches.next()\",\"language\":\"javascript\"}],[\"image\",{\"src\":\"__GHOST_URL__/content/images/2023/02/Zrzut-ekranu-z-2023-02-08-21-08-50.png\",\"width\":402,\"height\":213}],[\"code\",{\"code\":\"for (const match of matches) {\\n  console.log(match[0]);\\n}\\n// Hello\\n// Hello\",\"language\":\"javascript\"}],[\"image\",{\"src\":\"__GHOST_URL__/content/images/2023/02/Zrzut-ekranu-z-2023-02-08-21-11-07.png\",\"width\":566,\"height\":131}],[\"code\",{\"code\":\"const originalString = \\\"Hello world! Hello again.\\\";\\nconst regex = /Hello/g;\\nconst matches = originalString.match(regex);\\nconsole.log(matches); // [ \\\"Hello\\\", \\\"Hello\\\" ]\",\"language\":\"javascript\"}],[\"code\",{\"code\":\"x &&= y\",\"language\":\"javascript\"}],[\"code\",{\"code\":\"x && (x = y);\\n\"}],[\"code\",{\"code\":\"let x = 1;\\nx &&= 2;\\nconsole.log(x); // 2\\n\\nx = 0;\\nx &&= 2;\\nconsole.log(x); // 0\",\"language\":\"javascript\"}],[\"code\",{\"code\":\"let x = null;\\nx ||= 1;\\nconsole.log(x); // 1\\n\\nx = 2;\\nx ||= 1;\\nconsole.log(x); // 2\",\"language\":\"javascript\"}],[\"code\",{\"code\":\"let x = null;\\nx ??= 1;\\nconsole.log(x); // 1\\n\\nx = 2;\\nx ??= 1;\\nconsole.log(x); // 2\",\"language\":\"javascript\"}],[\"image\",{\"src\":\"__GHOST_URL__/content/images/2023/02/7afchc.gif\",\"width\":260,\"height\":203}],[\"code\",{\"code\":\"const promise1 = Promise.resolve(1);\\nconst promise2 = Promise.reject(new Error(\\\"error\\\"));\\nconst promise3 = Promise.resolve(3);\\n\\nPromise.any([promise1, promise2, promise3])\\n  .then((value) => {\\n    console.log(value); // 1\\n  })\\n  .catch((error) => {\\n    console.error(error);\\n  });\",\"language\":\"javascript\"}],[\"image\",{\"src\":\"__GHOST_URL__/content/images/2023/02/ezgif-2-b971e352d2.jpg\",\"width\":720,\"height\":531}],[\"code\",{\"code\":\"a = [0,1,2]\\na.at(0); // 0\\na.at(4); // undefined\\na.at(-2); // 1\\na.at(Infinity); // undefined\"}],[\"code\",{\"code\":\"a[(a.length + n) % a.length]\"}],[\"code\",{\"code\":\"a[(a.length + 0) % a.length] // 0 as a.at(0)\\na[(a.length + 4) % a.length] // 1\\na[(a.length -2) % a.length] // 1\\na[(a.length + Infinity) % a.length] // undefined\"}],[\"code\",{\"code\":\"const colors = fetch(\\\"../data/colors.json\\\").then((response) => response.json());\\n\\nexport default await colors;\",\"language\":\"javascript\"}],[\"code\",{\"code\":\"// file objects.mjs\\nconst res = fetch('https://api.restful-api.dev/objects');\\n\\nexport default await (await res).json();\"}],[\"code\",{\"code\":\"// file index.js\\nasync function main() {\\n  let ok = await import('./objects.mjs');\\n  console.log(ok.default);\\n}\\n\\nmain().catch(console.error);\\n\"}],[\"code\",{\"code\":\"[\\n  {\\n    id: '1',\\n    name: 'Google Pixel 6 Pro',\\n    data: { color: 'Cloudy White', capacity: '128 GB' }\\n  },\\n  ...\\n]\"}],[\"bookmark\",{\"type\":\"bookmark\",\"url\":\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/await\",\"metadata\":{\"url\":\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/await\",\"title\":\"await - JavaScript | MDN\",\"description\":\"The await operator is used to wait for a Promise and get its fulfillment value. It can only be used inside an async function or at the top level of a module.\",\"author\":null,\"publisher\":\"MDN Web Docs\",\"thumbnail\":\"https://developer.mozilla.org/mdn-social-share.cd6c4a5a.png\",\"icon\":\"https://developer.mozilla.org/apple-touch-icon.6803c6f0.png\"}}],[\"hr\",{}]],\"markups\":[[\"code\"],[\"a\",[\"href\",\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/WeakMap#emulating_private_members\"]],[\"a\",[\"href\",\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Closures#emulating_private_methods_with_closures\"]],[\"strong\"],[\"em\"]],\"sections\":[[1,\"p\",[[0,[],0,\"Javascript is main primary language. But his dynamic development insist from me constant updates of my knowledge about it. In this article I will show few syntax that I learned in last two years and which was not available if you get know JavaScript earlier.\"]]],[1,\"p\",[[0,[],0,\"It is possible that some of them are known for you, but I hope that some of them will extend your skill in JS syntax. To save your time I am adding table of content:\"]]],[3,\"ul\",[[[0,[],0,\"ES2020 - Nullish coalescing\"]],[[0,[],0,\"ES2020 - Optional chaining\"]],[[0,[],0,\"ES2015 - Proxies\"]],[[0,[],0,\"ES2022 - Private fields\"]],[[0,[],0,\"ES2020 - Promise.allSettled\"]],[[0,[],0,\"ES2020 - BigInt\"]],[[0,[],0,\"ES2020 - Dynamic Import\"]],[[0,[],0,\"ES2022 - String.replaceAll\"]],[[0,[],0,\"ES2020 - Numeric Separators\"]],[[0,[],0,\"ES2020 - String.matchAll\"]],[[0,[],0,\"ES2021 - Logical Assignment\"]],[[0,[],0,\"ES2020 - Promise.any\"]],[[0,[],0,\"ES2022 - Array.prototype.at\"]],[[0,[],0,\"ES2022 - Top level await\"]]]],[10,0],[1,\"h2\",[[0,[],0,\"Nullish coalescing operator ?? [ more strict || ]\"]]],[1,\"p\",[[0,[],0,\"The nullish coalescing operator (\"],[0,[0],1,\"??\"],[0,[],0,\") in JavaScript ES2020 is a logical operator that returns the right-hand side operand when the left-hand side operand is \"],[0,[0],1,\"null\"],[0,[],0,\" or \"],[0,[0],1,\"undefined\"],[0,[],0,\", and returns the left-hand side operand otherwise.\"]]],[1,\"p\",[[0,[],0,\"Here's an example of how the nullish coalescing operator can be used in JavaScript\"]]],[10,1],[1,\"p\",[[0,[],0,\"In this example, if \"],[0,[0],1,\"userName\"],[0,[],0,\" is \"],[0,[0],1,\"null\"],[0,[],0,\" or \"],[0,[0],1,\"undefined\"],[0,[],0,\", the value of \"],[0,[0],1,\"name\"],[0,[],0,\" will be set to \"],[0,[0],1,\"'default'\"],[0,[],0,\". If \"],[0,[0],1,\"userName\"],[0,[],0,\" has a truthy value, the value of \"],[0,[0],1,\"name\"],[0,[],0,\" will be set to that value.\"]]],[1,\"p\",[[0,[],0,\"The nullish coalescing operator is different from the previously applied techniques, such as the logical OR operator (\"],[0,[0],1,\"||\"],[0,[],0,\"), in that the logical OR operator returns the right-hand side operand when the left-hand side operand is falsy, which includes not just \"],[0,[0],1,\"null\"],[0,[],0,\" and \"],[0,[0],1,\"undefined\"],[0,[],0,\", but also values such as \"],[0,[0],1,\"0\"],[0,[],0,\", \"],[0,[0],1,\"''\"],[0,[],0,\", and \"],[0,[0],1,\"false\"],[0,[],0,\".\"]]],[1,\"p\",[[0,[],0,\"Here's an example that demonstrates the difference between the nullish coalescing operator and the logical OR operator:\"]]],[10,2],[1,\"p\",[[0,[],0,\"In the first example, if \"],[0,[0],1,\"userName\"],[0,[],0,\" is \"],[0,[0],1,\"null\"],[0,[],0,\" or \"],[0,[0],1,\"undefined\"],[0,[],0,\", the value of \"],[0,[0],1,\"name\"],[0,[],0,\" will be set to \"],[0,[0],1,\"'default'\"],[0,[],0,\". In the second example, if \"],[0,[0],1,\"userName\"],[0,[],0,\" is falsy, the value of \"],[0,[0],1,\"name\"],[0,[],0,\" will also be set to \"],[0,[0],1,\"'default'\"],[0,[],0,\".\"]]],[1,\"p\",[[0,[],0,\"So, in short, the nullish coalescing operator is a more strict and specific way to handle default values in JavaScript, compared to the logical OR operator.\"]]],[10,3],[1,\"h2\",[[0,[],0,\"Optional chaining .? [ less strict props access ]\"]]],[1,\"p\",[[0,[],0,\"Optional chaining in JavaScript is a feature introduced in ECMAScript 2020 that allows you to access an object property, an array element, or a function return value safely and avoid \"],[0,[0],1,\"TypeError\"],[0,[],0,\" in case of accessing an undefined object or a null value. It's written using a \"],[0,[0],1,\"?.\"],[0,[],0,\" syntax and can be used to access nested properties of an object.\"]]],[1,\"p\",[[0,[],0,\"For example, consider the following code that uses optional chaining:\"]]],[10,4],[1,\"p\",[[0,[],0,\"Prior to optional chaining, a common approach to avoid the \"],[0,[0],1,\"TypeError\"],[0,[],0,\" was to use the \"],[0,[0],1,\"&&\"],[0,[],0,\" operator and check for \"],[0,[0],1,\"null\"],[0,[],0,\" and \"],[0,[0],1,\"undefined\"],[0,[],0,\" values:\"]]],[10,5],[1,\"p\",[[0,[],0,\"The main difference between optional chaining and this approach is that optional chaining is more concise, readable, and expressive. It's also less error-prone, as it eliminates the need to manually check for \"],[0,[0],1,\"null\"],[0,[],0,\" and \"],[0,[0],1,\"undefined\"],[0,[],0,\" values at every step.\"]]],[1,\"h2\",[[0,[],0,\"Proxies [ for metaprogramming like reflection ]\"]]],[1,\"p\",[[0,[],0,\"A proxy in JavaScript is an object that acts as an intermediary between a target object and the code that interacts with it. Proxies are used to intercept and modify operations performed on the target object, such as property access, method calls, and object assignments. This makes them a powerful tool for adding custom behavior to existing objects, enforcing constraints, and creating abstractions.\"]]],[1,\"p\",[[0,[],0,\"An example use case of a proxy is to add a logging mechanism to an object to track when its properties are accessed. Here's an example of how this can be done using a proxy:\"]]],[10,6],[1,\"p\",[[0,[],0,\"In this example, we define a target object and a handler object. The handler object contains a \"],[0,[0],1,\"get\"],[0,[],0,\" method that logs a message and returns the value of the target object's property. Finally, we create a new proxy object by passing the target and the handler to the \"],[0,[0],1,\"Proxy\"],[0,[],0,\" constructor. When we access the \"],[0,[0],1,\"name\"],[0,[],0,\" property of the proxy object, the \"],[0,[0],1,\"get\"],[0,[],0,\" method of the handler is called, logging the message and returning the value of the target object's property.\"]]],[1,\"p\",[[0,[],0,\"It is example of Reflection - a feature that allows a program to inspect and manipulate its own structure and behavior at runtime. This includes introspection of objects, classes, and methods, as well as modification of their properties and behavior.\"]]],[1,\"p\",[[0,[],0,\"In our example there is \"],[0,[0],1,\"console.log\"],[0,[],0,\" but you can use any logic in get or set traps. For example notifying other parts of program about change or logging changes history. Proxy is extensively used in implementation of reactivity in frontend frameworks like Vue.\"]]],[1,\"p\",[[0,[],0,\"There is 13 traps in Proxy that are described here:\"]]],[10,7],[1,\"p\",[[0,[],0,\"I will show only 3 most popular \"],[0,[0],1,\"get\"],[0,[],0,\", \"],[0,[0],1,\"set\"],[0,[],0,\" and \"],[0,[0],1,\"has\"],[0,[],0,\". In example below we can build handler that allow us to build objects that prevent to access to \\\"private\\\" properties.\"]]],[10,8],[1,\"p\",[[0,[],0,\"Proxies deserve for distinct article, but I hope you feel to be inspired to learn them deeper.\"]]],[10,9],[1,\"h2\",[[0,[],0,\"Private fields [ privacy without WeakMap and closures ]\"]]],[1,\"p\",[[0,[],0,\"Private fields in JavaScript are a feature introduced in ECMAScript 2020 that allow you to define properties on an object that are not accessible from outside of the object. They are written using a \"],[0,[0],1,\"#\"],[0,[],0,\" symbol before the property name and are only accessible within the object's methods.\"]]],[1,\"p\",[[0,[],0,\"Private members are not native to the language before this syntax existed. In prototypical inheritance, its behavior may be emulated with \"],[0,[1,0],2,\"WeakMap\"],[0,[],0,\" objects or \"],[0,[2],1,\"closures\"],[0,[],0,\", but they can't compare to the \"],[0,[0],1,\"#\"],[0,[],0,\" syntax in terms of ergonomics.\"]]],[1,\"p\",[[0,[],0,\"Here's an example of how private fields can be used in JavaScript:\"]]],[10,10],[1,\"p\",[[0,[],0,\"In this example, we define a \"],[0,[0],1,\"Person\"],[0,[],0,\" class with a private field \"],[0,[0],1,\"#name\"],[0,[],0,\". The \"],[0,[0],1,\"#name\"],[0,[],0,\" field is assigned a value in the constructor, and a \"],[0,[0],1,\"getName\"],[0,[],0,\" method is defined to return its value. When we try to access the \"],[0,[0],1,\"#name\"],[0,[],0,\" field outside of the \"],[0,[0],1,\"Person\"],[0,[],0,\" class, we get a \"],[0,[0],1,\"SyntaxError\"],[0,[],0,\" indicating that private fields must be accessed within the class declaration.\"]]],[1,\"p\",[[0,[],0,\"Private fields provide a way to encapsulate an object's internal state and prevent it from being modified or accessed directly. This makes it easier to maintain the integrity of the object's data and enforce its internal invariants.\"]]],[1,\"p\",[[0,[],0,\"It is great that this feature was introduced but i think it seems to be still quite unknown. More detailed specs below:\"]]],[10,11],[1,\"h2\",[[0,[],0,\"Promise.allSettled() [ for concurrent programming ]\"]]],[1,\"p\",[[0,[],0,\"The \"],[0,[0],1,\"Promise.allSettled()\"],[0,[],0,\" method in JavaScript is used to create a single Promise that resolves when all of the promises in an iterable have settled (either fulfilled or rejected). It returns an array of objects that represent the outcome of each promise, rather than a single value or an error.\"]]],[1,\"p\",[[0,[],0,\"Here's an example of how \"],[0,[0],1,\"Promise.allSettled()\"],[0,[],0,\" can be used in JavaScript:\"]]],[10,12],[1,\"p\",[[0,[],0,\"In this example, we create three promises: \"],[0,[0],1,\"p1\"],[0,[],0,\", \"],[0,[0],1,\"p2\"],[0,[],0,\", and \"],[0,[0],1,\"p3\"],[0,[],0,\". \"],[0,[0],1,\"p1\"],[0,[],0,\" is a resolved promise with a value of 42, \"],[0,[0],1,\"p2\"],[0,[],0,\" is a rejected promise with an error message, and \"],[0,[0],1,\"p3\"],[0,[],0,\" is a resolved promise with a value of 10. We then pass these promises as an iterable to \"],[0,[0],1,\"Promise.allSettled()\"],[0,[],0,\" and log the results when they have all settled. The result is an array of objects that represent the outcome of each promise, with a \"],[0,[0],1,\"status\"],[0,[],0,\" property that indicates whether the promise was fulfilled or rejected, and a \"],[0,[0],1,\"value\"],[0,[],0,\" or \"],[0,[0],1,\"reason\"],[0,[],0,\" property that contains the result or error.\"]]],[1,\"p\",[[0,[],0,\"The \"],[0,[0],1,\"Promise.allSettled()\"],[0,[],0,\" method is useful when you want to wait for multiple promises to complete, but you don't need to know the outcome of each promise in order to continue. Unlike \"],[0,[0],1,\"Promise.all()\"],[0,[],0,\", which rejects with the first error that occurs, \"],[0,[0],1,\"Promise.allSettled()\"],[0,[],0,\" will wait for all promises to settle before resolving, even if some of them are rejected.\"]]],[10,13],[10,14],[1,\"h2\",[[0,[],0,\"BigInt [ for Math and huge Id from databases ]\"]]],[1,\"p\",[[0,[],0,\"BigInt is a new primitive type in JavaScript that was introduced in ECMAScript 2020. It represents an arbitrarily large integer and allows you to perform arithmetic operations with values that can be larger than the \"],[0,[0],1,\"Number\"],[0,[],0,\" type's maximum safe integer value of \"],[0,[0],1,\"2^53 - 1\"],[0,[],0,\".\"]]],[1,\"p\",[[0,[],0,\"Here's an example of how BigInt can be used in JavaScript:\"]]],[10,15],[1,\"p\",[[0,[],0,\"In this example, we create two BigInt values and perform an addition operation on them. The result is a BigInt value that accurately represents the result of the calculation, even though it exceeds the maximum safe integer value of \"],[0,[0],1,\"Number\"],[0,[],0,\".\"]]],[1,\"p\",[[0,[],0,\"For comparison adding one to such big \"],[0,[0],1,\"Number\"],[0,[],0,\" your will get wrong result\"]]],[10,16],[1,\"p\",[[0,[],0,\"Another difference is that BigInt values support a more limited set of arithmetic and comparison operations than \"],[0,[0],1,\"Number\"],[0,[],0,\" values. For example, BigInt values do not support operations such as division by zero, NaN, or Infinity.\"]]],[10,17],[1,\"p\",[[0,[],0,\"and\"]]],[10,18],[1,\"p\",[[0,[],0,\"BigInt provides a way to represent and manipulate large integers in JavaScript without the loss of precision that can occur with the \"],[0,[0],1,\"Number\"],[0,[],0,\" type. It is particularly useful in cases where you need to perform calculations with values that exceed the maximum safe integer value of \"],[0,[0],1,\"Number\"],[0,[],0,\".\"]]],[10,19],[10,20],[1,\"h2\",[[0,[],0,\"Dynamic Import\"]]],[1,\"p\",[[0,[],0,\"Dynamic Import is a feature in JavaScript that allows you to load a module or a piece of code asynchronously at runtime, rather than at the time of parsing and executing the script. This allows you to load only the resources that you need when you need them, rather than loading everything upfront, which can improve the performance and load time of your application.\"]]],[1,\"p\",[[0,[],0,\"Here's an example of how Dynamic Import can be used in JavaScript:\"]]],[10,21],[1,\"p\",[[0,[],0,\"and\"]]],[10,22],[1,\"p\",[[0,[],0,\"Command \"],[0,[0],1,\"node index.js\"],[0,[],0,\" will print\"]]],[10,23],[1,\"p\",[[0,[],0,\"In this example, we use the \"],[0,[0],1,\"import()\"],[0,[],0,\" function to load a module \"],[0,[0],1,\"module.js\"],[0,[],0,\" asynchronously. The \"],[0,[0],1,\"import()\"],[0,[],0,\" function returns a Promise that resolves to the module object, which we can then access using destructuring or the default property.\"]]],[1,\"p\",[[0,[],0,\"Dynamic Import is different from the other import types (such as \"],[0,[0],1,\"import\"],[0,[],0,\" and \"],[0,[0],1,\"require\"],[0,[],0,\" statements) in a few key ways:\"]]],[3,\"ul\",[[[0,[],0,\"Load Time: Dynamic Import is loaded at runtime, when the \"],[0,[0],1,\"import()\"],[0,[],0,\" function is called, rather than at the time of parsing the script. This means that the module or code is only loaded when it is actually needed, which can improve the performance and load time of your application.\"]],[[0,[],0,\"Return Value: Dynamic Import returns a Promise that resolves to the module object, rather than the module object itself. This allows you to load the module asynchronously and handle the result when it is available, rather than blocking the execution of the script while the module is being loaded.\"]],[[0,[],0,\"Code Splitting: Dynamic Import enables you to split your code into smaller, more manageable pieces that can be loaded on demand. This can improve the performance and scalability of your application by reducing the amount of code that needs to be loaded and parsed at the start of your script.\"]]]],[1,\"p\",[[0,[],0,\"Dynamic Import provides a flexible and powerful way to load code asynchronously in JavaScript, and is particularly useful for large and complex applications that need to load resources on demand. By using Dynamic Import, you can optimize the performance and load time of your application, and improve the overall user experience.\"]]],[1,\"p\",[[0,[],0,\"You can learn more comparing docs of static import\"]]],[10,24],[1,\"p\",[[0,[],0,\"With dynamic import described here\"]]],[10,25],[1,\"p\",[[0,[],0,\"Thanks to dynamic imports you can manage both time of importing and patch to imported module in runtime what can be useful for example if you have to load dictionary with translations of your website or picking one component instead of all to display first page.\"]]],[1,\"h2\",[[0,[],0,\"replaceAll [ concise syntax for replace with //g ]\"]]],[1,\"p\",[[0,[],0,\"The \"],[0,[0],1,\"String.prototype.replaceAll\"],[0,[],0,\" method in JavaScript is a recent addition (part of the ECMAScript 2022 standard) that provides a more straightforward way to perform global search-and-replace operations on strings. Unlike the previous method of using \"],[0,[0],1,\"String.prototype.replace\"],[0,[],0,\" with a regular expression and the \"],[0,[0],1,\"g\"],[0,[],0,\" (global) flag, \"],[0,[0],1,\"String.prototype.replaceAll\"],[0,[],0,\" provides a simpler syntax for this common use case.\"]]],[1,\"p\",[[0,[],0,\"For example, to globally replace all occurrences of a target string with another string, you can use \"],[0,[0],1,\"replaceAll\"],[0,[],0,\" as follows:\"]]],[10,26],[1,\"p\",[[0,[],0,\"In comparison, using \"],[0,[0],1,\"replace\"],[0,[],0,\" with a regular expression and the \"],[0,[0],1,\"g\"],[0,[],0,\" flag would look like this:\"]]],[10,27],[1,\"p\",[[0,[],0,\"As you can see, \"],[0,[0],1,\"replaceAll\"],[0,[],0,\" provides a more concise and readable syntax for this common use case.\"]]],[1,\"h2\",[[0,[],0,\"Numeric Separators [ sugar for code redability ]\"]]],[1,\"p\",[[0,[],0,\"Numeric separators in JavaScript are a recent addition (part of the ECMAScript 2020 standard) that allow developers to make large numbers easier to read by adding underscores as separators between groups of digits. The underscores are ignored during evaluation, but serve as a visual aid to separate the digits.\"]]],[1,\"p\",[[0,[],0,\"For example, instead of writing:\"]]],[10,28],[1,\"p\",[[0,[],0,\"You can write:\"]]],[10,29],[1,\"p\",[[0,[],0,\"This makes it easier to see the different groups of digits, especially in large numbers. Numeric separators can be used with decimal literals as well as binary, octal, and hexadecimal literals.\"]]],[1,\"p\",[[0,[],0,\"Here's an example using binary literals:\"]]],[10,30],[1,\"p\",[[0,[],0,\"And here's an example using hexadecimal literals:\"]]],[10,31],[1,\"p\",[[0,[],0,\"In all cases, the numeric separators are ignored during evaluation, and the values are stored and used just like any other number in JavaScript.\"]]],[10,32],[1,\"h2\",[[0,[],0,\"matchAll [ access to matches for //g regex ]\"]]],[1,\"p\",[[0,[],0,\"The \"],[0,[0],1,\"String.prototype.matchAll()\"],[0,[],0,\" method in JavaScript is a recent addition (part of the ECMAScript 2020 standard) that provides a new way to extract all matches of a regular expression from a string. Unlike the previous method of using \"],[0,[0],1,\"String.prototype.match\"],[0,[],0,\" with a regular expression, \"],[0,[0],1,\"String.prototype.matchAll\"],[0,[],0,\" returns an iterator that yields all matches, rather than just the first match or all matches as an array.\"]]],[1,\"p\",[[0,[],0,\"For example, to extract all occurrences of a target string from a string, you can use \"],[0,[0],1,\"matchAll\"],[0,[],0,\" as follows:\"]]],[10,33],[1,\"p\",[[0,[],0,\"now \"],[0,[0],1,\"matches\"],[0,[],0,\" is object \"],[0,[0],1,\"RegExpStringIterator\"],[0,[],0,\".\"]]],[10,34],[1,\"p\",[[0,[],0,\"we can get acess to single match by \"],[0,[0],1,\"next\"]]],[10,35],[1,\"p\",[[0,[],0,\"then \"],[0,[0],1,\"m\"],[0,[],0,\" will be object with bolean \"],[0,[0],1,\"done\"],[0,[],0,\" and \"],[0,[0],1,\"value\"],[0,[],0,\" that contains details about match.\"]]],[10,36],[1,\"p\",[[0,[],0,\"second option to get matches is iteration\"]]],[10,37],[1,\"p\",[[0,[],0,\"or \"]]],[10,38],[1,\"p\",[[0,[],0,\"In comparison, using \"],[0,[0],1,\"match\"],[0,[],0,\" with a regular expression would look like this:\"]]],[10,39],[1,\"p\",[[0,[],0,\"so \"],[0,[0],1,\"match\"],[0,[],0,\" is losing access to index, input and groups when was used with \"],[0,[0],1,\"//g\"],[0,[],0,\" regex. \"]]],[1,\"p\",[[0,[],0,\"As you can see, matchAll provides a way to work with each match one by one, rather than having to process all matches as an array. This can be useful in certain cases, such as when you need to perform additional processing on each match, or when you need to extract information from the captured groups within each match. Additionally, because \"],[0,[0],1,\"matchAll\"],[0,[],0,\" returns an iterator, you can use it in a \"],[0,[0],1,\"for...of\"],[0,[],0,\" loop, which can make your code more readable and concise.\"]]],[1,\"h2\",[[0,[],0,\"Logical Assignment [ conditional assignment ]\"]]],[1,\"p\",[[0,[],0,\"Logical assignment in JavaScript is a new feature (part of the ECMAScript 2021 standard) that allows you to simplify and condense certain types of assignments that involve logical operations. It provides a shorthand for combining an assignment with a logical operation, such as \"],[0,[0],1,\"&&\"],[0,[],0,\" or \"],[0,[0],1,\"||\"],[0,[],0,\".\"]]],[1,\"p\",[[0,[],0,\"The logical assignment operators are \"],[0,[0],1,\"&&=\"],[0,[],0,\", \"],[0,[0],1,\"||=\"],[0,[],0,\", and \"],[0,[0],1,\"??=\"],[0,[],0,\". They perform the same operations as the corresponding logical operators, but with the added behavior of assignment.\"]]],[10,40],[1,\"p\",[[0,[],0,\"is equivalent to\"]]],[10,41],[1,\"p\",[[0,[],0,\"Here's an example using the \"],[0,[0],1,\"&&=\"],[0,[],0,\" operator:\"]]],[10,42],[1,\"p\",[[0,[],0,\"In the first case, \"],[0,[0],1,\"x\"],[0,[],0,\" is assigned the value of \"],[0,[0],1,\"2\"],[0,[],0,\", because \"],[0,[0],1,\"1 && 2\"],[0,[],0,\" is \"],[0,[0],1,\"2\"],[0,[],0,\". In the second case, \"],[0,[0],1,\"x\"],[0,[],0,\" is assigned the value of \"],[0,[0],1,\"0\"],[0,[],0,\", because \"],[0,[0],1,\"0 && 2\"],[0,[],0,\" is \"],[0,[0],1,\"0\"],[0,[],0,\".\"]]],[1,\"p\",[[0,[],0,\"Here's an example using the \"],[0,[0],1,\"||=\"],[0,[],0,\" operator:\"]]],[10,43],[1,\"p\",[[0,[],0,\"In the first case, \"],[0,[0],1,\"x\"],[0,[],0,\" is assigned the value of \"],[0,[0],1,\"1\"],[0,[],0,\", because \"],[0,[0],1,\"null || 1\"],[0,[],0,\" is \"],[0,[0],1,\"1\"],[0,[],0,\". In the second case, \"],[0,[0],1,\"x\"],[0,[],0,\" is assigned the value of \"],[0,[0],1,\"2\"],[0,[],0,\", because \"],[0,[0],1,\"2 || 1\"],[0,[],0,\" is \"],[0,[0],1,\"2\"],[0,[],0,\".\"]]],[1,\"p\",[[0,[],0,\"And here's an example using the \"],[0,[0],1,\"??=\"],[0,[],0,\" operator:\"]]],[10,44],[1,\"p\",[[0,[],0,\"In the first case, x is assigned the value of 1, because null ?? 1 is 1. In the second case, x is assigned the value of 2, because 2 ?? 1 is 2. The ?? operator is similar to the || operator, but it only evaluates the right-side expression if the left-side expression is null or undefined.\"]]],[10,45],[1,\"h2\",[[0,[],0,\"Promise.any() [ for racings ]\"]]],[1,\"p\",[[0,[],0,\"The \"],[0,[0],1,\"Promise.any()\"],[0,[],0,\" method in JavaScript is a recent addition (part of the ECMAScript 2020 standard) that allows you to wait for the first of several promises to settle (i.e., to either resolve or reject), and then return the result of that promise. It provides a way to wait for multiple promises to complete and return the first one that succeeds, without having to wait for all of them to finish.\"]]],[1,\"p\",[[0,[],0,\"Here's an example usage of \"],[0,[0],1,\"Promise.any()\"]]],[10,46],[1,\"p\",[[0,[],0,\"In this example, the \"],[0,[0],1,\"Promise.any()\"],[0,[],0,\" method takes an array of promises as its argument and returns a new promise that is resolved with the first resolved value from the input promises. If all of the input promises are rejected, \"],[0,[0],1,\"Promise.any()\"],[0,[],0,\" returns a rejected promise with the first error that occurs.\"]]],[1,\"p\",[[0,[],0,\"The use of \"],[0,[0],1,\"Promise.any()\"],[0,[],0,\" can simplify your code and improve performance in cases where you want to wait for multiple promises to complete, but you only need to handle the result of the first one that succeeds.\"]]],[10,47],[1,\"h2\",[[0,[],0,\"Array.prototype.at()\"]]],[1,\"p\",[[0,[],0,\"The \"],[0,[3,0],2,\"at()\"],[0,[],0,\" method takes an integer value and returns the item at that index, allowing for positive and negative integers. Negative integers count back from the last item in the array.\"]]],[10,48],[1,\"p\",[[0,[],0,\"It is nice feature. Before I used to apply syntax\"]]],[10,49],[1,\"p\",[[0,[],0,\"to recive similar (but not the same) results:\"]]],[10,50],[1,\"h2\",[[0,[4],1,\"Top\"],[0,[],0,\" level await\"]]],[1,\"p\",[[0,[],0,\"This concept is connected with dynamic import. Because of your import is executed in runtime, so exported objects can be prepared in runtime. So there is no reasons to no give them some time.\"]]],[1,\"p\",[[0,[],0,\"We can achieve it by syntax like this\"]]],[10,51],[1,\"p\",[[0,[],0,\"in imported module. Let mi present full example:\"]]],[10,52],[1,\"p\",[[0,[],0,\"and\"]]],[10,53],[1,\"p\",[[0,[],0,\"execution will print in console:\"]]],[10,54],[1,\"p\",[[0,[],0,\"You can read about more awesome await features here:\"]]],[10,55],[10,56],[1,\"p\",[[0,[],0,\"It is all in this article, but definitely I touched only small part of current JS features and I am sure that this article is worse source to learn them than official specs . His goal was rather summarize, which features I see as useful but still rarely seen in codebase.\"]]],[1,\"p\",[[0,[],0,\"I hope you feel inspired or learned something new and if yes, click subscribe or write comment. Thx\"]]]],\"ghostVersion\":\"4.0\"}","html":"<p>Javascript is main primary language. But his dynamic development insist from me constant updates of my knowledge about it. In this article I will show few syntax that I learned in last two years and which was not available if you get know JavaScript earlier.</p><p>It is possible that some of them are known for you, but I hope that some of them will extend your skill in JS syntax. To save your time I am adding table of content:</p><ul><li>ES2020 - Nullish coalescing</li><li>ES2020 - Optional chaining</li><li>ES2015 - Proxies</li><li>ES2022 - Private fields</li><li>ES2020 - Promise.allSettled</li><li>ES2020 - BigInt</li><li>ES2020 - Dynamic Import</li><li>ES2022 - String.replaceAll</li><li>ES2020 - Numeric Separators</li><li>ES2020 - String.matchAll</li><li>ES2021 - Logical Assignment</li><li>ES2020 - Promise.any</li><li>ES2022 - Array.prototype.at</li><li>ES2022 - Top level await</li></ul><figure class=\"kg-card kg-image-card\"><img src=\"__GHOST_URL__/content/images/2023/02/rewriting-js-code-to-use-fancy-es6-features-what-it-46582018.png\" class=\"kg-image\" alt loading=\"lazy\" width=\"500\" height=\"441\"></figure><h2 id=\"nullish-coalescing-operator-more-strict\">Nullish coalescing operator ?? [ more strict || ]</h2><p>The nullish coalescing operator (<code>??</code>) in JavaScript ES2020 is a logical operator that returns the right-hand side operand when the left-hand side operand is <code>null</code> or <code>undefined</code>, and returns the left-hand side operand otherwise.</p><p>Here's an example of how the nullish coalescing operator can be used in JavaScript</p><pre><code class=\"language-javascript\">let name = userName ?? 'default';</code></pre><p>In this example, if <code>userName</code> is <code>null</code> or <code>undefined</code>, the value of <code>name</code> will be set to <code>'default'</code>. If <code>userName</code> has a truthy value, the value of <code>name</code> will be set to that value.</p><p>The nullish coalescing operator is different from the previously applied techniques, such as the logical OR operator (<code>||</code>), in that the logical OR operator returns the right-hand side operand when the left-hand side operand is falsy, which includes not just <code>null</code> and <code>undefined</code>, but also values such as <code>0</code>, <code>''</code>, and <code>false</code>.</p><p>Here's an example that demonstrates the difference between the nullish coalescing operator and the logical OR operator:</p><pre><code class=\"language-javascript\">let name = userName ?? 'default'; // using the nullish coalescing operator\nlet name = userName || 'default'; // using the logical OR operator</code></pre><p>In the first example, if <code>userName</code> is <code>null</code> or <code>undefined</code>, the value of <code>name</code> will be set to <code>'default'</code>. In the second example, if <code>userName</code> is falsy, the value of <code>name</code> will also be set to <code>'default'</code>.</p><p>So, in short, the nullish coalescing operator is a more strict and specific way to handle default values in JavaScript, compared to the logical OR operator.</p><figure class=\"kg-card kg-image-card\"><img src=\"__GHOST_URL__/content/images/2023/02/best-js-meme-to-date-2.png\" class=\"kg-image\" alt loading=\"lazy\" width=\"500\" height=\"760\"></figure><h2 id=\"optional-chaining-less-strict-props-access\">Optional chaining .? [ less strict props access ]</h2><p>Optional chaining in JavaScript is a feature introduced in ECMAScript 2020 that allows you to access an object property, an array element, or a function return value safely and avoid <code>TypeError</code> in case of accessing an undefined object or a null value. It's written using a <code>?.</code> syntax and can be used to access nested properties of an object.</p><p>For example, consider the following code that uses optional chaining:</p><pre><code class=\"language-javascript\">let obj = {\n  prop1: {\n    prop2: {\n      prop3: 'value'\n    }\n  }\n};\n\nlet value = obj?.prop1?.prop2?.prop3;\nconsole.log(value); // Output: \"value\"</code></pre><p>Prior to optional chaining, a common approach to avoid the <code>TypeError</code> was to use the <code>&amp;&amp;</code> operator and check for <code>null</code> and <code>undefined</code> values:</p><pre><code class=\"language-javascript\">let obj = {\n  prop1: {\n    prop2: {\n      prop3: 'value'\n    }\n  }\n};\n\nlet value = obj &amp;&amp; obj.prop1 &amp;&amp; obj.prop1.prop2 &amp;&amp; obj.prop1.prop2.prop3;\nconsole.log(value); // Output: \"value\"</code></pre><p>The main difference between optional chaining and this approach is that optional chaining is more concise, readable, and expressive. It's also less error-prone, as it eliminates the need to manually check for <code>null</code> and <code>undefined</code> values at every step.</p><h2 id=\"proxies-for-metaprogramming-like-reflection\">Proxies [ for metaprogramming like reflection ]</h2><p>A proxy in JavaScript is an object that acts as an intermediary between a target object and the code that interacts with it. Proxies are used to intercept and modify operations performed on the target object, such as property access, method calls, and object assignments. This makes them a powerful tool for adding custom behavior to existing objects, enforcing constraints, and creating abstractions.</p><p>An example use case of a proxy is to add a logging mechanism to an object to track when its properties are accessed. Here's an example of how this can be done using a proxy:</p><pre><code class=\"language-javascript\">let target = { name: 'John Doe' };\n\nlet handler = {\n  get: function(target, prop) {\n    console.log(`Accessing property ${prop}`);\n    return target[prop];\n  }\n};\n\nlet proxy = new Proxy(target, handler);\n\nconsole.log(proxy.name); // Output: Accessing property name\n//                           John Doe</code></pre><p>In this example, we define a target object and a handler object. The handler object contains a <code>get</code> method that logs a message and returns the value of the target object's property. Finally, we create a new proxy object by passing the target and the handler to the <code>Proxy</code> constructor. When we access the <code>name</code> property of the proxy object, the <code>get</code> method of the handler is called, logging the message and returning the value of the target object's property.</p><p>It is example of Reflection - a feature that allows a program to inspect and manipulate its own structure and behavior at runtime. This includes introspection of objects, classes, and methods, as well as modification of their properties and behavior.</p><p>In our example there is <code>console.log</code> but you can use any logic in get or set traps. For example notifying other parts of program about change or logging changes history. Proxy is extensively used in implementation of reactivity in frontend frameworks like Vue.</p><p>There is 13 traps in Proxy that are described here:</p><figure class=\"kg-card kg-bookmark-card\"><a class=\"kg-bookmark-container\" href=\"https://www.digitalocean.com/community/tutorials/js-proxy-traps\"><div class=\"kg-bookmark-content\"><div class=\"kg-bookmark-title\">Looking at All 13 JavaScript Proxy Traps | DigitalOcean</div><div class=\"kg-bookmark-description\">A collection of code snippets to show all 13 Javascript Proxy traps in action.</div><div class=\"kg-bookmark-metadata\"><img class=\"kg-bookmark-icon\" src=\"https://www.digitalocean.com/_next/static/media/android-chrome-512x512.5f2e6221.png\"><span class=\"kg-bookmark-author\">DigitalOcean</span><span class=\"kg-bookmark-publisher\">Jack Misteli</span></div></div><div class=\"kg-bookmark-thumbnail\"><img src=\"https://www.digitalocean.com/_next/static/media/intro-to-cloud.d49bc5f7.jpeg\"></div></a></figure><p>I will show only 3 most popular <code>get</code>, <code>set</code> and <code>has</code>. In example below we can build handler that allow us to build objects that prevent to access to \"private\" properties.</p><pre><code class=\"language-javascript\">function invariant (key, action) {\n  if (key[0] === '_') {\n    throw new Error(`Invalid attempt to ${action} private \"${key}\" property`)\n  }\n}\nvar handler = {\n  get (target, key) {\n    invariant(key, 'get')\n    return target[key]\n  },\n  set (target, key, value) {\n    invariant(key, 'set')\n    return true\n  },\n  has (target, key) {\n    if (key[0] === '_') {\n      return false\n    }\n    return key in target\n  }\n}</code></pre><p>Proxies deserve for distinct article, but I hope you feel to be inspired to learn them deeper.</p><figure class=\"kg-card kg-image-card\"><img src=\"__GHOST_URL__/content/images/2023/02/1_NWihm7jnH3kqUyEBOSpwiw.jpeg\" class=\"kg-image\" alt loading=\"lazy\" width=\"506\" height=\"500\"></figure><h2 id=\"private-fields-privacy-without-weakmap-and-closures\">Private fields [ privacy without WeakMap and closures ]</h2><p>Private fields in JavaScript are a feature introduced in ECMAScript 2020 that allow you to define properties on an object that are not accessible from outside of the object. They are written using a <code>#</code> symbol before the property name and are only accessible within the object's methods.</p><p>Private members are not native to the language before this syntax existed. In prototypical inheritance, its behavior may be emulated with <a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/WeakMap#emulating_private_members\"><code>WeakMap</code></a> objects or <a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Closures#emulating_private_methods_with_closures\">closures</a>, but they can't compare to the <code>#</code> syntax in terms of ergonomics.</p><p>Here's an example of how private fields can be used in JavaScript:</p><pre><code class=\"language-javascript\">class Person {\n  #name;\n\n  constructor(name) {\n    this.#name = name;\n  }\n\n  getName() {\n    return this.#name;\n  }\n}\n\nlet person = new Person('John Doe');\nconsole.log(person.getName()); // Output: \"John Doe\"\nconsole.log(person.#name); // Output: SyntaxError: Private field '#name' must be accessed within the class declaration.</code></pre><p>In this example, we define a <code>Person</code> class with a private field <code>#name</code>. The <code>#name</code> field is assigned a value in the constructor, and a <code>getName</code> method is defined to return its value. When we try to access the <code>#name</code> field outside of the <code>Person</code> class, we get a <code>SyntaxError</code> indicating that private fields must be accessed within the class declaration.</p><p>Private fields provide a way to encapsulate an object's internal state and prevent it from being modified or accessed directly. This makes it easier to maintain the integrity of the object's data and enforce its internal invariants.</p><p>It is great that this feature was introduced but i think it seems to be still quite unknown. More detailed specs below:</p><figure class=\"kg-card kg-bookmark-card\"><a class=\"kg-bookmark-container\" href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Classes/Private_class_fields\"><div class=\"kg-bookmark-content\"><div class=\"kg-bookmark-title\">Private class features - JavaScript | MDN</div><div class=\"kg-bookmark-description\">Class fields are public by default, but private class members can be created by using a hash # prefix. The privacy encapsulation of these class features is enforced by JavaScript itself.</div><div class=\"kg-bookmark-metadata\"><img class=\"kg-bookmark-icon\" src=\"https://developer.mozilla.org/apple-touch-icon.6803c6f0.png\"><span class=\"kg-bookmark-author\">MDN Web Docs</span></div></div><div class=\"kg-bookmark-thumbnail\"><img src=\"https://developer.mozilla.org/mdn-social-share.cd6c4a5a.png\"></div></a></figure><h2 id=\"promiseallsettled-for-concurrent-programming\">Promise.allSettled() [ for concurrent programming ]</h2><p>The <code>Promise.allSettled()</code> method in JavaScript is used to create a single Promise that resolves when all of the promises in an iterable have settled (either fulfilled or rejected). It returns an array of objects that represent the outcome of each promise, rather than a single value or an error.</p><p>Here's an example of how <code>Promise.allSettled()</code> can be used in JavaScript:</p><pre><code class=\"language-javascript\">let p1 = Promise.resolve(42);\nlet p2 = Promise.reject(new Error('failed'));\nlet p3 = Promise.resolve(10);\n\nPromise.allSettled([p1, p2, p3]).then((results) =&gt; {\n  console.log(results);\n  /* Output:\n  [\n    { status: 'fulfilled', value: 42 },\n    { status: 'rejected', reason: Error: failed },\n    { status: 'fulfilled', value: 10 }\n  ]\n  */\n});</code></pre><p>In this example, we create three promises: <code>p1</code>, <code>p2</code>, and <code>p3</code>. <code>p1</code> is a resolved promise with a value of 42, <code>p2</code> is a rejected promise with an error message, and <code>p3</code> is a resolved promise with a value of 10. We then pass these promises as an iterable to <code>Promise.allSettled()</code> and log the results when they have all settled. The result is an array of objects that represent the outcome of each promise, with a <code>status</code> property that indicates whether the promise was fulfilled or rejected, and a <code>value</code> or <code>reason</code> property that contains the result or error.</p><p>The <code>Promise.allSettled()</code> method is useful when you want to wait for multiple promises to complete, but you don't need to know the outcome of each promise in order to continue. Unlike <code>Promise.all()</code>, which rejects with the first error that occurs, <code>Promise.allSettled()</code> will wait for all promises to settle before resolving, even if some of them are rejected.</p><figure class=\"kg-card kg-bookmark-card\"><a class=\"kg-bookmark-container\" href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise/allSettled\"><div class=\"kg-bookmark-content\"><div class=\"kg-bookmark-title\">Promise.allSettled() - JavaScript | MDN</div><div class=\"kg-bookmark-description\">The Promise.allSettled() static method takes an iterable of promises as input and returns a single Promise. This returned promise fulfills when all of the input’s promises settle (including when an empty iterable is passed), with an array of objects that describe the outcome of each promise.</div><div class=\"kg-bookmark-metadata\"><img class=\"kg-bookmark-icon\" src=\"https://developer.mozilla.org/apple-touch-icon.6803c6f0.png\"><span class=\"kg-bookmark-author\">MDN Web Docs</span></div></div><div class=\"kg-bookmark-thumbnail\"><img src=\"https://developer.mozilla.org/mdn-social-share.cd6c4a5a.png\"></div></a></figure><figure class=\"kg-card kg-image-card\"><img src=\"__GHOST_URL__/content/images/2023/02/4014ebe135ed0321c2e4a4975a65a30251c5e44c0c5d3ca3e8fe879b75d309b6.jpg\" class=\"kg-image\" alt loading=\"lazy\" width=\"625\" height=\"1039\" srcset=\"__GHOST_URL__/content/images/size/w600/2023/02/4014ebe135ed0321c2e4a4975a65a30251c5e44c0c5d3ca3e8fe879b75d309b6.jpg 600w, __GHOST_URL__/content/images/2023/02/4014ebe135ed0321c2e4a4975a65a30251c5e44c0c5d3ca3e8fe879b75d309b6.jpg 625w\"></figure><h2 id=\"bigint-for-math-and-huge-id-from-databases\">BigInt [ for Math and huge Id from databases ]</h2><p>BigInt is a new primitive type in JavaScript that was introduced in ECMAScript 2020. It represents an arbitrarily large integer and allows you to perform arithmetic operations with values that can be larger than the <code>Number</code> type's maximum safe integer value of <code>2^53 - 1</code>.</p><p>Here's an example of how BigInt can be used in JavaScript:</p><pre><code class=\"language-javascript\">const a = BigInt(9007199254740992);\nconst b = BigInt(1);\nconsole.log(a + b); // Output: 9007199254740993n</code></pre><p>In this example, we create two BigInt values and perform an addition operation on them. The result is a BigInt value that accurately represents the result of the calculation, even though it exceeds the maximum safe integer value of <code>Number</code>.</p><p>For comparison adding one to such big <code>Number</code> your will get wrong result</p><pre><code class=\"language-javascript\">console.log(9007199254740992 + 1); // 9007199254740992\n</code></pre><p>Another difference is that BigInt values support a more limited set of arithmetic and comparison operations than <code>Number</code> values. For example, BigInt values do not support operations such as division by zero, NaN, or Infinity.</p><pre><code class=\"language-javascript\">BigInt(1) / BigInt(0); // Uncaught RangeError: Division by zero</code></pre><p>and</p><pre><code class=\"language-javascript\">BigInt(1) / 0; // Uncaught TypeError: Cannot mix BigInt and other types, use explicit conversions</code></pre><p>BigInt provides a way to represent and manipulate large integers in JavaScript without the loss of precision that can occur with the <code>Number</code> type. It is particularly useful in cases where you need to perform calculations with values that exceed the maximum safe integer value of <code>Number</code>.</p><figure class=\"kg-card kg-bookmark-card\"><a class=\"kg-bookmark-container\" href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/BigInt\"><div class=\"kg-bookmark-content\"><div class=\"kg-bookmark-title\">BigInt - JavaScript | MDN</div><div class=\"kg-bookmark-description\">BigInt values represent numeric values which are too large to be represented by the number primitive.</div><div class=\"kg-bookmark-metadata\"><img class=\"kg-bookmark-icon\" src=\"https://developer.mozilla.org/apple-touch-icon.6803c6f0.png\"><span class=\"kg-bookmark-author\">MDN Web Docs</span></div></div><div class=\"kg-bookmark-thumbnail\"><img src=\"https://developer.mozilla.org/mdn-social-share.cd6c4a5a.png\"></div></a></figure><figure class=\"kg-card kg-image-card\"><img src=\"__GHOST_URL__/content/images/2023/02/ezgif-2-e3e834a0e1.jpg\" class=\"kg-image\" alt loading=\"lazy\" width=\"720\" height=\"333\" srcset=\"__GHOST_URL__/content/images/size/w600/2023/02/ezgif-2-e3e834a0e1.jpg 600w, __GHOST_URL__/content/images/2023/02/ezgif-2-e3e834a0e1.jpg 720w\" sizes=\"(min-width: 720px) 720px\"></figure><h2 id=\"dynamic-import\">Dynamic Import</h2><p>Dynamic Import is a feature in JavaScript that allows you to load a module or a piece of code asynchronously at runtime, rather than at the time of parsing and executing the script. This allows you to load only the resources that you need when you need them, rather than loading everything upfront, which can improve the performance and load time of your application.</p><p>Here's an example of how Dynamic Import can be used in JavaScript:</p><pre><code class=\"language-javascript\">// ? say.mjs\nconsole.log(\"Now file is imported\");\n\nexport function hi() {\n  console.log(`Hello`);\n}\n\nexport function bye() {\n  console.log(`Bye`);\n}\n\n</code></pre><p>and</p><pre><code class=\"language-javascript\">async function main() {\n  let {hi, bye} = await import('./say.mjs');\n\n  hi();\n  bye();\n}\n\nconsole.log(\"Import not executed yet\");\nmain().catch(console.error);</code></pre><p>Command <code>node index.js</code> will print</p><pre><code>Import not executed yet\nNow file is imported\nHello\nBye\n</code></pre><p>In this example, we use the <code>import()</code> function to load a module <code>module.js</code> asynchronously. The <code>import()</code> function returns a Promise that resolves to the module object, which we can then access using destructuring or the default property.</p><p>Dynamic Import is different from the other import types (such as <code>import</code> and <code>require</code> statements) in a few key ways:</p><ul><li>Load Time: Dynamic Import is loaded at runtime, when the <code>import()</code> function is called, rather than at the time of parsing the script. This means that the module or code is only loaded when it is actually needed, which can improve the performance and load time of your application.</li><li>Return Value: Dynamic Import returns a Promise that resolves to the module object, rather than the module object itself. This allows you to load the module asynchronously and handle the result when it is available, rather than blocking the execution of the script while the module is being loaded.</li><li>Code Splitting: Dynamic Import enables you to split your code into smaller, more manageable pieces that can be loaded on demand. This can improve the performance and scalability of your application by reducing the amount of code that needs to be loaded and parsed at the start of your script.</li></ul><p>Dynamic Import provides a flexible and powerful way to load code asynchronously in JavaScript, and is particularly useful for large and complex applications that need to load resources on demand. By using Dynamic Import, you can optimize the performance and load time of your application, and improve the overall user experience.</p><p>You can learn more comparing docs of static import</p><figure class=\"kg-card kg-bookmark-card\"><a class=\"kg-bookmark-container\" href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/import\"><div class=\"kg-bookmark-content\"><div class=\"kg-bookmark-title\">import - JavaScript | MDN</div><div class=\"kg-bookmark-description\">The static import declaration is used to import read-only live bindings which are exported by another module. The imported bindings are called live bindings because they are updated by the module that exported the binding, but cannot be re-assigned by the importing module.</div><div class=\"kg-bookmark-metadata\"><img class=\"kg-bookmark-icon\" src=\"https://developer.mozilla.org/apple-touch-icon.6803c6f0.png\"><span class=\"kg-bookmark-author\">MDN Web Docs</span></div></div><div class=\"kg-bookmark-thumbnail\"><img src=\"https://developer.mozilla.org/mdn-social-share.cd6c4a5a.png\"></div></a></figure><p>With dynamic import described here</p><figure class=\"kg-card kg-bookmark-card\"><a class=\"kg-bookmark-container\" href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/import\"><div class=\"kg-bookmark-content\"><div class=\"kg-bookmark-title\">import() - JavaScript | MDN</div><div class=\"kg-bookmark-description\">The import() syntax, commonly called dynamic import, is a function-like expression that allows loading an ECMAScript module asynchronously and dynamically into a potentially non-module environment.</div><div class=\"kg-bookmark-metadata\"><img class=\"kg-bookmark-icon\" src=\"https://developer.mozilla.org/apple-touch-icon.6803c6f0.png\"><span class=\"kg-bookmark-author\">MDN Web Docs</span></div></div><div class=\"kg-bookmark-thumbnail\"><img src=\"https://developer.mozilla.org/mdn-social-share.cd6c4a5a.png\"></div></a></figure><p>Thanks to dynamic imports you can manage both time of importing and patch to imported module in runtime what can be useful for example if you have to load dictionary with translations of your website or picking one component instead of all to display first page.</p><h2 id=\"replaceall-concise-syntax-for-replace-with-g\">replaceAll [ concise syntax for replace with //g ]</h2><p>The <code>String.prototype.replaceAll</code> method in JavaScript is a recent addition (part of the ECMAScript 2022 standard) that provides a more straightforward way to perform global search-and-replace operations on strings. Unlike the previous method of using <code>String.prototype.replace</code> with a regular expression and the <code>g</code> (global) flag, <code>String.prototype.replaceAll</code> provides a simpler syntax for this common use case.</p><p>For example, to globally replace all occurrences of a target string with another string, you can use <code>replaceAll</code> as follows:</p><pre><code class=\"language-javascript\">const originalString = \"Hello world! Hello again.\";\nconst newString = originalString.replaceAll(\"Hello\", \"Goodbye\");\nconsole.log(newString); // Goodbye world! Goodbye again.</code></pre><p>In comparison, using <code>replace</code> with a regular expression and the <code>g</code> flag would look like this:</p><pre><code class=\"language-javascript\">const originalString = \"Hello world! Hello again.\";\nconst newString = originalString.replace(/Hello/g, \"Goodbye\");\nconsole.log(newString); // Goodbye world! Goodbye again.</code></pre><p>As you can see, <code>replaceAll</code> provides a more concise and readable syntax for this common use case.</p><h2 id=\"numeric-separators-sugar-for-code-redability\">Numeric Separators [ sugar for code redability ]</h2><p>Numeric separators in JavaScript are a recent addition (part of the ECMAScript 2020 standard) that allow developers to make large numbers easier to read by adding underscores as separators between groups of digits. The underscores are ignored during evaluation, but serve as a visual aid to separate the digits.</p><p>For example, instead of writing:</p><pre><code class=\"language-javascript\">const x = 1000000000;\n</code></pre><p>You can write:</p><pre><code class=\"language-javascript\">const x = 1_000_000_000;</code></pre><p>This makes it easier to see the different groups of digits, especially in large numbers. Numeric separators can be used with decimal literals as well as binary, octal, and hexadecimal literals.</p><p>Here's an example using binary literals:</p><pre><code class=\"language-javascript\">const y = 0b1010_0101_1001_0010;</code></pre><p>And here's an example using hexadecimal literals:</p><pre><code class=\"language-javascript\">const z = 0xff_ff_ff;</code></pre><p>In all cases, the numeric separators are ignored during evaluation, and the values are stored and used just like any other number in JavaScript.</p><figure class=\"kg-card kg-image-card\"><img src=\"__GHOST_URL__/content/images/2023/02/7afbd5.jpg\" class=\"kg-image\" alt loading=\"lazy\" width=\"500\" height=\"559\"></figure><h2 id=\"matchall-access-to-matches-for-g-regex\">matchAll [ access to matches for //g regex ]</h2><p>The <code>String.prototype.matchAll()</code> method in JavaScript is a recent addition (part of the ECMAScript 2020 standard) that provides a new way to extract all matches of a regular expression from a string. Unlike the previous method of using <code>String.prototype.match</code> with a regular expression, <code>String.prototype.matchAll</code> returns an iterator that yields all matches, rather than just the first match or all matches as an array.</p><p>For example, to extract all occurrences of a target string from a string, you can use <code>matchAll</code> as follows:</p><pre><code class=\"language-javascript\">const originalString = \"Hello world! Hello again.\";\nconst regex = /Hello/g;\nconst matches = originalString.matchAll(regex);</code></pre><p>now <code>matches</code> is object <code>RegExpStringIterator</code>.</p><figure class=\"kg-card kg-image-card\"><img src=\"__GHOST_URL__/content/images/2023/02/Zrzut-ekranu-z-2023-02-08-21-08-00.png\" class=\"kg-image\" alt loading=\"lazy\" width=\"399\" height=\"124\"></figure><p>we can get acess to single match by <code>next</code></p><pre><code class=\"language-javascript\">m = matches.next()</code></pre><p>then <code>m</code> will be object with bolean <code>done</code> and <code>value</code> that contains details about match.</p><figure class=\"kg-card kg-image-card\"><img src=\"__GHOST_URL__/content/images/2023/02/Zrzut-ekranu-z-2023-02-08-21-08-50.png\" class=\"kg-image\" alt loading=\"lazy\" width=\"402\" height=\"213\"></figure><p>second option to get matches is iteration</p><pre><code class=\"language-javascript\">for (const match of matches) {\n  console.log(match[0]);\n}\n// Hello\n// Hello</code></pre><p>or </p><figure class=\"kg-card kg-image-card\"><img src=\"__GHOST_URL__/content/images/2023/02/Zrzut-ekranu-z-2023-02-08-21-11-07.png\" class=\"kg-image\" alt loading=\"lazy\" width=\"566\" height=\"131\"></figure><p>In comparison, using <code>match</code> with a regular expression would look like this:</p><pre><code class=\"language-javascript\">const originalString = \"Hello world! Hello again.\";\nconst regex = /Hello/g;\nconst matches = originalString.match(regex);\nconsole.log(matches); // [ \"Hello\", \"Hello\" ]</code></pre><p>so <code>match</code> is losing access to index, input and groups when was used with <code>//g</code> regex. </p><p>As you can see, matchAll provides a way to work with each match one by one, rather than having to process all matches as an array. This can be useful in certain cases, such as when you need to perform additional processing on each match, or when you need to extract information from the captured groups within each match. Additionally, because <code>matchAll</code> returns an iterator, you can use it in a <code>for...of</code> loop, which can make your code more readable and concise.</p><h2 id=\"logical-assignment-conditional-assignment\">Logical Assignment [ conditional assignment ]</h2><p>Logical assignment in JavaScript is a new feature (part of the ECMAScript 2021 standard) that allows you to simplify and condense certain types of assignments that involve logical operations. It provides a shorthand for combining an assignment with a logical operation, such as <code>&amp;&amp;</code> or <code>||</code>.</p><p>The logical assignment operators are <code>&amp;&amp;=</code>, <code>||=</code>, and <code>??=</code>. They perform the same operations as the corresponding logical operators, but with the added behavior of assignment.</p><pre><code class=\"language-javascript\">x &amp;&amp;= y</code></pre><p>is equivalent to</p><pre><code>x &amp;&amp; (x = y);\n</code></pre><p>Here's an example using the <code>&amp;&amp;=</code> operator:</p><pre><code class=\"language-javascript\">let x = 1;\nx &amp;&amp;= 2;\nconsole.log(x); // 2\n\nx = 0;\nx &amp;&amp;= 2;\nconsole.log(x); // 0</code></pre><p>In the first case, <code>x</code> is assigned the value of <code>2</code>, because <code>1 &amp;&amp; 2</code> is <code>2</code>. In the second case, <code>x</code> is assigned the value of <code>0</code>, because <code>0 &amp;&amp; 2</code> is <code>0</code>.</p><p>Here's an example using the <code>||=</code> operator:</p><pre><code class=\"language-javascript\">let x = null;\nx ||= 1;\nconsole.log(x); // 1\n\nx = 2;\nx ||= 1;\nconsole.log(x); // 2</code></pre><p>In the first case, <code>x</code> is assigned the value of <code>1</code>, because <code>null || 1</code> is <code>1</code>. In the second case, <code>x</code> is assigned the value of <code>2</code>, because <code>2 || 1</code> is <code>2</code>.</p><p>And here's an example using the <code>??=</code> operator:</p><pre><code class=\"language-javascript\">let x = null;\nx ??= 1;\nconsole.log(x); // 1\n\nx = 2;\nx ??= 1;\nconsole.log(x); // 2</code></pre><p>In the first case, x is assigned the value of 1, because null ?? 1 is 1. In the second case, x is assigned the value of 2, because 2 ?? 1 is 2. The ?? operator is similar to the || operator, but it only evaluates the right-side expression if the left-side expression is null or undefined.</p><figure class=\"kg-card kg-image-card\"><img src=\"__GHOST_URL__/content/images/2023/02/7afchc.gif\" class=\"kg-image\" alt loading=\"lazy\" width=\"260\" height=\"203\"></figure><h2 id=\"promiseany-for-racings\">Promise.any() [ for racings ]</h2><p>The <code>Promise.any()</code> method in JavaScript is a recent addition (part of the ECMAScript 2020 standard) that allows you to wait for the first of several promises to settle (i.e., to either resolve or reject), and then return the result of that promise. It provides a way to wait for multiple promises to complete and return the first one that succeeds, without having to wait for all of them to finish.</p><p>Here's an example usage of <code>Promise.any()</code></p><pre><code class=\"language-javascript\">const promise1 = Promise.resolve(1);\nconst promise2 = Promise.reject(new Error(\"error\"));\nconst promise3 = Promise.resolve(3);\n\nPromise.any([promise1, promise2, promise3])\n  .then((value) =&gt; {\n    console.log(value); // 1\n  })\n  .catch((error) =&gt; {\n    console.error(error);\n  });</code></pre><p>In this example, the <code>Promise.any()</code> method takes an array of promises as its argument and returns a new promise that is resolved with the first resolved value from the input promises. If all of the input promises are rejected, <code>Promise.any()</code> returns a rejected promise with the first error that occurs.</p><p>The use of <code>Promise.any()</code> can simplify your code and improve performance in cases where you want to wait for multiple promises to complete, but you only need to handle the result of the first one that succeeds.</p><figure class=\"kg-card kg-image-card\"><img src=\"__GHOST_URL__/content/images/2023/02/ezgif-2-b971e352d2.jpg\" class=\"kg-image\" alt loading=\"lazy\" width=\"720\" height=\"531\" srcset=\"__GHOST_URL__/content/images/size/w600/2023/02/ezgif-2-b971e352d2.jpg 600w, __GHOST_URL__/content/images/2023/02/ezgif-2-b971e352d2.jpg 720w\" sizes=\"(min-width: 720px) 720px\"></figure><h2 id=\"arrayprototypeat\">Array.prototype.at()</h2><p>The <strong><code>at()</code></strong> method takes an integer value and returns the item at that index, allowing for positive and negative integers. Negative integers count back from the last item in the array.</p><pre><code>a = [0,1,2]\na.at(0); // 0\na.at(4); // undefined\na.at(-2); // 1\na.at(Infinity); // undefined</code></pre><p>It is nice feature. Before I used to apply syntax</p><pre><code>a[(a.length + n) % a.length]</code></pre><p>to recive similar (but not the same) results:</p><pre><code>a[(a.length + 0) % a.length] // 0 as a.at(0)\na[(a.length + 4) % a.length] // 1\na[(a.length -2) % a.length] // 1\na[(a.length + Infinity) % a.length] // undefined</code></pre><h2 id=\"top-level-await\"><em>Top</em> level await</h2><p>This concept is connected with dynamic import. Because of your import is executed in runtime, so exported objects can be prepared in runtime. So there is no reasons to no give them some time.</p><p>We can achieve it by syntax like this</p><pre><code class=\"language-javascript\">const colors = fetch(\"../data/colors.json\").then((response) =&gt; response.json());\n\nexport default await colors;</code></pre><p>in imported module. Let mi present full example:</p><pre><code>// file objects.mjs\nconst res = fetch('https://api.restful-api.dev/objects');\n\nexport default await (await res).json();</code></pre><p>and</p><pre><code>// file index.js\nasync function main() {\n  let ok = await import('./objects.mjs');\n  console.log(ok.default);\n}\n\nmain().catch(console.error);\n</code></pre><p>execution will print in console:</p><pre><code>[\n  {\n    id: '1',\n    name: 'Google Pixel 6 Pro',\n    data: { color: 'Cloudy White', capacity: '128 GB' }\n  },\n  ...\n]</code></pre><p>You can read about more awesome await features here:</p><figure class=\"kg-card kg-bookmark-card\"><a class=\"kg-bookmark-container\" href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/await\"><div class=\"kg-bookmark-content\"><div class=\"kg-bookmark-title\">await - JavaScript | MDN</div><div class=\"kg-bookmark-description\">The await operator is used to wait for a Promise and get its fulfillment value. It can only be used inside an async function or at the top level of a module.</div><div class=\"kg-bookmark-metadata\"><img class=\"kg-bookmark-icon\" src=\"https://developer.mozilla.org/apple-touch-icon.6803c6f0.png\"><span class=\"kg-bookmark-author\">MDN Web Docs</span></div></div><div class=\"kg-bookmark-thumbnail\"><img src=\"https://developer.mozilla.org/mdn-social-share.cd6c4a5a.png\"></div></a></figure><hr><p>It is all in this article, but definitely I touched only small part of current JS features and I am sure that this article is worse source to learn them than official specs . His goal was rather summarize, which features I see as useful but still rarely seen in codebase.</p><p>I hope you feel inspired or learned something new and if yes, click subscribe or write comment. Thx</p>","comment_id":"63e3962dbbda300a2f29cffd","plaintext":"Javascript is main primary language. But his dynamic development insist from me\nconstant updates of my knowledge about it. In this article I will show few\nsyntax that I learned in last two years and which was not available if you get\nknow JavaScript earlier.\n\nIt is possible that some of them are known for you, but I hope that some of them\nwill extend your skill in JS syntax. To save your time I am adding table of\ncontent:\n\n * ES2020 - Nullish coalescing\n * ES2020 - Optional chaining\n * ES2015 - Proxies\n * ES2022 - Private fields\n * ES2020 - Promise.allSettled\n * ES2020 - BigInt\n * ES2020 - Dynamic Import\n * ES2022 - String.replaceAll\n * ES2020 - Numeric Separators\n * ES2020 - String.matchAll\n * ES2021 - Logical Assignment\n * ES2020 - Promise.any\n * ES2022 - Array.prototype.at\n * ES2022 - Top level await\n\nNullish coalescing operator ?? [ more strict || ]\nThe nullish coalescing operator (??) in JavaScript ES2020 is a logical operator\nthat returns the right-hand side operand when the left-hand side operand is null \nor undefined, and returns the left-hand side operand otherwise.\n\nHere's an example of how the nullish coalescing operator can be used in\nJavaScript\n\nlet name = userName ?? 'default';\n\nIn this example, if userName is null or undefined, the value of name will be set\nto 'default'. If userName has a truthy value, the value of name will be set to\nthat value.\n\nThe nullish coalescing operator is different from the previously applied\ntechniques, such as the logical OR operator (||), in that the logical OR\noperator returns the right-hand side operand when the left-hand side operand is\nfalsy, which includes not just null and undefined, but also values such as 0, ''\n, and false.\n\nHere's an example that demonstrates the difference between the nullish\ncoalescing operator and the logical OR operator:\n\nlet name = userName ?? 'default'; // using the nullish coalescing operator\nlet name = userName || 'default'; // using the logical OR operator\n\nIn the first example, if userName is null or undefined, the value of name will\nbe set to 'default'. In the second example, if userName is falsy, the value of \nname will also be set to 'default'.\n\nSo, in short, the nullish coalescing operator is a more strict and specific way\nto handle default values in JavaScript, compared to the logical OR operator.\n\nOptional chaining .? [ less strict props access ]\nOptional chaining in JavaScript is a feature introduced in ECMAScript 2020 that\nallows you to access an object property, an array element, or a function return\nvalue safely and avoid TypeError in case of accessing an undefined object or a\nnull value. It's written using a ?. syntax and can be used to access nested\nproperties of an object.\n\nFor example, consider the following code that uses optional chaining:\n\nlet obj = {\n  prop1: {\n    prop2: {\n      prop3: 'value'\n    }\n  }\n};\n\nlet value = obj?.prop1?.prop2?.prop3;\nconsole.log(value); // Output: \"value\"\n\nPrior to optional chaining, a common approach to avoid the TypeError was to use\nthe && operator and check for null and undefined values:\n\nlet obj = {\n  prop1: {\n    prop2: {\n      prop3: 'value'\n    }\n  }\n};\n\nlet value = obj && obj.prop1 && obj.prop1.prop2 && obj.prop1.prop2.prop3;\nconsole.log(value); // Output: \"value\"\n\nThe main difference between optional chaining and this approach is that optional\nchaining is more concise, readable, and expressive. It's also less error-prone,\nas it eliminates the need to manually check for null and undefined values at\nevery step.\n\nProxies [ for metaprogramming like reflection ]\nA proxy in JavaScript is an object that acts as an intermediary between a target\nobject and the code that interacts with it. Proxies are used to intercept and\nmodify operations performed on the target object, such as property access,\nmethod calls, and object assignments. This makes them a powerful tool for adding\ncustom behavior to existing objects, enforcing constraints, and creating\nabstractions.\n\nAn example use case of a proxy is to add a logging mechanism to an object to\ntrack when its properties are accessed. Here's an example of how this can be\ndone using a proxy:\n\nlet target = { name: 'John Doe' };\n\nlet handler = {\n  get: function(target, prop) {\n    console.log(`Accessing property ${prop}`);\n    return target[prop];\n  }\n};\n\nlet proxy = new Proxy(target, handler);\n\nconsole.log(proxy.name); // Output: Accessing property name\n//                           John Doe\n\nIn this example, we define a target object and a handler object. The handler\nobject contains a get method that logs a message and returns the value of the\ntarget object's property. Finally, we create a new proxy object by passing the\ntarget and the handler to the Proxy constructor. When we access the name \nproperty of the proxy object, the get method of the handler is called, logging\nthe message and returning the value of the target object's property.\n\nIt is example of Reflection - a feature that allows a program to inspect and\nmanipulate its own structure and behavior at runtime. This includes\nintrospection of objects, classes, and methods, as well as modification of their\nproperties and behavior.\n\nIn our example there is console.log but you can use any logic in get or set\ntraps. For example notifying other parts of program about change or logging\nchanges history. Proxy is extensively used in implementation of reactivity in\nfrontend frameworks like Vue.\n\nThere is 13 traps in Proxy that are described here:\n\nLooking at All 13 JavaScript Proxy Traps | DigitalOceanA collection of code\nsnippets to show all 13 Javascript Proxy traps in action.DigitalOceanJack\nMisteli [https://www.digitalocean.com/community/tutorials/js-proxy-traps]I will\nshow only 3 most popular get, set and has. In example below we can build handler\nthat allow us to build objects that prevent to access to \"private\" properties.\n\nfunction invariant (key, action) {\n  if (key[0] === '_') {\n    throw new Error(`Invalid attempt to ${action} private \"${key}\" property`)\n  }\n}\nvar handler = {\n  get (target, key) {\n    invariant(key, 'get')\n    return target[key]\n  },\n  set (target, key, value) {\n    invariant(key, 'set')\n    return true\n  },\n  has (target, key) {\n    if (key[0] === '_') {\n      return false\n    }\n    return key in target\n  }\n}\n\nProxies deserve for distinct article, but I hope you feel to be inspired to\nlearn them deeper.\n\nPrivate fields [ privacy without WeakMap and closures ]\nPrivate fields in JavaScript are a feature introduced in ECMAScript 2020 that\nallow you to define properties on an object that are not accessible from outside\nof the object. They are written using a # symbol before the property name and\nare only accessible within the object's methods.\n\nPrivate members are not native to the language before this syntax existed. In\nprototypical inheritance, its behavior may be emulated with WeakMap\n[https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/WeakMap#emulating_private_members] \nobjects or closures\n[https://developer.mozilla.org/en-US/docs/Web/JavaScript/Closures#emulating_private_methods_with_closures]\n, but they can't compare to the # syntax in terms of ergonomics.\n\nHere's an example of how private fields can be used in JavaScript:\n\nclass Person {\n  #name;\n\n  constructor(name) {\n    this.#name = name;\n  }\n\n  getName() {\n    return this.#name;\n  }\n}\n\nlet person = new Person('John Doe');\nconsole.log(person.getName()); // Output: \"John Doe\"\nconsole.log(person.#name); // Output: SyntaxError: Private field '#name' must be accessed within the class declaration.\n\nIn this example, we define a Person class with a private field #name. The #name \nfield is assigned a value in the constructor, and a getName method is defined to\nreturn its value. When we try to access the #name field outside of the Person \nclass, we get a SyntaxError indicating that private fields must be accessed\nwithin the class declaration.\n\nPrivate fields provide a way to encapsulate an object's internal state and\nprevent it from being modified or accessed directly. This makes it easier to\nmaintain the integrity of the object's data and enforce its internal invariants.\n\nIt is great that this feature was introduced but i think it seems to be still\nquite unknown. More detailed specs below:\n\nPrivate class features - JavaScript | MDNClass fields are public by default,\nbut\nprivate class members can be created by using a hash # prefix. The privacy\nencapsulation of these class features is enforced by JavaScript itself.MDN Web\nDocs\n[https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Classes/Private_class_fields]\nPromise.allSettled() [ for concurrent programming ]\nThe Promise.allSettled() method in JavaScript is used to create a single Promise\nthat resolves when all of the promises in an iterable have settled (either\nfulfilled or rejected). It returns an array of objects that represent the\noutcome of each promise, rather than a single value or an error.\n\nHere's an example of how Promise.allSettled() can be used in JavaScript:\n\nlet p1 = Promise.resolve(42);\nlet p2 = Promise.reject(new Error('failed'));\nlet p3 = Promise.resolve(10);\n\nPromise.allSettled([p1, p2, p3]).then((results) => {\n  console.log(results);\n  /* Output:\n  [\n    { status: 'fulfilled', value: 42 },\n    { status: 'rejected', reason: Error: failed },\n    { status: 'fulfilled', value: 10 }\n  ]\n  */\n});\n\nIn this example, we create three promises: p1, p2, and p3. p1 is a resolved\npromise with a value of 42, p2 is a rejected promise with an error message, and \np3 is a resolved promise with a value of 10. We then pass these promises as an\niterable to Promise.allSettled() and log the results when they have all settled.\nThe result is an array of objects that represent the outcome of each promise,\nwith a status property that indicates whether the promise was fulfilled or\nrejected, and a value or reason property that contains the result or error.\n\nThe Promise.allSettled() method is useful when you want to wait for multiple\npromises to complete, but you don't need to know the outcome of each promise in\norder to continue. Unlike Promise.all(), which rejects with the first error that\noccurs, Promise.allSettled() will wait for all promises to settle before\nresolving, even if some of them are rejected.\n\nPromise.allSettled() - JavaScript | MDNThe Promise.allSettled() static method\ntakes an iterable of promises as input and returns a single Promise. This\nreturned promise fulfills when all of the input’s promises settle (including\nwhen an empty iterable is passed), with an array of objects that describe the\noutcome of each promise.MDN Web Docs\n[https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise/allSettled]\nBigInt [ for Math and huge Id from databases ]\nBigInt is a new primitive type in JavaScript that was introduced in ECMAScript\n2020. It represents an arbitrarily large integer and allows you to perform\narithmetic operations with values that can be larger than the Number type's\nmaximum safe integer value of 2^53 - 1.\n\nHere's an example of how BigInt can be used in JavaScript:\n\nconst a = BigInt(9007199254740992);\nconst b = BigInt(1);\nconsole.log(a + b); // Output: 9007199254740993n\n\nIn this example, we create two BigInt values and perform an addition operation\non them. The result is a BigInt value that accurately represents the result of\nthe calculation, even though it exceeds the maximum safe integer value of Number\n.\n\nFor comparison adding one to such big Number your will get wrong result\n\nconsole.log(9007199254740992 + 1); // 9007199254740992\n\n\nAnother difference is that BigInt values support a more limited set of\narithmetic and comparison operations than Number values. For example, BigInt\nvalues do not support operations such as division by zero, NaN, or Infinity.\n\nBigInt(1) / BigInt(0); // Uncaught RangeError: Division by zero\n\nand\n\nBigInt(1) / 0; // Uncaught TypeError: Cannot mix BigInt and other types, use explicit conversions\n\nBigInt provides a way to represent and manipulate large integers in JavaScript\nwithout the loss of precision that can occur with the Number type. It is\nparticularly useful in cases where you need to perform calculations with values\nthat exceed the maximum safe integer value of Number.\n\nBigInt - JavaScript | MDNBigInt values represent numeric values which are too\nlarge to be represented by the number primitive.MDN Web Docs\n[https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/BigInt]\nDynamic Import\nDynamic Import is a feature in JavaScript that allows you to load a module or a\npiece of code asynchronously at runtime, rather than at the time of parsing and\nexecuting the script. This allows you to load only the resources that you need\nwhen you need them, rather than loading everything upfront, which can improve\nthe performance and load time of your application.\n\nHere's an example of how Dynamic Import can be used in JavaScript:\n\n// ? say.mjs\nconsole.log(\"Now file is imported\");\n\nexport function hi() {\n  console.log(`Hello`);\n}\n\nexport function bye() {\n  console.log(`Bye`);\n}\n\n\n\nand\n\nasync function main() {\n  let {hi, bye} = await import('./say.mjs');\n\n  hi();\n  bye();\n}\n\nconsole.log(\"Import not executed yet\");\nmain().catch(console.error);\n\nCommand node index.js will print\n\nImport not executed yet\nNow file is imported\nHello\nBye\n\n\nIn this example, we use the import() function to load a module module.js \nasynchronously. The import() function returns a Promise that resolves to the\nmodule object, which we can then access using destructuring or the default\nproperty.\n\nDynamic Import is different from the other import types (such as import and \nrequire statements) in a few key ways:\n\n * Load Time: Dynamic Import is loaded at runtime, when the import() function is\n   called, rather than at the time of parsing the script. This means that the\n   module or code is only loaded when it is actually needed, which can improve\n   the performance and load time of your application.\n * Return Value: Dynamic Import returns a Promise that resolves to the module\n   object, rather than the module object itself. This allows you to load the\n   module asynchronously and handle the result when it is available, rather than\n   blocking the execution of the script while the module is being loaded.\n * Code Splitting: Dynamic Import enables you to split your code into smaller,\n   more manageable pieces that can be loaded on demand. This can improve the\n   performance and scalability of your application by reducing the amount of\n   code that needs to be loaded and parsed at the start of your script.\n\nDynamic Import provides a flexible and powerful way to load code asynchronously\nin JavaScript, and is particularly useful for large and complex applications\nthat need to load resources on demand. By using Dynamic Import, you can optimize\nthe performance and load time of your application, and improve the overall user\nexperience.\n\nYou can learn more comparing docs of static import\n\nimport - JavaScript | MDNThe static import declaration is used to import\nread-only live bindings which are exported by another module. The imported\nbindings are called live bindings because they are updated by the module that\nexported the binding, but cannot be re-assigned by the importing module.MDN Web\nDocs\n[https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/import]\nWith dynamic import described here\n\nimport() - JavaScript | MDNThe import() syntax, commonly called dynamic import,\nis a function-like expression that allows loading an ECMAScript module\nasynchronously and dynamically into a potentially non-module environment.MDN\nWeb\nDocs\n[https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/import]\nThanks to dynamic imports you can manage both time of importing and patch to\nimported module in runtime what can be useful for example if you have to load\ndictionary with translations of your website or picking one component instead of\nall to display first page.\n\nreplaceAll [ concise syntax for replace with //g ]\nThe String.prototype.replaceAll method in JavaScript is a recent addition (part\nof the ECMAScript 2022 standard) that provides a more straightforward way to\nperform global search-and-replace operations on strings. Unlike the previous\nmethod of using String.prototype.replace with a regular expression and the g \n(global) flag, String.prototype.replaceAll provides a simpler syntax for this\ncommon use case.\n\nFor example, to globally replace all occurrences of a target string with another\nstring, you can use replaceAll as follows:\n\nconst originalString = \"Hello world! Hello again.\";\nconst newString = originalString.replaceAll(\"Hello\", \"Goodbye\");\nconsole.log(newString); // Goodbye world! Goodbye again.\n\nIn comparison, using replace with a regular expression and the g flag would look\nlike this:\n\nconst originalString = \"Hello world! Hello again.\";\nconst newString = originalString.replace(/Hello/g, \"Goodbye\");\nconsole.log(newString); // Goodbye world! Goodbye again.\n\nAs you can see, replaceAll provides a more concise and readable syntax for this\ncommon use case.\n\nNumeric Separators [ sugar for code redability ]\nNumeric separators in JavaScript are a recent addition (part of the ECMAScript\n2020 standard) that allow developers to make large numbers easier to read by\nadding underscores as separators between groups of digits. The underscores are\nignored during evaluation, but serve as a visual aid to separate the digits.\n\nFor example, instead of writing:\n\nconst x = 1000000000;\n\n\nYou can write:\n\nconst x = 1_000_000_000;\n\nThis makes it easier to see the different groups of digits, especially in large\nnumbers. Numeric separators can be used with decimal literals as well as binary,\noctal, and hexadecimal literals.\n\nHere's an example using binary literals:\n\nconst y = 0b1010_0101_1001_0010;\n\nAnd here's an example using hexadecimal literals:\n\nconst z = 0xff_ff_ff;\n\nIn all cases, the numeric separators are ignored during evaluation, and the\nvalues are stored and used just like any other number in JavaScript.\n\nmatchAll [ access to matches for //g regex ]\nThe String.prototype.matchAll() method in JavaScript is a recent addition (part\nof the ECMAScript 2020 standard) that provides a new way to extract all matches\nof a regular expression from a string. Unlike the previous method of using \nString.prototype.match with a regular expression, String.prototype.matchAll \nreturns an iterator that yields all matches, rather than just the first match or\nall matches as an array.\n\nFor example, to extract all occurrences of a target string from a string, you\ncan use matchAll as follows:\n\nconst originalString = \"Hello world! Hello again.\";\nconst regex = /Hello/g;\nconst matches = originalString.matchAll(regex);\n\nnow matches is object RegExpStringIterator.\n\nwe can get acess to single match by next\n\nm = matches.next()\n\nthen m will be object with bolean done and value that contains details about\nmatch.\n\nsecond option to get matches is iteration\n\nfor (const match of matches) {\n  console.log(match[0]);\n}\n// Hello\n// Hello\n\nor \n\nIn comparison, using match with a regular expression would look like this:\n\nconst originalString = \"Hello world! Hello again.\";\nconst regex = /Hello/g;\nconst matches = originalString.match(regex);\nconsole.log(matches); // [ \"Hello\", \"Hello\" ]\n\nso match is losing access to index, input and groups when was used with //g \nregex. \n\nAs you can see, matchAll provides a way to work with each match one by one,\nrather than having to process all matches as an array. This can be useful in\ncertain cases, such as when you need to perform additional processing on each\nmatch, or when you need to extract information from the captured groups within\neach match. Additionally, because matchAll returns an iterator, you can use it\nin a for...of loop, which can make your code more readable and concise.\n\nLogical Assignment [ conditional assignment ]\nLogical assignment in JavaScript is a new feature (part of the ECMAScript 2021\nstandard) that allows you to simplify and condense certain types of assignments\nthat involve logical operations. It provides a shorthand for combining an\nassignment with a logical operation, such as && or ||.\n\nThe logical assignment operators are &&=, ||=, and ??=. They perform the same\noperations as the corresponding logical operators, but with the added behavior\nof assignment.\n\nx &&= y\n\nis equivalent to\n\nx && (x = y);\n\n\nHere's an example using the &&= operator:\n\nlet x = 1;\nx &&= 2;\nconsole.log(x); // 2\n\nx = 0;\nx &&= 2;\nconsole.log(x); // 0\n\nIn the first case, x is assigned the value of 2, because 1 && 2 is 2. In the\nsecond case, x is assigned the value of 0, because 0 && 2 is 0.\n\nHere's an example using the ||= operator:\n\nlet x = null;\nx ||= 1;\nconsole.log(x); // 1\n\nx = 2;\nx ||= 1;\nconsole.log(x); // 2\n\nIn the first case, x is assigned the value of 1, because null || 1 is 1. In the\nsecond case, x is assigned the value of 2, because 2 || 1 is 2.\n\nAnd here's an example using the ??= operator:\n\nlet x = null;\nx ??= 1;\nconsole.log(x); // 1\n\nx = 2;\nx ??= 1;\nconsole.log(x); // 2\n\nIn the first case, x is assigned the value of 1, because null ?? 1 is 1. In the\nsecond case, x is assigned the value of 2, because 2 ?? 1 is 2. The ?? operator\nis similar to the || operator, but it only evaluates the right-side expression\nif the left-side expression is null or undefined.\n\nPromise.any() [ for racings ]\nThe Promise.any() method in JavaScript is a recent addition (part of the\nECMAScript 2020 standard) that allows you to wait for the first of several\npromises to settle (i.e., to either resolve or reject), and then return the\nresult of that promise. It provides a way to wait for multiple promises to\ncomplete and return the first one that succeeds, without having to wait for all\nof them to finish.\n\nHere's an example usage of Promise.any()\n\nconst promise1 = Promise.resolve(1);\nconst promise2 = Promise.reject(new Error(\"error\"));\nconst promise3 = Promise.resolve(3);\n\nPromise.any([promise1, promise2, promise3])\n  .then((value) => {\n    console.log(value); // 1\n  })\n  .catch((error) => {\n    console.error(error);\n  });\n\nIn this example, the Promise.any() method takes an array of promises as its\nargument and returns a new promise that is resolved with the first resolved\nvalue from the input promises. If all of the input promises are rejected, \nPromise.any() returns a rejected promise with the first error that occurs.\n\nThe use of Promise.any() can simplify your code and improve performance in cases\nwhere you want to wait for multiple promises to complete, but you only need to\nhandle the result of the first one that succeeds.\n\nArray.prototype.at()\nThe at() method takes an integer value and returns the item at that index,\nallowing for positive and negative integers. Negative integers count back from\nthe last item in the array.\n\na = [0,1,2]\na.at(0); // 0\na.at(4); // undefined\na.at(-2); // 1\na.at(Infinity); // undefined\n\nIt is nice feature. Before I used to apply syntax\n\na[(a.length + n) % a.length]\n\nto recive similar (but not the same) results:\n\na[(a.length + 0) % a.length] // 0 as a.at(0)\na[(a.length + 4) % a.length] // 1\na[(a.length -2) % a.length] // 1\na[(a.length + Infinity) % a.length] // undefined\n\nTop level await\nThis concept is connected with dynamic import. Because of your import is\nexecuted in runtime, so exported objects can be prepared in runtime. So there is\nno reasons to no give them some time.\n\nWe can achieve it by syntax like this\n\nconst colors = fetch(\"../data/colors.json\").then((response) => response.json());\n\nexport default await colors;\n\nin imported module. Let mi present full example:\n\n// file objects.mjs\nconst res = fetch('https://api.restful-api.dev/objects');\n\nexport default await (await res).json();\n\nand\n\n// file index.js\nasync function main() {\n  let ok = await import('./objects.mjs');\n  console.log(ok.default);\n}\n\nmain().catch(console.error);\n\n\nexecution will print in console:\n\n[\n  {\n    id: '1',\n    name: 'Google Pixel 6 Pro',\n    data: { color: 'Cloudy White', capacity: '128 GB' }\n  },\n  ...\n]\n\nYou can read about more awesome await features here:\n\nawait - JavaScript | MDNThe await operator is used to wait for a Promise and\nget\nits fulfillment value. It can only be used inside an async function or at the\ntop level of a module.MDN Web Docs\n[https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/await]\n--------------------------------------------------------------------------------\n\nIt is all in this article, but definitely I touched only small part of current\nJS features and I am sure that this article is worse source to learn them than\nofficial specs . His goal was rather summarize, which features I see as useful\nbut still rarely seen in codebase.\n\nI hope you feel inspired or learned something new and if yes, click subscribe or\nwrite comment. Thx","feature_image":"__GHOST_URL__/content/images/2023/02/59V2HDhX9VJfOqntLdv8--1--s4sqx.jpg","featured":0,"type":"post","status":"published","locale":null,"visibility":"public","email_recipient_filter":"all","created_at":"2023-02-08T12:31:41.000Z","updated_at":"2023-02-08T16:39:54.000Z","published_at":"2023-02-08T16:39:54.000Z","custom_excerpt":"Nullish coalescing, Nullish coalescing, Optional chaining, Proxies, Private fields, Promise.allSettled, BigInt, Dynamic Import, String.replaceAll, Numeric Separators, String.matchAll, Logical Assignment, Promise.any, Array.prototype.at, Top level await","codeinjection_head":null,"codeinjection_foot":null,"custom_template":null,"canonical_url":null,"newsletter_id":null,"lexical":null},{"id":"63ee10a8bbda300a2f29d2df","uuid":"5fb4c0e3-6e0b-4559-ad68-9e0242754ea2","title":"New Google Identity in Nuxt 3","slug":"new-google-login","mobiledoc":"{\"version\":\"0.3.1\",\"atoms\":[],\"cards\":[[\"bookmark\",{\"type\":\"bookmark\",\"url\":\"https://stackoverflow.com/questions/74559363/how-to-use-nuxtjs-auth-next-module-with-nuxt3\",\"metadata\":{\"url\":\"https://stackoverflow.com/questions/74559363/how-to-use-nuxtjs-auth-next-module-with-nuxt3\",\"title\":\"How to use nuxtjs/auth-next module with Nuxt3?\",\"description\":\"Just trying to add authentication to my NuxtJs 3 app folloging nuxt/auth configuration docs, but still get an error during app start: // nuxt.config.js export default defineNuxtConfig({ auth...\",\"author\":\"fudo\",\"publisher\":\"Stack Overflow\",\"thumbnail\":\"https://cdn.sstatic.net/Sites/stackoverflow/Img/apple-touch-icon@2.png?v=73d79a89bded\",\"icon\":\"https://cdn.sstatic.net/Sites/stackoverflow/Img/apple-touch-icon.png?v=c78bd457575a\"}}],[\"bookmark\",{\"type\":\"bookmark\",\"url\":\"https://nuxt.com/docs/community/roadmap#%EF%B8%8F-roadmap\",\"metadata\":{\"url\":\"https://nuxt.com/docs/community/roadmap#%EF%B8%8F-roadmap\",\"title\":\"Roadmap · Nuxt\",\"description\":\"Nuxt is constantly evolving, with new features and modules being added all the time.\",\"author\":null,\"publisher\":null,\"thumbnail\":\"https://flat.badgen.net/npm/v/nuxt\",\"icon\":\"https://nuxt.com/icon.png\"}}],[\"image\",{\"src\":\"__GHOST_URL__/content/images/2023/02/Zrzut-ekranu-z-2023-02-16-18-26-11.png\",\"width\":941,\"height\":225}],[\"bookmark\",{\"type\":\"bookmark\",\"url\":\"https://developers.google.com/identity/sign-in/web/sign-in\",\"metadata\":{\"url\":\"https://developers.google.com/identity/sign-in/web/sign-in\",\"title\":\"Integrating Google Sign-In into your web app | Authentication | Google Developers\",\"description\":null,\"author\":null,\"publisher\":\"Google Developers\",\"thumbnail\":\"https://www.gstatic.com/devrel-devsite/prod/vd277a93d7226f1fcf53372e6780919bb823bca6ca1c3adbaa8a14ef6554ad67d/developers/images/opengraph/teal.png\",\"icon\":\"https://www.gstatic.com/devrel-devsite/prod/vd277a93d7226f1fcf53372e6780919bb823bca6ca1c3adbaa8a14ef6554ad67d/developers/images/touchicon-180.png\"}}],[\"image\",{\"src\":\"__GHOST_URL__/content/images/2023/02/3sa379.jpg\",\"width\":500,\"height\":500}],[\"bookmark\",{\"type\":\"bookmark\",\"url\":\"https://developers.google.com/identity/gsi/web/guides/personalized-button\",\"metadata\":{\"url\":\"https://developers.google.com/identity/gsi/web/guides/personalized-button\",\"title\":\"Sign in with Google button UX | Authentication | Google Developers\",\"description\":null,\"author\":null,\"publisher\":\"Google Developers\",\"thumbnail\":\"https://www.gstatic.com/devrel-devsite/prod/vd277a93d7226f1fcf53372e6780919bb823bca6ca1c3adbaa8a14ef6554ad67d/developers/images/opengraph/teal.png\",\"icon\":\"https://www.gstatic.com/devrel-devsite/prod/vd277a93d7226f1fcf53372e6780919bb823bca6ca1c3adbaa8a14ef6554ad67d/developers/images/touchicon-180.png\"}}],[\"image\",{\"src\":\"__GHOST_URL__/content/images/2023/02/personalized-button-multiple.png\",\"width\":207,\"height\":45}],[\"code\",{\"code\":\"  <div id=\\\"g_id_onload\\\"\\n       :data-client_id=\\\"config.public.googleClientId\\\"\\n       data-context=\\\"signin\\\"\\n       data-ux_mode=\\\"popup\\\"\\n       data-callback=\\\"googleLoginCallback\\\"\\n       data-auto_select=\\\"true\\\"\\n       data-itp_support=\\\"true\\\">\\n  </div>\\n\\n  <div class=\\\"g_id_signin\\\"\\n       data-type=\\\"standard\\\"\\n       data-shape=\\\"pill\\\"\\n       data-theme=\\\"outline\\\"\\n       data-text=\\\"continue_with\\\"\\n       data-size=\\\"large\\\"\\n       data-logo_alignment=\\\"left\\\">\\n  </div>\"}],[\"bookmark\",{\"type\":\"bookmark\",\"url\":\"https://developers.google.com/identity/gsi/web/tools/configurator\",\"metadata\":{\"url\":\"https://developers.google.com/identity/gsi/web/tools/configurator\",\"title\":\"Generate HTML code | Authentication | Google Developers\",\"description\":null,\"author\":null,\"publisher\":\"Google Developers\",\"thumbnail\":\"https://www.gstatic.com/devrel-devsite/prod/vd277a93d7226f1fcf53372e6780919bb823bca6ca1c3adbaa8a14ef6554ad67d/developers/images/opengraph/teal.png\",\"icon\":\"https://www.gstatic.com/devrel-devsite/prod/vd277a93d7226f1fcf53372e6780919bb823bca6ca1c3adbaa8a14ef6554ad67d/developers/images/touchicon-180.png\"}}],[\"image\",{\"src\":\"__GHOST_URL__/content/images/2023/02/3.5-3.jpg\",\"width\":564,\"height\":681}],[\"bookmark\",{\"type\":\"bookmark\",\"url\":\"https://stackoverflow.com/questions/53993890/how-to-pass-env-variables-to-nuxt-in-production/74463160#74463160\",\"metadata\":{\"url\":\"https://stackoverflow.com/questions/53993890/how-to-pass-env-variables-to-nuxt-in-production\",\"title\":\"How to pass env variables to nuxt in production?\",\"description\":\"nuxt.config.js modules: [ ‘@nuxtjs/dotenv’ ], server/index.js const express = require(‘express’)\\nconst consola = require(‘consola’)\\nconst { Nuxt, Builder } = require(‘nuxt’)\\nconst app = ex...\",\"author\":\"Rounak Jain\",\"publisher\":\"Stack Overflow\",\"thumbnail\":\"https://cdn.sstatic.net/Sites/stackoverflow/Img/apple-touch-icon@2.png?v=73d79a89bded\",\"icon\":\"https://cdn.sstatic.net/Sites/stackoverflow/Img/apple-touch-icon.png?v=c78bd457575a\"}}],[\"code\",{\"code\":\"GOOGLE_CLIENT_ID=xxx.apps.googleusercontent.com\\n\"}],[\"code\",{\"code\":\"include .env\\nexport\\n\\nnode_modules: package.json\\n\\tnpm i\\n\\nup: node_modules\\n\\tnpm run dev\\n\"}],[\"code\",{\"code\":\"export default defineNuxtConfig({\\n    runtimeConfig: {\\n        public: {\\n            googleClientId: process.env.GOOGLE_CLIENT_ID ?? '',\\n        }\\n    },\\n})\\n\"}],[\"code\",{\"code\":\"const config = useRuntimeConfig()\\n\"}],[\"code\",{\"code\":\"declare global {\\n    interface Window {\\n        googleLoginCallback: () => void;\\n    }\\n}\\n\"}],[\"code\",{\"code\":\"if(process.client) {\\n  window.googleLoginCallback = (...args) => {\\n    console.log(args);\\n  }\\n}\"}],[\"bookmark\",{\"type\":\"bookmark\",\"url\":\"https://developers.google.com/identity/gsi/web/guides/client-library\",\"metadata\":{\"url\":\"https://developers.google.com/identity/gsi/web/guides/client-library\",\"title\":\"Load the client library | Authentication | Google Developers\",\"description\":null,\"author\":null,\"publisher\":\"Google Developers\",\"thumbnail\":\"https://www.gstatic.com/devrel-devsite/prod/vd277a93d7226f1fcf53372e6780919bb823bca6ca1c3adbaa8a14ef6554ad67d/developers/images/opengraph/teal.png\",\"icon\":\"https://www.gstatic.com/devrel-devsite/prod/vd277a93d7226f1fcf53372e6780919bb823bca6ca1c3adbaa8a14ef6554ad67d/developers/images/touchicon-180.png\"}}],[\"code\",{\"code\":\"<script src=\\\"https://accounts.google.com/gsi/client\\\" async defer></script>\\n\"}],[\"code\",{\"code\":\"useHead({\\n  script: [{\\n    async: true,\\n    src: 'https://accounts.google.com/gsi/client',\\n    defer: true\\n  }]\\n})\"}],[\"image\",{\"src\":\"__GHOST_URL__/content/images/2023/02/Zrzut-ekranu-z-2023-02-16-18-47-12.png\",\"width\":456,\"height\":402}],[\"image\",{\"src\":\"__GHOST_URL__/content/images/2023/02/Zrzut-ekranu-z-2023-02-16-18-47-27.png\",\"width\":727,\"height\":654}],[\"code\",{\"code\":\"{\\n  clientId:\\\"xxx.apps.googleusercontent.com\\\"\\n  client_id:\\\"xxx.apps.googleusercontent.com\\\"\\n  credential: \\\"token\\\"\\n  select_by:\\\"auto\\\"\\n}\"}],[\"code\",{\"code\":\"{\\n  \\\"iss\\\": \\\"https://accounts.google.com\\\",\\n  \\\"nbf\\\": 1676544985,\\n  \\\"aud\\\": \\\"xxx.apps.googleusercontent.com\\\",\\n  \\\"sub\\\": \\\"108561822785941523583\\\",\\n  \\\"email\\\": \\\"gustaw.daniel@gmail.com\\\",\\n  \\\"email_verified\\\": true,\\n  \\\"azp\\\": \\\"xxx.apps.googleusercontent.com\\\",\\n  \\\"name\\\": \\\"Daniel Gustaw\\\",\\n  \\\"picture\\\": \\\"https://lh3.googleusercontent.com/a/AEdFTp64X-0imH5xey6U4JDKzFRrMXdtg4lGy8GlEjLxyQ=s96-c\\\",\\n  \\\"given_name\\\": \\\"Daniel\\\",\\n  \\\"family_name\\\": \\\"Gustaw\\\",\\n  \\\"iat\\\": 1676545285,\\n  \\\"exp\\\": 1676548885,\\n  \\\"jti\\\": \\\"a7e1afd716925de385bf0069c7c370f8e64580d3\\\"\\n}\"}],[\"image\",{\"src\":\"__GHOST_URL__/content/images/2023/02/b33f57187cba4a7e2ebebc6b9987f09b.jpg\",\"width\":840,\"height\":1074}],[\"bookmark\",{\"type\":\"bookmark\",\"url\":\"__GHOST_URL__/login-by-metamask-rest-backend-in-fastify/\",\"metadata\":{\"url\":\"__GHOST_URL__/login-by-metamask-rest-backend-in-fastify/\",\"title\":\"Login by Metamask - Rest Backend in Fastify (Node, Typescript, Prisma) Part 1/2\",\"description\":\"We building from scratch rest api in fastify using mongodb connected by prisma as database, jest as test framework and etherjs to verify signatures signed by metamask.\",\"author\":\"Daniel Gustaw\",\"publisher\":\"Precise Lab\",\"thumbnail\":\"__GHOST_URL__/content/images/2022/11/metamask-fastify-min.jpg\",\"icon\":\"__GHOST_URL__/favicon.png\"}}],[\"code\",{\"code\":\"app.post('/google-verify', Auth.googleVerify)\"}],[\"bookmark\",{\"type\":\"bookmark\",\"url\":\"https://developers.google.com/identity/gsi/web/guides/verify-google-id-token\",\"metadata\":{\"url\":\"https://developers.google.com/identity/gsi/web/guides/verify-google-id-token\",\"title\":\"Verify the Google ID token on your server side | Authentication | Google Developers\",\"description\":null,\"author\":null,\"publisher\":\"Google Developers\",\"thumbnail\":\"https://www.gstatic.com/devrel-devsite/prod/vd277a93d7226f1fcf53372e6780919bb823bca6ca1c3adbaa8a14ef6554ad67d/developers/images/opengraph/teal.png\",\"icon\":\"https://www.gstatic.com/devrel-devsite/prod/vd277a93d7226f1fcf53372e6780919bb823bca6ca1c3adbaa8a14ef6554ad67d/developers/images/touchicon-180.png\"}}],[\"code\",{\"code\":\"npm install google-auth-library --save\\n\"}],[\"code\",{\"code\":\"GOOGLE_CLIENT_ID=xxx.apps.googleusercontent.com\\n\"}],[\"code\",{\"code\":\"import {FastifyRequest} from \\\"fastify\\\";\\nimport {OAuth2Client} from 'google-auth-library';\\n\\nexport class Auth {\\n  static async googleVerify(req: FastifyRequest<{ Body: { credential: string } }>) {\\n    const client = new OAuth2Client(process.env.GOOGLE_CLIENT_ID);\\n    const ticket = await client.verifyIdToken({\\n      idToken: req.body.credential,\\n      audience: process.env.GOOGLE_CLIENT_ID,\\n    });\\n    const payload = ticket.getPayload();\\n    if(!payload) throw new Error(`No payload`);\\n        \\n    console.log(payload);\\n    return payload;\\n  }\\n}\\n\"}],[\"code\",{\"code\":\"interface GoogleAuthenticatedResponse {\\n    clientId: string\\n    client_id: string\\n    credential: string\\n    select_by: \\\"auto\\\"\\n}\\n\\ndeclare global {\\n    interface Window {\\n        googleLoginCallback: (userData: GoogleAuthenticatedResponse) => void;\\n    }\\n}\\n\"}],[\"code\",{\"code\":\"if(process.client) {\\n  window.googleLoginCallback = (userData) => {\\n    console.log(\\\"ud\\\", userData);\\n    axios.post(config.public.apiUrl + '/google-verify', {\\n      credential: userData.credential\\n    }).then((res) => {\\n      console.log(\\\"pl\\\", res.data)\\n    }).catch(console.error)\\n  }\\n}\"}],[\"image\",{\"src\":\"__GHOST_URL__/content/images/2023/02/Zrzut-ekranu-z-2023-02-16-19-18-48.png\",\"width\":859,\"height\":137}],[\"image\",{\"src\":\"__GHOST_URL__/content/images/2023/02/06ivdlvuveq21.jpg\",\"width\":640,\"height\":942}],[\"code\",{\"code\":\"npm i @fastify/cors\\n\"}],[\"code\",{\"code\":\"import cors from '@fastify/cors'\\n\\n//...\\n\\n    app.register(cors)\"}],[\"image\",{\"src\":\"__GHOST_URL__/content/images/2023/02/Zrzut-ekranu-z-2023-02-16-16-35-17.png\",\"width\":1451,\"height\":456}],[\"bookmark\",{\"type\":\"bookmark\",\"url\":\"__GHOST_URL__/login-by-metamask-rest-backend-in-fastify/\",\"metadata\":{\"url\":\"__GHOST_URL__/login-by-metamask-rest-backend-in-fastify/\",\"title\":\"Login by Metamask - Rest Backend in Fastify (Node, Typescript, Prisma) Part 1/2\",\"description\":\"We building from scratch rest api in fastify using mongodb connected by prisma as database, jest as test framework and etherjs to verify signatures signed by metamask.\",\"author\":\"Daniel Gustaw\",\"publisher\":\"Precise Lab\",\"thumbnail\":\"__GHOST_URL__/content/images/2022/11/metamask-fastify-min.jpg\",\"icon\":\"__GHOST_URL__/favicon.png\"}}]],\"markups\":[[\"code\"]],\"sections\":[[1,\"p\",[[0,[],0,\"I was scared today because two great libraries did not work with Google Sign In for Nuxt 3. I mean \"],[0,[0],1,\"auth.nuxtjs\"],[0,[],0,\" and \"],[0,[0],1,\"nuxt-vue3-google-signin\"],[0,[],0,\".\"]]],[1,\"p\",[[0,[],0,\"From stack overflow\"]]],[10,0],[1,\"p\",[[0,[],0,\"I learned that first one is incompatible with nuxt 3, but it is planned on roadmap\"]]],[10,1],[1,\"p\",[[0,[],0,\"Second simply could not work giving error that was suggesting that something is wrong with my client id.\"]]],[1,\"p\",[[0,[],0,\"I checked official Google Docs and see this:\"]]],[10,2],[10,3],[1,\"p\",[[0,[],0,\"Looks terrible, but hepilly I integrated google sign in button quite fast without external libs. In this article I will show how to implement new Google Identity with Nuxt 3.\"]]],[10,4],[1,\"h2\",[[0,[],0,\"Google Identity - how it is different\"]]],[1,\"p\",[[0,[],0,\"Because image is worth more than thousand of words, new login button contains avatar:\"]]],[10,5],[10,6],[1,\"h2\",[[0,[],0,\"Sign In button HTML\"]]],[1,\"p\",[[0,[],0,\"To add it to your component you will need paste below html\"]]],[10,7],[1,\"p\",[[0,[],0,\"or prepare your own in configurator\"]]],[10,8],[10,9],[1,\"p\",[[0,[],0,\"There are three elements that we have to connect:\"]]],[3,\"ol\",[[[0,[0],1,\"config.public.googleClientId\"],[0,[],0,\" - google client ID\"]],[[0,[0],1,\"googleLoginCallback\"],[0,[],0,\" - globally defined function that will get results of login\"]],[[0,[],0,\"google library that will make these buttons working\"]]]],[1,\"h2\",[[0,[],0,\"Passing .env to Nuxt 3\"]]],[1,\"p\",[[0,[],0,\"To pass .env to nuxt 3 you can follow this answer\"]]],[10,10],[1,\"p\",[[0,[],0,\"You create \"],[0,[0],1,\".env\"],[0,[],0,\" file with\"]]],[10,11],[1,\"p\",[[0,[],0,\"to connect these values you can use \"],[0,[0],1,\"dotenv\"],[0,[],0,\" library, but I prefere \"],[0,[0],1,\"Makefile\"],[0,[],0,\" like this one\"]]],[10,12],[1,\"p\",[[0,[],0,\"In nuxt config you should add\"]]],[10,13],[1,\"p\",[[0,[],0,\"and finally in component you can get access to \"],[0,[0],1,\"config\"],[0,[],0,\" by\"]]],[10,14],[1,\"h2\",[[0,[],0,\"Extending window by callback function\"]]],[1,\"p\",[[0,[],0,\"Window by default do not have  \"],[0,[0],1,\"googleLoginCallback\"],[0,[],0,\" so to add it you should create file \"],[0,[0],1,\"types/global.d.ts\"],[0,[],0,\" with\"]]],[10,15],[1,\"p\",[[0,[],0,\"and in component add\"]]],[10,16],[1,\"h2\",[[0,[],0,\"Load the client library in Nuxt 3\"]]],[1,\"p\",[[0,[],0,\"Google mentions about this step on page\"]]],[10,17],[1,\"p\",[[0,[],0,\"But you should not add\"]]],[10,18],[1,\"p\",[[0,[],0,\"in nuxt3, Instead use this code in your component:\"]]],[10,19],[1,\"p\",[[0,[],0,\"Now you should see login button. You should be able to click on it, login and see credentials in console. Assuming that you correctly configured OAuth 2.0 Client \"]]],[10,20],[1,\"p\",[[0,[],0,\"And added localhost to Authorized JavaScript origins\"]]],[10,21],[1,\"p\",[[0,[],0,\"After login in console you will see array with single object like this\"]]],[10,22],[1,\"p\",[[0,[],0,\"Credentail token is \"],[0,[0],1,\"JWT\"],[0,[],0,\" with payload\"]]],[10,23],[1,\"p\",[[0,[],0,\"To verify it you should send it to backend.\"]]],[10,24],[1,\"h2\",[[0,[],0,\"Backend verification for Google credential\"]]],[1,\"p\",[[0,[],0,\"As backend we can use fastify. I described fastify config on this blog here\"]]],[10,25],[1,\"p\",[[0,[],0,\"so now I assume you have done step \\\"Add Fastify with first endpoint\\\" from this article.\"]]],[1,\"p\",[[0,[],0,\"In \"],[0,[0],1,\"fastify.ts\"],[0,[],0,\" we can add line with path\"]]],[10,26],[1,\"p\",[[0,[],0,\"and in \"],[0,[0],1,\"routes/Auth.ts\"],[0,[],0,\" define static function \"],[0,[0],1,\"googleVerify\"],[0,[],0,\".\"]]],[1,\"p\",[[0,[],0,\"So in \"],[0,[0],1,\"googleVerify\"],[0,[],0,\" we will to check if credentials are correctly created by google.\"]]],[1,\"h2\",[[0,[],0,\"Checking credentials authenticity \"]]],[1,\"p\",[[0,[],0,\"To verify we need install \"],[0,[0],1,\"google\"],[0,[],0,\" package on backend according to instruction\"]]],[10,27],[10,28],[1,\"p\",[[0,[],0,\"we need the same \"],[0,[0],1,\"GOOGLE_CLIENT_ID\"],[0,[],0,\" in backend \"],[0,[0],1,\".env\"]]],[10,29],[1,\"p\",[[0,[],0,\"in file with controller - \"],[0,[0],1,\"routes/Auth.ts\"],[0,[],0,\" we can write our function as\"]]],[10,30],[1,\"p\",[[0,[],0,\"and now update frontend part. First \"],[0,[0],1,\"global.d.ts\"]]],[10,31],[1,\"p\",[[0,[],0,\"next add \"],[0,[0],1,\"API_URL\"],[0,[],0,\" to \"],[0,[0],1,\".env\"],[0,[],0,\", then add \"],[0,[0],1,\"apiUrl\"],[0,[],0,\" to \"],[0,[0],1,\"runtimeConfig\"],[0,[],0,\" like \"],[0,[0],1,\"googleClientId\"],[0,[],0,\", finally we can write callback function in nuxt3 component in form:\"]]],[10,32],[1,\"h2\",[[0,[],0,\"Enable Cors in Fastify\"]]],[1,\"p\",[[0,[],0,\"we forgot about \"],[0,[0],1,\"cors\"]]],[10,33],[10,34],[1,\"p\",[[0,[],0,\"so quick fix\"]]],[10,35],[1,\"p\",[[0,[],0,\"and in \"],[0,[0],1,\"src/fastify.ts\"]]],[10,36],[1,\"p\",[[0,[],0,\"and we can see in console all user's details\"]]],[10,37],[1,\"p\",[[0,[],0,\"We do not want to call \"],[0,[0],1,\"await client.verifyIdToken(\"],[0,[],0,\" on any request so we have to exchange google JWT for our own, so it is worth to create user in your database and generate jwt token for him, but I described this in mentione before article: \"]]],[10,38],[1,\"p\",[]]],\"ghostVersion\":\"4.0\"}","html":"<p>I was scared today because two great libraries did not work with Google Sign In for Nuxt 3. I mean <code>auth.nuxtjs</code> and <code>nuxt-vue3-google-signin</code>.</p><p>From stack overflow</p><figure class=\"kg-card kg-bookmark-card\"><a class=\"kg-bookmark-container\" href=\"https://stackoverflow.com/questions/74559363/how-to-use-nuxtjs-auth-next-module-with-nuxt3\"><div class=\"kg-bookmark-content\"><div class=\"kg-bookmark-title\">How to use nuxtjs/auth-next module with Nuxt3?</div><div class=\"kg-bookmark-description\">Just trying to add authentication to my NuxtJs 3 app folloging nuxt/auth configuration docs, but still get an error during app start: // nuxt.config.js export default defineNuxtConfig({ auth...</div><div class=\"kg-bookmark-metadata\"><img class=\"kg-bookmark-icon\" src=\"https://cdn.sstatic.net/Sites/stackoverflow/Img/apple-touch-icon.png?v&#x3D;c78bd457575a\"><span class=\"kg-bookmark-author\">Stack Overflow</span><span class=\"kg-bookmark-publisher\">fudo</span></div></div><div class=\"kg-bookmark-thumbnail\"><img src=\"https://cdn.sstatic.net/Sites/stackoverflow/Img/apple-touch-icon@2.png?v&#x3D;73d79a89bded\"></div></a></figure><p>I learned that first one is incompatible with nuxt 3, but it is planned on roadmap</p><figure class=\"kg-card kg-bookmark-card\"><a class=\"kg-bookmark-container\" href=\"https://nuxt.com/docs/community/roadmap#%EF%B8%8F-roadmap\"><div class=\"kg-bookmark-content\"><div class=\"kg-bookmark-title\">Roadmap · Nuxt</div><div class=\"kg-bookmark-description\">Nuxt is constantly evolving, with new features and modules being added all the time.</div><div class=\"kg-bookmark-metadata\"><img class=\"kg-bookmark-icon\" src=\"https://nuxt.com/icon.png\"></div></div><div class=\"kg-bookmark-thumbnail\"><img src=\"https://flat.badgen.net/npm/v/nuxt\"></div></a></figure><p>Second simply could not work giving error that was suggesting that something is wrong with my client id.</p><p>I checked official Google Docs and see this:</p><figure class=\"kg-card kg-image-card\"><img src=\"__GHOST_URL__/content/images/2023/02/Zrzut-ekranu-z-2023-02-16-18-26-11.png\" class=\"kg-image\" alt loading=\"lazy\" width=\"941\" height=\"225\" srcset=\"__GHOST_URL__/content/images/size/w600/2023/02/Zrzut-ekranu-z-2023-02-16-18-26-11.png 600w, __GHOST_URL__/content/images/2023/02/Zrzut-ekranu-z-2023-02-16-18-26-11.png 941w\" sizes=\"(min-width: 720px) 720px\"></figure><figure class=\"kg-card kg-bookmark-card\"><a class=\"kg-bookmark-container\" href=\"https://developers.google.com/identity/sign-in/web/sign-in\"><div class=\"kg-bookmark-content\"><div class=\"kg-bookmark-title\">Integrating Google Sign-In into your web app | Authentication | Google Developers</div><div class=\"kg-bookmark-description\"></div><div class=\"kg-bookmark-metadata\"><img class=\"kg-bookmark-icon\" src=\"https://www.gstatic.com/devrel-devsite/prod/vd277a93d7226f1fcf53372e6780919bb823bca6ca1c3adbaa8a14ef6554ad67d/developers/images/touchicon-180.png\"><span class=\"kg-bookmark-author\">Google Developers</span></div></div><div class=\"kg-bookmark-thumbnail\"><img src=\"https://www.gstatic.com/devrel-devsite/prod/vd277a93d7226f1fcf53372e6780919bb823bca6ca1c3adbaa8a14ef6554ad67d/developers/images/opengraph/teal.png\"></div></a></figure><p>Looks terrible, but hepilly I integrated google sign in button quite fast without external libs. In this article I will show how to implement new Google Identity with Nuxt 3.</p><figure class=\"kg-card kg-image-card\"><img src=\"__GHOST_URL__/content/images/2023/02/3sa379.jpg\" class=\"kg-image\" alt loading=\"lazy\" width=\"500\" height=\"500\"></figure><h2 id=\"google-identityhow-it-is-different\">Google Identity - how it is different</h2><p>Because image is worth more than thousand of words, new login button contains avatar:</p><figure class=\"kg-card kg-bookmark-card\"><a class=\"kg-bookmark-container\" href=\"https://developers.google.com/identity/gsi/web/guides/personalized-button\"><div class=\"kg-bookmark-content\"><div class=\"kg-bookmark-title\">Sign in with Google button UX | Authentication | Google Developers</div><div class=\"kg-bookmark-description\"></div><div class=\"kg-bookmark-metadata\"><img class=\"kg-bookmark-icon\" src=\"https://www.gstatic.com/devrel-devsite/prod/vd277a93d7226f1fcf53372e6780919bb823bca6ca1c3adbaa8a14ef6554ad67d/developers/images/touchicon-180.png\"><span class=\"kg-bookmark-author\">Google Developers</span></div></div><div class=\"kg-bookmark-thumbnail\"><img src=\"https://www.gstatic.com/devrel-devsite/prod/vd277a93d7226f1fcf53372e6780919bb823bca6ca1c3adbaa8a14ef6554ad67d/developers/images/opengraph/teal.png\"></div></a></figure><figure class=\"kg-card kg-image-card\"><img src=\"__GHOST_URL__/content/images/2023/02/personalized-button-multiple.png\" class=\"kg-image\" alt loading=\"lazy\" width=\"207\" height=\"45\"></figure><h2 id=\"sign-in-button-html\">Sign In button HTML</h2><p>To add it to your component you will need paste below html</p><pre><code>  &lt;div id=\"g_id_onload\"\n       :data-client_id=\"config.public.googleClientId\"\n       data-context=\"signin\"\n       data-ux_mode=\"popup\"\n       data-callback=\"googleLoginCallback\"\n       data-auto_select=\"true\"\n       data-itp_support=\"true\"&gt;\n  &lt;/div&gt;\n\n  &lt;div class=\"g_id_signin\"\n       data-type=\"standard\"\n       data-shape=\"pill\"\n       data-theme=\"outline\"\n       data-text=\"continue_with\"\n       data-size=\"large\"\n       data-logo_alignment=\"left\"&gt;\n  &lt;/div&gt;</code></pre><p>or prepare your own in configurator</p><figure class=\"kg-card kg-bookmark-card\"><a class=\"kg-bookmark-container\" href=\"https://developers.google.com/identity/gsi/web/tools/configurator\"><div class=\"kg-bookmark-content\"><div class=\"kg-bookmark-title\">Generate HTML code | Authentication | Google Developers</div><div class=\"kg-bookmark-description\"></div><div class=\"kg-bookmark-metadata\"><img class=\"kg-bookmark-icon\" src=\"https://www.gstatic.com/devrel-devsite/prod/vd277a93d7226f1fcf53372e6780919bb823bca6ca1c3adbaa8a14ef6554ad67d/developers/images/touchicon-180.png\"><span class=\"kg-bookmark-author\">Google Developers</span></div></div><div class=\"kg-bookmark-thumbnail\"><img src=\"https://www.gstatic.com/devrel-devsite/prod/vd277a93d7226f1fcf53372e6780919bb823bca6ca1c3adbaa8a14ef6554ad67d/developers/images/opengraph/teal.png\"></div></a></figure><figure class=\"kg-card kg-image-card\"><img src=\"__GHOST_URL__/content/images/2023/02/3.5-3.jpg\" class=\"kg-image\" alt loading=\"lazy\" width=\"564\" height=\"681\"></figure><p>There are three elements that we have to connect:</p><ol><li><code>config.public.googleClientId</code> - google client ID</li><li><code>googleLoginCallback</code> - globally defined function that will get results of login</li><li>google library that will make these buttons working</li></ol><h2 id=\"passing-env-to-nuxt-3\">Passing .env to Nuxt 3</h2><p>To pass .env to nuxt 3 you can follow this answer</p><figure class=\"kg-card kg-bookmark-card\"><a class=\"kg-bookmark-container\" href=\"https://stackoverflow.com/questions/53993890/how-to-pass-env-variables-to-nuxt-in-production/74463160#74463160\"><div class=\"kg-bookmark-content\"><div class=\"kg-bookmark-title\">How to pass env variables to nuxt in production?</div><div class=\"kg-bookmark-description\">nuxt.config.js modules: [ ‘@nuxtjs/dotenv’ ], server/index.js const express &#x3D; require(‘express’)const consola &#x3D; require(‘consola’)const { Nuxt, Builder } &#x3D; require(‘nuxt’)const app &#x3D; ex...</div><div class=\"kg-bookmark-metadata\"><img class=\"kg-bookmark-icon\" src=\"https://cdn.sstatic.net/Sites/stackoverflow/Img/apple-touch-icon.png?v&#x3D;c78bd457575a\"><span class=\"kg-bookmark-author\">Stack Overflow</span><span class=\"kg-bookmark-publisher\">Rounak Jain</span></div></div><div class=\"kg-bookmark-thumbnail\"><img src=\"https://cdn.sstatic.net/Sites/stackoverflow/Img/apple-touch-icon@2.png?v&#x3D;73d79a89bded\"></div></a></figure><p>You create <code>.env</code> file with</p><pre><code>GOOGLE_CLIENT_ID=xxx.apps.googleusercontent.com\n</code></pre><p>to connect these values you can use <code>dotenv</code> library, but I prefere <code>Makefile</code> like this one</p><pre><code>include .env\nexport\n\nnode_modules: package.json\n\tnpm i\n\nup: node_modules\n\tnpm run dev\n</code></pre><p>In nuxt config you should add</p><pre><code>export default defineNuxtConfig({\n    runtimeConfig: {\n        public: {\n            googleClientId: process.env.GOOGLE_CLIENT_ID ?? '',\n        }\n    },\n})\n</code></pre><p>and finally in component you can get access to <code>config</code> by</p><pre><code>const config = useRuntimeConfig()\n</code></pre><h2 id=\"extending-window-by-callback-function\">Extending window by callback function</h2><p>Window by default do not have  <code>googleLoginCallback</code> so to add it you should create file <code>types/global.d.ts</code> with</p><pre><code>declare global {\n    interface Window {\n        googleLoginCallback: () =&gt; void;\n    }\n}\n</code></pre><p>and in component add</p><pre><code>if(process.client) {\n  window.googleLoginCallback = (...args) =&gt; {\n    console.log(args);\n  }\n}</code></pre><h2 id=\"load-the-client-library-in-nuxt-3\">Load the client library in Nuxt 3</h2><p>Google mentions about this step on page</p><figure class=\"kg-card kg-bookmark-card\"><a class=\"kg-bookmark-container\" href=\"https://developers.google.com/identity/gsi/web/guides/client-library\"><div class=\"kg-bookmark-content\"><div class=\"kg-bookmark-title\">Load the client library | Authentication | Google Developers</div><div class=\"kg-bookmark-description\"></div><div class=\"kg-bookmark-metadata\"><img class=\"kg-bookmark-icon\" src=\"https://www.gstatic.com/devrel-devsite/prod/vd277a93d7226f1fcf53372e6780919bb823bca6ca1c3adbaa8a14ef6554ad67d/developers/images/touchicon-180.png\"><span class=\"kg-bookmark-author\">Google Developers</span></div></div><div class=\"kg-bookmark-thumbnail\"><img src=\"https://www.gstatic.com/devrel-devsite/prod/vd277a93d7226f1fcf53372e6780919bb823bca6ca1c3adbaa8a14ef6554ad67d/developers/images/opengraph/teal.png\"></div></a></figure><p>But you should not add</p><pre><code>&lt;script src=\"https://accounts.google.com/gsi/client\" async defer&gt;&lt;/script&gt;\n</code></pre><p>in nuxt3, Instead use this code in your component:</p><pre><code>useHead({\n  script: [{\n    async: true,\n    src: 'https://accounts.google.com/gsi/client',\n    defer: true\n  }]\n})</code></pre><p>Now you should see login button. You should be able to click on it, login and see credentials in console. Assuming that you correctly configured OAuth 2.0 Client </p><figure class=\"kg-card kg-image-card\"><img src=\"__GHOST_URL__/content/images/2023/02/Zrzut-ekranu-z-2023-02-16-18-47-12.png\" class=\"kg-image\" alt loading=\"lazy\" width=\"456\" height=\"402\"></figure><p>And added localhost to Authorized JavaScript origins</p><figure class=\"kg-card kg-image-card\"><img src=\"__GHOST_URL__/content/images/2023/02/Zrzut-ekranu-z-2023-02-16-18-47-27.png\" class=\"kg-image\" alt loading=\"lazy\" width=\"727\" height=\"654\" srcset=\"__GHOST_URL__/content/images/size/w600/2023/02/Zrzut-ekranu-z-2023-02-16-18-47-27.png 600w, __GHOST_URL__/content/images/2023/02/Zrzut-ekranu-z-2023-02-16-18-47-27.png 727w\" sizes=\"(min-width: 720px) 720px\"></figure><p>After login in console you will see array with single object like this</p><pre><code>{\n  clientId:\"xxx.apps.googleusercontent.com\"\n  client_id:\"xxx.apps.googleusercontent.com\"\n  credential: \"token\"\n  select_by:\"auto\"\n}</code></pre><p>Credentail token is <code>JWT</code> with payload</p><pre><code>{\n  \"iss\": \"https://accounts.google.com\",\n  \"nbf\": 1676544985,\n  \"aud\": \"xxx.apps.googleusercontent.com\",\n  \"sub\": \"108561822785941523583\",\n  \"email\": \"gustaw.daniel@gmail.com\",\n  \"email_verified\": true,\n  \"azp\": \"xxx.apps.googleusercontent.com\",\n  \"name\": \"Daniel Gustaw\",\n  \"picture\": \"https://lh3.googleusercontent.com/a/AEdFTp64X-0imH5xey6U4JDKzFRrMXdtg4lGy8GlEjLxyQ=s96-c\",\n  \"given_name\": \"Daniel\",\n  \"family_name\": \"Gustaw\",\n  \"iat\": 1676545285,\n  \"exp\": 1676548885,\n  \"jti\": \"a7e1afd716925de385bf0069c7c370f8e64580d3\"\n}</code></pre><p>To verify it you should send it to backend.</p><figure class=\"kg-card kg-image-card\"><img src=\"__GHOST_URL__/content/images/2023/02/b33f57187cba4a7e2ebebc6b9987f09b.jpg\" class=\"kg-image\" alt loading=\"lazy\" width=\"840\" height=\"1074\" srcset=\"__GHOST_URL__/content/images/size/w600/2023/02/b33f57187cba4a7e2ebebc6b9987f09b.jpg 600w, __GHOST_URL__/content/images/2023/02/b33f57187cba4a7e2ebebc6b9987f09b.jpg 840w\" sizes=\"(min-width: 720px) 720px\"></figure><h2 id=\"backend-verification-for-google-credential\">Backend verification for Google credential</h2><p>As backend we can use fastify. I described fastify config on this blog here</p><figure class=\"kg-card kg-bookmark-card\"><a class=\"kg-bookmark-container\" href=\"__GHOST_URL__/login-by-metamask-rest-backend-in-fastify/\"><div class=\"kg-bookmark-content\"><div class=\"kg-bookmark-title\">Login by Metamask - Rest Backend in Fastify (Node, Typescript, Prisma) Part 1/2</div><div class=\"kg-bookmark-description\">We building from scratch rest api in fastify using mongodb connected by prisma as database, jest as test framework and etherjs to verify signatures signed by metamask.</div><div class=\"kg-bookmark-metadata\"><img class=\"kg-bookmark-icon\" src=\"__GHOST_URL__/favicon.png\"><span class=\"kg-bookmark-author\">Precise Lab</span><span class=\"kg-bookmark-publisher\">Daniel Gustaw</span></div></div><div class=\"kg-bookmark-thumbnail\"><img src=\"__GHOST_URL__/content/images/2022/11/metamask-fastify-min.jpg\"></div></a></figure><p>so now I assume you have done step \"Add Fastify with first endpoint\" from this article.</p><p>In <code>fastify.ts</code> we can add line with path</p><pre><code>app.post('/google-verify', Auth.googleVerify)</code></pre><p>and in <code>routes/Auth.ts</code> define static function <code>googleVerify</code>.</p><p>So in <code>googleVerify</code> we will to check if credentials are correctly created by google.</p><h2 id=\"checking-credentials-authenticity\">Checking credentials authenticity </h2><p>To verify we need install <code>google</code> package on backend according to instruction</p><figure class=\"kg-card kg-bookmark-card\"><a class=\"kg-bookmark-container\" href=\"https://developers.google.com/identity/gsi/web/guides/verify-google-id-token\"><div class=\"kg-bookmark-content\"><div class=\"kg-bookmark-title\">Verify the Google ID token on your server side | Authentication | Google Developers</div><div class=\"kg-bookmark-description\"></div><div class=\"kg-bookmark-metadata\"><img class=\"kg-bookmark-icon\" src=\"https://www.gstatic.com/devrel-devsite/prod/vd277a93d7226f1fcf53372e6780919bb823bca6ca1c3adbaa8a14ef6554ad67d/developers/images/touchicon-180.png\"><span class=\"kg-bookmark-author\">Google Developers</span></div></div><div class=\"kg-bookmark-thumbnail\"><img src=\"https://www.gstatic.com/devrel-devsite/prod/vd277a93d7226f1fcf53372e6780919bb823bca6ca1c3adbaa8a14ef6554ad67d/developers/images/opengraph/teal.png\"></div></a></figure><pre><code>npm install google-auth-library --save\n</code></pre><p>we need the same <code>GOOGLE_CLIENT_ID</code> in backend <code>.env</code></p><pre><code>GOOGLE_CLIENT_ID=xxx.apps.googleusercontent.com\n</code></pre><p>in file with controller - <code>routes/Auth.ts</code> we can write our function as</p><pre><code>import {FastifyRequest} from \"fastify\";\nimport {OAuth2Client} from 'google-auth-library';\n\nexport class Auth {\n  static async googleVerify(req: FastifyRequest&lt;{ Body: { credential: string } }&gt;) {\n    const client = new OAuth2Client(process.env.GOOGLE_CLIENT_ID);\n    const ticket = await client.verifyIdToken({\n      idToken: req.body.credential,\n      audience: process.env.GOOGLE_CLIENT_ID,\n    });\n    const payload = ticket.getPayload();\n    if(!payload) throw new Error(`No payload`);\n        \n    console.log(payload);\n    return payload;\n  }\n}\n</code></pre><p>and now update frontend part. First <code>global.d.ts</code></p><pre><code>interface GoogleAuthenticatedResponse {\n    clientId: string\n    client_id: string\n    credential: string\n    select_by: \"auto\"\n}\n\ndeclare global {\n    interface Window {\n        googleLoginCallback: (userData: GoogleAuthenticatedResponse) =&gt; void;\n    }\n}\n</code></pre><p>next add <code>API_URL</code> to <code>.env</code>, then add <code>apiUrl</code> to <code>runtimeConfig</code> like <code>googleClientId</code>, finally we can write callback function in nuxt3 component in form:</p><pre><code>if(process.client) {\n  window.googleLoginCallback = (userData) =&gt; {\n    console.log(\"ud\", userData);\n    axios.post(config.public.apiUrl + '/google-verify', {\n      credential: userData.credential\n    }).then((res) =&gt; {\n      console.log(\"pl\", res.data)\n    }).catch(console.error)\n  }\n}</code></pre><h2 id=\"enable-cors-in-fastify\">Enable Cors in Fastify</h2><p>we forgot about <code>cors</code></p><figure class=\"kg-card kg-image-card\"><img src=\"__GHOST_URL__/content/images/2023/02/Zrzut-ekranu-z-2023-02-16-19-18-48.png\" class=\"kg-image\" alt loading=\"lazy\" width=\"859\" height=\"137\" srcset=\"__GHOST_URL__/content/images/size/w600/2023/02/Zrzut-ekranu-z-2023-02-16-19-18-48.png 600w, __GHOST_URL__/content/images/2023/02/Zrzut-ekranu-z-2023-02-16-19-18-48.png 859w\" sizes=\"(min-width: 720px) 720px\"></figure><figure class=\"kg-card kg-image-card\"><img src=\"__GHOST_URL__/content/images/2023/02/06ivdlvuveq21.jpg\" class=\"kg-image\" alt loading=\"lazy\" width=\"640\" height=\"942\" srcset=\"__GHOST_URL__/content/images/size/w600/2023/02/06ivdlvuveq21.jpg 600w, __GHOST_URL__/content/images/2023/02/06ivdlvuveq21.jpg 640w\"></figure><p>so quick fix</p><pre><code>npm i @fastify/cors\n</code></pre><p>and in <code>src/fastify.ts</code></p><pre><code>import cors from '@fastify/cors'\n\n//...\n\n    app.register(cors)</code></pre><p>and we can see in console all user's details</p><figure class=\"kg-card kg-image-card\"><img src=\"__GHOST_URL__/content/images/2023/02/Zrzut-ekranu-z-2023-02-16-16-35-17.png\" class=\"kg-image\" alt loading=\"lazy\" width=\"1451\" height=\"456\" srcset=\"__GHOST_URL__/content/images/size/w600/2023/02/Zrzut-ekranu-z-2023-02-16-16-35-17.png 600w, __GHOST_URL__/content/images/size/w1000/2023/02/Zrzut-ekranu-z-2023-02-16-16-35-17.png 1000w, __GHOST_URL__/content/images/2023/02/Zrzut-ekranu-z-2023-02-16-16-35-17.png 1451w\" sizes=\"(min-width: 720px) 720px\"></figure><p>We do not want to call <code>await client.verifyIdToken(</code> on any request so we have to exchange google JWT for our own, so it is worth to create user in your database and generate jwt token for him, but I described this in mentione before article: </p><figure class=\"kg-card kg-bookmark-card\"><a class=\"kg-bookmark-container\" href=\"__GHOST_URL__/login-by-metamask-rest-backend-in-fastify/\"><div class=\"kg-bookmark-content\"><div class=\"kg-bookmark-title\">Login by Metamask - Rest Backend in Fastify (Node, Typescript, Prisma) Part 1/2</div><div class=\"kg-bookmark-description\">We building from scratch rest api in fastify using mongodb connected by prisma as database, jest as test framework and etherjs to verify signatures signed by metamask.</div><div class=\"kg-bookmark-metadata\"><img class=\"kg-bookmark-icon\" src=\"__GHOST_URL__/favicon.png\"><span class=\"kg-bookmark-author\">Precise Lab</span><span class=\"kg-bookmark-publisher\">Daniel Gustaw</span></div></div><div class=\"kg-bookmark-thumbnail\"><img src=\"__GHOST_URL__/content/images/2022/11/metamask-fastify-min.jpg\"></div></a></figure>","comment_id":"63ee10a8bbda300a2f29d2df","plaintext":"I was scared today because two great libraries did not work with Google Sign In\nfor Nuxt 3. I mean auth.nuxtjs and nuxt-vue3-google-signin.\n\nFrom stack overflow\n\nHow to use nuxtjs/auth-next module with Nuxt3?Just trying to add authentication\nto my NuxtJs 3 app folloging nuxt/auth configuration docs, but still get an\nerror during app start: // nuxt.config.js export default defineNuxtConfig({\nauth...Stack Overflowfudo\n[https://stackoverflow.com/questions/74559363/how-to-use-nuxtjs-auth-next-module-with-nuxt3]\nI learned that first one is incompatible with nuxt 3, but it is planned on\nroadmap\n\nRoadmap · NuxtNuxt is constantly evolving, with new features and modules being\nadded all the time. [https://nuxt.com/docs/community/roadmap#%EF%B8%8F-roadmap]\nSecond simply could not work giving error that was suggesting that something is\nwrong with my client id.\n\nI checked official Google Docs and see this:\n\nIntegrating Google Sign-In into your web app | Authentication | Google\nDevelopersGoogle Developers\n[https://developers.google.com/identity/sign-in/web/sign-in]Looks terrible, but\nhepilly I integrated google sign in button quite fast without external libs. In\nthis article I will show how to implement new Google Identity with Nuxt 3.\n\nGoogle Identity - how it is different\nBecause image is worth more than thousand of words, new login button contains\navatar:\n\nSign in with Google button UX | Authentication | Google DevelopersGoogle\nDevelopers\n[https://developers.google.com/identity/gsi/web/guides/personalized-button]Sign\nIn button HTML\nTo add it to your component you will need paste below html\n\n  <div id=\"g_id_onload\"\n       :data-client_id=\"config.public.googleClientId\"\n       data-context=\"signin\"\n       data-ux_mode=\"popup\"\n       data-callback=\"googleLoginCallback\"\n       data-auto_select=\"true\"\n       data-itp_support=\"true\">\n  </div>\n\n  <div class=\"g_id_signin\"\n       data-type=\"standard\"\n       data-shape=\"pill\"\n       data-theme=\"outline\"\n       data-text=\"continue_with\"\n       data-size=\"large\"\n       data-logo_alignment=\"left\">\n  </div>\n\nor prepare your own in configurator\n\nGenerate HTML code | Authentication | Google DevelopersGoogle Developers\n[https://developers.google.com/identity/gsi/web/tools/configurator]There are\nthree elements that we have to connect:\n\n 1. config.public.googleClientId - google client ID\n 2. googleLoginCallback - globally defined function that will get results of\n    login\n 3. google library that will make these buttons working\n\nPassing .env to Nuxt 3\nTo pass .env to nuxt 3 you can follow this answer\n\nHow to pass env variables to nuxt in production?nuxt.config.js modules: [\n‘@nuxtjs/dotenv’ ], server/index.js const express = require(‘express’)const\nconsola = require(‘consola’)const { Nuxt, Builder } = require(‘nuxt’)const app\n=\nex...Stack OverflowRounak Jain\n[https://stackoverflow.com/questions/53993890/how-to-pass-env-variables-to-nuxt-in-production/74463160#74463160]\nYou create .env file with\n\nGOOGLE_CLIENT_ID=xxx.apps.googleusercontent.com\n\n\nto connect these values you can use dotenv library, but I prefere Makefile like\nthis one\n\ninclude .env\nexport\n\nnode_modules: package.json\n\tnpm i\n\nup: node_modules\n\tnpm run dev\n\n\nIn nuxt config you should add\n\nexport default defineNuxtConfig({\n    runtimeConfig: {\n        public: {\n            googleClientId: process.env.GOOGLE_CLIENT_ID ?? '',\n        }\n    },\n})\n\n\nand finally in component you can get access to config by\n\nconst config = useRuntimeConfig()\n\n\nExtending window by callback function\nWindow by default do not havegoogleLoginCallback so to add it you should create\nfile types/global.d.ts with\n\ndeclare global {\n    interface Window {\n        googleLoginCallback: () => void;\n    }\n}\n\n\nand in component add\n\nif(process.client) {\n  window.googleLoginCallback = (...args) => {\n    console.log(args);\n  }\n}\n\nLoad the client library in Nuxt 3\nGoogle mentions about this step on page\n\nLoad the client library | Authentication | Google DevelopersGoogle Developers\n[https://developers.google.com/identity/gsi/web/guides/client-library]But you\nshould not add\n\n<script src=\"https://accounts.google.com/gsi/client\" async defer></script>\n\n\nin nuxt3, Instead use this code in your component:\n\nuseHead({\n  script: [{\n    async: true,\n    src: 'https://accounts.google.com/gsi/client',\n    defer: true\n  }]\n})\n\nNow you should see login button. You should be able to click on it, login and\nsee credentials in console. Assuming that you correctly configured OAuth 2.0\nClient \n\nAnd added localhost to Authorized JavaScript origins\n\nAfter login in console you will see array with single object like this\n\n{\n  clientId:\"xxx.apps.googleusercontent.com\"\n  client_id:\"xxx.apps.googleusercontent.com\"\n  credential: \"token\"\n  select_by:\"auto\"\n}\n\nCredentail token is JWT with payload\n\n{\n  \"iss\": \"https://accounts.google.com\",\n  \"nbf\": 1676544985,\n  \"aud\": \"xxx.apps.googleusercontent.com\",\n  \"sub\": \"108561822785941523583\",\n  \"email\": \"gustaw.daniel@gmail.com\",\n  \"email_verified\": true,\n  \"azp\": \"xxx.apps.googleusercontent.com\",\n  \"name\": \"Daniel Gustaw\",\n  \"picture\": \"https://lh3.googleusercontent.com/a/AEdFTp64X-0imH5xey6U4JDKzFRrMXdtg4lGy8GlEjLxyQ=s96-c\",\n  \"given_name\": \"Daniel\",\n  \"family_name\": \"Gustaw\",\n  \"iat\": 1676545285,\n  \"exp\": 1676548885,\n  \"jti\": \"a7e1afd716925de385bf0069c7c370f8e64580d3\"\n}\n\nTo verify it you should send it to backend.\n\nBackend verification for Google credential\nAs backend we can use fastify. I described fastify config on this blog here\n\nLogin by Metamask - Rest Backend in Fastify (Node, Typescript, Prisma) Part 1/2\nWe building from scratch rest api in fastify using mongodb connected by prisma\nas database, jest as test framework and etherjs to verify signatures signed by\nmetamask.Precise LabDaniel Gustaw\n[https://preciselab.io/login-by-metamask-rest-backend-in-fastify/]so now I\nassume you have done step \"Add Fastify with first endpoint\" from this article.\n\nIn fastify.ts we can add line with path\n\napp.post('/google-verify', Auth.googleVerify)\n\nand in routes/Auth.ts define static function googleVerify.\n\nSo in googleVerify we will to check if credentials are correctly created by\ngoogle.\n\nChecking credentials authenticity \nTo verify we need install google package on backend according to instruction\n\nVerify the Google ID token on your server side | Authentication | Google\nDevelopersGoogle Developers\n[https://developers.google.com/identity/gsi/web/guides/verify-google-id-token]npm install google-auth-library --save\n\n\nwe need the same GOOGLE_CLIENT_ID in backend .env\n\nGOOGLE_CLIENT_ID=xxx.apps.googleusercontent.com\n\n\nin file with controller - routes/Auth.ts we can write our function as\n\nimport {FastifyRequest} from \"fastify\";\nimport {OAuth2Client} from 'google-auth-library';\n\nexport class Auth {\n  static async googleVerify(req: FastifyRequest<{ Body: { credential: string } }>) {\n    const client = new OAuth2Client(process.env.GOOGLE_CLIENT_ID);\n    const ticket = await client.verifyIdToken({\n      idToken: req.body.credential,\n      audience: process.env.GOOGLE_CLIENT_ID,\n    });\n    const payload = ticket.getPayload();\n    if(!payload) throw new Error(`No payload`);\n        \n    console.log(payload);\n    return payload;\n  }\n}\n\n\nand now update frontend part. First global.d.ts\n\ninterface GoogleAuthenticatedResponse {\n    clientId: string\n    client_id: string\n    credential: string\n    select_by: \"auto\"\n}\n\ndeclare global {\n    interface Window {\n        googleLoginCallback: (userData: GoogleAuthenticatedResponse) => void;\n    }\n}\n\n\nnext add API_URL to .env, then add apiUrl to runtimeConfig like googleClientId,\nfinally we can write callback function in nuxt3 component in form:\n\nif(process.client) {\n  window.googleLoginCallback = (userData) => {\n    console.log(\"ud\", userData);\n    axios.post(config.public.apiUrl + '/google-verify', {\n      credential: userData.credential\n    }).then((res) => {\n      console.log(\"pl\", res.data)\n    }).catch(console.error)\n  }\n}\n\nEnable Cors in Fastify\nwe forgot about cors\n\nso quick fix\n\nnpm i @fastify/cors\n\n\nand in src/fastify.ts\n\nimport cors from '@fastify/cors'\n\n//...\n\n    app.register(cors)\n\nand we can see in console all user's details\n\nWe do not want to call await client.verifyIdToken( on any request so we have to\nexchange google JWT for our own, so it is worth to create user in your database\nand generate jwt token for him, but I described this in mentione before article: \n\nLogin by Metamask - Rest Backend in Fastify (Node, Typescript, Prisma) Part 1/2\nWe building from scratch rest api in fastify using mongodb connected by prisma\nas database, jest as test framework and etherjs to verify signatures signed by\nmetamask.Precise LabDaniel Gustaw\n[https://preciselab.io/login-by-metamask-rest-backend-in-fastify/]","feature_image":"__GHOST_URL__/content/images/2023/02/bg-nuxt-google.jpg","featured":0,"type":"post","status":"published","locale":null,"visibility":"public","email_recipient_filter":"all","created_at":"2023-02-16T11:16:56.000Z","updated_at":"2023-02-16T13:20:19.000Z","published_at":"2023-02-16T13:20:19.000Z","custom_excerpt":"New Google Identity installation for Nuxt 3 with credentials verification in fastify.","codeinjection_head":null,"codeinjection_foot":null,"custom_template":null,"canonical_url":null,"newsletter_id":null,"lexical":null},{"id":"63f1e7b7bbda300a2f29d411","uuid":"e4915f2b-955e-4ee8-9c08-f41e34edcdfa","title":"ZeroMQ pull-push pattern for Node JS","slug":"zeromq-pull-push-pattern-for-node-js","mobiledoc":"{\"version\":\"0.3.1\",\"atoms\":[],\"cards\":[[\"bookmark\",{\"type\":\"bookmark\",\"url\":\"https://zeromq.org/\",\"metadata\":{\"url\":\"https://zeromq.org\",\"title\":\"ZeroMQ\",\"description\":\"An open-source universal messaging library\",\"author\":null,\"publisher\":null,\"thumbnail\":\"https://zeromq.org/images/logo.gif\",\"icon\":\"https://zeromq.org/apple-touch-icon.png\"}}],[\"code\",{\"code\":\"import {Push, Pull, MessageLike} from \\\"zeromq\\\";\\n\\n// Import the required ZeroMQ sockets and types\\n\\nconst sleep = (time: number): Promise<void> => new Promise((resolve) => setTimeout(resolve, time))\\n\\n// Define a sleep function that returns a Promise that resolves after a given time interval\\n\\nconst pushSocket = new Push();\\nconst pullSocket = new Pull();\\n\\n// Create a new ZeroMQ Push socket and a new Pull socket\\n\\nexport async function push<T extends MessageLike | MessageLike[]>(job: T): Promise<void> {\\n\\n    // Define a push function that takes a generic message and sends it to the Pull socket\\n    // The function returns a Promise that resolves when the message is sent\\n\\n    if(!pushSocket.writable){\\n        await pushSocket.bind(\\\"tcp://*:7777\\\");\\n    }\\n\\n    // If the socket is not yet writable, bind it to the address \\\"tcp://*:7777\\\"\\n\\n    await pushSocket.send(job);\\n\\n    // Send the message to the connected Pull socket\\n}\\n\\nexport async function pull<T>(): Promise<void> {\\n\\n    // Define a pull function that receives messages from the Push socket\\n    // The function returns a Promise that resolves when a message is received\\n\\n    pullSocket.connect(\\\"tcp://localhost:7777\\\");\\n\\n    // Connect the Pull socket to the address \\\"tcp://localhost:7777\\\"\\n\\n    for await (const [msg] of pullSocket) {\\n        await sleep(2000);\\n        console.log(`Received Job ${msg.toString()}`);\\n    }\\n\\n    // Use a for-await-of loop to iterate over incoming messages from the Pull socket\\n    // The sleep function is called to simulate a delay in processing the message\\n    // The message is then logged to the console\\n}\",\"language\":\"typescript\"}],[\"code\",{\"code\":\"import {pull, push} from \\\"./zero\\\";\\n\\npull().catch(console.error)\\n\\nasync function main() {\\n    for(let i = 1; i <= 10; i++) {\\n        console.log(\\\"push\\\", i);\\n        await push(`ok ${i}`)\\n    }\\n}\\n\\nmain().catch(console.error)\\n\",\"language\":\"typescript\"}],[\"image\",{\"src\":\"__GHOST_URL__/content/images/2023/02/Zrzut-ekranu-z-2023-02-19-16-22-15.png\",\"width\":320,\"height\":263}]],\"markups\":[[\"code\"],[\"a\",[\"href\",\"https://zeromq.org/socket-api/#request-reply-pattern\"]],[\"strong\"],[\"a\",[\"href\",\"https://zeromq.org/socket-api/#publish-subscribe-pattern\"]],[\"a\",[\"href\",\"https://zeromq.org/socket-api/#pipeline-pattern\"]],[\"a\",[\"href\",\"https://zeromq.org/socket-api/#exclusive-pair-pattern\"]]],\"sections\":[[1,\"p\",[[0,[],0,\"ZeroMQ is a messaging library that enables fast and efficient communication between distributed systems. With ZeroMQ, developers can easily build complex messaging systems that can handle high volumes of data and are resilient to network failures. In Node.js, the ZeroMQ library can be used to create messaging endpoints and send and receive messages between them.\"]]],[1,\"p\",[[0,[],0,\"In this article, we will explore how to use the ZeroMQ library in Node.js by examining a code snippet that demonstrates how to send and receive messages using the ZeroMQ \"],[0,[0],1,\"Push\"],[0,[],0,\" and \"],[0,[0],1,\"Pull\"],[0,[],0,\" sockets. The code shows how to create a \"],[0,[0],1,\"push\"],[0,[],0,\" function that sends a message to a \"],[0,[0],1,\"Pull\"],[0,[],0,\" socket, and a \"],[0,[0],1,\"pull\"],[0,[],0,\" function that receives messages from a \"],[0,[0],1,\"Push\"],[0,[],0,\" socket. We will examine the various components of the code and explain how they work together to create a reliable messaging system. We will also explore some best practices for using ZeroMQ in Node.js and discuss some common use cases for the library.\"]]],[10,0],[1,\"p\",[[0,[],0,\"The built-in core ZeroMQ patterns are:\"]]],[3,\"ul\",[[[0,[1,2,2],3,\"Request-reply\"],[0,[],0,\", which connects a set of clients to a set of services. This is a remote procedure call and task distribution pattern.\"]],[[0,[3,2,2],3,\"Pub-sub\"],[0,[],0,\", which connects a set of publishers to a set of subscribers. This is a data distribution pattern.\"]],[[0,[4,2,2],3,\"Pipeline\"],[0,[],0,\", which connects nodes in a fan-out/fan-in pattern that can have multiple steps and loops. This is a parallel task distribution and collection pattern.\"]],[[0,[5,2,2],3,\"Exclusive pair\"],[0,[],0,\", which connects two sockets exclusively. This is a pattern for connecting two threads in a process, not to be confused with “normal” pairs of sockets.\"]]]],[1,\"p\",[[0,[],0,\"We are interested strictly in \"],[0,[0],1,\"pipeline\"],[0,[],0,\". Our goal is write code from wich I can import and export \"],[0,[0],1,\"pull\"],[0,[],0,\" and \"],[0,[0],1,\"push\"],[0,[],0,\" functions to easy use them later without worrying if socket is open or maintaining socket in context or global state.\"]]],[10,1],[1,\"p\",[[0,[],0,\"Assuming that i called this file \"],[0,[0],1,\"zero.ts\"],[0,[],0,\" I can use it in script below\"]]],[10,2],[1,\"p\",[[0,[],0,\"I will see almost instant \"],[0,[0],1,\"push 1..10\"],[0,[],0,\" and then any \"],[0,[0],1,\"2\"],[0,[],0,\" seconds new lines with \"],[0,[0],1,\"Received Job\"],[0,[],0,\".\"]]],[10,3],[1,\"p\",[[0,[],0,\"Of course you can use many instances of scripts that are workers and do these jobs in independent processes. In this case I wanted streamline outgoing http requests so I decided to process them in single \"],[0,[0],1,\"pull\"],[0,[],0,\" and inject these requests from different places of code by \"],[0,[0],1,\"push\"],[0,[],0,\". So you can see that there is huge variety of applications especially, taking into account that I presented only one pattern from 4 available in ZeroMQ.\"]]]],\"ghostVersion\":\"4.0\"}","html":"<p>ZeroMQ is a messaging library that enables fast and efficient communication between distributed systems. With ZeroMQ, developers can easily build complex messaging systems that can handle high volumes of data and are resilient to network failures. In Node.js, the ZeroMQ library can be used to create messaging endpoints and send and receive messages between them.</p><p>In this article, we will explore how to use the ZeroMQ library in Node.js by examining a code snippet that demonstrates how to send and receive messages using the ZeroMQ <code>Push</code> and <code>Pull</code> sockets. The code shows how to create a <code>push</code> function that sends a message to a <code>Pull</code> socket, and a <code>pull</code> function that receives messages from a <code>Push</code> socket. We will examine the various components of the code and explain how they work together to create a reliable messaging system. We will also explore some best practices for using ZeroMQ in Node.js and discuss some common use cases for the library.</p><figure class=\"kg-card kg-bookmark-card\"><a class=\"kg-bookmark-container\" href=\"https://zeromq.org/\"><div class=\"kg-bookmark-content\"><div class=\"kg-bookmark-title\">ZeroMQ</div><div class=\"kg-bookmark-description\">An open-source universal messaging library</div><div class=\"kg-bookmark-metadata\"><img class=\"kg-bookmark-icon\" src=\"https://zeromq.org/apple-touch-icon.png\"></div></div><div class=\"kg-bookmark-thumbnail\"><img src=\"https://zeromq.org/images/logo.gif\"></div></a></figure><p>The built-in core ZeroMQ patterns are:</p><ul><li><a href=\"https://zeromq.org/socket-api/#request-reply-pattern\"><strong><strong>Request-reply</strong></strong></a>, which connects a set of clients to a set of services. This is a remote procedure call and task distribution pattern.</li><li><a href=\"https://zeromq.org/socket-api/#publish-subscribe-pattern\"><strong><strong>Pub-sub</strong></strong></a>, which connects a set of publishers to a set of subscribers. This is a data distribution pattern.</li><li><a href=\"https://zeromq.org/socket-api/#pipeline-pattern\"><strong><strong>Pipeline</strong></strong></a>, which connects nodes in a fan-out/fan-in pattern that can have multiple steps and loops. This is a parallel task distribution and collection pattern.</li><li><a href=\"https://zeromq.org/socket-api/#exclusive-pair-pattern\"><strong><strong>Exclusive pair</strong></strong></a>, which connects two sockets exclusively. This is a pattern for connecting two threads in a process, not to be confused with “normal” pairs of sockets.</li></ul><p>We are interested strictly in <code>pipeline</code>. Our goal is write code from wich I can import and export <code>pull</code> and <code>push</code> functions to easy use them later without worrying if socket is open or maintaining socket in context or global state.</p><pre><code class=\"language-typescript\">import {Push, Pull, MessageLike} from \"zeromq\";\n\n// Import the required ZeroMQ sockets and types\n\nconst sleep = (time: number): Promise&lt;void&gt; =&gt; new Promise((resolve) =&gt; setTimeout(resolve, time))\n\n// Define a sleep function that returns a Promise that resolves after a given time interval\n\nconst pushSocket = new Push();\nconst pullSocket = new Pull();\n\n// Create a new ZeroMQ Push socket and a new Pull socket\n\nexport async function push&lt;T extends MessageLike | MessageLike[]&gt;(job: T): Promise&lt;void&gt; {\n\n    // Define a push function that takes a generic message and sends it to the Pull socket\n    // The function returns a Promise that resolves when the message is sent\n\n    if(!pushSocket.writable){\n        await pushSocket.bind(\"tcp://*:7777\");\n    }\n\n    // If the socket is not yet writable, bind it to the address \"tcp://*:7777\"\n\n    await pushSocket.send(job);\n\n    // Send the message to the connected Pull socket\n}\n\nexport async function pull&lt;T&gt;(): Promise&lt;void&gt; {\n\n    // Define a pull function that receives messages from the Push socket\n    // The function returns a Promise that resolves when a message is received\n\n    pullSocket.connect(\"tcp://localhost:7777\");\n\n    // Connect the Pull socket to the address \"tcp://localhost:7777\"\n\n    for await (const [msg] of pullSocket) {\n        await sleep(2000);\n        console.log(`Received Job ${msg.toString()}`);\n    }\n\n    // Use a for-await-of loop to iterate over incoming messages from the Pull socket\n    // The sleep function is called to simulate a delay in processing the message\n    // The message is then logged to the console\n}</code></pre><p>Assuming that i called this file <code>zero.ts</code> I can use it in script below</p><pre><code class=\"language-typescript\">import {pull, push} from \"./zero\";\n\npull().catch(console.error)\n\nasync function main() {\n    for(let i = 1; i &lt;= 10; i++) {\n        console.log(\"push\", i);\n        await push(`ok ${i}`)\n    }\n}\n\nmain().catch(console.error)\n</code></pre><p>I will see almost instant <code>push 1..10</code> and then any <code>2</code> seconds new lines with <code>Received Job</code>.</p><figure class=\"kg-card kg-image-card\"><img src=\"__GHOST_URL__/content/images/2023/02/Zrzut-ekranu-z-2023-02-19-16-22-15.png\" class=\"kg-image\" alt loading=\"lazy\" width=\"320\" height=\"263\"></figure><p>Of course you can use many instances of scripts that are workers and do these jobs in independent processes. In this case I wanted streamline outgoing http requests so I decided to process them in single <code>pull</code> and inject these requests from different places of code by <code>push</code>. So you can see that there is huge variety of applications especially, taking into account that I presented only one pattern from 4 available in ZeroMQ.</p>","comment_id":"63f1e7b7bbda300a2f29d411","plaintext":"ZeroMQ is a messaging library that enables fast and efficient communication\nbetween distributed systems. With ZeroMQ, developers can easily build complex\nmessaging systems that can handle high volumes of data and are resilient to\nnetwork failures. In Node.js, the ZeroMQ library can be used to create messaging\nendpoints and send and receive messages between them.\n\nIn this article, we will explore how to use the ZeroMQ library in Node.js by\nexamining a code snippet that demonstrates how to send and receive messages\nusing the ZeroMQ Push and Pull sockets. The code shows how to create a push \nfunction that sends a message to a Pull socket, and a pull function that\nreceives messages from a Push socket. We will examine the various components of\nthe code and explain how they work together to create a reliable messaging\nsystem. We will also explore some best practices for using ZeroMQ in Node.js and\ndiscuss some common use cases for the library.\n\nZeroMQAn open-source universal messaging library [https://zeromq.org/]The\nbuilt-in core ZeroMQ patterns are:\n\n * Request-reply [https://zeromq.org/socket-api/#request-reply-pattern], which\n   connects a set of clients to a set of services. This is a remote procedure\n   call and task distribution pattern.\n * Pub-sub [https://zeromq.org/socket-api/#publish-subscribe-pattern], which\n   connects a set of publishers to a set of subscribers. This is a data\n   distribution pattern.\n * Pipeline [https://zeromq.org/socket-api/#pipeline-pattern], which connects\n   nodes in a fan-out/fan-in pattern that can have multiple steps and loops.\n   This is a parallel task distribution and collection pattern.\n * Exclusive pair [https://zeromq.org/socket-api/#exclusive-pair-pattern], which\n   connects two sockets exclusively. This is a pattern for connecting two\n   threads in a process, not to be confused with “normal” pairs of sockets.\n\nWe are interested strictly in pipeline. Our goal is write code from wich I can\nimport and export pull and push functions to easy use them later without\nworrying if socket is open or maintaining socket in context or global state.\n\nimport {Push, Pull, MessageLike} from \"zeromq\";\n\n// Import the required ZeroMQ sockets and types\n\nconst sleep = (time: number): Promise<void> => new Promise((resolve) => setTimeout(resolve, time))\n\n// Define a sleep function that returns a Promise that resolves after a given time interval\n\nconst pushSocket = new Push();\nconst pullSocket = new Pull();\n\n// Create a new ZeroMQ Push socket and a new Pull socket\n\nexport async function push<T extends MessageLike | MessageLike[]>(job: T): Promise<void> {\n\n    // Define a push function that takes a generic message and sends it to the Pull socket\n    // The function returns a Promise that resolves when the message is sent\n\n    if(!pushSocket.writable){\n        await pushSocket.bind(\"tcp://*:7777\");\n    }\n\n    // If the socket is not yet writable, bind it to the address \"tcp://*:7777\"\n\n    await pushSocket.send(job);\n\n    // Send the message to the connected Pull socket\n}\n\nexport async function pull<T>(): Promise<void> {\n\n    // Define a pull function that receives messages from the Push socket\n    // The function returns a Promise that resolves when a message is received\n\n    pullSocket.connect(\"tcp://localhost:7777\");\n\n    // Connect the Pull socket to the address \"tcp://localhost:7777\"\n\n    for await (const [msg] of pullSocket) {\n        await sleep(2000);\n        console.log(`Received Job ${msg.toString()}`);\n    }\n\n    // Use a for-await-of loop to iterate over incoming messages from the Pull socket\n    // The sleep function is called to simulate a delay in processing the message\n    // The message is then logged to the console\n}\n\nAssuming that i called this file zero.ts I can use it in script below\n\nimport {pull, push} from \"./zero\";\n\npull().catch(console.error)\n\nasync function main() {\n    for(let i = 1; i <= 10; i++) {\n        console.log(\"push\", i);\n        await push(`ok ${i}`)\n    }\n}\n\nmain().catch(console.error)\n\n\nI will see almost instant push 1..10 and then any 2 seconds new lines with \nReceived Job.\n\nOf course you can use many instances of scripts that are workers and do these\njobs in independent processes. In this case I wanted streamline outgoing http\nrequests so I decided to process them in single pull and inject these requests\nfrom different places of code by push. So you can see that there is huge variety\nof applications especially, taking into account that I presented only one\npattern from 4 available in ZeroMQ.","feature_image":"__GHOST_URL__/content/images/2023/02/DALL-E-2023-02-19-16.32.22---background-in-artistic--gentle--modern-that-does-not-have-any-objects--but-rather-gradients-and-dimmed-colors---1.png","featured":0,"type":"post","status":"published","locale":null,"visibility":"public","email_recipient_filter":"all","created_at":"2023-02-19T09:11:19.000Z","updated_at":"2023-02-19T09:43:53.000Z","published_at":"2023-02-19T09:42:31.000Z","custom_excerpt":"The article highlights the flexibility that ZeroMQ provides in creating messaging endpoints in Node.js. The pull-push pattern is described as a key messaging pattern in ZeroMQ, which is ideal for distributed systems that require handling high volume and frequency of messages.","codeinjection_head":null,"codeinjection_foot":null,"custom_template":null,"canonical_url":null,"newsletter_id":null,"lexical":null},{"id":"63f43262bbda300a2f29d463","uuid":"894ceb55-aeac-4d36-8f3c-444367b1e49a","title":"QuickSort implementation in Rust, Typescript and Go","slug":"quicksort-implementation-in-rust-typescript-and-go","mobiledoc":"{\"version\":\"0.3.1\",\"atoms\":[],\"cards\":[[\"image\",{\"src\":\"__GHOST_URL__/content/images/2023/02/1664539554681.jpeg\",\"width\":800,\"height\":997}],[\"image\",{\"src\":\"__GHOST_URL__/content/images/2023/02/fa4d450bf8481a058515ba78e701bcf3b0f1ee2bea482938344c085ec2077114_1.jpg\",\"width\":554,\"height\":574}],[\"code\",{\"code\":\"fn quick_sort<T: Ord>(mut arr: Vec<T>) -> Vec<T> {\\n    if arr.len() <= 1 {\\n        return arr;\\n    }\\n\\n    let pivot = arr.remove(0);\\n    let mut left = vec![];\\n    let mut right = vec![];\\n\\n    for item in arr {\\n        if item <= pivot {\\n            left.push(item);\\n        } else {\\n            right.push(item);\\n        }\\n    }\\n\\n    let mut sorted_left = quick_sort(left);\\n    let mut sorted_right = quick_sort(right);\\n\\n    sorted_left.push(pivot);\\n    sorted_left.append(&mut sorted_right);\\n\\n    sorted_left\\n}\\n\\nfn main() {\\n    let arr = vec![10, 80, 30, 90, 40, 50, 70];\\n\\n    println!(\\\"{:?}\\\", arr);\\n    println!(\\\"{:?}\\\", quick_sort(arr));\\n}\",\"language\":\"rust\"}],[\"code\",{\"code\":\"function quickSort(arr: number[]): number[] {\\n    if (arr.length <= 1) {\\n        return arr;\\n    }\\n\\n    const pivot = arr[0];\\n    const left: number[] = [];\\n    const right: number[] = [];\\n\\n    for (let i = 1; i < arr.length; i++) {\\n        if (arr[i] < pivot) {\\n            left.push(arr[i]);\\n        } else {\\n            right.push(arr[i]);\\n        }\\n    }\\n\\n    return [...quickSort(left), pivot, ...quickSort(right)];\\n}\\n\\n// Example usage\\nconst arr: number[] = [10, 80, 30, 90, 40, 50, 70];\\nconst sortedArr: number[] = quickSort(arr);\\nconsole.log(sortedArr);\",\"language\":\"typescript\"}],[\"code\",{\"code\":\"package main\\n\\nimport \\\"fmt\\\"\\n\\nfunc quickSort(arr []int) []int {\\n    if len(arr) <= 1 {\\n        return arr\\n    }\\n\\n    pivot := arr[0]\\n    left := []int{}\\n    right := []int{}\\n\\n    for i := 1; i < len(arr); i++ {\\n        if arr[i] < pivot {\\n            left = append(left, arr[i])\\n        } else {\\n            right = append(right, arr[i])\\n        }\\n    }\\n\\n    return append(append(quickSort(left), pivot), quickSort(right)...)\\n}\\n\\nfunc main() {\\n    arr := []int{10, 80, 30, 90, 40, 50, 70}\\n    sortedArr := quickSort(arr)\\n    fmt.Println(sortedArr)\\n}\",\"language\":\"go\"}],[\"code\",{\"code\":\"    let pivot = arr.remove(0);\\n\",\"language\":\"rust\"}],[\"code\",{\"code\":\"    let pivot_index = arr.len() / 2;\\n    let pivot = arr.remove(pivot_index);\",\"language\":\"rust\"}],[\"code\",{\"code\":\"    let pivot_index = median_of_three(&arr);\\n    let pivot = arr.remove(pivot_index);\",\"language\":\"rust\"}],[\"code\",{\"code\":\"fn median_of_three<T: Ord>(arr: &[T]) -> usize {\\n    let first = arr[0];\\n    let middle = arr[arr.len() / 2];\\n    let last = arr[arr.len() - 1];\\n\\n    if (first < middle && middle < last) || (last < middle && middle < first) {\\n        arr.len() / 2\\n    } else if (middle < first && first < last) || (last < first && first < middle) {\\n        0\\n    } else {\\n        arr.len() - 1\\n    }\\n}\",\"language\":\"rust\"}],[\"image\",{\"src\":\"__GHOST_URL__/content/images/2023/02/ca23e33bbcc513f5a0396686b3bac790b76f4313bd1261aaf935f1acea8ffdc4_1.jpg\",\"width\":500,\"height\":720}]],\"markups\":[[\"code\"]],\"sections\":[[1,\"p\",[[0,[],0,\"QuickSort is a popular sorting algorithm that follows the divide-and-conquer approach to sort an array of elements. It works by dividing the array into two smaller sub-arrays around a pivot element, which is selected from the array. The elements in the left sub-array are all smaller than the pivot, and the elements in the right sub-array are all greater than the pivot. The pivot element is then placed in its final position, with all elements on its left being smaller than it, and all elements on its right being greater than it. This process is repeated recursively on the left and right sub-arrays until the whole array is sorted.\"]]],[10,0],[1,\"p\",[[0,[],0,\"Here are the basic steps of the QuickSort algorithm:\"]]],[3,\"ol\",[[[0,[],0,\"Choose a pivot element from the array. The pivot can be any element in the array, but it is often chosen to be the first or last element.\"]],[[0,[],0,\"Partition the array into two sub-arrays around the pivot element. All elements smaller than the pivot are moved to the left sub-array, and all elements greater than the pivot are moved to the right sub-array.\"]],[[0,[],0,\"Recursively sort the left and right sub-arrays using the same process.\"]],[[0,[],0,\"Concatenate the sorted left sub-array, the pivot element, and the sorted right sub-array to produce the final sorted array.\"]]]],[1,\"p\",[[0,[],0,\"To partition the array, QuickSort uses a two-pointer approach, where two pointers are used to scan the array from both ends. The left pointer starts from the first element of the array and moves to the right, while the right pointer starts from the last element of the array and moves to the left. When the left pointer encounters an element greater than or equal to the pivot, and the right pointer encounters an element less than or equal to the pivot, the two elements are swapped. The process continues until the left pointer and right pointer meet, at which point the pivot element is placed in its final position.\"]]],[1,\"p\",[[0,[],0,\"The worst-case time complexity of QuickSort is O(n^2), but in practice, it performs much better than this because it has an average-case time complexity of O(n log n). The performance of QuickSort can be further improved by selecting the pivot element more intelligently, for example, by choosing the median of the first, middle, and last elements of the array.\"]]],[10,1],[1,\"p\",[[0,[],0,\"Although in name there is \"],[0,[0],1,\"Quick\"],[0,[],0,\" it is not the fastest algorithm, but \"],[0,[0],1,\"O( n log n)\"],[0,[],0,\" is much better that \"],[0,[0],1,\"O( n^2 )\"],[0,[],0,\" for popular simple Bubble sort.\"]]],[1,\"p\",[[0,[],0,\"I presenting three implementations:\"]]],[1,\"h2\",[[0,[],0,\"Quick Sort in Rust\"]]],[10,2],[1,\"h2\",[[0,[],0,\"Quick Sort in TypeScript\"]]],[10,3],[1,\"h2\",[[0,[],0,\"Quick Sort in Go\"]]],[10,4],[1,\"h2\",[[0,[],0,\"Pivot selection in Quick Sort\"]]],[1,\"p\",[[0,[],0,\"There is one problem. In initial description of algorithm I mentioned that we selecting \"],[0,[0],1,\"pivot\"],[0,[],0,\". If I am starting with totally random data, then this step rather does not matter, because first element is enough rantom to expect that it can divide array to approximately similar subarrays. \"]]],[1,\"p\",[[0,[],0,\"Unfortunately if we getting already sorted, or nearly sorted input, then using first element we losing gain from splitting array using pivot because almost all elements are greater than first one. \"]]],[1,\"p\",[[0,[],0,\"The choice of pivot element is a critical factor in the performance of QuickSort, as it can have a significant impact on the number of comparisons and swaps needed to sort the array. If a bad pivot is chosen, such as the smallest or largest element in the array, the performance can degrade to O(n^2), which is much slower than the average-case time complexity of O(n log n) that QuickSort is known for.\"]]],[1,\"p\",[[0,[],0,\"To fix this problem we can easy replace\"]]],[10,5],[1,\"p\",[[0,[],0,\"by\"]]],[10,6],[1,\"p\",[[0,[],0,\"Other little more sophisticated approach is to use median of the first, middle, and last elements of the array as the pivot. Then:\"]]],[10,7],[1,\"p\",[[0,[],0,\"and\"]]],[10,8],[1,\"p\",[[0,[],0,\"Due this issue with pivot selection QuickSort can be slowed down by specially malicious input data selection, so it is susceptible to some security attacks, such hash table collisions, its many advantages make it a popular choice for sorting large datasets. With the right choice of pivot element, QuickSort can achieve an average-case time complexity of O(n log n), which is faster than most other popular sorting algorithms. If you are working with large datasets and need to sort them quickly, QuickSort is a great choice.\"]]],[10,9],[1,\"p\",[[0,[],0,\"I know what you think. That this fun with sorting optimization is only for scientists, and in practice we are using sorting build in our languages, but sometimes to build something amazing it is worth to have deeper knowledge and intuition, what is worth to optimize and what not.\"]]]],\"ghostVersion\":\"4.0\"}","html":"<p>QuickSort is a popular sorting algorithm that follows the divide-and-conquer approach to sort an array of elements. It works by dividing the array into two smaller sub-arrays around a pivot element, which is selected from the array. The elements in the left sub-array are all smaller than the pivot, and the elements in the right sub-array are all greater than the pivot. The pivot element is then placed in its final position, with all elements on its left being smaller than it, and all elements on its right being greater than it. This process is repeated recursively on the left and right sub-arrays until the whole array is sorted.</p><figure class=\"kg-card kg-image-card\"><img src=\"__GHOST_URL__/content/images/2023/02/1664539554681.jpeg\" class=\"kg-image\" alt loading=\"lazy\" width=\"800\" height=\"997\" srcset=\"__GHOST_URL__/content/images/size/w600/2023/02/1664539554681.jpeg 600w, __GHOST_URL__/content/images/2023/02/1664539554681.jpeg 800w\" sizes=\"(min-width: 720px) 720px\"></figure><p>Here are the basic steps of the QuickSort algorithm:</p><ol><li>Choose a pivot element from the array. The pivot can be any element in the array, but it is often chosen to be the first or last element.</li><li>Partition the array into two sub-arrays around the pivot element. All elements smaller than the pivot are moved to the left sub-array, and all elements greater than the pivot are moved to the right sub-array.</li><li>Recursively sort the left and right sub-arrays using the same process.</li><li>Concatenate the sorted left sub-array, the pivot element, and the sorted right sub-array to produce the final sorted array.</li></ol><p>To partition the array, QuickSort uses a two-pointer approach, where two pointers are used to scan the array from both ends. The left pointer starts from the first element of the array and moves to the right, while the right pointer starts from the last element of the array and moves to the left. When the left pointer encounters an element greater than or equal to the pivot, and the right pointer encounters an element less than or equal to the pivot, the two elements are swapped. The process continues until the left pointer and right pointer meet, at which point the pivot element is placed in its final position.</p><p>The worst-case time complexity of QuickSort is O(n^2), but in practice, it performs much better than this because it has an average-case time complexity of O(n log n). The performance of QuickSort can be further improved by selecting the pivot element more intelligently, for example, by choosing the median of the first, middle, and last elements of the array.</p><figure class=\"kg-card kg-image-card\"><img src=\"__GHOST_URL__/content/images/2023/02/fa4d450bf8481a058515ba78e701bcf3b0f1ee2bea482938344c085ec2077114_1.jpg\" class=\"kg-image\" alt loading=\"lazy\" width=\"554\" height=\"574\"></figure><p>Although in name there is <code>Quick</code> it is not the fastest algorithm, but <code>O( n log n)</code> is much better that <code>O( n^2 )</code> for popular simple Bubble sort.</p><p>I presenting three implementations:</p><h2 id=\"quick-sort-in-rust\">Quick Sort in Rust</h2><pre><code class=\"language-rust\">fn quick_sort&lt;T: Ord&gt;(mut arr: Vec&lt;T&gt;) -&gt; Vec&lt;T&gt; {\n    if arr.len() &lt;= 1 {\n        return arr;\n    }\n\n    let pivot = arr.remove(0);\n    let mut left = vec![];\n    let mut right = vec![];\n\n    for item in arr {\n        if item &lt;= pivot {\n            left.push(item);\n        } else {\n            right.push(item);\n        }\n    }\n\n    let mut sorted_left = quick_sort(left);\n    let mut sorted_right = quick_sort(right);\n\n    sorted_left.push(pivot);\n    sorted_left.append(&amp;mut sorted_right);\n\n    sorted_left\n}\n\nfn main() {\n    let arr = vec![10, 80, 30, 90, 40, 50, 70];\n\n    println!(\"{:?}\", arr);\n    println!(\"{:?}\", quick_sort(arr));\n}</code></pre><h2 id=\"quick-sort-in-typescript\">Quick Sort in TypeScript</h2><pre><code class=\"language-typescript\">function quickSort(arr: number[]): number[] {\n    if (arr.length &lt;= 1) {\n        return arr;\n    }\n\n    const pivot = arr[0];\n    const left: number[] = [];\n    const right: number[] = [];\n\n    for (let i = 1; i &lt; arr.length; i++) {\n        if (arr[i] &lt; pivot) {\n            left.push(arr[i]);\n        } else {\n            right.push(arr[i]);\n        }\n    }\n\n    return [...quickSort(left), pivot, ...quickSort(right)];\n}\n\n// Example usage\nconst arr: number[] = [10, 80, 30, 90, 40, 50, 70];\nconst sortedArr: number[] = quickSort(arr);\nconsole.log(sortedArr);</code></pre><h2 id=\"quick-sort-in-go\">Quick Sort in Go</h2><pre><code class=\"language-go\">package main\n\nimport \"fmt\"\n\nfunc quickSort(arr []int) []int {\n    if len(arr) &lt;= 1 {\n        return arr\n    }\n\n    pivot := arr[0]\n    left := []int{}\n    right := []int{}\n\n    for i := 1; i &lt; len(arr); i++ {\n        if arr[i] &lt; pivot {\n            left = append(left, arr[i])\n        } else {\n            right = append(right, arr[i])\n        }\n    }\n\n    return append(append(quickSort(left), pivot), quickSort(right)...)\n}\n\nfunc main() {\n    arr := []int{10, 80, 30, 90, 40, 50, 70}\n    sortedArr := quickSort(arr)\n    fmt.Println(sortedArr)\n}</code></pre><h2 id=\"pivot-selection-in-quick-sort\">Pivot selection in Quick Sort</h2><p>There is one problem. In initial description of algorithm I mentioned that we selecting <code>pivot</code>. If I am starting with totally random data, then this step rather does not matter, because first element is enough rantom to expect that it can divide array to approximately similar subarrays. </p><p>Unfortunately if we getting already sorted, or nearly sorted input, then using first element we losing gain from splitting array using pivot because almost all elements are greater than first one. </p><p>The choice of pivot element is a critical factor in the performance of QuickSort, as it can have a significant impact on the number of comparisons and swaps needed to sort the array. If a bad pivot is chosen, such as the smallest or largest element in the array, the performance can degrade to O(n^2), which is much slower than the average-case time complexity of O(n log n) that QuickSort is known for.</p><p>To fix this problem we can easy replace</p><pre><code class=\"language-rust\">    let pivot = arr.remove(0);\n</code></pre><p>by</p><pre><code class=\"language-rust\">    let pivot_index = arr.len() / 2;\n    let pivot = arr.remove(pivot_index);</code></pre><p>Other little more sophisticated approach is to use median of the first, middle, and last elements of the array as the pivot. Then:</p><pre><code class=\"language-rust\">    let pivot_index = median_of_three(&amp;arr);\n    let pivot = arr.remove(pivot_index);</code></pre><p>and</p><pre><code class=\"language-rust\">fn median_of_three&lt;T: Ord&gt;(arr: &amp;[T]) -&gt; usize {\n    let first = arr[0];\n    let middle = arr[arr.len() / 2];\n    let last = arr[arr.len() - 1];\n\n    if (first &lt; middle &amp;&amp; middle &lt; last) || (last &lt; middle &amp;&amp; middle &lt; first) {\n        arr.len() / 2\n    } else if (middle &lt; first &amp;&amp; first &lt; last) || (last &lt; first &amp;&amp; first &lt; middle) {\n        0\n    } else {\n        arr.len() - 1\n    }\n}</code></pre><p>Due this issue with pivot selection QuickSort can be slowed down by specially malicious input data selection, so it is susceptible to some security attacks, such hash table collisions, its many advantages make it a popular choice for sorting large datasets. With the right choice of pivot element, QuickSort can achieve an average-case time complexity of O(n log n), which is faster than most other popular sorting algorithms. If you are working with large datasets and need to sort them quickly, QuickSort is a great choice.</p><figure class=\"kg-card kg-image-card\"><img src=\"__GHOST_URL__/content/images/2023/02/ca23e33bbcc513f5a0396686b3bac790b76f4313bd1261aaf935f1acea8ffdc4_1.jpg\" class=\"kg-image\" alt loading=\"lazy\" width=\"500\" height=\"720\"></figure><p>I know what you think. That this fun with sorting optimization is only for scientists, and in practice we are using sorting build in our languages, but sometimes to build something amazing it is worth to have deeper knowledge and intuition, what is worth to optimize and what not.</p>","comment_id":"63f43262bbda300a2f29d463","plaintext":"QuickSort is a popular sorting algorithm that follows the divide-and-conquer\napproach to sort an array of elements. It works by dividing the array into two\nsmaller sub-arrays around a pivot element, which is selected from the array. The\nelements in the left sub-array are all smaller than the pivot, and the elements\nin the right sub-array are all greater than the pivot. The pivot element is then\nplaced in its final position, with all elements on its left being smaller than\nit, and all elements on its right being greater than it. This process is\nrepeated recursively on the left and right sub-arrays until the whole array is\nsorted.\n\nHere are the basic steps of the QuickSort algorithm:\n\n 1. Choose a pivot element from the array. The pivot can be any element in the\n    array, but it is often chosen to be the first or last element.\n 2. Partition the array into two sub-arrays around the pivot element. All\n    elements smaller than the pivot are moved to the left sub-array, and all\n    elements greater than the pivot are moved to the right sub-array.\n 3. Recursively sort the left and right sub-arrays using the same process.\n 4. Concatenate the sorted left sub-array, the pivot element, and the sorted\n    right sub-array to produce the final sorted array.\n\nTo partition the array, QuickSort uses a two-pointer approach, where two\npointers are used to scan the array from both ends. The left pointer starts from\nthe first element of the array and moves to the right, while the right pointer\nstarts from the last element of the array and moves to the left. When the left\npointer encounters an element greater than or equal to the pivot, and the right\npointer encounters an element less than or equal to the pivot, the two elements\nare swapped. The process continues until the left pointer and right pointer\nmeet, at which point the pivot element is placed in its final position.\n\nThe worst-case time complexity of QuickSort is O(n^2), but in practice, it\nperforms much better than this because it has an average-case time complexity of\nO(n log n). The performance of QuickSort can be further improved by selecting\nthe pivot element more intelligently, for example, by choosing the median of the\nfirst, middle, and last elements of the array.\n\nAlthough in name there is Quick it is not the fastest algorithm, but O( n log n) \nis much better that O( n^2 ) for popular simple Bubble sort.\n\nI presenting three implementations:\n\nQuick Sort in Rust\nfn quick_sort<T: Ord>(mut arr: Vec<T>) -> Vec<T> {\n    if arr.len() <= 1 {\n        return arr;\n    }\n\n    let pivot = arr.remove(0);\n    let mut left = vec![];\n    let mut right = vec![];\n\n    for item in arr {\n        if item <= pivot {\n            left.push(item);\n        } else {\n            right.push(item);\n        }\n    }\n\n    let mut sorted_left = quick_sort(left);\n    let mut sorted_right = quick_sort(right);\n\n    sorted_left.push(pivot);\n    sorted_left.append(&mut sorted_right);\n\n    sorted_left\n}\n\nfn main() {\n    let arr = vec![10, 80, 30, 90, 40, 50, 70];\n\n    println!(\"{:?}\", arr);\n    println!(\"{:?}\", quick_sort(arr));\n}\n\nQuick Sort in TypeScript\nfunction quickSort(arr: number[]): number[] {\n    if (arr.length <= 1) {\n        return arr;\n    }\n\n    const pivot = arr[0];\n    const left: number[] = [];\n    const right: number[] = [];\n\n    for (let i = 1; i < arr.length; i++) {\n        if (arr[i] < pivot) {\n            left.push(arr[i]);\n        } else {\n            right.push(arr[i]);\n        }\n    }\n\n    return [...quickSort(left), pivot, ...quickSort(right)];\n}\n\n// Example usage\nconst arr: number[] = [10, 80, 30, 90, 40, 50, 70];\nconst sortedArr: number[] = quickSort(arr);\nconsole.log(sortedArr);\n\nQuick Sort in Go\npackage main\n\nimport \"fmt\"\n\nfunc quickSort(arr []int) []int {\n    if len(arr) <= 1 {\n        return arr\n    }\n\n    pivot := arr[0]\n    left := []int{}\n    right := []int{}\n\n    for i := 1; i < len(arr); i++ {\n        if arr[i] < pivot {\n            left = append(left, arr[i])\n        } else {\n            right = append(right, arr[i])\n        }\n    }\n\n    return append(append(quickSort(left), pivot), quickSort(right)...)\n}\n\nfunc main() {\n    arr := []int{10, 80, 30, 90, 40, 50, 70}\n    sortedArr := quickSort(arr)\n    fmt.Println(sortedArr)\n}\n\nPivot selection in Quick Sort\nThere is one problem. In initial description of algorithm I mentioned that we\nselecting pivot. If I am starting with totally random data, then this step\nrather does not matter, because first element is enough rantom to expect that it\ncan divide array to approximately similar subarrays. \n\nUnfortunately if we getting already sorted, or nearly sorted input, then using\nfirst element we losing gain from splitting array using pivot because almost all\nelements are greater than first one. \n\nThe choice of pivot element is a critical factor in the performance of\nQuickSort, as it can have a significant impact on the number of comparisons and\nswaps needed to sort the array. If a bad pivot is chosen, such as the smallest\nor largest element in the array, the performance can degrade to O(n^2), which is\nmuch slower than the average-case time complexity of O(n log n) that QuickSort\nis known for.\n\nTo fix this problem we can easy replace\n\n    let pivot = arr.remove(0);\n\n\nby\n\n    let pivot_index = arr.len() / 2;\n    let pivot = arr.remove(pivot_index);\n\nOther little more sophisticated approach is to use median of the first, middle,\nand last elements of the array as the pivot. Then:\n\n    let pivot_index = median_of_three(&arr);\n    let pivot = arr.remove(pivot_index);\n\nand\n\nfn median_of_three<T: Ord>(arr: &[T]) -> usize {\n    let first = arr[0];\n    let middle = arr[arr.len() / 2];\n    let last = arr[arr.len() - 1];\n\n    if (first < middle && middle < last) || (last < middle && middle < first) {\n        arr.len() / 2\n    } else if (middle < first && first < last) || (last < first && first < middle) {\n        0\n    } else {\n        arr.len() - 1\n    }\n}\n\nDue this issue with pivot selection QuickSort can be slowed down by specially\nmalicious input data selection, so it is susceptible to some security attacks,\nsuch hash table collisions, its many advantages make it a popular choice for\nsorting large datasets. With the right choice of pivot element, QuickSort can\nachieve an average-case time complexity of O(n log n), which is faster than most\nother popular sorting algorithms. If you are working with large datasets and\nneed to sort them quickly, QuickSort is a great choice.\n\nI know what you think. That this fun with sorting optimization is only for\nscientists, and in practice we are using sorting build in our languages, but\nsometimes to build something amazing it is worth to have deeper knowledge and\nintuition, what is worth to optimize and what not.","feature_image":"__GHOST_URL__/content/images/2023/02/guick-sort-gustawdaniel.jpg","featured":0,"type":"post","status":"published","locale":null,"visibility":"public","email_recipient_filter":"all","created_at":"2023-02-21T02:54:26.000Z","updated_at":"2023-02-21T03:51:40.000Z","published_at":"2023-02-21T03:51:40.000Z","custom_excerpt":"Master QuickSort with our in-depth guide and implementation examples in three popular programming languages, and sort large datasets quickly and efficiently.","codeinjection_head":null,"codeinjection_foot":null,"custom_template":null,"canonical_url":null,"newsletter_id":null,"lexical":null},{"id":"64002f89bbda300a2f29d4ed","uuid":"7c551ce9-9369-4a69-a38a-7bc23005824c","title":"How to install MongoDB 6 on Fedora 37","slug":"how-to-install-mongodb-6-on-fedora-37","mobiledoc":"{\"version\":\"0.3.1\",\"atoms\":[],\"cards\":[[\"bookmark\",{\"type\":\"bookmark\",\"url\":\"https://www.mongodb.com/docs/manual/tutorial/install-mongodb-on-red-hat/\",\"metadata\":{\"url\":\"https://www.mongodb.com/docs/manual/tutorial/install-mongodb-on-red-hat/\",\"title\":\"Install MongoDB Community Edition on Red Hat or CentOS — MongoDB Manual\",\"description\":null,\"author\":null,\"publisher\":null,\"thumbnail\":\"https://www.mongodb.com/docs/assets/meta_generic.png\",\"icon\":\"https://www.mongodb.com/docs/assets/favicon.ico\"}}],[\"code\",{\"code\":\"https://repo.mongodb.org/yum/redhat/\"}],[\"code\",{\"code\":\"sudo tee /etc/yum.repos.d/mongodb-org-6.0.repo<<EOF\\n[mongodb-org-6.0]\\nname=MongoDB Repository\\nbaseurl=https://repo.mongodb.org/yum/redhat/9/mongodb-org/6.0/x86_64/\\ngpgcheck=1\\nenabled=1\\ngpgkey=https://www.mongodb.org/static/pgp/server-6.0.asc\\nEOF\"}],[\"code\",{\"code\":\"sudo dnf install -y mongodb-org\"}],[\"image\",{\"src\":\"__GHOST_URL__/content/images/2023/03/1_SwgB2rxPWgOjbh030ETxyg.png\",\"width\":777,\"height\":781}],[\"code\",{\"code\":\"sudo systemctl start mongod\"}],[\"image\",{\"src\":\"__GHOST_URL__/content/images/2023/03/Zrzut-ekranu-z-2023-03-02-13-19-32.png\",\"width\":1062,\"height\":548}],[\"bookmark\",{\"type\":\"bookmark\",\"url\":\"https://www.mongodb.com/docs/compass/master/install/\",\"metadata\":{\"url\":\"https://www.mongodb.com/docs/compass/master/install/\",\"title\":\"Download and Install Compass — MongoDB Compass\",\"description\":null,\"author\":null,\"publisher\":null,\"thumbnail\":\"https://www.mongodb.com/docs/assets/meta_generic.png\",\"icon\":\"https://www.mongodb.com/docs/assets/favicon.ico\"}}],[\"code\",{\"code\":\"wget https://downloads.mongodb.com/compass/mongodb-compass-1.35.0.x86_64.rpm\"}],[\"code\",{\"code\":\"sudo dnf install -y mongodb-compass-1.35.0.x86_64.rpm\"}],[\"image\",{\"src\":\"__GHOST_URL__/content/images/2023/03/Zrzut-ekranu-z-2023-03-02-13-41-28.png\",\"width\":1914,\"height\":1078}],[\"bookmark\",{\"type\":\"bookmark\",\"url\":\"https://www.mongodb.com/docs/manual/replication/\",\"metadata\":{\"url\":\"https://www.mongodb.com/docs/manual/replication/\",\"title\":\"Replication — MongoDB Manual\",\"description\":null,\"author\":null,\"publisher\":null,\"thumbnail\":\"https://www.mongodb.com/docs/assets/meta_generic.png\",\"icon\":\"https://www.mongodb.com/docs/assets/favicon.ico\"}}],[\"code\",{\"code\":\"#replication:\"}],[\"code\",{\"language\":\"3\",\"code\":\"replication:\\n  replSetName: \\\"rs0\\\"\"}],[\"code\",{\"code\":\"sudo systemctl restart mongod\"}],[\"code\",{\"code\":\"rs.initiate()\"}],[\"code\",{\"code\":\"rs.status()\"}],[\"image\",{\"src\":\"__GHOST_URL__/content/images/2023/03/Zrzut-ekranu-z-2023-03-02-13-30-41.png\",\"width\":690,\"height\":226}],[\"bookmark\",{\"type\":\"bookmark\",\"url\":\"https://www.digitalocean.com/community/tutorials/how-to-configure-a-mongodb-replica-set-on-ubuntu-20-04\",\"metadata\":{\"url\":\"https://www.digitalocean.com/community/tutorials/how-to-configure-a-mongodb-replica-set-on-ubuntu-20-04\",\"title\":\"How To Configure a MongoDB Replica Set on Ubuntu 20.04 | DigitalOcean\",\"description\":\"The practice of synchronizing data across multiple separate databases is called replication. In MongoDB, a group of servers that maintain the same data set through replication are referred to as a replica set. This tutorial provides a brief overview of how replication works in MongoDB before outlini…\",\"author\":\"Mark Drake\",\"publisher\":\"DigitalOcean\",\"thumbnail\":\"https://www.digitalocean.com/_next/static/media/intro-to-cloud.d49bc5f7.jpeg\",\"icon\":\"https://www.digitalocean.com/_next/static/media/android-chrome-512x512.5f2e6221.png\"}}],[\"image\",{\"src\":\"__GHOST_URL__/content/images/2023/03/mongodb-is-web-scale-v0-twb0dwtz8sw81.jpeg\",\"width\":828,\"height\":1028}]],\"markups\":[[\"code\"]],\"sections\":[[1,\"p\",[[0,[],0,\"In official docs there is instruction only for Redhat\"]]],[10,0],[1,\"p\",[[0,[],0,\"and it contains \"],[0,[0],1,\"$releasever\"],[0,[],0,\" in repository file. But on fedora \"],[0,[0],1,\"$releasever\"],[0,[],0,\" is not defined. So to fix it you can check url\"]]],[10,1],[1,\"p\",[[0,[],0,\"and see that higest version of redhat is 9. Because of Fedora is experimental polygon of Redhat you can derive conclusion that it should works if you use redhat repository on fedora like this:\"]]],[10,2],[1,\"p\",[[0,[],0,\"Now you can install by\"]]],[10,3],[10,4],[1,\"p\",[[0,[],0,\"so there are two assumptions that are correct:\"]]],[3,\"ul\",[[[0,[],0,\"using redhat repo for fedora works\"]],[[0,[],0,\"using dnf for yum repos works\"]]]],[1,\"p\",[[0,[],0,\"Now you have to start \"],[0,[0],1,\"mongod\"],[0,[],0,\" service\"]]],[10,5],[1,\"p\",[[0,[],0,\"And you can connect with mongodb by \"],[0,[0],1,\"mongosh\"]]],[10,6],[1,\"p\",[[0,[],0,\"Mongosh is better than \"],[0,[0],1,\"mongo\"],[0,[],0,\" command because of colors and autocompletion, so use \"],[0,[0],1,\"mongosh\"],[0,[],0,\" instead of \"],[0,[0],1,\"mongo\"],[0,[],0,\".\"]]],[1,\"h2\",[[0,[],0,\"Mongo compass\"]]],[1,\"p\",[[0,[],0,\"To browse mongo in graphic mode you will probably choose compass. Following after\"]]],[10,7],[1,\"p\",[[0,[],0,\"you can download \"],[0,[0],1,\"rpm\"],[0,[],0,\" packages\"]]],[10,8],[1,\"p\",[[0,[],0,\"and install it\"]]],[10,9],[10,10],[1,\"h2\",[[0,[],0,\"Enable Mongo Replica Set locally\"]]],[1,\"p\",[[0,[],0,\"Replication described here:\"]]],[10,11],[1,\"p\",[[0,[],0,\"is required by \"],[0,[0],1,\"prisma\"],[0,[],0,\" so I am enabling it locally.\"]]],[1,\"p\",[[0,[],0,\"In file \"],[0,[0],1,\"/etc/mongod.conf\"],[0,[],0,\" you have to replace\"]]],[10,12],[1,\"p\",[[0,[],0,\"by\"]]],[10,13],[1,\"p\",[[0,[],0,\"then reload \"],[0,[0],1,\"mongod\"],[0,[],0,\" service\"]]],[10,14],[1,\"p\",[[0,[],0,\"Login to database by \"],[0,[0],1,\"mongosh\"],[0,[],0,\" and use command\"]]],[10,15],[1,\"p\",[[0,[],0,\"then you can confirm changes by\"]]],[10,16],[10,17],[1,\"p\",[[0,[],0,\"If you experiencing more complications there is great article with advanced config\"]]],[10,18],[10,19],[1,\"p\",[]]],\"ghostVersion\":\"4.0\"}","html":"<p>In official docs there is instruction only for Redhat</p><figure class=\"kg-card kg-bookmark-card\"><a class=\"kg-bookmark-container\" href=\"https://www.mongodb.com/docs/manual/tutorial/install-mongodb-on-red-hat/\"><div class=\"kg-bookmark-content\"><div class=\"kg-bookmark-title\">Install MongoDB Community Edition on Red Hat or CentOS — MongoDB Manual</div><div class=\"kg-bookmark-description\"></div><div class=\"kg-bookmark-metadata\"><img class=\"kg-bookmark-icon\" src=\"https://www.mongodb.com/docs/assets/favicon.ico\"></div></div><div class=\"kg-bookmark-thumbnail\"><img src=\"https://www.mongodb.com/docs/assets/meta_generic.png\"></div></a></figure><p>and it contains <code>$releasever</code> in repository file. But on fedora <code>$releasever</code> is not defined. So to fix it you can check url</p><pre><code>https://repo.mongodb.org/yum/redhat/</code></pre><p>and see that higest version of redhat is 9. Because of Fedora is experimental polygon of Redhat you can derive conclusion that it should works if you use redhat repository on fedora like this:</p><pre><code>sudo tee /etc/yum.repos.d/mongodb-org-6.0.repo&lt;&lt;EOF\n[mongodb-org-6.0]\nname=MongoDB Repository\nbaseurl=https://repo.mongodb.org/yum/redhat/9/mongodb-org/6.0/x86_64/\ngpgcheck=1\nenabled=1\ngpgkey=https://www.mongodb.org/static/pgp/server-6.0.asc\nEOF</code></pre><p>Now you can install by</p><pre><code>sudo dnf install -y mongodb-org</code></pre><figure class=\"kg-card kg-image-card\"><img src=\"__GHOST_URL__/content/images/2023/03/1_SwgB2rxPWgOjbh030ETxyg.png\" class=\"kg-image\" alt loading=\"lazy\" width=\"777\" height=\"781\" srcset=\"__GHOST_URL__/content/images/size/w600/2023/03/1_SwgB2rxPWgOjbh030ETxyg.png 600w, __GHOST_URL__/content/images/2023/03/1_SwgB2rxPWgOjbh030ETxyg.png 777w\" sizes=\"(min-width: 720px) 720px\"></figure><p>so there are two assumptions that are correct:</p><ul><li>using redhat repo for fedora works</li><li>using dnf for yum repos works</li></ul><p>Now you have to start <code>mongod</code> service</p><pre><code>sudo systemctl start mongod</code></pre><p>And you can connect with mongodb by <code>mongosh</code></p><figure class=\"kg-card kg-image-card\"><img src=\"__GHOST_URL__/content/images/2023/03/Zrzut-ekranu-z-2023-03-02-13-19-32.png\" class=\"kg-image\" alt loading=\"lazy\" width=\"1062\" height=\"548\" srcset=\"__GHOST_URL__/content/images/size/w600/2023/03/Zrzut-ekranu-z-2023-03-02-13-19-32.png 600w, __GHOST_URL__/content/images/size/w1000/2023/03/Zrzut-ekranu-z-2023-03-02-13-19-32.png 1000w, __GHOST_URL__/content/images/2023/03/Zrzut-ekranu-z-2023-03-02-13-19-32.png 1062w\" sizes=\"(min-width: 720px) 720px\"></figure><p>Mongosh is better than <code>mongo</code> command because of colors and autocompletion, so use <code>mongosh</code> instead of <code>mongo</code>.</p><h2 id=\"mongo-compass\">Mongo compass</h2><p>To browse mongo in graphic mode you will probably choose compass. Following after</p><figure class=\"kg-card kg-bookmark-card\"><a class=\"kg-bookmark-container\" href=\"https://www.mongodb.com/docs/compass/master/install/\"><div class=\"kg-bookmark-content\"><div class=\"kg-bookmark-title\">Download and Install Compass — MongoDB Compass</div><div class=\"kg-bookmark-description\"></div><div class=\"kg-bookmark-metadata\"><img class=\"kg-bookmark-icon\" src=\"https://www.mongodb.com/docs/assets/favicon.ico\"></div></div><div class=\"kg-bookmark-thumbnail\"><img src=\"https://www.mongodb.com/docs/assets/meta_generic.png\"></div></a></figure><p>you can download <code>rpm</code> packages</p><pre><code>wget https://downloads.mongodb.com/compass/mongodb-compass-1.35.0.x86_64.rpm</code></pre><p>and install it</p><pre><code>sudo dnf install -y mongodb-compass-1.35.0.x86_64.rpm</code></pre><figure class=\"kg-card kg-image-card\"><img src=\"__GHOST_URL__/content/images/2023/03/Zrzut-ekranu-z-2023-03-02-13-41-28.png\" class=\"kg-image\" alt loading=\"lazy\" width=\"1914\" height=\"1078\" srcset=\"__GHOST_URL__/content/images/size/w600/2023/03/Zrzut-ekranu-z-2023-03-02-13-41-28.png 600w, __GHOST_URL__/content/images/size/w1000/2023/03/Zrzut-ekranu-z-2023-03-02-13-41-28.png 1000w, __GHOST_URL__/content/images/size/w1600/2023/03/Zrzut-ekranu-z-2023-03-02-13-41-28.png 1600w, __GHOST_URL__/content/images/2023/03/Zrzut-ekranu-z-2023-03-02-13-41-28.png 1914w\" sizes=\"(min-width: 720px) 720px\"></figure><h2 id=\"enable-mongo-replica-set-locally\">Enable Mongo Replica Set locally</h2><p>Replication described here:</p><figure class=\"kg-card kg-bookmark-card\"><a class=\"kg-bookmark-container\" href=\"https://www.mongodb.com/docs/manual/replication/\"><div class=\"kg-bookmark-content\"><div class=\"kg-bookmark-title\">Replication — MongoDB Manual</div><div class=\"kg-bookmark-description\"></div><div class=\"kg-bookmark-metadata\"><img class=\"kg-bookmark-icon\" src=\"https://www.mongodb.com/docs/assets/favicon.ico\"></div></div><div class=\"kg-bookmark-thumbnail\"><img src=\"https://www.mongodb.com/docs/assets/meta_generic.png\"></div></a></figure><p>is required by <code>prisma</code> so I am enabling it locally.</p><p>In file <code>/etc/mongod.conf</code> you have to replace</p><pre><code>#replication:</code></pre><p>by</p><pre><code class=\"language-3\">replication:\n  replSetName: \"rs0\"</code></pre><p>then reload <code>mongod</code> service</p><pre><code>sudo systemctl restart mongod</code></pre><p>Login to database by <code>mongosh</code> and use command</p><pre><code>rs.initiate()</code></pre><p>then you can confirm changes by</p><pre><code>rs.status()</code></pre><figure class=\"kg-card kg-image-card\"><img src=\"__GHOST_URL__/content/images/2023/03/Zrzut-ekranu-z-2023-03-02-13-30-41.png\" class=\"kg-image\" alt loading=\"lazy\" width=\"690\" height=\"226\" srcset=\"__GHOST_URL__/content/images/size/w600/2023/03/Zrzut-ekranu-z-2023-03-02-13-30-41.png 600w, __GHOST_URL__/content/images/2023/03/Zrzut-ekranu-z-2023-03-02-13-30-41.png 690w\"></figure><p>If you experiencing more complications there is great article with advanced config</p><figure class=\"kg-card kg-bookmark-card\"><a class=\"kg-bookmark-container\" href=\"https://www.digitalocean.com/community/tutorials/how-to-configure-a-mongodb-replica-set-on-ubuntu-20-04\"><div class=\"kg-bookmark-content\"><div class=\"kg-bookmark-title\">How To Configure a MongoDB Replica Set on Ubuntu 20.04 | DigitalOcean</div><div class=\"kg-bookmark-description\">The practice of synchronizing data across multiple separate databases is called replication. In MongoDB, a group of servers that maintain the same data set through replication are referred to as a replica set. This tutorial provides a brief overview of how replication works in MongoDB before outlini…</div><div class=\"kg-bookmark-metadata\"><img class=\"kg-bookmark-icon\" src=\"https://www.digitalocean.com/_next/static/media/android-chrome-512x512.5f2e6221.png\"><span class=\"kg-bookmark-author\">DigitalOcean</span><span class=\"kg-bookmark-publisher\">Mark Drake</span></div></div><div class=\"kg-bookmark-thumbnail\"><img src=\"https://www.digitalocean.com/_next/static/media/intro-to-cloud.d49bc5f7.jpeg\"></div></a></figure><figure class=\"kg-card kg-image-card\"><img src=\"__GHOST_URL__/content/images/2023/03/mongodb-is-web-scale-v0-twb0dwtz8sw81.jpeg\" class=\"kg-image\" alt loading=\"lazy\" width=\"828\" height=\"1028\" srcset=\"__GHOST_URL__/content/images/size/w600/2023/03/mongodb-is-web-scale-v0-twb0dwtz8sw81.jpeg 600w, __GHOST_URL__/content/images/2023/03/mongodb-is-web-scale-v0-twb0dwtz8sw81.jpeg 828w\" sizes=\"(min-width: 720px) 720px\"></figure>","comment_id":"64002f89bbda300a2f29d4ed","plaintext":"In official docs there is instruction only for Redhat\n\nInstall MongoDB Community Edition on Red Hat or CentOS — MongoDB Manual\n[https://www.mongodb.com/docs/manual/tutorial/install-mongodb-on-red-hat/]and it\ncontains $releasever in repository file. But on fedora $releasever is not\ndefined. So to fix it you can check url\n\nhttps://repo.mongodb.org/yum/redhat/\n\nand see that higest version of redhat is 9. Because of Fedora is experimental\npolygon of Redhat you can derive conclusion that it should works if you use\nredhat repository on fedora like this:\n\nsudo tee /etc/yum.repos.d/mongodb-org-6.0.repo<<EOF\n[mongodb-org-6.0]\nname=MongoDB Repository\nbaseurl=https://repo.mongodb.org/yum/redhat/9/mongodb-org/6.0/x86_64/\ngpgcheck=1\nenabled=1\ngpgkey=https://www.mongodb.org/static/pgp/server-6.0.asc\nEOF\n\nNow you can install by\n\nsudo dnf install -y mongodb-org\n\nso there are two assumptions that are correct:\n\n * using redhat repo for fedora works\n * using dnf for yum repos works\n\nNow you have to start mongod service\n\nsudo systemctl start mongod\n\nAnd you can connect with mongodb by mongosh\n\nMongosh is better than mongo command because of colors and autocompletion, so\nuse mongosh instead of mongo.\n\nMongo compass\nTo browse mongo in graphic mode you will probably choose compass. Following\nafter\n\nDownload and Install Compass — MongoDB Compass\n[https://www.mongodb.com/docs/compass/master/install/]you can download rpm packages\n\nwget https://downloads.mongodb.com/compass/mongodb-compass-1.35.0.x86_64.rpm\n\nand install it\n\nsudo dnf install -y mongodb-compass-1.35.0.x86_64.rpm\n\nEnable Mongo Replica Set locally\nReplication described here:\n\nReplication — MongoDB Manual [https://www.mongodb.com/docs/manual/replication/]\nis required by prisma so I am enabling it locally.\n\nIn file /etc/mongod.conf you have to replace\n\n#replication:\n\nby\n\nreplication:\n  replSetName: \"rs0\"\n\nthen reload mongod service\n\nsudo systemctl restart mongod\n\nLogin to database by mongosh and use command\n\nrs.initiate()\n\nthen you can confirm changes by\n\nrs.status()\n\nIf you experiencing more complications there is great article with advanced\nconfig\n\nHow To Configure a MongoDB Replica Set on Ubuntu 20.04 | DigitalOceanThe\npractice of synchronizing data across multiple separate databases is called\nreplication. In MongoDB, a group of servers that maintain the same data set\nthrough replication are referred to as a replica set. This tutorial provides a\nbrief overview of how replication works in MongoDB before outlini…DigitalOcean\nMark Drake\n[https://www.digitalocean.com/community/tutorials/how-to-configure-a-mongodb-replica-set-on-ubuntu-20-04]","feature_image":"__GHOST_URL__/content/images/2023/03/bg-mongo-fedora-1.png","featured":0,"type":"post","status":"published","locale":null,"visibility":"public","email_recipient_filter":"all","created_at":"2023-03-02T05:09:29.000Z","updated_at":"2023-03-02T05:57:46.000Z","published_at":"2023-03-02T05:53:26.000Z","custom_excerpt":"Mongodb 6 installation on Fedora Linux 37. Article shows lacking fragment of official docs and two steps after installation that are presented in extremely simple way in comparison to other sources.","codeinjection_head":null,"codeinjection_foot":null,"custom_template":null,"canonical_url":null,"newsletter_id":null,"lexical":null},{"id":"640936aabbda300a2f29d56c","uuid":"0e9897c7-d8b4-4318-bf54-8a7daed45bb1","title":"tRPC - super fast development cycle for fullstack typescript apps","slug":"trpc","mobiledoc":"{\"version\":\"0.3.1\",\"atoms\":[[\"soft-return\",\"\",{}],[\"soft-return\",\"\",{}],[\"soft-return\",\"\",{}],[\"soft-return\",\"\",{}],[\"soft-return\",\"\",{}],[\"soft-return\",\"\",{}],[\"soft-return\",\"\",{}]],\"cards\":[[\"code\",{\"code\":\"import {initTRPC} from '@trpc/server';\\nimport {createHTTPServer} from '@trpc/server/adapters/standalone';\\nimport {z} from 'zod'\\n\\nexport type AppRouter = typeof appRouter;\\n\\nconst t = initTRPC.create();\\n\\nconst publicProcedure = t.procedure;\\nconst router = t.router;\\n\\nconst appRouter = router({\\n    greet: publicProcedure\\n        .input(z.string())\\n        .query(({input}) => ({greeting: `hello, ${input}!`})),\\n});\\n\\ncreateHTTPServer({\\n    router: appRouter,\\n}).listen(2022);\\n\",\"language\":\"typescript\"}],[\"code\",{\"code\":\"import { createTRPCProxyClient, httpBatchLink } from '@trpc/client';\\nimport type { AppRouter } from '../server';\\n\\nconst client = createTRPCProxyClient<AppRouter>({\\n  links: [\\n    httpBatchLink({\\n      url: 'http://localhost:2022',\\n    }),\\n  ],\\n});\\n\\nasync function main() {\\n  const result = await client.greet.query('tRPC');\\n\\n  // Type safe\\n  console.log(result.greeting.toUpperCase());\\n}\\n\\nvoid main();\",\"language\":\"typescript\"}],[\"code\",{\"code\":\"import {inferAsyncReturnType} from '@trpc/server';\\nimport {CreateNextContextOptions} from '@trpc/server/adapters/next';\\n\\nexport async function createContext({req}: CreateNextContextOptions) {\\n    return {\\n        auth: req.headers.authorization === 'ABC'\\n    };\\n}\\n\\nexport type Context = inferAsyncReturnType<typeof createContext>;\\n\",\"language\":\"typescript\"}],[\"code\",{\"code\":\"const t = initTRPC.create();\",\"language\":\"typescript\"}],[\"code\",{\"code\":\"import type { Context } from './context';\\nexport const t = initTRPC.context<Context>().create();\\n\",\"language\":\"typescript\"}],[\"code\",{\"code\":\"createHTTPServer({\\n    router: appRouter,\\n}).listen(2022);\",\"language\":\"typescript\"}],[\"code\",{\"code\":\"import {createContext} from \\\"./context\\\";\\n\\ncreateHTTPServer({\\n    router: appRouter,\\n    createContext\\n}).listen(2022);\",\"language\":\"typescript\"}],[\"code\",{\"code\":\"secret: t.procedure.query(({ ctx }) => {\\n    if (!ctx.auth) {\\n      throw new TRPCError({ code: 'UNAUTHORIZED' });\\n    }\\n    return {\\n      secret: 'sauce',\\n    };\\n  }),\",\"language\":\"typescript\"}],[\"code\",{\"code\":\"const isAuthed = t.middleware(({ next, ctx }) => {\\n    if (!ctx.auth) {\\n        throw new TRPCError({ code: 'UNAUTHORIZED' });\\n    }\\n    return next({\\n        ctx: {\\n            auth: ctx.auth\\n        }\\n    });\\n});\\nconst protectedProcedure = t.procedure.use(isAuthed);\\n\",\"language\":\"typescript\"}],[\"code\",{\"code\":\"secret: protectedProcedure.mutation(() => \\\"access granted\\\")\",\"language\":\"typescript\"}],[\"code\",{\"code\":\"  const unauthorizedError = await client.secret.mutate();\\n  console.log(unauthorizedError);\",\"language\":\"typescript\"}],[\"image\",{\"src\":\"__GHOST_URL__/content/images/2023/03/Zrzut-ekranu-z-2023-03-09-11-28-06.png\",\"width\":905,\"height\":392}],[\"code\",{\"code\":\"const client = createTRPCProxyClient<AppRouter>({\\n  links: [\\n    httpBatchLink({\\n      url: 'http://localhost:2022',\\n      headers: {\\n        Authorization: 'ABC'\\n      }\\n    }),\\n  ],\\n});\",\"language\":\"typescript\"}],[\"code\",{\"code\":\"const headers: Map<string, string> = new Map<string, string>();\\n\\nconst client = createTRPCProxyClient<AppRouter>({\\n  links: [\\n    httpBatchLink({\\n      url: 'http://localhost:2022',\\n      headers: () => Object.fromEntries(headers)\\n    }),\\n  ],\\n});\",\"language\":\"typescript\"}],[\"code\",{\"code\":\"headers.set('Authorization', 'ABC');\",\"language\":\"typescript\"}],[\"code\",{\"code\":\"npm i ws\\nnpm i -D @types/ws\",\"language\":\"bash\"}],[\"code\",{\"code\":\"time: publicProcedure.subscription(() => {\\n        return observable<Date>((emit) => {\\n            // logic that will execute on subscription start\\n            const interval = setInterval(() => emit.next(new Date()), 1000);\\n            // function to clean up and close interval after end of connection\\n            return () => {\\n                clearInterval(interval);\\n            }\\n        })\\n    })\",\"language\":\"typescript\"}],[\"code\",{\"code\":\"const wss = new ws.Server({\\n    port: 3001,\\n});\\nconst handler = applyWSSHandler({ wss, router: appRouter, createContext });\\nwss.on('connection', (ws) => {\\n    console.log(`➕➕ Connection (${wss.clients.size})`);\\n    ws.once('close', () => {\\n        console.log(`➖➖ Connection (${wss.clients.size})`);\\n    });\\n});\\nconsole.log('✅ WebSocket Server listening on ws://localhost:3001');\\nprocess.on('SIGTERM', () => {\\n    console.log('SIGTERM');\\n    handler.broadcastReconnectNotification();\\n    wss.close();\\n});\"}],[\"image\",{\"src\":\"__GHOST_URL__/content/images/2023/03/Zrzut-ekranu-z-2023-03-09-12-11-56.png\",\"width\":1030,\"height\":536}],[\"code\",{\"code\":\"{\\n  id: number | string;\\n  jsonrpc?: '2.0';\\n  method: 'subscription';\\n  params: {\\n    path: string;\\n    input?: unknown; // <-- pass input of procedure, serialized by transformer\\n  };\\n}\",\"language\":\"json\"}],[\"code\",{\"code\":\"ReferenceError: WebSocket is not defined\",\"language\":\"typescript\"}],[\"image\",{\"src\":\"__GHOST_URL__/content/images/2023/03/feature-tree.gif\",\"width\":240,\"height\":240}],[\"code\",{\"code\":\"npm i ws\\nnpm i -D @types/ws\",\"language\":\"bash\"}],[\"code\",{\"code\":\"const WebSocket = require('ws');\\nconst wsClient = createWSClient({\\n    url: `ws://localhost:3001`,\\n    WebSocket: WebSocket,\\n});\",\"language\":\"typescript\"}],[\"code\",{\"code\":\"const client = createTRPCProxyClient<AppRouter>({\\n    links: [\\n        wsLink({\\n            client: wsClient\\n        }),\\n    ],\\n});\",\"language\":\"typescript\"}],[\"code\",{\"code\":\"    client.time.subscribe(undefined, {\\n        onData: (time) => {\\n            console.log(time)\\n        }\\n    })\",\"language\":\"typescript\"}],[\"code\",{\"code\":\"await client.secret.mutate();\",\"language\":\"typescript\"}],[\"image\",{\"src\":\"__GHOST_URL__/content/images/2023/03/cat-jump.gif\",\"width\":640,\"height\":358}],[\"bookmark\",{\"type\":\"bookmark\",\"url\":\"https://www.rfc-editor.org/rfc/rfc6455\",\"metadata\":{\"url\":\"https://www.rfc-editor.org/rfc/rfc6455\",\"title\":\"RFC 6455: The WebSocket Protocol\",\"description\":null,\"author\":null,\"publisher\":null,\"thumbnail\":null,\"icon\":null}}],[\"code\",{\"code\":\"const client = createTRPCProxyClient<AppRouter>({\\n    links: [\\n        splitLink({\\n            condition: (op) => op.type === 'subscription',\\n            true:         wsLink({\\n                client: wsClient\\n            }),\\n            false: httpBatchLink({\\n                url: 'http://localhost:2022',\\n                headers: () => Object.fromEntries(headers)\\n            }),\\n        }),\\n    ],\\n});\",\"language\":\"typescript\"}],[\"bookmark\",{\"type\":\"bookmark\",\"url\":\"https://github.com/trpc/trpc/issues/3955\",\"metadata\":{\"url\":\"https://github.com/trpc/trpc/issues/3955\",\"title\":\"feat: Authentication by Websocket · Issue #3955 · trpc/trpc\",\"description\":\"Describe the feature you&#39;d like to request We know that websocket do not use http headers, but during handshake http request can be used. Page 14 RFC 6455 https://www.rfc-editor.org/rfc/rfc6455...\",\"author\":\"trpc\",\"publisher\":\"GitHub\",\"thumbnail\":\"https://opengraph.githubassets.com/245c8d56d539e6bec21e39215f9318407443a354cbf11938002a07a2466cf411/trpc/trpc/issues/3955\",\"icon\":\"https://github.githubassets.com/favicons/favicon.svg\"}}],[\"bookmark\",{\"type\":\"bookmark\",\"url\":\"https://stackoverflow.com/questions/4361173/http-headers-in-websockets-client-api\",\"metadata\":{\"url\":\"https://stackoverflow.com/questions/4361173/http-headers-in-websockets-client-api\",\"title\":\"HTTP headers in Websockets client API\",\"description\":\"Looks like it’s easy to add custom HTTP headers to your websocket client with any HTTP header client which supports this, but I can’t find how to do it with the web platform’s WebSocket API.\\nAnyone...\",\"author\":\"Julien Genestoux\",\"publisher\":\"Stack Overflow\",\"thumbnail\":\"https://cdn.sstatic.net/Sites/stackoverflow/Img/apple-touch-icon@2.png?v=73d79a89bded\",\"icon\":\"https://cdn.sstatic.net/Sites/stackoverflow/Img/apple-touch-icon.png?v=c78bd457575a\"}}],[\"bookmark\",{\"type\":\"bookmark\",\"url\":\"https://github.com/websockets/ws\",\"metadata\":{\"url\":\"https://github.com/websockets/ws\",\"title\":\"GitHub - websockets/ws: Simple to use, blazing fast and thoroughly tested WebSocket client and server for Node.js\",\"description\":\"Simple to use, blazing fast and thoroughly tested WebSocket client and server for Node.js - GitHub - websockets/ws: Simple to use, blazing fast and thoroughly tested WebSocket client and server for...\",\"author\":\"websockets\",\"publisher\":\"GitHub\",\"thumbnail\":\"https://opengraph.githubassets.com/45c5a7f253c0db2b0bc8e3b601909e0a559e4afec84d93eb8c4362b6c8d91cde/websockets/ws\",\"icon\":\"https://github.githubassets.com/favicons/favicon.svg\"}}],[\"bookmark\",{\"type\":\"bookmark\",\"url\":\"https://github.com/trpc/trpc/blob/main/packages/client/src/links/wsLink.ts#L130-L134\",\"metadata\":{\"url\":\"https://github.com/trpc/trpc\",\"title\":\"trpc/wsLink.ts at main · trpc/trpc\",\"description\":\"?‍♀️ Move Fast and Break Nothing. End-to-end typesafe APIs made easy. - trpc/wsLink.ts at main · trpc/trpc\",\"author\":\"trpc\",\"publisher\":\"GitHub\",\"thumbnail\":\"https://opengraph.githubassets.com/46dc3f4fb4cf1a9ce850ef9e15930924d82409ed120557c20505a8f244f5fc43/trpc/trpc\",\"icon\":\"https://github.githubassets.com/favicons/favicon.svg\"}}],[\"image\",{\"src\":\"__GHOST_URL__/content/images/2023/03/Zrzut-ekranu-z-2023-03-09-14-46-55.png\",\"width\":481,\"height\":113}],[\"bookmark\",{\"type\":\"bookmark\",\"url\":\"https://github.com/websockets/ws/blob/master/lib/websocket.js#L717-L723\",\"metadata\":{\"url\":\"https://github.com/websockets/ws\",\"title\":\"ws/websocket.js at master · websockets/ws\",\"description\":\"Simple to use, blazing fast and thoroughly tested WebSocket client and server for Node.js - ws/websocket.js at master · websockets/ws\",\"author\":\"websockets\",\"publisher\":\"GitHub\",\"thumbnail\":\"https://opengraph.githubassets.com/45c5a7f253c0db2b0bc8e3b601909e0a559e4afec84d93eb8c4362b6c8d91cde/websockets/ws\",\"icon\":\"https://github.githubassets.com/favicons/favicon.svg\"}}],[\"image\",{\"src\":\"__GHOST_URL__/content/images/2023/03/image.png\",\"width\":478,\"height\":159}],[\"image\",{\"src\":\"__GHOST_URL__/content/images/2023/03/meme1.gif\",\"width\":520,\"height\":292}],[\"code\",{\"code\":\"const WebSocket = require('ws');\\n\\nconst WebSocketProxy = new Proxy(WebSocket, {\\n    construct(target, args) {\\n        return new target(args[0], undefined, {\\n            headers: Object.fromEntries(headers)\\n        });\\n    }\\n})\",\"caption\":\"\",\"language\":\"typescript\"}],[\"code\",{\"code\":\"const headers: Map<string, string> = new Map<string, string>();\",\"language\":\"typescript\"}],[\"code\",{\"code\":\"headers.set('Authorization', 'ABC');\",\"language\":\"typescript\"}],[\"code\",{\"code\":\"const wsClient = createWSClient({\\n    url: `ws://localhost:3001`,\\n    WebSocket: WebSocketProxy,\\n});\",\"language\":\"typescript\"}],[\"code\",{\"code\":\"const client = createTRPCProxyClient<AppRouter>({\\n    links: [\\n        wsLink({\\n            client: wsClient\\n        }),\\n    ],\\n});\",\"language\":\"typescript\"}],[\"code\",{\"code\":\"const client = createTRPCProxyClient<AppRouter>({\\n    links: [\\n        splitLink({\\n            condition: (op) => op.type === 'subscription',\\n            true: wsLink({\\n                client: wsClient\\n            }),\\n            false: httpBatchLink({\\n                url: 'http://localhost:2022',\\n                headers: () => Object.fromEntries(headers)\\n            }),\\n        }),\\n    ],\\n});\",\"language\":\"typescript\"}],[\"code\",{\"code\":\"time: publicProcedure.subscription(({ctx}) => {\\n        return observable<{ date: Date, auth: boolean }>((emit) => {\\n            // logic that will execute on subscription start\\n            const interval = setInterval(() => emit.next({date: new Date(), auth: ctx.auth}), 1000);\\n            // function to clean up and close interval after end of connection\\n            return () => {\\n                clearInterval(interval);\\n            }\\n        })\\n    })\",\"language\":\"typescript\"}],[\"code\",{\"code\":\"async function main() {\\n    const result = await client.greet.query('tRPC');\\n    console.log(result.greeting.toUpperCase());\\n\\n    const secret = await client.secret.mutate();\\n    console.log(secret);\\n\\n    client.time.subscribe(undefined, {\\n        onData: ({auth, date}) => {\\n            console.log(`I am ${auth ? 'auth' : 'not auth'} at ${date}`)\\n        }\\n    })\\n}\",\"language\":\"typescript\"}],[\"image\",{\"src\":\"__GHOST_URL__/content/images/2023/03/Zrzut-ekranu-z-2023-03-09-15-59-26.png\",\"width\":478,\"height\":159}],[\"code\",{\"code\":\"import crypto from 'crypto';\\nconst id = crypto.randomBytes(16).toString('hex')\\nheaders.set('sec-websocket-id', id);\\n\",\"language\":\"typescript\"}],[\"code\",{\"code\":\"import {inferAsyncReturnType} from '@trpc/server';\\nimport {CreateNextContextOptions} from '@trpc/server/adapters/next';\\n\\nconst authState = new Map<string, boolean>();\\n\\nexport async function createContext({req}: CreateNextContextOptions) {\\n    console.log(req.headers);\\n    const auth = req.headers.authorization === 'ABC';\\n    const id = req.headers['sec-websocket-id'];\\n\\n    authState.set(id, auth);\\n\\n    return {\\n        auth: () => authState.get(id) ?? false,\\n        id\\n    };\\n}\\n\\nexport type Context = inferAsyncReturnType<typeof createContext>;\\n\",\"language\":\"typescript\"}],[\"code\",{\"code\":\"const isAuthed = t.middleware(({next, ctx}) => {\\n    if (!ctx.auth()) {\\n        throw new TRPCError({code: 'UNAUTHORIZED'});\\n    }\\n    return next({\\n        ctx: {\\n            auth: ctx.auth\\n        }\\n    });\\n});\",\"language\":\"typescript\"}],[\"code\",{\"code\":\"const interval = setInterval(() => emit.next({date: new Date(), auth: ctx.auth()}), 1000);\\n\",\"language\":\"typescript\"}],[\"code\",{\"code\":\"async function main() {\\n    const result = await client.greet.query('tRPC');\\n    console.log(result.greeting.toUpperCase());\\n    \\n    setTimeout(async () => {\\n        headers.set('Authorization', 'ABC');\\n\\n        const secret = await client.secret.mutate();\\n        console.log(secret);\\n    }, 2000)\\n\\n\\n    client.time.subscribe(undefined, {\\n        onData: (ctx) => {\\n            console.log(`I am ${ctx.auth ? 'auth' : 'not auth'} at ${ctx.date}`)\\n        }\\n    })\\n}\",\"language\":\"typescript\"}],[\"image\",{\"src\":\"__GHOST_URL__/content/images/2023/03/Zrzut-ekranu-z-2023-03-09-16-58-02.png\",\"width\":478,\"height\":159}],[\"code\",{\"code\":\"    time: publicProcedure.input(\\n        z.object({\\n            token: z.string(),\\n        }),\\n    ).subscription(({ctx, input}) => {\\n        return observable<{ date: Date, ctx_auth: boolean, input_auth: boolean }>((emit) => {\\n            // logic that will execute on subscription start\\n            const interval = setInterval(() => emit.next({\\n                date: new Date(),\\n                ctx_auth: ctx.auth(),\\n                input_auth: input.token === 'ABC'\\n            }), 1000);\\n            // function to clean up and close interval after end of connection\\n            return () => {\\n                clearInterval(interval);\\n            }\\n        })\\n    })\",\"language\":\"typescript\"}],[\"code\",{\"code\":\"    client.time.subscribe({token: 'ABC'}, {\\n        onData: (ctx) => {\\n            console.log(`I am ${ctx.input_auth ? 'auth' : 'not auth'} at ${ctx.date}`)\\n        }\\n    })\",\"language\":\"typescript\"}],[\"image\",{\"src\":\"__GHOST_URL__/content/images/2023/03/68747470733a2f2f6170692e737461722d686973746f72792e636f6d2f7376673f7265706f733d747270632f7472706326747970653d44617465.svg\",\"width\":800,\"height\":533}]],\"markups\":[[\"code\"],[\"a\",[\"href\",\"https://github.com/websockets/ws/pull/2125\"]],[\"a\",[\"href\",\"https://www.reddit.com/r/node/comments/117fgb5/trpc_correct_way_to_authorize_websocket/\"]]],\"sections\":[[1,\"p\",[[0,[],0,\"I learned tRPC today and fall in love ❤️ instantly deciding to rewrite project that I currently developing to this framework.\"],[1,[],0,0],[1,[],0,1],[0,[],0,\"In short words what it is:\"],[1,[],0,2],[0,[],0,\"1. You can develop schema like in gRPC\"],[1,[],0,3],[0,[],0,\"2. But you are only constrain to typescript (rust support in progress)\"],[1,[],0,4],[0,[],0,\"3. Instead of protobuf that is hard to read/debug you have lightweight types generated from your validators (like zod) and resolvers\"],[1,[],0,5],[1,[],0,6],[0,[],0,\"Finally you obtaining fastest fullstack development cycle that I ever seen and I can compare it only with ruby on rails.\"]]],[1,\"h2\",[[0,[],0,\"Minimal example of tRPC with query by http\"]]],[1,\"p\",[[0,[],0,\"Let me show you minimal project using this stack.\"]]],[1,\"p\",[[0,[],0,\"We will start from 2 folders:\"]]],[3,\"ul\",[[[0,[],0,\"client\"]],[[0,[],0,\"server\"]]]],[1,\"p\",[[0,[],0,\"I \"],[0,[0],1,\"client\"],[0,[],0,\" we have to install \"],[0,[0],1,\"@trpc/client\"],[0,[],0,\" and in \"],[0,[0],1,\"server\"],[0,[],0,\" we installing \"],[0,[0],1,\"@trpc/server\"],[0,[],0,\" and \"],[0,[0],1,\"zod\"],[0,[],0,\".\"]]],[1,\"p\",[[0,[],0,\" In \"],[0,[0],1,\"server/index.ts\"],[0,[],0,\" we creating server with schema generated from our code\"]]],[10,0],[1,\"p\",[[0,[],0,\"Look at \"],[0,[0],1,\"export type AppRouter\"],[0,[],0,\" this line is responsible for exporting schema for client. Few lines later we defining all routes using \"],[0,[0],1,\"router\"],[0,[],0,\" function.\"]]],[1,\"p\",[[0,[],0,\"There is not only \"],[0,[0],1,\"query\"],[0,[],0,\", but also \"],[0,[0],1,\"mutation\"],[0,[],0,\" and \"],[0,[0],1,\"subscription\"],[0,[],0,\". But in our example we have to show minimal starter so lets see client code.\"]]],[10,1],[1,\"p\",[[0,[],0,\"Here is import of \"],[0,[0],1,\"AppRouter\"],[0,[],0,\" and we using it as generic type to create \"],[0,[0],1,\"client\"],[0,[],0,\". So all of:\"]]],[3,\"ul\",[[[0,[],0,\"client methods\"]],[[0,[],0,\"methods arguments\"]],[[0,[],0,\"methods outputs\"]]]],[1,\"p\",[[0,[],0,\"have strong typing.\"]]],[1,\"h2\",[[0,[],0,\"Authentication with tRPC\"]]],[1,\"p\",[[0,[],0,\"Lets add mutation that can be done only by admin. To simplify we will skip jwt / login / register and will consider situation when client can send \"],[0,[0],1,\"Authorization\"],[0,[],0,\" header with \"],[0,[0],1,\"ABC\"],[0,[],0,\" to authorize him.\"]]],[1,\"p\",[[0,[],0,\"So in this part you will learn how to add authorization, middlewares and mutations.\"]]],[1,\"p\",[[0,[],0,\"Lets create \"],[0,[0],1,\"context.ts\"],[0,[],0,\" in \"],[0,[0],1,\"server\"]]],[10,2],[1,\"p\",[[0,[],0,\"Now we can change\"]]],[10,3],[1,\"p\",[[0,[],0,\"to\"]]],[10,4],[1,\"p\",[[0,[],0,\"Now we expect that in \"],[0,[0],1,\"context\"],[0,[],0,\" we will be able to check if user is authorized.\"]]],[1,\"p\",[[0,[],0,\"You have to also add \"],[0,[0],1,\"createContext\"],[0,[],0,\" to \"],[0,[0],1,\"createHTTPServer\"],[0,[],0,\" options, so change:\"]]],[10,5],[1,\"p\",[[0,[],0,\"to\"]]],[10,6],[1,\"p\",[[0,[],0,\"Now we have 2 options. We can check \"],[0,[0],1,\"auth\"],[0,[],0,\" in resolver\"]]],[10,7],[1,\"p\",[[0,[],0,\"but better approach is probably adding this check to middleware called \"],[0,[0],1,\"protectedProcedure\"],[0,[],0,\".\"]]],[1,\"p\",[[0,[],0,\"It is a little more code, but give us some advantages\"]]],[10,8],[1,\"p\",[[0,[],0,\"Firstly we can redefine our context, eg finding user in database and converting id in token to full set of user parameters. Additionally we can reuse \"],[0,[0],1,\"protectedProcedure\"],[0,[],0,\" in all places without repetition of this check every time.\"]]],[1,\"p\",[[0,[],0,\"Now there is last final step in server: adding new route to \"],[0,[0],1,\"router\"],[0,[],0,\" argument keys\"]]],[10,9],[1,\"p\",[[0,[],0,\"In client we can use it in following way:\"]]],[10,10],[1,\"p\",[[0,[],0,\"and we will see a beautiful unauthorized error like this\"]]],[10,11],[1,\"p\",[[0,[],0,\"To be authorized we can add headers in client definition\"]]],[10,12],[1,\"p\",[[0,[],0,\"If I would left it in that form I have to recreate client with new headers on every headers change. Fortunately this simple form can be enhanced and we can write this way:\"]]],[10,13],[1,\"p\",[[0,[],0,\"and decide about shape of headers dynamically on runtime, eg setting \"],[0,[0],1,\"Authorization\"],[0,[],0,\" by\"]]],[10,14],[1,\"h2\",[[0,[],0,\"Time to real time with tRPC subscriptions\"]]],[1,\"p\",[[0,[],0,\"In \"],[0,[0],1,\"server\"],[0,[],0,\" we installing \"],[0,[0],1,\"ws\"],[0,[],0,\".\"]]],[10,15],[1,\"p\",[[0,[],0,\"To \"],[0,[0],1,\"router\"],[0,[],0,\" we can add new subscription that will give us time every second\"]]],[10,16],[1,\"p\",[[0,[],0,\"Now we have to open \"],[0,[0],1,\"websocket\"],[0,[],0,\" server so let's add it using code:\"]]],[10,17],[1,\"p\",[[0,[],0,\"I checked in \"],[0,[0],1,\"insomia\"],[0,[],0,\" that I can connect\"]]],[10,18],[1,\"p\",[[0,[],0,\"In payload I used object with shape described in \"],[0,[0],1,\"jsonrpc\"],[0,[],0,\" spec\"]]],[10,19],[1,\"p\",[[0,[],0,\"So let's connect our client in typescript now.\"]]],[1,\"p\",[[0,[],0,\"Following after official docs you will see error\"]]],[10,20],[1,\"p\",[[0,[],0,\"because \"],[0,[0],1,\"createWSClient\"],[0,[],0,\" assume that operate in browser, but we are using node client in this example.\"]]],[10,21],[1,\"p\",[[0,[],0,\"To fix it we have to install \"],[0,[0],1,\"ws\"],[0,[],0,\" and assign it to \"],[0,[0],1,\"global\"],[0,[],0,\" scope but if your client live in browser you can skip this step.\"]]],[10,22],[1,\"p\",[[0,[],0,\"Now you can create \"],[0,[0],1,\"wsClient\"]]],[10,23],[1,\"p\",[[0,[],0,\"use it wrapping in link\"]]],[10,24],[1,\"p\",[[0,[],0,\"and finally subscribe to see series of Dates\"]]],[10,25],[1,\"p\",[[0,[],0,\"Unfortunately you have to remove our secret mutation\"]]],[10,26],[1,\"p\",[[0,[],0,\"to make it working.\"]]],[10,27],[1,\"h2\",[[0,[],0,\"Lacking docs - websocket authentication in tRPC\"]]],[1,\"p\",[[0,[],0,\"Now we facing issue of providing authentication to websocket, but you probably know that pure websockets do not support http headers. You can pass them on handshake http request that will upgrade protocol to websocket. Details are described in RFC 6455\"]]],[10,28],[1,\"p\",[[0,[],0,\"In more mature projects like apollo server you can see that upgrade request is used to pass authentication info, but unfortunately now tRPC do not support it.\"]]],[1,\"p\",[[0,[],0,\"Anyway can split you split your client to http and websocket parts.\"]]],[10,29],[1,\"p\",[[0,[],0,\"Probably most of operations will be http operations, so you can use mechanism with authentication described earlier for queries and mutations. In case of websocket you can use payload to pass token now or use trick taht I describe below. \"]]],[1,\"p\",[[0,[],0,\"To give you more context there is open issue:\"]]],[10,30],[1,\"p\",[[0,[],0,\"Interesting but misleading topic on stackoverflow\"]]],[10,31],[1,\"p\",[[0,[],0,\"Answer with most votes is wrong, because not taking into account handshake. And \"],[0,[0],1,\"ws\"],[0,[],0,\" implements it as third arguments, but you can't find it in official README.md\"]]],[10,32],[1,\"p\",[[0,[],0,\"In \"],[0,[0],1,\"trpc\"],[0,[],0,\" code this third argument is skipped\"]]],[10,33],[10,34],[1,\"p\",[[0,[],0,\"You cannot also use \"],[0,[0],1,\"Sec-WebSocket-Key\"],[0,[],0,\" because \"],[0,[0],1,\"ws\"],[0,[],0,\" override it by random hash.\"]]],[10,35],[10,36],[1,\"p\",[[0,[],0,\"and loosing \"],[0,[0],1,\"trpc\"],[0,[],0,\" loose this information.\"]]],[1,\"p\",[[0,[],0,\"There are three approaches to solve this problem.\"]]],[3,\"ul\",[[[0,[],0,\"pass auth header to handshake ( easy, but constraint and not practical )\"]],[[0,[],0,\"build Map between connection ids and these tokens on server ( has flaws but works )\"]],[[0,[],0,\"passing token to any subscription in payload ( less elegant but more scalable )\"]]]],[10,37],[1,\"h3\",[[0,[],0,\"Scenario 1: We know auth token before client is created\"]]],[1,\"p\",[[0,[],0,\"This is scenario that is extremely easy to implement, but not practical. I am presenting it only because it not require changes on backend and will be our proof of concept that we will use to improve in next step.\"]]],[1,\"p\",[[0,[],0,\"Lets build your Proxy that will add headers anyway.\"]]],[10,38],[1,\"p\",[[0,[],0,\"This object will use headers defined earlier as a map in part about authorization\"]]],[10,39],[1,\"p\",[[0,[0],1,\"args[0]\"],[0,[],0,\" will be your server url, and undefined is for protocol, you do not have to worry about it. It was undefined/skipped anyway.\"]]],[1,\"p\",[[0,[],0,\"But we have to set header by\"]]],[10,40],[1,\"p\",[[0,[],0,\"before call of \"],[0,[0],1,\"createWSClient\"],[0,[],0,\".\"]]],[1,\"p\",[[0,[],0,\"Now you can use \"],[0,[0],1,\"WebSocketProxy\"],[0,[],0,\" instead of original \"],[0,[0],1,\"Websocket\"],[0,[],0,\" implementation \"]]],[10,41],[1,\"p\",[[0,[],0,\"Client can have only wsLink\"]]],[10,42],[1,\"p\",[[0,[],0,\"Or be splitted to http and websocket parts\"]]],[10,43],[1,\"p\",[[0,[],0,\"On server side we do not need changes, but we will do only one simple imprvement. We will return \"],[0,[0],1,\"auth\"],[0,[],0,\" state from \"],[0,[0],1,\"time\"],[0,[],0,\" subscription\"]]],[10,44],[1,\"p\",[[0,[],0,\"Now our client \"],[0,[0],1,\"main\"],[0,[],0,\" function will be following\"]]],[10,45],[1,\"p\",[[0,[],0,\"we should see that all requests works correctly and we have access to token on websocket context too.\"]]],[10,46],[1,\"p\",[[0,[],0,\"But in real use case you starting app as unauthenticated user, that will authenticate by http and then open websocket connections to operate over them.\"]]],[1,\"p\",[[0,[],0,\"tRPC define \"],[0,[0],1,\"tryReconnect\"],[0,[],0,\" function for \"],[0,[0],1,\"wsLink\"],[0,[],0,\" but do not expose it. Additionally it would be better to be able to authenticate without reconnection and special websocket endpoint dedicated to login.\"]]],[1,\"h3\",[[0,[],0,\"Scenario 2: We authenticating by http context and passing result to websocket context\"]]],[1,\"p\",[[0,[],0,\"Let's start from high level design.\"]]],[3,\"ol\",[[[0,[],0,\"We will setup our \"],[0,[0],1,\"sec-websocket-key\"],[0,[],0,\" that we are able to save and reuse on client\"]],[[0,[],0,\"We will setup map of these keys and these authentication states on client\"]],[[0,[],0,\"We will allow to modify this map using http requests with authorization headers\"]],[[0,[],0,\"We will see that on websocket subscription state of auth can be obtained using \"],[0,[0],1,\"keys\"]]]],[1,\"h4\",[[0,[],0,\"Setting header with client id\"]]],[1,\"p\",[[0,[],0,\"There is open \"],[0,[1],1,\"pr\"],[0,[],0,\" that will allow to override \"],[0,[0],1,\"sec-websocket-key\"],[0,[],0,\" but now, lets use different name. \"],[0,[0],1,\"sec-websocket-id\"],[0,[],0,\" seems to be great.\"]]],[1,\"p\",[[0,[],0,\"So when our client starting (eg user enter to our page url or in our case node process starts) we need to generate id. I will focus on \"],[0,[0],1,\"node\"],[0,[],0,\" implementation, so can use \"],[0,[0],1,\"crypto\"],[0,[],0,\".\"]]],[1,\"p\",[[0,[],0,\"Our new lines on client will be\"]]],[10,47],[1,\"p\",[[0,[],0,\"you have to set them before \"],[0,[0],1,\"const wsClient = createWSClient({\"],[0,[],0,\".\"]]],[1,\"h4\",[[0,[],0,\"Setting connections map on server\"]]],[1,\"p\",[[0,[],0,\"Crucial point is that we share \"],[0,[0],1,\"headers\"],[0,[],0,\" for \"],[0,[0],1,\"http\"],[0,[],0,\" and \"],[0,[0],1,\"websocket\"],[0,[],0,\" links. So in server  \"],[0,[0],1,\"createContext\"],[0,[],0,\" we expect to see this header for all types of requests - both standard http and http upgrade requests that will open websocket.\"]]],[1,\"p\",[[0,[],0,\"Our \"],[0,[0],1,\"context.ts\"],[0,[],0,\" can be rewritten in this way:\"]]],[10,48],[1,\"p\",[[0,[],0,\"so now, we are not checking auth state in current request, but last value saved in \"],[0,[0],1,\"Map\"],[0,[],0,\".\"]]],[1,\"p\",[[0,[],0,\"In our scenario there are the following events:\"]]],[3,\"ul\",[[[0,[],0,\"public query\"]],[[0,[],0,\"setting token\"]],[[0,[],0,\"private mutation <– here we setting auth to true\"]],[[0,[],0,\"websocket subscription <— here we are using state from map\"]]]],[1,\"p\",[[0,[],0,\"We need super small adjustments in two paces. In \"],[0,[0],1,\"isAuthed\"],[0,[],0,\" function we need call auth\"]]],[10,49],[1,\"p\",[[0,[],0,\"and in subscription we have to change \"],[0,[0],1,\"ctx.auth\"],[0,[],0,\" to \"],[0,[0],1,\"ctx.auth()\"],[0,[],0,\" too\"]]],[10,50],[1,\"h4\",[[0,[],0,\"Lets check if it works for client\"]]],[1,\"p\",[[0,[],0,\"To achieve more dramatic effect we can use \"],[0,[0],1,\"setTimeout\"],[0,[],0,\" to postpone authentication.\"]]],[1,\"p\",[[0,[],0,\"Our \"],[0,[0],1,\"main\"],[0,[],0,\" function now have a form\"]]],[10,51],[1,\"p\",[[0,[],0,\"and in console i see\"]]],[10,52],[1,\"h4\",[[0,[],0,\"Scenario 3: Passing token in subscription input\"]]],[1,\"p\",[[0,[],0,\"To cover problem completely I am presenting third last approach - passing token in payload to subscription, instead of to handshake requests. We can modify our \"],[0,[0],1,\"time\"]]],[10,53],[1,\"p\",[[0,[],0,\"and on client side\"]]],[10,54],[1,\"h2\",[[0,[],0,\"Recommended improvements\"]]],[1,\"p\",[[0,[],0,\"If you are user of grpc and simiarry to \"],[0,[0],1,\"Funwithloops\"],[0,[],0,\" from this reddit topic:\"]]],[1,\"p\",[[0,[2],1,\"https://www.reddit.com/r/node/comments/117fgb5/trpc_correct_way_to_authorize_websocket/\"]]],[1,\"p\",[[0,[],0,\"think about websocket authentication. You should consider this blog post as sketch written by person that learned \"],[0,[0],1,\"tRPC\"],[0,[],0,\" few hours ago. On production environment you have to solve problem of sharing state saved in \"],[0,[0],1,\"authState\"],[0,[],0,\" between your backend instances. Probably you will need redis for it. Then you should set \"],[0,[0],1,\"TX\"],[0,[],0,\" parameters to not persist these keys infinitely. We forgot about logout endpoint.\"]]],[1,\"p\",[[0,[],0,\"Redis to manage authentication decrease performance in comparison to pure \"],[0,[0],1,\"jwt\"],[0,[],0,\" so maybe better design would be append authentication to your subscription input, that on the other hand is less readable and require more boilerplate.\"]]],[1,\"p\",[[0,[],0,\"You should be aware that \"],[0,[0],1,\"trpc\"],[0,[],0,\" do not implement \"],[0,[0],1,\"lazy\"],[0,[],0,\" option for websocket client that is available in apollo and would simplify our first scenario that I described here.\"]]],[1,\"p\",[[0,[],0,\"This technology is super hot, but still in phase of development and this article can be outdated soon.\"]]],[10,55],[1,\"p\",[[0,[],0,\"If you are one of \"],[0,[0],1,\"trpc\"],[0,[],0,\" maintainers, you can use concepts presented here in official docs or suggest me better approach to websocket auth in comments section.\"]]]],\"ghostVersion\":\"4.0\"}","html":"<p>I learned tRPC today and fall in love ❤️ instantly deciding to rewrite project that I currently developing to this framework.<br><br>In short words what it is:<br>1. You can develop schema like in gRPC<br>2. But you are only constrain to typescript (rust support in progress)<br>3. Instead of protobuf that is hard to read/debug you have lightweight types generated from your validators (like zod) and resolvers<br><br>Finally you obtaining fastest fullstack development cycle that I ever seen and I can compare it only with ruby on rails.</p><h2 id=\"minimal-example-of-trpc-with-query-by-http\">Minimal example of tRPC with query by http</h2><p>Let me show you minimal project using this stack.</p><p>We will start from 2 folders:</p><ul><li>client</li><li>server</li></ul><p>I <code>client</code> we have to install <code>@trpc/client</code> and in <code>server</code> we installing <code>@trpc/server</code> and <code>zod</code>.</p><p> In <code>server/index.ts</code> we creating server with schema generated from our code</p><pre><code class=\"language-typescript\">import {initTRPC} from '@trpc/server';\nimport {createHTTPServer} from '@trpc/server/adapters/standalone';\nimport {z} from 'zod'\n\nexport type AppRouter = typeof appRouter;\n\nconst t = initTRPC.create();\n\nconst publicProcedure = t.procedure;\nconst router = t.router;\n\nconst appRouter = router({\n    greet: publicProcedure\n        .input(z.string())\n        .query(({input}) =&gt; ({greeting: `hello, ${input}!`})),\n});\n\ncreateHTTPServer({\n    router: appRouter,\n}).listen(2022);\n</code></pre><p>Look at <code>export type AppRouter</code> this line is responsible for exporting schema for client. Few lines later we defining all routes using <code>router</code> function.</p><p>There is not only <code>query</code>, but also <code>mutation</code> and <code>subscription</code>. But in our example we have to show minimal starter so lets see client code.</p><pre><code class=\"language-typescript\">import { createTRPCProxyClient, httpBatchLink } from '@trpc/client';\nimport type { AppRouter } from '../server';\n\nconst client = createTRPCProxyClient&lt;AppRouter&gt;({\n  links: [\n    httpBatchLink({\n      url: 'http://localhost:2022',\n    }),\n  ],\n});\n\nasync function main() {\n  const result = await client.greet.query('tRPC');\n\n  // Type safe\n  console.log(result.greeting.toUpperCase());\n}\n\nvoid main();</code></pre><p>Here is import of <code>AppRouter</code> and we using it as generic type to create <code>client</code>. So all of:</p><ul><li>client methods</li><li>methods arguments</li><li>methods outputs</li></ul><p>have strong typing.</p><h2 id=\"authentication-with-trpc\">Authentication with tRPC</h2><p>Lets add mutation that can be done only by admin. To simplify we will skip jwt / login / register and will consider situation when client can send <code>Authorization</code> header with <code>ABC</code> to authorize him.</p><p>So in this part you will learn how to add authorization, middlewares and mutations.</p><p>Lets create <code>context.ts</code> in <code>server</code></p><pre><code class=\"language-typescript\">import {inferAsyncReturnType} from '@trpc/server';\nimport {CreateNextContextOptions} from '@trpc/server/adapters/next';\n\nexport async function createContext({req}: CreateNextContextOptions) {\n    return {\n        auth: req.headers.authorization === 'ABC'\n    };\n}\n\nexport type Context = inferAsyncReturnType&lt;typeof createContext&gt;;\n</code></pre><p>Now we can change</p><pre><code class=\"language-typescript\">const t = initTRPC.create();</code></pre><p>to</p><pre><code class=\"language-typescript\">import type { Context } from './context';\nexport const t = initTRPC.context&lt;Context&gt;().create();\n</code></pre><p>Now we expect that in <code>context</code> we will be able to check if user is authorized.</p><p>You have to also add <code>createContext</code> to <code>createHTTPServer</code> options, so change:</p><pre><code class=\"language-typescript\">createHTTPServer({\n    router: appRouter,\n}).listen(2022);</code></pre><p>to</p><pre><code class=\"language-typescript\">import {createContext} from \"./context\";\n\ncreateHTTPServer({\n    router: appRouter,\n    createContext\n}).listen(2022);</code></pre><p>Now we have 2 options. We can check <code>auth</code> in resolver</p><pre><code class=\"language-typescript\">secret: t.procedure.query(({ ctx }) =&gt; {\n    if (!ctx.auth) {\n      throw new TRPCError({ code: 'UNAUTHORIZED' });\n    }\n    return {\n      secret: 'sauce',\n    };\n  }),</code></pre><p>but better approach is probably adding this check to middleware called <code>protectedProcedure</code>.</p><p>It is a little more code, but give us some advantages</p><pre><code class=\"language-typescript\">const isAuthed = t.middleware(({ next, ctx }) =&gt; {\n    if (!ctx.auth) {\n        throw new TRPCError({ code: 'UNAUTHORIZED' });\n    }\n    return next({\n        ctx: {\n            auth: ctx.auth\n        }\n    });\n});\nconst protectedProcedure = t.procedure.use(isAuthed);\n</code></pre><p>Firstly we can redefine our context, eg finding user in database and converting id in token to full set of user parameters. Additionally we can reuse <code>protectedProcedure</code> in all places without repetition of this check every time.</p><p>Now there is last final step in server: adding new route to <code>router</code> argument keys</p><pre><code class=\"language-typescript\">secret: protectedProcedure.mutation(() =&gt; \"access granted\")</code></pre><p>In client we can use it in following way:</p><pre><code class=\"language-typescript\">  const unauthorizedError = await client.secret.mutate();\n  console.log(unauthorizedError);</code></pre><p>and we will see a beautiful unauthorized error like this</p><figure class=\"kg-card kg-image-card\"><img src=\"__GHOST_URL__/content/images/2023/03/Zrzut-ekranu-z-2023-03-09-11-28-06.png\" class=\"kg-image\" alt loading=\"lazy\" width=\"905\" height=\"392\" srcset=\"__GHOST_URL__/content/images/size/w600/2023/03/Zrzut-ekranu-z-2023-03-09-11-28-06.png 600w, __GHOST_URL__/content/images/2023/03/Zrzut-ekranu-z-2023-03-09-11-28-06.png 905w\" sizes=\"(min-width: 720px) 720px\"></figure><p>To be authorized we can add headers in client definition</p><pre><code class=\"language-typescript\">const client = createTRPCProxyClient&lt;AppRouter&gt;({\n  links: [\n    httpBatchLink({\n      url: 'http://localhost:2022',\n      headers: {\n        Authorization: 'ABC'\n      }\n    }),\n  ],\n});</code></pre><p>If I would left it in that form I have to recreate client with new headers on every headers change. Fortunately this simple form can be enhanced and we can write this way:</p><pre><code class=\"language-typescript\">const headers: Map&lt;string, string&gt; = new Map&lt;string, string&gt;();\n\nconst client = createTRPCProxyClient&lt;AppRouter&gt;({\n  links: [\n    httpBatchLink({\n      url: 'http://localhost:2022',\n      headers: () =&gt; Object.fromEntries(headers)\n    }),\n  ],\n});</code></pre><p>and decide about shape of headers dynamically on runtime, eg setting <code>Authorization</code> by</p><pre><code class=\"language-typescript\">headers.set('Authorization', 'ABC');</code></pre><h2 id=\"time-to-real-time-with-trpc-subscriptions\">Time to real time with tRPC subscriptions</h2><p>In <code>server</code> we installing <code>ws</code>.</p><pre><code class=\"language-bash\">npm i ws\nnpm i -D @types/ws</code></pre><p>To <code>router</code> we can add new subscription that will give us time every second</p><pre><code class=\"language-typescript\">time: publicProcedure.subscription(() =&gt; {\n        return observable&lt;Date&gt;((emit) =&gt; {\n            // logic that will execute on subscription start\n            const interval = setInterval(() =&gt; emit.next(new Date()), 1000);\n            // function to clean up and close interval after end of connection\n            return () =&gt; {\n                clearInterval(interval);\n            }\n        })\n    })</code></pre><p>Now we have to open <code>websocket</code> server so let's add it using code:</p><pre><code>const wss = new ws.Server({\n    port: 3001,\n});\nconst handler = applyWSSHandler({ wss, router: appRouter, createContext });\nwss.on('connection', (ws) =&gt; {\n    console.log(`➕➕ Connection (${wss.clients.size})`);\n    ws.once('close', () =&gt; {\n        console.log(`➖➖ Connection (${wss.clients.size})`);\n    });\n});\nconsole.log('✅ WebSocket Server listening on ws://localhost:3001');\nprocess.on('SIGTERM', () =&gt; {\n    console.log('SIGTERM');\n    handler.broadcastReconnectNotification();\n    wss.close();\n});</code></pre><p>I checked in <code>insomia</code> that I can connect</p><figure class=\"kg-card kg-image-card\"><img src=\"__GHOST_URL__/content/images/2023/03/Zrzut-ekranu-z-2023-03-09-12-11-56.png\" class=\"kg-image\" alt loading=\"lazy\" width=\"1030\" height=\"536\" srcset=\"__GHOST_URL__/content/images/size/w600/2023/03/Zrzut-ekranu-z-2023-03-09-12-11-56.png 600w, __GHOST_URL__/content/images/size/w1000/2023/03/Zrzut-ekranu-z-2023-03-09-12-11-56.png 1000w, __GHOST_URL__/content/images/2023/03/Zrzut-ekranu-z-2023-03-09-12-11-56.png 1030w\" sizes=\"(min-width: 720px) 720px\"></figure><p>In payload I used object with shape described in <code>jsonrpc</code> spec</p><pre><code class=\"language-json\">{\n  id: number | string;\n  jsonrpc?: '2.0';\n  method: 'subscription';\n  params: {\n    path: string;\n    input?: unknown; // &lt;-- pass input of procedure, serialized by transformer\n  };\n}</code></pre><p>So let's connect our client in typescript now.</p><p>Following after official docs you will see error</p><pre><code class=\"language-typescript\">ReferenceError: WebSocket is not defined</code></pre><p>because <code>createWSClient</code> assume that operate in browser, but we are using node client in this example.</p><figure class=\"kg-card kg-image-card\"><img src=\"__GHOST_URL__/content/images/2023/03/feature-tree.gif\" class=\"kg-image\" alt loading=\"lazy\" width=\"240\" height=\"240\"></figure><p>To fix it we have to install <code>ws</code> and assign it to <code>global</code> scope but if your client live in browser you can skip this step.</p><pre><code class=\"language-bash\">npm i ws\nnpm i -D @types/ws</code></pre><p>Now you can create <code>wsClient</code></p><pre><code class=\"language-typescript\">const WebSocket = require('ws');\nconst wsClient = createWSClient({\n    url: `ws://localhost:3001`,\n    WebSocket: WebSocket,\n});</code></pre><p>use it wrapping in link</p><pre><code class=\"language-typescript\">const client = createTRPCProxyClient&lt;AppRouter&gt;({\n    links: [\n        wsLink({\n            client: wsClient\n        }),\n    ],\n});</code></pre><p>and finally subscribe to see series of Dates</p><pre><code class=\"language-typescript\">    client.time.subscribe(undefined, {\n        onData: (time) =&gt; {\n            console.log(time)\n        }\n    })</code></pre><p>Unfortunately you have to remove our secret mutation</p><pre><code class=\"language-typescript\">await client.secret.mutate();</code></pre><p>to make it working.</p><figure class=\"kg-card kg-image-card\"><img src=\"__GHOST_URL__/content/images/2023/03/cat-jump.gif\" class=\"kg-image\" alt loading=\"lazy\" width=\"640\" height=\"358\"></figure><h2 id=\"lacking-docswebsocket-authentication-in-trpc\">Lacking docs - websocket authentication in tRPC</h2><p>Now we facing issue of providing authentication to websocket, but you probably know that pure websockets do not support http headers. You can pass them on handshake http request that will upgrade protocol to websocket. Details are described in RFC 6455</p><figure class=\"kg-card kg-bookmark-card\"><a class=\"kg-bookmark-container\" href=\"https://www.rfc-editor.org/rfc/rfc6455\"><div class=\"kg-bookmark-content\"><div class=\"kg-bookmark-title\">RFC 6455: The WebSocket Protocol</div><div class=\"kg-bookmark-description\"></div><div class=\"kg-bookmark-metadata\"></div></div></a></figure><p>In more mature projects like apollo server you can see that upgrade request is used to pass authentication info, but unfortunately now tRPC do not support it.</p><p>Anyway can split you split your client to http and websocket parts.</p><pre><code class=\"language-typescript\">const client = createTRPCProxyClient&lt;AppRouter&gt;({\n    links: [\n        splitLink({\n            condition: (op) =&gt; op.type === 'subscription',\n            true:         wsLink({\n                client: wsClient\n            }),\n            false: httpBatchLink({\n                url: 'http://localhost:2022',\n                headers: () =&gt; Object.fromEntries(headers)\n            }),\n        }),\n    ],\n});</code></pre><p>Probably most of operations will be http operations, so you can use mechanism with authentication described earlier for queries and mutations. In case of websocket you can use payload to pass token now or use trick taht I describe below. </p><p>To give you more context there is open issue:</p><figure class=\"kg-card kg-bookmark-card\"><a class=\"kg-bookmark-container\" href=\"https://github.com/trpc/trpc/issues/3955\"><div class=\"kg-bookmark-content\"><div class=\"kg-bookmark-title\">feat: Authentication by Websocket · Issue #3955 · trpc/trpc</div><div class=\"kg-bookmark-description\">Describe the feature you&amp;#39;d like to request We know that websocket do not use http headers, but during handshake http request can be used. Page 14 RFC 6455 https://www.rfc-editor.org/rfc/rfc6455...</div><div class=\"kg-bookmark-metadata\"><img class=\"kg-bookmark-icon\" src=\"https://github.githubassets.com/favicons/favicon.svg\"><span class=\"kg-bookmark-author\">GitHub</span><span class=\"kg-bookmark-publisher\">trpc</span></div></div><div class=\"kg-bookmark-thumbnail\"><img src=\"https://opengraph.githubassets.com/245c8d56d539e6bec21e39215f9318407443a354cbf11938002a07a2466cf411/trpc/trpc/issues/3955\"></div></a></figure><p>Interesting but misleading topic on stackoverflow</p><figure class=\"kg-card kg-bookmark-card\"><a class=\"kg-bookmark-container\" href=\"https://stackoverflow.com/questions/4361173/http-headers-in-websockets-client-api\"><div class=\"kg-bookmark-content\"><div class=\"kg-bookmark-title\">HTTP headers in Websockets client API</div><div class=\"kg-bookmark-description\">Looks like it’s easy to add custom HTTP headers to your websocket client with any HTTP header client which supports this, but I can’t find how to do it with the web platform’s WebSocket API.Anyone...</div><div class=\"kg-bookmark-metadata\"><img class=\"kg-bookmark-icon\" src=\"https://cdn.sstatic.net/Sites/stackoverflow/Img/apple-touch-icon.png?v&#x3D;c78bd457575a\"><span class=\"kg-bookmark-author\">Stack Overflow</span><span class=\"kg-bookmark-publisher\">Julien Genestoux</span></div></div><div class=\"kg-bookmark-thumbnail\"><img src=\"https://cdn.sstatic.net/Sites/stackoverflow/Img/apple-touch-icon@2.png?v&#x3D;73d79a89bded\"></div></a></figure><p>Answer with most votes is wrong, because not taking into account handshake. And <code>ws</code> implements it as third arguments, but you can't find it in official README.md</p><figure class=\"kg-card kg-bookmark-card\"><a class=\"kg-bookmark-container\" href=\"https://github.com/websockets/ws\"><div class=\"kg-bookmark-content\"><div class=\"kg-bookmark-title\">GitHub - websockets/ws: Simple to use, blazing fast and thoroughly tested WebSocket client and server for Node.js</div><div class=\"kg-bookmark-description\">Simple to use, blazing fast and thoroughly tested WebSocket client and server for Node.js - GitHub - websockets/ws: Simple to use, blazing fast and thoroughly tested WebSocket client and server for...</div><div class=\"kg-bookmark-metadata\"><img class=\"kg-bookmark-icon\" src=\"https://github.githubassets.com/favicons/favicon.svg\"><span class=\"kg-bookmark-author\">GitHub</span><span class=\"kg-bookmark-publisher\">websockets</span></div></div><div class=\"kg-bookmark-thumbnail\"><img src=\"https://opengraph.githubassets.com/45c5a7f253c0db2b0bc8e3b601909e0a559e4afec84d93eb8c4362b6c8d91cde/websockets/ws\"></div></a></figure><p>In <code>trpc</code> code this third argument is skipped</p><figure class=\"kg-card kg-bookmark-card\"><a class=\"kg-bookmark-container\" href=\"https://github.com/trpc/trpc/blob/main/packages/client/src/links/wsLink.ts#L130-L134\"><div class=\"kg-bookmark-content\"><div class=\"kg-bookmark-title\">trpc/wsLink.ts at main · trpc/trpc</div><div class=\"kg-bookmark-description\">?‍♀️ Move Fast and Break Nothing. End-to-end typesafe APIs made easy. - trpc/wsLink.ts at main · trpc/trpc</div><div class=\"kg-bookmark-metadata\"><img class=\"kg-bookmark-icon\" src=\"https://github.githubassets.com/favicons/favicon.svg\"><span class=\"kg-bookmark-author\">GitHub</span><span class=\"kg-bookmark-publisher\">trpc</span></div></div><div class=\"kg-bookmark-thumbnail\"><img src=\"https://opengraph.githubassets.com/46dc3f4fb4cf1a9ce850ef9e15930924d82409ed120557c20505a8f244f5fc43/trpc/trpc\"></div></a></figure><figure class=\"kg-card kg-image-card\"><img src=\"__GHOST_URL__/content/images/2023/03/Zrzut-ekranu-z-2023-03-09-14-46-55.png\" class=\"kg-image\" alt loading=\"lazy\" width=\"481\" height=\"113\"></figure><p>You cannot also use <code>Sec-WebSocket-Key</code> because <code>ws</code> override it by random hash.</p><figure class=\"kg-card kg-bookmark-card\"><a class=\"kg-bookmark-container\" href=\"https://github.com/websockets/ws/blob/master/lib/websocket.js#L717-L723\"><div class=\"kg-bookmark-content\"><div class=\"kg-bookmark-title\">ws/websocket.js at master · websockets/ws</div><div class=\"kg-bookmark-description\">Simple to use, blazing fast and thoroughly tested WebSocket client and server for Node.js - ws/websocket.js at master · websockets/ws</div><div class=\"kg-bookmark-metadata\"><img class=\"kg-bookmark-icon\" src=\"https://github.githubassets.com/favicons/favicon.svg\"><span class=\"kg-bookmark-author\">GitHub</span><span class=\"kg-bookmark-publisher\">websockets</span></div></div><div class=\"kg-bookmark-thumbnail\"><img src=\"https://opengraph.githubassets.com/45c5a7f253c0db2b0bc8e3b601909e0a559e4afec84d93eb8c4362b6c8d91cde/websockets/ws\"></div></a></figure><figure class=\"kg-card kg-image-card\"><img src=\"__GHOST_URL__/content/images/2023/03/image.png\" class=\"kg-image\" alt loading=\"lazy\" width=\"478\" height=\"159\"></figure><p>and loosing <code>trpc</code> loose this information.</p><p>There are three approaches to solve this problem.</p><ul><li>pass auth header to handshake ( easy, but constraint and not practical )</li><li>build Map between connection ids and these tokens on server ( has flaws but works )</li><li>passing token to any subscription in payload ( less elegant but more scalable )</li></ul><figure class=\"kg-card kg-image-card\"><img src=\"__GHOST_URL__/content/images/2023/03/meme1.gif\" class=\"kg-image\" alt loading=\"lazy\" width=\"520\" height=\"292\"></figure><h3 id=\"scenario-1-we-know-auth-token-before-client-is-created\">Scenario 1: We know auth token before client is created</h3><p>This is scenario that is extremely easy to implement, but not practical. I am presenting it only because it not require changes on backend and will be our proof of concept that we will use to improve in next step.</p><p>Lets build your Proxy that will add headers anyway.</p><pre><code class=\"language-typescript\">const WebSocket = require('ws');\n\nconst WebSocketProxy = new Proxy(WebSocket, {\n    construct(target, args) {\n        return new target(args[0], undefined, {\n            headers: Object.fromEntries(headers)\n        });\n    }\n})</code></pre><p>This object will use headers defined earlier as a map in part about authorization</p><pre><code class=\"language-typescript\">const headers: Map&lt;string, string&gt; = new Map&lt;string, string&gt;();</code></pre><p><code>args[0]</code> will be your server url, and undefined is for protocol, you do not have to worry about it. It was undefined/skipped anyway.</p><p>But we have to set header by</p><pre><code class=\"language-typescript\">headers.set('Authorization', 'ABC');</code></pre><p>before call of <code>createWSClient</code>.</p><p>Now you can use <code>WebSocketProxy</code> instead of original <code>Websocket</code> implementation </p><pre><code class=\"language-typescript\">const wsClient = createWSClient({\n    url: `ws://localhost:3001`,\n    WebSocket: WebSocketProxy,\n});</code></pre><p>Client can have only wsLink</p><pre><code class=\"language-typescript\">const client = createTRPCProxyClient&lt;AppRouter&gt;({\n    links: [\n        wsLink({\n            client: wsClient\n        }),\n    ],\n});</code></pre><p>Or be splitted to http and websocket parts</p><pre><code class=\"language-typescript\">const client = createTRPCProxyClient&lt;AppRouter&gt;({\n    links: [\n        splitLink({\n            condition: (op) =&gt; op.type === 'subscription',\n            true: wsLink({\n                client: wsClient\n            }),\n            false: httpBatchLink({\n                url: 'http://localhost:2022',\n                headers: () =&gt; Object.fromEntries(headers)\n            }),\n        }),\n    ],\n});</code></pre><p>On server side we do not need changes, but we will do only one simple imprvement. We will return <code>auth</code> state from <code>time</code> subscription</p><pre><code class=\"language-typescript\">time: publicProcedure.subscription(({ctx}) =&gt; {\n        return observable&lt;{ date: Date, auth: boolean }&gt;((emit) =&gt; {\n            // logic that will execute on subscription start\n            const interval = setInterval(() =&gt; emit.next({date: new Date(), auth: ctx.auth}), 1000);\n            // function to clean up and close interval after end of connection\n            return () =&gt; {\n                clearInterval(interval);\n            }\n        })\n    })</code></pre><p>Now our client <code>main</code> function will be following</p><pre><code class=\"language-typescript\">async function main() {\n    const result = await client.greet.query('tRPC');\n    console.log(result.greeting.toUpperCase());\n\n    const secret = await client.secret.mutate();\n    console.log(secret);\n\n    client.time.subscribe(undefined, {\n        onData: ({auth, date}) =&gt; {\n            console.log(`I am ${auth ? 'auth' : 'not auth'} at ${date}`)\n        }\n    })\n}</code></pre><p>we should see that all requests works correctly and we have access to token on websocket context too.</p><figure class=\"kg-card kg-image-card\"><img src=\"__GHOST_URL__/content/images/2023/03/Zrzut-ekranu-z-2023-03-09-15-59-26.png\" class=\"kg-image\" alt loading=\"lazy\" width=\"478\" height=\"159\"></figure><p>But in real use case you starting app as unauthenticated user, that will authenticate by http and then open websocket connections to operate over them.</p><p>tRPC define <code>tryReconnect</code> function for <code>wsLink</code> but do not expose it. Additionally it would be better to be able to authenticate without reconnection and special websocket endpoint dedicated to login.</p><h3 id=\"scenario-2-we-authenticating-by-http-context-and-passing-result-to-websocket-context\">Scenario 2: We authenticating by http context and passing result to websocket context</h3><p>Let's start from high level design.</p><ol><li>We will setup our <code>sec-websocket-key</code> that we are able to save and reuse on client</li><li>We will setup map of these keys and these authentication states on client</li><li>We will allow to modify this map using http requests with authorization headers</li><li>We will see that on websocket subscription state of auth can be obtained using <code>keys</code></li></ol><h4 id=\"setting-header-with-client-id\">Setting header with client id</h4><p>There is open <a href=\"https://github.com/websockets/ws/pull/2125\">pr</a> that will allow to override <code>sec-websocket-key</code> but now, lets use different name. <code>sec-websocket-id</code> seems to be great.</p><p>So when our client starting (eg user enter to our page url or in our case node process starts) we need to generate id. I will focus on <code>node</code> implementation, so can use <code>crypto</code>.</p><p>Our new lines on client will be</p><pre><code class=\"language-typescript\">import crypto from 'crypto';\nconst id = crypto.randomBytes(16).toString('hex')\nheaders.set('sec-websocket-id', id);\n</code></pre><p>you have to set them before <code>const wsClient = createWSClient({</code>.</p><h4 id=\"setting-connections-map-on-server\">Setting connections map on server</h4><p>Crucial point is that we share <code>headers</code> for <code>http</code> and <code>websocket</code> links. So in server  <code>createContext</code> we expect to see this header for all types of requests - both standard http and http upgrade requests that will open websocket.</p><p>Our <code>context.ts</code> can be rewritten in this way:</p><pre><code class=\"language-typescript\">import {inferAsyncReturnType} from '@trpc/server';\nimport {CreateNextContextOptions} from '@trpc/server/adapters/next';\n\nconst authState = new Map&lt;string, boolean&gt;();\n\nexport async function createContext({req}: CreateNextContextOptions) {\n    console.log(req.headers);\n    const auth = req.headers.authorization === 'ABC';\n    const id = req.headers['sec-websocket-id'];\n\n    authState.set(id, auth);\n\n    return {\n        auth: () =&gt; authState.get(id) ?? false,\n        id\n    };\n}\n\nexport type Context = inferAsyncReturnType&lt;typeof createContext&gt;;\n</code></pre><p>so now, we are not checking auth state in current request, but last value saved in <code>Map</code>.</p><p>In our scenario there are the following events:</p><ul><li>public query</li><li>setting token</li><li>private mutation &lt;– here we setting auth to true</li><li>websocket subscription &lt;— here we are using state from map</li></ul><p>We need super small adjustments in two paces. In <code>isAuthed</code> function we need call auth</p><pre><code class=\"language-typescript\">const isAuthed = t.middleware(({next, ctx}) =&gt; {\n    if (!ctx.auth()) {\n        throw new TRPCError({code: 'UNAUTHORIZED'});\n    }\n    return next({\n        ctx: {\n            auth: ctx.auth\n        }\n    });\n});</code></pre><p>and in subscription we have to change <code>ctx.auth</code> to <code>ctx.auth()</code> too</p><pre><code class=\"language-typescript\">const interval = setInterval(() =&gt; emit.next({date: new Date(), auth: ctx.auth()}), 1000);\n</code></pre><h4 id=\"lets-check-if-it-works-for-client\">Lets check if it works for client</h4><p>To achieve more dramatic effect we can use <code>setTimeout</code> to postpone authentication.</p><p>Our <code>main</code> function now have a form</p><pre><code class=\"language-typescript\">async function main() {\n    const result = await client.greet.query('tRPC');\n    console.log(result.greeting.toUpperCase());\n    \n    setTimeout(async () =&gt; {\n        headers.set('Authorization', 'ABC');\n\n        const secret = await client.secret.mutate();\n        console.log(secret);\n    }, 2000)\n\n\n    client.time.subscribe(undefined, {\n        onData: (ctx) =&gt; {\n            console.log(`I am ${ctx.auth ? 'auth' : 'not auth'} at ${ctx.date}`)\n        }\n    })\n}</code></pre><p>and in console i see</p><figure class=\"kg-card kg-image-card\"><img src=\"__GHOST_URL__/content/images/2023/03/Zrzut-ekranu-z-2023-03-09-16-58-02.png\" class=\"kg-image\" alt loading=\"lazy\" width=\"478\" height=\"159\"></figure><h4 id=\"scenario-3-passing-token-in-subscription-input\">Scenario 3: Passing token in subscription input</h4><p>To cover problem completely I am presenting third last approach - passing token in payload to subscription, instead of to handshake requests. We can modify our <code>time</code></p><pre><code class=\"language-typescript\">    time: publicProcedure.input(\n        z.object({\n            token: z.string(),\n        }),\n    ).subscription(({ctx, input}) =&gt; {\n        return observable&lt;{ date: Date, ctx_auth: boolean, input_auth: boolean }&gt;((emit) =&gt; {\n            // logic that will execute on subscription start\n            const interval = setInterval(() =&gt; emit.next({\n                date: new Date(),\n                ctx_auth: ctx.auth(),\n                input_auth: input.token === 'ABC'\n            }), 1000);\n            // function to clean up and close interval after end of connection\n            return () =&gt; {\n                clearInterval(interval);\n            }\n        })\n    })</code></pre><p>and on client side</p><pre><code class=\"language-typescript\">    client.time.subscribe({token: 'ABC'}, {\n        onData: (ctx) =&gt; {\n            console.log(`I am ${ctx.input_auth ? 'auth' : 'not auth'} at ${ctx.date}`)\n        }\n    })</code></pre><h2 id=\"recommended-improvements\">Recommended improvements</h2><p>If you are user of grpc and simiarry to <code>Funwithloops</code> from this reddit topic:</p><p><a href=\"https://www.reddit.com/r/node/comments/117fgb5/trpc_correct_way_to_authorize_websocket/\">https://www.reddit.com/r/node/comments/117fgb5/trpc_correct_way_to_authorize_websocket/</a></p><p>think about websocket authentication. You should consider this blog post as sketch written by person that learned <code>tRPC</code> few hours ago. On production environment you have to solve problem of sharing state saved in <code>authState</code> between your backend instances. Probably you will need redis for it. Then you should set <code>TX</code> parameters to not persist these keys infinitely. We forgot about logout endpoint.</p><p>Redis to manage authentication decrease performance in comparison to pure <code>jwt</code> so maybe better design would be append authentication to your subscription input, that on the other hand is less readable and require more boilerplate.</p><p>You should be aware that <code>trpc</code> do not implement <code>lazy</code> option for websocket client that is available in apollo and would simplify our first scenario that I described here.</p><p>This technology is super hot, but still in phase of development and this article can be outdated soon.</p><figure class=\"kg-card kg-image-card\"><img src=\"__GHOST_URL__/content/images/2023/03/68747470733a2f2f6170692e737461722d686973746f72792e636f6d2f7376673f7265706f733d747270632f7472706326747970653d44617465.svg\" class=\"kg-image\" alt loading=\"lazy\" width=\"800\" height=\"533\"></figure><p>If you are one of <code>trpc</code> maintainers, you can use concepts presented here in official docs or suggest me better approach to websocket auth in comments section.</p>","comment_id":"640936aabbda300a2f29d56c","plaintext":"I learned tRPC today and fall in love ❤️ instantly deciding to rewrite project\nthat I currently developing to this framework.\n\nIn short words what it is:\n1. You can develop schema like in gRPC\n2. But you are only constrain to typescript (rust support in progress)\n3. Instead of protobuf that is hard to read/debug you have lightweight types\ngenerated from your validators (like zod) and resolvers\n\nFinally you obtaining fastest fullstack development cycle that I ever seen and I\ncan compare it only with ruby on rails.\n\nMinimal example of tRPC with query by http\nLet me show you minimal project using this stack.\n\nWe will start from 2 folders:\n\n * client\n * server\n\nI client we have to install @trpc/client and in server we installing \n@trpc/server and zod.\n\n In server/index.ts we creating server with schema generated from our code\n\nimport {initTRPC} from '@trpc/server';\nimport {createHTTPServer} from '@trpc/server/adapters/standalone';\nimport {z} from 'zod'\n\nexport type AppRouter = typeof appRouter;\n\nconst t = initTRPC.create();\n\nconst publicProcedure = t.procedure;\nconst router = t.router;\n\nconst appRouter = router({\n    greet: publicProcedure\n        .input(z.string())\n        .query(({input}) => ({greeting: `hello, ${input}!`})),\n});\n\ncreateHTTPServer({\n    router: appRouter,\n}).listen(2022);\n\n\nLook at export type AppRouter this line is responsible for exporting schema for\nclient. Few lines later we defining all routes using router function.\n\nThere is not only query, but also mutation and subscription. But in our example\nwe have to show minimal starter so lets see client code.\n\nimport { createTRPCProxyClient, httpBatchLink } from '@trpc/client';\nimport type { AppRouter } from '../server';\n\nconst client = createTRPCProxyClient<AppRouter>({\n  links: [\n    httpBatchLink({\n      url: 'http://localhost:2022',\n    }),\n  ],\n});\n\nasync function main() {\n  const result = await client.greet.query('tRPC');\n\n  // Type safe\n  console.log(result.greeting.toUpperCase());\n}\n\nvoid main();\n\nHere is import of AppRouter and we using it as generic type to create client. So\nall of:\n\n * client methods\n * methods arguments\n * methods outputs\n\nhave strong typing.\n\nAuthentication with tRPC\nLets add mutation that can be done only by admin. To simplify we will skip jwt /\nlogin / register and will consider situation when client can send Authorization \nheader with ABC to authorize him.\n\nSo in this part you will learn how to add authorization, middlewares and\nmutations.\n\nLets create context.ts in server\n\nimport {inferAsyncReturnType} from '@trpc/server';\nimport {CreateNextContextOptions} from '@trpc/server/adapters/next';\n\nexport async function createContext({req}: CreateNextContextOptions) {\n    return {\n        auth: req.headers.authorization === 'ABC'\n    };\n}\n\nexport type Context = inferAsyncReturnType<typeof createContext>;\n\n\nNow we can change\n\nconst t = initTRPC.create();\n\nto\n\nimport type { Context } from './context';\nexport const t = initTRPC.context<Context>().create();\n\n\nNow we expect that in context we will be able to check if user is authorized.\n\nYou have to also add createContext to createHTTPServer options, so change:\n\ncreateHTTPServer({\n    router: appRouter,\n}).listen(2022);\n\nto\n\nimport {createContext} from \"./context\";\n\ncreateHTTPServer({\n    router: appRouter,\n    createContext\n}).listen(2022);\n\nNow we have 2 options. We can check auth in resolver\n\nsecret: t.procedure.query(({ ctx }) => {\n    if (!ctx.auth) {\n      throw new TRPCError({ code: 'UNAUTHORIZED' });\n    }\n    return {\n      secret: 'sauce',\n    };\n  }),\n\nbut better approach is probably adding this check to middleware called \nprotectedProcedure.\n\nIt is a little more code, but give us some advantages\n\nconst isAuthed = t.middleware(({ next, ctx }) => {\n    if (!ctx.auth) {\n        throw new TRPCError({ code: 'UNAUTHORIZED' });\n    }\n    return next({\n        ctx: {\n            auth: ctx.auth\n        }\n    });\n});\nconst protectedProcedure = t.procedure.use(isAuthed);\n\n\nFirstly we can redefine our context, eg finding user in database and converting\nid in token to full set of user parameters. Additionally we can reuse \nprotectedProcedure in all places without repetition of this check every time.\n\nNow there is last final step in server: adding new route to router argument keys\n\nsecret: protectedProcedure.mutation(() => \"access granted\")\n\nIn client we can use it in following way:\n\n  const unauthorizedError = await client.secret.mutate();\n  console.log(unauthorizedError);\n\nand we will see a beautiful unauthorized error like this\n\nTo be authorized we can add headers in client definition\n\nconst client = createTRPCProxyClient<AppRouter>({\n  links: [\n    httpBatchLink({\n      url: 'http://localhost:2022',\n      headers: {\n        Authorization: 'ABC'\n      }\n    }),\n  ],\n});\n\nIf I would left it in that form I have to recreate client with new headers on\nevery headers change. Fortunately this simple form can be enhanced and we can\nwrite this way:\n\nconst headers: Map<string, string> = new Map<string, string>();\n\nconst client = createTRPCProxyClient<AppRouter>({\n  links: [\n    httpBatchLink({\n      url: 'http://localhost:2022',\n      headers: () => Object.fromEntries(headers)\n    }),\n  ],\n});\n\nand decide about shape of headers dynamically on runtime, eg setting \nAuthorization by\n\nheaders.set('Authorization', 'ABC');\n\nTime to real time with tRPC subscriptions\nIn server we installing ws.\n\nnpm i ws\nnpm i -D @types/ws\n\nTo router we can add new subscription that will give us time every second\n\ntime: publicProcedure.subscription(() => {\n        return observable<Date>((emit) => {\n            // logic that will execute on subscription start\n            const interval = setInterval(() => emit.next(new Date()), 1000);\n            // function to clean up and close interval after end of connection\n            return () => {\n                clearInterval(interval);\n            }\n        })\n    })\n\nNow we have to open websocket server so let's add it using code:\n\nconst wss = new ws.Server({\n    port: 3001,\n});\nconst handler = applyWSSHandler({ wss, router: appRouter, createContext });\nwss.on('connection', (ws) => {\n    console.log(`➕➕ Connection (${wss.clients.size})`);\n    ws.once('close', () => {\n        console.log(`➖➖ Connection (${wss.clients.size})`);\n    });\n});\nconsole.log('✅ WebSocket Server listening on ws://localhost:3001');\nprocess.on('SIGTERM', () => {\n    console.log('SIGTERM');\n    handler.broadcastReconnectNotification();\n    wss.close();\n});\n\nI checked in insomia that I can connect\n\nIn payload I used object with shape described in jsonrpc spec\n\n{\n  id: number | string;\n  jsonrpc?: '2.0';\n  method: 'subscription';\n  params: {\n    path: string;\n    input?: unknown; // <-- pass input of procedure, serialized by transformer\n  };\n}\n\nSo let's connect our client in typescript now.\n\nFollowing after official docs you will see error\n\nReferenceError: WebSocket is not defined\n\nbecause createWSClient assume that operate in browser, but we are using node\nclient in this example.\n\nTo fix it we have to install ws and assign it to global scope but if your client\nlive in browser you can skip this step.\n\nnpm i ws\nnpm i -D @types/ws\n\nNow you can create wsClient\n\nconst WebSocket = require('ws');\nconst wsClient = createWSClient({\n    url: `ws://localhost:3001`,\n    WebSocket: WebSocket,\n});\n\nuse it wrapping in link\n\nconst client = createTRPCProxyClient<AppRouter>({\n    links: [\n        wsLink({\n            client: wsClient\n        }),\n    ],\n});\n\nand finally subscribe to see series of Dates\n\n    client.time.subscribe(undefined, {\n        onData: (time) => {\n            console.log(time)\n        }\n    })\n\nUnfortunately you have to remove our secret mutation\n\nawait client.secret.mutate();\n\nto make it working.\n\nLacking docs - websocket authentication in tRPC\nNow we facing issue of providing authentication to websocket, but you probably\nknow that pure websockets do not support http headers. You can pass them on\nhandshake http request that will upgrade protocol to websocket. Details are\ndescribed in RFC 6455\n\nRFC 6455: The WebSocket Protocol [https://www.rfc-editor.org/rfc/rfc6455]In more\nmature projects like apollo server you can see that upgrade request is used to\npass authentication info, but unfortunately now tRPC do not support it.\n\nAnyway can split you split your client to http and websocket parts.\n\nconst client = createTRPCProxyClient<AppRouter>({\n    links: [\n        splitLink({\n            condition: (op) => op.type === 'subscription',\n            true:         wsLink({\n                client: wsClient\n            }),\n            false: httpBatchLink({\n                url: 'http://localhost:2022',\n                headers: () => Object.fromEntries(headers)\n            }),\n        }),\n    ],\n});\n\nProbably most of operations will be http operations, so you can use mechanism\nwith authentication described earlier for queries and mutations. In case of\nwebsocket you can use payload to pass token now or use trick taht I describe\nbelow. \n\nTo give you more context there is open issue:\n\nfeat: Authentication by Websocket · Issue #3955 · trpc/trpcDescribe the feature\nyou'd like to request We know that websocket do not use http headers, but\nduring handshake http request can be used. Page 14 RFC 6455\nhttps://www.rfc-editor.org/rfc/rfc6455...GitHubtrpc\n[https://github.com/trpc/trpc/issues/3955]Interesting but misleading topic on\nstackoverflow\n\nHTTP headers in Websockets client APILooks like it’s easy to add custom HTTP\nheaders to your websocket client with any HTTP header client which supports\nthis, but I can’t find how to do it with the web platform’s WebSocket\nAPI.Anyone...Stack OverflowJulien Genestoux\n[https://stackoverflow.com/questions/4361173/http-headers-in-websockets-client-api]\nAnswer with most votes is wrong, because not taking into account handshake. And \nws implements it as third arguments, but you can't find it in official README.md\n\nGitHub - websockets/ws: Simple to use, blazing fast and thoroughly tested\nWebSocket client and server for Node.jsSimple to use, blazing fast and\nthoroughly tested WebSocket client and server for Node.js - GitHub -\nwebsockets/ws: Simple to use, blazing fast and thoroughly tested WebSocket\nclient and server for...GitHubwebsockets [https://github.com/websockets/ws]In trpc code this third argument is skipped\n\ntrpc/wsLink.ts at main · trpc/trpc?‍♀️ Move Fast and Break Nothing. End-to-end\ntypesafe APIs made easy. - trpc/wsLink.ts at main · trpc/trpcGitHubtrpc\n[https://github.com/trpc/trpc/blob/main/packages/client/src/links/wsLink.ts#L130-L134]\nYou cannot also use Sec-WebSocket-Key because ws override it by random hash.\n\nws/websocket.js at master · websockets/wsSimple to use, blazing fast and\nthoroughly tested WebSocket client and server for Node.js - ws/websocket.js at\nmaster · websockets/wsGitHubwebsockets\n[https://github.com/websockets/ws/blob/master/lib/websocket.js#L717-L723]and\nloosing trpc loose this information.\n\nThere are three approaches to solve this problem.\n\n * pass auth header to handshake ( easy, but constraint and not practical )\n * build Map between connection ids and these tokens on server ( has flaws but\n   works )\n * passing token to any subscription in payload ( less elegant but more scalable\n   )\n\nScenario 1: We know auth token before client is created\nThis is scenario that is extremely easy to implement, but not practical. I am\npresenting it only because it not require changes on backend and will be our\nproof of concept that we will use to improve in next step.\n\nLets build your Proxy that will add headers anyway.\n\nconst WebSocket = require('ws');\n\nconst WebSocketProxy = new Proxy(WebSocket, {\n    construct(target, args) {\n        return new target(args[0], undefined, {\n            headers: Object.fromEntries(headers)\n        });\n    }\n})\n\nThis object will use headers defined earlier as a map in part about\nauthorization\n\nconst headers: Map<string, string> = new Map<string, string>();\n\nargs[0] will be your server url, and undefined is for protocol, you do not have\nto worry about it. It was undefined/skipped anyway.\n\nBut we have to set header by\n\nheaders.set('Authorization', 'ABC');\n\nbefore call of createWSClient.\n\nNow you can use WebSocketProxy instead of original Websocket implementation \n\nconst wsClient = createWSClient({\n    url: `ws://localhost:3001`,\n    WebSocket: WebSocketProxy,\n});\n\nClient can have only wsLink\n\nconst client = createTRPCProxyClient<AppRouter>({\n    links: [\n        wsLink({\n            client: wsClient\n        }),\n    ],\n});\n\nOr be splitted to http and websocket parts\n\nconst client = createTRPCProxyClient<AppRouter>({\n    links: [\n        splitLink({\n            condition: (op) => op.type === 'subscription',\n            true: wsLink({\n                client: wsClient\n            }),\n            false: httpBatchLink({\n                url: 'http://localhost:2022',\n                headers: () => Object.fromEntries(headers)\n            }),\n        }),\n    ],\n});\n\nOn server side we do not need changes, but we will do only one simple\nimprvement. We will return auth state from time subscription\n\ntime: publicProcedure.subscription(({ctx}) => {\n        return observable<{ date: Date, auth: boolean }>((emit) => {\n            // logic that will execute on subscription start\n            const interval = setInterval(() => emit.next({date: new Date(), auth: ctx.auth}), 1000);\n            // function to clean up and close interval after end of connection\n            return () => {\n                clearInterval(interval);\n            }\n        })\n    })\n\nNow our client main function will be following\n\nasync function main() {\n    const result = await client.greet.query('tRPC');\n    console.log(result.greeting.toUpperCase());\n\n    const secret = await client.secret.mutate();\n    console.log(secret);\n\n    client.time.subscribe(undefined, {\n        onData: ({auth, date}) => {\n            console.log(`I am ${auth ? 'auth' : 'not auth'} at ${date}`)\n        }\n    })\n}\n\nwe should see that all requests works correctly and we have access to token on\nwebsocket context too.\n\nBut in real use case you starting app as unauthenticated user, that will\nauthenticate by http and then open websocket connections to operate over them.\n\ntRPC define tryReconnect function for wsLink but do not expose it. Additionally\nit would be better to be able to authenticate without reconnection and special\nwebsocket endpoint dedicated to login.\n\nScenario 2: We authenticating by http context and passing result to websocket\ncontext\nLet's start from high level design.\n\n 1. We will setup our sec-websocket-key that we are able to save and reuse on\n    client\n 2. We will setup map of these keys and these authentication states on client\n 3. We will allow to modify this map using http requests with authorization\n    headers\n 4. We will see that on websocket subscription state of auth can be obtained\n    using keys\n\nSetting header with client id\nThere is open pr [https://github.com/websockets/ws/pull/2125] that will allow to\noverride sec-websocket-key but now, lets use different name. sec-websocket-id \nseems to be great.\n\nSo when our client starting (eg user enter to our page url or in our case node\nprocess starts) we need to generate id. I will focus on node implementation, so\ncan use crypto.\n\nOur new lines on client will be\n\nimport crypto from 'crypto';\nconst id = crypto.randomBytes(16).toString('hex')\nheaders.set('sec-websocket-id', id);\n\n\nyou have to set them before const wsClient = createWSClient({.\n\nSetting connections map on server\nCrucial point is that we share headers for http and websocket links. So in\nservercreateContext we expect to see this header for all types of requests -\nboth standard http and http upgrade requests that will open websocket.\n\nOur context.ts can be rewritten in this way:\n\nimport {inferAsyncReturnType} from '@trpc/server';\nimport {CreateNextContextOptions} from '@trpc/server/adapters/next';\n\nconst authState = new Map<string, boolean>();\n\nexport async function createContext({req}: CreateNextContextOptions) {\n    console.log(req.headers);\n    const auth = req.headers.authorization === 'ABC';\n    const id = req.headers['sec-websocket-id'];\n\n    authState.set(id, auth);\n\n    return {\n        auth: () => authState.get(id) ?? false,\n        id\n    };\n}\n\nexport type Context = inferAsyncReturnType<typeof createContext>;\n\n\nso now, we are not checking auth state in current request, but last value saved\nin Map.\n\nIn our scenario there are the following events:\n\n * public query\n * setting token\n * private mutation <– here we setting auth to true\n * websocket subscription <— here we are using state from map\n\nWe need super small adjustments in two paces. In isAuthed function we need call\nauth\n\nconst isAuthed = t.middleware(({next, ctx}) => {\n    if (!ctx.auth()) {\n        throw new TRPCError({code: 'UNAUTHORIZED'});\n    }\n    return next({\n        ctx: {\n            auth: ctx.auth\n        }\n    });\n});\n\nand in subscription we have to change ctx.auth to ctx.auth() too\n\nconst interval = setInterval(() => emit.next({date: new Date(), auth: ctx.auth()}), 1000);\n\n\nLets check if it works for client\nTo achieve more dramatic effect we can use setTimeout to postpone\nauthentication.\n\nOur main function now have a form\n\nasync function main() {\n    const result = await client.greet.query('tRPC');\n    console.log(result.greeting.toUpperCase());\n    \n    setTimeout(async () => {\n        headers.set('Authorization', 'ABC');\n\n        const secret = await client.secret.mutate();\n        console.log(secret);\n    }, 2000)\n\n\n    client.time.subscribe(undefined, {\n        onData: (ctx) => {\n            console.log(`I am ${ctx.auth ? 'auth' : 'not auth'} at ${ctx.date}`)\n        }\n    })\n}\n\nand in console i see\n\nScenario 3: Passing token in subscription input\nTo cover problem completely I am presenting third last approach - passing token\nin payload to subscription, instead of to handshake requests. We can modify our \ntime\n\n    time: publicProcedure.input(\n        z.object({\n            token: z.string(),\n        }),\n    ).subscription(({ctx, input}) => {\n        return observable<{ date: Date, ctx_auth: boolean, input_auth: boolean }>((emit) => {\n            // logic that will execute on subscription start\n            const interval = setInterval(() => emit.next({\n                date: new Date(),\n                ctx_auth: ctx.auth(),\n                input_auth: input.token === 'ABC'\n            }), 1000);\n            // function to clean up and close interval after end of connection\n            return () => {\n                clearInterval(interval);\n            }\n        })\n    })\n\nand on client side\n\n    client.time.subscribe({token: 'ABC'}, {\n        onData: (ctx) => {\n            console.log(`I am ${ctx.input_auth ? 'auth' : 'not auth'} at ${ctx.date}`)\n        }\n    })\n\nRecommended improvements\nIf you are user of grpc and simiarry to Funwithloops from this reddit topic:\n\nhttps://www.reddit.com/r/node/comments/117fgb5/trpc_correct_way_to_authorize_websocket/\n\nthink about websocket authentication. You should consider this blog post as\nsketch written by person that learned tRPC few hours ago. On production\nenvironment you have to solve problem of sharing state saved in authState \nbetween your backend instances. Probably you will need redis for it. Then you\nshould set TX parameters to not persist these keys infinitely. We forgot about\nlogout endpoint.\n\nRedis to manage authentication decrease performance in comparison to pure jwt so\nmaybe better design would be append authentication to your subscription input,\nthat on the other hand is less readable and require more boilerplate.\n\nYou should be aware that trpc do not implement lazy option for websocket client\nthat is available in apollo and would simplify our first scenario that I\ndescribed here.\n\nThis technology is super hot, but still in phase of development and this article\ncan be outdated soon.\n\nIf you are one of trpc maintainers, you can use concepts presented here in\nofficial docs or suggest me better approach to websocket auth in comments\nsection.","feature_image":"__GHOST_URL__/content/images/2023/03/jpeg-optimizer_trpc-ws.jpg","featured":0,"type":"post","status":"published","locale":null,"visibility":"public","email_recipient_filter":"all","created_at":"2023-03-09T01:30:18.000Z","updated_at":"2023-03-09T09:17:29.000Z","published_at":"2023-03-09T09:17:29.000Z","custom_excerpt":"We building tRPC client and server with query, mutation, authentication and subscriptions. Authentication for websocket can be tricky and it is in this case so there are presented three approaches to solve this problem.","codeinjection_head":null,"codeinjection_foot":null,"custom_template":null,"canonical_url":null,"newsletter_id":null,"lexical":null},{"id":"640b53120f360525ad8515cc","uuid":"0d504f96-40a2-40ef-a9c4-2764f9db6670","title":"How did the compatibility war shape the frontend?","slug":"how-did-the-compatibility-war-shape-the-frontend","mobiledoc":"{\"version\":\"0.3.1\",\"atoms\":[],\"cards\":[],\"markups\":[],\"sections\":[[1,\"p\",[[0,[],0,\"The issue of incompatible software or hardware versions has probably caused us problems in our daily lives more than once. You may have encountered situations or noticed:\"]]],[1,\"p\",[[0,[],0,\"Maybe as an entrepreneur, you have already been faced with the problem of migrating your IT system, or as a programmer, you have struggled with errors caused by updating a particular package.\"]]],[1,\"p\",[[0,[],0,\"This article aims to show how backward compatibility has influenced the direction of development of web technologies.\"]]],[1,\"p\",[[0,[],0,\"Understanding the mechanisms that I will describe will help you predict technology trends more easily and optimize decisions about which technology to invest in.\"]]],[1,\"p\",[[0,[],0,\"The compatibility war shaped today's web.\"]]],[1,\"p\",[[0,[],0,\"The compatibility issue is not just a problem for ordinary people, but a matter that significantly affects the direction of civilization development. Thanks to it, or due to its lack, certain technologies can grow while others are forgotten.\"]]],[1,\"p\",[[0,[],0,\"Let's take the example of the history of web frontend development, which I will briefly outline. It was the beginning of the millennium. Browser creators fought a fierce battle for customers, trying to attract them with increasingly new features. They worked independently, and when they released them, the programmers had to learn the browser specifications and became more and more frustrated.\"]]],[1,\"p\",[[0,[],0,\"Often, it was necessary to write separate code for each browser to perform the same task. Some even changed their API several times between versions! Instead of querying the window width, the programmer would first check which browser they were dealing with, and only then execute the appropriate commands based on the detected browser in a long list of conditions.\"]]],[1,\"p\",[[0,[],0,\"In these conditions, the jQuery library appeared in 2005. It acted as a mediator between web developers and browsers. It quickly gained popularity because while it added some load to the browser, it reduced the amount of code that needed to be written by the developer, and additionally it took on the responsibility of handling older browsers. As it gained popularity, it introduced innovative solutions such as some selectors for searching elements on the page which later became a permanent part of the standards. An innumerable amount of plugins were written for jQuery and by 2012 it became a technology that every web developer needed to know to create websites.\"]]],[1,\"p\",[[0,[],0,\"Everyone knew that code without jQuery often works much faster, but the huge success of jQuery shows how great the reward is for solving the compatibility problem that always arises when dynamically building modern technologies.\"]]],[1,\"p\",[[0,[],0,\"The popularity of jQuery began to decline only when it became clear that browser makers had reached an agreement and organized the implementation process of recommendations from standardizing organizations such as W3C. This organization was created through cooperation between MIT and CERN with the support of DARPA and the European Commission, and ensures that web technologies are compatible and provides documentation for language and browser creators. Building it in a thoughtful way now allows for achieving a much more difficult goal - forward compatibility. This means that web standards are now designed so that their later changes will not cause problems with the previous versions' operation.\"]]],[1,\"p\",[[0,[],0,\"However, that's not the end of the story. Perhaps you're interested in what happened to web technologies after jQuery slowly became unnecessary.\"]]],[1,\"p\",[[0,[],0,\"In 2013, Angular Js, a framework created by Google 4 years prior, started gaining popularity. At the same time, Facebook announced the development of React. Both tools implemented a declarative paradigm for building interfaces using stateless components. In short, the programmer defined conditions for how the frontend should work, and the components took responsibility for the visual layer, leaving more attention for the programmer to work on business logic. In simpler terms, both made coding even faster than with jQuery.\"]]],[1,\"p\",[[0,[],0,\"Angular Js started as the first and had an advantage. I remember being amazed when my friend showed me an application written in Angular Js for the first time in 2015. Everything indicated that it was worth learning Angular Js more than React back then.\"]]],[1,\"p\",[[0,[],0,\"In 2016, Angular 2.0 was released without Js. Initially, it was supposed to be just another version of Angular Js, but design decisions made it incompatible with the first version of Angular Js. From the beginning, this caused controversy. Similarly, from this point on, new versions were supposed to be released every six months and backward compatibility was only guaranteed for the two previous versions.\"]]],[1,\"p\",[[0,[],0,\"Web frameworks grew rapidly, there were more and more of them, and 2017 became a year of \\\"Which new framework will I learn today?\\\" slogan. At the programming school where I taught, the question was asked: \\\"Which framework should we teach our students?\\\" Its founder chose React. Backward compatibility was a significant factor in this decision.\"]]],[1,\"p\",[[0,[],0,\"It is easy to guess that many creators of educational materials wanted the course they produced to bring them benefits for a longer period of time. Many programmers wanted to learn a tool that would work in the same way a year from now and with which updates would not increase maintenance costs.\"]]],[1,\"p\",[[0,[],0,\"In 2017 - a year after Angular abused the backward compatibility trust and React overtook Angular and never released that lead.\"]]],[1,\"p\",[[0,[],0,\"What lesson can be drawn from this story? That compatibility is one of the crucial factors that should be taken seriously when analyzing or planning technology development.\"]]],[1,\"p\",[[0,[],0,\"Sources for further reading:\"]]],[1,\"p\",[[0,[],0,\"Compatibility with the example of monitors\"]]],[1,\"p\",[[0,[],0,\"https://www.eizo.pl/en/baza-wiedzy/od-displayport-po-d-sub-przeglad-zlaczy-wideo-w-monitorach-lcd/\"]]],[1,\"p\",[[0,[],0,\"The European Commission wants to force Apple to abandon Lightning in iPhones.\"]]],[1,\"p\",[[0,[],0,\"https://www.spidersweb.pl/2018/08/iphone-lightning-charger.html\"]]],[1,\"p\",[[0,[],0,\"BIOS and disk problems\"]]],[1,\"p\",[[0,[],0,\"http://itfocus.pl/dzial-it/storage/duze-dyski-duze-klopoty/ Translation: http://itfocus.pl/dzial-it/storage/duze-dyski-duze-klopoty/\"]]],[1,\"p\",[[0,[],0,\"History of W3C\"]]],[1,\"p\",[[0,[],0,\"http://www.tlumaczenia-angielski.info/w3c/history.html\"]]]]}","html":"<p>The issue of incompatible software or hardware versions has probably caused us problems in our daily lives more than once. You may have encountered situations or noticed:</p><p>Maybe as an entrepreneur, you have already been faced with the problem of migrating your IT system, or as a programmer, you have struggled with errors caused by updating a particular package.</p><p>This article aims to show how backward compatibility has influenced the direction of development of web technologies.</p><p>Understanding the mechanisms that I will describe will help you predict technology trends more easily and optimize decisions about which technology to invest in.</p><p>The compatibility war shaped today's web.</p><p>The compatibility issue is not just a problem for ordinary people, but a matter that significantly affects the direction of civilization development. Thanks to it, or due to its lack, certain technologies can grow while others are forgotten.</p><p>Let's take the example of the history of web frontend development, which I will briefly outline. It was the beginning of the millennium. Browser creators fought a fierce battle for customers, trying to attract them with increasingly new features. They worked independently, and when they released them, the programmers had to learn the browser specifications and became more and more frustrated.</p><p>Often, it was necessary to write separate code for each browser to perform the same task. Some even changed their API several times between versions! Instead of querying the window width, the programmer would first check which browser they were dealing with, and only then execute the appropriate commands based on the detected browser in a long list of conditions.</p><p>In these conditions, the jQuery library appeared in 2005. It acted as a mediator between web developers and browsers. It quickly gained popularity because while it added some load to the browser, it reduced the amount of code that needed to be written by the developer, and additionally it took on the responsibility of handling older browsers. As it gained popularity, it introduced innovative solutions such as some selectors for searching elements on the page which later became a permanent part of the standards. An innumerable amount of plugins were written for jQuery and by 2012 it became a technology that every web developer needed to know to create websites.</p><p>Everyone knew that code without jQuery often works much faster, but the huge success of jQuery shows how great the reward is for solving the compatibility problem that always arises when dynamically building modern technologies.</p><p>The popularity of jQuery began to decline only when it became clear that browser makers had reached an agreement and organized the implementation process of recommendations from standardizing organizations such as W3C. This organization was created through cooperation between MIT and CERN with the support of DARPA and the European Commission, and ensures that web technologies are compatible and provides documentation for language and browser creators. Building it in a thoughtful way now allows for achieving a much more difficult goal - forward compatibility. This means that web standards are now designed so that their later changes will not cause problems with the previous versions' operation.</p><p>However, that's not the end of the story. Perhaps you're interested in what happened to web technologies after jQuery slowly became unnecessary.</p><p>In 2013, Angular Js, a framework created by Google 4 years prior, started gaining popularity. At the same time, Facebook announced the development of React. Both tools implemented a declarative paradigm for building interfaces using stateless components. In short, the programmer defined conditions for how the frontend should work, and the components took responsibility for the visual layer, leaving more attention for the programmer to work on business logic. In simpler terms, both made coding even faster than with jQuery.</p><p>Angular Js started as the first and had an advantage. I remember being amazed when my friend showed me an application written in Angular Js for the first time in 2015. Everything indicated that it was worth learning Angular Js more than React back then.</p><p>In 2016, Angular 2.0 was released without Js. Initially, it was supposed to be just another version of Angular Js, but design decisions made it incompatible with the first version of Angular Js. From the beginning, this caused controversy. Similarly, from this point on, new versions were supposed to be released every six months and backward compatibility was only guaranteed for the two previous versions.</p><p>Web frameworks grew rapidly, there were more and more of them, and 2017 became a year of \"Which new framework will I learn today?\" slogan. At the programming school where I taught, the question was asked: \"Which framework should we teach our students?\" Its founder chose React. Backward compatibility was a significant factor in this decision.</p><p>It is easy to guess that many creators of educational materials wanted the course they produced to bring them benefits for a longer period of time. Many programmers wanted to learn a tool that would work in the same way a year from now and with which updates would not increase maintenance costs.</p><p>In 2017 - a year after Angular abused the backward compatibility trust and React overtook Angular and never released that lead.</p><p>What lesson can be drawn from this story? That compatibility is one of the crucial factors that should be taken seriously when analyzing or planning technology development.</p><p>Sources for further reading:</p><p>Compatibility with the example of monitors</p><p>https://www.eizo.pl/en/baza-wiedzy/od-displayport-po-d-sub-przeglad-zlaczy-wideo-w-monitorach-lcd/</p><p>The European Commission wants to force Apple to abandon Lightning in iPhones.</p><p>https://www.spidersweb.pl/2018/08/iphone-lightning-charger.html</p><p>BIOS and disk problems</p><p>http://itfocus.pl/dzial-it/storage/duze-dyski-duze-klopoty/ Translation: http://itfocus.pl/dzial-it/storage/duze-dyski-duze-klopoty/</p><p>History of W3C</p><p>http://www.tlumaczenia-angielski.info/w3c/history.html</p>","comment_id":"640b53120f360525ad8515cc","plaintext":"The issue of incompatible software or hardware versions has probably caused us problems in our daily lives more than once. You may have encountered situations or noticed:\n\nMaybe as an entrepreneur, you have already been faced with the problem of migrating your IT system, or as a programmer, you have struggled with errors caused by updating a particular package.\n\nThis article aims to show how backward compatibility has influenced the direction of development of web technologies.\n\nUnderstanding the mechanisms that I will describe will help you predict technology trends more easily and optimize decisions about which technology to invest in.\n\nThe compatibility war shaped today's web.\n\nThe compatibility issue is not just a problem for ordinary people, but a matter that significantly affects the direction of civilization development. Thanks to it, or due to its lack, certain technologies can grow while others are forgotten.\n\nLet's take the example of the history of web frontend development, which I will briefly outline. It was the beginning of the millennium. Browser creators fought a fierce battle for customers, trying to attract them with increasingly new features. They worked independently, and when they released them, the programmers had to learn the browser specifications and became more and more frustrated.\n\nOften, it was necessary to write separate code for each browser to perform the same task. Some even changed their API several times between versions! Instead of querying the window width, the programmer would first check which browser they were dealing with, and only then execute the appropriate commands based on the detected browser in a long list of conditions.\n\nIn these conditions, the jQuery library appeared in 2005. It acted as a mediator between web developers and browsers. It quickly gained popularity because while it added some load to the browser, it reduced the amount of code that needed to be written by the developer, and additionally it took on the responsibility of handling older browsers. As it gained popularity, it introduced innovative solutions such as some selectors for searching elements on the page which later became a permanent part of the standards. An innumerable amount of plugins were written for jQuery and by 2012 it became a technology that every web developer needed to know to create websites.\n\nEveryone knew that code without jQuery often works much faster, but the huge success of jQuery shows how great the reward is for solving the compatibility problem that always arises when dynamically building modern technologies.\n\nThe popularity of jQuery began to decline only when it became clear that browser makers had reached an agreement and organized the implementation process of recommendations from standardizing organizations such as W3C. This organization was created through cooperation between MIT and CERN with the support of DARPA and the European Commission, and ensures that web technologies are compatible and provides documentation for language and browser creators. Building it in a thoughtful way now allows for achieving a much more difficult goal - forward compatibility. This means that web standards are now designed so that their later changes will not cause problems with the previous versions' operation.\n\nHowever, that's not the end of the story. Perhaps you're interested in what happened to web technologies after jQuery slowly became unnecessary.\n\nIn 2013, Angular Js, a framework created by Google 4 years prior, started gaining popularity. At the same time, Facebook announced the development of React. Both tools implemented a declarative paradigm for building interfaces using stateless components. In short, the programmer defined conditions for how the frontend should work, and the components took responsibility for the visual layer, leaving more attention for the programmer to work on business logic. In simpler terms, both made coding even faster than with jQuery.\n\nAngular Js started as the first and had an advantage. I remember being amazed when my friend showed me an application written in Angular Js for the first time in 2015. Everything indicated that it was worth learning Angular Js more than React back then.\n\nIn 2016, Angular 2.0 was released without Js. Initially, it was supposed to be just another version of Angular Js, but design decisions made it incompatible with the first version of Angular Js. From the beginning, this caused controversy. Similarly, from this point on, new versions were supposed to be released every six months and backward compatibility was only guaranteed for the two previous versions.\n\nWeb frameworks grew rapidly, there were more and more of them, and 2017 became a year of \"Which new framework will I learn today?\" slogan. At the programming school where I taught, the question was asked: \"Which framework should we teach our students?\" Its founder chose React. Backward compatibility was a significant factor in this decision.\n\nIt is easy to guess that many creators of educational materials wanted the course they produced to bring them benefits for a longer period of time. Many programmers wanted to learn a tool that would work in the same way a year from now and with which updates would not increase maintenance costs.\n\nIn 2017 - a year after Angular abused the backward compatibility trust and React overtook Angular and never released that lead.\n\nWhat lesson can be drawn from this story? That compatibility is one of the crucial factors that should be taken seriously when analyzing or planning technology development.\n\nSources for further reading:\n\nCompatibility with the example of monitors\n\nhttps://www.eizo.pl/en/baza-wiedzy/od-displayport-po-d-sub-przeglad-zlaczy-wideo-w-monitorach-lcd/\n\nThe European Commission wants to force Apple to abandon Lightning in iPhones.\n\nhttps://www.spidersweb.pl/2018/08/iphone-lightning-charger.html\n\nBIOS and disk problems\n\nhttp://itfocus.pl/dzial-it/storage/duze-dyski-duze-klopoty/ Translation: http://itfocus.pl/dzial-it/storage/duze-dyski-duze-klopoty/\n\nHistory of W3C\n\nhttp://www.tlumaczenia-angielski.info/w3c/history.html","feature_image":null,"featured":0,"type":"post","status":"draft","locale":null,"visibility":"public","email_recipient_filter":"all","created_at":"2023-03-10T15:56:02.000Z","updated_at":"2023-03-10T15:56:02.000Z","published_at":"2023-03-10T15:56:01.000Z","custom_excerpt":null,"codeinjection_head":null,"codeinjection_foot":null,"custom_template":null,"canonical_url":null,"newsletter_id":null,"lexical":null},{"id":"641151130f360525ad8515d0","uuid":"b849ea4b-e38b-4faf-bc57-fed747e5de72","title":"How I created 24 videos in single day to promote my GPT-CLI","slug":"how-i-created-24-videos-in-single-day-to-promote-my-gpt-cli","mobiledoc":"{\"version\":\"0.3.1\",\"atoms\":[],\"cards\":[[\"code\",{\"code\":\"gtts-cli \\\"$(cat pl.txt)\\\" -l pl --output pl.mp3\"}],[\"code\",{\"code\":\"yes | ffmpeg -i pl.mp3 -filter:a \\\"atempo=2.0\\\" pl2.mp3\"}],[\"code\",{\"code\":\"mpg123 pl2.mp3\"}],[\"code\",{\"code\":\"ffprobe -i pl2.mp3 -show_entries format=duration -v quiet -of csv=\\\"p=0\\\"\"}],[\"code\",{\"code\":\"p get length of pl2.mp3 file in seconds\"}],[\"code\",{\"code\":\"p write bash script that iterate over all text files starting from pl and ending on txt and execute on them command cat\"}],[\"code\",{\"code\":\"for file in pl*.txt; do\\n    cat $file\\ndone\\n\"}],[\"code\",{\"code\":\"p get number that is after \\\"pl-\\\" and before \\\".txt\\\" extension form file name saved in env $file\"}],[\"code\",{\"code\":\"echo $env | grep -oP '(?<=pl\\\\-)\\\\d+(?=\\\\.txt)'\"}],[\"code\",{\"code\":\"#!/bin/bash\\n\\nfor file in pl*.txt; do\\n    num=`echo $file | grep -oP '(?<=pl\\\\-)\\\\d+(?=\\\\.txt)';`\\n    echo $num;\\n    gtts-cli \\\"$(cat $file)\\\" -l pl --output pl-${num}.mp3\\n    yes | ffmpeg -i pl-${num}.mp3 -filter:a \\\"atempo=2.0\\\" pl-${num}i.mp3\\ndone\\n\"}],[\"code\",{\"code\":\"#!/bin/bash\\n\\nexport GPT_SYSTEM_PROMPT=\\\"I am translator from polish to english. I need to translate this text.\\\"; \\nexport GPT_POST=out;\\n\\nfor file in pl*.txt; do\\n    num=`echo $file | grep -oP '(?<=pl\\\\-)\\\\d+(?=\\\\.txt)';`\\n    echo \\\"Num: ${num}\\\"\\n    p \\\"$(cat ${file})\\\" > en-${num}.txt\\n    cat en-${num}.txt\\ndone\\n\\nunset GPT_SYSTEM_PROMPT;\\nunset GPT_POST;\",\"language\":\"bash\"}],[\"code\",{\"code\":\"#!/bin/bash\\n\\nfor file in ${LANG}*.txt; do\\n    num=`echo \\\"$file\\\" | grep -oP \\\"(?<=${LANG}-)\\\\d+(?=\\\\.txt)\\\";`\\n    echo $num;\\n    gtts-cli \\\"$(cat $file)\\\" -l ${LANG} --output ${LANG}-${num}.mp3\\n    yes | ffmpeg -i ${LANG}-${num}.mp3 -filter:a \\\"atempo=2.0\\\" ${LANG}-${num}i.mp3\\ndone\",\"language\":\"bash\"}],[\"code\",{\"code\":\"LANG=en ./read.sh\"}],[\"code\",{\"code\":\"gtts-cli --all\\n  af: Afrikaans\\n  ar: Arabic\\n  bn: Bengali\\n  ...\\n  zh: Chinese (Mandarin)\"}],[\"code\",{\"code\":\"en: English\\nes: Spanish\\nzh: Chinese (Mandarin)\\nhi: Hindi\\nar: Arabic\\nbn: Bengali\\npt: Portuguese\\nru: Russian\\nja: Japanese\\npa: Punjabi\\nde: German\\njv: Javanese\\nms: Malay\\nte: Telugu\\nvi: Vietnamese\\nko: Korean\\nfr: French\\nmr: Marathi\\nta: Tamil\\ntr: Turkish\\nit: Italian\\nth: Thai\\nnl: Dutch\\npl: Polish\"}],[\"code\",{\"code\":\"#!/bin/bash\\n\\n# Set default value for LANG_SHORT\\n: ${LANG_SHORT:=pl}\\n\\n# Use the value of LANG_SHORT in your script\\necho \\\"LANG_SHORT is set to $LANG_SHORT\\\"\"}],[\"code\",{\"code\":\"#!/bin/bash\\n\\n: ${FROM_SHORT:=pl}\\n: ${TO_SHORT:=en}\\n\\n: ${FROM_LONG:=Polish}\\n: ${TO_LONG:=English}\\n\\n\\nexport GPT_SYSTEM_PROMPT=\\\"I am translator from ${FROM_LONG} to ${TO_LONG}. I need to translate this text.\\\"; \\nexport GPT_POST=out;\\n\\nfor file in ${FROM_SHORT}*.txt; do\\n    num=`echo \\\"$file\\\" | grep -oP \\\"(?<=${FROM_SHORT}-)\\\\d+(?=\\\\.txt)\\\";`\\n    echo \\\"Num: ${num}\\\"\\n    p \\\"$(cat ${file})\\\" > ${TO_SHORT}-${num}.txt\\n    cat ${TO_SHORT}-${num}.txt\\n    if [ ! -s ${TO_SHORT}-${num}.txt ]; then\\n      echo \\\"File is empty or doesn't exist. Exiting script.\\\"\\n      exit 1\\n    fi\\ndone\\n\\nunset GPT_SYSTEM_PROMPT;\\nunset GPT_POST;\"}],[\"code\",{\"code\":\"#!/usr/bin/env bash\\n\\nexport FROM_SHORT=en\\nexport FROM_LONG=English\\n\\nTO_SHORT=es TO_LONG=Spanish ./translate.sh\\nTO_SHORT=zh TO_LONG=Chinese ./translate.sh\\nTO_SHORT=hi TO_LONG=Hindi ./translate.sh\\nTO_SHORT=ar TO_LONG=Arabic ./translate.sh\\nTO_SHORT=bn TO_LONG=Bengali ./translate.sh\\nTO_SHORT=pt TO_LONG=Portuguese ./translate.sh\\nTO_SHORT=ru TO_LONG=Russian ./translate.sh\\nTO_SHORT=ja TO_LONG=Japanese ./translate.sh\\nTO_SHORT=pa TO_LONG=Punjabi ./translate.sh\\nTO_SHORT=de TO_LONG=German ./translate.sh\\nTO_SHORT=jv TO_LONG=Javanese ./translate.sh\\nTO_SHORT=ms TO_LONG=Malay ./translate.sh\\nTO_SHORT=te TO_LONG=Telugu ./translate.sh\\nTO_SHORT=vi TO_LONG=Vietnamese ./translate.sh\\nTO_SHORT=ko TO_LONG=Korean ./translate.sh\\nTO_SHORT=fr TO_LONG=French ./translate.sh\\nTO_SHORT=mr TO_LONG=Marathi ./translate.sh\\nTO_SHORT=ta TO_LONG=Tamil ./translate.sh\\nTO_SHORT=tr TO_LONG=Turkish ./translate.sh\\nTO_SHORT=it TO_LONG=Italian ./translate.sh\\nTO_SHORT=th TO_LONG=Thai ./translate.sh\\nTO_SHORT=nl TO_LONG=Dutch ./translate.sh\\n\"}],[\"code\",{\"code\":\"#!/bin/bash\\n\\nfor file in ${LANG}*.txt; do\\n    num=`echo \\\"$file\\\" | grep -oP \\\"(?<=${LANG}-)\\\\d+(?=\\\\.txt)\\\";`\\n    echo $num;\\n    gtts-cli \\\"$(cat $file)\\\" -l ${LANG} --output ${LANG}-${num}.mp3\\n    yes | ffmpeg -i ${LANG}-${num}.mp3 -filter:a \\\"atempo=2.0\\\" ${LANG}-${num}i.mp3\\n    mkdir -p \\\"${LANG}i\\\"\\n    mv ${LANG}-*i.mp3 \\\"${LANG}i\\\"\\ndone\\n\"}],[\"code\",{\"code\":\"#!/usr/bin/env bash\\n\\nLANG=\\\"en\\\" ./read.sh\\nLANG=\\\"pl\\\" ./read.sh\\nLANG=\\\"es\\\" ./read.sh\\nLANG=\\\"zh\\\" ./read.sh\\nLANG=\\\"hi\\\" ./read.sh\\nLANG=\\\"ar\\\" ./read.sh\\nLANG=\\\"bn\\\" ./read.sh\\nLANG=\\\"pt\\\" ./read.sh\\nLANG=\\\"ru\\\" ./read.sh\\nLANG=\\\"ja\\\" ./read.sh\\nLANG=\\\"pa\\\" ./read.sh\\nLANG=\\\"de\\\" ./read.sh\\nLANG=\\\"jv\\\" ./read.sh\\nLANG=\\\"ms\\\" ./read.sh\\nLANG=\\\"te\\\" ./read.sh\\nLANG=\\\"vi\\\" ./read.sh\\nLANG=\\\"ko\\\" ./read.sh\\nLANG=\\\"fr\\\" ./read.sh\\nLANG=\\\"mr\\\" ./read.sh\\nLANG=\\\"ta\\\" ./read.sh\\nLANG=\\\"tr\\\" ./read.sh\\nLANG=\\\"it\\\" ./read.sh\\nLANG=\\\"th\\\" ./read.sh\\nLANG=\\\"nl\\\" ./read.sh\"}],[\"image\",{\"src\":\"__GHOST_URL__/content/images/2023/03/Zrzut-ekranu-z-2023-03-17-13-43-03.png\",\"width\":607,\"height\":369}],[\"bookmark\",{\"version\":\"1.0\",\"type\":\"bookmark\",\"url\":\"http://voice2json.org/#getting-started\",\"metadata\":{\"url\":\"http://voice2json.org/\",\"title\":\"voice2json\",\"description\":\"Command-line tools for speech and intent recognition on Linux\",\"author\":null,\"publisher\":\"voice2json\",\"thumbnail\":\"http://voice2json.org/img/voice2json.svg\",\"icon\":null}}],[\"image\",{\"src\":\"__GHOST_URL__/content/images/2023/03/Zrzut-ekranu-z-2023-03-17-14-06-02.png\",\"width\":203,\"height\":527}],[\"bookmark\",{\"version\":\"1.0\",\"type\":\"bookmark\",\"url\":\"https://github.com/openai/whisper\",\"metadata\":{\"url\":\"https://github.com/openai/whisper\",\"title\":\"GitHub - openai/whisper: Robust Speech Recognition via Large-Scale Weak Supervision\",\"description\":\"Robust Speech Recognition via Large-Scale Weak Supervision - GitHub - openai/whisper: Robust Speech Recognition via Large-Scale Weak Supervision\",\"author\":\"openai\",\"publisher\":\"GitHub\",\"thumbnail\":\"https://opengraph.githubassets.com/fe5e99c6eb3717c4ee426b34983b5a17162c217dce8f6791d0a371906b0cdfe7/openai/whisper\",\"icon\":\"https://github.com/fluidicon.png\"}}],[\"image\",{\"src\":\"__GHOST_URL__/content/images/2023/03/language-breakdown.svg\",\"width\":871,\"height\":1168}],[\"bookmark\",{\"version\":\"1.0\",\"type\":\"bookmark\",\"url\":\"https://github.com/numba/numba/issues/8304#issuecomment-1456646575\",\"metadata\":{\"url\":\"https://github.com/numba/numba/issues/8304\",\"title\":\"Python 3.11 · Issue #8304 · numba/numba\",\"description\":\"This is the meta/coordination issue for Python 3.11 support for Numba and llvmlite. Note: The issue text will be updated continuously to reflect the current process and progress. As Numba interface…\",\"author\":\"numba\",\"publisher\":\"GitHub\",\"thumbnail\":\"https://opengraph.githubassets.com/14a5903c4c15226547b397ba736a2869d14420f2b2a20941b978c12cef4f1a78/numba/numba/issues/8304\",\"icon\":\"https://github.com/fluidicon.png\"}}],[\"code\",{\"code\":\"curl --request POST \\\\\\n  --url https://api.openai.com/v1/audio/transcriptions \\\\\\n  --header \\\"Authorization: Bearer ${GPT3_API_KEY}\\\" \\\\\\n  --header 'Content-Type: multipart/form-data' \\\\\\n  --form file=@en-3i.mp3 \\\\\\n  --form model=whisper-1 | jq \\\".text\\\"\"}],[\"code\",{\"code\":\"p ffmpeg convert ar.mp4 to ar.mp3 \"}],[\"code\",{\"code\":\"ffmpeg -i ar.mp4 ar.mp3\"}],[\"code\",{\"code\":\"curl --request POST \\\\                                                 \\n  --url https://api.openai.com/v1/audio/transcriptions \\\\\\n  --header 'Authorization: Bearer ${GPT3_API_KEY}' \\\\\\n  --header 'Content-Type: multipart/form-data' \\\\\\n  --form file=@ar.mp3 \\\\   \\n  --form model=whisper-1 | jq \\\".text\\\"\"}],[\"code\",{\"code\":\"curl --request POST \\\\      \\n  --url https://api.openai.com/v1/audio/translations \\\\\\n  --header \\\"Authorization: Bearer ${GPT3_API_KEY}\\\" \\\\\\n  --header 'Content-Type: multipart/form-data' \\\\\\n  --form file=@ar.mp3 \\\\\\n  --form model=whisper-1 --form response_format=text\"}],[\"image\",{\"src\":\"__GHOST_URL__/content/images/2023/03/Zrzut-ekranu-z-2023-03-17-17-36-46.png\",\"width\":1656,\"height\":433,\"cardWidth\":\"full\"}],[\"bookmark\",{\"version\":\"1.0\",\"type\":\"bookmark\",\"url\":\"https://subtitlestranslator.com/en/\",\"metadata\":{\"url\":\"https://www.subtitlestranslator.com/en\",\"title\":\"Free online subtitle translator.\",\"description\":\"Free online subtitles translator. Quickly translate multiple subtitle files at once. Supports major file formats and allows you to translate to over 80 different languages.\",\"author\":null,\"publisher\":\"Subtitles Translator\",\"thumbnail\":\"https://subtitlestranslator.com/resources/images/left_arrow.svg\",\"icon\":\"https://subtitlestranslator.com/resources/images/icon.png\"}}],[\"bookmark\",{\"version\":\"1.0\",\"type\":\"bookmark\",\"url\":\"https://stenograf.io/\",\"metadata\":{\"url\":\"https://www.stenograf.io/\",\"title\":\"Automatyczna transkrypcja nagrań\",\"description\":\"Twórz napisy do nagrań wideo i audio. Stenograf to narzędzie do automatycznej konwersji audio na tekst. Wypróbuj za darmo!\",\"author\":null,\"publisher\":null,\"thumbnail\":\"https://www.stenograf.io/img/StenografBigLogo.png\",\"icon\":\"https://stenograf.io/img/favicon-gradient.ico\"}}],[\"bookmark\",{\"version\":\"1.0\",\"type\":\"bookmark\",\"url\":\"https://www.pairaphrase.com/how-it-works/api-for-developers/\",\"metadata\":{\"url\":\"https://www.pairaphrase.com/how-it-works/api-for-developers/\",\"title\":\"Translation Software API\",\"description\":\"Need a cloud translation software API for websites, documents & more? Learn about Pairaphrase’s secure language translation API.\",\"author\":null,\"publisher\":\"Pairaphrase\",\"thumbnail\":\"https://www.pairaphrase.com/wp-content/uploads/2020/10/translation-software-api-1-300x252.png\",\"icon\":\"https://www.pairaphrase.com/wp-content/uploads/2022/10/icon.png?v=1\"}}],[\"code\",{\"code\":\"GPT_SYSTEM_PROMPT=\\\"I am sbv files translator to polish. I need to translate this text not changing numbers with time.\\\" GPT_POST=out p \\\"$(cat captions.sbv)\\\"\"}],[\"bookmark\",{\"version\":\"1.0\",\"type\":\"bookmark\",\"url\":\"https://www.checksub.com/\",\"metadata\":{\"url\":\"https://www.checksub.com/\",\"title\":\"Checksub: Create impactful videos | Add Captions and Subtitles easily\",\"description\":\"Create an impactful video💥 thanks to the best subtitling and captioning platform. Generate your captions and translate them automatically.\",\"author\":null,\"publisher\":\"Checksub\",\"thumbnail\":\"https://www.checksub.com/wp-content/themes/checksub/images/Cheksub-white-min.png\",\"icon\":\"https://www.checksub.com/wp-content/themes/checksub/images/favicon.png?v=1660724351970\"}}],[\"hr\",{}]],\"markups\":[[\"code\"]],\"sections\":[[1,\"p\",[[0,[],0,\"I created awesome tool that allow you to ask gpt3.5 for linux commands. It is so awesome, that I decided to put more effort in advertising it. In this article I am showing how I did it.\"]]],[1,\"h2\",[[0,[],0,\"Recording video in OBS\"]]],[1,\"p\",[[0,[],0,\"I decided to record only terminal. So I installed \"],[0,[0],1,\"obs\"],[0,[],0,\" and created scene with source as \"],[0,[0],1,\"Windows Capture (PipeWire)\"],[0,[],0,\". I received \"],[0,[0],1,\"mp4\"],[0,[],0,\" but there was some mistakes that i decided to cut.\"]]],[1,\"h2\",[[0,[],0,\"Removing bad fragments in LightWorks\"]]],[1,\"p\",[[0,[],0,\"I had a lot of problems with \"],[0,[0],1,\"DavinciResolve\"],[0,[],0,\" so decided to install \"],[0,[0],1,\"LightWorks\"],[0,[],0,\" that at least works. To use it you have to know shortcuts:\"]]],[3,\"ul\",[[[0,[0],1,\"c\"],[0,[],0,\" for dividing clip\"]],[[0,[0],1,\"a\"],[0,[],0,\" and \"],[0,[0],1,\"s\"],[0,[],0,\" for moving to next part\"]],[[0,[0],1,\"space\"],[0,[],0,\" for stop/play\"]],[[0,[0],1,\"j\"],[0,[],0,\" and \"],[0,[0],1,\"l\"],[0,[],0,\" for fast go right or left on timeline\"]]]],[1,\"p\",[[0,[],0,\"I added effect by \"],[0,[0],1,\"VFX\"],[0,[],0,\" and \"],[0,[0],1,\"DVE\"],[0,[],0,\" to change position and size of terminal, and decided to add colour correction to have more fancy look.\"]]],[1,\"h2\",[[0,[],0,\"Voice\"]]],[1,\"p\",[[0,[],0,\"I created file \"],[0,[0],1,\"pl.txt\"],[0,[],0,\" with my text. Converted it to voice by command\"]]],[10,0],[1,\"p\",[[0,[],0,\"Then speedup it by \"]]],[10,1],[1,\"p\",[[0,[],0,\"I could play it by\"]]],[10,2],[1,\"p\",[[0,[],0,\"and measure length of \"],[0,[0],1,\"mp3\"],[0,[],0,\" by\"]]],[10,3],[1,\"p\",[[0,[],0,\"Of course I did not know all these command and did not found them on stackoverflow. I was using my own tool, that I want to promote. For example to find last one I typed to terminal this:\"]]],[10,4],[1,\"p\",[[0,[],0,\"In my opinion it is revolution... But let's check what happened next.\"]]],[1,\"p\",[[0,[],0,\"I created 15 files called \"],[0,[0],1,\"pl-n.txt\"],[0,[],0,\" where \"],[0,[0],1,\"n\"],[0,[],0,\" was numbers from \"],[0,[0],1,\"1\"],[0,[],0,\" to \"],[0,[0],1,\"15\"],[0,[],0,\" and asked.\"]]],[10,5],[1,\"p\",[[0,[],0,\"I received this:\"]]],[10,6],[1,\"p\",[[0,[],0,\"Great. I edited it to this form. Next question:\"]]],[10,7],[1,\"p\",[[0,[],0,\"and answer:\"]]],[10,8],[1,\"p\",[[0,[],0,\"few minutes later I had\"]]],[10,9],[1,\"h2\",[[0,[],0,\"Translations\"]]],[1,\"p\",[[0,[],0,\"Now I have to translate them to different languages. Chat gpt is great in translations, but is there any cli that simplify this process? Hmm... Yea\"]]],[1,\"p\",[[0,[],0,\"Again I decided to use \"],[0,[0],1,\"gpt-cli\"],[0,[],0,\" written 2 days ago in this using script \"],[0,[0],1,\"translate.sh\"]]],[10,10],[1,\"p\",[[0,[],0,\"Let's modify our \"],[0,[0],1,\"read.sh\"],[0,[],0,\" script to generalize it for any \"],[0,[0],1,\"LANG\"]]],[10,11],[1,\"p\",[[0,[],0,\"and use\"]]],[10,12],[1,\"p\",[[0,[],0,\"With these two scripts we generated already audio files for two languages.\"]]],[1,\"p\",[[0,[],0,\"Now it is time to select languages to translate. We can do it in two steps.\"]]],[3,\"ol\",[[[0,[],0,\"Ask about possible languages:\"]]]],[10,13],[1,\"p\",[[0,[],0,\"and copy these languages to chat asking about first 24 in ordered by popularity. It is our list:\"]]],[10,14],[1,\"p\",[[0,[],0,\"Now we can modify our translation script using syntax\"]]],[10,15],[1,\"p\",[[0,[],0,\"The \"],[0,[0],1,\":=\"],[0,[],0,\" operator assigns the default value \\\"pl\\\" to \"],[0,[0],1,\"LANG_SHORT\"],[0,[],0,\" if it is unset or null. The : before the operator is a null command that does nothing, but is necessary to avoid a syntax error if \"],[0,[0],1,\"LANG_SHORT\"],[0,[],0,\" is unset.\"]]],[10,16],[1,\"p\",[[0,[],0,\"Now we need to set \"],[0,[0],1,\"from\"],[0,[],0,\" as english and use rest languages in loop that\"]]],[1,\"p\",[[0,[],0,\"This simple script automate our work\"]]],[10,17],[1,\"p\",[[0,[],0,\"After this command we have 360 files, 15 files for any of 24 languages. So let's read them all using \"],[0,[0],1,\"gtts-cli\"],[0,[],0,\".\"]]],[1,\"p\",[[0,[],0,\"We can improve our \"],[0,[0],1,\"read.sh\"],[0,[],0,\" again to move all final files to directories.\"]]],[10,18],[1,\"p\",[[0,[],0,\"and to read all we can use \"],[0,[0],1,\"read_all.sh\"],[0,[],0,\" script\"]]],[10,19],[1,\"p\",[[0,[],0,\"There was problem with reading \"],[0,[0],1,\"pa\"],[0,[],0,\", \"],[0,[0],1,\"jv\"],[0,[],0,\" and \"],[0,[0],1,\"ms\"],[0,[],0,\" languages.\"]]],[3,\"ul\",[[[0,[],0,\"pa: Punjabi\"]],[[0,[],0,\"jv: Javanese\"]],[[0,[],0,\"ms: Malay\"]]]],[1,\"p\",[[0,[],0,\"in agreement with Pareto rule I decided to skip it, but after preparing Arabic video I understand that I can't verify it so if there are text like \\\"I apologize, but I can't translate this sentence\\\", then I do not have any method of check it.\"]]],[1,\"h2\",[[0,[],0,\"Verification\"]]],[1,\"p\",[[0,[],0,\"I decided to invert this process to verify it. So what we did:\"]]],[3,\"ul\",[[[0,[],0,\"prepared text in english\"]],[[0,[],0,\"translated to other languages\"]],[[0,[],0,\"converted text to speech\"]]]],[1,\"p\",[[0,[],0,\"And now we are going to\"]]],[3,\"ul\",[[[0,[],0,\"convert speech to text\"]],[[0,[],0,\"translate it again to english\"]],[[0,[],0,\"compare original with result of processing\"]]]],[1,\"p\",[[0,[],0,\"If machine is able to understand it then we can assume that our movies are correct.\"]]],[10,20],[1,\"p\",[[0,[],0,\"Unfortunately voice2json do not support all our languages\"]]],[10,21],[1,\"p\",[[0,[],0,\"There are supported\"]]],[3,\"ul\",[[[0,[],0,\"Catalan (\"],[0,[0],1,\"ca\"],[0,[],0,\")\"]],[[0,[],0,\"Czech (\"],[0,[0],1,\"cs\"],[0,[],0,\")\"]],[[0,[],0,\"German (\"],[0,[0],1,\"de\"],[0,[],0,\")\"]],[[0,[],0,\"Greek (\"],[0,[0],1,\"el\"],[0,[],0,\")\"]],[[0,[],0,\"English (\"],[0,[0],1,\"en\"],[0,[],0,\")\"]],[[0,[],0,\"Spanish (\"],[0,[0],1,\"es\"],[0,[],0,\")\"]],[[0,[],0,\"French (\"],[0,[0],1,\"fr\"],[0,[],0,\")\"]],[[0,[],0,\"Hindi (\"],[0,[0],1,\"hi\"],[0,[],0,\")\"]],[[0,[],0,\"Italian (\"],[0,[0],1,\"it\"],[0,[],0,\")\"]],[[0,[],0,\"Korean (\"],[0,[0],1,\"ko\"],[0,[],0,\")\"]],[[0,[],0,\"Kazakh (\"],[0,[0],1,\"kz\"],[0,[],0,\")\"]],[[0,[],0,\"Dutch (\"],[0,[0],1,\"nl\"],[0,[],0,\")\"]],[[0,[],0,\"Polish (\"],[0,[0],1,\"pl\"],[0,[],0,\")\"]],[[0,[],0,\"Portuguese (\"],[0,[0],1,\"pt\"],[0,[],0,\")\"]],[[0,[],0,\"Russian (\"],[0,[0],1,\"ru\"],[0,[],0,\")\"]],[[0,[],0,\"Swedish (\"],[0,[0],1,\"sv\"],[0,[],0,\")\"]],[[0,[],0,\"Vietnamese (\"],[0,[0],1,\"vi\"],[0,[],0,\")\"]],[[0,[],0,\"Mandarin (\"],[0,[0],1,\"zh\"],[0,[],0,\")\"]]]],[1,\"p\",[[0,[],0,\"Using \"],[0,[0],1,\"voice2json\"],[0,[],0,\" we can use only 12 languages.\"]]],[10,22],[1,\"p\",[[0,[],0,\"Other tool is whisper also from openai\"]]],[10,23],[10,24],[1,\"p\",[[0,[],0,\"we can't install it today because open issue\"]]],[10,25],[1,\"p\",[[0,[],0,\"but there is \"],[0,[0],1,\"api\"]]],[10,26],[1,\"p\",[[0,[],0,\"So to convert \"],[0,[0],1,\"mp4\"],[0,[],0,\" to \"],[0,[0],1,\"mp3\"],[0,[],0,\" you can simply type\"]]],[10,27],[1,\"p\",[[0,[],0,\"or\"]]],[10,28],[1,\"p\",[[0,[],0,\"and then after\"]]],[10,29],[1,\"p\",[[0,[],0,\"I saw:\"]]],[1,\"p\",[[0,[],0,\"لا تعرف أو لا تتذكر أوامر الانكس ما عليك سوى كتابة النص باللغة العادية وسيقوم روبوت الدردشة جي كي تي بكتابة الأوامر لك بفضل عدة دقائق من البحث في هندسة النص المحفزة فقد وضعت لك نص محفزا سيغير حياتك بتوفيرك الليالي الساهرة التي تنفقها في التبديل بين الوحدة أطرفية وستاك أوفرو فلو في هذا الفيديو يمكنك مشاهدة كيف يمكنك بدلا من كتابة الأعلامات المخصصة لأمر جي كيو وصف العملية التي تريد تحقيقها ببساطة، الآن لقد قمنا بحفظ ملف طبع جي اس أو إن باستخدام ترميز بيس 64 كان الأمر سهلا جدا للأسف كنا نريد شكل بيس 64 لتخلصي من الأسطور الجديدة ولكن من يتذكر هذا العلم لأمر بيس 64 الهاكرز نعم ولكن أنا مبتدئ الآن نعرض ساعة على الطرفية والآن تسلسل من 100 إلى 60 بخطوة 6 بصراحة لن أعرف ترتيب هذه الحجج وتحقق منها سيستغرق حوالي 10 ثوان من الحياة أو 10 ثوان من فوات الأجل إذا كانت اختباراتنا في لغة الروس تعمل بشكل متزامن أثناء التعامل مع المورد نفسه فمن الجدير بتشغيل بطريقة تتبعية الآن تعرف الفا إذا كنت مبتدئا ولا تعرف أوامر لينيكس فلن تحتاج إلى ذلك مع اكس دي إذا نسيت نسخة نظام التشغيل الخاص بك ولا تعرف كيفية تتحقق منه لا تقلق يمكنك أيضا الاستفسار عن عدد الحزم المثبتة أو ببساطة سرد قائمتها أتحقق من إصدارات دوكر هل فكرت أنه يجب أن يكون هناك خط أفقي قبل الإصدار يمكن أن يكون هناك ولكنه ليس ضروريا إذا كنت متطرن لتعامل مع لغة بيتش بي في ايتش بي ولكن لا تعرفها يمكنك ببساطة تغليف بها في طبقة انعكاسية توفرها شات جي بي تي جي بي تي وإذا لم تتذكر كيفية إعداد خادم محلي وتحتاج إليه في الأمس فها هو لقد كتبت طلب ايتش تي بي من الصفر لاختباره في النهاية نفتح خادم ان سي ونتصل به لنقل البيانات في الوقت الحقيقي بين المحطات تحقق إذا كانت تعمل لك وإذا كانت تعمل عرضها على أصدقائك آسف أنت في اي جي تي وربما مثلي لا يوجد لديك أصدقاء اكس دي\"]]],[1,\"p\",[[0,[],0,\"Hmm. Looks great, but what it means? Fortunately changing \"],[0,[0],1,\"transcriptions\"],[0,[],0,\" to \"],[0,[0],1,\"translations\"],[0,[],0,\" we can see:\"]]],[10,30],[1,\"p\",[[0,[],0,\"It is hard to say if result is readable. But I am rather considering it as low quality.\"]]],[10,31],[1,\"p\",[[0,[],0,\" To make it better I should add subtitles. I tried this service\"]]],[10,32],[1,\"p\",[[0,[],0,\"But it does not provide api, and process part of files on fronted, but part on backend. I was also considering this one\"]]],[10,33],[1,\"p\",[[0,[],0,\"but it is also gui tool without API. I rejected also this one with price $0.0005 per word.\"]]],[10,34],[1,\"p\",[[0,[],0,\"In the English language, people speak about 140 words per minute. A fast speaker will get to 170. So with super fast speaker it will cost $6 per hour. Not bad, but this price require package that costs 400 USD.\"]]],[1,\"p\",[[0,[],0,\"I decided again to use GPT-3 command line that I wrote.\"]]],[10,35],[1,\"p\",[[0,[],0,\"Results was weak again so I decided to change workflow. Research showed that there are more tools, like this one:\"]]],[10,36],[1,\"p\",[[0,[],0,\"But finally I stopped with the following flow:\"]]],[3,\"ul\",[[[0,[],0,\"english text -> translated text -> speech -> recognized text -> english text\"]]]],[1,\"p\",[[0,[],0,\"and was unsatisfied with result. So tried to fix it by providing subtitles that will improve quality. Problem was that subtitles are organised in texts that showing between given time period, when original text is organised to sentences that covers selected topics.\"]]],[10,37],[1,\"p\",[[0,[],0,\"I did not found solution for it now because I have to create multilingual context anyway, so I hope I will improve this process in future. Now as proof of concept I decided to write one more script to: \"]]],[3,\"ul\",[[[0,[],0,\"translate transcriptions \"]],[[0,[],0,\"translate title\"]],[[0,[],0,\"generate description\"]]]],[1,\"p\",[]]],\"ghostVersion\":\"4.0\"}","html":"<p>I created awesome tool that allow you to ask gpt3.5 for linux commands. It is so awesome, that I decided to put more effort in advertising it. In this article I am showing how I did it.</p><h2 id=\"recording-video-in-obs\">Recording video in OBS</h2><p>I decided to record only terminal. So I installed <code>obs</code> and created scene with source as <code>Windows Capture (PipeWire)</code>. I received <code>mp4</code> but there was some mistakes that i decided to cut.</p><h2 id=\"removing-bad-fragments-in-lightworks\">Removing bad fragments in LightWorks</h2><p>I had a lot of problems with <code>DavinciResolve</code> so decided to install <code>LightWorks</code> that at least works. To use it you have to know shortcuts:</p><ul><li><code>c</code> for dividing clip</li><li><code>a</code> and <code>s</code> for moving to next part</li><li><code>space</code> for stop/play</li><li><code>j</code> and <code>l</code> for fast go right or left on timeline</li></ul><p>I added effect by <code>VFX</code> and <code>DVE</code> to change position and size of terminal, and decided to add colour correction to have more fancy look.</p><h2 id=\"voice\">Voice</h2><p>I created file <code>pl.txt</code> with my text. Converted it to voice by command</p><pre><code>gtts-cli \"$(cat pl.txt)\" -l pl --output pl.mp3</code></pre><p>Then speedup it by </p><pre><code>yes | ffmpeg -i pl.mp3 -filter:a \"atempo=2.0\" pl2.mp3</code></pre><p>I could play it by</p><pre><code>mpg123 pl2.mp3</code></pre><p>and measure length of <code>mp3</code> by</p><pre><code>ffprobe -i pl2.mp3 -show_entries format=duration -v quiet -of csv=\"p=0\"</code></pre><p>Of course I did not know all these command and did not found them on stackoverflow. I was using my own tool, that I want to promote. For example to find last one I typed to terminal this:</p><pre><code>p get length of pl2.mp3 file in seconds</code></pre><p>In my opinion it is revolution... But let's check what happened next.</p><p>I created 15 files called <code>pl-n.txt</code> where <code>n</code> was numbers from <code>1</code> to <code>15</code> and asked.</p><pre><code>p write bash script that iterate over all text files starting from pl and ending on txt and execute on them command cat</code></pre><p>I received this:</p><pre><code>for file in pl*.txt; do\n    cat $file\ndone\n</code></pre><p>Great. I edited it to this form. Next question:</p><pre><code>p get number that is after \"pl-\" and before \".txt\" extension form file name saved in env $file</code></pre><p>and answer:</p><pre><code>echo $env | grep -oP '(?&lt;=pl\\-)\\d+(?=\\.txt)'</code></pre><p>few minutes later I had</p><pre><code>#!/bin/bash\n\nfor file in pl*.txt; do\n    num=`echo $file | grep -oP '(?&lt;=pl\\-)\\d+(?=\\.txt)';`\n    echo $num;\n    gtts-cli \"$(cat $file)\" -l pl --output pl-${num}.mp3\n    yes | ffmpeg -i pl-${num}.mp3 -filter:a \"atempo=2.0\" pl-${num}i.mp3\ndone\n</code></pre><h2 id=\"translations\">Translations</h2><p>Now I have to translate them to different languages. Chat gpt is great in translations, but is there any cli that simplify this process? Hmm... Yea</p><p>Again I decided to use <code>gpt-cli</code> written 2 days ago in this using script <code>translate.sh</code></p><pre><code class=\"language-bash\">#!/bin/bash\n\nexport GPT_SYSTEM_PROMPT=\"I am translator from polish to english. I need to translate this text.\"; \nexport GPT_POST=out;\n\nfor file in pl*.txt; do\n    num=`echo $file | grep -oP '(?&lt;=pl\\-)\\d+(?=\\.txt)';`\n    echo \"Num: ${num}\"\n    p \"$(cat ${file})\" &gt; en-${num}.txt\n    cat en-${num}.txt\ndone\n\nunset GPT_SYSTEM_PROMPT;\nunset GPT_POST;</code></pre><p>Let's modify our <code>read.sh</code> script to generalize it for any <code>LANG</code></p><pre><code class=\"language-bash\">#!/bin/bash\n\nfor file in ${LANG}*.txt; do\n    num=`echo \"$file\" | grep -oP \"(?&lt;=${LANG}-)\\d+(?=\\.txt)\";`\n    echo $num;\n    gtts-cli \"$(cat $file)\" -l ${LANG} --output ${LANG}-${num}.mp3\n    yes | ffmpeg -i ${LANG}-${num}.mp3 -filter:a \"atempo=2.0\" ${LANG}-${num}i.mp3\ndone</code></pre><p>and use</p><pre><code>LANG=en ./read.sh</code></pre><p>With these two scripts we generated already audio files for two languages.</p><p>Now it is time to select languages to translate. We can do it in two steps.</p><ol><li>Ask about possible languages:</li></ol><pre><code>gtts-cli --all\n  af: Afrikaans\n  ar: Arabic\n  bn: Bengali\n  ...\n  zh: Chinese (Mandarin)</code></pre><p>and copy these languages to chat asking about first 24 in ordered by popularity. It is our list:</p><pre><code>en: English\nes: Spanish\nzh: Chinese (Mandarin)\nhi: Hindi\nar: Arabic\nbn: Bengali\npt: Portuguese\nru: Russian\nja: Japanese\npa: Punjabi\nde: German\njv: Javanese\nms: Malay\nte: Telugu\nvi: Vietnamese\nko: Korean\nfr: French\nmr: Marathi\nta: Tamil\ntr: Turkish\nit: Italian\nth: Thai\nnl: Dutch\npl: Polish</code></pre><p>Now we can modify our translation script using syntax</p><pre><code>#!/bin/bash\n\n# Set default value for LANG_SHORT\n: ${LANG_SHORT:=pl}\n\n# Use the value of LANG_SHORT in your script\necho \"LANG_SHORT is set to $LANG_SHORT\"</code></pre><p>The <code>:=</code> operator assigns the default value \"pl\" to <code>LANG_SHORT</code> if it is unset or null. The : before the operator is a null command that does nothing, but is necessary to avoid a syntax error if <code>LANG_SHORT</code> is unset.</p><pre><code>#!/bin/bash\n\n: ${FROM_SHORT:=pl}\n: ${TO_SHORT:=en}\n\n: ${FROM_LONG:=Polish}\n: ${TO_LONG:=English}\n\n\nexport GPT_SYSTEM_PROMPT=\"I am translator from ${FROM_LONG} to ${TO_LONG}. I need to translate this text.\"; \nexport GPT_POST=out;\n\nfor file in ${FROM_SHORT}*.txt; do\n    num=`echo \"$file\" | grep -oP \"(?&lt;=${FROM_SHORT}-)\\d+(?=\\.txt)\";`\n    echo \"Num: ${num}\"\n    p \"$(cat ${file})\" &gt; ${TO_SHORT}-${num}.txt\n    cat ${TO_SHORT}-${num}.txt\n    if [ ! -s ${TO_SHORT}-${num}.txt ]; then\n      echo \"File is empty or doesn't exist. Exiting script.\"\n      exit 1\n    fi\ndone\n\nunset GPT_SYSTEM_PROMPT;\nunset GPT_POST;</code></pre><p>Now we need to set <code>from</code> as english and use rest languages in loop that</p><p>This simple script automate our work</p><pre><code>#!/usr/bin/env bash\n\nexport FROM_SHORT=en\nexport FROM_LONG=English\n\nTO_SHORT=es TO_LONG=Spanish ./translate.sh\nTO_SHORT=zh TO_LONG=Chinese ./translate.sh\nTO_SHORT=hi TO_LONG=Hindi ./translate.sh\nTO_SHORT=ar TO_LONG=Arabic ./translate.sh\nTO_SHORT=bn TO_LONG=Bengali ./translate.sh\nTO_SHORT=pt TO_LONG=Portuguese ./translate.sh\nTO_SHORT=ru TO_LONG=Russian ./translate.sh\nTO_SHORT=ja TO_LONG=Japanese ./translate.sh\nTO_SHORT=pa TO_LONG=Punjabi ./translate.sh\nTO_SHORT=de TO_LONG=German ./translate.sh\nTO_SHORT=jv TO_LONG=Javanese ./translate.sh\nTO_SHORT=ms TO_LONG=Malay ./translate.sh\nTO_SHORT=te TO_LONG=Telugu ./translate.sh\nTO_SHORT=vi TO_LONG=Vietnamese ./translate.sh\nTO_SHORT=ko TO_LONG=Korean ./translate.sh\nTO_SHORT=fr TO_LONG=French ./translate.sh\nTO_SHORT=mr TO_LONG=Marathi ./translate.sh\nTO_SHORT=ta TO_LONG=Tamil ./translate.sh\nTO_SHORT=tr TO_LONG=Turkish ./translate.sh\nTO_SHORT=it TO_LONG=Italian ./translate.sh\nTO_SHORT=th TO_LONG=Thai ./translate.sh\nTO_SHORT=nl TO_LONG=Dutch ./translate.sh\n</code></pre><p>After this command we have 360 files, 15 files for any of 24 languages. So let's read them all using <code>gtts-cli</code>.</p><p>We can improve our <code>read.sh</code> again to move all final files to directories.</p><pre><code>#!/bin/bash\n\nfor file in ${LANG}*.txt; do\n    num=`echo \"$file\" | grep -oP \"(?&lt;=${LANG}-)\\d+(?=\\.txt)\";`\n    echo $num;\n    gtts-cli \"$(cat $file)\" -l ${LANG} --output ${LANG}-${num}.mp3\n    yes | ffmpeg -i ${LANG}-${num}.mp3 -filter:a \"atempo=2.0\" ${LANG}-${num}i.mp3\n    mkdir -p \"${LANG}i\"\n    mv ${LANG}-*i.mp3 \"${LANG}i\"\ndone\n</code></pre><p>and to read all we can use <code>read_all.sh</code> script</p><pre><code>#!/usr/bin/env bash\n\nLANG=\"en\" ./read.sh\nLANG=\"pl\" ./read.sh\nLANG=\"es\" ./read.sh\nLANG=\"zh\" ./read.sh\nLANG=\"hi\" ./read.sh\nLANG=\"ar\" ./read.sh\nLANG=\"bn\" ./read.sh\nLANG=\"pt\" ./read.sh\nLANG=\"ru\" ./read.sh\nLANG=\"ja\" ./read.sh\nLANG=\"pa\" ./read.sh\nLANG=\"de\" ./read.sh\nLANG=\"jv\" ./read.sh\nLANG=\"ms\" ./read.sh\nLANG=\"te\" ./read.sh\nLANG=\"vi\" ./read.sh\nLANG=\"ko\" ./read.sh\nLANG=\"fr\" ./read.sh\nLANG=\"mr\" ./read.sh\nLANG=\"ta\" ./read.sh\nLANG=\"tr\" ./read.sh\nLANG=\"it\" ./read.sh\nLANG=\"th\" ./read.sh\nLANG=\"nl\" ./read.sh</code></pre><p>There was problem with reading <code>pa</code>, <code>jv</code> and <code>ms</code> languages.</p><ul><li>pa: Punjabi</li><li>jv: Javanese</li><li>ms: Malay</li></ul><p>in agreement with Pareto rule I decided to skip it, but after preparing Arabic video I understand that I can't verify it so if there are text like \"I apologize, but I can't translate this sentence\", then I do not have any method of check it.</p><h2 id=\"verification\">Verification</h2><p>I decided to invert this process to verify it. So what we did:</p><ul><li>prepared text in english</li><li>translated to other languages</li><li>converted text to speech</li></ul><p>And now we are going to</p><ul><li>convert speech to text</li><li>translate it again to english</li><li>compare original with result of processing</li></ul><p>If machine is able to understand it then we can assume that our movies are correct.</p><figure class=\"kg-card kg-image-card\"><img src=\"__GHOST_URL__/content/images/2023/03/Zrzut-ekranu-z-2023-03-17-13-43-03.png\" class=\"kg-image\" alt loading=\"lazy\" width=\"607\" height=\"369\" srcset=\"__GHOST_URL__/content/images/size/w600/2023/03/Zrzut-ekranu-z-2023-03-17-13-43-03.png 600w, __GHOST_URL__/content/images/2023/03/Zrzut-ekranu-z-2023-03-17-13-43-03.png 607w\"></figure><p>Unfortunately voice2json do not support all our languages</p><figure class=\"kg-card kg-bookmark-card\"><a class=\"kg-bookmark-container\" href=\"http://voice2json.org/#getting-started\"><div class=\"kg-bookmark-content\"><div class=\"kg-bookmark-title\">voice2json</div><div class=\"kg-bookmark-description\">Command-line tools for speech and intent recognition on Linux</div><div class=\"kg-bookmark-metadata\"><span class=\"kg-bookmark-author\">voice2json</span></div></div><div class=\"kg-bookmark-thumbnail\"><img src=\"http://voice2json.org/img/voice2json.svg\" alt=\"\"></div></a></figure><p>There are supported</p><ul><li>Catalan (<code>ca</code>)</li><li>Czech (<code>cs</code>)</li><li>German (<code>de</code>)</li><li>Greek (<code>el</code>)</li><li>English (<code>en</code>)</li><li>Spanish (<code>es</code>)</li><li>French (<code>fr</code>)</li><li>Hindi (<code>hi</code>)</li><li>Italian (<code>it</code>)</li><li>Korean (<code>ko</code>)</li><li>Kazakh (<code>kz</code>)</li><li>Dutch (<code>nl</code>)</li><li>Polish (<code>pl</code>)</li><li>Portuguese (<code>pt</code>)</li><li>Russian (<code>ru</code>)</li><li>Swedish (<code>sv</code>)</li><li>Vietnamese (<code>vi</code>)</li><li>Mandarin (<code>zh</code>)</li></ul><p>Using <code>voice2json</code> we can use only 12 languages.</p><figure class=\"kg-card kg-image-card\"><img src=\"__GHOST_URL__/content/images/2023/03/Zrzut-ekranu-z-2023-03-17-14-06-02.png\" class=\"kg-image\" alt loading=\"lazy\" width=\"203\" height=\"527\"></figure><p>Other tool is whisper also from openai</p><figure class=\"kg-card kg-bookmark-card\"><a class=\"kg-bookmark-container\" href=\"https://github.com/openai/whisper\"><div class=\"kg-bookmark-content\"><div class=\"kg-bookmark-title\">GitHub - openai/whisper: Robust Speech Recognition via Large-Scale Weak Supervision</div><div class=\"kg-bookmark-description\">Robust Speech Recognition via Large-Scale Weak Supervision - GitHub - openai/whisper: Robust Speech Recognition via Large-Scale Weak Supervision</div><div class=\"kg-bookmark-metadata\"><img class=\"kg-bookmark-icon\" src=\"https://github.com/fluidicon.png\" alt=\"\"><span class=\"kg-bookmark-author\">GitHub</span><span class=\"kg-bookmark-publisher\">openai</span></div></div><div class=\"kg-bookmark-thumbnail\"><img src=\"https://opengraph.githubassets.com/fe5e99c6eb3717c4ee426b34983b5a17162c217dce8f6791d0a371906b0cdfe7/openai/whisper\" alt=\"\"></div></a></figure><figure class=\"kg-card kg-image-card\"><img src=\"__GHOST_URL__/content/images/2023/03/language-breakdown.svg\" class=\"kg-image\" alt loading=\"lazy\" width=\"871\" height=\"1168\"></figure><p>we can't install it today because open issue</p><figure class=\"kg-card kg-bookmark-card\"><a class=\"kg-bookmark-container\" href=\"https://github.com/numba/numba/issues/8304#issuecomment-1456646575\"><div class=\"kg-bookmark-content\"><div class=\"kg-bookmark-title\">Python 3.11 · Issue #8304 · numba/numba</div><div class=\"kg-bookmark-description\">This is the meta/coordination issue for Python 3.11 support for Numba and llvmlite. Note: The issue text will be updated continuously to reflect the current process and progress. As Numba interface…</div><div class=\"kg-bookmark-metadata\"><img class=\"kg-bookmark-icon\" src=\"https://github.com/fluidicon.png\" alt=\"\"><span class=\"kg-bookmark-author\">GitHub</span><span class=\"kg-bookmark-publisher\">numba</span></div></div><div class=\"kg-bookmark-thumbnail\"><img src=\"https://opengraph.githubassets.com/14a5903c4c15226547b397ba736a2869d14420f2b2a20941b978c12cef4f1a78/numba/numba/issues/8304\" alt=\"\"></div></a></figure><p>but there is <code>api</code></p><pre><code>curl --request POST \\\n  --url https://api.openai.com/v1/audio/transcriptions \\\n  --header \"Authorization: Bearer ${GPT3_API_KEY}\" \\\n  --header 'Content-Type: multipart/form-data' \\\n  --form file=@en-3i.mp3 \\\n  --form model=whisper-1 | jq \".text\"</code></pre><p>So to convert <code>mp4</code> to <code>mp3</code> you can simply type</p><pre><code>p ffmpeg convert ar.mp4 to ar.mp3 </code></pre><p>or</p><pre><code>ffmpeg -i ar.mp4 ar.mp3</code></pre><p>and then after</p><pre><code>curl --request POST \\                                                 \n  --url https://api.openai.com/v1/audio/transcriptions \\\n  --header 'Authorization: Bearer ${GPT3_API_KEY}' \\\n  --header 'Content-Type: multipart/form-data' \\\n  --form file=@ar.mp3 \\   \n  --form model=whisper-1 | jq \".text\"</code></pre><p>I saw:</p><p>لا تعرف أو لا تتذكر أوامر الانكس ما عليك سوى كتابة النص باللغة العادية وسيقوم روبوت الدردشة جي كي تي بكتابة الأوامر لك بفضل عدة دقائق من البحث في هندسة النص المحفزة فقد وضعت لك نص محفزا سيغير حياتك بتوفيرك الليالي الساهرة التي تنفقها في التبديل بين الوحدة أطرفية وستاك أوفرو فلو في هذا الفيديو يمكنك مشاهدة كيف يمكنك بدلا من كتابة الأعلامات المخصصة لأمر جي كيو وصف العملية التي تريد تحقيقها ببساطة، الآن لقد قمنا بحفظ ملف طبع جي اس أو إن باستخدام ترميز بيس 64 كان الأمر سهلا جدا للأسف كنا نريد شكل بيس 64 لتخلصي من الأسطور الجديدة ولكن من يتذكر هذا العلم لأمر بيس 64 الهاكرز نعم ولكن أنا مبتدئ الآن نعرض ساعة على الطرفية والآن تسلسل من 100 إلى 60 بخطوة 6 بصراحة لن أعرف ترتيب هذه الحجج وتحقق منها سيستغرق حوالي 10 ثوان من الحياة أو 10 ثوان من فوات الأجل إذا كانت اختباراتنا في لغة الروس تعمل بشكل متزامن أثناء التعامل مع المورد نفسه فمن الجدير بتشغيل بطريقة تتبعية الآن تعرف الفا إذا كنت مبتدئا ولا تعرف أوامر لينيكس فلن تحتاج إلى ذلك مع اكس دي إذا نسيت نسخة نظام التشغيل الخاص بك ولا تعرف كيفية تتحقق منه لا تقلق يمكنك أيضا الاستفسار عن عدد الحزم المثبتة أو ببساطة سرد قائمتها أتحقق من إصدارات دوكر هل فكرت أنه يجب أن يكون هناك خط أفقي قبل الإصدار يمكن أن يكون هناك ولكنه ليس ضروريا إذا كنت متطرن لتعامل مع لغة بيتش بي في ايتش بي ولكن لا تعرفها يمكنك ببساطة تغليف بها في طبقة انعكاسية توفرها شات جي بي تي جي بي تي وإذا لم تتذكر كيفية إعداد خادم محلي وتحتاج إليه في الأمس فها هو لقد كتبت طلب ايتش تي بي من الصفر لاختباره في النهاية نفتح خادم ان سي ونتصل به لنقل البيانات في الوقت الحقيقي بين المحطات تحقق إذا كانت تعمل لك وإذا كانت تعمل عرضها على أصدقائك آسف أنت في اي جي تي وربما مثلي لا يوجد لديك أصدقاء اكس دي</p><p>Hmm. Looks great, but what it means? Fortunately changing <code>transcriptions</code> to <code>translations</code> we can see:</p><pre><code>curl --request POST \\      \n  --url https://api.openai.com/v1/audio/translations \\\n  --header \"Authorization: Bearer ${GPT3_API_KEY}\" \\\n  --header 'Content-Type: multipart/form-data' \\\n  --form file=@ar.mp3 \\\n  --form model=whisper-1 --form response_format=text</code></pre><p>It is hard to say if result is readable. But I am rather considering it as low quality.</p><figure class=\"kg-card kg-image-card kg-width-full\"><img src=\"__GHOST_URL__/content/images/2023/03/Zrzut-ekranu-z-2023-03-17-17-36-46.png\" class=\"kg-image\" alt loading=\"lazy\" width=\"1656\" height=\"433\" srcset=\"__GHOST_URL__/content/images/size/w600/2023/03/Zrzut-ekranu-z-2023-03-17-17-36-46.png 600w, __GHOST_URL__/content/images/size/w1000/2023/03/Zrzut-ekranu-z-2023-03-17-17-36-46.png 1000w, __GHOST_URL__/content/images/size/w1600/2023/03/Zrzut-ekranu-z-2023-03-17-17-36-46.png 1600w, __GHOST_URL__/content/images/2023/03/Zrzut-ekranu-z-2023-03-17-17-36-46.png 1656w\"></figure><p> To make it better I should add subtitles. I tried this service</p><figure class=\"kg-card kg-bookmark-card\"><a class=\"kg-bookmark-container\" href=\"https://subtitlestranslator.com/en/\"><div class=\"kg-bookmark-content\"><div class=\"kg-bookmark-title\">Free online subtitle translator.</div><div class=\"kg-bookmark-description\">Free online subtitles translator. Quickly translate multiple subtitle files at once. Supports major file formats and allows you to translate to over 80 different languages.</div><div class=\"kg-bookmark-metadata\"><img class=\"kg-bookmark-icon\" src=\"https://subtitlestranslator.com/resources/images/icon.png\" alt=\"\"><span class=\"kg-bookmark-author\">Subtitles Translator</span></div></div><div class=\"kg-bookmark-thumbnail\"><img src=\"https://subtitlestranslator.com/resources/images/left_arrow.svg\" alt=\"\"></div></a></figure><p>But it does not provide api, and process part of files on fronted, but part on backend. I was also considering this one</p><figure class=\"kg-card kg-bookmark-card\"><a class=\"kg-bookmark-container\" href=\"https://stenograf.io/\"><div class=\"kg-bookmark-content\"><div class=\"kg-bookmark-title\">Automatyczna transkrypcja nagrań</div><div class=\"kg-bookmark-description\">Twórz napisy do nagrań wideo i audio. Stenograf to narzędzie do automatycznej konwersji audio na tekst. Wypróbuj za darmo!</div><div class=\"kg-bookmark-metadata\"><img class=\"kg-bookmark-icon\" src=\"https://stenograf.io/img/favicon-gradient.ico\" alt=\"\"></div></div><div class=\"kg-bookmark-thumbnail\"><img src=\"https://www.stenograf.io/img/StenografBigLogo.png\" alt=\"\"></div></a></figure><p>but it is also gui tool without API. I rejected also this one with price $0.0005 per word.</p><figure class=\"kg-card kg-bookmark-card\"><a class=\"kg-bookmark-container\" href=\"https://www.pairaphrase.com/how-it-works/api-for-developers/\"><div class=\"kg-bookmark-content\"><div class=\"kg-bookmark-title\">Translation Software API</div><div class=\"kg-bookmark-description\">Need a cloud translation software API for websites, documents &amp; more? Learn about Pairaphrase’s secure language translation API.</div><div class=\"kg-bookmark-metadata\"><img class=\"kg-bookmark-icon\" src=\"https://www.pairaphrase.com/wp-content/uploads/2022/10/icon.png?v&#x3D;1\" alt=\"\"><span class=\"kg-bookmark-author\">Pairaphrase</span></div></div><div class=\"kg-bookmark-thumbnail\"><img src=\"https://www.pairaphrase.com/wp-content/uploads/2020/10/translation-software-api-1-300x252.png\" alt=\"\"></div></a></figure><p>In the English language, people speak about 140 words per minute. A fast speaker will get to 170. So with super fast speaker it will cost $6 per hour. Not bad, but this price require package that costs 400 USD.</p><p>I decided again to use GPT-3 command line that I wrote.</p><pre><code>GPT_SYSTEM_PROMPT=\"I am sbv files translator to polish. I need to translate this text not changing numbers with time.\" GPT_POST=out p \"$(cat captions.sbv)\"</code></pre><p>Results was weak again so I decided to change workflow. Research showed that there are more tools, like this one:</p><figure class=\"kg-card kg-bookmark-card\"><a class=\"kg-bookmark-container\" href=\"https://www.checksub.com/\"><div class=\"kg-bookmark-content\"><div class=\"kg-bookmark-title\">Checksub: Create impactful videos | Add Captions and Subtitles easily</div><div class=\"kg-bookmark-description\">Create an impactful video💥 thanks to the best subtitling and captioning platform. Generate your captions and translate them automatically.</div><div class=\"kg-bookmark-metadata\"><img class=\"kg-bookmark-icon\" src=\"https://www.checksub.com/wp-content/themes/checksub/images/favicon.png?v&#x3D;1660724351970\" alt=\"\"><span class=\"kg-bookmark-author\">Checksub</span></div></div><div class=\"kg-bookmark-thumbnail\"><img src=\"https://www.checksub.com/wp-content/themes/checksub/images/Cheksub-white-min.png\" alt=\"\"></div></a></figure><p>But finally I stopped with the following flow:</p><ul><li>english text -&gt; translated text -&gt; speech -&gt; recognized text -&gt; english text</li></ul><p>and was unsatisfied with result. So tried to fix it by providing subtitles that will improve quality. Problem was that subtitles are organised in texts that showing between given time period, when original text is organised to sentences that covers selected topics.</p><hr><p>I did not found solution for it now because I have to create multilingual context anyway, so I hope I will improve this process in future. Now as proof of concept I decided to write one more script to: </p><ul><li>translate transcriptions </li><li>translate title</li><li>generate description</li></ul>","comment_id":"641151130f360525ad8515d0","plaintext":"I created awesome tool that allow you to ask gpt3.5 for linux commands. It is so awesome, that I decided to put more effort in advertising it. In this article I am showing how I did it.\n\n\nRecording video in OBS\n\nI decided to record only terminal. So I installed obs and created scene with source as Windows Capture (PipeWire). I received mp4 but there was some mistakes that i decided to cut.\n\n\nRemoving bad fragments in LightWorks\n\nI had a lot of problems with DavinciResolve so decided to install LightWorks that at least works. To use it you have to know shortcuts:\n\n * c for dividing clip\n * a and s for moving to next part\n * space for stop/play\n * j and l for fast go right or left on timeline\n\nI added effect by VFX and DVE to change position and size of terminal, and decided to add colour correction to have more fancy look.\n\n\nVoice\n\nI created file pl.txt with my text. Converted it to voice by command\n\ngtts-cli \"$(cat pl.txt)\" -l pl --output pl.mp3\n\nThen speedup it by\n\nyes | ffmpeg -i pl.mp3 -filter:a \"atempo=2.0\" pl2.mp3\n\nI could play it by\n\nmpg123 pl2.mp3\n\nand measure length of mp3 by\n\nffprobe -i pl2.mp3 -show_entries format=duration -v quiet -of csv=\"p=0\"\n\nOf course I did not know all these command and did not found them on stackoverflow. I was using my own tool, that I want to promote. For example to find last one I typed to terminal this:\n\np get length of pl2.mp3 file in seconds\n\nIn my opinion it is revolution... But let's check what happened next.\n\nI created 15 files called pl-n.txt where n was numbers from 1 to 15 and asked.\n\np write bash script that iterate over all text files starting from pl and ending on txt and execute on them command cat\n\nI received this:\n\nfor file in pl*.txt; do\n    cat $file\ndone\n\n\nGreat. I edited it to this form. Next question:\n\np get number that is after \"pl-\" and before \".txt\" extension form file name saved in env $file\n\nand answer:\n\necho $env | grep -oP '(?<=pl\\-)\\d+(?=\\.txt)'\n\nfew minutes later I had\n\n#!/bin/bash\n\nfor file in pl*.txt; do\n    num=`echo $file | grep -oP '(?<=pl\\-)\\d+(?=\\.txt)';`\n    echo $num;\n    gtts-cli \"$(cat $file)\" -l pl --output pl-${num}.mp3\n    yes | ffmpeg -i pl-${num}.mp3 -filter:a \"atempo=2.0\" pl-${num}i.mp3\ndone\n\n\n\nTranslations\n\nNow I have to translate them to different languages. Chat gpt is great in translations, but is there any cli that simplify this process? Hmm... Yea\n\nAgain I decided to use gpt-cli written 2 days ago in this using script translate.sh\n\n#!/bin/bash\n\nexport GPT_SYSTEM_PROMPT=\"I am translator from polish to english. I need to translate this text.\"; \nexport GPT_POST=out;\n\nfor file in pl*.txt; do\n    num=`echo $file | grep -oP '(?<=pl\\-)\\d+(?=\\.txt)';`\n    echo \"Num: ${num}\"\n    p \"$(cat ${file})\" > en-${num}.txt\n    cat en-${num}.txt\ndone\n\nunset GPT_SYSTEM_PROMPT;\nunset GPT_POST;\n\nLet's modify our read.sh script to generalize it for any LANG\n\n#!/bin/bash\n\nfor file in ${LANG}*.txt; do\n    num=`echo \"$file\" | grep -oP \"(?<=${LANG}-)\\d+(?=\\.txt)\";`\n    echo $num;\n    gtts-cli \"$(cat $file)\" -l ${LANG} --output ${LANG}-${num}.mp3\n    yes | ffmpeg -i ${LANG}-${num}.mp3 -filter:a \"atempo=2.0\" ${LANG}-${num}i.mp3\ndone\n\nand use\n\nLANG=en ./read.sh\n\nWith these two scripts we generated already audio files for two languages.\n\nNow it is time to select languages to translate. We can do it in two steps.\n\n 1. Ask about possible languages:\n\ngtts-cli --all\n  af: Afrikaans\n  ar: Arabic\n  bn: Bengali\n  ...\n  zh: Chinese (Mandarin)\n\nand copy these languages to chat asking about first 24 in ordered by popularity. It is our list:\n\nen: English\nes: Spanish\nzh: Chinese (Mandarin)\nhi: Hindi\nar: Arabic\nbn: Bengali\npt: Portuguese\nru: Russian\nja: Japanese\npa: Punjabi\nde: German\njv: Javanese\nms: Malay\nte: Telugu\nvi: Vietnamese\nko: Korean\nfr: French\nmr: Marathi\nta: Tamil\ntr: Turkish\nit: Italian\nth: Thai\nnl: Dutch\npl: Polish\n\nNow we can modify our translation script using syntax\n\n#!/bin/bash\n\n# Set default value for LANG_SHORT\n: ${LANG_SHORT:=pl}\n\n# Use the value of LANG_SHORT in your script\necho \"LANG_SHORT is set to $LANG_SHORT\"\n\nThe := operator assigns the default value \"pl\" to LANG_SHORT if it is unset or null. The : before the operator is a null command that does nothing, but is necessary to avoid a syntax error if LANG_SHORT is unset.\n\n#!/bin/bash\n\n: ${FROM_SHORT:=pl}\n: ${TO_SHORT:=en}\n\n: ${FROM_LONG:=Polish}\n: ${TO_LONG:=English}\n\n\nexport GPT_SYSTEM_PROMPT=\"I am translator from ${FROM_LONG} to ${TO_LONG}. I need to translate this text.\"; \nexport GPT_POST=out;\n\nfor file in ${FROM_SHORT}*.txt; do\n    num=`echo \"$file\" | grep -oP \"(?<=${FROM_SHORT}-)\\d+(?=\\.txt)\";`\n    echo \"Num: ${num}\"\n    p \"$(cat ${file})\" > ${TO_SHORT}-${num}.txt\n    cat ${TO_SHORT}-${num}.txt\n    if [ ! -s ${TO_SHORT}-${num}.txt ]; then\n      echo \"File is empty or doesn't exist. Exiting script.\"\n      exit 1\n    fi\ndone\n\nunset GPT_SYSTEM_PROMPT;\nunset GPT_POST;\n\nNow we need to set from as english and use rest languages in loop that\n\nThis simple script automate our work\n\n#!/usr/bin/env bash\n\nexport FROM_SHORT=en\nexport FROM_LONG=English\n\nTO_SHORT=es TO_LONG=Spanish ./translate.sh\nTO_SHORT=zh TO_LONG=Chinese ./translate.sh\nTO_SHORT=hi TO_LONG=Hindi ./translate.sh\nTO_SHORT=ar TO_LONG=Arabic ./translate.sh\nTO_SHORT=bn TO_LONG=Bengali ./translate.sh\nTO_SHORT=pt TO_LONG=Portuguese ./translate.sh\nTO_SHORT=ru TO_LONG=Russian ./translate.sh\nTO_SHORT=ja TO_LONG=Japanese ./translate.sh\nTO_SHORT=pa TO_LONG=Punjabi ./translate.sh\nTO_SHORT=de TO_LONG=German ./translate.sh\nTO_SHORT=jv TO_LONG=Javanese ./translate.sh\nTO_SHORT=ms TO_LONG=Malay ./translate.sh\nTO_SHORT=te TO_LONG=Telugu ./translate.sh\nTO_SHORT=vi TO_LONG=Vietnamese ./translate.sh\nTO_SHORT=ko TO_LONG=Korean ./translate.sh\nTO_SHORT=fr TO_LONG=French ./translate.sh\nTO_SHORT=mr TO_LONG=Marathi ./translate.sh\nTO_SHORT=ta TO_LONG=Tamil ./translate.sh\nTO_SHORT=tr TO_LONG=Turkish ./translate.sh\nTO_SHORT=it TO_LONG=Italian ./translate.sh\nTO_SHORT=th TO_LONG=Thai ./translate.sh\nTO_SHORT=nl TO_LONG=Dutch ./translate.sh\n\n\nAfter this command we have 360 files, 15 files for any of 24 languages. So let's read them all using gtts-cli.\n\nWe can improve our read.sh again to move all final files to directories.\n\n#!/bin/bash\n\nfor file in ${LANG}*.txt; do\n    num=`echo \"$file\" | grep -oP \"(?<=${LANG}-)\\d+(?=\\.txt)\";`\n    echo $num;\n    gtts-cli \"$(cat $file)\" -l ${LANG} --output ${LANG}-${num}.mp3\n    yes | ffmpeg -i ${LANG}-${num}.mp3 -filter:a \"atempo=2.0\" ${LANG}-${num}i.mp3\n    mkdir -p \"${LANG}i\"\n    mv ${LANG}-*i.mp3 \"${LANG}i\"\ndone\n\n\nand to read all we can use read_all.sh script\n\n#!/usr/bin/env bash\n\nLANG=\"en\" ./read.sh\nLANG=\"pl\" ./read.sh\nLANG=\"es\" ./read.sh\nLANG=\"zh\" ./read.sh\nLANG=\"hi\" ./read.sh\nLANG=\"ar\" ./read.sh\nLANG=\"bn\" ./read.sh\nLANG=\"pt\" ./read.sh\nLANG=\"ru\" ./read.sh\nLANG=\"ja\" ./read.sh\nLANG=\"pa\" ./read.sh\nLANG=\"de\" ./read.sh\nLANG=\"jv\" ./read.sh\nLANG=\"ms\" ./read.sh\nLANG=\"te\" ./read.sh\nLANG=\"vi\" ./read.sh\nLANG=\"ko\" ./read.sh\nLANG=\"fr\" ./read.sh\nLANG=\"mr\" ./read.sh\nLANG=\"ta\" ./read.sh\nLANG=\"tr\" ./read.sh\nLANG=\"it\" ./read.sh\nLANG=\"th\" ./read.sh\nLANG=\"nl\" ./read.sh\n\nThere was problem with reading pa, jv and ms languages.\n\n * pa: Punjabi\n * jv: Javanese\n * ms: Malay\n\nin agreement with Pareto rule I decided to skip it, but after preparing Arabic video I understand that I can't verify it so if there are text like \"I apologize, but I can't translate this sentence\", then I do not have any method of check it.\n\n\nVerification\n\nI decided to invert this process to verify it. So what we did:\n\n * prepared text in english\n * translated to other languages\n * converted text to speech\n\nAnd now we are going to\n\n * convert speech to text\n * translate it again to english\n * compare original with result of processing\n\nIf machine is able to understand it then we can assume that our movies are correct.\n\nUnfortunately voice2json do not support all our languages\n\nvoice2jsonCommand-line tools for speech and intent recognition on Linuxvoice2json\n\nThere are supported\n\n * Catalan (ca)\n * Czech (cs)\n * German (de)\n * Greek (el)\n * English (en)\n * Spanish (es)\n * French (fr)\n * Hindi (hi)\n * Italian (it)\n * Korean (ko)\n * Kazakh (kz)\n * Dutch (nl)\n * Polish (pl)\n * Portuguese (pt)\n * Russian (ru)\n * Swedish (sv)\n * Vietnamese (vi)\n * Mandarin (zh)\n\nUsing voice2json we can use only 12 languages.\n\nOther tool is whisper also from openai\n\nGitHub - openai/whisper: Robust Speech Recognition via Large-Scale Weak SupervisionRobust Speech Recognition via Large-Scale Weak Supervision - GitHub - openai/whisper: Robust Speech Recognition via Large-Scale Weak SupervisionGitHubopenai\n\nwe can't install it today because open issue\n\nPython 3.11 · Issue #8304 · numba/numbaThis is the meta/coordination issue for Python 3.11 support for Numba and llvmlite. Note: The issue text will be updated continuously to reflect the current process and progress. As Numba interface…GitHubnumba\n\nbut there is api\n\ncurl --request POST \\\n  --url https://api.openai.com/v1/audio/transcriptions \\\n  --header \"Authorization: Bearer ${GPT3_API_KEY}\" \\\n  --header 'Content-Type: multipart/form-data' \\\n  --form file=@en-3i.mp3 \\\n  --form model=whisper-1 | jq \".text\"\n\nSo to convert mp4 to mp3 you can simply type\n\np ffmpeg convert ar.mp4 to ar.mp3 \n\nor\n\nffmpeg -i ar.mp4 ar.mp3\n\nand then after\n\ncurl --request POST \\                                                 \n  --url https://api.openai.com/v1/audio/transcriptions \\\n  --header 'Authorization: Bearer ${GPT3_API_KEY}' \\\n  --header 'Content-Type: multipart/form-data' \\\n  --form file=@ar.mp3 \\   \n  --form model=whisper-1 | jq \".text\"\n\nI saw:\n\nلا تعرف أو لا تتذكر أوامر الانكس ما عليك سوى كتابة النص باللغة العادية وسيقوم روبوت الدردشة جي كي تي بكتابة الأوامر لك بفضل عدة دقائق من البحث في هندسة النص المحفزة فقد وضعت لك نص محفزا سيغير حياتك بتوفيرك الليالي الساهرة التي تنفقها في التبديل بين الوحدة أطرفية وستاك أوفرو فلو في هذا الفيديو يمكنك مشاهدة كيف يمكنك بدلا من كتابة الأعلامات المخصصة لأمر جي كيو وصف العملية التي تريد تحقيقها ببساطة، الآن لقد قمنا بحفظ ملف طبع جي اس أو إن باستخدام ترميز بيس 64 كان الأمر سهلا جدا للأسف كنا نريد شكل بيس 64 لتخلصي من الأسطور الجديدة ولكن من يتذكر هذا العلم لأمر بيس 64 الهاكرز نعم ولكن أنا مبتدئ الآن نعرض ساعة على الطرفية والآن تسلسل من 100 إلى 60 بخطوة 6 بصراحة لن أعرف ترتيب هذه الحجج وتحقق منها سيستغرق حوالي 10 ثوان من الحياة أو 10 ثوان من فوات الأجل إذا كانت اختباراتنا في لغة الروس تعمل بشكل متزامن أثناء التعامل مع المورد نفسه فمن الجدير بتشغيل بطريقة تتبعية الآن تعرف الفا إذا كنت مبتدئا ولا تعرف أوامر لينيكس فلن تحتاج إلى ذلك مع اكس دي إذا نسيت نسخة نظام التشغيل الخاص بك ولا تعرف كيفية تتحقق منه لا تقلق يمكنك أيضا الاستفسار عن عدد الحزم المثبتة أو ببساطة سرد قائمتها أتحقق من إصدارات دوكر هل فكرت أنه يجب أن يكون هناك خط أفقي قبل الإصدار يمكن أن يكون هناك ولكنه ليس ضروريا إذا كنت متطرن لتعامل مع لغة بيتش بي في ايتش بي ولكن لا تعرفها يمكنك ببساطة تغليف بها في طبقة انعكاسية توفرها شات جي بي تي جي بي تي وإذا لم تتذكر كيفية إعداد خادم محلي وتحتاج إليه في الأمس فها هو لقد كتبت طلب ايتش تي بي من الصفر لاختباره في النهاية نفتح خادم ان سي ونتصل به لنقل البيانات في الوقت الحقيقي بين المحطات تحقق إذا كانت تعمل لك وإذا كانت تعمل عرضها على أصدقائك آسف أنت في اي جي تي وربما مثلي لا يوجد لديك أصدقاء اكس دي\n\nHmm. Looks great, but what it means? Fortunately changing transcriptions to translations we can see:\n\ncurl --request POST \\      \n  --url https://api.openai.com/v1/audio/translations \\\n  --header \"Authorization: Bearer ${GPT3_API_KEY}\" \\\n  --header 'Content-Type: multipart/form-data' \\\n  --form file=@ar.mp3 \\\n  --form model=whisper-1 --form response_format=text\n\nIt is hard to say if result is readable. But I am rather considering it as low quality.\n\nTo make it better I should add subtitles. I tried this service\n\nFree online subtitle translator.Free online subtitles translator. Quickly translate multiple subtitle files at once. Supports major file formats and allows you to translate to over 80 different languages.Subtitles Translator\n\nBut it does not provide api, and process part of files on fronted, but part on backend. I was also considering this one\n\nAutomatyczna transkrypcja nagrańTwórz napisy do nagrań wideo i audio. Stenograf to narzędzie do automatycznej konwersji audio na tekst. Wypróbuj za darmo!\n\nbut it is also gui tool without API. I rejected also this one with price $0.0005 per word.\n\nTranslation Software APINeed a cloud translation software API for websites, documents & more? Learn about Pairaphrase’s secure language translation API.Pairaphrase\n\nIn the English language, people speak about 140 words per minute. A fast speaker will get to 170. So with super fast speaker it will cost $6 per hour. Not bad, but this price require package that costs 400 USD.\n\nI decided again to use GPT-3 command line that I wrote.\n\nGPT_SYSTEM_PROMPT=\"I am sbv files translator to polish. I need to translate this text not changing numbers with time.\" GPT_POST=out p \"$(cat captions.sbv)\"\n\nResults was weak again so I decided to change workflow. Research showed that there are more tools, like this one:\n\nChecksub: Create impactful videos | Add Captions and Subtitles easilyCreate an impactful video💥 thanks to the best subtitling and captioning platform. Generate your captions and translate them automatically.Checksub\n\nBut finally I stopped with the following flow:\n\n * english text -> translated text -> speech -> recognized text -> english text\n\nand was unsatisfied with result. So tried to fix it by providing subtitles that will improve quality. Problem was that subtitles are organised in texts that showing between given time period, when original text is organised to sentences that covers selected topics.\n\nI did not found solution for it now because I have to create multilingual context anyway, so I hope I will improve this process in future. Now as proof of concept I decided to write one more script to:\n\n * translate transcriptions\n * translate title\n * generate description","feature_image":null,"featured":0,"type":"post","status":"draft","locale":null,"visibility":"public","email_recipient_filter":"all","created_at":"2023-03-15T05:01:07.000Z","updated_at":"2023-03-18T03:44:21.000Z","published_at":null,"custom_excerpt":null,"codeinjection_head":null,"codeinjection_foot":null,"custom_template":null,"canonical_url":null,"newsletter_id":null,"lexical":null},{"id":"64154ee60f360525ad851806","uuid":"ebc11a1e-ac90-4b84-bbcc-82988c558db7","title":"Simplifying Linux Command Line with GPT-CLI (rust, open source)","slug":"simplifying-linux-command-line-with-gpt-cli","mobiledoc":"{\"version\":\"0.3.1\",\"atoms\":[],\"cards\":[[\"code\",{\"code\":\"p play test.mp3 from console on fedora\"}],[\"code\",{\"code\":\"mpg123 test.mp3\",\"caption\":\"\"}],[\"code\",{\"code\":\"p display invoice.pdf in fedora\"}],[\"code\",{\"code\":\"evince invoice.pdf\"}],[\"code\",{\"code\":\"p convert en.mp4 to en.mp3\"}],[\"code\",{\"code\":\"ffmpeg -i en.mp4 en.mp3\"}],[\"code\",{\"code\":\"p count all files in all first level directories here and list name of directories and amount of files inside\"}],[\"code\",{\"code\":\"find . -mindepth 1 -maxdepth 1 -type d -exec sh -c 'echo -n \\\"{}: \\\"; find \\\"{}\\\" -type f | wc -l' \\\\;\"}],[\"code\",{\"code\":\"p length in seconds of ar.mp3\"}],[\"code\",{\"code\":\"ffprobe -i ar.mp3 -show_entries format=duration -v quiet -of csv=\\\"p=0\\\"\"}],[\"markdown\",{\"markdown\":\"[![Star History Chart](https://api.star-history.com/svg?repos=gustawdaniel/gpt-cli&type=Date)](https://star-history.com/#gustawdaniel/gpt-cli&Date)\"}],[\"bookmark\",{\"version\":\"1.0\",\"type\":\"bookmark\",\"url\":\"https://github.com/gustawdaniel/gpt-cli\",\"metadata\":{\"url\":\"https://github.com/gustawdaniel/gpt-cli\",\"title\":\"GitHub - gustawdaniel/gpt-cli: Run linux commands with natural language. Eg.: “show my graphic card” instead “lspci | grep VGA”\",\"description\":\"Run linux commands with natural language. Eg.: &quot;show my graphic card&quot; instead &quot;lspci | grep VGA&quot; - GitHub - gustawdaniel/gpt-cli: Run linux commands with natural language. Eg.:…\",\"author\":\"gustawdaniel\",\"publisher\":\"GitHub\",\"thumbnail\":\"https://opengraph.githubassets.com/9f789f058f621f6205f218bdd2b378ad57eae198b84698269172e967e6b57906/gustawdaniel/gpt-cli\",\"icon\":\"https://github.com/fluidicon.png\"}}]],\"markups\":[[\"code\"]],\"sections\":[[1,\"p\",[[0,[],0,\"The Linux command line interface (CLI) is a powerful tool that allows programmers to interact with their computers and servers in an efficient and fast way. It is a tool that is widely used in programming and system administration. However, learning the Linux CLI can be a daunting task, especially for newcomers to the field. This is where GPT-CLI comes in. GPT-CLI is a tool that uses natural language processing (NLP) to simplify the Linux CLI, making it easier for anyone to use.\"]]],[1,\"h2\",[[0,[],0,\"What is GPT-CLI?\"]]],[1,\"p\",[[0,[],0,\"GPT-CLI is a command-line tool that uses the power of natural language processing (NLP) to help programmers write Linux commands using natural language. It is built on top of the OpenAI GPT-3 language model, which is one of the most advanced NLP models available today. With GPT-CLI, you can type in a command in English, and it will automatically translate it into the corresponding Linux CLI command, saving you time and effort.\"]]],[1,\"h2\",[[0,[],0,\"How does GPT-CLI work?\"]]],[1,\"p\",[[0,[],0,\"GPT-CLI uses machine learning algorithms to analyze the text that you input and generate a response based on that input. When you type in a command in English, GPT-CLI uses NLP to understand the intent of the command and then translates it into the corresponding Linux CLI command. For example, if you type in \"],[0,[0],1,\"create a new directory called 'my_folder'\"],[0,[],0,\", GPT-CLI will translate that into the Linux command \"],[0,[0],1,\"mkdir my_folder\"],[0,[],0,\". This process is made possible by the advanced natural language processing capabilities of GPT-3.\"]]],[1,\"p\",[[0,[],0,\"But there are more use cases. I fyou will write\"]]],[10,0],[1,\"p\",[[0,[],0,\"you will get:\"]]],[10,1],[1,\"p\",[[0,[],0,\"For:\"]]],[10,2],[1,\"p\",[[0,[],0,\"it will execute\"]]],[10,3],[1,\"p\",[[0,[],0,\"For:\"]]],[10,4],[1,\"p\",[[0,[],0,\"you can expect\"]]],[10,5],[1,\"p\",[[0,[],0,\"For:\"]]],[10,6],[1,\"p\",[[0,[],0,\"result will be\"]]],[10,7],[1,\"p\",[[0,[],0,\"For:\"]]],[10,8],[1,\"p\",[[0,[],0,\"there will be executed command\"]]],[10,9],[1,\"h2\",[[0,[],0,\"Advantages of using GPT-CLI\"]]],[1,\"p\",[[0,[],0,\"The main advantage of using GPT-CLI is that it makes it easier for newcomers to the field to learn and use the Linux CLI. The Linux CLI can be intimidating for those who are new to programming or system administration, but with GPT-CLI, they can use natural language to interact with the command line, making it more accessible and less intimidating. Additionally, GPT-CLI can help to save time for experienced programmers, as it can be faster to type in a command in English than to remember the exact syntax for each command. This can increase productivity and reduce the time taken to write complex commands.\"]]],[1,\"p\",[[0,[],0,\"Another advantage of GPT-CLI is that it can help to reduce errors when writing Linux commands. With GPT-CLI, you can write commands in natural language, which can reduce the likelihood of making errors due to typos or incorrect syntax. This is especially useful for those who are new to the Linux CLI and may not have a good understanding of the syntax for each command.\"]]],[1,\"p\",[[0,[],0,\"GPT-CLI can also help to reduce the learning curve associated with programming and system administration. With the help of GPT-CLI, users can easily learn the Linux CLI without having to spend a lot of time memorizing complex syntax and commands. This tool has the potential to make the Linux CLI more accessible to a wider audience, including those who may not have a technical background or who are new to programming.\"]]],[1,\"h2\",[[0,[],0,\"Future of GPT-CLI\"]]],[1,\"p\",[[0,[],0,\"The future of GPT-CLI tool looks promising, as the field of natural language processing continues to evolve and improve. With the development of more advanced machine learning algorithms and language models, GPT-CLI has the potential to become even more powerful and accurate. This could lead to even greater accessibility and ease of use for the Linux CLI, making it an even more valuable tool for programmers and system administrators.\"]]],[1,\"p\",[[0,[],0,\"Currently project is slowly growing.\"]]],[10,10],[1,\"p\",[[0,[],0,\"You can download it and use because it is open source.\"]]],[10,11],[1,\"h2\",[[0,[],0,\"Conclusion\"]]],[1,\"p\",[[0,[],0,\"GPT-CLI is a powerful tool that simplifies the Linux CLI using natural language processing. It is a tool that can make the Linux CLI more accessible to a wider audience, including those who may be new to programming or system administration. With the help of GPT-CLI, users can save time and reduce errors when writing Linux commands.\"]]],[1,\"p\",[]]],\"ghostVersion\":\"4.0\"}","html":"<p>The Linux command line interface (CLI) is a powerful tool that allows programmers to interact with their computers and servers in an efficient and fast way. It is a tool that is widely used in programming and system administration. However, learning the Linux CLI can be a daunting task, especially for newcomers to the field. This is where GPT-CLI comes in. GPT-CLI is a tool that uses natural language processing (NLP) to simplify the Linux CLI, making it easier for anyone to use.</p><h2 id=\"what-is-gpt-cli\">What is GPT-CLI?</h2><p>GPT-CLI is a command-line tool that uses the power of natural language processing (NLP) to help programmers write Linux commands using natural language. It is built on top of the OpenAI GPT-3 language model, which is one of the most advanced NLP models available today. With GPT-CLI, you can type in a command in English, and it will automatically translate it into the corresponding Linux CLI command, saving you time and effort.</p><h2 id=\"how-does-gpt-cli-work\">How does GPT-CLI work?</h2><p>GPT-CLI uses machine learning algorithms to analyze the text that you input and generate a response based on that input. When you type in a command in English, GPT-CLI uses NLP to understand the intent of the command and then translates it into the corresponding Linux CLI command. For example, if you type in <code>create a new directory called 'my_folder'</code>, GPT-CLI will translate that into the Linux command <code>mkdir my_folder</code>. This process is made possible by the advanced natural language processing capabilities of GPT-3.</p><p>But there are more use cases. I fyou will write</p><pre><code>p play test.mp3 from console on fedora</code></pre><p>you will get:</p><pre><code>mpg123 test.mp3</code></pre><p>For:</p><pre><code>p display invoice.pdf in fedora</code></pre><p>it will execute</p><pre><code>evince invoice.pdf</code></pre><p>For:</p><pre><code>p convert en.mp4 to en.mp3</code></pre><p>you can expect</p><pre><code>ffmpeg -i en.mp4 en.mp3</code></pre><p>For:</p><pre><code>p count all files in all first level directories here and list name of directories and amount of files inside</code></pre><p>result will be</p><pre><code>find . -mindepth 1 -maxdepth 1 -type d -exec sh -c 'echo -n \"{}: \"; find \"{}\" -type f | wc -l' \\;</code></pre><p>For:</p><pre><code>p length in seconds of ar.mp3</code></pre><p>there will be executed command</p><pre><code>ffprobe -i ar.mp3 -show_entries format=duration -v quiet -of csv=\"p=0\"</code></pre><h2 id=\"advantages-of-using-gpt-cli\">Advantages of using GPT-CLI</h2><p>The main advantage of using GPT-CLI is that it makes it easier for newcomers to the field to learn and use the Linux CLI. The Linux CLI can be intimidating for those who are new to programming or system administration, but with GPT-CLI, they can use natural language to interact with the command line, making it more accessible and less intimidating. Additionally, GPT-CLI can help to save time for experienced programmers, as it can be faster to type in a command in English than to remember the exact syntax for each command. This can increase productivity and reduce the time taken to write complex commands.</p><p>Another advantage of GPT-CLI is that it can help to reduce errors when writing Linux commands. With GPT-CLI, you can write commands in natural language, which can reduce the likelihood of making errors due to typos or incorrect syntax. This is especially useful for those who are new to the Linux CLI and may not have a good understanding of the syntax for each command.</p><p>GPT-CLI can also help to reduce the learning curve associated with programming and system administration. With the help of GPT-CLI, users can easily learn the Linux CLI without having to spend a lot of time memorizing complex syntax and commands. This tool has the potential to make the Linux CLI more accessible to a wider audience, including those who may not have a technical background or who are new to programming.</p><h2 id=\"future-of-gpt-cli\">Future of GPT-CLI</h2><p>The future of GPT-CLI tool looks promising, as the field of natural language processing continues to evolve and improve. With the development of more advanced machine learning algorithms and language models, GPT-CLI has the potential to become even more powerful and accurate. This could lead to even greater accessibility and ease of use for the Linux CLI, making it an even more valuable tool for programmers and system administrators.</p><p>Currently project is slowly growing.</p><!--kg-card-begin: markdown--><p><a href=\"https://star-history.com/#gustawdaniel/gpt-cli&amp;Date\"><img src=\"https://api.star-history.com/svg?repos=gustawdaniel/gpt-cli&amp;type=Date\" alt=\"Star History Chart\" loading=\"lazy\"></a></p>\n<!--kg-card-end: markdown--><p>You can download it and use because it is open source.</p><figure class=\"kg-card kg-bookmark-card\"><a class=\"kg-bookmark-container\" href=\"https://github.com/gustawdaniel/gpt-cli\"><div class=\"kg-bookmark-content\"><div class=\"kg-bookmark-title\">GitHub - gustawdaniel/gpt-cli: Run linux commands with natural language. Eg.: “show my graphic card” instead “lspci | grep VGA”</div><div class=\"kg-bookmark-description\">Run linux commands with natural language. Eg.: &amp;quot;show my graphic card&amp;quot; instead &amp;quot;lspci | grep VGA&amp;quot; - GitHub - gustawdaniel/gpt-cli: Run linux commands with natural language. Eg.:…</div><div class=\"kg-bookmark-metadata\"><img class=\"kg-bookmark-icon\" src=\"https://github.com/fluidicon.png\" alt=\"\"><span class=\"kg-bookmark-author\">GitHub</span><span class=\"kg-bookmark-publisher\">gustawdaniel</span></div></div><div class=\"kg-bookmark-thumbnail\"><img src=\"https://opengraph.githubassets.com/9f789f058f621f6205f218bdd2b378ad57eae198b84698269172e967e6b57906/gustawdaniel/gpt-cli\" alt=\"\"></div></a></figure><h2 id=\"conclusion\">Conclusion</h2><p>GPT-CLI is a powerful tool that simplifies the Linux CLI using natural language processing. It is a tool that can make the Linux CLI more accessible to a wider audience, including those who may be new to programming or system administration. With the help of GPT-CLI, users can save time and reduce errors when writing Linux commands.</p>","comment_id":"64154ee60f360525ad851806","plaintext":"The Linux command line interface (CLI) is a powerful tool that allows programmers to interact with their computers and servers in an efficient and fast way. It is a tool that is widely used in programming and system administration. However, learning the Linux CLI can be a daunting task, especially for newcomers to the field. This is where GPT-CLI comes in. GPT-CLI is a tool that uses natural language processing (NLP) to simplify the Linux CLI, making it easier for anyone to use.\n\n\nWhat is GPT-CLI?\n\nGPT-CLI is a command-line tool that uses the power of natural language processing (NLP) to help programmers write Linux commands using natural language. It is built on top of the OpenAI GPT-3 language model, which is one of the most advanced NLP models available today. With GPT-CLI, you can type in a command in English, and it will automatically translate it into the corresponding Linux CLI command, saving you time and effort.\n\n\nHow does GPT-CLI work?\n\nGPT-CLI uses machine learning algorithms to analyze the text that you input and generate a response based on that input. When you type in a command in English, GPT-CLI uses NLP to understand the intent of the command and then translates it into the corresponding Linux CLI command. For example, if you type in create a new directory called 'my_folder', GPT-CLI will translate that into the Linux command mkdir my_folder. This process is made possible by the advanced natural language processing capabilities of GPT-3.\n\nBut there are more use cases. I fyou will write\n\np play test.mp3 from console on fedora\n\nyou will get:\n\nmpg123 test.mp3\n\nFor:\n\np display invoice.pdf in fedora\n\nit will execute\n\nevince invoice.pdf\n\nFor:\n\np convert en.mp4 to en.mp3\n\nyou can expect\n\nffmpeg -i en.mp4 en.mp3\n\nFor:\n\np count all files in all first level directories here and list name of directories and amount of files inside\n\nresult will be\n\nfind . -mindepth 1 -maxdepth 1 -type d -exec sh -c 'echo -n \"{}: \"; find \"{}\" -type f | wc -l' \\;\n\nFor:\n\np length in seconds of ar.mp3\n\nthere will be executed command\n\nffprobe -i ar.mp3 -show_entries format=duration -v quiet -of csv=\"p=0\"\n\n\nAdvantages of using GPT-CLI\n\nThe main advantage of using GPT-CLI is that it makes it easier for newcomers to the field to learn and use the Linux CLI. The Linux CLI can be intimidating for those who are new to programming or system administration, but with GPT-CLI, they can use natural language to interact with the command line, making it more accessible and less intimidating. Additionally, GPT-CLI can help to save time for experienced programmers, as it can be faster to type in a command in English than to remember the exact syntax for each command. This can increase productivity and reduce the time taken to write complex commands.\n\nAnother advantage of GPT-CLI is that it can help to reduce errors when writing Linux commands. With GPT-CLI, you can write commands in natural language, which can reduce the likelihood of making errors due to typos or incorrect syntax. This is especially useful for those who are new to the Linux CLI and may not have a good understanding of the syntax for each command.\n\nGPT-CLI can also help to reduce the learning curve associated with programming and system administration. With the help of GPT-CLI, users can easily learn the Linux CLI without having to spend a lot of time memorizing complex syntax and commands. This tool has the potential to make the Linux CLI more accessible to a wider audience, including those who may not have a technical background or who are new to programming.\n\n\nFuture of GPT-CLI\n\nThe future of GPT-CLI tool looks promising, as the field of natural language processing continues to evolve and improve. With the development of more advanced machine learning algorithms and language models, GPT-CLI has the potential to become even more powerful and accurate. This could lead to even greater accessibility and ease of use for the Linux CLI, making it an even more valuable tool for programmers and system administrators.\n\nCurrently project is slowly growing.\n\n\n\n\nYou can download it and use because it is open source.\n\nGitHub - gustawdaniel/gpt-cli: Run linux commands with natural language. Eg.: “show my graphic card” instead “lspci | grep VGA”Run linux commands with natural language. Eg.: &quot;show my graphic card&quot; instead &quot;lspci | grep VGA&quot; - GitHub - gustawdaniel/gpt-cli: Run linux commands with natural language. Eg.:…GitHubgustawdaniel\n\n\nConclusion\n\nGPT-CLI is a powerful tool that simplifies the Linux CLI using natural language processing. It is a tool that can make the Linux CLI more accessible to a wider audience, including those who may be new to programming or system administration. With the help of GPT-CLI, users can save time and reduce errors when writing Linux commands.","feature_image":"__GHOST_URL__/content/images/2023/03/Zrzut-ekranu-z-2023-03-18-15-00-56.png","featured":0,"type":"post","status":"published","locale":null,"visibility":"public","email_recipient_filter":"all","created_at":"2023-03-18T05:40:54.000Z","updated_at":"2023-03-18T06:01:36.000Z","published_at":"2023-03-18T06:01:36.000Z","custom_excerpt":"Run linux commands with natural language. Eg.: \"show my graphic card\" instead \"lspci | grep VGA\", open source project written in rust","codeinjection_head":null,"codeinjection_foot":null,"custom_template":null,"canonical_url":null,"newsletter_id":null,"lexical":null},{"id":"6417e0c70f360525ad85186a","uuid":"d01c1e0c-2143-4414-91a9-3dedb8499a4a","title":"How to Install Yay on a Pure Arch Linux Docker Image","slug":"how-to-install-yay-on-pure-archlinux-image","mobiledoc":"{\"version\":\"0.3.1\",\"atoms\":[],\"cards\":[[\"image\",{\"src\":\"__GHOST_URL__/content/images/2023/03/qxsttm8sg5k11-1.jpg\",\"width\":1920,\"height\":1203}],[\"code\",{\"code\":\"docker run --rm -it archlinux\\n\",\"language\":\"bash\"}],[\"code\",{\"code\":\"pacman -Syu --noconfirm && pacman -S --noconfirm base-devel git\\n\",\"language\":\"bash\"}],[\"code\",{\"code\":\"mkdir -p /tmp/yay-build\\nuseradd -m -G wheel builder && passwd -d builder\\nchown -R builder:builder /tmp/yay-build\\n\",\"language\":\"bash\"}],[\"code\",{\"code\":\"echo 'builder ALL=(ALL) NOPASSWD: ALL' >> /etc/sudoers\",\"language\":\"bash\"}],[\"code\",{\"code\":\"su - builder -c \\\"git clone https://aur.archlinux.org/yay.git /tmp/yay-build/yay\\\"\\n\",\"language\":\"bash\"}],[\"code\",{\"code\":\"su - builder -c \\\"cd /tmp/yay-build/yay && makepkg -si --noconfirm\\\"\\n\",\"language\":\"bash\"}],[\"code\",{\"code\":\"rm -rf /tmp/yay-build\\n\",\"language\":\"bash\"}],[\"code\",{\"code\":\"su - builder\",\"language\":\"bash\"}],[\"code\",{\"code\":\"yay -S gpt-cli\",\"language\":\"bash\"}],[\"image\",{\"src\":\"__GHOST_URL__/content/images/2023/03/Zrzut-ekranu-z-2023-03-20-14-06-58.png\",\"width\":932,\"height\":597}],[\"code\",{\"code\":\"GPT3_API_KEY=\\\"sk-xxx\\\" p perl onliner that will show first 10 fibonacci sequence elements\",\"language\":\"bash\"}],[\"code\",{\"code\":\"perl -e 'sub f{ $_[0] < 2 ? $_[0] : f($_[0]-1) + f($_[0]-2) }; foreach(0..9){ print f($_), \\\"\\\\n\\\"; }'\",\"language\":\"bash\"}],[\"image\",{\"src\":\"__GHOST_URL__/content/images/2023/03/Zrzut-ekranu-z-2023-03-20-14-19-04.png\",\"width\":924,\"height\":475,\"caption\":\"\"}],[\"bookmark\",{\"version\":\"1.0\",\"type\":\"bookmark\",\"url\":\"https://github.com/gustawdaniel/gpt-cli\",\"metadata\":{\"url\":\"https://github.com/gustawdaniel/gpt-cli\",\"title\":\"GitHub - gustawdaniel/gpt-cli: Run linux commands with natural language. Eg.: “show my graphic card” instead “lspci | grep VGA”\",\"description\":\"Run linux commands with natural language. Eg.: &quot;show my graphic card&quot; instead &quot;lspci | grep VGA&quot; - GitHub - gustawdaniel/gpt-cli: Run linux commands with natural language. Eg.:…\",\"author\":\"gustawdaniel\",\"publisher\":\"GitHub\",\"thumbnail\":\"https://opengraph.githubassets.com/aa00a9518a887f37dbe73838a74aa076bca5d0859690077b9357932f1bf89b74/gustawdaniel/gpt-cli\",\"icon\":\"https://github.com/fluidicon.png\"}}]],\"markups\":[[\"code\"]],\"sections\":[[1,\"p\",[[0,[],0,\"In this article, we will guide you through the process of installing the \"],[0,[0],1,\"yay\"],[0,[],0,\" AUR helper on a pure Arch Linux Docker image. Yay is a popular, user-friendly tool for managing packages from the Arch User Repository (AUR). Installing \"],[0,[0],1,\"yay\"],[0,[],0,\" on an Arch Linux Docker image can help you streamline package management and keep your containerized applications up-to-date.\"]]],[10,0],[1,\"h2\",[[0,[],0,\"Preparing the Arch Linux Docker Image\"]]],[1,\"p\",[[0,[],0,\"First, start a new Arch Linux Docker container by running the following command:\"]]],[10,1],[1,\"p\",[[0,[],0,\"This command will download the latest Arch Linux image (if you don't have it already) and start an interactive container session.\"]]],[1,\"h2\",[[0,[],0,\"Updating the System and Installing Dependencies\"]]],[1,\"p\",[[0,[],0,\"Before installing \"],[0,[0],1,\"yay\"],[0,[],0,\", ensure your Arch Linux container is up-to-date and has the required dependencies installed. Update the system and install \"],[0,[0],1,\"base-devel\"],[0,[],0,\" and \"],[0,[0],1,\"git\"],[0,[],0,\" using the following command:\"]]],[10,2],[1,\"p\",[[0,[0],1,\"base-devel\"],[0,[],0,\" contains essential tools for building packages, while \"],[0,[0],1,\"git\"],[0,[],0,\" allows you to clone the \"],[0,[0],1,\"yay\"],[0,[],0,\" repository.\"]]],[1,\"h2\",[[0,[],0,\"Creating a Temporary Build Directory\"]]],[1,\"p\",[[0,[],0,\"To build and install \"],[0,[0],1,\"yay\"],[0,[],0,\", you need a temporary directory. Create a directory named \"],[0,[0],1,\"/tmp/yay-build\"],[0,[],0,\" and change its ownership to the new user \"],[0,[0],1,\"builder\"],[0,[],0,\" using these commands:\"]]],[10,3],[1,\"h2\",[[0,[],0,\"Granting Sudo Permissions\"]]],[1,\"p\",[[0,[],0,\"Allow the \"],[0,[0],1,\"builder\"],[0,[],0,\" user to use \"],[0,[0],1,\"sudo\"],[0,[],0,\" without a password by adding an entry in the \"],[0,[0],1,\"/etc/sudoers\"],[0,[],0,\" file:\"]]],[10,4],[1,\"h2\",[[0,[],0,\"Cloning the Yay Repository\"]]],[1,\"p\",[[0,[],0,\"As the \"],[0,[0],1,\"builder\"],[0,[],0,\" user, clone the \"],[0,[0],1,\"yay\"],[0,[],0,\" repository to the \"],[0,[0],1,\"/tmp/yay-build\"],[0,[],0,\" directory:\"]]],[10,5],[1,\"h2\",[[0,[],0,\"Building and Installing Yay\"]]],[1,\"p\",[[0,[],0,\"Now, build and install \"],[0,[0],1,\"yay\"],[0,[],0,\" using the \"],[0,[0],1,\"makepkg\"],[0,[],0,\" command:\"]]],[10,6],[1,\"p\",[[0,[],0,\"This command will build and install \"],[0,[0],1,\"yay\"],[0,[],0,\" without prompting for confirmation.\"]]],[1,\"h2\",[[0,[],0,\"Cleaning Up\"]]],[1,\"p\",[[0,[],0,\"After successfully installing \"],[0,[0],1,\"yay\"],[0,[],0,\" remove the temporary build directory:\"]]],[10,7],[1,\"p\",[[0,[],0,\"You have successfully installed \"],[0,[0],1,\"yay\"],[0,[],0,\" on a pure Arch Linux Docker image. With \"],[0,[0],1,\"yay\"],[0,[],0,\" installed, you can now easily manage AUR packages within your containerized Arch Linux environment. This can be particularly useful for developers and system administrators who use Arch Linux and Docker for their applications and services.\"]]],[1,\"h2\",[[0,[],0,\"Let's test if it works on example of gpt-cli\"]]],[1,\"p\",[[0,[],0,\"We will switch to user \"],[0,[0],1,\"builder\"]]],[10,8],[1,\"p\",[[0,[],0,\"and install first package. For example\"]]],[10,9],[10,10],[1,\"p\",[[0,[],0,\"It allow to recommend you linux commands using \"],[0,[0],1,\"openai\"],[0,[],0,\" api with \"],[0,[0],1,\"gpt-3.5-turbo\"],[0,[],0,\" model. You can test it typing:\"]]],[10,11],[1,\"p\",[[0,[],0,\"you will see info that script presented below was copied to your clipboard\"]]],[10,12],[10,13],[1,\"p\",[[0,[],0,\"You can read full docs of \"],[0,[0],1,\"gpt-cli\"],[0,[],0,\" on github. \"]]],[10,14],[1,\"p\",[[0,[],0,\"I hope that blog post will help you in installing yay on arch docker image. \"]]]],\"ghostVersion\":\"4.0\"}","html":"<p>In this article, we will guide you through the process of installing the <code>yay</code> AUR helper on a pure Arch Linux Docker image. Yay is a popular, user-friendly tool for managing packages from the Arch User Repository (AUR). Installing <code>yay</code> on an Arch Linux Docker image can help you streamline package management and keep your containerized applications up-to-date.</p><figure class=\"kg-card kg-image-card\"><img src=\"__GHOST_URL__/content/images/2023/03/qxsttm8sg5k11-1.jpg\" class=\"kg-image\" alt loading=\"lazy\" width=\"1920\" height=\"1203\" srcset=\"__GHOST_URL__/content/images/size/w600/2023/03/qxsttm8sg5k11-1.jpg 600w, __GHOST_URL__/content/images/size/w1000/2023/03/qxsttm8sg5k11-1.jpg 1000w, __GHOST_URL__/content/images/size/w1600/2023/03/qxsttm8sg5k11-1.jpg 1600w, __GHOST_URL__/content/images/2023/03/qxsttm8sg5k11-1.jpg 1920w\" sizes=\"(min-width: 720px) 720px\"></figure><h2 id=\"preparing-the-arch-linux-docker-image\">Preparing the Arch Linux Docker Image</h2><p>First, start a new Arch Linux Docker container by running the following command:</p><pre><code class=\"language-bash\">docker run --rm -it archlinux\n</code></pre><p>This command will download the latest Arch Linux image (if you don't have it already) and start an interactive container session.</p><h2 id=\"updating-the-system-and-installing-dependencies\">Updating the System and Installing Dependencies</h2><p>Before installing <code>yay</code>, ensure your Arch Linux container is up-to-date and has the required dependencies installed. Update the system and install <code>base-devel</code> and <code>git</code> using the following command:</p><pre><code class=\"language-bash\">pacman -Syu --noconfirm &amp;&amp; pacman -S --noconfirm base-devel git\n</code></pre><p><code>base-devel</code> contains essential tools for building packages, while <code>git</code> allows you to clone the <code>yay</code> repository.</p><h2 id=\"creating-a-temporary-build-directory\">Creating a Temporary Build Directory</h2><p>To build and install <code>yay</code>, you need a temporary directory. Create a directory named <code>/tmp/yay-build</code> and change its ownership to the new user <code>builder</code> using these commands:</p><pre><code class=\"language-bash\">mkdir -p /tmp/yay-build\nuseradd -m -G wheel builder &amp;&amp; passwd -d builder\nchown -R builder:builder /tmp/yay-build\n</code></pre><h2 id=\"granting-sudo-permissions\">Granting Sudo Permissions</h2><p>Allow the <code>builder</code> user to use <code>sudo</code> without a password by adding an entry in the <code>/etc/sudoers</code> file:</p><pre><code class=\"language-bash\">echo 'builder ALL=(ALL) NOPASSWD: ALL' &gt;&gt; /etc/sudoers</code></pre><h2 id=\"cloning-the-yay-repository\">Cloning the Yay Repository</h2><p>As the <code>builder</code> user, clone the <code>yay</code> repository to the <code>/tmp/yay-build</code> directory:</p><pre><code class=\"language-bash\">su - builder -c \"git clone https://aur.archlinux.org/yay.git /tmp/yay-build/yay\"\n</code></pre><h2 id=\"building-and-installing-yay\">Building and Installing Yay</h2><p>Now, build and install <code>yay</code> using the <code>makepkg</code> command:</p><pre><code class=\"language-bash\">su - builder -c \"cd /tmp/yay-build/yay &amp;&amp; makepkg -si --noconfirm\"\n</code></pre><p>This command will build and install <code>yay</code> without prompting for confirmation.</p><h2 id=\"cleaning-up\">Cleaning Up</h2><p>After successfully installing <code>yay</code> remove the temporary build directory:</p><pre><code class=\"language-bash\">rm -rf /tmp/yay-build\n</code></pre><p>You have successfully installed <code>yay</code> on a pure Arch Linux Docker image. With <code>yay</code> installed, you can now easily manage AUR packages within your containerized Arch Linux environment. This can be particularly useful for developers and system administrators who use Arch Linux and Docker for their applications and services.</p><h2 id=\"lets-test-if-it-works-on-example-of-gpt-cli\">Let's test if it works on example of gpt-cli</h2><p>We will switch to user <code>builder</code></p><pre><code class=\"language-bash\">su - builder</code></pre><p>and install first package. For example</p><pre><code class=\"language-bash\">yay -S gpt-cli</code></pre><figure class=\"kg-card kg-image-card\"><img src=\"__GHOST_URL__/content/images/2023/03/Zrzut-ekranu-z-2023-03-20-14-06-58.png\" class=\"kg-image\" alt loading=\"lazy\" width=\"932\" height=\"597\" srcset=\"__GHOST_URL__/content/images/size/w600/2023/03/Zrzut-ekranu-z-2023-03-20-14-06-58.png 600w, __GHOST_URL__/content/images/2023/03/Zrzut-ekranu-z-2023-03-20-14-06-58.png 932w\" sizes=\"(min-width: 720px) 720px\"></figure><p>It allow to recommend you linux commands using <code>openai</code> api with <code>gpt-3.5-turbo</code> model. You can test it typing:</p><pre><code class=\"language-bash\">GPT3_API_KEY=\"sk-xxx\" p perl onliner that will show first 10 fibonacci sequence elements</code></pre><p>you will see info that script presented below was copied to your clipboard</p><pre><code class=\"language-bash\">perl -e 'sub f{ $_[0] &lt; 2 ? $_[0] : f($_[0]-1) + f($_[0]-2) }; foreach(0..9){ print f($_), \"\\n\"; }'</code></pre><figure class=\"kg-card kg-image-card\"><img src=\"__GHOST_URL__/content/images/2023/03/Zrzut-ekranu-z-2023-03-20-14-19-04.png\" class=\"kg-image\" alt loading=\"lazy\" width=\"924\" height=\"475\" srcset=\"__GHOST_URL__/content/images/size/w600/2023/03/Zrzut-ekranu-z-2023-03-20-14-19-04.png 600w, __GHOST_URL__/content/images/2023/03/Zrzut-ekranu-z-2023-03-20-14-19-04.png 924w\" sizes=\"(min-width: 720px) 720px\"></figure><p>You can read full docs of <code>gpt-cli</code> on github. </p><figure class=\"kg-card kg-bookmark-card\"><a class=\"kg-bookmark-container\" href=\"https://github.com/gustawdaniel/gpt-cli\"><div class=\"kg-bookmark-content\"><div class=\"kg-bookmark-title\">GitHub - gustawdaniel/gpt-cli: Run linux commands with natural language. Eg.: “show my graphic card” instead “lspci | grep VGA”</div><div class=\"kg-bookmark-description\">Run linux commands with natural language. Eg.: &amp;quot;show my graphic card&amp;quot; instead &amp;quot;lspci | grep VGA&amp;quot; - GitHub - gustawdaniel/gpt-cli: Run linux commands with natural language. Eg.:…</div><div class=\"kg-bookmark-metadata\"><img class=\"kg-bookmark-icon\" src=\"https://github.com/fluidicon.png\" alt=\"\"><span class=\"kg-bookmark-author\">GitHub</span><span class=\"kg-bookmark-publisher\">gustawdaniel</span></div></div><div class=\"kg-bookmark-thumbnail\"><img src=\"https://opengraph.githubassets.com/aa00a9518a887f37dbe73838a74aa076bca5d0859690077b9357932f1bf89b74/gustawdaniel/gpt-cli\" alt=\"\"></div></a></figure><p>I hope that blog post will help you in installing yay on arch docker image. </p>","comment_id":"6417e0c70f360525ad85186a","plaintext":"In this article, we will guide you through the process of installing the yay AUR helper on a pure Arch Linux Docker image. Yay is a popular, user-friendly tool for managing packages from the Arch User Repository (AUR). Installing yay on an Arch Linux Docker image can help you streamline package management and keep your containerized applications up-to-date.\n\n\nPreparing the Arch Linux Docker Image\n\nFirst, start a new Arch Linux Docker container by running the following command:\n\ndocker run --rm -it archlinux\n\n\nThis command will download the latest Arch Linux image (if you don't have it already) and start an interactive container session.\n\n\nUpdating the System and Installing Dependencies\n\nBefore installing yay, ensure your Arch Linux container is up-to-date and has the required dependencies installed. Update the system and install base-devel and git using the following command:\n\npacman -Syu --noconfirm && pacman -S --noconfirm base-devel git\n\n\nbase-devel contains essential tools for building packages, while git allows you to clone the yay repository.\n\n\nCreating a Temporary Build Directory\n\nTo build and install yay, you need a temporary directory. Create a directory named /tmp/yay-build and change its ownership to the new user builder using these commands:\n\nmkdir -p /tmp/yay-build\nuseradd -m -G wheel builder && passwd -d builder\nchown -R builder:builder /tmp/yay-build\n\n\n\nGranting Sudo Permissions\n\nAllow the builder user to use sudo without a password by adding an entry in the /etc/sudoers file:\n\necho 'builder ALL=(ALL) NOPASSWD: ALL' >> /etc/sudoers\n\n\nCloning the Yay Repository\n\nAs the builder user, clone the yay repository to the /tmp/yay-build directory:\n\nsu - builder -c \"git clone https://aur.archlinux.org/yay.git /tmp/yay-build/yay\"\n\n\n\nBuilding and Installing Yay\n\nNow, build and install yay using the makepkg command:\n\nsu - builder -c \"cd /tmp/yay-build/yay && makepkg -si --noconfirm\"\n\n\nThis command will build and install yay without prompting for confirmation.\n\n\nCleaning Up\n\nAfter successfully installing yay remove the temporary build directory:\n\nrm -rf /tmp/yay-build\n\n\nYou have successfully installed yay on a pure Arch Linux Docker image. With yay installed, you can now easily manage AUR packages within your containerized Arch Linux environment. This can be particularly useful for developers and system administrators who use Arch Linux and Docker for their applications and services.\n\n\nLet's test if it works on example of gpt-cli\n\nWe will switch to user builder\n\nsu - builder\n\nand install first package. For example\n\nyay -S gpt-cli\n\nIt allow to recommend you linux commands using openai api with gpt-3.5-turbo model. You can test it typing:\n\nGPT3_API_KEY=\"sk-xxx\" p perl onliner that will show first 10 fibonacci sequence elements\n\nyou will see info that script presented below was copied to your clipboard\n\nperl -e 'sub f{ $_[0] < 2 ? $_[0] : f($_[0]-1) + f($_[0]-2) }; foreach(0..9){ print f($_), \"\\n\"; }'\n\nYou can read full docs of gpt-cli on github.\n\nGitHub - gustawdaniel/gpt-cli: Run linux commands with natural language. Eg.: “show my graphic card” instead “lspci | grep VGA”Run linux commands with natural language. Eg.: &quot;show my graphic card&quot; instead &quot;lspci | grep VGA&quot; - GitHub - gustawdaniel/gpt-cli: Run linux commands with natural language. Eg.:…GitHubgustawdaniel\n\nI hope that blog post will help you in installing yay on arch docker image.","feature_image":"__GHOST_URL__/content/images/2023/03/pexels-dexter-fernandes-2646237.jpg","featured":0,"type":"post","status":"published","locale":null,"visibility":"public","email_recipient_filter":"all","created_at":"2023-03-20T04:27:51.000Z","updated_at":"2023-03-20T06:03:00.000Z","published_at":"2023-03-20T06:03:00.000Z","custom_excerpt":"Yay installation require few steps like user creation, base-devel and git installation, change in /etc/sudousers, cloning yay repo and makepkg on it. This posts covering this process steps by steps. ","codeinjection_head":null,"codeinjection_foot":null,"custom_template":null,"canonical_url":null,"newsletter_id":null,"lexical":null},{"id":"6419a4484e210aabcb6e161b","uuid":"7e296187-3afc-4e42-bd06-a8662a77ba78","title":"Creating an RPM Package for a Rust CLI Application on Fedora","slug":"creating-an-rpm-package-for-a-rust-cli-application-on-fedora","mobiledoc":"{\"version\":\"0.3.1\",\"atoms\":[],\"cards\":[[\"code\",{\"code\":\"sudo dnf install rpm-build cargo\\n\"}]],\"markups\":[[\"code\"]],\"sections\":[[1,\"p\",[[0,[],0,\"In this blog post, we will explore the process of creating an RPM package for a Rust-based Command Line Interface (CLI) application on Fedora. The RPM package will allow users to easily install and manage the Rust CLI application on their Fedora systems.\"]]],[1,\"p\",[[0,[],0,\"Prerequisites:\"]]],[3,\"ol\",[[[0,[],0,\"A Rust CLI application you want to package\"]],[[0,[],0,\"Fedora system for development and testing\"]],[[0,[],0,\"Basic understanding of Rust and RPM package management\"]]]],[1,\"p\",[[0,[],0,\"Steps to create an RPM package for a Rust CLI application:\"]]],[1,\"p\",[[0,[],0,\"Step 1: Install necessary tools\"]]],[1,\"p\",[[0,[],0,\"To create an RPM package, you will need to have the \"],[0,[0],1,\"rpm-build\"],[0,[],0,\" and \"],[0,[0],1,\"cargo\"],[0,[],0,\" packages installed on your Fedora system. Install them using the following command:\"]]],[10,0],[1,\"p\",[]]],\"ghostVersion\":\"4.0\"}","html":"<p>In this blog post, we will explore the process of creating an RPM package for a Rust-based Command Line Interface (CLI) application on Fedora. The RPM package will allow users to easily install and manage the Rust CLI application on their Fedora systems.</p><p>Prerequisites:</p><ol><li>A Rust CLI application you want to package</li><li>Fedora system for development and testing</li><li>Basic understanding of Rust and RPM package management</li></ol><p>Steps to create an RPM package for a Rust CLI application:</p><p>Step 1: Install necessary tools</p><p>To create an RPM package, you will need to have the <code>rpm-build</code> and <code>cargo</code> packages installed on your Fedora system. Install them using the following command:</p><pre><code>sudo dnf install rpm-build cargo\n</code></pre>","comment_id":"6419a4484e210aabcb6e161b","plaintext":"In this blog post, we will explore the process of creating an RPM package for a Rust-based Command Line Interface (CLI) application on Fedora. The RPM package will allow users to easily install and manage the Rust CLI application on their Fedora systems.\n\nPrerequisites:\n\n 1. A Rust CLI application you want to package\n 2. Fedora system for development and testing\n 3. Basic understanding of Rust and RPM package management\n\nSteps to create an RPM package for a Rust CLI application:\n\nStep 1: Install necessary tools\n\nTo create an RPM package, you will need to have the rpm-build and cargo packages installed on your Fedora system. Install them using the following command:\n\nsudo dnf install rpm-build cargo\n","feature_image":null,"featured":0,"type":"post","status":"draft","locale":null,"visibility":"public","email_recipient_filter":"all","created_at":"2023-03-21T12:34:16.000Z","updated_at":"2023-03-21T12:34:48.000Z","published_at":null,"custom_excerpt":null,"codeinjection_head":null,"codeinjection_foot":null,"custom_template":null,"canonical_url":null,"newsletter_id":null,"lexical":null},{"id":"641e5d1b4e210aabcb6e1625","uuid":"d2fbbe5b-ac66-48c6-b2bb-84102e991b7f","title":"Tutorial for ESM + CommonJS package creators","slug":"simplest-tutorial-for-esm-commonjs-package-creators","mobiledoc":"{\"version\":\"0.3.1\",\"atoms\":[],\"cards\":[[\"bookmark\",{\"version\":\"1.0\",\"type\":\"bookmark\",\"url\":\"https://www.sitepoint.com/understanding-es6-modules-via-their-history/\",\"metadata\":{\"url\":\"https://www.sitepoint.com/understanding-es6-modules-via-their-history/\",\"title\":\"Understanding ES6 Modules via Their History — SitePoint\",\"description\":\"Elias Carlston looks at the history behind JavaScript ES6 modules and how that has influenced module design in its current state.\",\"author\":\"Elias Carlston\",\"publisher\":\"SitePoint\",\"thumbnail\":\"https://uploads.sitepoint.com/wp-content/uploads/2016/07/14692419621467552652understanding-es6-modules-via-their-history08-AMD.jpg\",\"icon\":\"https://www.sitepoint.com/favicons/512x512.png\"}}],[\"bookmark\",{\"version\":\"1.0\",\"type\":\"bookmark\",\"url\":\"https://gist.github.com/sindresorhus/a39789f98801d908bbc7ff3ecc99d99c\",\"metadata\":{\"url\":\"https://gist.github.com/sindresorhus/a39789f98801d908bbc7ff3ecc99d99c\",\"title\":\"Pure ESM package\",\"description\":\"Pure ESM package. GitHub Gist: instantly share code, notes, and snippets.\",\"author\":\"262588213843476\",\"publisher\":\"Gist\",\"thumbnail\":\"https://github.githubassets.com/images/modules/gists/gist-og-image.png\",\"icon\":\"https://gist.github.com/fluidicon.png\"}}],[\"bookmark\",{\"version\":\"1.0\",\"type\":\"bookmark\",\"url\":\"https://formidable.com/blog/2022/victory-esm/\",\"metadata\":{\"url\":\"https://formidable.com/blog/2022/victory-esm\",\"title\":\"The awkward valley to ESM: Node.js, Victory, and D3\",\"description\":\"We continue our examination of the shift to ESM on Node.js and broader ramifications for the ecosystem. In this post, we look at the challenges and lessons in handling ESM-only dependencies in our Victory charting library.\",\"author\":\"Formidable\",\"publisher\":\"Formidable - The Digital Product Experts. We build the modern web.\",\"thumbnail\":\"https://res.cloudinary.com/formidablelabs/image/upload/f_auto,q_auto/v1675121564/dotcom/uploads-victory-esm-fig-01-awkward-valley\",\"icon\":\"https://formidable.com/favicon/apple-touch-icon.png?v=eE54G4onR8\"}}],[\"code\",{\"code\":\"Error: require() of ES modules is not supported when importing\"}],[\"bookmark\",{\"version\":\"1.0\",\"type\":\"bookmark\",\"url\":\"https://stackoverflow.com/questions/69041454/error-require-of-es-modules-is-not-supported-when-importing-node-fetch\",\"metadata\":{\"url\":\"https://stackoverflow.com/questions/69041454/error-require-of-es-modules-is-not-supported-when-importing-node-fetch\",\"title\":\"Error: require() of ES modules is not supported when importing node-fetch\",\"description\":\"I’m creating a program to analyze security camera streams and got stuck on the very first line. At the moment my .js file has nothing but the import of node-fetch and it gives me an error message.…\",\"author\":\"Roope Kuisma\",\"publisher\":\"Stack Overflow\",\"thumbnail\":\"https://cdn.sstatic.net/Sites/stackoverflow/Img/apple-touch-icon@2.png?v=73d79a89bded\",\"icon\":\"https://cdn.sstatic.net/Sites/stackoverflow/Img/apple-touch-icon.png?v=c78bd457575a\"}}],[\"bookmark\",{\"version\":\"1.0\",\"type\":\"bookmark\",\"url\":\"https://stackoverflow.com/questions/69081410/error-err-require-esm-require-of-es-module-not-supported\",\"metadata\":{\"url\":\"https://stackoverflow.com/questions/69081410/error-err-require-esm-require-of-es-module-not-supported\",\"title\":\"Error [ERR_REQUIRE_ESM]: require() of ES Module not supported\",\"description\":\"I’m trying to make a Discord bot that just says if someone is online on the game.\\nHowever I keep getting this message: [ERR_REQUIRE_ESM]: require() of ES Module from not supported. Instead change…\",\"author\":\"N-Man\",\"publisher\":\"Stack Overflow\",\"thumbnail\":\"https://cdn.sstatic.net/Sites/stackoverflow/Img/apple-touch-icon@2.png?v=73d79a89bded\",\"icon\":\"https://cdn.sstatic.net/Sites/stackoverflow/Img/apple-touch-icon.png?v=c78bd457575a\"}}],[\"bookmark\",{\"version\":\"1.0\",\"type\":\"bookmark\",\"url\":\"https://www.knowledgehut.com/blog/web-development/commonjs-vs-es-modules\",\"metadata\":{\"url\":\"https://www.knowledgehut.com/blog/web-development/commonjs-vs-es-modules\",\"title\":\"CommonJS vs ES Modules in Node.js - A Detailed Comparison\",\"description\":\"A module system allows you to split up your code into parts or include code written by other developers. Check CommonJS vs ES modules comparision when using them in Node.js apps.\",\"author\":\"Gaurav Roy\",\"publisher\":\"A Detailed Comparison\",\"thumbnail\":\"https://d2o2utebsixu4k.cloudfront.net/media/images/blogs/share_image/2365adef-48f7-4e81-b402-ed6d02c92ad6.png\",\"icon\":\"https://www.knowledgehut.com/next_favicons/favicon-180.png\"}}],[\"image\",{\"src\":\"__GHOST_URL__/content/images/2023/03/7fv8ft.jpg\",\"width\":700,\"height\":449}],[\"bookmark\",{\"version\":\"1.0\",\"type\":\"bookmark\",\"url\":\"https://nodejs.org/api/packages.html#dual-package-hazard\",\"metadata\":{\"url\":\"https://nodejs.org/api/packages.html\",\"title\":\"Modules: Packages | Node.js v19.8.1 Documentation\",\"description\":null,\"author\":null,\"publisher\":\"Node.js v19.8.1 Documentation\",\"thumbnail\":null,\"icon\":\"https://nodejs.org/favicon.ico\"}}],[\"image\",{\"src\":\"__GHOST_URL__/content/images/2023/03/Zrzut-ekranu-z-2023-03-25-16-35-02.png\",\"width\":887,\"height\":746}],[\"bookmark\",{\"version\":\"1.0\",\"type\":\"bookmark\",\"url\":\"https://evertpot.com/universal-commonjs-esm-typescript-packages/\",\"metadata\":{\"url\":\"https://evertpot.com/universal-commonjs-esm-typescript-packages/\",\"title\":\"Supporting CommonJS and ESM with Typescript and Node\",\"description\":null,\"author\":null,\"publisher\":null,\"thumbnail\":\"https://evertpot.com/assets/cover/flower.png\",\"icon\":\"https://evertpot.com/assets/img/flower-icon.png\"}}],[\"code\",{\"code\":\"npm init -y && tsc --init && mkdir -p src && touch src/index.ts\"}],[\"code\",{\"code\":\"export function sum(a: number, b: number): number {\\n    return a+b;\\n}\\n\"}],[\"code\",{\"code\":\"\\\"build\\\": \\\"npx tsc --module commonjs --outDir cjs/ && echo '{\\\\\\\"type\\\\\\\": \\\\\\\"commonjs\\\\\\\"}' > cjs/package.json && npx tsc --module es2022 --outDir esm/ && echo '{\\\\\\\"type\\\\\\\": \\\\\\\"module\\\\\\\"}' > esm/package.json\\\"\\n\"}],[\"code\",{\"code\":\"  \\\"exports\\\": {\\n    \\\"require\\\": \\\"./cjs/index.js\\\",\\n    \\\"import\\\": \\\"./esm/index.js\\\"\\n  },\\n  \\\"types\\\": \\\"./src\\\",\"}],[\"code\",{\"code\":\"  \\\"main\\\": \\\"cjs/index.js\\\"\"}],[\"code\",{\"code\":\"npm run build\"}],[\"code\",{\"code\":\"npm init -y\"}],[\"code\",{\"code\":\"    \\\"sumesm\\\": \\\"file:./../dual\\\"\\n\"}],[\"code\",{\"code\":\"const s = require('sumesm');\\n\\nconsole.log(s.sum(1, 2));\"}],[\"code\",{\"code\":\"(async () => {\\n    const s = await import('sumesm');\\n    console.log(s.sum(1, 2));\\n})()\\n\\n\"}],[\"code\",{\"code\":\"npm install --save-dev jest @types/jest ts-jest\\nnpx ts-jest config:init\\n\"}],[\"code\",{\"code\":\"gpt-cli add and config jest for typescript to node project\"}],[\"code\",{\"code\":\"mkdir -p test && touch test/sum.test.ts\"}],[\"code\",{\"code\":\"import {sum} from \\\"../src\\\";\\n\\nit('sum', () => {\\n    expect(sum(1, 2)).toEqual(3)\\n})\"}],[\"code\",{\"code\":\"    \\\"test\\\": \\\"jest\\\",\"}],[\"code\",{\"code\":\"Tests:       1 passed, 1 total\\nTime:        1.185 s\\n\"}],[\"code\",{\"code\":\"\\\"transform\\\": {\\n    \\\"^.+\\\\\\\\.tsx?$\\\": \\\"esbuild-jest\\\"\\n  },\"}],[\"code\",{\"code\":\"Tests:       1 passed, 1 total\\nTime:        0.152 s, estimated 2 s\\n\"}],[\"code\",{\"code\":\" \\\"include\\\": [\\n    \\\"src/**/*\\\"\\n  ]\"}],[\"code\",{\"code\":\"    \\\"build\\\": \\\"npx esbuild --bundle src/index.ts --outdir=cjs --platform=node --format=cjs && echo '{\\\\\\\"type\\\\\\\": \\\\\\\"commonjs\\\\\\\"}' > cjs/package.json && npx esbuild --bundle src/index.ts --outdir=esm --platform=neutral --format=esm && echo '{\\\\\\\"type\\\\\\\": \\\\\\\"module\\\\\\\"}' > esm/package.json\\\"\\n\"}],[\"code\",{\"code\":\"package.json\\nesm\\ncjs\\nsrc\"}],[\"image\",{\"src\":\"__GHOST_URL__/content/images/2023/03/Zrzut-ekranu-z-2023-03-26-23-42-28.png\",\"width\":524,\"height\":103}],[\"image\",{\"src\":\"__GHOST_URL__/content/images/2023/03/Zrzut-ekranu-z-2023-03-26-23-43-32.png\",\"width\":432,\"height\":113}],[\"bookmark\",{\"version\":\"1.0\",\"type\":\"bookmark\",\"url\":\"https://github.com/slevithan/xregexp/issues/305\",\"metadata\":{\"url\":\"https://github.com/slevithan/xregexp/issues/305\",\"title\":\"Import does not work anymore since version 4.4.0 · Issue #305 · slevithan/xregexp\",\"description\":\"We use xregexp in a shared library that is used in our client (Angular 10) as well as on our server (NodeJS / Webpack 5). Until version 4.3.0 we were able to import xregexp like this and everything…\",\"author\":\"slevithan\",\"publisher\":\"GitHub\",\"thumbnail\":\"https://opengraph.githubassets.com/e98ebcf8cadcd1e7edfd7f574b066be722ebb5d72b159263b31e7e48cf8648d7/slevithan/xregexp/issues/305\",\"icon\":\"https://github.com/fluidicon.png\"}}],[\"image\",{\"src\":\"__GHOST_URL__/content/images/2023/03/Zrzut-ekranu-z-2023-03-26-23-47-45.png\",\"width\":1244,\"height\":836}],[\"code\",{\"code\":\"  \\\"dependencies\\\": {\\n    \\\"humanize-string\\\": \\\"^2.1.0\\\"\\n  },\\n  \\\"overrides\\\": {\\n    \\\"decamelize\\\": \\\"4.0.0\\\"\\n  }\"}],[\"bookmark\",{\"version\":\"1.0\",\"type\":\"bookmark\",\"url\":\"https://github.com/sindresorhus/decamelize/releases/tag/v4.0.0\",\"metadata\":{\"url\":\"https://github.com/sindresorhus/decamelize/releases/tag/v4.0.0\",\"title\":\"Release v4.0.0 · sindresorhus/decamelize\",\"description\":\"If you need Firefox support, stay on version 3.\\nBreaking Require Node.js 10 and drop xregexp dependency (#22) 7ac6111 Fixes Fix handling of capitalized word which ends with a number (#23) 26c7…\",\"author\":\"sindresorhus\",\"publisher\":\"GitHub\",\"thumbnail\":\"https://opengraph.githubassets.com/787a6b61929b7c93350b92eae838561ed672af2159fbae31dcc1e6580c768f56/sindresorhus/decamelize/releases/tag/v4.0.0\",\"icon\":\"https://github.com/fluidicon.png\"}}],[\"embed\",{\"url\":\"https://www.reddit.com/r/node/comments/121a1wa/esm_vs_dual_package/\",\"html\":\"\\n    <blockquote class=\\\"reddit-embed-bq\\\" >\\n      <a href=\\\"https://www.reddit.com/r/node/comments/121a1wa/esm_vs_dual_package/\\\">ESM vs Dual Package?</a><br> by\\n      <a href=\\\"https://www.reddit.com/user/gustaw_daniel\\\">u/gustaw_daniel</a> in\\n      <a href=\\\"https://www.reddit.com/r/node/\\\">node</a>\\n    </blockquote>\\n    <script async src=\\\"https://embed.reddit.com/widgets.js\\\" charset=\\\"UTF-8\\\"></script>\\n\",\"type\":\"rich\",\"metadata\":{\"provider_url\":\"https://reddit.com/\",\"version\":\"1.0\",\"title\":\"ESM vs Dual Package?\",\"provider_name\":\"Reddit\",\"author_name\":\"gustaw_daniel\"}}]],\"markups\":[[\"code\"],[\"a\",[\"href\",\"https://github.com/gustawdaniel/gpt-cli\"]]],\"sections\":[[1,\"p\",[[0,[],0,\"I will start from sources and context, then show practical implementation.\"]]],[1,\"h2\",[[0,[],0,\"Pure ESM vs Dual Packages\"]]],[1,\"p\",[[0,[],0,\"Modules in JavaScript has awesome history and knowledge of their evolution is important for understanding current state and forecasting future shape of JS ecosystem. \"]]],[10,0],[1,\"p\",[[0,[],0,\"There is widely cited opinion, that we should provide ESM package only on gist below.\"]]],[10,1],[1,\"p\",[[0,[],0,\"But it can lead to problems experienced by end users or other maintainers.\"]]],[10,2],[1,\"p\",[[0,[],0,\"Breaking compatibility is one of ways of introduction for change, but is painful and leads to errors like these:\"]]],[10,3],[10,4],[1,\"p\",[[0,[],0,\"Viewed\"],[0,[],0,\" 123k times\"]]],[10,5],[1,\"p\",[[0,[],0,\"Viewed 379k times\"]]],[1,\"p\",[[0,[],0,\"It is great that knowledge about ESM spreads in community thanks to these errors, but CommonJS is currently default standard for module inclusion in NodeJS world.\"]]],[10,6],[1,\"p\",[[0,[],0,\"I can't find official sources but using GPT-4 we can estimate that in april 2023:\"]]],[3,\"ol\",[[[0,[],0,\"ESM adoption reaches a substantial level, possibly around 30-40% of the npm packages.\"]],[[0,[],0,\"CommonJS continues to hold a significant share, perhaps around 60-70%, due to its historical prevalence and the presence of many legacy projects still using it.\"]],[[0,[],0,\"Dual packages might represent a slightly larger portion of the ecosystem, around 10-15%, as package authors aim to support both module systems during the transition period.\"]]]],[1,\"p\",[[0,[],0,\"So because we are in \\\"transition period\\\" I think it is better to take responsibility and provide dual version for existing packages.\"]]],[10,7],[1,\"p\",[[0,[],0,\"If you creating new package I think you can select \"],[0,[0],1,\"ESM\"],[0,[],0,\" and do not worry about \"],[0,[0],1,\"CommonJS\"],[0,[],0,\" but if your packages was published earlier, this tutorial is for you.\"]]],[1,\"h2\",[[0,[],0,\"Dual package hazard\"]]],[1,\"p\",[[0,[],0,\"Before we start you should be aware of existence of hazard for dual packages:\"]]],[10,8],[1,\"p\",[[0,[],0,\"Simplifying if user will write \"],[0,[0],1,\"const pkgInstance = require('pkg')\"],[0,[],0,\" and in other place \"],[0,[0],1,\"import pkgInstance from 'pkg'\"],[0,[],0,\" then two instances of package will be created. It can lead to hard to debug problems and undefined behaviors so there are two methods of minimize them.\"]]],[1,\"p\",[[0,[],0,\"I prepared diagram that help you do decide which approach best fit to you:\"]]],[10,9],[1,\"p\",[[0,[],0,\"If you need to create \"],[0,[0],1,\"ES wrapper\"],[0,[],0,\" then refer directly to docs. In further chapter I will assume that you have stateless package and will apply \"],[0,[0],1,\"Isolate state\"],[0,[],0,\" approach.\"]]],[1,\"h2\",[[0,[],0,\"Isolated state\"]]],[1,\"p\",[[0,[],0,\"There is great practical guide that showing problem similar to this one:\"]]],[10,10],[1,\"h3\",[[0,[],0,\"Creation of dual package\"]]],[1,\"p\",[[0,[],0,\"In this example we will write library that implement \"],[0,[0],1,\"sum\"],[0,[],0,\" function. Let's create project:\"]]],[10,11],[1,\"p\",[[0,[],0,\"in \"],[0,[0],1,\"src/index.ts\"],[0,[],0,\" file we defining function\"]]],[10,12],[1,\"p\",[[0,[],0,\"in \"],[0,[0],1,\"package.json\"],[0,[],0,\" we adding \"],[0,[0],1,\"script.build\"],[0,[],0,\" that will create both CJS and ESM\"]]],[10,13],[1,\"p\",[[0,[],0,\"because we will create two directories instead of single \"],[0,[0],1,\"dist\"],[0,[],0,\" we adding to \"],[0,[0],1,\"package.json\"]]],[10,14],[1,\"p\",[[0,[],0,\"Finally in \"],[0,[0],1,\"package.json\"],[0,[],0,\" we need to change \"],[0,[0],1,\"main\"]]],[10,15],[1,\"p\",[[0,[],0,\"Now after building\"]]],[10,16],[1,\"p\",[[0,[],0,\"we can test it in other project.\"]]],[1,\"h3\",[[0,[],0,\"Import/require on dual package\"]]],[1,\"p\",[[0,[],0,\"Create other project\"]]],[10,17],[1,\"p\",[[0,[],0,\"and add dependency with patch to our original project\"]]],[10,18],[1,\"p\",[[0,[],0,\"and here in \"],[0,[0],1,\"index.js\"],[0,[],0,\" we can write\"]]],[10,19],[1,\"p\",[[0,[],0,\"as well as\"]]],[10,20],[1,\"p\",[[0,[],0,\"both will work.\"]]],[1,\"h3\",[[0,[],0,\"Test for dual package in jest\"]]],[1,\"p\",[[0,[],0,\"Let's go back to our package and write tests.\"]]],[10,21],[1,\"p\",[[0,[],0,\"or if you do not able to remember all these commands you can use\"]]],[10,22],[1,\"p\",[[0,[],0,\"using this program \"],[0,[1],1,\"https://github.com/gustawdaniel/gpt-cli\"],[0,[],0,\". Lets create test\"]]],[10,23],[1,\"p\",[[0,[],0,\"with content\"]]],[10,24],[1,\"p\",[[0,[],0,\"and update \"],[0,[0],1,\"script\"],[0,[],0,\" in \"],[0,[0],1,\"package.json\"]]],[10,25],[1,\"p\",[[0,[],0,\"test works\"]]],[10,26],[1,\"p\",[[0,[],0,\"we can replace \"],[0,[0],1,\"ts-node\"],[0,[],0,\" by \"],[0,[0],1,\"esbuild-jest\"],[0,[],0,\" in \"],[0,[0],1,\"package.json\"],[0,[],0,\" and \"],[0,[0],1,\"preset: 'ts-jest',\"],[0,[],0,\" in \"],[0,[0],1,\"jest.config.js\"],[0,[],0,\" by \"]]],[10,27],[1,\"p\",[[0,[],0,\"to speedup tests 8 times\"]]],[10,28],[1,\"p\",[[0,[],0,\"and it also works.\"]]],[1,\"p\",[[0,[],0,\"Unfortunately tests breaks our build so we have two options. \"]]],[1,\"p\",[[0,[],0,\"First is slow, but seems to be stable. It is inclusion:\"]]],[10,29],[1,\"p\",[[0,[],0,\"to \"],[0,[0],1,\"tsconfig.json\"],[0,[],0,\". Second is two time faster and it is simple migration from \"],[0,[0],1,\"tsc\"],[0,[],0,\" to \"],[0,[0],1,\"esbuild\"],[0,[],0,\". You can replace old \"],[0,[0],1,\"build\"],[0,[],0,\" in \"],[0,[0],1,\"package.json\"],[0,[],0,\" by\"]]],[10,30],[1,\"h3\",[[0,[],0,\"Check autocompletion of types\"]]],[1,\"p\",[[0,[],0,\"Thanks to \"],[0,[0],1,\"\\\"types\\\": \\\"./src\\\",\"],[0,[],0,\" in \"],[0,[0],1,\"package.json\"],[0,[],0,\" it works. There is common practice to replace source by files that contains only types, because full sources are heavier. But i prefer this method because it is easier to debug. \"]]],[1,\"p\",[[0,[],0,\"To final package you need to append:\"]]],[10,31],[1,\"h3\",[[0,[],0,\"Building with swc\"]]],[1,\"p\",[[0,[],0,\"I was tried to replace \"],[0,[0],1,\"esbuild\"],[0,[],0,\" by \"],[0,[0],1,\"swc\"],[0,[],0,\" but it is not ready yet.\"]]],[1,\"h2\",[[0,[],0,\"Let's dive in problems\"]]],[1,\"p\",[[0,[],0,\"Let's assume now that we need to use package \"],[0,[0],1,\"humanize-string\"],[0,[],0,\". I selected this one because it is example of package which dropped \"],[0,[0],1,\"cjs\"],[0,[],0,\" causing problems. His version \"],[0,[0],1,\"2.1.0\"],[0,[],0,\" is \"],[0,[0],1,\"cjs\"],[0,[],0,\", but \"],[0,[0],1,\"3.0.0\"],[0,[],0,\" is pure \"],[0,[0],1,\"esm\"],[0,[],0,\". \"]]],[1,\"p\",[[0,[],0,\"If we will add this package in version \"],[0,[0],1,\"2.1.0\"],[0,[],0,\" to our project then \"],[0,[0],1,\"cjs\"],[0,[],0,\" can be builded properly but for \"],[0,[0],1,\"esm\"],[0,[],0,\" there is error:\"]]],[10,32],[1,\"p\",[[0,[],0,\"package \"],[0,[0],1,\"xregexp\"],[0,[],0,\" that is dependency of \"],[0,[0],1,\"decamelize\"],[0,[],0,\" had default export in version 4 so it was impossible to easy convert it to \"],[0,[0],1,\"esm\"]]],[10,33],[1,\"p\",[[0,[],0,\"we can read about this problem here:\"]]],[10,34],[1,\"p\",[[0,[],0,\"On the other hand when we will install \"],[0,[0],1,\"humanize-string\"],[0,[],0,\" in \"],[0,[0],1,\"3.0.0\"],[0,[],0,\" then building works but tests are broken:\"]]],[10,35],[1,\"p\",[[0,[],0,\"fortunately in this case i found solution overriding \"],[0,[0],1,\"decamelize\"],[0,[],0,\" version:\"]]],[10,36],[1,\"p\",[[0,[],0,\"because it dropping \"],[0,[0],1,\"xregexp\"],[0,[],0,\" dependency\"]]],[10,37],[1,\"p\",[[0,[],0,\"but if I would not find this option then I would probably move to pnpm for \"],[0,[0],1,\"pnpm patch\"],[0,[],0,\" or use npm \"],[0,[0],1,\"patch-package\"],[0,[],0,\". This scenario is typical if you trying to do something with \"],[0,[0],1,\"esm\"],[0,[],0,\".\"]]],[1,\"h2\",[[0,[],0,\"Future of JS Packages\"]]],[1,\"p\",[[0,[],0,\"Now we are in transition moment. It is quite clear that in future \"],[0,[0],1,\"cjs\"],[0,[],0,\" modules will be called \"],[0,[0],1,\"legacy\"],[0,[],0,\" and we will use rather \"],[0,[0],1,\"ESM\"],[0,[],0,\". I hope that by offering dual packages instead of ESM-only, users will spend less time dealing with errors. In the meantime, a new wave of developer tools like SWC, esbuild, Rome, and others will continue to improve ESM support. Eventually, we will be able to drop CommonJS support in the future when its impact on end-users becomes negligible.\"]]],[1,\"p\",[[0,[],0,\"Thanks for all Reddit users that helped me understand this topic in discussion:\"]]],[10,38],[1,\"p\",[]],[1,\"p\",[]],[1,\"p\",[]]],\"ghostVersion\":\"4.0\"}","html":"<p>I will start from sources and context, then show practical implementation.</p><h2 id=\"pure-esm-vs-dual-packages\">Pure ESM vs Dual Packages</h2><p>Modules in JavaScript has awesome history and knowledge of their evolution is important for understanding current state and forecasting future shape of JS ecosystem. </p><figure class=\"kg-card kg-bookmark-card\"><a class=\"kg-bookmark-container\" href=\"https://www.sitepoint.com/understanding-es6-modules-via-their-history/\"><div class=\"kg-bookmark-content\"><div class=\"kg-bookmark-title\">Understanding ES6 Modules via Their History — SitePoint</div><div class=\"kg-bookmark-description\">Elias Carlston looks at the history behind JavaScript ES6 modules and how that has influenced module design in its current state.</div><div class=\"kg-bookmark-metadata\"><img class=\"kg-bookmark-icon\" src=\"https://www.sitepoint.com/favicons/512x512.png\" alt=\"\"><span class=\"kg-bookmark-author\">SitePoint</span><span class=\"kg-bookmark-publisher\">Elias Carlston</span></div></div><div class=\"kg-bookmark-thumbnail\"><img src=\"https://uploads.sitepoint.com/wp-content/uploads/2016/07/14692419621467552652understanding-es6-modules-via-their-history08-AMD.jpg\" alt=\"\"></div></a></figure><p>There is widely cited opinion, that we should provide ESM package only on gist below.</p><figure class=\"kg-card kg-bookmark-card\"><a class=\"kg-bookmark-container\" href=\"https://gist.github.com/sindresorhus/a39789f98801d908bbc7ff3ecc99d99c\"><div class=\"kg-bookmark-content\"><div class=\"kg-bookmark-title\">Pure ESM package</div><div class=\"kg-bookmark-description\">Pure ESM package. GitHub Gist: instantly share code, notes, and snippets.</div><div class=\"kg-bookmark-metadata\"><img class=\"kg-bookmark-icon\" src=\"https://gist.github.com/fluidicon.png\" alt=\"\"><span class=\"kg-bookmark-author\">Gist</span><span class=\"kg-bookmark-publisher\">262588213843476</span></div></div><div class=\"kg-bookmark-thumbnail\"><img src=\"https://github.githubassets.com/images/modules/gists/gist-og-image.png\" alt=\"\"></div></a></figure><p>But it can lead to problems experienced by end users or other maintainers.</p><figure class=\"kg-card kg-bookmark-card\"><a class=\"kg-bookmark-container\" href=\"https://formidable.com/blog/2022/victory-esm/\"><div class=\"kg-bookmark-content\"><div class=\"kg-bookmark-title\">The awkward valley to ESM: Node.js, Victory, and D3</div><div class=\"kg-bookmark-description\">We continue our examination of the shift to ESM on Node.js and broader ramifications for the ecosystem. In this post, we look at the challenges and lessons in handling ESM-only dependencies in our Victory charting library.</div><div class=\"kg-bookmark-metadata\"><img class=\"kg-bookmark-icon\" src=\"https://formidable.com/favicon/apple-touch-icon.png?v&#x3D;eE54G4onR8\" alt=\"\"><span class=\"kg-bookmark-author\">Formidable - The Digital Product Experts. We build the modern web.</span><span class=\"kg-bookmark-publisher\">Formidable</span></div></div><div class=\"kg-bookmark-thumbnail\"><img src=\"https://res.cloudinary.com/formidablelabs/image/upload/f_auto,q_auto/v1675121564/dotcom/uploads-victory-esm-fig-01-awkward-valley\" alt=\"\"></div></a></figure><p>Breaking compatibility is one of ways of introduction for change, but is painful and leads to errors like these:</p><pre><code>Error: require() of ES modules is not supported when importing</code></pre><figure class=\"kg-card kg-bookmark-card\"><a class=\"kg-bookmark-container\" href=\"https://stackoverflow.com/questions/69041454/error-require-of-es-modules-is-not-supported-when-importing-node-fetch\"><div class=\"kg-bookmark-content\"><div class=\"kg-bookmark-title\">Error: require() of ES modules is not supported when importing node-fetch</div><div class=\"kg-bookmark-description\">I’m creating a program to analyze security camera streams and got stuck on the very first line. At the moment my .js file has nothing but the import of node-fetch and it gives me an error message.…</div><div class=\"kg-bookmark-metadata\"><img class=\"kg-bookmark-icon\" src=\"https://cdn.sstatic.net/Sites/stackoverflow/Img/apple-touch-icon.png?v&#x3D;c78bd457575a\" alt=\"\"><span class=\"kg-bookmark-author\">Stack Overflow</span><span class=\"kg-bookmark-publisher\">Roope Kuisma</span></div></div><div class=\"kg-bookmark-thumbnail\"><img src=\"https://cdn.sstatic.net/Sites/stackoverflow/Img/apple-touch-icon@2.png?v&#x3D;73d79a89bded\" alt=\"\"></div></a></figure><p>Viewed 123k times</p><figure class=\"kg-card kg-bookmark-card\"><a class=\"kg-bookmark-container\" href=\"https://stackoverflow.com/questions/69081410/error-err-require-esm-require-of-es-module-not-supported\"><div class=\"kg-bookmark-content\"><div class=\"kg-bookmark-title\">Error [ERR_REQUIRE_ESM]: require() of ES Module not supported</div><div class=\"kg-bookmark-description\">I’m trying to make a Discord bot that just says if someone is online on the game.However I keep getting this message: [ERR_REQUIRE_ESM]: require() of ES Module from not supported. Instead change…</div><div class=\"kg-bookmark-metadata\"><img class=\"kg-bookmark-icon\" src=\"https://cdn.sstatic.net/Sites/stackoverflow/Img/apple-touch-icon.png?v&#x3D;c78bd457575a\" alt=\"\"><span class=\"kg-bookmark-author\">Stack Overflow</span><span class=\"kg-bookmark-publisher\">N-Man</span></div></div><div class=\"kg-bookmark-thumbnail\"><img src=\"https://cdn.sstatic.net/Sites/stackoverflow/Img/apple-touch-icon@2.png?v&#x3D;73d79a89bded\" alt=\"\"></div></a></figure><p>Viewed 379k times</p><p>It is great that knowledge about ESM spreads in community thanks to these errors, but CommonJS is currently default standard for module inclusion in NodeJS world.</p><figure class=\"kg-card kg-bookmark-card\"><a class=\"kg-bookmark-container\" href=\"https://www.knowledgehut.com/blog/web-development/commonjs-vs-es-modules\"><div class=\"kg-bookmark-content\"><div class=\"kg-bookmark-title\">CommonJS vs ES Modules in Node.js - A Detailed Comparison</div><div class=\"kg-bookmark-description\">A module system allows you to split up your code into parts or include code written by other developers. Check CommonJS vs ES modules comparision when using them in Node.js apps.</div><div class=\"kg-bookmark-metadata\"><img class=\"kg-bookmark-icon\" src=\"https://www.knowledgehut.com/next_favicons/favicon-180.png\" alt=\"\"><span class=\"kg-bookmark-author\">A Detailed Comparison</span><span class=\"kg-bookmark-publisher\">Gaurav Roy</span></div></div><div class=\"kg-bookmark-thumbnail\"><img src=\"https://d2o2utebsixu4k.cloudfront.net/media/images/blogs/share_image/2365adef-48f7-4e81-b402-ed6d02c92ad6.png\" alt=\"\"></div></a></figure><p>I can't find official sources but using GPT-4 we can estimate that in april 2023:</p><ol><li>ESM adoption reaches a substantial level, possibly around 30-40% of the npm packages.</li><li>CommonJS continues to hold a significant share, perhaps around 60-70%, due to its historical prevalence and the presence of many legacy projects still using it.</li><li>Dual packages might represent a slightly larger portion of the ecosystem, around 10-15%, as package authors aim to support both module systems during the transition period.</li></ol><p>So because we are in \"transition period\" I think it is better to take responsibility and provide dual version for existing packages.</p><figure class=\"kg-card kg-image-card\"><img src=\"__GHOST_URL__/content/images/2023/03/7fv8ft.jpg\" class=\"kg-image\" alt loading=\"lazy\" width=\"700\" height=\"449\" srcset=\"__GHOST_URL__/content/images/size/w600/2023/03/7fv8ft.jpg 600w, __GHOST_URL__/content/images/2023/03/7fv8ft.jpg 700w\"></figure><p>If you creating new package I think you can select <code>ESM</code> and do not worry about <code>CommonJS</code> but if your packages was published earlier, this tutorial is for you.</p><h2 id=\"dual-package-hazard\">Dual package hazard</h2><p>Before we start you should be aware of existence of hazard for dual packages:</p><figure class=\"kg-card kg-bookmark-card\"><a class=\"kg-bookmark-container\" href=\"https://nodejs.org/api/packages.html#dual-package-hazard\"><div class=\"kg-bookmark-content\"><div class=\"kg-bookmark-title\">Modules: Packages | Node.js v19.8.1 Documentation</div><div class=\"kg-bookmark-description\"></div><div class=\"kg-bookmark-metadata\"><img class=\"kg-bookmark-icon\" src=\"https://nodejs.org/favicon.ico\" alt=\"\"><span class=\"kg-bookmark-author\">Node.js v19.8.1 Documentation</span></div></div></a></figure><p>Simplifying if user will write <code>const pkgInstance = require('pkg')</code> and in other place <code>import pkgInstance from 'pkg'</code> then two instances of package will be created. It can lead to hard to debug problems and undefined behaviors so there are two methods of minimize them.</p><p>I prepared diagram that help you do decide which approach best fit to you:</p><figure class=\"kg-card kg-image-card\"><img src=\"__GHOST_URL__/content/images/2023/03/Zrzut-ekranu-z-2023-03-25-16-35-02.png\" class=\"kg-image\" alt loading=\"lazy\" width=\"887\" height=\"746\" srcset=\"__GHOST_URL__/content/images/size/w600/2023/03/Zrzut-ekranu-z-2023-03-25-16-35-02.png 600w, __GHOST_URL__/content/images/2023/03/Zrzut-ekranu-z-2023-03-25-16-35-02.png 887w\" sizes=\"(min-width: 720px) 720px\"></figure><p>If you need to create <code>ES wrapper</code> then refer directly to docs. In further chapter I will assume that you have stateless package and will apply <code>Isolate state</code> approach.</p><h2 id=\"isolated-state\">Isolated state</h2><p>There is great practical guide that showing problem similar to this one:</p><figure class=\"kg-card kg-bookmark-card\"><a class=\"kg-bookmark-container\" href=\"https://evertpot.com/universal-commonjs-esm-typescript-packages/\"><div class=\"kg-bookmark-content\"><div class=\"kg-bookmark-title\">Supporting CommonJS and ESM with Typescript and Node</div><div class=\"kg-bookmark-description\"></div><div class=\"kg-bookmark-metadata\"><img class=\"kg-bookmark-icon\" src=\"https://evertpot.com/assets/img/flower-icon.png\" alt=\"\"></div></div><div class=\"kg-bookmark-thumbnail\"><img src=\"https://evertpot.com/assets/cover/flower.png\" alt=\"\"></div></a></figure><h3 id=\"creation-of-dual-package\">Creation of dual package</h3><p>In this example we will write library that implement <code>sum</code> function. Let's create project:</p><pre><code>npm init -y &amp;&amp; tsc --init &amp;&amp; mkdir -p src &amp;&amp; touch src/index.ts</code></pre><p>in <code>src/index.ts</code> file we defining function</p><pre><code>export function sum(a: number, b: number): number {\n    return a+b;\n}\n</code></pre><p>in <code>package.json</code> we adding <code>script.build</code> that will create both CJS and ESM</p><pre><code>\"build\": \"npx tsc --module commonjs --outDir cjs/ &amp;&amp; echo '{\\\"type\\\": \\\"commonjs\\\"}' &gt; cjs/package.json &amp;&amp; npx tsc --module es2022 --outDir esm/ &amp;&amp; echo '{\\\"type\\\": \\\"module\\\"}' &gt; esm/package.json\"\n</code></pre><p>because we will create two directories instead of single <code>dist</code> we adding to <code>package.json</code></p><pre><code>  \"exports\": {\n    \"require\": \"./cjs/index.js\",\n    \"import\": \"./esm/index.js\"\n  },\n  \"types\": \"./src\",</code></pre><p>Finally in <code>package.json</code> we need to change <code>main</code></p><pre><code>  \"main\": \"cjs/index.js\"</code></pre><p>Now after building</p><pre><code>npm run build</code></pre><p>we can test it in other project.</p><h3 id=\"importrequire-on-dual-package\">Import/require on dual package</h3><p>Create other project</p><pre><code>npm init -y</code></pre><p>and add dependency with patch to our original project</p><pre><code>    \"sumesm\": \"file:./../dual\"\n</code></pre><p>and here in <code>index.js</code> we can write</p><pre><code>const s = require('sumesm');\n\nconsole.log(s.sum(1, 2));</code></pre><p>as well as</p><pre><code>(async () =&gt; {\n    const s = await import('sumesm');\n    console.log(s.sum(1, 2));\n})()\n\n</code></pre><p>both will work.</p><h3 id=\"test-for-dual-package-in-jest\">Test for dual package in jest</h3><p>Let's go back to our package and write tests.</p><pre><code>npm install --save-dev jest @types/jest ts-jest\nnpx ts-jest config:init\n</code></pre><p>or if you do not able to remember all these commands you can use</p><pre><code>gpt-cli add and config jest for typescript to node project</code></pre><p>using this program <a href=\"https://github.com/gustawdaniel/gpt-cli\">https://github.com/gustawdaniel/gpt-cli</a>. Lets create test</p><pre><code>mkdir -p test &amp;&amp; touch test/sum.test.ts</code></pre><p>with content</p><pre><code>import {sum} from \"../src\";\n\nit('sum', () =&gt; {\n    expect(sum(1, 2)).toEqual(3)\n})</code></pre><p>and update <code>script</code> in <code>package.json</code></p><pre><code>    \"test\": \"jest\",</code></pre><p>test works</p><pre><code>Tests:       1 passed, 1 total\nTime:        1.185 s\n</code></pre><p>we can replace <code>ts-node</code> by <code>esbuild-jest</code> in <code>package.json</code> and <code>preset: 'ts-jest',</code> in <code>jest.config.js</code> by </p><pre><code>\"transform\": {\n    \"^.+\\\\.tsx?$\": \"esbuild-jest\"\n  },</code></pre><p>to speedup tests 8 times</p><pre><code>Tests:       1 passed, 1 total\nTime:        0.152 s, estimated 2 s\n</code></pre><p>and it also works.</p><p>Unfortunately tests breaks our build so we have two options. </p><p>First is slow, but seems to be stable. It is inclusion:</p><pre><code> \"include\": [\n    \"src/**/*\"\n  ]</code></pre><p>to <code>tsconfig.json</code>. Second is two time faster and it is simple migration from <code>tsc</code> to <code>esbuild</code>. You can replace old <code>build</code> in <code>package.json</code> by</p><pre><code>    \"build\": \"npx esbuild --bundle src/index.ts --outdir=cjs --platform=node --format=cjs &amp;&amp; echo '{\\\"type\\\": \\\"commonjs\\\"}' &gt; cjs/package.json &amp;&amp; npx esbuild --bundle src/index.ts --outdir=esm --platform=neutral --format=esm &amp;&amp; echo '{\\\"type\\\": \\\"module\\\"}' &gt; esm/package.json\"\n</code></pre><h3 id=\"check-autocompletion-of-types\">Check autocompletion of types</h3><p>Thanks to <code>\"types\": \"./src\",</code> in <code>package.json</code> it works. There is common practice to replace source by files that contains only types, because full sources are heavier. But i prefer this method because it is easier to debug. </p><p>To final package you need to append:</p><pre><code>package.json\nesm\ncjs\nsrc</code></pre><h3 id=\"building-with-swc\">Building with swc</h3><p>I was tried to replace <code>esbuild</code> by <code>swc</code> but it is not ready yet.</p><h2 id=\"lets-dive-in-problems\">Let's dive in problems</h2><p>Let's assume now that we need to use package <code>humanize-string</code>. I selected this one because it is example of package which dropped <code>cjs</code> causing problems. His version <code>2.1.0</code> is <code>cjs</code>, but <code>3.0.0</code> is pure <code>esm</code>. </p><p>If we will add this package in version <code>2.1.0</code> to our project then <code>cjs</code> can be builded properly but for <code>esm</code> there is error:</p><figure class=\"kg-card kg-image-card\"><img src=\"__GHOST_URL__/content/images/2023/03/Zrzut-ekranu-z-2023-03-26-23-42-28.png\" class=\"kg-image\" alt loading=\"lazy\" width=\"524\" height=\"103\"></figure><p>package <code>xregexp</code> that is dependency of <code>decamelize</code> had default export in version 4 so it was impossible to easy convert it to <code>esm</code></p><figure class=\"kg-card kg-image-card\"><img src=\"__GHOST_URL__/content/images/2023/03/Zrzut-ekranu-z-2023-03-26-23-43-32.png\" class=\"kg-image\" alt loading=\"lazy\" width=\"432\" height=\"113\"></figure><p>we can read about this problem here:</p><figure class=\"kg-card kg-bookmark-card\"><a class=\"kg-bookmark-container\" href=\"https://github.com/slevithan/xregexp/issues/305\"><div class=\"kg-bookmark-content\"><div class=\"kg-bookmark-title\">Import does not work anymore since version 4.4.0 · Issue #305 · slevithan/xregexp</div><div class=\"kg-bookmark-description\">We use xregexp in a shared library that is used in our client (Angular 10) as well as on our server (NodeJS / Webpack 5). Until version 4.3.0 we were able to import xregexp like this and everything…</div><div class=\"kg-bookmark-metadata\"><img class=\"kg-bookmark-icon\" src=\"https://github.com/fluidicon.png\" alt=\"\"><span class=\"kg-bookmark-author\">GitHub</span><span class=\"kg-bookmark-publisher\">slevithan</span></div></div><div class=\"kg-bookmark-thumbnail\"><img src=\"https://opengraph.githubassets.com/e98ebcf8cadcd1e7edfd7f574b066be722ebb5d72b159263b31e7e48cf8648d7/slevithan/xregexp/issues/305\" alt=\"\"></div></a></figure><p>On the other hand when we will install <code>humanize-string</code> in <code>3.0.0</code> then building works but tests are broken:</p><figure class=\"kg-card kg-image-card\"><img src=\"__GHOST_URL__/content/images/2023/03/Zrzut-ekranu-z-2023-03-26-23-47-45.png\" class=\"kg-image\" alt loading=\"lazy\" width=\"1244\" height=\"836\" srcset=\"__GHOST_URL__/content/images/size/w600/2023/03/Zrzut-ekranu-z-2023-03-26-23-47-45.png 600w, __GHOST_URL__/content/images/size/w1000/2023/03/Zrzut-ekranu-z-2023-03-26-23-47-45.png 1000w, __GHOST_URL__/content/images/2023/03/Zrzut-ekranu-z-2023-03-26-23-47-45.png 1244w\" sizes=\"(min-width: 720px) 720px\"></figure><p>fortunately in this case i found solution overriding <code>decamelize</code> version:</p><pre><code>  \"dependencies\": {\n    \"humanize-string\": \"^2.1.0\"\n  },\n  \"overrides\": {\n    \"decamelize\": \"4.0.0\"\n  }</code></pre><p>because it dropping <code>xregexp</code> dependency</p><figure class=\"kg-card kg-bookmark-card\"><a class=\"kg-bookmark-container\" href=\"https://github.com/sindresorhus/decamelize/releases/tag/v4.0.0\"><div class=\"kg-bookmark-content\"><div class=\"kg-bookmark-title\">Release v4.0.0 · sindresorhus/decamelize</div><div class=\"kg-bookmark-description\">If you need Firefox support, stay on version 3.Breaking Require Node.js 10 and drop xregexp dependency (#22) 7ac6111 Fixes Fix handling of capitalized word which ends with a number (#23) 26c7…</div><div class=\"kg-bookmark-metadata\"><img class=\"kg-bookmark-icon\" src=\"https://github.com/fluidicon.png\" alt=\"\"><span class=\"kg-bookmark-author\">GitHub</span><span class=\"kg-bookmark-publisher\">sindresorhus</span></div></div><div class=\"kg-bookmark-thumbnail\"><img src=\"https://opengraph.githubassets.com/787a6b61929b7c93350b92eae838561ed672af2159fbae31dcc1e6580c768f56/sindresorhus/decamelize/releases/tag/v4.0.0\" alt=\"\"></div></a></figure><p>but if I would not find this option then I would probably move to pnpm for <code>pnpm patch</code> or use npm <code>patch-package</code>. This scenario is typical if you trying to do something with <code>esm</code>.</p><h2 id=\"future-of-js-packages\">Future of JS Packages</h2><p>Now we are in transition moment. It is quite clear that in future <code>cjs</code> modules will be called <code>legacy</code> and we will use rather <code>ESM</code>. I hope that by offering dual packages instead of ESM-only, users will spend less time dealing with errors. In the meantime, a new wave of developer tools like SWC, esbuild, Rome, and others will continue to improve ESM support. Eventually, we will be able to drop CommonJS support in the future when its impact on end-users becomes negligible.</p><p>Thanks for all Reddit users that helped me understand this topic in discussion:</p><figure class=\"kg-card kg-embed-card\">\n    <blockquote class=\"reddit-embed-bq\" >\n      <a href=\"https://www.reddit.com/r/node/comments/121a1wa/esm_vs_dual_package/\">ESM vs Dual Package?</a><br> by\n      <a href=\"https://www.reddit.com/user/gustaw_daniel\">u/gustaw_daniel</a> in\n      <a href=\"https://www.reddit.com/r/node/\">node</a>\n    </blockquote>\n    <script async src=\"https://embed.reddit.com/widgets.js\" charset=\"UTF-8\"></script>\n</figure><p></p><p></p>","comment_id":"641e5d1b4e210aabcb6e1625","plaintext":"I will start from sources and context, then show practical implementation.\n\n\nPure ESM vs Dual Packages\n\nModules in JavaScript has awesome history and knowledge of their evolution is important for understanding current state and forecasting future shape of JS ecosystem.\n\nUnderstanding ES6 Modules via Their History — SitePointElias Carlston looks at the history behind JavaScript ES6 modules and how that has influenced module design in its current state.SitePointElias Carlston\n\nThere is widely cited opinion, that we should provide ESM package only on gist below.\n\nPure ESM packagePure ESM package. GitHub Gist: instantly share code, notes, and snippets.Gist262588213843476\n\nBut it can lead to problems experienced by end users or other maintainers.\n\nThe awkward valley to ESM: Node.js, Victory, and D3We continue our examination of the shift to ESM on Node.js and broader ramifications for the ecosystem. In this post, we look at the challenges and lessons in handling ESM-only dependencies in our Victory charting library.Formidable - The Digital Product Experts. We build the modern web.Formidable\n\nBreaking compatibility is one of ways of introduction for change, but is painful and leads to errors like these:\n\nError: require() of ES modules is not supported when importing\n\nError: require() of ES modules is not supported when importing node-fetchI’m creating a program to analyze security camera streams and got stuck on the very first line. At the moment my .js file has nothing but the import of node-fetch and it gives me an error message.…Stack OverflowRoope Kuisma\n\nViewed 123k times\n\nError [ERR_REQUIRE_ESM]: require() of ES Module not supportedI’m trying to make a Discord bot that just says if someone is online on the game.However I keep getting this message: [ERR_REQUIRE_ESM]: require() of ES Module from not supported. Instead change…Stack OverflowN-Man\n\nViewed 379k times\n\nIt is great that knowledge about ESM spreads in community thanks to these errors, but CommonJS is currently default standard for module inclusion in NodeJS world.\n\nCommonJS vs ES Modules in Node.js - A Detailed ComparisonA module system allows you to split up your code into parts or include code written by other developers. Check CommonJS vs ES modules comparision when using them in Node.js apps.A Detailed ComparisonGaurav Roy\n\nI can't find official sources but using GPT-4 we can estimate that in april 2023:\n\n 1. ESM adoption reaches a substantial level, possibly around 30-40% of the npm packages.\n 2. CommonJS continues to hold a significant share, perhaps around 60-70%, due to its historical prevalence and the presence of many legacy projects still using it.\n 3. Dual packages might represent a slightly larger portion of the ecosystem, around 10-15%, as package authors aim to support both module systems during the transition period.\n\nSo because we are in \"transition period\" I think it is better to take responsibility and provide dual version for existing packages.\n\nIf you creating new package I think you can select ESM and do not worry about CommonJS but if your packages was published earlier, this tutorial is for you.\n\n\nDual package hazard\n\nBefore we start you should be aware of existence of hazard for dual packages:\n\nModules: Packages | Node.js v19.8.1 DocumentationNode.js v19.8.1 Documentation\n\nSimplifying if user will write const pkgInstance = require('pkg') and in other place import pkgInstance from 'pkg' then two instances of package will be created. It can lead to hard to debug problems and undefined behaviors so there are two methods of minimize them.\n\nI prepared diagram that help you do decide which approach best fit to you:\n\nIf you need to create ES wrapper then refer directly to docs. In further chapter I will assume that you have stateless package and will apply Isolate state approach.\n\n\nIsolated state\n\nThere is great practical guide that showing problem similar to this one:\n\nSupporting CommonJS and ESM with Typescript and Node\n\n\nCreation of dual package\n\nIn this example we will write library that implement sum function. Let's create project:\n\nnpm init -y && tsc --init && mkdir -p src && touch src/index.ts\n\nin src/index.ts file we defining function\n\nexport function sum(a: number, b: number): number {\n    return a+b;\n}\n\n\nin package.json we adding script.build that will create both CJS and ESM\n\n\"build\": \"npx tsc --module commonjs --outDir cjs/ && echo '{\\\"type\\\": \\\"commonjs\\\"}' > cjs/package.json && npx tsc --module es2022 --outDir esm/ && echo '{\\\"type\\\": \\\"module\\\"}' > esm/package.json\"\n\n\nbecause we will create two directories instead of single dist we adding to package.json\n\n  \"exports\": {\n    \"require\": \"./cjs/index.js\",\n    \"import\": \"./esm/index.js\"\n  },\n  \"types\": \"./src\",\n\nFinally in package.json we need to change main\n\n  \"main\": \"cjs/index.js\"\n\nNow after building\n\nnpm run build\n\nwe can test it in other project.\n\n\nImport/require on dual package\n\nCreate other project\n\nnpm init -y\n\nand add dependency with patch to our original project\n\n    \"sumesm\": \"file:./../dual\"\n\n\nand here in index.js we can write\n\nconst s = require('sumesm');\n\nconsole.log(s.sum(1, 2));\n\nas well as\n\n(async () => {\n    const s = await import('sumesm');\n    console.log(s.sum(1, 2));\n})()\n\n\n\nboth will work.\n\n\nTest for dual package in jest\n\nLet's go back to our package and write tests.\n\nnpm install --save-dev jest @types/jest ts-jest\nnpx ts-jest config:init\n\n\nor if you do not able to remember all these commands you can use\n\ngpt-cli add and config jest for typescript to node project\n\nusing this program https://github.com/gustawdaniel/gpt-cli. Lets create test\n\nmkdir -p test && touch test/sum.test.ts\n\nwith content\n\nimport {sum} from \"../src\";\n\nit('sum', () => {\n    expect(sum(1, 2)).toEqual(3)\n})\n\nand update script in package.json\n\n    \"test\": \"jest\",\n\ntest works\n\nTests:       1 passed, 1 total\nTime:        1.185 s\n\n\nwe can replace ts-node by esbuild-jest in package.json and preset: 'ts-jest', in jest.config.js by\n\n\"transform\": {\n    \"^.+\\\\.tsx?$\": \"esbuild-jest\"\n  },\n\nto speedup tests 8 times\n\nTests:       1 passed, 1 total\nTime:        0.152 s, estimated 2 s\n\n\nand it also works.\n\nUnfortunately tests breaks our build so we have two options.\n\nFirst is slow, but seems to be stable. It is inclusion:\n\n \"include\": [\n    \"src/**/*\"\n  ]\n\nto tsconfig.json. Second is two time faster and it is simple migration from tsc to esbuild. You can replace old build in package.json by\n\n    \"build\": \"npx esbuild --bundle src/index.ts --outdir=cjs --platform=node --format=cjs && echo '{\\\"type\\\": \\\"commonjs\\\"}' > cjs/package.json && npx esbuild --bundle src/index.ts --outdir=esm --platform=neutral --format=esm && echo '{\\\"type\\\": \\\"module\\\"}' > esm/package.json\"\n\n\n\nCheck autocompletion of types\n\nThanks to \"types\": \"./src\", in package.json it works. There is common practice to replace source by files that contains only types, because full sources are heavier. But i prefer this method because it is easier to debug.\n\nTo final package you need to append:\n\npackage.json\nesm\ncjs\nsrc\n\n\nBuilding with swc\n\nI was tried to replace esbuild by swc but it is not ready yet.\n\n\nLet's dive in problems\n\nLet's assume now that we need to use package humanize-string. I selected this one because it is example of package which dropped cjs causing problems. His version 2.1.0 is cjs, but 3.0.0 is pure esm.\n\nIf we will add this package in version 2.1.0 to our project then cjs can be builded properly but for esm there is error:\n\npackage xregexp that is dependency of decamelize had default export in version 4 so it was impossible to easy convert it to esm\n\nwe can read about this problem here:\n\nImport does not work anymore since version 4.4.0 · Issue #305 · slevithan/xregexpWe use xregexp in a shared library that is used in our client (Angular 10) as well as on our server (NodeJS / Webpack 5). Until version 4.3.0 we were able to import xregexp like this and everything…GitHubslevithan\n\nOn the other hand when we will install humanize-string in 3.0.0 then building works but tests are broken:\n\nfortunately in this case i found solution overriding decamelize version:\n\n  \"dependencies\": {\n    \"humanize-string\": \"^2.1.0\"\n  },\n  \"overrides\": {\n    \"decamelize\": \"4.0.0\"\n  }\n\nbecause it dropping xregexp dependency\n\nRelease v4.0.0 · sindresorhus/decamelizeIf you need Firefox support, stay on version 3.Breaking Require Node.js 10 and drop xregexp dependency (#22) 7ac6111 Fixes Fix handling of capitalized word which ends with a number (#23) 26c7…GitHubsindresorhus\n\nbut if I would not find this option then I would probably move to pnpm for pnpm patch or use npm patch-package. This scenario is typical if you trying to do something with esm.\n\n\nFuture of JS Packages\n\nNow we are in transition moment. It is quite clear that in future cjs modules will be called legacy and we will use rather ESM. I hope that by offering dual packages instead of ESM-only, users will spend less time dealing with errors. In the meantime, a new wave of developer tools like SWC, esbuild, Rome, and others will continue to improve ESM support. Eventually, we will be able to drop CommonJS support in the future when its impact on end-users becomes negligible.\n\nThanks for all Reddit users that helped me understand this topic in discussion:\n\n\n\nESM vs Dual Package?\nby\nu/gustaw_daniel in\nnode\n\n\n\n\n\n\n","feature_image":"__GHOST_URL__/content/images/2023/03/bg.jpg","featured":0,"type":"post","status":"published","locale":null,"visibility":"public","email_recipient_filter":"all","created_at":"2023-03-25T02:31:55.000Z","updated_at":"2023-03-26T15:10:40.000Z","published_at":"2023-03-26T01:12:20.000Z","custom_excerpt":"There is hot discussion about dropping CommonJS or building dual packages in JS world. I selected most valuable links that you should read to understand why it is problem and wrote tutorial that help to publish dual package.","codeinjection_head":null,"codeinjection_foot":null,"custom_template":null,"canonical_url":null,"newsletter_id":null,"lexical":null},{"id":"6422832d99d7a498d8917d2e","uuid":"8842fb15-40b0-474d-bd81-8b8f5da286f9","title":"Rust implementation of RFC 7396 - JSON Merge Patch","slug":"json-merge-patch","mobiledoc":"{\"version\":\"0.3.1\",\"atoms\":[],\"cards\":[[\"code\",{\"code\":\"[dependencies]\\nserde_json = \\\"1.0\\\"\\n\",\"language\":\"toml\"}],[\"code\",{\"code\":\"use serde_json::Value;\\n\\npub fn json_merge_patch(target: &mut Value, patch: &Value) {\\n    match patch {\\n        Value::Object(patch_obj) => {\\n            if !(target.is_object()\\n                || target.is_array() && patch_obj.keys().all(|key| key.parse::<usize>().is_ok()))\\n            {\\n                *target = Value::Object(serde_json::Map::new());\\n            }\\n\\n            if let Value::Object(target_obj) = target {\\n                for (key, value) in patch_obj {\\n                    if value.is_null() {\\n                        target_obj.remove(key);\\n                    } else {\\n                        let target_value =\\n                            target_obj.entry(key.clone()).or_insert_with(|| Value::Null);\\n                        json_merge_patch(target_value, value);\\n                    }\\n                }\\n            } else if let Value::Array(target_arr) = target {\\n                for (key, value) in patch_obj {\\n                    if let Ok(index) = key.parse::<usize>() {\\n                        if value.is_null() && index < target_arr.len() {\\n                            target_arr.remove(index);\\n                        } else if index < target_arr.len() {\\n                            json_merge_patch(&mut target_arr[index], value);\\n                        } else {\\n                            // Handling the case where the index is greater than the current length of the target array\\n                            while target_arr.len() < index {\\n                                target_arr.push(Value::Null);\\n                            }\\n                            target_arr.push(value.clone());\\n                        }\\n                    }\\n                }\\n            }\\n        }\\n        Value::Array(patch_arr) => {\\n            *target = serde_json::Value::Array(\\n                patch_arr\\n                    .clone()\\n                    .into_iter()\\n                    .filter(|value| !value.is_null())\\n                    .collect(),\\n            );\\n        }\\n        _ => *target = patch.clone(),\\n    }\\n}\",\"language\":\"rust\"}],[\"code\",{\"code\":\"\\n#[cfg(test)]\\nmod tests {\\n    use super::*;\\n\\n    #[test]\\n    fn test_json_merge_patch_should_merge_objects_and_override_field() {\\n        let mut target = serde_json::from_str(r#\\\"{\\\"a\\\": \\\"b\\\", \\\"c\\\": {\\\"d\\\": \\\"e\\\", \\\"f\\\": \\\"g\\\"}}\\\"#).unwrap();\\n        let patch = serde_json::from_str(r#\\\"{\\\"a\\\": \\\"z\\\", \\\"c\\\": {\\\"f\\\": null}}\\\"#).unwrap();\\n\\n        json_merge_patch(&mut target, &patch);\\n\\n        let expected: serde_json::Value =\\n            serde_json::from_str(r#\\\"{\\\"a\\\": \\\"z\\\", \\\"c\\\": {\\\"d\\\": \\\"e\\\"}}\\\"#).unwrap();\\n        assert_eq!(target, expected);\\n    }\\n\\n    #[test]\\n    fn test_json_merge_patch_should_override_field_in_object() {\\n        let mut target = serde_json::from_str(r#\\\"{\\\"a\\\": \\\"b\\\"}\\\"#).unwrap();\\n        let patch = serde_json::from_str(r#\\\"{\\\"a\\\": \\\"c\\\"}\\\"#).unwrap();\\n        let expected: serde_json::Value = serde_json::from_str(r#\\\"{\\\"a\\\": \\\"c\\\"}\\\"#).unwrap();\\n\\n        json_merge_patch(&mut target, &patch);\\n\\n        assert_eq!(target, expected);\\n    }\\n\\n    #[test]\\n    fn test_json_merge_patch_should_add_field_to_object() {\\n        let mut target = serde_json::from_str(r#\\\"{\\\"a\\\": \\\"b\\\"}\\\"#).unwrap();\\n        let patch = serde_json::from_str(r#\\\"{\\\"b\\\": \\\"c\\\"}\\\"#).unwrap();\\n        let expected: serde_json::Value = serde_json::from_str(r#\\\"{\\\"a\\\": \\\"b\\\", \\\"b\\\": \\\"c\\\"}\\\"#).unwrap();\\n\\n        json_merge_patch(&mut target, &patch);\\n\\n        assert_eq!(target, expected);\\n    }\\n\\n    #[test]\\n    fn test_json_merge_patch_should_remove_field_from_object() {\\n        let mut target = serde_json::from_str(r#\\\"{\\\"a\\\": \\\"b\\\", \\\"b\\\": \\\"c\\\"}\\\"#).unwrap();\\n        let patch = serde_json::from_str(r#\\\"{\\\"a\\\": null}\\\"#).unwrap();\\n        let expected: serde_json::Value = serde_json::from_str(r#\\\"{\\\"b\\\": \\\"c\\\"}\\\"#).unwrap();\\n\\n        json_merge_patch(&mut target, &patch);\\n\\n        assert_eq!(target, expected);\\n    }\\n\\n    #[test]\\n    fn test_json_merge_patch_should_override_field_in_array() {\\n        let mut target = serde_json::from_str(r#\\\"{\\\"a\\\": [\\\"b\\\"]}\\\"#).unwrap();\\n        let patch = serde_json::from_str(r#\\\"{\\\"a\\\": \\\"c\\\"}\\\"#).unwrap();\\n        let expected: serde_json::Value = serde_json::from_str(r#\\\"{\\\"a\\\": \\\"c\\\"}\\\"#).unwrap();\\n\\n        json_merge_patch(&mut target, &patch);\\n\\n        assert_eq!(target, expected);\\n    }\\n\\n    #[test]\\n    fn test_json_merge_patch_should_replace_array_with_scalar() {\\n        let mut target = serde_json::from_str(r#\\\"{\\\"a\\\": \\\"c\\\"}\\\"#).unwrap();\\n        let patch = serde_json::from_str(r#\\\"{\\\"a\\\": [\\\"b\\\"]}\\\"#).unwrap();\\n        let expected: serde_json::Value = serde_json::from_str(r#\\\"{\\\"a\\\": [\\\"b\\\"]}\\\"#).unwrap();\\n\\n        json_merge_patch(&mut target, &patch);\\n\\n        assert_eq!(target, expected);\\n    }\\n\\n    #[test]\\n    fn test_json_merge_patch_should_merge_objects_in_object() {\\n        let mut target = serde_json::from_str(r#\\\"{\\\"a\\\": {\\\"b\\\": \\\"c\\\"}}\\\"#).unwrap();\\n        let patch = serde_json::from_str(r#\\\"{\\\"a\\\": {\\\"b\\\": \\\"d\\\", \\\"c\\\": null}}\\\"#).unwrap();\\n        let expected: serde_json::Value = serde_json::from_str(r#\\\"{\\\"a\\\": {\\\"b\\\": \\\"d\\\"}}\\\"#).unwrap();\\n\\n        json_merge_patch(&mut target, &patch);\\n\\n        assert_eq!(target, expected);\\n    }\\n\\n    #[test]\\n    fn test_json_merge_patch_should_replace_array_with_value() {\\n        let mut target = serde_json::from_str(r#\\\"{\\\"a\\\": [{\\\"b\\\": \\\"c\\\"}]}\\\"#).unwrap();\\n        let patch = serde_json::from_str(r#\\\"{\\\"a\\\": [1]}\\\"#).unwrap();\\n        let expected: serde_json::Value = serde_json::from_str(r#\\\"{\\\"a\\\": [1]}\\\"#).unwrap();\\n\\n        json_merge_patch(&mut target, &patch);\\n\\n        assert_eq!(target, expected);\\n    }\\n\\n    #[test]\\n    fn test_json_merge_patch_should_merge_nested_objects_and_remove_leaf_nodes() {\\n        let mut target = serde_json::from_str(r#\\\"{}\\\"#).unwrap();\\n        let patch = serde_json::from_str(r#\\\"{\\\"a\\\": {\\\"bb\\\": {\\\"ccc\\\": null}}}\\\"#).unwrap();\\n        let expected: serde_json::Value = serde_json::from_str(r#\\\"{\\\"a\\\": {\\\"bb\\\": {}}}\\\"#).unwrap();\\n\\n        json_merge_patch(&mut target, &patch);\\n\\n        assert_eq!(target, expected);\\n    }\\n\\n    #[test]\\n    fn test_json_merge_patch_should_replace_scalar_with_scalar() {\\n        let mut target = serde_json::from_str(r#\\\"{\\\"a\\\": \\\"b\\\"}\\\"#).unwrap();\\n        let patch = serde_json::from_str(r#\\\"[\\\"c\\\"]\\\"#).unwrap();\\n        let expected: serde_json::Value = serde_json::from_str(r#\\\"[\\\"c\\\"]\\\"#).unwrap();\\n\\n        json_merge_patch(&mut target, &patch);\\n\\n        assert_eq!(target, expected);\\n    }\\n\\n    #[test]\\n    fn test_json_merge_patch_should_replace_scalar_with_null() {\\n        let mut target = serde_json::from_str(r#\\\"{\\\"a\\\": \\\"foo\\\"}\\\"#).unwrap();\\n        let patch = serde_json::Value::Null;\\n\\n        json_merge_patch(&mut target, &patch);\\n\\n        assert_eq!(target, serde_json::Value::Null);\\n    }\\n\\n    #[test]\\n    fn test_json_merge_patch_should_replace_scalar_with_string() {\\n        let mut target = serde_json::from_str(r#\\\"{\\\"a\\\": \\\"foo\\\"}\\\"#).unwrap();\\n        let patch = serde_json::from_str(r#\\\"\\\"bar\\\"\\\"#).unwrap();\\n        let expected: serde_json::Value = serde_json::from_str(r#\\\"\\\"bar\\\"\\\"#).unwrap();\\n\\n        json_merge_patch(&mut target, &patch);\\n\\n        assert_eq!(target, expected);\\n    }\\n\\n    #[test]\\n    fn test_json_merge_patch_should_merge_null_with_scalar() {\\n        let mut target = serde_json::from_str(r#\\\"{\\\"e\\\": null}\\\"#).unwrap();\\n        let patch = serde_json::from_str(r#\\\"{\\\"a\\\": 1}\\\"#).unwrap();\\n        let expected: serde_json::Value = serde_json::from_str(r#\\\"{\\\"e\\\": null, \\\"a\\\": 1}\\\"#).unwrap();\\n\\n        json_merge_patch(&mut target, &patch);\\n\\n        assert_eq!(target, expected);\\n    }\\n\\n    #[test]\\n    fn test_json_merge_patch_should_replace_array_with_object() {\\n        let mut target = serde_json::from_str(r#\\\"{\\\"a\\\": []}\\\"#).unwrap();\\n        let patch = serde_json::from_str(r#\\\"{\\\"a\\\": {\\\"b\\\": \\\"c\\\"}}\\\"#).unwrap();\\n        let expected: serde_json::Value = serde_json::from_str(r#\\\"{\\\"a\\\": {\\\"b\\\": \\\"c\\\"}}\\\"#).unwrap();\\n\\n        json_merge_patch(&mut target, &patch);\\n\\n        assert_eq!(target, expected);\\n    }\\n\\n    #[test]\\n    fn test_json_merge_patch_should_merge_objects_in_array() {\\n        let mut target = serde_json::from_str(r#\\\"[{\\\"a\\\": \\\"b\\\"}, {\\\"c\\\": \\\"d\\\"}]\\\"#).unwrap();\\n        let patch = serde_json::from_str(r#\\\"{\\\"1\\\": {\\\"e\\\": \\\"f\\\"}}\\\"#).unwrap();\\n        let expected: serde_json::Value =\\n            serde_json::from_str(r#\\\"[{\\\"a\\\": \\\"b\\\"}, {\\\"c\\\": \\\"d\\\", \\\"e\\\": \\\"f\\\"}]\\\"#).unwrap();\\n\\n        json_merge_patch(&mut target, &patch);\\n\\n        assert_eq!(target, expected);\\n    }\\n\\n    #[test]\\n    fn test_json_merge_patch_should_replace_object_with_array() {\\n        let mut target = serde_json::from_str(r#\\\"{\\\"a\\\": {\\\"b\\\": \\\"c\\\"}}\\\"#).unwrap();\\n        let patch = serde_json::from_str(r#\\\"{\\\"a\\\": []}\\\"#).unwrap();\\n        let expected: serde_json::Value = serde_json::from_str(r#\\\"{\\\"a\\\": []}\\\"#).unwrap();\\n\\n        json_merge_patch(&mut target, &patch);\\n\\n        assert_eq!(target, expected);\\n    }\\n\\n    #[test]\\n    fn test_json_merge_patch_should_merge_arrays() {\\n        let mut target = serde_json::from_str(r#\\\"[\\\"a\\\", \\\"b\\\"]\\\"#).unwrap();\\n        let patch = serde_json::from_str(r#\\\"[\\\"c\\\", \\\"d\\\"]\\\"#).unwrap();\\n        let expected: serde_json::Value = serde_json::from_str(r#\\\"[\\\"c\\\", \\\"d\\\"]\\\"#).unwrap();\\n\\n        json_merge_patch(&mut target, &patch);\\n\\n        assert_eq!(target, expected);\\n    }\\n\\n    #[test]\\n    fn test_json_merge_patch_should_remove_key_from_object() {\\n        let mut target = serde_json::from_str(r#\\\"{\\\"a\\\": \\\"b\\\"}\\\"#).unwrap();\\n        let patch = serde_json::from_str(r#\\\"{\\\"a\\\": null}\\\"#).unwrap();\\n        let expected: serde_json::Value = serde_json::from_str(r#\\\"{}\\\"#).unwrap();\\n\\n        json_merge_patch(&mut target, &patch);\\n\\n        assert_eq!(target, expected);\\n    }\\n\\n    #[test]\\n    fn test_json_merge_patch_should_remove_index_from_array() {\\n        let mut target = serde_json::from_str(r#\\\"[\\\"a\\\", \\\"b\\\"]\\\"#).unwrap();\\n        let patch = serde_json::from_str(r#\\\"{\\\"1\\\": null}\\\"#).unwrap();\\n        let expected: serde_json::Value = serde_json::from_str(r#\\\"[\\\"a\\\"]\\\"#).unwrap();\\n\\n        json_merge_patch(&mut target, &patch);\\n\\n        assert_eq!(target, expected);\\n    }\\n\\n    #[test]\\n    fn test_json_merge_patch_should_remove_array_element() {\\n        let mut target = serde_json::from_str(r#\\\"[1, 2, 3]\\\"#).unwrap();\\n        let patch = serde_json::from_str(r#\\\"[null, 2]\\\"#).unwrap();\\n        let expected: serde_json::Value = serde_json::from_str(r#\\\"[2]\\\"#).unwrap();\\n\\n        json_merge_patch(&mut target, &patch);\\n\\n        assert_eq!(target, expected);\\n    }\\n}\\n\",\"language\":\"rust\"}],[\"bookmark\",{\"version\":\"1.0\",\"type\":\"bookmark\",\"url\":\"https://github.com/gustawdaniel/json-merge-patch\",\"metadata\":{\"url\":\"https://github.com/gustawdaniel/json-merge-patch\",\"title\":\"GitHub - gustawdaniel/json-merge-patch: Rust implementation of RFC 7396 - JSON Merge Patch\",\"description\":\"Rust implementation of RFC 7396 - JSON Merge Patch - GitHub - gustawdaniel/json-merge-patch: Rust implementation of RFC 7396 - JSON Merge Patch\",\"author\":\"gustawdaniel\",\"publisher\":\"GitHub\",\"thumbnail\":\"https://opengraph.githubassets.com/c34b4e8cb98eeb7a9a0e63c0affcb870059934bbf93121f05f370c5b89e57e83/gustawdaniel/json-merge-patch\",\"icon\":\"https://github.com/fluidicon.png\"}}]],\"markups\":[[\"code\"],[\"a\",[\"href\",\"https://www.rust-lang.org/tools/install\"]],[\"a\",[\"href\",\"https://docs.serde.rs/serde_json/\"]]],\"sections\":[[1,\"p\",[[0,[],0,\"JSON Merge Patch is a standardized algorithm for describing changes to a JSON document by treating it as a collection of unordered key-value pairs. Defined in RFC 7396, JSON Merge Patch provides a simple and efficient way to update JSON documents in a consistent manner. In this blog post, we will demonstrate how to implement the JSON Merge Patch algorithm in Rust, a systems programming language that emphasizes safety, concurrency, and performance.\"]]],[1,\"h2\",[[0,[],0,\"Overview of JSON Merge Patch:\"]]],[1,\"p\",[[0,[],0,\"JSON Merge Patch is a technique that allows you to apply modifications to a JSON document by creating a \\\"patch\\\" document. The patch document contains a set of key-value pairs representing the changes to be made to the original document. The algorithm follows these rules:\"]]],[3,\"ol\",[[[0,[],0,\"If the patch document contains a key with a non-null value, the key-value pair is added to the original document. If the key already exists, the value is replaced.\"]],[[0,[],0,\"If the patch document contains a key with a null value, the key is removed from the original document.\"]],[[0,[],0,\"If the patch document is an array, the original document is replaced with the patch document.\"]],[[0,[],0,\"If the patch document is a primitive value (e.g.g., string, number, or boolean), the original document is replaced with the patch document.\"]]]],[1,\"p\",[[0,[],0,\"JSON Merge Patch is particularly useful when you need to make partial updates to a JSON document without sending the entire document back to the server. It's a lightweight alternative to more complex patch formats like JSON Patch (RFC 6902).\"]]],[1,\"h2\",[[0,[],0,\"Getting Started with Rust:\"]]],[1,\"p\",[[0,[],0,\"To implement JSON Merge Patch in Rust, we will first need to set up a new Rust project and add the \"],[0,[0],1,\"serde_json\"],[0,[],0,\" crate, which provides support for working with JSON data:\"]]],[3,\"ol\",[[[0,[],0,\"Install Rust by following the instructions at \"],[0,[1],1,\"https://www.rust-lang.org/tools/install\"],[0,[],0,\".\"]],[[0,[],0,\"Create a new Rust project with \"],[0,[0],1,\"cargo new json_merge_patch\"],[0,[],0,\".\"]],[[0,[],0,\"Add the \"],[0,[0],1,\"serde_json\"],[0,[],0,\" crate to your \"],[0,[0],1,\"Cargo.toml\"],[0,[],0,\" file:\"]]]],[10,0],[1,\"p\",[[0,[],0,\"Implementing JSON Merge Patch in Rust:\"]]],[1,\"p\",[[0,[],0,\"We will create a \"],[0,[0],1,\"json_merge_patch\"],[0,[],0,\" function that takes a mutable reference to the original JSON document (the target) and a reference to the patch document. The function will then apply the patch to the target document according to the rules described earlier.\"]]],[10,1],[1,\"p\",[[0,[],0,\"In this implementation, we first check if the patch document is an object. If it is, we iterate through the key-value pairs in the patch object and apply the appropriate updates to the target document. If the target document is an array, we handle the case where the patch object has keys that are valid array indices, and modify the target array accordingly:\"]]],[1,\"p\",[[0,[],0,\"If the value is null, and the index is within the target array's bounds, remove the element at the index.\"]]],[1,\"p\",[[0,[],0,\"If the index is within the target array's bounds, apply the JSON Merge Patch recursively.\"]]],[1,\"p\",[[0,[],0,\"If the index is greater than the current length of the target array, fill the target array with null values until it reaches the desired index, and then append the value from the patch object.\"]]],[1,\"p\",[[0,[],0,\"If the patch document is not an object, we simply replace the target document with the patch document.\"]]],[1,\"h2\",[[0,[],0,\"Testing the Implementation:\"]]],[1,\"p\",[[0,[],0,\"Now that we have implemented the JSON Merge Patch algorithm, let's test it using a few examples:\"]]],[10,2],[1,\"p\",[[0,[],0,\"In this blog post, we demonstrated how to implement the JSON Merge Patch algorithm (RFC 7396) in Rust. Our implementation is both efficient and easy to understand, and it can be used to apply partial updates to JSON documents in a consistent manner.\"]]],[1,\"p\",[[0,[],0,\"We used the \"],[0,[0],1,\"serde_json\"],[0,[],0,\" crate to work with JSON data in Rust. You can find more information about \"],[0,[0],1,\"serde_json\"],[0,[],0,\" in the official documentation: \"],[0,[2],1,\"https://docs.serde.rs/serde_json/\"],[0,[],0,\".\"]]],[1,\"p\",[[0,[],0,\"The complete source code for this implementation, including tests, is available on GitHub:\"]]],[10,3],[1,\"p\",[[0,[],0,\"Feel free to explore, contribute, or use it as a starting point for your own projects.\"]]],[1,\"p\",[[0,[],0,\"With Rust's strong guarantees around safety, concurrency, and performance, implementing JSON Merge Patch and other JSON-related algorithms can be both enjoyable and reliable. I encourage you to try Rust for your next project that requires JSON processing or any other system-level programming tasks.\"]]]],\"ghostVersion\":\"4.0\"}","html":"<p>JSON Merge Patch is a standardized algorithm for describing changes to a JSON document by treating it as a collection of unordered key-value pairs. Defined in RFC 7396, JSON Merge Patch provides a simple and efficient way to update JSON documents in a consistent manner. In this blog post, we will demonstrate how to implement the JSON Merge Patch algorithm in Rust, a systems programming language that emphasizes safety, concurrency, and performance.</p><h2 id=\"overview-of-json-merge-patch\">Overview of JSON Merge Patch:</h2><p>JSON Merge Patch is a technique that allows you to apply modifications to a JSON document by creating a \"patch\" document. The patch document contains a set of key-value pairs representing the changes to be made to the original document. The algorithm follows these rules:</p><ol><li>If the patch document contains a key with a non-null value, the key-value pair is added to the original document. If the key already exists, the value is replaced.</li><li>If the patch document contains a key with a null value, the key is removed from the original document.</li><li>If the patch document is an array, the original document is replaced with the patch document.</li><li>If the patch document is a primitive value (e.g.g., string, number, or boolean), the original document is replaced with the patch document.</li></ol><p>JSON Merge Patch is particularly useful when you need to make partial updates to a JSON document without sending the entire document back to the server. It's a lightweight alternative to more complex patch formats like JSON Patch (RFC 6902).</p><h2 id=\"getting-started-with-rust\">Getting Started with Rust:</h2><p>To implement JSON Merge Patch in Rust, we will first need to set up a new Rust project and add the <code>serde_json</code> crate, which provides support for working with JSON data:</p><ol><li>Install Rust by following the instructions at <a href=\"https://www.rust-lang.org/tools/install\">https://www.rust-lang.org/tools/install</a>.</li><li>Create a new Rust project with <code>cargo new json_merge_patch</code>.</li><li>Add the <code>serde_json</code> crate to your <code>Cargo.toml</code> file:</li></ol><pre><code class=\"language-toml\">[dependencies]\nserde_json = \"1.0\"\n</code></pre><p>Implementing JSON Merge Patch in Rust:</p><p>We will create a <code>json_merge_patch</code> function that takes a mutable reference to the original JSON document (the target) and a reference to the patch document. The function will then apply the patch to the target document according to the rules described earlier.</p><pre><code class=\"language-rust\">use serde_json::Value;\n\npub fn json_merge_patch(target: &amp;mut Value, patch: &amp;Value) {\n    match patch {\n        Value::Object(patch_obj) =&gt; {\n            if !(target.is_object()\n                || target.is_array() &amp;&amp; patch_obj.keys().all(|key| key.parse::&lt;usize&gt;().is_ok()))\n            {\n                *target = Value::Object(serde_json::Map::new());\n            }\n\n            if let Value::Object(target_obj) = target {\n                for (key, value) in patch_obj {\n                    if value.is_null() {\n                        target_obj.remove(key);\n                    } else {\n                        let target_value =\n                            target_obj.entry(key.clone()).or_insert_with(|| Value::Null);\n                        json_merge_patch(target_value, value);\n                    }\n                }\n            } else if let Value::Array(target_arr) = target {\n                for (key, value) in patch_obj {\n                    if let Ok(index) = key.parse::&lt;usize&gt;() {\n                        if value.is_null() &amp;&amp; index &lt; target_arr.len() {\n                            target_arr.remove(index);\n                        } else if index &lt; target_arr.len() {\n                            json_merge_patch(&amp;mut target_arr[index], value);\n                        } else {\n                            // Handling the case where the index is greater than the current length of the target array\n                            while target_arr.len() &lt; index {\n                                target_arr.push(Value::Null);\n                            }\n                            target_arr.push(value.clone());\n                        }\n                    }\n                }\n            }\n        }\n        Value::Array(patch_arr) =&gt; {\n            *target = serde_json::Value::Array(\n                patch_arr\n                    .clone()\n                    .into_iter()\n                    .filter(|value| !value.is_null())\n                    .collect(),\n            );\n        }\n        _ =&gt; *target = patch.clone(),\n    }\n}</code></pre><p>In this implementation, we first check if the patch document is an object. If it is, we iterate through the key-value pairs in the patch object and apply the appropriate updates to the target document. If the target document is an array, we handle the case where the patch object has keys that are valid array indices, and modify the target array accordingly:</p><p>If the value is null, and the index is within the target array's bounds, remove the element at the index.</p><p>If the index is within the target array's bounds, apply the JSON Merge Patch recursively.</p><p>If the index is greater than the current length of the target array, fill the target array with null values until it reaches the desired index, and then append the value from the patch object.</p><p>If the patch document is not an object, we simply replace the target document with the patch document.</p><h2 id=\"testing-the-implementation\">Testing the Implementation:</h2><p>Now that we have implemented the JSON Merge Patch algorithm, let's test it using a few examples:</p><pre><code class=\"language-rust\">\n#[cfg(test)]\nmod tests {\n    use super::*;\n\n    #[test]\n    fn test_json_merge_patch_should_merge_objects_and_override_field() {\n        let mut target = serde_json::from_str(r#\"{\"a\": \"b\", \"c\": {\"d\": \"e\", \"f\": \"g\"}}\"#).unwrap();\n        let patch = serde_json::from_str(r#\"{\"a\": \"z\", \"c\": {\"f\": null}}\"#).unwrap();\n\n        json_merge_patch(&amp;mut target, &amp;patch);\n\n        let expected: serde_json::Value =\n            serde_json::from_str(r#\"{\"a\": \"z\", \"c\": {\"d\": \"e\"}}\"#).unwrap();\n        assert_eq!(target, expected);\n    }\n\n    #[test]\n    fn test_json_merge_patch_should_override_field_in_object() {\n        let mut target = serde_json::from_str(r#\"{\"a\": \"b\"}\"#).unwrap();\n        let patch = serde_json::from_str(r#\"{\"a\": \"c\"}\"#).unwrap();\n        let expected: serde_json::Value = serde_json::from_str(r#\"{\"a\": \"c\"}\"#).unwrap();\n\n        json_merge_patch(&amp;mut target, &amp;patch);\n\n        assert_eq!(target, expected);\n    }\n\n    #[test]\n    fn test_json_merge_patch_should_add_field_to_object() {\n        let mut target = serde_json::from_str(r#\"{\"a\": \"b\"}\"#).unwrap();\n        let patch = serde_json::from_str(r#\"{\"b\": \"c\"}\"#).unwrap();\n        let expected: serde_json::Value = serde_json::from_str(r#\"{\"a\": \"b\", \"b\": \"c\"}\"#).unwrap();\n\n        json_merge_patch(&amp;mut target, &amp;patch);\n\n        assert_eq!(target, expected);\n    }\n\n    #[test]\n    fn test_json_merge_patch_should_remove_field_from_object() {\n        let mut target = serde_json::from_str(r#\"{\"a\": \"b\", \"b\": \"c\"}\"#).unwrap();\n        let patch = serde_json::from_str(r#\"{\"a\": null}\"#).unwrap();\n        let expected: serde_json::Value = serde_json::from_str(r#\"{\"b\": \"c\"}\"#).unwrap();\n\n        json_merge_patch(&amp;mut target, &amp;patch);\n\n        assert_eq!(target, expected);\n    }\n\n    #[test]\n    fn test_json_merge_patch_should_override_field_in_array() {\n        let mut target = serde_json::from_str(r#\"{\"a\": [\"b\"]}\"#).unwrap();\n        let patch = serde_json::from_str(r#\"{\"a\": \"c\"}\"#).unwrap();\n        let expected: serde_json::Value = serde_json::from_str(r#\"{\"a\": \"c\"}\"#).unwrap();\n\n        json_merge_patch(&amp;mut target, &amp;patch);\n\n        assert_eq!(target, expected);\n    }\n\n    #[test]\n    fn test_json_merge_patch_should_replace_array_with_scalar() {\n        let mut target = serde_json::from_str(r#\"{\"a\": \"c\"}\"#).unwrap();\n        let patch = serde_json::from_str(r#\"{\"a\": [\"b\"]}\"#).unwrap();\n        let expected: serde_json::Value = serde_json::from_str(r#\"{\"a\": [\"b\"]}\"#).unwrap();\n\n        json_merge_patch(&amp;mut target, &amp;patch);\n\n        assert_eq!(target, expected);\n    }\n\n    #[test]\n    fn test_json_merge_patch_should_merge_objects_in_object() {\n        let mut target = serde_json::from_str(r#\"{\"a\": {\"b\": \"c\"}}\"#).unwrap();\n        let patch = serde_json::from_str(r#\"{\"a\": {\"b\": \"d\", \"c\": null}}\"#).unwrap();\n        let expected: serde_json::Value = serde_json::from_str(r#\"{\"a\": {\"b\": \"d\"}}\"#).unwrap();\n\n        json_merge_patch(&amp;mut target, &amp;patch);\n\n        assert_eq!(target, expected);\n    }\n\n    #[test]\n    fn test_json_merge_patch_should_replace_array_with_value() {\n        let mut target = serde_json::from_str(r#\"{\"a\": [{\"b\": \"c\"}]}\"#).unwrap();\n        let patch = serde_json::from_str(r#\"{\"a\": [1]}\"#).unwrap();\n        let expected: serde_json::Value = serde_json::from_str(r#\"{\"a\": [1]}\"#).unwrap();\n\n        json_merge_patch(&amp;mut target, &amp;patch);\n\n        assert_eq!(target, expected);\n    }\n\n    #[test]\n    fn test_json_merge_patch_should_merge_nested_objects_and_remove_leaf_nodes() {\n        let mut target = serde_json::from_str(r#\"{}\"#).unwrap();\n        let patch = serde_json::from_str(r#\"{\"a\": {\"bb\": {\"ccc\": null}}}\"#).unwrap();\n        let expected: serde_json::Value = serde_json::from_str(r#\"{\"a\": {\"bb\": {}}}\"#).unwrap();\n\n        json_merge_patch(&amp;mut target, &amp;patch);\n\n        assert_eq!(target, expected);\n    }\n\n    #[test]\n    fn test_json_merge_patch_should_replace_scalar_with_scalar() {\n        let mut target = serde_json::from_str(r#\"{\"a\": \"b\"}\"#).unwrap();\n        let patch = serde_json::from_str(r#\"[\"c\"]\"#).unwrap();\n        let expected: serde_json::Value = serde_json::from_str(r#\"[\"c\"]\"#).unwrap();\n\n        json_merge_patch(&amp;mut target, &amp;patch);\n\n        assert_eq!(target, expected);\n    }\n\n    #[test]\n    fn test_json_merge_patch_should_replace_scalar_with_null() {\n        let mut target = serde_json::from_str(r#\"{\"a\": \"foo\"}\"#).unwrap();\n        let patch = serde_json::Value::Null;\n\n        json_merge_patch(&amp;mut target, &amp;patch);\n\n        assert_eq!(target, serde_json::Value::Null);\n    }\n\n    #[test]\n    fn test_json_merge_patch_should_replace_scalar_with_string() {\n        let mut target = serde_json::from_str(r#\"{\"a\": \"foo\"}\"#).unwrap();\n        let patch = serde_json::from_str(r#\"\"bar\"\"#).unwrap();\n        let expected: serde_json::Value = serde_json::from_str(r#\"\"bar\"\"#).unwrap();\n\n        json_merge_patch(&amp;mut target, &amp;patch);\n\n        assert_eq!(target, expected);\n    }\n\n    #[test]\n    fn test_json_merge_patch_should_merge_null_with_scalar() {\n        let mut target = serde_json::from_str(r#\"{\"e\": null}\"#).unwrap();\n        let patch = serde_json::from_str(r#\"{\"a\": 1}\"#).unwrap();\n        let expected: serde_json::Value = serde_json::from_str(r#\"{\"e\": null, \"a\": 1}\"#).unwrap();\n\n        json_merge_patch(&amp;mut target, &amp;patch);\n\n        assert_eq!(target, expected);\n    }\n\n    #[test]\n    fn test_json_merge_patch_should_replace_array_with_object() {\n        let mut target = serde_json::from_str(r#\"{\"a\": []}\"#).unwrap();\n        let patch = serde_json::from_str(r#\"{\"a\": {\"b\": \"c\"}}\"#).unwrap();\n        let expected: serde_json::Value = serde_json::from_str(r#\"{\"a\": {\"b\": \"c\"}}\"#).unwrap();\n\n        json_merge_patch(&amp;mut target, &amp;patch);\n\n        assert_eq!(target, expected);\n    }\n\n    #[test]\n    fn test_json_merge_patch_should_merge_objects_in_array() {\n        let mut target = serde_json::from_str(r#\"[{\"a\": \"b\"}, {\"c\": \"d\"}]\"#).unwrap();\n        let patch = serde_json::from_str(r#\"{\"1\": {\"e\": \"f\"}}\"#).unwrap();\n        let expected: serde_json::Value =\n            serde_json::from_str(r#\"[{\"a\": \"b\"}, {\"c\": \"d\", \"e\": \"f\"}]\"#).unwrap();\n\n        json_merge_patch(&amp;mut target, &amp;patch);\n\n        assert_eq!(target, expected);\n    }\n\n    #[test]\n    fn test_json_merge_patch_should_replace_object_with_array() {\n        let mut target = serde_json::from_str(r#\"{\"a\": {\"b\": \"c\"}}\"#).unwrap();\n        let patch = serde_json::from_str(r#\"{\"a\": []}\"#).unwrap();\n        let expected: serde_json::Value = serde_json::from_str(r#\"{\"a\": []}\"#).unwrap();\n\n        json_merge_patch(&amp;mut target, &amp;patch);\n\n        assert_eq!(target, expected);\n    }\n\n    #[test]\n    fn test_json_merge_patch_should_merge_arrays() {\n        let mut target = serde_json::from_str(r#\"[\"a\", \"b\"]\"#).unwrap();\n        let patch = serde_json::from_str(r#\"[\"c\", \"d\"]\"#).unwrap();\n        let expected: serde_json::Value = serde_json::from_str(r#\"[\"c\", \"d\"]\"#).unwrap();\n\n        json_merge_patch(&amp;mut target, &amp;patch);\n\n        assert_eq!(target, expected);\n    }\n\n    #[test]\n    fn test_json_merge_patch_should_remove_key_from_object() {\n        let mut target = serde_json::from_str(r#\"{\"a\": \"b\"}\"#).unwrap();\n        let patch = serde_json::from_str(r#\"{\"a\": null}\"#).unwrap();\n        let expected: serde_json::Value = serde_json::from_str(r#\"{}\"#).unwrap();\n\n        json_merge_patch(&amp;mut target, &amp;patch);\n\n        assert_eq!(target, expected);\n    }\n\n    #[test]\n    fn test_json_merge_patch_should_remove_index_from_array() {\n        let mut target = serde_json::from_str(r#\"[\"a\", \"b\"]\"#).unwrap();\n        let patch = serde_json::from_str(r#\"{\"1\": null}\"#).unwrap();\n        let expected: serde_json::Value = serde_json::from_str(r#\"[\"a\"]\"#).unwrap();\n\n        json_merge_patch(&amp;mut target, &amp;patch);\n\n        assert_eq!(target, expected);\n    }\n\n    #[test]\n    fn test_json_merge_patch_should_remove_array_element() {\n        let mut target = serde_json::from_str(r#\"[1, 2, 3]\"#).unwrap();\n        let patch = serde_json::from_str(r#\"[null, 2]\"#).unwrap();\n        let expected: serde_json::Value = serde_json::from_str(r#\"[2]\"#).unwrap();\n\n        json_merge_patch(&amp;mut target, &amp;patch);\n\n        assert_eq!(target, expected);\n    }\n}\n</code></pre><p>In this blog post, we demonstrated how to implement the JSON Merge Patch algorithm (RFC 7396) in Rust. Our implementation is both efficient and easy to understand, and it can be used to apply partial updates to JSON documents in a consistent manner.</p><p>We used the <code>serde_json</code> crate to work with JSON data in Rust. You can find more information about <code>serde_json</code> in the official documentation: <a href=\"https://docs.serde.rs/serde_json/\">https://docs.serde.rs/serde_json/</a>.</p><p>The complete source code for this implementation, including tests, is available on GitHub:</p><figure class=\"kg-card kg-bookmark-card\"><a class=\"kg-bookmark-container\" href=\"https://github.com/gustawdaniel/json-merge-patch\"><div class=\"kg-bookmark-content\"><div class=\"kg-bookmark-title\">GitHub - gustawdaniel/json-merge-patch: Rust implementation of RFC 7396 - JSON Merge Patch</div><div class=\"kg-bookmark-description\">Rust implementation of RFC 7396 - JSON Merge Patch - GitHub - gustawdaniel/json-merge-patch: Rust implementation of RFC 7396 - JSON Merge Patch</div><div class=\"kg-bookmark-metadata\"><img class=\"kg-bookmark-icon\" src=\"https://github.com/fluidicon.png\" alt=\"\"><span class=\"kg-bookmark-author\">GitHub</span><span class=\"kg-bookmark-publisher\">gustawdaniel</span></div></div><div class=\"kg-bookmark-thumbnail\"><img src=\"https://opengraph.githubassets.com/c34b4e8cb98eeb7a9a0e63c0affcb870059934bbf93121f05f370c5b89e57e83/gustawdaniel/json-merge-patch\" alt=\"\"></div></a></figure><p>Feel free to explore, contribute, or use it as a starting point for your own projects.</p><p>With Rust's strong guarantees around safety, concurrency, and performance, implementing JSON Merge Patch and other JSON-related algorithms can be both enjoyable and reliable. I encourage you to try Rust for your next project that requires JSON processing or any other system-level programming tasks.</p>","comment_id":"6422832d99d7a498d8917d2e","plaintext":"JSON Merge Patch is a standardized algorithm for describing changes to a JSON document by treating it as a collection of unordered key-value pairs. Defined in RFC 7396, JSON Merge Patch provides a simple and efficient way to update JSON documents in a consistent manner. In this blog post, we will demonstrate how to implement the JSON Merge Patch algorithm in Rust, a systems programming language that emphasizes safety, concurrency, and performance.\n\n\nOverview of JSON Merge Patch:\n\nJSON Merge Patch is a technique that allows you to apply modifications to a JSON document by creating a \"patch\" document. The patch document contains a set of key-value pairs representing the changes to be made to the original document. The algorithm follows these rules:\n\n 1. If the patch document contains a key with a non-null value, the key-value pair is added to the original document. If the key already exists, the value is replaced.\n 2. If the patch document contains a key with a null value, the key is removed from the original document.\n 3. If the patch document is an array, the original document is replaced with the patch document.\n 4. If the patch document is a primitive value (e.g.g., string, number, or boolean), the original document is replaced with the patch document.\n\nJSON Merge Patch is particularly useful when you need to make partial updates to a JSON document without sending the entire document back to the server. It's a lightweight alternative to more complex patch formats like JSON Patch (RFC 6902).\n\n\nGetting Started with Rust:\n\nTo implement JSON Merge Patch in Rust, we will first need to set up a new Rust project and add the serde_json crate, which provides support for working with JSON data:\n\n 1. Install Rust by following the instructions at https://www.rust-lang.org/tools/install.\n 2. Create a new Rust project with cargo new json_merge_patch.\n 3. Add the serde_json crate to your Cargo.toml file:\n\n[dependencies]\nserde_json = \"1.0\"\n\n\nImplementing JSON Merge Patch in Rust:\n\nWe will create a json_merge_patch function that takes a mutable reference to the original JSON document (the target) and a reference to the patch document. The function will then apply the patch to the target document according to the rules described earlier.\n\nuse serde_json::Value;\n\npub fn json_merge_patch(target: &mut Value, patch: &Value) {\n    match patch {\n        Value::Object(patch_obj) => {\n            if !(target.is_object()\n                || target.is_array() && patch_obj.keys().all(|key| key.parse::<usize>().is_ok()))\n            {\n                *target = Value::Object(serde_json::Map::new());\n            }\n\n            if let Value::Object(target_obj) = target {\n                for (key, value) in patch_obj {\n                    if value.is_null() {\n                        target_obj.remove(key);\n                    } else {\n                        let target_value =\n                            target_obj.entry(key.clone()).or_insert_with(|| Value::Null);\n                        json_merge_patch(target_value, value);\n                    }\n                }\n            } else if let Value::Array(target_arr) = target {\n                for (key, value) in patch_obj {\n                    if let Ok(index) = key.parse::<usize>() {\n                        if value.is_null() && index < target_arr.len() {\n                            target_arr.remove(index);\n                        } else if index < target_arr.len() {\n                            json_merge_patch(&mut target_arr[index], value);\n                        } else {\n                            // Handling the case where the index is greater than the current length of the target array\n                            while target_arr.len() < index {\n                                target_arr.push(Value::Null);\n                            }\n                            target_arr.push(value.clone());\n                        }\n                    }\n                }\n            }\n        }\n        Value::Array(patch_arr) => {\n            *target = serde_json::Value::Array(\n                patch_arr\n                    .clone()\n                    .into_iter()\n                    .filter(|value| !value.is_null())\n                    .collect(),\n            );\n        }\n        _ => *target = patch.clone(),\n    }\n}\n\nIn this implementation, we first check if the patch document is an object. If it is, we iterate through the key-value pairs in the patch object and apply the appropriate updates to the target document. If the target document is an array, we handle the case where the patch object has keys that are valid array indices, and modify the target array accordingly:\n\nIf the value is null, and the index is within the target array's bounds, remove the element at the index.\n\nIf the index is within the target array's bounds, apply the JSON Merge Patch recursively.\n\nIf the index is greater than the current length of the target array, fill the target array with null values until it reaches the desired index, and then append the value from the patch object.\n\nIf the patch document is not an object, we simply replace the target document with the patch document.\n\n\nTesting the Implementation:\n\nNow that we have implemented the JSON Merge Patch algorithm, let's test it using a few examples:\n\n\n#[cfg(test)]\nmod tests {\n    use super::*;\n\n    #[test]\n    fn test_json_merge_patch_should_merge_objects_and_override_field() {\n        let mut target = serde_json::from_str(r#\"{\"a\": \"b\", \"c\": {\"d\": \"e\", \"f\": \"g\"}}\"#).unwrap();\n        let patch = serde_json::from_str(r#\"{\"a\": \"z\", \"c\": {\"f\": null}}\"#).unwrap();\n\n        json_merge_patch(&mut target, &patch);\n\n        let expected: serde_json::Value =\n            serde_json::from_str(r#\"{\"a\": \"z\", \"c\": {\"d\": \"e\"}}\"#).unwrap();\n        assert_eq!(target, expected);\n    }\n\n    #[test]\n    fn test_json_merge_patch_should_override_field_in_object() {\n        let mut target = serde_json::from_str(r#\"{\"a\": \"b\"}\"#).unwrap();\n        let patch = serde_json::from_str(r#\"{\"a\": \"c\"}\"#).unwrap();\n        let expected: serde_json::Value = serde_json::from_str(r#\"{\"a\": \"c\"}\"#).unwrap();\n\n        json_merge_patch(&mut target, &patch);\n\n        assert_eq!(target, expected);\n    }\n\n    #[test]\n    fn test_json_merge_patch_should_add_field_to_object() {\n        let mut target = serde_json::from_str(r#\"{\"a\": \"b\"}\"#).unwrap();\n        let patch = serde_json::from_str(r#\"{\"b\": \"c\"}\"#).unwrap();\n        let expected: serde_json::Value = serde_json::from_str(r#\"{\"a\": \"b\", \"b\": \"c\"}\"#).unwrap();\n\n        json_merge_patch(&mut target, &patch);\n\n        assert_eq!(target, expected);\n    }\n\n    #[test]\n    fn test_json_merge_patch_should_remove_field_from_object() {\n        let mut target = serde_json::from_str(r#\"{\"a\": \"b\", \"b\": \"c\"}\"#).unwrap();\n        let patch = serde_json::from_str(r#\"{\"a\": null}\"#).unwrap();\n        let expected: serde_json::Value = serde_json::from_str(r#\"{\"b\": \"c\"}\"#).unwrap();\n\n        json_merge_patch(&mut target, &patch);\n\n        assert_eq!(target, expected);\n    }\n\n    #[test]\n    fn test_json_merge_patch_should_override_field_in_array() {\n        let mut target = serde_json::from_str(r#\"{\"a\": [\"b\"]}\"#).unwrap();\n        let patch = serde_json::from_str(r#\"{\"a\": \"c\"}\"#).unwrap();\n        let expected: serde_json::Value = serde_json::from_str(r#\"{\"a\": \"c\"}\"#).unwrap();\n\n        json_merge_patch(&mut target, &patch);\n\n        assert_eq!(target, expected);\n    }\n\n    #[test]\n    fn test_json_merge_patch_should_replace_array_with_scalar() {\n        let mut target = serde_json::from_str(r#\"{\"a\": \"c\"}\"#).unwrap();\n        let patch = serde_json::from_str(r#\"{\"a\": [\"b\"]}\"#).unwrap();\n        let expected: serde_json::Value = serde_json::from_str(r#\"{\"a\": [\"b\"]}\"#).unwrap();\n\n        json_merge_patch(&mut target, &patch);\n\n        assert_eq!(target, expected);\n    }\n\n    #[test]\n    fn test_json_merge_patch_should_merge_objects_in_object() {\n        let mut target = serde_json::from_str(r#\"{\"a\": {\"b\": \"c\"}}\"#).unwrap();\n        let patch = serde_json::from_str(r#\"{\"a\": {\"b\": \"d\", \"c\": null}}\"#).unwrap();\n        let expected: serde_json::Value = serde_json::from_str(r#\"{\"a\": {\"b\": \"d\"}}\"#).unwrap();\n\n        json_merge_patch(&mut target, &patch);\n\n        assert_eq!(target, expected);\n    }\n\n    #[test]\n    fn test_json_merge_patch_should_replace_array_with_value() {\n        let mut target = serde_json::from_str(r#\"{\"a\": [{\"b\": \"c\"}]}\"#).unwrap();\n        let patch = serde_json::from_str(r#\"{\"a\": [1]}\"#).unwrap();\n        let expected: serde_json::Value = serde_json::from_str(r#\"{\"a\": [1]}\"#).unwrap();\n\n        json_merge_patch(&mut target, &patch);\n\n        assert_eq!(target, expected);\n    }\n\n    #[test]\n    fn test_json_merge_patch_should_merge_nested_objects_and_remove_leaf_nodes() {\n        let mut target = serde_json::from_str(r#\"{}\"#).unwrap();\n        let patch = serde_json::from_str(r#\"{\"a\": {\"bb\": {\"ccc\": null}}}\"#).unwrap();\n        let expected: serde_json::Value = serde_json::from_str(r#\"{\"a\": {\"bb\": {}}}\"#).unwrap();\n\n        json_merge_patch(&mut target, &patch);\n\n        assert_eq!(target, expected);\n    }\n\n    #[test]\n    fn test_json_merge_patch_should_replace_scalar_with_scalar() {\n        let mut target = serde_json::from_str(r#\"{\"a\": \"b\"}\"#).unwrap();\n        let patch = serde_json::from_str(r#\"[\"c\"]\"#).unwrap();\n        let expected: serde_json::Value = serde_json::from_str(r#\"[\"c\"]\"#).unwrap();\n\n        json_merge_patch(&mut target, &patch);\n\n        assert_eq!(target, expected);\n    }\n\n    #[test]\n    fn test_json_merge_patch_should_replace_scalar_with_null() {\n        let mut target = serde_json::from_str(r#\"{\"a\": \"foo\"}\"#).unwrap();\n        let patch = serde_json::Value::Null;\n\n        json_merge_patch(&mut target, &patch);\n\n        assert_eq!(target, serde_json::Value::Null);\n    }\n\n    #[test]\n    fn test_json_merge_patch_should_replace_scalar_with_string() {\n        let mut target = serde_json::from_str(r#\"{\"a\": \"foo\"}\"#).unwrap();\n        let patch = serde_json::from_str(r#\"\"bar\"\"#).unwrap();\n        let expected: serde_json::Value = serde_json::from_str(r#\"\"bar\"\"#).unwrap();\n\n        json_merge_patch(&mut target, &patch);\n\n        assert_eq!(target, expected);\n    }\n\n    #[test]\n    fn test_json_merge_patch_should_merge_null_with_scalar() {\n        let mut target = serde_json::from_str(r#\"{\"e\": null}\"#).unwrap();\n        let patch = serde_json::from_str(r#\"{\"a\": 1}\"#).unwrap();\n        let expected: serde_json::Value = serde_json::from_str(r#\"{\"e\": null, \"a\": 1}\"#).unwrap();\n\n        json_merge_patch(&mut target, &patch);\n\n        assert_eq!(target, expected);\n    }\n\n    #[test]\n    fn test_json_merge_patch_should_replace_array_with_object() {\n        let mut target = serde_json::from_str(r#\"{\"a\": []}\"#).unwrap();\n        let patch = serde_json::from_str(r#\"{\"a\": {\"b\": \"c\"}}\"#).unwrap();\n        let expected: serde_json::Value = serde_json::from_str(r#\"{\"a\": {\"b\": \"c\"}}\"#).unwrap();\n\n        json_merge_patch(&mut target, &patch);\n\n        assert_eq!(target, expected);\n    }\n\n    #[test]\n    fn test_json_merge_patch_should_merge_objects_in_array() {\n        let mut target = serde_json::from_str(r#\"[{\"a\": \"b\"}, {\"c\": \"d\"}]\"#).unwrap();\n        let patch = serde_json::from_str(r#\"{\"1\": {\"e\": \"f\"}}\"#).unwrap();\n        let expected: serde_json::Value =\n            serde_json::from_str(r#\"[{\"a\": \"b\"}, {\"c\": \"d\", \"e\": \"f\"}]\"#).unwrap();\n\n        json_merge_patch(&mut target, &patch);\n\n        assert_eq!(target, expected);\n    }\n\n    #[test]\n    fn test_json_merge_patch_should_replace_object_with_array() {\n        let mut target = serde_json::from_str(r#\"{\"a\": {\"b\": \"c\"}}\"#).unwrap();\n        let patch = serde_json::from_str(r#\"{\"a\": []}\"#).unwrap();\n        let expected: serde_json::Value = serde_json::from_str(r#\"{\"a\": []}\"#).unwrap();\n\n        json_merge_patch(&mut target, &patch);\n\n        assert_eq!(target, expected);\n    }\n\n    #[test]\n    fn test_json_merge_patch_should_merge_arrays() {\n        let mut target = serde_json::from_str(r#\"[\"a\", \"b\"]\"#).unwrap();\n        let patch = serde_json::from_str(r#\"[\"c\", \"d\"]\"#).unwrap();\n        let expected: serde_json::Value = serde_json::from_str(r#\"[\"c\", \"d\"]\"#).unwrap();\n\n        json_merge_patch(&mut target, &patch);\n\n        assert_eq!(target, expected);\n    }\n\n    #[test]\n    fn test_json_merge_patch_should_remove_key_from_object() {\n        let mut target = serde_json::from_str(r#\"{\"a\": \"b\"}\"#).unwrap();\n        let patch = serde_json::from_str(r#\"{\"a\": null}\"#).unwrap();\n        let expected: serde_json::Value = serde_json::from_str(r#\"{}\"#).unwrap();\n\n        json_merge_patch(&mut target, &patch);\n\n        assert_eq!(target, expected);\n    }\n\n    #[test]\n    fn test_json_merge_patch_should_remove_index_from_array() {\n        let mut target = serde_json::from_str(r#\"[\"a\", \"b\"]\"#).unwrap();\n        let patch = serde_json::from_str(r#\"{\"1\": null}\"#).unwrap();\n        let expected: serde_json::Value = serde_json::from_str(r#\"[\"a\"]\"#).unwrap();\n\n        json_merge_patch(&mut target, &patch);\n\n        assert_eq!(target, expected);\n    }\n\n    #[test]\n    fn test_json_merge_patch_should_remove_array_element() {\n        let mut target = serde_json::from_str(r#\"[1, 2, 3]\"#).unwrap();\n        let patch = serde_json::from_str(r#\"[null, 2]\"#).unwrap();\n        let expected: serde_json::Value = serde_json::from_str(r#\"[2]\"#).unwrap();\n\n        json_merge_patch(&mut target, &patch);\n\n        assert_eq!(target, expected);\n    }\n}\n\n\nIn this blog post, we demonstrated how to implement the JSON Merge Patch algorithm (RFC 7396) in Rust. Our implementation is both efficient and easy to understand, and it can be used to apply partial updates to JSON documents in a consistent manner.\n\nWe used the serde_json crate to work with JSON data in Rust. You can find more information about serde_json in the official documentation: https://docs.serde.rs/serde_json/.\n\nThe complete source code for this implementation, including tests, is available on GitHub:\n\nGitHub - gustawdaniel/json-merge-patch: Rust implementation of RFC 7396 - JSON Merge PatchRust implementation of RFC 7396 - JSON Merge Patch - GitHub - gustawdaniel/json-merge-patch: Rust implementation of RFC 7396 - JSON Merge PatchGitHubgustawdaniel\n\nFeel free to explore, contribute, or use it as a starting point for your own projects.\n\nWith Rust's strong guarantees around safety, concurrency, and performance, implementing JSON Merge Patch and other JSON-related algorithms can be both enjoyable and reliable. I encourage you to try Rust for your next project that requires JSON processing or any other system-level programming tasks.","feature_image":"__GHOST_URL__/content/images/2023/03/michael-benz-IgWNxx7paz4-unsplash.jpg","featured":0,"type":"post","status":"published","locale":null,"visibility":"public","email_recipient_filter":"all","created_at":"2023-03-28T06:03:25.000Z","updated_at":"2023-03-28T11:43:54.000Z","published_at":"2023-03-28T11:43:54.000Z","custom_excerpt":"Rust's speed and reliability make it ideal for implementing JSON Merge Patch, as defined in RFC 7396. This specification enables efficient and safe partial updates to JSON documents.","codeinjection_head":null,"codeinjection_foot":null,"custom_template":null,"canonical_url":null,"newsletter_id":null,"lexical":null},{"id":"642c173a99d7a498d8917d72","uuid":"d3c2b24d-608f-4f2e-a09b-5a814f894455","title":"Calculating the difference between JSON files.","slug":"calculating-the-difference-between-json-files","mobiledoc":"{\"version\":\"0.3.1\",\"atoms\":[],\"cards\":[[\"code\",{\"code\":\"node json-diff.js src/locales/en_old.json src/locales/en.json\"}],[\"code\",{\"code\":\"const fs = require('fs')\\n\\nconst pathBase = `${process.cwd()}/${process.argv[2]}`;\\nconst pathComp = `${process.cwd()}/${process.argv[3]}`;\\n\\nif(!fs.existsSync(pathBase)) {\\n  console.error(`File ${pathBase} not existst`);\\n  process.exit()\\n}\\n\\nif(!fs.existsSync(pathComp)) {\\n  console.error(`File ${pathComp} not existst`);\\n  process.exit()\\n}\"}],[\"code\",{\"code\":\"const base = JSON.parse(fs.readFileSync(pathBase).toString());\\nconst comp = JSON.parse(fs.readFileSync(pathComp).toString());\"}],[\"code\",{\"code\":\"function getDiff(a, b) {\\n  const res = {};\\n\\n  for (let key in a) {\\n    if(a.hasOwnProperty(key)) {\\n      if(!b.hasOwnProperty(key)) {\\n        res[key] = a[key]\\n      } else {\\n        if (typeof a[key] === 'object') {\\n          res[key] = getDiff(a[key], b[key])\\n        }\\n      }\\n      if(res[key] && !Object.keys(res[key]).length) {\\n        delete res[key];\\n      }\\n    }\\n  }\\n\\n  return res;\\n}\"}],[\"code\",{\"code\":\"process.stdout.write(JSON.stringify(getDiff(base, comp)))\"}],[\"code\",{\"code\":\"node ../DevTools/json-diff.js src/locales/en_old.json src/locales/en.json > src/locales/en-codes.json\"}],[\"code\",{\"code\":\"import Vue from 'vue'\\nimport VueI18n from 'vue-i18n'\\nimport deepmerge from 'deepmerge'\\n\\nimport en from 'vuetify/lib/locale/en'\\nimport pl from 'vuetify/lib/locale/pl'\\n\\nVue.use(VueI18n);\\n\\nconst messages = {\\n  en: deepmerge(\\n    require('@/locales/en-codes.json'),\\n    require('@/locales/en.json'),\\n    {$vuetify: en}\\n  ),\\n  pl: deepmerge(\\n    require('@/locales/pl-codes.json'),\\n    require('@/locales/pl.json'),\\n    {$vuetify: pl}\\n  ),\\n};\\n\\nexport default new VueI18n({\\n  locale: process.env.VUE_APP_I18N_LOCALE || 'en',\\n  fallbackLocale: process.env.VUE_APP_I18N_FALLBACK_LOCALE || 'en',\\n  messages,\\n})\\n\\nexport const languages = [\\n  { text: 'lang.pl', value: 'pl' },\\n  { text: 'lang.en', value: 'en' },\\n];\"}]],\"markups\":[],\"sections\":[[1,\"p\",[[0,[],0,\"In this article, we will show how to write a function to determine the difference between two JSON files.\"]]],[1,\"p\",[[0,[],0,\"From an educational point of view, this is an excellent example of using recursive functions. From a practical perspective, it is a useful tool for working with translations.\"]]],[1,\"p\",[[0,[],0,\"We will be using the script from the command line.\"]]],[10,0],[1,\"p\",[[0,[],0,\"After this command, we can expect that files will be read and all the keys that appear in the first file but are not in the second file will be printed to the standard output.\"]]],[1,\"p\",[[0,[],0,\"We will now show the source code of the json-diff.js file.\"]]],[1,\"p\",[[0,[],0,\"We will start by checking if the files indicated as arguments exist:\"]]],[10,1],[1,\"p\",[[0,[],0,\"Then we read the contents of these files and convert JSON to objects.\"]]],[10,2],[1,\"p\",[[0,[],0,\"Now we write a function for finding differences.\"]]],[10,3],[1,\"p\",[[0,[],0,\"Her task is to take a pair of objects and traverse through the keys of the first (base) one. If the second object (subtracted) does not have it, then that key should be added to the result.\"]]],[1,\"p\",[[0,[],0,\"Otherwise, it should be checked whether the type is not an object. In this case, it may be necessary to perform a check inside this key.\"]]],[1,\"p\",[[0,[],0,\"Here we have a key line - using the getDiff function within itself.\"]]],[1,\"p\",[[0,[],0,\"In the end, we delete the keys for which the value is an empty object.\"]]],[1,\"p\",[[0,[],0,\"The last line of the program is to display the results on the screen.\"]]],[10,4],[1,\"p\",[[0,[],0,\"This program does not support arrays. They are not necessary for translation files. If you want to read about more advanced methods of comparing JSON files, a good starting point is a thread on stack overflow.\"]]],[1,\"p\",[[0,[],0,\"Let's see now how the program works in practice. On translation files. The first file is prepared manually and covers all translations in the en_old.json application, the second one is generated by i18next and is called en.json. The problem is that i18next did not detect all translations.\"]]],[1,\"p\",[[0,[],0,\"At first, I did the work manually. I sorted both files on the codeshack.io/json-sorter website.\"]]],[1,\"p\",[[0,[],0,\"Then, on the diffchecker website, I identified the differences between...\"]]],[1,\"p\",[[0,[],0,\"I have now created a file with missing translations.\"]]],[10,5],[1,\"p\",[[0,[],0,\"The file displayed and formatted by jq looks like this:\"]]],[1,\"p\",[[0,[],0,\"We see that it contains all the missing keys.\"]]],[1,\"p\",[[0,[],0,\"When importing files with translations, we can use the deepmerge package. The i18n configuration file could look like this, for example:\"]]],[10,6],[1,\"p\",[[0,[],0,\"If you would like to share your experiences related to automation of translation work, feel free to comment. I would be interested in learning about the tools you use and whether you sometimes write your own auxiliary scripts, or recommend any set of tools.\"]]]]}","html":"<p>In this article, we will show how to write a function to determine the difference between two JSON files.</p><p>From an educational point of view, this is an excellent example of using recursive functions. From a practical perspective, it is a useful tool for working with translations.</p><p>We will be using the script from the command line.</p><pre><code>node json-diff.js src/locales/en_old.json src/locales/en.json</code></pre><p>After this command, we can expect that files will be read and all the keys that appear in the first file but are not in the second file will be printed to the standard output.</p><p>We will now show the source code of the json-diff.js file.</p><p>We will start by checking if the files indicated as arguments exist:</p><pre><code>const fs = require('fs')\n\nconst pathBase = `${process.cwd()}/${process.argv[2]}`;\nconst pathComp = `${process.cwd()}/${process.argv[3]}`;\n\nif(!fs.existsSync(pathBase)) {\n  console.error(`File ${pathBase} not existst`);\n  process.exit()\n}\n\nif(!fs.existsSync(pathComp)) {\n  console.error(`File ${pathComp} not existst`);\n  process.exit()\n}</code></pre><p>Then we read the contents of these files and convert JSON to objects.</p><pre><code>const base = JSON.parse(fs.readFileSync(pathBase).toString());\nconst comp = JSON.parse(fs.readFileSync(pathComp).toString());</code></pre><p>Now we write a function for finding differences.</p><pre><code>function getDiff(a, b) {\n  const res = {};\n\n  for (let key in a) {\n    if(a.hasOwnProperty(key)) {\n      if(!b.hasOwnProperty(key)) {\n        res[key] = a[key]\n      } else {\n        if (typeof a[key] === 'object') {\n          res[key] = getDiff(a[key], b[key])\n        }\n      }\n      if(res[key] &amp;&amp; !Object.keys(res[key]).length) {\n        delete res[key];\n      }\n    }\n  }\n\n  return res;\n}</code></pre><p>Her task is to take a pair of objects and traverse through the keys of the first (base) one. If the second object (subtracted) does not have it, then that key should be added to the result.</p><p>Otherwise, it should be checked whether the type is not an object. In this case, it may be necessary to perform a check inside this key.</p><p>Here we have a key line - using the getDiff function within itself.</p><p>In the end, we delete the keys for which the value is an empty object.</p><p>The last line of the program is to display the results on the screen.</p><pre><code>process.stdout.write(JSON.stringify(getDiff(base, comp)))</code></pre><p>This program does not support arrays. They are not necessary for translation files. If you want to read about more advanced methods of comparing JSON files, a good starting point is a thread on stack overflow.</p><p>Let's see now how the program works in practice. On translation files. The first file is prepared manually and covers all translations in the en_old.json application, the second one is generated by i18next and is called en.json. The problem is that i18next did not detect all translations.</p><p>At first, I did the work manually. I sorted both files on the codeshack.io/json-sorter website.</p><p>Then, on the diffchecker website, I identified the differences between...</p><p>I have now created a file with missing translations.</p><pre><code>node ../DevTools/json-diff.js src/locales/en_old.json src/locales/en.json &gt; src/locales/en-codes.json</code></pre><p>The file displayed and formatted by jq looks like this:</p><p>We see that it contains all the missing keys.</p><p>When importing files with translations, we can use the deepmerge package. The i18n configuration file could look like this, for example:</p><pre><code>import Vue from 'vue'\nimport VueI18n from 'vue-i18n'\nimport deepmerge from 'deepmerge'\n\nimport en from 'vuetify/lib/locale/en'\nimport pl from 'vuetify/lib/locale/pl'\n\nVue.use(VueI18n);\n\nconst messages = {\n  en: deepmerge(\n    require('@/locales/en-codes.json'),\n    require('@/locales/en.json'),\n    {$vuetify: en}\n  ),\n  pl: deepmerge(\n    require('@/locales/pl-codes.json'),\n    require('@/locales/pl.json'),\n    {$vuetify: pl}\n  ),\n};\n\nexport default new VueI18n({\n  locale: process.env.VUE_APP_I18N_LOCALE || 'en',\n  fallbackLocale: process.env.VUE_APP_I18N_FALLBACK_LOCALE || 'en',\n  messages,\n})\n\nexport const languages = [\n  { text: 'lang.pl', value: 'pl' },\n  { text: 'lang.en', value: 'en' },\n];</code></pre><p>If you would like to share your experiences related to automation of translation work, feel free to comment. I would be interested in learning about the tools you use and whether you sometimes write your own auxiliary scripts, or recommend any set of tools.</p>","comment_id":"642c173a99d7a498d8917d72","plaintext":"In this article, we will show how to write a function to determine the difference between two JSON files.\n\nFrom an educational point of view, this is an excellent example of using recursive functions. From a practical perspective, it is a useful tool for working with translations.\n\nWe will be using the script from the command line.\n\nnode json-diff.js src/locales/en_old.json src/locales/en.json\n\nAfter this command, we can expect that files will be read and all the keys that appear in the first file but are not in the second file will be printed to the standard output.\n\nWe will now show the source code of the json-diff.js file.\n\nWe will start by checking if the files indicated as arguments exist:\n\nconst fs = require('fs')\n\nconst pathBase = `${process.cwd()}/${process.argv[2]}`;\nconst pathComp = `${process.cwd()}/${process.argv[3]}`;\n\nif(!fs.existsSync(pathBase)) {\n  console.error(`File ${pathBase} not existst`);\n  process.exit()\n}\n\nif(!fs.existsSync(pathComp)) {\n  console.error(`File ${pathComp} not existst`);\n  process.exit()\n}\n\nThen we read the contents of these files and convert JSON to objects.\n\nconst base = JSON.parse(fs.readFileSync(pathBase).toString());\nconst comp = JSON.parse(fs.readFileSync(pathComp).toString());\n\nNow we write a function for finding differences.\n\nfunction getDiff(a, b) {\n  const res = {};\n\n  for (let key in a) {\n    if(a.hasOwnProperty(key)) {\n      if(!b.hasOwnProperty(key)) {\n        res[key] = a[key]\n      } else {\n        if (typeof a[key] === 'object') {\n          res[key] = getDiff(a[key], b[key])\n        }\n      }\n      if(res[key] && !Object.keys(res[key]).length) {\n        delete res[key];\n      }\n    }\n  }\n\n  return res;\n}\n\nHer task is to take a pair of objects and traverse through the keys of the first (base) one. If the second object (subtracted) does not have it, then that key should be added to the result.\n\nOtherwise, it should be checked whether the type is not an object. In this case, it may be necessary to perform a check inside this key.\n\nHere we have a key line - using the getDiff function within itself.\n\nIn the end, we delete the keys for which the value is an empty object.\n\nThe last line of the program is to display the results on the screen.\n\nprocess.stdout.write(JSON.stringify(getDiff(base, comp)))\n\nThis program does not support arrays. They are not necessary for translation files. If you want to read about more advanced methods of comparing JSON files, a good starting point is a thread on stack overflow.\n\nLet's see now how the program works in practice. On translation files. The first file is prepared manually and covers all translations in the en_old.json application, the second one is generated by i18next and is called en.json. The problem is that i18next did not detect all translations.\n\nAt first, I did the work manually. I sorted both files on the codeshack.io/json-sorter website.\n\nThen, on the diffchecker website, I identified the differences between...\n\nI have now created a file with missing translations.\n\nnode ../DevTools/json-diff.js src/locales/en_old.json src/locales/en.json > src/locales/en-codes.json\n\nThe file displayed and formatted by jq looks like this:\n\nWe see that it contains all the missing keys.\n\nWhen importing files with translations, we can use the deepmerge package. The i18n configuration file could look like this, for example:\n\nimport Vue from 'vue'\nimport VueI18n from 'vue-i18n'\nimport deepmerge from 'deepmerge'\n\nimport en from 'vuetify/lib/locale/en'\nimport pl from 'vuetify/lib/locale/pl'\n\nVue.use(VueI18n);\n\nconst messages = {\n  en: deepmerge(\n    require('@/locales/en-codes.json'),\n    require('@/locales/en.json'),\n    {$vuetify: en}\n  ),\n  pl: deepmerge(\n    require('@/locales/pl-codes.json'),\n    require('@/locales/pl.json'),\n    {$vuetify: pl}\n  ),\n};\n\nexport default new VueI18n({\n  locale: process.env.VUE_APP_I18N_LOCALE || 'en',\n  fallbackLocale: process.env.VUE_APP_I18N_FALLBACK_LOCALE || 'en',\n  messages,\n})\n\nexport const languages = [\n  { text: 'lang.pl', value: 'pl' },\n  { text: 'lang.en', value: 'en' },\n];\n\nIf you would like to share your experiences related to automation of translation work, feel free to comment. I would be interested in learning about the tools you use and whether you sometimes write your own auxiliary scripts, or recommend any set of tools.","feature_image":null,"featured":0,"type":"post","status":"draft","locale":null,"visibility":"public","email_recipient_filter":"all","created_at":"2023-04-04T12:25:30.000Z","updated_at":"2023-04-04T12:25:30.000Z","published_at":"2023-04-04T12:25:29.000Z","custom_excerpt":null,"codeinjection_head":null,"codeinjection_foot":null,"custom_template":null,"canonical_url":null,"newsletter_id":null,"lexical":null},{"id":"642d42f599d7a498d8917d76","uuid":"838ded90-1f67-48f8-a4be-e9f1252e5019","title":"Managing processes in Node JS.","slug":"managing-processes-in-node-js","mobiledoc":"{\"version\":\"0.3.1\",\"atoms\":[],\"cards\":[[\"image\",{\"src\":\"https://gustawdaniel.com/content/images/2021/07/cpu0-12.png\"}],[\"code\",{\"code\":\"const readline = require('readline');\"}],[\"code\",{\"code\":\"readline.emitKeypressEvents(process.stdin);\"}],[\"code\",{\"code\":\"process.stdin.setRawMode(true);\"}],[\"code\",{\"code\":\"process.stdin.on('keypress', (str, key) => {\\n    if (key.ctrl && key.name === 'c') {\\n        process.exit();\\n    } else {\\n        console.log('typed char', key.name);\\n    }\\n});\"}],[\"code\",{\"code\":\"{ sequence: 'v', name: 'v', ctrl: false, meta: false, shift: false }\"}],[\"image\",{\"src\":\"https://gustawdaniel.com/content/images/2021/07/Screenshot-from-2021-07-16-18-15-24.png\"}],[\"code\",{\"code\":\"const cp = require('child_process');\"}],[\"code\",{\"code\":\"const forks = [];\"}],[\"image\",{\"src\":\"https://gustawdaniel.com/content/images/2021/07/one-does-not-simply-kill-a-zombie-process.jpg\"}],[\"code\",{\"code\":\"if (key.ctrl && key.name === 'c') {\\n        while (forks.length > 0) {\\n            forks[forks.length - 1].kill()\\n            forks.pop()\\n        }\\n        process.exit();\\n    } else {\"}],[\"code\",{\"code\":\"if (!Number.isNaN(parseInt(key.name,32))) {\\n            const req = parseInt(key.name,32);\\n\\n            if (forks.length < req) {\\n                while (forks.length < req) {\\n                    const n = cp.fork(`${__dirname}/bomb.js`);\\n                    forks.push(n)\\n                }\\n            }\\n\\n            if (forks.length > req) {\\n                while (forks.length > req) {\\n                    forks[forks.length - 1].kill()\\n                    forks.pop()\\n                }\\n            }\\n\\n            console.log('processes PIDs', forks.map(f => f.pid));\\n\\n        }\"}],[\"code\",{\"code\":\"let result = 0;\\nwhile (true) {\\n    result += Math.random() * Math.random();\\n}\"}],[\"image\",{\"src\":\"https://gustawdaniel.com/content/images/2021/07/Screenshot-from-2021-07-16-18-51-17.png\"}],[\"image\",{\"src\":\"https://gustawdaniel.com/content/images/2021/07/Screenshot-from-2021-07-16-15-26-13.png\"}],[\"image\",{\"src\":\"https://gustawdaniel.com/content/images/2021/07/Screenshot-from-2021-07-16-15-30-03.png\"}],[\"image\",{\"src\":\"https://miro.medium.com/fit/c/152/152/1*sHhtYhaCe2Uc3IU0IgKwIQ.png\"}],[\"code\",{\"code\":\"npm init -y && npm i bcrypt\"}],[\"code\",{\"code\":\"const fs = require('fs')\\nconst bc = require('bcrypt')\\n\\nconst main = async () => {\\n    return bc.hash(process.argv[2] || 'pass', 11)\\n}\\n\\nmain().then(p => {\\n    fs.writeFileSync(`${__dirname}/.pass`, p);\\n    console.log(p)\\n}).catch(console.error);\"}],[\"image\",{\"src\":\"https://gustawdaniel.com/favicon.ico\"}],[\"image\",{\"src\":\"https://gustawdaniel.com/content/images/2021/07/Screenshot-from-2021-07-17-13-44-09.png\"}],[\"code\",{\"code\":\"const fs = require('fs');\\nconst bc = require('bcrypt');\\nconst alphabet = String.fromCharCode(...Array(123).keys()).slice(97);\\nconst hash = fs.readFileSync(`${__dirname}/.pass`).toString()\\nconst chalk = require('chalk')\\n\\nlet i = 0;\\nconst s = new Date().getTime();\\nconst n = () => new Date().getTime() - s;\\nlet found = false;\\n\\nconst que = [];\\n\\nasync function check(input) {\\n    if (found) return;\\n    const r = await bc.compare(input, hash)\\n\\n    console.log(`${i}\\\\t${input}\\\\t${n()}\\\\t${r}\\\\t${que.length}`)\\n    if (r) {\\n        console.log(chalk.green(`FOUND: \\\"${input}\\\"`))\\n        found = true;\\n        process.exit();\\n    }\\n    for (let n of alphabet) {\\n        que.push(input + n);\\n    }\\n}\\n\\nasync function processQue() {\\n    const phrase = que[i++]\\n    await check(phrase)\\n}\\n\\nconst main = async () => {\\n    while (!found) {\\n        await processQue()\\n    }\\n}\\n\\nconsole.log(`i\\\\tinput\\\\tn()\\\\tr\\\\tque.length`)\\ncheck('').then(() => main()).catch(console.error)\"}],[\"code\",{\"code\":\"npm i chalk\"}],[\"code\",{\"code\":\"node generate_hash.js ac\"}],[\"code\",{\"code\":\"time node force-single.js\"}],[\"image\",{\"src\":\"https://gustawdaniel.com/content/images/2021/07/Screenshot-from-2021-07-17-13-48-47.png\"}],[\"code\",{\"code\":\"const r = await bc.compare(input, hash)\"}],[\"code\",{\"code\":\"const r = i >= 29 // await bc.compare(input, hash)\"}],[\"code\",{\"code\":\"node force-single.js  0.17s user 0.03s system 103% cpu 0.188 total\"}],[\"image\",{\"src\":\"https://gustawdaniel.com/content/images/2021/07/bFbMbDgAT6M6T4zsVmk16Oiip7vIOWaeuEY0vTkkZoU.png\"}],[\"image\",{\"src\":\"https://gustawdaniel.com/content/images/2021/07/Screenshot-from-2021-07-17-14-16-35.png\"}],[\"image\",{\"src\":\"https://gustawdaniel.com/content/images/2021/07/Screenshot-from-2021-07-17-14-26-11.png\"}],[\"code\",{\"code\":\"const cp = require('child_process');\\nconst fs = require('fs');\\nconst chalk = require('chalk')\\n\\nconst alphabet = String.fromCharCode(...Array(123).keys()).slice(97);\\nconst forks = [];\\n\\nlet i = 0;\\nconst s = new Date().getTime();\\nconst n = () => new Date().getTime() - s;\\nlet found = false;\"}],[\"code\",{\"code\":\"const que = alphabet.split('');\"}],[\"code\",{\"code\":\"function check(input, f) {\\n    if (found) return;\\n\\n    f.send(input);\\n\\n    for (let n of alphabet) {\\n        que.push(input + n);\\n    }\\n}\"}],[\"code\",{\"code\":\"function processQue(f) {\\n    const phrase = que[i++]\\n    check(phrase, f)\\n}\"}],[\"code\",{\"code\":\"const main = async () => {\\n    forks.forEach(f => {\\n        f.on('message', ({input, r}) => {\\n            console.log(`${i}\\\\t${input}\\\\t${n()}\\\\t${r}\\\\t${que.length}\\\\t${f.pid}`)\\n\\n            if (r) {\\n                console.log(chalk.green(`FOUND: \\\"${input}\\\"`))\\n                found = true;\\n\\n                fs.appendFileSync('logs.txt', `${forks.length},${n()}\\\\n`)\\n\\n                while (forks.length > 0) {\\n                    forks[forks.length - 1].kill()\\n                    forks.pop()\\n                }\\n\\n                process.exit();\\n            } else {\\n                processQue(f);\\n            }\\n        });\\n        processQue(f);\\n    })\\n}\"}],[\"code\",{\"code\":\"while (forks.length < (process.argv[2] || 15)) {\\n    const n = cp.fork(`${__dirname}/force-fork.js`);\\n    forks.push(n)\\n}\"}],[\"code\",{\"code\":\"console.log(chalk.blue(`Run using ${forks.length} child processes`))\\nconsole.log(`i\\\\tinput\\\\tn()\\\\tr\\\\tque.length\\\\tpid`)\\nmain().catch(console.error)\"}],[\"code\",{\"code\":\"const fs = require('fs');\\nconst bc = require('bcrypt');\\n\\nconst hash = fs.readFileSync(`${__dirname}/.pass`).toString()\\n\\nprocess.on('message', (input) => {\\n    bc.compare(input, hash).then((r) => {\\n        process.send({r, input});\\n    })\\n});\"}],[\"code\",{\"code\":\"fs.appendFileSync('logs.txt', `${forks.length},${n()}\\\\n`)\"}],[\"code\",{\"code\":\"for j in $(seq 1 20); do for i in $(seq 1 25); do time node force-child.js $i; sleep 4; done; done;\"}],[\"code\",{\"code\":\"for j in $(seq 1 5); do for i in $(seq 1 50); do time node force-child.js $i; sleep 4; done; done;\"}],[\"image\",{\"src\":\"https://gustawdaniel.com/content/images/2021/07/Screenshot-from-2021-07-17-14-56-29.png\"}],[\"image\",{\"src\":\"https://gustawdaniel.com/content/images/2021/07/Screenshot-from-2021-07-17-14-56-40.png\"}],[\"image\",{\"src\":\"https://gustawdaniel.com/content/images/2021/07/Screenshot-from-2021-07-17-14-56-46.png\"}],[\"image\",{\"src\":\"https://gustawdaniel.com/content/images/2021/07/Screenshot-from-2021-07-17-14-56-51.png\"}],[\"image\",{\"src\":\"https://gustawdaniel.com/content/images/2021/07/usl.svg\"}],[\"code\",{\"code\":\"load = Import[\\\"/home/daniel/exp/node/logs.txt\\\", \\\"Data\\\"];\"}],[\"code\",{\"code\":\"loadEff = {#[[1]], 1/#[[2]]} & /@ load;\"}],[\"code\",{\"code\":\"firstMean = GroupBy[loadEff // N, First -> Last, Mean][[1]];\"}],[\"code\",{\"code\":\"nlm = NonlinearModelFit[{#[[1]], #[[2]]/firstMean} & /@ \\n   loadEff, \\\\[Lambda] n/(1 + \\\\[Sigma] (n - 1) + \\\\[Kappa] n (n - \\n         1)), {{\\\\[Lambda], 0.9}, {\\\\[Sigma], 0.9}, {\\\\[Kappa], \\n    0.1}}, {n}]\"}],[\"code\",{\"code\":\"Show[ListPlot[{#[[1]], #[[2]]/firstMean} & /@ loadEff], \\n Plot[nlm[s], {s, 0, 50}, PlotStyle -> Orange, PlotRange -> All], \\n AxesLabel -> {\\\"processes\\\", \\\"gain of efficiency\\\"}, ImageSize -> Large,\\n  PlotLabel -> \\\"Gain of efficiency relative to single process\\\"]\"}],[\"image\",{\"src\":\"https://gustawdaniel.com/content/images/2021/07/gain-eff.svg\"}],[\"code\",{\"code\":\"Solve[D[\\\\[Lambda] n/(1 + \\\\[Sigma] (n - 1) + \\\\[Kappa] n (n - 1)), \\n   n] == 0, n]\"}],[\"image\",{\"src\":\"https://gustawdaniel.com/content/images/2021/07/Screenshot-from-2021-07-17-15-21-22.png\"}],[\"code\",{\"code\":\"NSolve[D[Normal[nlm], n] == 0, n]\"}]],\"markups\":[],\"sections\":[[1,\"p\",[[0,[],0,\"In this post, we will learn how to create and terminate subprocesses in Node.js, and how to transmit data between them.\"]]],[1,\"p\",[[0,[],0,\"If a program is performing heavy computations but is not parallelized, the state of your processor may look like this:\"]]],[10,0],[1,\"p\",[[0,[],0,\"That's why it's worth delving into this topic regardless of the language you're writing in.\"]]],[1,\"p\",[[0,[],0,\"The article will be divided into 3 parts:\"]]],[1,\"p\",[[0,[],0,\"In the first two, we will write a script to simulate CPU core load. In the last one, we will parallelize a brute force attack on a password.\"]]],[1,\"p\",[[0,[],0,\"At the end, we will analyze the scalability of the written program.\"]]],[1,\"h2\",[[0,[],0,\"Process control with readline\"]]],[1,\"p\",[[0,[],0,\"We want to create a program in which by pressing a key on the keyboard, we can set the number of CPU cores to be utilized. We will start by capturing keyboard events in real time.\"]]],[1,\"p\",[[0,[],0,\"We will be able to do this thanks to the readline module, which provides an interface for reading and writing data from streams such as the keyboard (process.stdin).\"]]],[1,\"p\",[[0,[],0,\"We will start with importing this module.\"]]],[10,1],[1,\"p\",[[0,[],0,\"Next, we set up the readline event to trigger upon pressing a button on the keyboard using the command.\"]]],[10,2],[1,\"p\",[[0,[],0,\"The readline function can work with various streams. This line instructs it to listen to the keyboard. We immediately set the mode to raw.\"]]],[10,3],[1,\"p\",[[0,[],0,\"This allows reading character by character from the keyboard with separately attached modifiers such as Ctrl or Shift. At the same time, this mode forces independent handling of the process shutdown by Ctrl+C. More information about stream modes and connecting a terminal to a process can be found in the documentation.\"]]],[1,\"p\",[[0,[],0,\"Meanwhile, in our program, the next lines will allow us to handle character reading:\"]]],[10,4],[1,\"p\",[[0,[],0,\"The symbol saved in key is an object with the following keys.\"]]],[10,5],[1,\"p\",[[0,[],0,\"In the presented code, we handle the closing of the process with the ctrl+c combination and printing the chosen keyboard character to the console. Typing in successive characters will always show them in the terminal.\"]]],[10,6],[1,\"p\",[[0,[],0,\"The next step is to replace typing in characters with creating or deleting processor-intensive processes.\"]]],[1,\"h2\",[[0,[],0,\"Creating and terminating processes in Node JS\"]]],[1,\"p\",[[0,[],0,\"In Node JS, we can easily create subprocesses and manage them using the child_process module. We import it just like the previous module to manage subprocesses.\"]]],[10,7],[1,\"p\",[[0,[],0,\"Next, we create an array to which we will be saving references to the processes that are being created.\"]]],[10,8],[1,\"p\",[[0,[],0,\"If we forgot about them when closing the program, they would become zombie processes - that is, ones that continue to live and consume computer resources without supervision.\"]]],[10,9],[1,\"p\",[[0,[],0,\"To remove them before closing our script, we write the code:\"]]],[10,10],[1,\"p\",[[0,[],0,\"If other buttons are chosen besides 'c' in the presence of 'ctrl', we will read the numerical value of that button and, based on that value, add or kill the appropriate number of processes to make their number equal to that value.\"]]],[10,11],[1,\"p\",[[0,[],0,\"The choice of the base-32 numbering system may seem surprising. However, it is a convenient system if we assume that we want to indicate a number slightly exceeding 10 using only one key.\"]]],[1,\"p\",[[0,[],0,\"The required number of processes is assigned to the variable req, and using cp.fork or kill we create and terminate any missing or excess processes.\"]]],[1,\"p\",[[0,[],0,\"We only need the contents of the bomb.js file to complete the whole. It could contain any operations that consume computing power. In our case, it is missing.\"]]],[10,12],[1,\"p\",[[0,[],0,\"This means code written only to simulate load.\"]]],[1,\"p\",[[0,[],0,\"After launching the program and selecting several load options, we can see how processes are being created and deleted. Thanks to htop, we can observe how CPU usage changes during this time.\"]]],[10,13],[1,\"p\",[[0,[],0,\"BashTop has an even nicer interface for monitoring your processor, as it also displays historical usage. In the screenshot below, we can see how by modifying the number of processes in our program, I was able to simulate different levels of processor load with tasks.\"]]],[10,14],[1,\"p\",[[0,[],0,\"And what was the utilization of the cores like when I selected the option to create 16 processes?\"]]],[10,15],[1,\"p\",[[0,[],0,\"We can use this program to simulate load testing. In the bomb.js file, we can replace random number generation with operations such as sending HTTP requests or consuming other resources, such as RAM or disk space.\"]]],[1,\"h2\",[[0,[],0,\"Parallel brute-force attack on password\"]]],[1,\"p\",[[0,[],0,\"Different methods have been used throughout history to hash passwords. Currently, the most popular method is bcrypt, but a newer and more advanced method, argon2i, also holds a strong position. Simplifying the difference between the two, breaking bcrypt requires significant computational power, while argon can be configured to require a large amount of operational memory. With the former, it is easy to purchase large amounts of computational power, and graphics cards and streaming processors can additionally increase our password cracking capabilities. However, breaking argon requires a much greater effort to accumulate the necessary amount of operational memory on a single machine. It is worth noting that this brief overview could be expanded by reading the full article.\"]]],[10,16],[1,\"p\",[[0,[],0,\"In the following part of the post, we will show how using multiple cores speeds up the breaking of a password hashed with the bcrypt algorithm.\"]]],[1,\"p\",[[0,[],0,\"We will write code for generating password hash, crack it using a single core, and then we will write the same code utilizing sub-processes, to delegate the task of checking subsequent phrases.\"]]],[1,\"h3\",[[0,[],0,\"Generating password hash using bcrypt\"]]],[1,\"p\",[[0,[],0,\"Installation of the bcrypt package is required for this.\"]]],[10,17],[1,\"p\",[[0,[],0,\"We will generate a password using the generate_hash.js script, which takes a password argument and writes its hash to the .pass file.\"]]],[10,18],[1,\"h3\",[[0,[],0,\"Breaking a password with the brute force method in a single thread\"]]],[1,\"p\",[[0,[],0,\"In a brute-force attack, the key is the set of characters that we use to iterate over the sequences that we will check. We will use the standard alphabet from a to z and repeatedly generate sequences of characters to check. The process of generating and processing these sequences can be implemented using a recursive function, but this would make it difficult to control the order in which they are generated. Instead, we will use a simple queue stored in memory. This queue will not be emptied, as emptying it from the front would change the indexing within the queue, which could negatively affect performance as already discussed in the article.\"]]],[10,19],[1,\"p\",[[0,[],0,\"Instead of emptying the queue, we will read values from it using a variable index that will move along it. The flowchart of the program we will write is as follows:\"]]],[10,20],[1,\"p\",[[0,[],0,\"His code is:\"]]],[10,21],[1,\"p\",[[0,[],0,\"The chalk package is required for the operation, which allows for easy text coloring.\"]]],[10,22],[1,\"p\",[[0,[],0,\"Let's test our program.\"]]],[1,\"p\",[[0,[],0,\"At first, we will generate a password. We'll choose \\\"ac\\\" because it's simple and we'll break it quickly.\"]]],[10,23],[1,\"p\",[[0,[],0,\"Next, we start our program and see how it sequentially checks passwords from the queue.\"]]],[10,24],[10,25],[1,\"p\",[[0,[],0,\"In the columns, we have the index, the sequence being checked, the time elapsed in milliseconds since the program started, the information on whether the password matches the hash, and the current length of the queue.\"]]],[1,\"p\",[[0,[],0,\"If you are concerned that the queue is growing too quickly and wasting a lot of power, we can see how the program behaves after replacing the line.\"]]],[10,26],[1,\"p\",[[0,[],0,\"\\\"Aby uzyskać najlepszy efekt, należy stosować ten produkt regularnie, zwykle dwa razy dziennie po umyciu twarzy. Nałożyć na skórę delikatnie, unikając okolic wokół oczu.\\\" \\\"To achieve the best effect, it is recommended to use this product regularly, typically twice daily after washing your face. Apply gently onto the skin, avoiding the eye area.\\\"\"]]],[10,27],[1,\"p\",[[0,[],0,\"It will turn out that the script execution time will decrease from 7.27 seconds to 0.17 seconds.\"]]],[10,28],[1,\"p\",[[0,[],0,\"\\\"What it means is that only 2.3% of computing power is being allocated to operations other than just comparing passwords.\\\"\"]]],[1,\"h3\",[[0,[],0,\"Using sub-processes to increase efficiency\"]]],[1,\"p\",[[0,[],0,\"Because checking the compatibility of a password and a hash is a processor-intensive operation, we expect a significant improvement in performance for this task if we use multiple cores simultaneously. Therefore, we will rewrite our program so that the main process handles the queue and assigns the task of checking passwords to subordinate processes.\"]]],[10,29],[1,\"p\",[[0,[],0,\"Our program structure is divided into a main thread and sub processes. In the main thread, a list of sub processes, a queue, and a listener for messages from sub processes are created. Ultimately, each sub process is assigned a task from the queue to execute. After executing a task, a sub process reports back to the main thread with a response. The main thread then increments the index and assigns the sub process a new task. This process continues until a correct password is found.\"]]],[10,30],[1,\"p\",[[0,[],0,\"It is worth noting that independent children will complete tasks at different speeds, which will affect the order of their response submissions. An exemplary output of the program is:\"]]],[10,31],[1,\"p\",[[0,[],0,\"The code is divided into two files:\"]]],[1,\"p\",[[0,[],0,\"We will begin the analysis of the main process - force-child.js. The program starts by defining the alphabet and auxiliary variables for indexing and counting time.\"]]],[10,32],[1,\"p\",[[0,[],0,\"Next, we fill the queue with the alphabet.\"]]],[10,33],[1,\"p\",[[0,[],0,\"In the single-threaded version of the program, the check function received a phrase, checked it, and expanded the queue. This time, in addition to the phrase, the argument for the selected subprocess to perform the check will be \\\"f\\\". Instead of using bcrypt directly, we will send a request to the subprocess to process the phrase and expand the queue.\"]]],[10,34],[1,\"p\",[[0,[],0,\"We have eliminated the word \\\"async\\\" here, so we do not have to wait for the execution of this function. This is a simple task delegation. The key element of this code is sending a message to the subprocess, which is done by the \\\"send\\\" function directly on the subprocess.\"]]],[1,\"p\",[[0,[],0,\"The next function, processQue, serves us to perform a single clock cycle on the queue.\"]]],[10,35],[1,\"p\",[[0,[],0,\"It is very short and its main task is to prevent duplication of the logic responsible for iterating through the queue.\"]]],[1,\"p\",[[0,[],0,\"The main function is the program's primary function responsible for setting up listeners for responses from subprocesses and assigning them initial tasks that allow them to enter a loop of communication between them.\"]]],[10,36],[1,\"p\",[[0,[],0,\"Before we call the main function, it is necessary to create processes in the forks array.\"]]],[10,37],[1,\"p\",[[0,[],0,\"The recommended number of them is a value close to the number of processor threads but smaller than it, so that the main process is not blocked.\"]]],[1,\"p\",[[0,[],0,\"At the end, we print information about the program, column names, and start the main function.\"]]],[10,38],[1,\"p\",[[0,[],0,\"The second file - force-fork.js is much simpler and contains only reading the hash and waiting for tasks. When it receives them, it tests the hashed password using bcrypt and then sends the result back through the same communication channel.\"]]],[10,39],[1,\"h2\",[[0,[],0,\"Scalowalność odnosi się do zdolności systemu, aplikacji lub procesu do utrzymania lub zwiększenia swojej wydajności wraz ze wzrostem liczby użytkowników, rozmiaru danych lub innych czynników wpływających na jego pojemność. Analiza skalowalności ma na celu zbadanie, jak dobrze dana aplikacja czy system skaluje się w odpowiedzi na zwiększenie wymagań użytkowników lub innych czynników, takich jak obciążenie procesora, dostęp do pamięci, przepustowość sieci itp.\"]]],[1,\"p\",[[0,[],0,\"An attentive reader probably noticed a small but important line of code for the rest of the article:\"]]],[10,40],[1,\"p\",[[0,[],0,\"It is performed after finding the password and it attaches the number of sub-processes and the time of finding the password to the logs.txt file. The data for this file was provided by executing a double loop in bash.\"]]],[10,41],[1,\"p\",[[0,[],0,\"And later expanding these results to a higher number of processes.\"]]],[10,42],[1,\"p\",[[0,[],0,\"According to the General Law of Scaling, we expect a performance increase up to a certain point (around 15 cores), followed by a decrease due to delays caused by mutual blocking of sub-processes.\"]]],[1,\"h3\",[[0,[],0,\"Universal law of scaling\"]]],[1,\"p\",[[0,[],0,\"If you haven't heard of the universal scaling law, I will introduce you to the topic quickly. It means that in an ideal world, if systems were linearly scalable, adding n times more resources would increase the system's performance or throughput by n times. This situation can be illustrated by the diagram:\"]]],[10,43],[1,\"p\",[[0,[],0,\"However, such situations are not encountered in the real world. There is always some inefficiency associated with assigning data to nodes (servers or threads) and collecting them. Delays related to data assignment and retrieval are called serialization. Sometimes the term contention is used.\"]]],[10,44],[1,\"p\",[[0,[],0,\"Taking this phenomenon into account leads to the Amdahl's Model. However, it turns out that it is insufficient for most IT systems because it completely overlooks the second major factor limiting scaling - inter-process communication, or crosstalk. It can be graphically represented as follows:\"]]],[10,45],[1,\"p\",[[0,[],0,\"If serialization has a cost proportional to the number of nodes, then communication is proportional to their square - just like the number of diagonals of a polygon is proportional to the number of its angles.\"]]],[10,46],[1,\"p\",[[0,[],0,\"On the graph, we can see curves comparing the impact of the number of nodes on system performance according to these three models.\"]]],[10,47],[1,\"p\",[[0,[],0,\"A good (50-page) study on this topic can be found at the link:\"]]],[1,\"p\",[[0,[],0,\"Please find the translation below: https://cdn2.hubspot.net/hubfs/498921/eBooks/scalability_new.pdf\"]]],[1,\"h3\",[[0,[],0,\"Compilation of measurement data with the USL model\"]]],[1,\"p\",[[0,[],0,\"The collected data consists of the number of threads and execution times of the program. We load it into the Mathematica program using the command:\"]]],[10,48],[1,\"p\",[[0,[],0,\"Because we want to consider efficiency rather than time, we reverse the second column with the command.\"]]],[10,49],[1,\"p\",[[0,[],0,\"\\\"The most sensible unit is normalization with respect to the execution time for one subprocess. This will allow us to see the gain from adding additional processes. We calculate the average of these times using the command.\\\"\"]]],[10,50],[1,\"p\",[[0,[],0,\"Next, we adjust the model:\"]]],[10,51],[1,\"p\",[[0,[],0,\"And we compare it with a graph of the list of measurement points.\"]]],[10,52],[10,53],[1,\"p\",[[0,[],0,\"It is worth showing a very nice example of theoretical maximum here.\"]]],[10,54],[10,55],[1,\"p\",[[0,[],0,\"Numerically calculated.\"]]],[10,56],[1,\"p\",[[0,[],0,\"The optimal amount of processes is 14.8271. A few paragraphs earlier, I wrote that it is recommended to use a value slightly lower than the number of available threads - in my case, there were 16 of them.\"]]],[1,\"h2\",[[0,[],0,\"Processes, Workers and Clusters in Node JS\"]]],[1,\"p\",[[0,[],0,\"This article focused on the processes described in the documentation under the link.\"]]],[1,\"p\",[[0,[],0,\"We showed how to create subprocesses, kill them, dynamically manage the number of subprocesses, and conduct bidirectional communication with them. In the end, we compared the scalability of password cracking with the brute force method to predictions based on universal scaling laws.\"]]],[1,\"p\",[[0,[],0,\"However, this topic was only briefly touched upon by us. I did not write anything about the clusters described here.\"]]],[1,\"p\",[[0,[],0,\"Workers, which also have a separate chapter for documentation.\"]]],[1,\"p\",[[0,[],0,\"I encourage you to read the Node JS documentation and design your own experiments independently.\"]]]],\"ghostVersion\":\"4.0\"}","html":"<p>In this post, we will learn how to create and terminate subprocesses in Node.js, and how to transmit data between them.</p><p>If a program is performing heavy computations but is not parallelized, the state of your processor may look like this:</p><figure class=\"kg-card kg-image-card\"><img src=\"https://gustawdaniel.com/content/images/2021/07/cpu0-12.png\" class=\"kg-image\" alt loading=\"lazy\"></figure><p>That's why it's worth delving into this topic regardless of the language you're writing in.</p><p>The article will be divided into 3 parts:</p><p>In the first two, we will write a script to simulate CPU core load. In the last one, we will parallelize a brute force attack on a password.</p><p>At the end, we will analyze the scalability of the written program.</p><h2 id=\"process-control-with-readline\">Process control with readline</h2><p>We want to create a program in which by pressing a key on the keyboard, we can set the number of CPU cores to be utilized. We will start by capturing keyboard events in real time.</p><p>We will be able to do this thanks to the readline module, which provides an interface for reading and writing data from streams such as the keyboard (process.stdin).</p><p>We will start with importing this module.</p><pre><code>const readline = require('readline');</code></pre><p>Next, we set up the readline event to trigger upon pressing a button on the keyboard using the command.</p><pre><code>readline.emitKeypressEvents(process.stdin);</code></pre><p>The readline function can work with various streams. This line instructs it to listen to the keyboard. We immediately set the mode to raw.</p><pre><code>process.stdin.setRawMode(true);</code></pre><p>This allows reading character by character from the keyboard with separately attached modifiers such as Ctrl or Shift. At the same time, this mode forces independent handling of the process shutdown by Ctrl+C. More information about stream modes and connecting a terminal to a process can be found in the documentation.</p><p>Meanwhile, in our program, the next lines will allow us to handle character reading:</p><pre><code>process.stdin.on('keypress', (str, key) =&gt; {\n    if (key.ctrl &amp;&amp; key.name === 'c') {\n        process.exit();\n    } else {\n        console.log('typed char', key.name);\n    }\n});</code></pre><p>The symbol saved in key is an object with the following keys.</p><pre><code>{ sequence: 'v', name: 'v', ctrl: false, meta: false, shift: false }</code></pre><p>In the presented code, we handle the closing of the process with the ctrl+c combination and printing the chosen keyboard character to the console. Typing in successive characters will always show them in the terminal.</p><figure class=\"kg-card kg-image-card\"><img src=\"https://gustawdaniel.com/content/images/2021/07/Screenshot-from-2021-07-16-18-15-24.png\" class=\"kg-image\" alt loading=\"lazy\"></figure><p>The next step is to replace typing in characters with creating or deleting processor-intensive processes.</p><h2 id=\"creating-and-terminating-processes-in-node-js\">Creating and terminating processes in Node JS</h2><p>In Node JS, we can easily create subprocesses and manage them using the child_process module. We import it just like the previous module to manage subprocesses.</p><pre><code>const cp = require('child_process');</code></pre><p>Next, we create an array to which we will be saving references to the processes that are being created.</p><pre><code>const forks = [];</code></pre><p>If we forgot about them when closing the program, they would become zombie processes - that is, ones that continue to live and consume computer resources without supervision.</p><figure class=\"kg-card kg-image-card\"><img src=\"https://gustawdaniel.com/content/images/2021/07/one-does-not-simply-kill-a-zombie-process.jpg\" class=\"kg-image\" alt loading=\"lazy\"></figure><p>To remove them before closing our script, we write the code:</p><pre><code>if (key.ctrl &amp;&amp; key.name === 'c') {\n        while (forks.length &gt; 0) {\n            forks[forks.length - 1].kill()\n            forks.pop()\n        }\n        process.exit();\n    } else {</code></pre><p>If other buttons are chosen besides 'c' in the presence of 'ctrl', we will read the numerical value of that button and, based on that value, add or kill the appropriate number of processes to make their number equal to that value.</p><pre><code>if (!Number.isNaN(parseInt(key.name,32))) {\n            const req = parseInt(key.name,32);\n\n            if (forks.length &lt; req) {\n                while (forks.length &lt; req) {\n                    const n = cp.fork(`${__dirname}/bomb.js`);\n                    forks.push(n)\n                }\n            }\n\n            if (forks.length &gt; req) {\n                while (forks.length &gt; req) {\n                    forks[forks.length - 1].kill()\n                    forks.pop()\n                }\n            }\n\n            console.log('processes PIDs', forks.map(f =&gt; f.pid));\n\n        }</code></pre><p>The choice of the base-32 numbering system may seem surprising. However, it is a convenient system if we assume that we want to indicate a number slightly exceeding 10 using only one key.</p><p>The required number of processes is assigned to the variable req, and using cp.fork or kill we create and terminate any missing or excess processes.</p><p>We only need the contents of the bomb.js file to complete the whole. It could contain any operations that consume computing power. In our case, it is missing.</p><pre><code>let result = 0;\nwhile (true) {\n    result += Math.random() * Math.random();\n}</code></pre><p>This means code written only to simulate load.</p><p>After launching the program and selecting several load options, we can see how processes are being created and deleted. Thanks to htop, we can observe how CPU usage changes during this time.</p><figure class=\"kg-card kg-image-card\"><img src=\"https://gustawdaniel.com/content/images/2021/07/Screenshot-from-2021-07-16-18-51-17.png\" class=\"kg-image\" alt loading=\"lazy\"></figure><p>BashTop has an even nicer interface for monitoring your processor, as it also displays historical usage. In the screenshot below, we can see how by modifying the number of processes in our program, I was able to simulate different levels of processor load with tasks.</p><figure class=\"kg-card kg-image-card\"><img src=\"https://gustawdaniel.com/content/images/2021/07/Screenshot-from-2021-07-16-15-26-13.png\" class=\"kg-image\" alt loading=\"lazy\"></figure><p>And what was the utilization of the cores like when I selected the option to create 16 processes?</p><figure class=\"kg-card kg-image-card\"><img src=\"https://gustawdaniel.com/content/images/2021/07/Screenshot-from-2021-07-16-15-30-03.png\" class=\"kg-image\" alt loading=\"lazy\"></figure><p>We can use this program to simulate load testing. In the bomb.js file, we can replace random number generation with operations such as sending HTTP requests or consuming other resources, such as RAM or disk space.</p><h2 id=\"parallel-brute-force-attack-on-password\">Parallel brute-force attack on password</h2><p>Different methods have been used throughout history to hash passwords. Currently, the most popular method is bcrypt, but a newer and more advanced method, argon2i, also holds a strong position. Simplifying the difference between the two, breaking bcrypt requires significant computational power, while argon can be configured to require a large amount of operational memory. With the former, it is easy to purchase large amounts of computational power, and graphics cards and streaming processors can additionally increase our password cracking capabilities. However, breaking argon requires a much greater effort to accumulate the necessary amount of operational memory on a single machine. It is worth noting that this brief overview could be expanded by reading the full article.</p><figure class=\"kg-card kg-image-card\"><img src=\"https://miro.medium.com/fit/c/152/152/1*sHhtYhaCe2Uc3IU0IgKwIQ.png\" class=\"kg-image\" alt loading=\"lazy\"></figure><p>In the following part of the post, we will show how using multiple cores speeds up the breaking of a password hashed with the bcrypt algorithm.</p><p>We will write code for generating password hash, crack it using a single core, and then we will write the same code utilizing sub-processes, to delegate the task of checking subsequent phrases.</p><h3 id=\"generating-password-hash-using-bcrypt\">Generating password hash using bcrypt</h3><p>Installation of the bcrypt package is required for this.</p><pre><code>npm init -y &amp;&amp; npm i bcrypt</code></pre><p>We will generate a password using the generate_hash.js script, which takes a password argument and writes its hash to the .pass file.</p><pre><code>const fs = require('fs')\nconst bc = require('bcrypt')\n\nconst main = async () =&gt; {\n    return bc.hash(process.argv[2] || 'pass', 11)\n}\n\nmain().then(p =&gt; {\n    fs.writeFileSync(`${__dirname}/.pass`, p);\n    console.log(p)\n}).catch(console.error);</code></pre><h3 id=\"breaking-a-password-with-the-brute-force-method-in-a-single-thread\">Breaking a password with the brute force method in a single thread</h3><p>In a brute-force attack, the key is the set of characters that we use to iterate over the sequences that we will check. We will use the standard alphabet from a to z and repeatedly generate sequences of characters to check. The process of generating and processing these sequences can be implemented using a recursive function, but this would make it difficult to control the order in which they are generated. Instead, we will use a simple queue stored in memory. This queue will not be emptied, as emptying it from the front would change the indexing within the queue, which could negatively affect performance as already discussed in the article.</p><figure class=\"kg-card kg-image-card\"><img src=\"https://gustawdaniel.com/favicon.ico\" class=\"kg-image\" alt loading=\"lazy\"></figure><p>Instead of emptying the queue, we will read values from it using a variable index that will move along it. The flowchart of the program we will write is as follows:</p><figure class=\"kg-card kg-image-card\"><img src=\"https://gustawdaniel.com/content/images/2021/07/Screenshot-from-2021-07-17-13-44-09.png\" class=\"kg-image\" alt loading=\"lazy\"></figure><p>His code is:</p><pre><code>const fs = require('fs');\nconst bc = require('bcrypt');\nconst alphabet = String.fromCharCode(...Array(123).keys()).slice(97);\nconst hash = fs.readFileSync(`${__dirname}/.pass`).toString()\nconst chalk = require('chalk')\n\nlet i = 0;\nconst s = new Date().getTime();\nconst n = () =&gt; new Date().getTime() - s;\nlet found = false;\n\nconst que = [];\n\nasync function check(input) {\n    if (found) return;\n    const r = await bc.compare(input, hash)\n\n    console.log(`${i}\\t${input}\\t${n()}\\t${r}\\t${que.length}`)\n    if (r) {\n        console.log(chalk.green(`FOUND: \"${input}\"`))\n        found = true;\n        process.exit();\n    }\n    for (let n of alphabet) {\n        que.push(input + n);\n    }\n}\n\nasync function processQue() {\n    const phrase = que[i++]\n    await check(phrase)\n}\n\nconst main = async () =&gt; {\n    while (!found) {\n        await processQue()\n    }\n}\n\nconsole.log(`i\\tinput\\tn()\\tr\\tque.length`)\ncheck('').then(() =&gt; main()).catch(console.error)</code></pre><p>The chalk package is required for the operation, which allows for easy text coloring.</p><pre><code>npm i chalk</code></pre><p>Let's test our program.</p><p>At first, we will generate a password. We'll choose \"ac\" because it's simple and we'll break it quickly.</p><pre><code>node generate_hash.js ac</code></pre><p>Next, we start our program and see how it sequentially checks passwords from the queue.</p><pre><code>time node force-single.js</code></pre><figure class=\"kg-card kg-image-card\"><img src=\"https://gustawdaniel.com/content/images/2021/07/Screenshot-from-2021-07-17-13-48-47.png\" class=\"kg-image\" alt loading=\"lazy\"></figure><p>In the columns, we have the index, the sequence being checked, the time elapsed in milliseconds since the program started, the information on whether the password matches the hash, and the current length of the queue.</p><p>If you are concerned that the queue is growing too quickly and wasting a lot of power, we can see how the program behaves after replacing the line.</p><pre><code>const r = await bc.compare(input, hash)</code></pre><p>\"Aby uzyskać najlepszy efekt, należy stosować ten produkt regularnie, zwykle dwa razy dziennie po umyciu twarzy. Nałożyć na skórę delikatnie, unikając okolic wokół oczu.\" \"To achieve the best effect, it is recommended to use this product regularly, typically twice daily after washing your face. Apply gently onto the skin, avoiding the eye area.\"</p><pre><code>const r = i &gt;= 29 // await bc.compare(input, hash)</code></pre><p>It will turn out that the script execution time will decrease from 7.27 seconds to 0.17 seconds.</p><pre><code>node force-single.js  0.17s user 0.03s system 103% cpu 0.188 total</code></pre><p>\"What it means is that only 2.3% of computing power is being allocated to operations other than just comparing passwords.\"</p><h3 id=\"using-sub-processes-to-increase-efficiency\">Using sub-processes to increase efficiency</h3><p>Because checking the compatibility of a password and a hash is a processor-intensive operation, we expect a significant improvement in performance for this task if we use multiple cores simultaneously. Therefore, we will rewrite our program so that the main process handles the queue and assigns the task of checking passwords to subordinate processes.</p><figure class=\"kg-card kg-image-card\"><img src=\"https://gustawdaniel.com/content/images/2021/07/bFbMbDgAT6M6T4zsVmk16Oiip7vIOWaeuEY0vTkkZoU.png\" class=\"kg-image\" alt loading=\"lazy\"></figure><p>Our program structure is divided into a main thread and sub processes. In the main thread, a list of sub processes, a queue, and a listener for messages from sub processes are created. Ultimately, each sub process is assigned a task from the queue to execute. After executing a task, a sub process reports back to the main thread with a response. The main thread then increments the index and assigns the sub process a new task. This process continues until a correct password is found.</p><figure class=\"kg-card kg-image-card\"><img src=\"https://gustawdaniel.com/content/images/2021/07/Screenshot-from-2021-07-17-14-16-35.png\" class=\"kg-image\" alt loading=\"lazy\"></figure><p>It is worth noting that independent children will complete tasks at different speeds, which will affect the order of their response submissions. An exemplary output of the program is:</p><figure class=\"kg-card kg-image-card\"><img src=\"https://gustawdaniel.com/content/images/2021/07/Screenshot-from-2021-07-17-14-26-11.png\" class=\"kg-image\" alt loading=\"lazy\"></figure><p>The code is divided into two files:</p><p>We will begin the analysis of the main process - force-child.js. The program starts by defining the alphabet and auxiliary variables for indexing and counting time.</p><pre><code>const cp = require('child_process');\nconst fs = require('fs');\nconst chalk = require('chalk')\n\nconst alphabet = String.fromCharCode(...Array(123).keys()).slice(97);\nconst forks = [];\n\nlet i = 0;\nconst s = new Date().getTime();\nconst n = () =&gt; new Date().getTime() - s;\nlet found = false;</code></pre><p>Next, we fill the queue with the alphabet.</p><pre><code>const que = alphabet.split('');</code></pre><p>In the single-threaded version of the program, the check function received a phrase, checked it, and expanded the queue. This time, in addition to the phrase, the argument for the selected subprocess to perform the check will be \"f\". Instead of using bcrypt directly, we will send a request to the subprocess to process the phrase and expand the queue.</p><pre><code>function check(input, f) {\n    if (found) return;\n\n    f.send(input);\n\n    for (let n of alphabet) {\n        que.push(input + n);\n    }\n}</code></pre><p>We have eliminated the word \"async\" here, so we do not have to wait for the execution of this function. This is a simple task delegation. The key element of this code is sending a message to the subprocess, which is done by the \"send\" function directly on the subprocess.</p><p>The next function, processQue, serves us to perform a single clock cycle on the queue.</p><pre><code>function processQue(f) {\n    const phrase = que[i++]\n    check(phrase, f)\n}</code></pre><p>It is very short and its main task is to prevent duplication of the logic responsible for iterating through the queue.</p><p>The main function is the program's primary function responsible for setting up listeners for responses from subprocesses and assigning them initial tasks that allow them to enter a loop of communication between them.</p><pre><code>const main = async () =&gt; {\n    forks.forEach(f =&gt; {\n        f.on('message', ({input, r}) =&gt; {\n            console.log(`${i}\\t${input}\\t${n()}\\t${r}\\t${que.length}\\t${f.pid}`)\n\n            if (r) {\n                console.log(chalk.green(`FOUND: \"${input}\"`))\n                found = true;\n\n                fs.appendFileSync('logs.txt', `${forks.length},${n()}\\n`)\n\n                while (forks.length &gt; 0) {\n                    forks[forks.length - 1].kill()\n                    forks.pop()\n                }\n\n                process.exit();\n            } else {\n                processQue(f);\n            }\n        });\n        processQue(f);\n    })\n}</code></pre><p>Before we call the main function, it is necessary to create processes in the forks array.</p><pre><code>while (forks.length &lt; (process.argv[2] || 15)) {\n    const n = cp.fork(`${__dirname}/force-fork.js`);\n    forks.push(n)\n}</code></pre><p>The recommended number of them is a value close to the number of processor threads but smaller than it, so that the main process is not blocked.</p><p>At the end, we print information about the program, column names, and start the main function.</p><pre><code>console.log(chalk.blue(`Run using ${forks.length} child processes`))\nconsole.log(`i\\tinput\\tn()\\tr\\tque.length\\tpid`)\nmain().catch(console.error)</code></pre><p>The second file - force-fork.js is much simpler and contains only reading the hash and waiting for tasks. When it receives them, it tests the hashed password using bcrypt and then sends the result back through the same communication channel.</p><pre><code>const fs = require('fs');\nconst bc = require('bcrypt');\n\nconst hash = fs.readFileSync(`${__dirname}/.pass`).toString()\n\nprocess.on('message', (input) =&gt; {\n    bc.compare(input, hash).then((r) =&gt; {\n        process.send({r, input});\n    })\n});</code></pre><h2 id=\"scalowalno%C5%9B%C4%87-odnosi-si%C4%99-do-zdolno%C5%9Bci-systemu-aplikacji-lub-procesu-do-utrzymania-lub-zwi%C4%99kszenia-swojej-wydajno%C5%9Bci-wraz-ze-wzrostem-liczby-u%C5%BCytkownik%C3%B3w-rozmiaru-danych-lub-innych-czynnik%C3%B3w-wp%C5%82ywaj%C4%85cych-na-jego-pojemno%C5%9B%C4%87-analiza-skalowalno%C5%9Bci-ma-na-celu-zbadanie-jak-dobrze-dana-aplikacja-czy-system-skaluje-si%C4%99-w-odpowiedzi-na-zwi%C4%99kszenie-wymaga%C5%84-u%C5%BCytkownik%C3%B3w-lub-innych-czynnik%C3%B3w-takich-jak-obci%C4%85%C5%BCenie-procesora-dost%C4%99p-do-pami%C4%99ci-przepustowo%C5%9B%C4%87-sieci-itp\">Scalowalność odnosi się do zdolności systemu, aplikacji lub procesu do utrzymania lub zwiększenia swojej wydajności wraz ze wzrostem liczby użytkowników, rozmiaru danych lub innych czynników wpływających na jego pojemność. Analiza skalowalności ma na celu zbadanie, jak dobrze dana aplikacja czy system skaluje się w odpowiedzi na zwiększenie wymagań użytkowników lub innych czynników, takich jak obciążenie procesora, dostęp do pamięci, przepustowość sieci itp.</h2><p>An attentive reader probably noticed a small but important line of code for the rest of the article:</p><pre><code>fs.appendFileSync('logs.txt', `${forks.length},${n()}\\n`)</code></pre><p>It is performed after finding the password and it attaches the number of sub-processes and the time of finding the password to the logs.txt file. The data for this file was provided by executing a double loop in bash.</p><pre><code>for j in $(seq 1 20); do for i in $(seq 1 25); do time node force-child.js $i; sleep 4; done; done;</code></pre><p>And later expanding these results to a higher number of processes.</p><pre><code>for j in $(seq 1 5); do for i in $(seq 1 50); do time node force-child.js $i; sleep 4; done; done;</code></pre><p>According to the General Law of Scaling, we expect a performance increase up to a certain point (around 15 cores), followed by a decrease due to delays caused by mutual blocking of sub-processes.</p><h3 id=\"universal-law-of-scaling\">Universal law of scaling</h3><p>If you haven't heard of the universal scaling law, I will introduce you to the topic quickly. It means that in an ideal world, if systems were linearly scalable, adding n times more resources would increase the system's performance or throughput by n times. This situation can be illustrated by the diagram:</p><figure class=\"kg-card kg-image-card\"><img src=\"https://gustawdaniel.com/content/images/2021/07/Screenshot-from-2021-07-17-14-56-29.png\" class=\"kg-image\" alt loading=\"lazy\"></figure><p>However, such situations are not encountered in the real world. There is always some inefficiency associated with assigning data to nodes (servers or threads) and collecting them. Delays related to data assignment and retrieval are called serialization. Sometimes the term contention is used.</p><figure class=\"kg-card kg-image-card\"><img src=\"https://gustawdaniel.com/content/images/2021/07/Screenshot-from-2021-07-17-14-56-40.png\" class=\"kg-image\" alt loading=\"lazy\"></figure><p>Taking this phenomenon into account leads to the Amdahl's Model. However, it turns out that it is insufficient for most IT systems because it completely overlooks the second major factor limiting scaling - inter-process communication, or crosstalk. It can be graphically represented as follows:</p><figure class=\"kg-card kg-image-card\"><img src=\"https://gustawdaniel.com/content/images/2021/07/Screenshot-from-2021-07-17-14-56-46.png\" class=\"kg-image\" alt loading=\"lazy\"></figure><p>If serialization has a cost proportional to the number of nodes, then communication is proportional to their square - just like the number of diagonals of a polygon is proportional to the number of its angles.</p><figure class=\"kg-card kg-image-card\"><img src=\"https://gustawdaniel.com/content/images/2021/07/Screenshot-from-2021-07-17-14-56-51.png\" class=\"kg-image\" alt loading=\"lazy\"></figure><p>On the graph, we can see curves comparing the impact of the number of nodes on system performance according to these three models.</p><figure class=\"kg-card kg-image-card\"><img src=\"https://gustawdaniel.com/content/images/2021/07/usl.svg\" class=\"kg-image\" alt loading=\"lazy\"></figure><p>A good (50-page) study on this topic can be found at the link:</p><p>Please find the translation below: https://cdn2.hubspot.net/hubfs/498921/eBooks/scalability_new.pdf</p><h3 id=\"compilation-of-measurement-data-with-the-usl-model\">Compilation of measurement data with the USL model</h3><p>The collected data consists of the number of threads and execution times of the program. We load it into the Mathematica program using the command:</p><pre><code>load = Import[\"/home/daniel/exp/node/logs.txt\", \"Data\"];</code></pre><p>Because we want to consider efficiency rather than time, we reverse the second column with the command.</p><pre><code>loadEff = {#[[1]], 1/#[[2]]} &amp; /@ load;</code></pre><p>\"The most sensible unit is normalization with respect to the execution time for one subprocess. This will allow us to see the gain from adding additional processes. We calculate the average of these times using the command.\"</p><pre><code>firstMean = GroupBy[loadEff // N, First -&gt; Last, Mean][[1]];</code></pre><p>Next, we adjust the model:</p><pre><code>nlm = NonlinearModelFit[{#[[1]], #[[2]]/firstMean} &amp; /@ \n   loadEff, \\[Lambda] n/(1 + \\[Sigma] (n - 1) + \\[Kappa] n (n - \n         1)), {{\\[Lambda], 0.9}, {\\[Sigma], 0.9}, {\\[Kappa], \n    0.1}}, {n}]</code></pre><p>And we compare it with a graph of the list of measurement points.</p><pre><code>Show[ListPlot[{#[[1]], #[[2]]/firstMean} &amp; /@ loadEff], \n Plot[nlm[s], {s, 0, 50}, PlotStyle -&gt; Orange, PlotRange -&gt; All], \n AxesLabel -&gt; {\"processes\", \"gain of efficiency\"}, ImageSize -&gt; Large,\n  PlotLabel -&gt; \"Gain of efficiency relative to single process\"]</code></pre><figure class=\"kg-card kg-image-card\"><img src=\"https://gustawdaniel.com/content/images/2021/07/gain-eff.svg\" class=\"kg-image\" alt loading=\"lazy\"></figure><p>It is worth showing a very nice example of theoretical maximum here.</p><pre><code>Solve[D[\\[Lambda] n/(1 + \\[Sigma] (n - 1) + \\[Kappa] n (n - 1)), \n   n] == 0, n]</code></pre><figure class=\"kg-card kg-image-card\"><img src=\"https://gustawdaniel.com/content/images/2021/07/Screenshot-from-2021-07-17-15-21-22.png\" class=\"kg-image\" alt loading=\"lazy\"></figure><p>Numerically calculated.</p><pre><code>NSolve[D[Normal[nlm], n] == 0, n]</code></pre><p>The optimal amount of processes is 14.8271. A few paragraphs earlier, I wrote that it is recommended to use a value slightly lower than the number of available threads - in my case, there were 16 of them.</p><h2 id=\"processes-workers-and-clusters-in-node-js\">Processes, Workers and Clusters in Node JS</h2><p>This article focused on the processes described in the documentation under the link.</p><p>We showed how to create subprocesses, kill them, dynamically manage the number of subprocesses, and conduct bidirectional communication with them. In the end, we compared the scalability of password cracking with the brute force method to predictions based on universal scaling laws.</p><p>However, this topic was only briefly touched upon by us. I did not write anything about the clusters described here.</p><p>Workers, which also have a separate chapter for documentation.</p><p>I encourage you to read the Node JS documentation and design your own experiments independently.</p>","comment_id":"642d42f599d7a498d8917d76","plaintext":"In this post, we will learn how to create and terminate subprocesses in Node.js, and how to transmit data between them.\n\nIf a program is performing heavy computations but is not parallelized, the state of your processor may look like this:\n\nThat's why it's worth delving into this topic regardless of the language you're writing in.\n\nThe article will be divided into 3 parts:\n\nIn the first two, we will write a script to simulate CPU core load. In the last one, we will parallelize a brute force attack on a password.\n\nAt the end, we will analyze the scalability of the written program.\n\n\nProcess control with readline\n\nWe want to create a program in which by pressing a key on the keyboard, we can set the number of CPU cores to be utilized. We will start by capturing keyboard events in real time.\n\nWe will be able to do this thanks to the readline module, which provides an interface for reading and writing data from streams such as the keyboard (process.stdin).\n\nWe will start with importing this module.\n\nconst readline = require('readline');\n\nNext, we set up the readline event to trigger upon pressing a button on the keyboard using the command.\n\nreadline.emitKeypressEvents(process.stdin);\n\nThe readline function can work with various streams. This line instructs it to listen to the keyboard. We immediately set the mode to raw.\n\nprocess.stdin.setRawMode(true);\n\nThis allows reading character by character from the keyboard with separately attached modifiers such as Ctrl or Shift. At the same time, this mode forces independent handling of the process shutdown by Ctrl+C. More information about stream modes and connecting a terminal to a process can be found in the documentation.\n\nMeanwhile, in our program, the next lines will allow us to handle character reading:\n\nprocess.stdin.on('keypress', (str, key) => {\n    if (key.ctrl && key.name === 'c') {\n        process.exit();\n    } else {\n        console.log('typed char', key.name);\n    }\n});\n\nThe symbol saved in key is an object with the following keys.\n\n{ sequence: 'v', name: 'v', ctrl: false, meta: false, shift: false }\n\nIn the presented code, we handle the closing of the process with the ctrl+c combination and printing the chosen keyboard character to the console. Typing in successive characters will always show them in the terminal.\n\nThe next step is to replace typing in characters with creating or deleting processor-intensive processes.\n\n\nCreating and terminating processes in Node JS\n\nIn Node JS, we can easily create subprocesses and manage them using the child_process module. We import it just like the previous module to manage subprocesses.\n\nconst cp = require('child_process');\n\nNext, we create an array to which we will be saving references to the processes that are being created.\n\nconst forks = [];\n\nIf we forgot about them when closing the program, they would become zombie processes - that is, ones that continue to live and consume computer resources without supervision.\n\nTo remove them before closing our script, we write the code:\n\nif (key.ctrl && key.name === 'c') {\n        while (forks.length > 0) {\n            forks[forks.length - 1].kill()\n            forks.pop()\n        }\n        process.exit();\n    } else {\n\nIf other buttons are chosen besides 'c' in the presence of 'ctrl', we will read the numerical value of that button and, based on that value, add or kill the appropriate number of processes to make their number equal to that value.\n\nif (!Number.isNaN(parseInt(key.name,32))) {\n            const req = parseInt(key.name,32);\n\n            if (forks.length < req) {\n                while (forks.length < req) {\n                    const n = cp.fork(`${__dirname}/bomb.js`);\n                    forks.push(n)\n                }\n            }\n\n            if (forks.length > req) {\n                while (forks.length > req) {\n                    forks[forks.length - 1].kill()\n                    forks.pop()\n                }\n            }\n\n            console.log('processes PIDs', forks.map(f => f.pid));\n\n        }\n\nThe choice of the base-32 numbering system may seem surprising. However, it is a convenient system if we assume that we want to indicate a number slightly exceeding 10 using only one key.\n\nThe required number of processes is assigned to the variable req, and using cp.fork or kill we create and terminate any missing or excess processes.\n\nWe only need the contents of the bomb.js file to complete the whole. It could contain any operations that consume computing power. In our case, it is missing.\n\nlet result = 0;\nwhile (true) {\n    result += Math.random() * Math.random();\n}\n\nThis means code written only to simulate load.\n\nAfter launching the program and selecting several load options, we can see how processes are being created and deleted. Thanks to htop, we can observe how CPU usage changes during this time.\n\nBashTop has an even nicer interface for monitoring your processor, as it also displays historical usage. In the screenshot below, we can see how by modifying the number of processes in our program, I was able to simulate different levels of processor load with tasks.\n\nAnd what was the utilization of the cores like when I selected the option to create 16 processes?\n\nWe can use this program to simulate load testing. In the bomb.js file, we can replace random number generation with operations such as sending HTTP requests or consuming other resources, such as RAM or disk space.\n\n\nParallel brute-force attack on password\n\nDifferent methods have been used throughout history to hash passwords. Currently, the most popular method is bcrypt, but a newer and more advanced method, argon2i, also holds a strong position. Simplifying the difference between the two, breaking bcrypt requires significant computational power, while argon can be configured to require a large amount of operational memory. With the former, it is easy to purchase large amounts of computational power, and graphics cards and streaming processors can additionally increase our password cracking capabilities. However, breaking argon requires a much greater effort to accumulate the necessary amount of operational memory on a single machine. It is worth noting that this brief overview could be expanded by reading the full article.\n\nIn the following part of the post, we will show how using multiple cores speeds up the breaking of a password hashed with the bcrypt algorithm.\n\nWe will write code for generating password hash, crack it using a single core, and then we will write the same code utilizing sub-processes, to delegate the task of checking subsequent phrases.\n\n\nGenerating password hash using bcrypt\n\nInstallation of the bcrypt package is required for this.\n\nnpm init -y && npm i bcrypt\n\nWe will generate a password using the generate_hash.js script, which takes a password argument and writes its hash to the .pass file.\n\nconst fs = require('fs')\nconst bc = require('bcrypt')\n\nconst main = async () => {\n    return bc.hash(process.argv[2] || 'pass', 11)\n}\n\nmain().then(p => {\n    fs.writeFileSync(`${__dirname}/.pass`, p);\n    console.log(p)\n}).catch(console.error);\n\n\nBreaking a password with the brute force method in a single thread\n\nIn a brute-force attack, the key is the set of characters that we use to iterate over the sequences that we will check. We will use the standard alphabet from a to z and repeatedly generate sequences of characters to check. The process of generating and processing these sequences can be implemented using a recursive function, but this would make it difficult to control the order in which they are generated. Instead, we will use a simple queue stored in memory. This queue will not be emptied, as emptying it from the front would change the indexing within the queue, which could negatively affect performance as already discussed in the article.\n\nInstead of emptying the queue, we will read values from it using a variable index that will move along it. The flowchart of the program we will write is as follows:\n\nHis code is:\n\nconst fs = require('fs');\nconst bc = require('bcrypt');\nconst alphabet = String.fromCharCode(...Array(123).keys()).slice(97);\nconst hash = fs.readFileSync(`${__dirname}/.pass`).toString()\nconst chalk = require('chalk')\n\nlet i = 0;\nconst s = new Date().getTime();\nconst n = () => new Date().getTime() - s;\nlet found = false;\n\nconst que = [];\n\nasync function check(input) {\n    if (found) return;\n    const r = await bc.compare(input, hash)\n\n    console.log(`${i}\\t${input}\\t${n()}\\t${r}\\t${que.length}`)\n    if (r) {\n        console.log(chalk.green(`FOUND: \"${input}\"`))\n        found = true;\n        process.exit();\n    }\n    for (let n of alphabet) {\n        que.push(input + n);\n    }\n}\n\nasync function processQue() {\n    const phrase = que[i++]\n    await check(phrase)\n}\n\nconst main = async () => {\n    while (!found) {\n        await processQue()\n    }\n}\n\nconsole.log(`i\\tinput\\tn()\\tr\\tque.length`)\ncheck('').then(() => main()).catch(console.error)\n\nThe chalk package is required for the operation, which allows for easy text coloring.\n\nnpm i chalk\n\nLet's test our program.\n\nAt first, we will generate a password. We'll choose \"ac\" because it's simple and we'll break it quickly.\n\nnode generate_hash.js ac\n\nNext, we start our program and see how it sequentially checks passwords from the queue.\n\ntime node force-single.js\n\nIn the columns, we have the index, the sequence being checked, the time elapsed in milliseconds since the program started, the information on whether the password matches the hash, and the current length of the queue.\n\nIf you are concerned that the queue is growing too quickly and wasting a lot of power, we can see how the program behaves after replacing the line.\n\nconst r = await bc.compare(input, hash)\n\n\"Aby uzyskać najlepszy efekt, należy stosować ten produkt regularnie, zwykle dwa razy dziennie po umyciu twarzy. Nałożyć na skórę delikatnie, unikając okolic wokół oczu.\" \"To achieve the best effect, it is recommended to use this product regularly, typically twice daily after washing your face. Apply gently onto the skin, avoiding the eye area.\"\n\nconst r = i >= 29 // await bc.compare(input, hash)\n\nIt will turn out that the script execution time will decrease from 7.27 seconds to 0.17 seconds.\n\nnode force-single.js  0.17s user 0.03s system 103% cpu 0.188 total\n\n\"What it means is that only 2.3% of computing power is being allocated to operations other than just comparing passwords.\"\n\n\nUsing sub-processes to increase efficiency\n\nBecause checking the compatibility of a password and a hash is a processor-intensive operation, we expect a significant improvement in performance for this task if we use multiple cores simultaneously. Therefore, we will rewrite our program so that the main process handles the queue and assigns the task of checking passwords to subordinate processes.\n\nOur program structure is divided into a main thread and sub processes. In the main thread, a list of sub processes, a queue, and a listener for messages from sub processes are created. Ultimately, each sub process is assigned a task from the queue to execute. After executing a task, a sub process reports back to the main thread with a response. The main thread then increments the index and assigns the sub process a new task. This process continues until a correct password is found.\n\nIt is worth noting that independent children will complete tasks at different speeds, which will affect the order of their response submissions. An exemplary output of the program is:\n\nThe code is divided into two files:\n\nWe will begin the analysis of the main process - force-child.js. The program starts by defining the alphabet and auxiliary variables for indexing and counting time.\n\nconst cp = require('child_process');\nconst fs = require('fs');\nconst chalk = require('chalk')\n\nconst alphabet = String.fromCharCode(...Array(123).keys()).slice(97);\nconst forks = [];\n\nlet i = 0;\nconst s = new Date().getTime();\nconst n = () => new Date().getTime() - s;\nlet found = false;\n\nNext, we fill the queue with the alphabet.\n\nconst que = alphabet.split('');\n\nIn the single-threaded version of the program, the check function received a phrase, checked it, and expanded the queue. This time, in addition to the phrase, the argument for the selected subprocess to perform the check will be \"f\". Instead of using bcrypt directly, we will send a request to the subprocess to process the phrase and expand the queue.\n\nfunction check(input, f) {\n    if (found) return;\n\n    f.send(input);\n\n    for (let n of alphabet) {\n        que.push(input + n);\n    }\n}\n\nWe have eliminated the word \"async\" here, so we do not have to wait for the execution of this function. This is a simple task delegation. The key element of this code is sending a message to the subprocess, which is done by the \"send\" function directly on the subprocess.\n\nThe next function, processQue, serves us to perform a single clock cycle on the queue.\n\nfunction processQue(f) {\n    const phrase = que[i++]\n    check(phrase, f)\n}\n\nIt is very short and its main task is to prevent duplication of the logic responsible for iterating through the queue.\n\nThe main function is the program's primary function responsible for setting up listeners for responses from subprocesses and assigning them initial tasks that allow them to enter a loop of communication between them.\n\nconst main = async () => {\n    forks.forEach(f => {\n        f.on('message', ({input, r}) => {\n            console.log(`${i}\\t${input}\\t${n()}\\t${r}\\t${que.length}\\t${f.pid}`)\n\n            if (r) {\n                console.log(chalk.green(`FOUND: \"${input}\"`))\n                found = true;\n\n                fs.appendFileSync('logs.txt', `${forks.length},${n()}\\n`)\n\n                while (forks.length > 0) {\n                    forks[forks.length - 1].kill()\n                    forks.pop()\n                }\n\n                process.exit();\n            } else {\n                processQue(f);\n            }\n        });\n        processQue(f);\n    })\n}\n\nBefore we call the main function, it is necessary to create processes in the forks array.\n\nwhile (forks.length < (process.argv[2] || 15)) {\n    const n = cp.fork(`${__dirname}/force-fork.js`);\n    forks.push(n)\n}\n\nThe recommended number of them is a value close to the number of processor threads but smaller than it, so that the main process is not blocked.\n\nAt the end, we print information about the program, column names, and start the main function.\n\nconsole.log(chalk.blue(`Run using ${forks.length} child processes`))\nconsole.log(`i\\tinput\\tn()\\tr\\tque.length\\tpid`)\nmain().catch(console.error)\n\nThe second file - force-fork.js is much simpler and contains only reading the hash and waiting for tasks. When it receives them, it tests the hashed password using bcrypt and then sends the result back through the same communication channel.\n\nconst fs = require('fs');\nconst bc = require('bcrypt');\n\nconst hash = fs.readFileSync(`${__dirname}/.pass`).toString()\n\nprocess.on('message', (input) => {\n    bc.compare(input, hash).then((r) => {\n        process.send({r, input});\n    })\n});\n\n\nScalowalność odnosi się do zdolności systemu, aplikacji lub procesu do utrzymania lub zwiększenia swojej wydajności wraz ze wzrostem liczby użytkowników, rozmiaru danych lub innych czynników wpływających na jego pojemność. Analiza skalowalności ma na celu zbadanie, jak dobrze dana aplikacja czy system skaluje się w odpowiedzi na zwiększenie wymagań użytkowników lub innych czynników, takich jak obciążenie procesora, dostęp do pamięci, przepustowość sieci itp.\n\nAn attentive reader probably noticed a small but important line of code for the rest of the article:\n\nfs.appendFileSync('logs.txt', `${forks.length},${n()}\\n`)\n\nIt is performed after finding the password and it attaches the number of sub-processes and the time of finding the password to the logs.txt file. The data for this file was provided by executing a double loop in bash.\n\nfor j in $(seq 1 20); do for i in $(seq 1 25); do time node force-child.js $i; sleep 4; done; done;\n\nAnd later expanding these results to a higher number of processes.\n\nfor j in $(seq 1 5); do for i in $(seq 1 50); do time node force-child.js $i; sleep 4; done; done;\n\nAccording to the General Law of Scaling, we expect a performance increase up to a certain point (around 15 cores), followed by a decrease due to delays caused by mutual blocking of sub-processes.\n\n\nUniversal law of scaling\n\nIf you haven't heard of the universal scaling law, I will introduce you to the topic quickly. It means that in an ideal world, if systems were linearly scalable, adding n times more resources would increase the system's performance or throughput by n times. This situation can be illustrated by the diagram:\n\nHowever, such situations are not encountered in the real world. There is always some inefficiency associated with assigning data to nodes (servers or threads) and collecting them. Delays related to data assignment and retrieval are called serialization. Sometimes the term contention is used.\n\nTaking this phenomenon into account leads to the Amdahl's Model. However, it turns out that it is insufficient for most IT systems because it completely overlooks the second major factor limiting scaling - inter-process communication, or crosstalk. It can be graphically represented as follows:\n\nIf serialization has a cost proportional to the number of nodes, then communication is proportional to their square - just like the number of diagonals of a polygon is proportional to the number of its angles.\n\nOn the graph, we can see curves comparing the impact of the number of nodes on system performance according to these three models.\n\nA good (50-page) study on this topic can be found at the link:\n\nPlease find the translation below: https://cdn2.hubspot.net/hubfs/498921/eBooks/scalability_new.pdf\n\n\nCompilation of measurement data with the USL model\n\nThe collected data consists of the number of threads and execution times of the program. We load it into the Mathematica program using the command:\n\nload = Import[\"/home/daniel/exp/node/logs.txt\", \"Data\"];\n\nBecause we want to consider efficiency rather than time, we reverse the second column with the command.\n\nloadEff = {#[[1]], 1/#[[2]]} & /@ load;\n\n\"The most sensible unit is normalization with respect to the execution time for one subprocess. This will allow us to see the gain from adding additional processes. We calculate the average of these times using the command.\"\n\nfirstMean = GroupBy[loadEff // N, First -> Last, Mean][[1]];\n\nNext, we adjust the model:\n\nnlm = NonlinearModelFit[{#[[1]], #[[2]]/firstMean} & /@ \n   loadEff, \\[Lambda] n/(1 + \\[Sigma] (n - 1) + \\[Kappa] n (n - \n         1)), {{\\[Lambda], 0.9}, {\\[Sigma], 0.9}, {\\[Kappa], \n    0.1}}, {n}]\n\nAnd we compare it with a graph of the list of measurement points.\n\nShow[ListPlot[{#[[1]], #[[2]]/firstMean} & /@ loadEff], \n Plot[nlm[s], {s, 0, 50}, PlotStyle -> Orange, PlotRange -> All], \n AxesLabel -> {\"processes\", \"gain of efficiency\"}, ImageSize -> Large,\n  PlotLabel -> \"Gain of efficiency relative to single process\"]\n\nIt is worth showing a very nice example of theoretical maximum here.\n\nSolve[D[\\[Lambda] n/(1 + \\[Sigma] (n - 1) + \\[Kappa] n (n - 1)), \n   n] == 0, n]\n\nNumerically calculated.\n\nNSolve[D[Normal[nlm], n] == 0, n]\n\nThe optimal amount of processes is 14.8271. A few paragraphs earlier, I wrote that it is recommended to use a value slightly lower than the number of available threads - in my case, there were 16 of them.\n\n\nProcesses, Workers and Clusters in Node JS\n\nThis article focused on the processes described in the documentation under the link.\n\nWe showed how to create subprocesses, kill them, dynamically manage the number of subprocesses, and conduct bidirectional communication with them. In the end, we compared the scalability of password cracking with the brute force method to predictions based on universal scaling laws.\n\nHowever, this topic was only briefly touched upon by us. I did not write anything about the clusters described here.\n\nWorkers, which also have a separate chapter for documentation.\n\nI encourage you to read the Node JS documentation and design your own experiments independently.","feature_image":null,"featured":0,"type":"post","status":"draft","locale":null,"visibility":"public","email_recipient_filter":"all","created_at":"2023-04-05T09:44:21.000Z","updated_at":"2023-04-05T09:44:58.000Z","published_at":"2023-04-05T09:44:19.000Z","custom_excerpt":null,"codeinjection_head":null,"codeinjection_foot":null,"custom_template":null,"canonical_url":null,"newsletter_id":null,"lexical":null},{"id":"642e545bc61a14d8a5114967","uuid":"e3e43919-1d27-486f-9345-bafd87b4a556","title":"Test Article","slug":"test-article","mobiledoc":"{\"version\":\"0.3.1\",\"atoms\":[],\"cards\":[[\"image\",{\"src\":\"__GHOST_URL__/content/images/2023/04/fdfs19-800x533.jpg\",\"width\":800,\"height\":533}],[\"code\",{\"code\":\"print(1+1)\",\"language\":\"python\"}],[\"bookmark\",{\"version\":\"1.0\",\"type\":\"bookmark\",\"url\":\"https://gustawdaniel.com/prawo-zipfa-w-nodejs/\",\"metadata\":{\"url\":\"https://gustawdaniel.com/prawo-zipfa-w-nodejs/\",\"title\":\"Analiza Prawa Zipfa w Node.js\",\"description\":\"Naucz się jak odczytywać duże pliki w Node.js, zliczać wystąpienia słów używając obiektu Map oraz radzić sobie z limitami pamięci.\",\"author\":\"Daniel Gustaw\",\"publisher\":\"Daniel Gustaw\",\"thumbnail\":\"https://gustawdaniel.com/content/images/2022/06/photo-1605429201125-37e867327609.jpeg\",\"icon\":\"https://gustawdaniel.com/favicon.ico\"}}],[\"bookmark\",{\"version\":\"1.0\",\"type\":\"bookmark\",\"url\":\"https://nodejs.org/api/url.html#urlhash\",\"metadata\":{\"url\":\"https://nodejs.org/api/url.html\",\"title\":\"URL | Node.js v19.8.1 Documentation\",\"description\":null,\"author\":null,\"publisher\":\"Node.js v19.8.1 Documentation\",\"thumbnail\":null,\"icon\":\"https://nodejs.org/favicon.ico\"}}],[\"html\",{\"html\":\"  \\\\begin{align}             \\n    \\\\vec{\\\\nabla} \\\\cdot \\\\vec{E} \\\\quad &=\\\\quad\\\\frac{\\\\rho}{\\\\epsilon_0} &&\\\\text{Gauss's Law} \\\\\\\\      \\n    \\\\vec{\\\\nabla} \\\\cdot \\\\vec{B} \\\\quad &=\\\\quad 0 &&\\\\text{Gauss's Law for Magnetism}\\\\\\\\\\n    \\\\vec{\\\\nabla} \\\\times \\\\vec{E} \\\\quad &=\\\\hspace{10pt}-\\\\frac{\\\\partial{\\\\vec{B}}}{\\\\partial{t}} &&\\\\text{Faraday's Law of Induction} \\\\\\\\ \\n    \\\\vec{\\\\nabla} \\\\times \\\\vec{B} \\\\quad &=\\\\quad \\\\mu_0\\\\left( \\\\epsilon_0\\\\frac{\\\\partial{\\\\vec{E}}}{\\\\partial{t}}+\\\\vec{J}\\\\right) &&\\\\text{Ampere's Circuital Law}\\n    \\\\end{align} \"}],[\"markdown\",{\"markdown\":\"| show me graphic card                                                               | lspci -k \\\\| grep -A 2 -E \\\"(VGA\\\\|3D)\\\"                                        |\\n|------------------------------------------------------------------------------------|-----------------------------------------------------------------------------|\\n| jq command that join package name and version by dash                              | jq '.name + \\\"-\\\" + .version'                                                 |\\n| three processes with highest ram usage                                             | ps aux --sort=-%mem \\\\| head -n 4                                            |\\n| make backup of mysql db called docs                                                | mysqldump docs > docs_backup.sql                                            |\\n| setup jest configured for typescript                                               | npm install --save-dev jest @types/jest ts-jest                             |\\n| generate ed keys                                                                   | openssl genpkey -algorithm ed25519 -out privatekey.key                      |\\n| show me content of Cargo.toml encoded as base64                                    | base64 Cargo.toml                                                           |\\n| show me content of Cargo.toml encoded as base64 in single line                     | cat Cargo.toml \\\\| base64 -w 0                                               |\\n| show timer that will update every second                                           | watch -n 1 date +%T                                                         |\\n| range from 10 to 15                                                                | seq 10 15                                                                   |\\n| replace all lines starting from \\\"CFG_\\\" to starting from \\\"CONFIG_\\\" in file env.conf | sed -i 's/^CFG_/CONFIG_/g' env.conf                                         |\\n| write one liner to detect emails in file                                           | grep -Eio '\\\\b[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\\\\.[A-Z\\\\|a-z]{2,}\\\\b' filename   |\\n| cron line to execute /bin/task every monday at 7pm                                 | 0 19 * * 1 /bin/task                                                        |\\n| run rusts tests one by one                                                         | cargo test -- --test-threads=1                                              |\\n| who i am and am i still needed                                                     | whoami and yes, you are still needed. <-- hahah it is authentic gpt3 answer |\"}],[\"gallery\",{\"images\":[{\"fileName\":\"fixed.png\",\"row\":0,\"width\":1071,\"height\":507,\"src\":\"__GHOST_URL__/content/images/2023/04/fixed.png\"},{\"fileName\":\"test.png\",\"row\":0,\"width\":445,\"height\":53,\"src\":\"__GHOST_URL__/content/images/2023/04/test.png\"}]}],[\"email-cta\",{\"showButton\":false,\"showDividers\":true,\"segment\":\"status:free\",\"alignment\":\"left\",\"html\":\"<p>test</p>\"}],[\"hr\",{}],[\"callout\",{\"calloutEmoji\":\"💡\",\"calloutText\":\"callout 1\",\"backgroundColor\":\"grey\"}],[\"toggle\",{\"heading\":\"Toggle collapsible\",\"content\":\"<p>Content collapsible</p>\"}],[\"file\",{\"loop\":false,\"src\":\"__GHOST_URL__/content/files/2023/04/logo-color.svg\",\"fileName\":\"logo-color.svg\",\"fileTitle\":\"Logo color\",\"fileCaption\":\"\",\"fileSize\":19178}],[\"product\",{\"productButtonEnabled\":true,\"productRatingEnabled\":true,\"productStarRating\":\"4\",\"productTitle\":\"Product\",\"productDescription\":\"<p>Description</p>\",\"productImageSrc\":\"__GHOST_URL__/content/images/2023/04/docker.svg\",\"productImageWidth\":150,\"productImageHeight\":150,\"productButton\":\"buy\",\"productUrl\":\"https://app.aic.preciselab.io/\"}],[\"header\",{\"size\":\"small\",\"style\":\"dark\",\"buttonEnabled\":false,\"header\":\"Section\",\"subheader\":\"Subheader\"}],[\"embed\",{\"url\":\"https://twitter.com/_GustawDaniel/status/1643067059851624448\",\"html\":\"<blockquote class=\\\"twitter-tweet\\\"><p lang=\\\"en\\\" dir=\\\"ltr\\\">I typed<br><br>text.startsWith(&#39;See also&#39;) || text.startsWith(&#39;See too&#39;)<br><br>and <a href=\\\"https://twitter.com/hashtag/copilot?src=hash&amp;ref_src=twsrc%5Etfw\\\">#copilot</a> analysed my <a href=\\\"https://twitter.com/hashtag/test?src=hash&amp;ref_src=twsrc%5Etfw\\\">#test</a> case files and tests written to <a href=\\\"https://twitter.com/hashtag/code?src=hash&amp;ref_src=twsrc%5Etfw\\\">#code</a> added <br><br>text.startsWith(&#39;More these informations&#39;) || text.startsWith(&#39;Read also in our service&#39;)<br><br>ant it fixed tests. wow. <a href=\\\"https://twitter.com/GitHubCopilot?ref_src=twsrc%5Etfw\\\">@GitHubCopilot</a></p>&mdash; Daniel Gustaw (@_GustawDaniel) <a href=\\\"https://twitter.com/_GustawDaniel/status/1643067059851624448?ref_src=twsrc%5Etfw\\\">April 4, 2023</a></blockquote>\\n<script async src=\\\"https://platform.twitter.com/widgets.js\\\" charset=\\\"utf-8\\\"></script>\\n\",\"type\":\"twitter\",\"metadata\":{\"url\":\"https://twitter.com/_GustawDaniel/status/1643067059851624448\",\"author_name\":\"Daniel Gustaw\",\"author_url\":\"https://twitter.com/_GustawDaniel\",\"width\":550,\"height\":null,\"cache_age\":\"3153600000\",\"provider_name\":\"Twitter\",\"provider_url\":\"http://www.twitter.com/\",\"version\":\"1.0\"}}],[\"html\",{\"html\":\"<section><article>SECTION ARTICLE</article></section>\"}]],\"markups\":[[\"a\",[\"href\",\"app.aic.preciselab.io\"]],[\"code\"],[\"a\",[\"href\",\"https://app.aic.preciselab.io/\"]]],\"sections\":[[1,\"p\",[[0,[],0,\"This is article written to check if \"],[0,[0],1,\"AIC\"],[0,[],0,\" project can read all ghost elements.\"]]],[1,\"p\",[[0,[],0,\"It contains:\"]]],[3,\"ul\",[[[0,[],0,\"list\"]],[[0,[],0,\"image\"]],[[0,[],0,\"pre code\"]],[[0,[],0,\"code language\"]],[[0,[],0,\"quotes\"]]]],[1,\"p\",[]],[1,\"p\",[[0,[],0,\"List was checked already. Now image:\"]]],[10,0],[1,\"p\",[[0,[],0,\"Now code in python\"]]],[10,1],[1,\"p\",[[0,[],0,\"and \"],[0,[1],1,\"code\"],[0,[],0,\" in text.\"]]],[1,\"blockquote\",[[0,[],0,\"Quotation also exists here\"]]],[1,\"p\",[[0,[],0,\"Link to my article\"]]],[10,2],[1,\"p\",[[0,[],0,\"Link to node docs\"]]],[10,3],[1,\"p\",[[0,[],0,\"Latex\"]]],[10,4],[1,\"p\",[[0,[],0,\"Lets login on page\"]]],[1,\"p\",[[0,[2],1,\"https://app.aic.preciselab.io/\"]]],[1,\"p\",[[0,[],0,\"Markdown table below:\"]]],[10,5],[1,\"p\",[[0,[],0,\"Galery\"]]],[10,6],[1,\"p\",[[0,[],0,\"Email card:\"]]],[10,7],[1,\"p\",[[0,[],0,\"Before divider\"]]],[10,8],[1,\"p\",[[0,[],0,\"After divider\"]]],[1,\"p\",[]],[10,9],[10,10],[1,\"p\",[[0,[],0,\"File with logo\"]]],[10,11],[1,\"p\",[[0,[],0,\"Product card:\"]]],[10,12],[10,13],[1,\"p\",[[0,[],0,\"Twitter below\"]]],[10,14],[1,\"p\",[[0,[],0,\"And\"]]],[10,15],[1,\"p\",[]]],\"ghostVersion\":\"4.0\"}","html":"<p>This is article written to check if <a href=\"app.aic.preciselab.io\">AIC</a> project can read all ghost elements.</p><p>It contains:</p><ul><li>list</li><li>image</li><li>pre code</li><li>code language</li><li>quotes</li></ul><p></p><p>List was checked already. Now image:</p><figure class=\"kg-card kg-image-card\"><img src=\"__GHOST_URL__/content/images/2023/04/fdfs19-800x533.jpg\" class=\"kg-image\" alt loading=\"lazy\" width=\"800\" height=\"533\" srcset=\"__GHOST_URL__/content/images/size/w600/2023/04/fdfs19-800x533.jpg 600w, __GHOST_URL__/content/images/2023/04/fdfs19-800x533.jpg 800w\" sizes=\"(min-width: 720px) 720px\"></figure><p>Now code in python</p><pre><code class=\"language-python\">print(1+1)</code></pre><p>and <code>code</code> in text.</p><blockquote>Quotation also exists here</blockquote><p>Link to my article</p><figure class=\"kg-card kg-bookmark-card\"><a class=\"kg-bookmark-container\" href=\"https://gustawdaniel.com/prawo-zipfa-w-nodejs/\"><div class=\"kg-bookmark-content\"><div class=\"kg-bookmark-title\">Analiza Prawa Zipfa w Node.js</div><div class=\"kg-bookmark-description\">Naucz się jak odczytywać duże pliki w Node.js, zliczać wystąpienia słów używając obiektu Map oraz radzić sobie z limitami pamięci.</div><div class=\"kg-bookmark-metadata\"><img class=\"kg-bookmark-icon\" src=\"https://gustawdaniel.com/favicon.ico\" alt=\"\"><span class=\"kg-bookmark-author\">Daniel Gustaw</span><span class=\"kg-bookmark-publisher\">Daniel Gustaw</span></div></div><div class=\"kg-bookmark-thumbnail\"><img src=\"https://gustawdaniel.com/content/images/2022/06/photo-1605429201125-37e867327609.jpeg\" alt=\"\"></div></a></figure><p>Link to node docs</p><figure class=\"kg-card kg-bookmark-card\"><a class=\"kg-bookmark-container\" href=\"https://nodejs.org/api/url.html#urlhash\"><div class=\"kg-bookmark-content\"><div class=\"kg-bookmark-title\">URL | Node.js v19.8.1 Documentation</div><div class=\"kg-bookmark-description\"></div><div class=\"kg-bookmark-metadata\"><img class=\"kg-bookmark-icon\" src=\"https://nodejs.org/favicon.ico\" alt=\"\"><span class=\"kg-bookmark-author\">Node.js v19.8.1 Documentation</span></div></div></a></figure><p>Latex</p><!--kg-card-begin: html-->  \\begin{align}             \n    \\vec{\\nabla} \\cdot \\vec{E} \\quad &=\\quad\\frac{\\rho}{\\epsilon_0} &&\\text{Gauss's Law} \\\\      \n    \\vec{\\nabla} \\cdot \\vec{B} \\quad &=\\quad 0 &&\\text{Gauss's Law for Magnetism}\\\\\n    \\vec{\\nabla} \\times \\vec{E} \\quad &=\\hspace{10pt}-\\frac{\\partial{\\vec{B}}}{\\partial{t}} &&\\text{Faraday's Law of Induction} \\\\ \n    \\vec{\\nabla} \\times \\vec{B} \\quad &=\\quad \\mu_0\\left( \\epsilon_0\\frac{\\partial{\\vec{E}}}{\\partial{t}}+\\vec{J}\\right) &&\\text{Ampere's Circuital Law}\n    \\end{align} <!--kg-card-end: html--><p>Lets login on page</p><p><a href=\"https://app.aic.preciselab.io/\">https://app.aic.preciselab.io/</a></p><p>Markdown table below:</p><!--kg-card-begin: markdown--><table>\n<thead>\n<tr>\n<th>show me graphic card</th>\n<th>lspci -k | grep -A 2 -E &quot;(VGA|3D)&quot;</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>jq command that join package name and version by dash</td>\n<td>jq '.name + &quot;-&quot; + .version'</td>\n</tr>\n<tr>\n<td>three processes with highest ram usage</td>\n<td>ps aux --sort=-%mem | head -n 4</td>\n</tr>\n<tr>\n<td>make backup of mysql db called docs</td>\n<td>mysqldump docs &gt; docs_backup.sql</td>\n</tr>\n<tr>\n<td>setup jest configured for typescript</td>\n<td>npm install --save-dev jest @types/jest ts-jest</td>\n</tr>\n<tr>\n<td>generate ed keys</td>\n<td>openssl genpkey -algorithm ed25519 -out privatekey.key</td>\n</tr>\n<tr>\n<td>show me content of Cargo.toml encoded as base64</td>\n<td>base64 Cargo.toml</td>\n</tr>\n<tr>\n<td>show me content of Cargo.toml encoded as base64 in single line</td>\n<td>cat Cargo.toml | base64 -w 0</td>\n</tr>\n<tr>\n<td>show timer that will update every second</td>\n<td>watch -n 1 date +%T</td>\n</tr>\n<tr>\n<td>range from 10 to 15</td>\n<td>seq 10 15</td>\n</tr>\n<tr>\n<td>replace all lines starting from &quot;CFG_&quot; to starting from &quot;CONFIG_&quot; in file env.conf</td>\n<td>sed -i 's/^CFG_/CONFIG_/g' env.conf</td>\n</tr>\n<tr>\n<td>write one liner to detect emails in file</td>\n<td>grep -Eio '\\b[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+.[A-Z|a-z]{2,}\\b' filename</td>\n</tr>\n<tr>\n<td>cron line to execute /bin/task every monday at 7pm</td>\n<td>0 19 * * 1 /bin/task</td>\n</tr>\n<tr>\n<td>run rusts tests one by one</td>\n<td>cargo test -- --test-threads=1</td>\n</tr>\n<tr>\n<td>who i am and am i still needed</td>\n<td>whoami and yes, you are still needed. &lt;-- hahah it is authentic gpt3 answer</td>\n</tr>\n</tbody>\n</table>\n<!--kg-card-end: markdown--><p>Galery</p><figure class=\"kg-card kg-gallery-card kg-width-wide\"><div class=\"kg-gallery-container\"><div class=\"kg-gallery-row\"><div class=\"kg-gallery-image\"><img src=\"__GHOST_URL__/content/images/2023/04/fixed.png\" width=\"1071\" height=\"507\" loading=\"lazy\" alt srcset=\"__GHOST_URL__/content/images/size/w600/2023/04/fixed.png 600w, __GHOST_URL__/content/images/size/w1000/2023/04/fixed.png 1000w, __GHOST_URL__/content/images/2023/04/fixed.png 1071w\" sizes=\"(min-width: 720px) 720px\"></div><div class=\"kg-gallery-image\"><img src=\"__GHOST_URL__/content/images/2023/04/test.png\" width=\"445\" height=\"53\" loading=\"lazy\" alt></div></div></div></figure><p>Email card:</p><p>Before divider</p><hr><p>After divider</p><p></p><div class=\"kg-card kg-callout-card kg-callout-card-grey\"><div class=\"kg-callout-emoji\">💡</div><div class=\"kg-callout-text\">callout 1</div></div><div class=\"kg-card kg-toggle-card\" data-kg-toggle-state=\"close\"><div class=\"kg-toggle-heading\"><h4 class=\"kg-toggle-heading-text\">Toggle collapsible</h4><button class=\"kg-toggle-card-icon\"><svg id=\"Regular\" xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\"><path class=\"cls-1\" d=\"M23.25,7.311,12.53,18.03a.749.749,0,0,1-1.06,0L.75,7.311\"/></svg></button></div><div class=\"kg-toggle-content\"><p>Content collapsible</p></div></div><p>File with logo</p>\n        <div class=\"kg-card kg-file-card kg-file-card-medium\">\n            <a class=\"kg-file-card-container\" href=\"__GHOST_URL__/content/files/2023/04/logo-color.svg\" title=\"Download\" download>\n                <div class=\"kg-file-card-contents\">\n                    <div class=\"kg-file-card-title\">Logo color</div>\n                    \n                    <div class=\"kg-file-card-metadata\">\n                        <div class=\"kg-file-card-filename\">logo-color.svg</div>\n                        <div class=\"kg-file-card-filesize\">19 KB</div>\n                    </div>\n                </div>\n                <div class=\"kg-file-card-icon\">\n                    <svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\"><defs><style>.a{fill:none;stroke:currentColor;stroke-linecap:round;stroke-linejoin:round;stroke-width:1.5px;}</style></defs><title>download-circle</title><polyline class=\"a\" points=\"8.25 14.25 12 18 15.75 14.25\"/><line class=\"a\" x1=\"12\" y1=\"6.75\" x2=\"12\" y2=\"18\"/><circle class=\"a\" cx=\"12\" cy=\"12\" r=\"11.25\"/></svg>\n                </div>\n            </a>\n        </div>\n        <p>Product card:</p><div class=\"kg-card kg-product-card\"><div class=\"kg-product-card-container\"><img src=\"__GHOST_URL__/content/images/2023/04/docker.svg\" width=\"150\" height=\"150\" class=\"kg-product-card-image\" loading=\"lazy\" /><div class=\"kg-product-card-title-container\"><h4 class=\"kg-product-card-title\">Product</h4></div><div class=\"kg-product-card-rating\"><span class=\"kg-product-card-rating-active kg-product-card-rating-star\"><svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\"><path d=\"M12.729,1.2l3.346,6.629,6.44.638a.805.805,0,0,1,.5,1.374l-5.3,5.253,1.965,7.138a.813.813,0,0,1-1.151.935L12,19.934,5.48,23.163a.813.813,0,0,1-1.151-.935L6.294,15.09.99,9.837a.805.805,0,0,1,.5-1.374l6.44-.638L11.271,1.2A.819.819,0,0,1,12.729,1.2Z\"/></svg></span><span class=\"kg-product-card-rating-active kg-product-card-rating-star\"><svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\"><path d=\"M12.729,1.2l3.346,6.629,6.44.638a.805.805,0,0,1,.5,1.374l-5.3,5.253,1.965,7.138a.813.813,0,0,1-1.151.935L12,19.934,5.48,23.163a.813.813,0,0,1-1.151-.935L6.294,15.09.99,9.837a.805.805,0,0,1,.5-1.374l6.44-.638L11.271,1.2A.819.819,0,0,1,12.729,1.2Z\"/></svg></span><span class=\"kg-product-card-rating-active kg-product-card-rating-star\"><svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\"><path d=\"M12.729,1.2l3.346,6.629,6.44.638a.805.805,0,0,1,.5,1.374l-5.3,5.253,1.965,7.138a.813.813,0,0,1-1.151.935L12,19.934,5.48,23.163a.813.813,0,0,1-1.151-.935L6.294,15.09.99,9.837a.805.805,0,0,1,.5-1.374l6.44-.638L11.271,1.2A.819.819,0,0,1,12.729,1.2Z\"/></svg></span><span class=\"kg-product-card-rating-active kg-product-card-rating-star\"><svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\"><path d=\"M12.729,1.2l3.346,6.629,6.44.638a.805.805,0,0,1,.5,1.374l-5.3,5.253,1.965,7.138a.813.813,0,0,1-1.151.935L12,19.934,5.48,23.163a.813.813,0,0,1-1.151-.935L6.294,15.09.99,9.837a.805.805,0,0,1,.5-1.374l6.44-.638L11.271,1.2A.819.819,0,0,1,12.729,1.2Z\"/></svg></span><span class=\" kg-product-card-rating-star\"><svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\"><path d=\"M12.729,1.2l3.346,6.629,6.44.638a.805.805,0,0,1,.5,1.374l-5.3,5.253,1.965,7.138a.813.813,0,0,1-1.151.935L12,19.934,5.48,23.163a.813.813,0,0,1-1.151-.935L6.294,15.09.99,9.837a.805.805,0,0,1,.5-1.374l6.44-.638L11.271,1.2A.819.819,0,0,1,12.729,1.2Z\"/></svg></span></div><div class=\"kg-product-card-description\"><p>Description</p></div><a href=\"https://app.aic.preciselab.io/\" class=\"kg-product-card-button kg-product-card-btn-accent\" target=\"_blank\" rel=\"noopener noreferrer\"><span>buy</span></a></div></div><div class=\"kg-card kg-header-card kg-width-full kg-size-small kg-style-dark\" style=\"\" data-kg-background-image=\"\"><h2 class=\"kg-header-card-header\" id=\"section\">Section</h2><h3 class=\"kg-header-card-subheader\" id=\"subheader\">Subheader</h3></div><p>Twitter below</p><figure class=\"kg-card kg-embed-card\"><blockquote class=\"twitter-tweet\"><p lang=\"en\" dir=\"ltr\">I typed<br><br>text.startsWith(&#39;See also&#39;) || text.startsWith(&#39;See too&#39;)<br><br>and <a href=\"https://twitter.com/hashtag/copilot?src=hash&amp;ref_src=twsrc%5Etfw\">#copilot</a> analysed my <a href=\"https://twitter.com/hashtag/test?src=hash&amp;ref_src=twsrc%5Etfw\">#test</a> case files and tests written to <a href=\"https://twitter.com/hashtag/code?src=hash&amp;ref_src=twsrc%5Etfw\">#code</a> added <br><br>text.startsWith(&#39;More these informations&#39;) || text.startsWith(&#39;Read also in our service&#39;)<br><br>ant it fixed tests. wow. <a href=\"https://twitter.com/GitHubCopilot?ref_src=twsrc%5Etfw\">@GitHubCopilot</a></p>&mdash; Daniel Gustaw (@_GustawDaniel) <a href=\"https://twitter.com/_GustawDaniel/status/1643067059851624448?ref_src=twsrc%5Etfw\">April 4, 2023</a></blockquote>\n<script async src=\"https://platform.twitter.com/widgets.js\" charset=\"utf-8\"></script>\n</figure><p>And</p><!--kg-card-begin: html--><section><article>SECTION ARTICLE</article></section><!--kg-card-end: html-->","comment_id":"642e545bc61a14d8a5114967","plaintext":"This is article written to check if AIC project can read all ghost elements.\n\nIt contains:\n\n * list\n * image\n * pre code\n * code language\n * quotes\n\n\n\nList was checked already. Now image:\n\nNow code in python\n\nprint(1+1)\n\nand code in text.\n\nQuotation also exists here\n\nLink to my article\n\nAnaliza Prawa Zipfa w Node.jsNaucz się jak odczytywać duże pliki w Node.js, zliczać wystąpienia słów używając obiektu Map oraz radzić sobie z limitami pamięci.Daniel GustawDaniel Gustaw\n\nLink to node docs\n\nURL | Node.js v19.8.1 DocumentationNode.js v19.8.1 Documentation\n\nLatex\n\n\\begin{align}\n\\vec{\\nabla} \\cdot \\vec{E} \\quad &=\\quad\\frac{\\rho}{\\epsilon_0} &&\\text{Gauss's Law} \\\\\n\\vec{\\nabla} \\cdot \\vec{B} \\quad &=\\quad 0 &&\\text{Gauss's Law for Magnetism}\\\\\n\\vec{\\nabla} \\times \\vec{E} \\quad &=\\hspace{10pt}-\\frac{\\partial{\\vec{B}}}{\\partial{t}} &&\\text{Faraday's Law of Induction} \\\\\n\\vec{\\nabla} \\times \\vec{B} \\quad &=\\quad \\mu_0\\left( \\epsilon_0\\frac{\\partial{\\vec{E}}}{\\partial{t}}+\\vec{J}\\right) &&\\text{Ampere's Circuital Law}\n\\end{align}\n\nLets login on page\n\nhttps://app.aic.preciselab.io/\n\nMarkdown table below:\n\n\n\n\nshow me graphic card\nlspci -k | grep -A 2 -E \"(VGA|3D)\"\n\n\n\n\njq command that join package name and version by dash\njq '.name + \"-\" + .version'\n\n\nthree processes with highest ram usage\nps aux --sort=-%mem | head -n 4\n\n\nmake backup of mysql db called docs\nmysqldump docs > docs_backup.sql\n\n\nsetup jest configured for typescript\nnpm install --save-dev jest @types/jest ts-jest\n\n\ngenerate ed keys\nopenssl genpkey -algorithm ed25519 -out privatekey.key\n\n\nshow me content of Cargo.toml encoded as base64\nbase64 Cargo.toml\n\n\nshow me content of Cargo.toml encoded as base64 in single line\ncat Cargo.toml | base64 -w 0\n\n\nshow timer that will update every second\nwatch -n 1 date +%T\n\n\nrange from 10 to 15\nseq 10 15\n\n\nreplace all lines starting from \"CFG_\" to starting from \"CONFIG_\" in file env.conf\nsed -i 's/^CFG_/CONFIG_/g' env.conf\n\n\nwrite one liner to detect emails in file\ngrep -Eio '\\b[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+.[A-Z|a-z]{2,}\\b' filename\n\n\ncron line to execute /bin/task every monday at 7pm\n0 19 * * 1 /bin/task\n\n\nrun rusts tests one by one\ncargo test -- --test-threads=1\n\n\nwho i am and am i still needed\nwhoami and yes, you are still needed. <-- hahah it is authentic gpt3 answer\n\n\n\n\n\nGalery\n\nEmail card:\n\nBefore divider\n\nAfter divider\n\n\n\n💡callout 1\n\nToggle collapsible\n\nContent collapsible\n\nFile with logo\n\n\n\n\n\nLogo color\n\n\nlogo-color.svg\n19 KB\n\n\n\ndownload-circle\n\n\n\n\n\nProduct card:\n\nProduct\n\nDescription\n\nbuy\n\n\nSection\n\n\nSubheader\n\nTwitter below\n\nI typed\n\ntext.startsWith('See also') || text.startsWith('See too')\n\nand #copilot analysed my #test case files and tests written to #code added\n\ntext.startsWith('More these informations') || text.startsWith('Read also in our service')\n\nant it fixed tests. wow. @GitHubCopilot\n\n— Daniel Gustaw (@_GustawDaniel) April 4, 2023\n\n\n\nAnd\n\nSECTION ARTICLE","feature_image":"__GHOST_URL__/content/images/2023/04/board-g2ea98e7f1_1280.jpg","featured":0,"type":"post","status":"draft","locale":null,"visibility":"public","email_recipient_filter":"all","created_at":"2023-04-06T05:10:51.000Z","updated_at":"2023-04-06T05:47:13.000Z","published_at":"2023-04-06T05:32:25.000Z","custom_excerpt":"Test excerpt","codeinjection_head":null,"codeinjection_foot":null,"custom_template":null,"canonical_url":null,"newsletter_id":null,"lexical":null},{"id":"643f73fec61a14d8a5114a02","uuid":"e57a10c6-6d18-4ff0-bf23-c657ebd17af4","title":"Problem with standard Auth flow","slug":"is-login-registration","mobiledoc":"{\"version\":\"0.3.1\",\"atoms\":[],\"cards\":[[\"bookmark\",{\"version\":\"1.0\",\"type\":\"bookmark\",\"url\":\"https://unbounce.com/conversion-rate-optimization/how-to-optimize-contact-forms/\",\"metadata\":{\"url\":\"https://unbounce.com/conversion-rate-optimization/how-to-optimize-contact-forms/\",\"title\":\"How To Optimize Contact Forms For Conversions [Infographic]\",\"description\":\"Every marketer wants to optimize their forms to get more leads, but how do you do it? Dig into the infographic for some inspiration, examples, stats & tips.\",\"author\":\"Oli Gardner\",\"publisher\":\"Unbounce\",\"thumbnail\":\"http://unbounce.com/photos/never-submit1.png\",\"icon\":\"https://unbounce.com/photos/cropped-unbounce-favicon-2-270x270.png\"}}]],\"markups\":[[\"strong\"]],\"sections\":[[1,\"p\",[[0,[],0,\"In most apps we have to register account to act as user. On the other hand we living in society when instant gratification is extremely important force in shaping humans behaviour.\"]]],[1,\"p\",[[0,[],0,\"There is open question if friction connected with registration of account not stops our users before trying our app?\"]]],[1,\"p\",[[0,[],0,\"When I selecting any new app I almost always have list of few apps. I have to collect informations about them and limited time to made good decision. It is obvious that registration forms with many questions will decrease conversion rate, that was proven in many A/B tests.\"]]],[10,0],[1,\"p\",[[0,[],0,\"But what will happen if I will reduce number of questions to \"],[0,[0],1,\"\\\"0\\\".\"],[0,[],0,\" \"]]],[1,\"p\",[[0,[],0,\"I literally mean building flow when new page visitors can start using app as registered, logged in user. He can test it, use and even reload page, but registration time is moved in time as late as possible?\"]]],[1,\"p\",[[0,[],0,\"This approach is obvious tradeoff with these disadvantages:\"]]],[3,\"ul\",[[[0,[],0,\"user do not understand that his account is created in background and can worry about saving result of his actions\"]],[[0,[],0,\"user did not allowed for processing his data, but on the other hand not give us any personal data trying app, so potentially there will be no law problems\"]],[[0,[],0,\"we creating huge amount of test accounts in database always when we need to save user actions\"]]]],[1,\"p\",[[0,[],0,\"But potential advantage is that user can go throug process of dreams:\"]]],[3,\"ul\",[[[0,[],0,\"visit page first time\"]],[[0,[],0,\"start using app instantly\"]],[[0,[],0,\"decide if he like it and only then create \\\"real\\\" account\"]]]],[1,\"p\",[[0,[],0,\"This starts to be extremely important because we can bring forward gratification, and postpone user investment (giving data / clicking \\\"sign up\\\"), that can be competitive advantage worth to implement.\"]]],[1,\"p\",[[0,[],0,\"Below I will explain how I implemented this idea in xue.academy - app that allow to learn languages in personalised process driven by AI. \"]]],[1,\"p\",[[0,[],0,\"Tech stack is t3. In details: prisma, nuxt, trpc, fastify. I decided to use the following flow:\"]]],[3,\"ol\",[[[0,[],0,\"Nuxt server check if request contains cookie.\"]],[[0,[],0,\"If no, then temporary user is created and cookie are assigned.\"]],[[0,[],0,\"So fronted always is rendered with \\\"cookie\\\" and user.\"]],[[0,[],0,\"User will see that is \\\"not logged\\\" but in practice he is logged on temporary account.\"]],[[0,[],0,\"This temporary user can use app with default settings, but core features are provided.\"]],[[0,[],0,\"After reaching limits for temporary users he will be kindly asked about registration.\"]],[[0,[],0,\"Then new real account is created and is merged with temporary account.\"]]]],[1,\"p\",[[0,[],0,\"First problem is:\"]]],[3,\"ul\",[[[0,[],0,\"should I save temporary account in database, it will slow down first page.\"]]]],[1,\"p\",[[0,[],0,\"First page loading speed is priority, so I decided to make process of saving to database non blocking for page rendering.\"]]],[1,\"p\",[[0,[],0,\"Additionally all temporary clients will start from similar experience, so I \"]]]],\"ghostVersion\":\"4.0\"}","html":"<p>In most apps we have to register account to act as user. On the other hand we living in society when instant gratification is extremely important force in shaping humans behaviour.</p><p>There is open question if friction connected with registration of account not stops our users before trying our app?</p><p>When I selecting any new app I almost always have list of few apps. I have to collect informations about them and limited time to made good decision. It is obvious that registration forms with many questions will decrease conversion rate, that was proven in many A/B tests.</p><figure class=\"kg-card kg-bookmark-card\"><a class=\"kg-bookmark-container\" href=\"https://unbounce.com/conversion-rate-optimization/how-to-optimize-contact-forms/\"><div class=\"kg-bookmark-content\"><div class=\"kg-bookmark-title\">How To Optimize Contact Forms For Conversions [Infographic]</div><div class=\"kg-bookmark-description\">Every marketer wants to optimize their forms to get more leads, but how do you do it? Dig into the infographic for some inspiration, examples, stats &amp; tips.</div><div class=\"kg-bookmark-metadata\"><img class=\"kg-bookmark-icon\" src=\"https://unbounce.com/photos/cropped-unbounce-favicon-2-270x270.png\" alt=\"\"><span class=\"kg-bookmark-author\">Unbounce</span><span class=\"kg-bookmark-publisher\">Oli Gardner</span></div></div><div class=\"kg-bookmark-thumbnail\"><img src=\"http://unbounce.com/photos/never-submit1.png\" alt=\"\"></div></a></figure><p>But what will happen if I will reduce number of questions to <strong>\"0\".</strong> </p><p>I literally mean building flow when new page visitors can start using app as registered, logged in user. He can test it, use and even reload page, but registration time is moved in time as late as possible?</p><p>This approach is obvious tradeoff with these disadvantages:</p><ul><li>user do not understand that his account is created in background and can worry about saving result of his actions</li><li>user did not allowed for processing his data, but on the other hand not give us any personal data trying app, so potentially there will be no law problems</li><li>we creating huge amount of test accounts in database always when we need to save user actions</li></ul><p>But potential advantage is that user can go throug process of dreams:</p><ul><li>visit page first time</li><li>start using app instantly</li><li>decide if he like it and only then create \"real\" account</li></ul><p>This starts to be extremely important because we can bring forward gratification, and postpone user investment (giving data / clicking \"sign up\"), that can be competitive advantage worth to implement.</p><p>Below I will explain how I implemented this idea in xue.academy - app that allow to learn languages in personalised process driven by AI. </p><p>Tech stack is t3. In details: prisma, nuxt, trpc, fastify. I decided to use the following flow:</p><ol><li>Nuxt server check if request contains cookie.</li><li>If no, then temporary user is created and cookie are assigned.</li><li>So fronted always is rendered with \"cookie\" and user.</li><li>User will see that is \"not logged\" but in practice he is logged on temporary account.</li><li>This temporary user can use app with default settings, but core features are provided.</li><li>After reaching limits for temporary users he will be kindly asked about registration.</li><li>Then new real account is created and is merged with temporary account.</li></ol><p>First problem is:</p><ul><li>should I save temporary account in database, it will slow down first page.</li></ul><p>First page loading speed is priority, so I decided to make process of saving to database non blocking for page rendering.</p><p>Additionally all temporary clients will start from similar experience, so I </p>","comment_id":"643f73fec61a14d8a5114a02","plaintext":"In most apps we have to register account to act as user. On the other hand we living in society when instant gratification is extremely important force in shaping humans behaviour.\n\nThere is open question if friction connected with registration of account not stops our users before trying our app?\n\nWhen I selecting any new app I almost always have list of few apps. I have to collect informations about them and limited time to made good decision. It is obvious that registration forms with many questions will decrease conversion rate, that was proven in many A/B tests.\n\nHow To Optimize Contact Forms For Conversions [Infographic]Every marketer wants to optimize their forms to get more leads, but how do you do it? Dig into the infographic for some inspiration, examples, stats & tips.UnbounceOli Gardner\n\nBut what will happen if I will reduce number of questions to \"0\".\n\nI literally mean building flow when new page visitors can start using app as registered, logged in user. He can test it, use and even reload page, but registration time is moved in time as late as possible?\n\nThis approach is obvious tradeoff with these disadvantages:\n\n * user do not understand that his account is created in background and can worry about saving result of his actions\n * user did not allowed for processing his data, but on the other hand not give us any personal data trying app, so potentially there will be no law problems\n * we creating huge amount of test accounts in database always when we need to save user actions\n\nBut potential advantage is that user can go throug process of dreams:\n\n * visit page first time\n * start using app instantly\n * decide if he like it and only then create \"real\" account\n\nThis starts to be extremely important because we can bring forward gratification, and postpone user investment (giving data / clicking \"sign up\"), that can be competitive advantage worth to implement.\n\nBelow I will explain how I implemented this idea in xue.academy - app that allow to learn languages in personalised process driven by AI.\n\nTech stack is t3. In details: prisma, nuxt, trpc, fastify. I decided to use the following flow:\n\n 1. Nuxt server check if request contains cookie.\n 2. If no, then temporary user is created and cookie are assigned.\n 3. So fronted always is rendered with \"cookie\" and user.\n 4. User will see that is \"not logged\" but in practice he is logged on temporary account.\n 5. This temporary user can use app with default settings, but core features are provided.\n 6. After reaching limits for temporary users he will be kindly asked about registration.\n 7. Then new real account is created and is merged with temporary account.\n\nFirst problem is:\n\n * should I save temporary account in database, it will slow down first page.\n\nFirst page loading speed is priority, so I decided to make process of saving to database non blocking for page rendering.\n\nAdditionally all temporary clients will start from similar experience, so I","feature_image":null,"featured":0,"type":"post","status":"draft","locale":null,"visibility":"public","email_recipient_filter":"all","created_at":"2023-04-19T04:54:22.000Z","updated_at":"2023-04-19T05:39:46.000Z","published_at":null,"custom_excerpt":null,"codeinjection_head":null,"codeinjection_foot":null,"custom_template":null,"canonical_url":null,"newsletter_id":null,"lexical":null},{"id":"644a0a2cc61a14d8a5114add","uuid":"9ddcebf7-799b-4d1d-b08a-bcdd76354ba4","title":"How to transform BTC blockchain to neo4j on Fedora Linux","slug":"btc-neo4j-fedora","mobiledoc":"{\"version\":\"0.3.1\",\"atoms\":[],\"cards\":[[\"bookmark\",{\"version\":\"1.0\",\"type\":\"bookmark\",\"url\":\"https://github.com/in3rsha/bitcoin-to-neo4j\",\"metadata\":{\"url\":\"https://github.com/in3rsha/bitcoin-to-neo4j\",\"title\":\"GitHub - in3rsha/bitcoin-to-neo4j: Import the Bitcoin blockchain in to a Neo4j graph database.\",\"description\":\"Import the Bitcoin blockchain in to a Neo4j graph database. - GitHub - in3rsha/bitcoin-to-neo4j: Import the Bitcoin blockchain in to a Neo4j graph database.\",\"author\":\"in3rsha\",\"publisher\":\"GitHub\",\"thumbnail\":\"https://opengraph.githubassets.com/f9c733461e4a4160f29d0b3378a672d46fad2d238c35d0399ee26462d4aff62f/in3rsha/bitcoin-to-neo4j\",\"icon\":\"https://github.com/fluidicon.png\"}}],[\"code\",{\"code\":\"dnf install bitcoin-core-server\"}],[\"code\",{\"code\":\"bitcoin-core-server\"}],[\"image\",{\"src\":\"__GHOST_URL__/content/images/2023/04/Zrzut-ekranu-z-2023-04-27-13-59-54.png\",\"width\":623,\"height\":549}],[\"code\",{\"code\":\"du -h ~/.bitcoin\"}],[\"bookmark\",{\"version\":\"1.0\",\"type\":\"bookmark\",\"url\":\"https://neo4j.com/docs/operations-manual/current/installation/linux/rpm/\",\"metadata\":{\"url\":\"https://neo4j.com/docs/operations-manual/5/installation/linux/rpm/\",\"title\":\"Red Hat, CentOS, Fedora, and Amazon Linux distributions (.rpm) - Operations Manual\",\"description\":\"How to deploy Neo4j using the Neo4j RPM package on Red Hat, CentOS, Fedora, or Amazon Linux distributions.\",\"author\":null,\"publisher\":\"Neo4j Graph Data Platform\",\"thumbnail\":\"https://dist.neo4j.com/wp-content/uploads/20210423062553/neo4j-social-share-21.png\",\"icon\":\"https://neo4j.com/wp-content/themes/neo4jweb/favicon.ico\"}}],[\"code\",{\"code\":\"java --version\\nopenjdk 17.0.6 2023-01-17\\nOpenJDK Runtime Environment (Red_Hat-17.0.6.0.10-1.fc37) (build 17.0.6+10)\\nOpenJDK 64-Bit Server VM (Red_Hat-17.0.6.0.10-1.fc37) (build 17.0.6+10, mixed mode, sharing)\\n\"}],[\"code\",{\"code\":\"sudo rpm --import https://debian.neo4j.com/neotechnology.gpg.key\\nsudo cat <  /etc/yum.repos.d/neo4j.repo\\n[neo4j]\\nname=Neo4j RPM Repository\\nbaseurl=https://yum.neo4j.com/stable/5\\nenabled=1\\ngpgcheck=1\\nEOF\"}],[\"code\",{\"code\":\"sudo dnf install neo4j\\n\"}],[\"image\",{\"src\":\"__GHOST_URL__/content/images/2023/04/Zrzut-ekranu-z-2023-04-27-14-05-32.png\",\"width\":655,\"height\":154}],[\"code\",{\"code\":\"sudo service neo4j start\"}],[\"bookmark\",{\"version\":\"1.0\",\"type\":\"bookmark\",\"url\":\"https://neo4j.com/developer/neo4j-desktop/\",\"metadata\":{\"url\":\"https://neo4j.com/developer/neo4j-desktop/\",\"title\":\"Neo4j Desktop User Interface Guide - Developer Guides\",\"description\":\"This article demonstrates how to use the Neo4j Desktop GUI for managing instances of Neo4j locally for development.\",\"author\":null,\"publisher\":\"Neo4j Graph Data Platform\",\"thumbnail\":\"https://dist.neo4j.com/wp-content/uploads/20210423062553/neo4j-social-share-21.png\",\"icon\":\"https://neo4j.com/wp-content/themes/neo4jweb/favicon.ico\"}}]],\"markups\":[[\"code\"]],\"sections\":[[1,\"p\",[[0,[],0,\"This article is heavily inspired by repository, but add some context for Fedora Linux and analyse chance of speedup data preparation.\"]]],[10,0],[1,\"h2\",[[0,[],0,\"Setup BTC node\"]]],[1,\"p\",[[0,[],0,\"Firstly we need to install Bitcoin node\"]]],[10,1],[1,\"p\",[[0,[],0,\"And start it by\"]]],[10,2],[1,\"p\",[[0,[],0,\"You will see something like this\"]]],[10,3],[1,\"p\",[[0,[],0,\"You should expect about half of TB of data. So you can measure it by\"]]],[10,4],[1,\"p\",[[0,[],0,\"Expected time of synchronization can be estimated as 1-5 days.\"]]],[1,\"h2\",[[0,[],0,\"Setup neo4j server\"]]],[1,\"p\",[[0,[],0,\"Second step is installation of neo4j database.\"]]],[10,5],[1,\"p\",[[0,[],0,\"In my case there was java already installed\"]]],[10,6],[1,\"p\",[[0,[],0,\"So lacking steps was:\"]]],[10,7],[1,\"p\",[[0,[],0,\"and\"]]],[10,8],[1,\"p\",[[0,[],0,\"It installed both db server and shell to \"],[0,[0],1,\"cypher\"],[0,[],0,\" that is general language for graph data\"]]],[10,9],[1,\"p\",[[0,[],0,\"Finally i started neo4j db\"]]],[10,10],[1,\"p\",[[0,[],0,\"Next step was installation neo4j desktop interface.\"]]],[10,11],[1,\"p\",[]]],\"ghostVersion\":\"4.0\"}","html":"<p>This article is heavily inspired by repository, but add some context for Fedora Linux and analyse chance of speedup data preparation.</p><figure class=\"kg-card kg-bookmark-card\"><a class=\"kg-bookmark-container\" href=\"https://github.com/in3rsha/bitcoin-to-neo4j\"><div class=\"kg-bookmark-content\"><div class=\"kg-bookmark-title\">GitHub - in3rsha/bitcoin-to-neo4j: Import the Bitcoin blockchain in to a Neo4j graph database.</div><div class=\"kg-bookmark-description\">Import the Bitcoin blockchain in to a Neo4j graph database. - GitHub - in3rsha/bitcoin-to-neo4j: Import the Bitcoin blockchain in to a Neo4j graph database.</div><div class=\"kg-bookmark-metadata\"><img class=\"kg-bookmark-icon\" src=\"https://github.com/fluidicon.png\" alt=\"\"><span class=\"kg-bookmark-author\">GitHub</span><span class=\"kg-bookmark-publisher\">in3rsha</span></div></div><div class=\"kg-bookmark-thumbnail\"><img src=\"https://opengraph.githubassets.com/f9c733461e4a4160f29d0b3378a672d46fad2d238c35d0399ee26462d4aff62f/in3rsha/bitcoin-to-neo4j\" alt=\"\"></div></a></figure><h2 id=\"setup-btc-node\">Setup BTC node</h2><p>Firstly we need to install Bitcoin node</p><pre><code>dnf install bitcoin-core-server</code></pre><p>And start it by</p><pre><code>bitcoin-core-server</code></pre><p>You will see something like this</p><figure class=\"kg-card kg-image-card\"><img src=\"__GHOST_URL__/content/images/2023/04/Zrzut-ekranu-z-2023-04-27-13-59-54.png\" class=\"kg-image\" alt loading=\"lazy\" width=\"623\" height=\"549\" srcset=\"__GHOST_URL__/content/images/size/w600/2023/04/Zrzut-ekranu-z-2023-04-27-13-59-54.png 600w, __GHOST_URL__/content/images/2023/04/Zrzut-ekranu-z-2023-04-27-13-59-54.png 623w\"></figure><p>You should expect about half of TB of data. So you can measure it by</p><pre><code>du -h ~/.bitcoin</code></pre><p>Expected time of synchronization can be estimated as 1-5 days.</p><h2 id=\"setup-neo4j-server\">Setup neo4j server</h2><p>Second step is installation of neo4j database.</p><figure class=\"kg-card kg-bookmark-card\"><a class=\"kg-bookmark-container\" href=\"https://neo4j.com/docs/operations-manual/current/installation/linux/rpm/\"><div class=\"kg-bookmark-content\"><div class=\"kg-bookmark-title\">Red Hat, CentOS, Fedora, and Amazon Linux distributions (.rpm) - Operations Manual</div><div class=\"kg-bookmark-description\">How to deploy Neo4j using the Neo4j RPM package on Red Hat, CentOS, Fedora, or Amazon Linux distributions.</div><div class=\"kg-bookmark-metadata\"><img class=\"kg-bookmark-icon\" src=\"https://neo4j.com/wp-content/themes/neo4jweb/favicon.ico\" alt=\"\"><span class=\"kg-bookmark-author\">Neo4j Graph Data Platform</span></div></div><div class=\"kg-bookmark-thumbnail\"><img src=\"https://dist.neo4j.com/wp-content/uploads/20210423062553/neo4j-social-share-21.png\" alt=\"\"></div></a></figure><p>In my case there was java already installed</p><pre><code>java --version\nopenjdk 17.0.6 2023-01-17\nOpenJDK Runtime Environment (Red_Hat-17.0.6.0.10-1.fc37) (build 17.0.6+10)\nOpenJDK 64-Bit Server VM (Red_Hat-17.0.6.0.10-1.fc37) (build 17.0.6+10, mixed mode, sharing)\n</code></pre><p>So lacking steps was:</p><pre><code>sudo rpm --import https://debian.neo4j.com/neotechnology.gpg.key\nsudo cat &lt;  /etc/yum.repos.d/neo4j.repo\n[neo4j]\nname=Neo4j RPM Repository\nbaseurl=https://yum.neo4j.com/stable/5\nenabled=1\ngpgcheck=1\nEOF</code></pre><p>and</p><pre><code>sudo dnf install neo4j\n</code></pre><p>It installed both db server and shell to <code>cypher</code> that is general language for graph data</p><figure class=\"kg-card kg-image-card\"><img src=\"__GHOST_URL__/content/images/2023/04/Zrzut-ekranu-z-2023-04-27-14-05-32.png\" class=\"kg-image\" alt loading=\"lazy\" width=\"655\" height=\"154\" srcset=\"__GHOST_URL__/content/images/size/w600/2023/04/Zrzut-ekranu-z-2023-04-27-14-05-32.png 600w, __GHOST_URL__/content/images/2023/04/Zrzut-ekranu-z-2023-04-27-14-05-32.png 655w\"></figure><p>Finally i started neo4j db</p><pre><code>sudo service neo4j start</code></pre><p>Next step was installation neo4j desktop interface.</p><figure class=\"kg-card kg-bookmark-card\"><a class=\"kg-bookmark-container\" href=\"https://neo4j.com/developer/neo4j-desktop/\"><div class=\"kg-bookmark-content\"><div class=\"kg-bookmark-title\">Neo4j Desktop User Interface Guide - Developer Guides</div><div class=\"kg-bookmark-description\">This article demonstrates how to use the Neo4j Desktop GUI for managing instances of Neo4j locally for development.</div><div class=\"kg-bookmark-metadata\"><img class=\"kg-bookmark-icon\" src=\"https://neo4j.com/wp-content/themes/neo4jweb/favicon.ico\" alt=\"\"><span class=\"kg-bookmark-author\">Neo4j Graph Data Platform</span></div></div><div class=\"kg-bookmark-thumbnail\"><img src=\"https://dist.neo4j.com/wp-content/uploads/20210423062553/neo4j-social-share-21.png\" alt=\"\"></div></a></figure>","comment_id":"644a0a2cc61a14d8a5114add","plaintext":"This article is heavily inspired by repository, but add some context for Fedora Linux and analyse chance of speedup data preparation.\n\nGitHub - in3rsha/bitcoin-to-neo4j: Import the Bitcoin blockchain in to a Neo4j graph database.Import the Bitcoin blockchain in to a Neo4j graph database. - GitHub - in3rsha/bitcoin-to-neo4j: Import the Bitcoin blockchain in to a Neo4j graph database.GitHubin3rsha\n\n\nSetup BTC node\n\nFirstly we need to install Bitcoin node\n\ndnf install bitcoin-core-server\n\nAnd start it by\n\nbitcoin-core-server\n\nYou will see something like this\n\nYou should expect about half of TB of data. So you can measure it by\n\ndu -h ~/.bitcoin\n\nExpected time of synchronization can be estimated as 1-5 days.\n\n\nSetup neo4j server\n\nSecond step is installation of neo4j database.\n\nRed Hat, CentOS, Fedora, and Amazon Linux distributions (.rpm) - Operations ManualHow to deploy Neo4j using the Neo4j RPM package on Red Hat, CentOS, Fedora, or Amazon Linux distributions.Neo4j Graph Data Platform\n\nIn my case there was java already installed\n\njava --version\nopenjdk 17.0.6 2023-01-17\nOpenJDK Runtime Environment (Red_Hat-17.0.6.0.10-1.fc37) (build 17.0.6+10)\nOpenJDK 64-Bit Server VM (Red_Hat-17.0.6.0.10-1.fc37) (build 17.0.6+10, mixed mode, sharing)\n\n\nSo lacking steps was:\n\nsudo rpm --import https://debian.neo4j.com/neotechnology.gpg.key\nsudo cat <  /etc/yum.repos.d/neo4j.repo\n[neo4j]\nname=Neo4j RPM Repository\nbaseurl=https://yum.neo4j.com/stable/5\nenabled=1\ngpgcheck=1\nEOF\n\nand\n\nsudo dnf install neo4j\n\n\nIt installed both db server and shell to cypher that is general language for graph data\n\nFinally i started neo4j db\n\nsudo service neo4j start\n\nNext step was installation neo4j desktop interface.\n\nNeo4j Desktop User Interface Guide - Developer GuidesThis article demonstrates how to use the Neo4j Desktop GUI for managing instances of Neo4j locally for development.Neo4j Graph Data Platform","feature_image":null,"featured":0,"type":"post","status":"draft","locale":null,"visibility":"public","email_recipient_filter":"all","created_at":"2023-04-27T05:37:48.000Z","updated_at":"2023-04-27T07:25:49.000Z","published_at":null,"custom_excerpt":null,"codeinjection_head":null,"codeinjection_foot":null,"custom_template":null,"canonical_url":null,"newsletter_id":null,"lexical":null}],"posts_authors":[{"id":"606d7a485d6c891ac9aa7243","post_id":"606d7a485d6c891ac9aa7242","author_id":"606d7a3d5d6c891ac9aa723f","sort_order":0},{"id":"606d85f65d6c891ac9aa72b1","post_id":"606d85f65d6c891ac9aa72b0","author_id":"606d7a3d5d6c891ac9aa723f","sort_order":0},{"id":"606d8abf5d6c891ac9aa72b5","post_id":"606d8abf5d6c891ac9aa72b4","author_id":"1","sort_order":0},{"id":"606d8b255d6c891ac9aa72bd","post_id":"606d8b255d6c891ac9aa72bc","author_id":"1","sort_order":0},{"id":"60704f985d6c891ac9aa73ad","post_id":"60704f975d6c891ac9aa73ac","author_id":"1","sort_order":0},{"id":"607f29835d6c891ac9aa73c0","post_id":"607f29835d6c891ac9aa73bf","author_id":"1","sort_order":0},{"id":"607f2ab25d6c891ac9aa73c6","post_id":"607f2ab25d6c891ac9aa73c5","author_id":"1","sort_order":0},{"id":"607f2c065d6c891ac9aa73dd","post_id":"607f2c065d6c891ac9aa73dc","author_id":"1","sort_order":0},{"id":"607f389e5d6c891ac9aa73ef","post_id":"607f389d5d6c891ac9aa73ee","author_id":"1","sort_order":0},{"id":"607f3e665d6c891ac9aa73fe","post_id":"607f3e665d6c891ac9aa73fd","author_id":"1","sort_order":0},{"id":"607f40625d6c891ac9aa7405","post_id":"607f40615d6c891ac9aa7404","author_id":"1","sort_order":0},{"id":"607f47ff5d6c891ac9aa746a","post_id":"607f47ff5d6c891ac9aa7469","author_id":"1","sort_order":0},{"id":"60c74386e7634f04c892be69","post_id":"60c74386e7634f04c892be68","author_id":"606d7a3d5d6c891ac9aa723f","sort_order":0},{"id":"6375187bf20ac751bf7a5eaa","post_id":"6375187bf20ac751bf7a5ea9","author_id":"1","sort_order":0},{"id":"6379e4e9f20ac751bf7a5ee4","post_id":"6379e4e9f20ac751bf7a5ee3","author_id":"1","sort_order":0},{"id":"6384c8a2f20ac751bf7a621b","post_id":"6384c8a2f20ac751bf7a621a","author_id":"1","sort_order":0},{"id":"6384f541f20ac751bf7a62f4","post_id":"6384f541f20ac751bf7a62f3","author_id":"1","sort_order":0},{"id":"6386ffb8bbda300a2f29c02a","post_id":"6386ffb8bbda300a2f29c029","author_id":"1","sort_order":0},{"id":"638e0844bbda300a2f29c426","post_id":"638e0843bbda300a2f29c425","author_id":"1","sort_order":0},{"id":"638f7123bbda300a2f29c5b8","post_id":"638f7123bbda300a2f29c5b7","author_id":"1","sort_order":0},{"id":"639a2d70bbda300a2f29c628","post_id":"639a2d70bbda300a2f29c627","author_id":"1","sort_order":0},{"id":"63c6d6b1bbda300a2f29c6c7","post_id":"63c6d6b0bbda300a2f29c6c6","author_id":"1","sort_order":0},{"id":"63c9d7b4bbda300a2f29c860","post_id":"63c9d7b4bbda300a2f29c85f","author_id":"1","sort_order":0},{"id":"63cbdf03bbda300a2f29ca64","post_id":"63cbdf03bbda300a2f29ca63","author_id":"1","sort_order":0},{"id":"63cc1ff5bbda300a2f29cb54","post_id":"63cc1ff5bbda300a2f29cb53","author_id":"1","sort_order":0},{"id":"63cd9d9ebbda300a2f29cdc7","post_id":"63cd9d9ebbda300a2f29cdc6","author_id":"1","sort_order":0},{"id":"63e3962dbbda300a2f29cffe","post_id":"63e3962dbbda300a2f29cffd","author_id":"1","sort_order":0},{"id":"63ee10a8bbda300a2f29d2e0","post_id":"63ee10a8bbda300a2f29d2df","author_id":"1","sort_order":0},{"id":"63f1e7b7bbda300a2f29d412","post_id":"63f1e7b7bbda300a2f29d411","author_id":"1","sort_order":0},{"id":"63f43262bbda300a2f29d464","post_id":"63f43262bbda300a2f29d463","author_id":"1","sort_order":0},{"id":"64002f89bbda300a2f29d4ee","post_id":"64002f89bbda300a2f29d4ed","author_id":"1","sort_order":0},{"id":"640936aabbda300a2f29d56d","post_id":"640936aabbda300a2f29d56c","author_id":"1","sort_order":0},{"id":"640b53120f360525ad8515cd","post_id":"640b53120f360525ad8515cc","author_id":"1","sort_order":0},{"id":"641151130f360525ad8515d1","post_id":"641151130f360525ad8515d0","author_id":"1","sort_order":0},{"id":"64154ee60f360525ad851807","post_id":"64154ee60f360525ad851806","author_id":"1","sort_order":0},{"id":"6417e0c70f360525ad85186b","post_id":"6417e0c70f360525ad85186a","author_id":"1","sort_order":0},{"id":"6419a4484e210aabcb6e161c","post_id":"6419a4484e210aabcb6e161b","author_id":"1","sort_order":0},{"id":"641e5d1c4e210aabcb6e1626","post_id":"641e5d1b4e210aabcb6e1625","author_id":"1","sort_order":0},{"id":"6422832d99d7a498d8917d2f","post_id":"6422832d99d7a498d8917d2e","author_id":"1","sort_order":0},{"id":"642c173b99d7a498d8917d73","post_id":"642c173a99d7a498d8917d72","author_id":"1","sort_order":0},{"id":"642d42f599d7a498d8917d77","post_id":"642d42f599d7a498d8917d76","author_id":"1","sort_order":0},{"id":"642e545bc61a14d8a5114968","post_id":"642e545bc61a14d8a5114967","author_id":"1","sort_order":0},{"id":"643f73fec61a14d8a5114a03","post_id":"643f73fec61a14d8a5114a02","author_id":"1","sort_order":0},{"id":"644a0a2cc61a14d8a5114ade","post_id":"644a0a2cc61a14d8a5114add","author_id":"1","sort_order":0}],"posts_meta":[],"posts_products":[{"id":"6411512d0f360525ad8515d4","post_id":"641151130f360525ad8515d0","product_id":"640b49f20f360525ad85156a","sort_order":0},{"id":"6411512d0f360525ad8515d5","post_id":"641151130f360525ad8515d0","product_id":"608b196c5786540883bcbf03","sort_order":1},{"id":"64154eeb0f360525ad85180a","post_id":"64154ee60f360525ad851806","product_id":"640b49f20f360525ad85156a","sort_order":0},{"id":"64154eeb0f360525ad85180b","post_id":"64154ee60f360525ad851806","product_id":"608b196c5786540883bcbf03","sort_order":1},{"id":"6417e1090f360525ad85186e","post_id":"6417e0c70f360525ad85186a","product_id":"640b49f20f360525ad85156a","sort_order":0},{"id":"6417e1090f360525ad85186f","post_id":"6417e0c70f360525ad85186a","product_id":"608b196c5786540883bcbf03","sort_order":1},{"id":"6419a4564e210aabcb6e161f","post_id":"6419a4484e210aabcb6e161b","product_id":"640b49f20f360525ad85156a","sort_order":0},{"id":"6419a4564e210aabcb6e1620","post_id":"6419a4484e210aabcb6e161b","product_id":"608b196c5786540883bcbf03","sort_order":1},{"id":"641e5d3c4e210aabcb6e1629","post_id":"641e5d1b4e210aabcb6e1625","product_id":"640b49f20f360525ad85156a","sort_order":0},{"id":"641e5d3c4e210aabcb6e162a","post_id":"641e5d1b4e210aabcb6e1625","product_id":"608b196c5786540883bcbf03","sort_order":1},{"id":"6422833499d7a498d8917d32","post_id":"6422832d99d7a498d8917d2e","product_id":"640b49f20f360525ad85156a","sort_order":0},{"id":"6422833499d7a498d8917d33","post_id":"6422832d99d7a498d8917d2e","product_id":"608b196c5786540883bcbf03","sort_order":1},{"id":"642d431a99d7a498d8917d7a","post_id":"642d42f599d7a498d8917d76","product_id":"640b49f20f360525ad85156a","sort_order":0},{"id":"642d431a99d7a498d8917d7b","post_id":"642d42f599d7a498d8917d76","product_id":"608b196c5786540883bcbf03","sort_order":1},{"id":"642e5464c61a14d8a511496b","post_id":"642e545bc61a14d8a5114967","product_id":"640b49f20f360525ad85156a","sort_order":0},{"id":"642e5464c61a14d8a511496c","post_id":"642e545bc61a14d8a5114967","product_id":"608b196c5786540883bcbf03","sort_order":1},{"id":"643f7415c61a14d8a5114a06","post_id":"643f73fec61a14d8a5114a02","product_id":"640b49f20f360525ad85156a","sort_order":0},{"id":"643f7415c61a14d8a5114a07","post_id":"643f73fec61a14d8a5114a02","product_id":"608b196c5786540883bcbf03","sort_order":1},{"id":"644a0a5fc61a14d8a5114ae1","post_id":"644a0a2cc61a14d8a5114add","product_id":"640b49f20f360525ad85156a","sort_order":0},{"id":"644a0a5fc61a14d8a5114ae2","post_id":"644a0a2cc61a14d8a5114add","product_id":"608b196c5786540883bcbf03","sort_order":1}],"posts_tags":[{"id":"607f38e15d6c891ac9aa73f5","post_id":"607f389d5d6c891ac9aa73ee","tag_id":"607f38e15d6c891ac9aa73f2","sort_order":0},{"id":"607f38e15d6c891ac9aa73f6","post_id":"607f389d5d6c891ac9aa73ee","tag_id":"607f38e15d6c891ac9aa73f3","sort_order":1},{"id":"607f38e15d6c891ac9aa73f7","post_id":"607f389d5d6c891ac9aa73ee","tag_id":"607f38e15d6c891ac9aa73f4","sort_order":2},{"id":"607f43b65d6c891ac9aa7464","post_id":"607f40615d6c891ac9aa7404","tag_id":"607f43b65d6c891ac9aa7462","sort_order":0},{"id":"607f43b65d6c891ac9aa7465","post_id":"607f40615d6c891ac9aa7404","tag_id":"607f43b65d6c891ac9aa7463","sort_order":1},{"id":"607f4bbd5d6c891ac9aa751f","post_id":"607f47ff5d6c891ac9aa7469","tag_id":"607f4bbd5d6c891ac9aa751b","sort_order":0},{"id":"607f4bbd5d6c891ac9aa7520","post_id":"607f47ff5d6c891ac9aa7469","tag_id":"607f4bbd5d6c891ac9aa751c","sort_order":1},{"id":"607f4bbd5d6c891ac9aa7521","post_id":"607f47ff5d6c891ac9aa7469","tag_id":"607f4bbd5d6c891ac9aa751d","sort_order":2},{"id":"607f4bbd5d6c891ac9aa7522","post_id":"607f47ff5d6c891ac9aa7469","tag_id":"607f4bbd5d6c891ac9aa751e","sort_order":3},{"id":"60c856eee7634f04c892beb8","post_id":"60c74386e7634f04c892be68","tag_id":"60c856eee7634f04c892beb5","sort_order":0},{"id":"60c856eee7634f04c892beb9","post_id":"60c74386e7634f04c892be68","tag_id":"60c856eee7634f04c892beb6","sort_order":1},{"id":"60c856eee7634f04c892beba","post_id":"60c74386e7634f04c892be68","tag_id":"60c856eee7634f04c892beb7","sort_order":2},{"id":"60f826efe7634f04c892bf57","post_id":"606d7a485d6c891ac9aa7242","tag_id":"607f38e15d6c891ac9aa73f4","sort_order":0},{"id":"60f826efe7634f04c892bf58","post_id":"606d7a485d6c891ac9aa7242","tag_id":"607f38e15d6c891ac9aa73f3","sort_order":1},{"id":"60f826efe7634f04c892bf59","post_id":"606d7a485d6c891ac9aa7242","tag_id":"60f826efe7634f04c892bf55","sort_order":2},{"id":"60f826efe7634f04c892bf5a","post_id":"606d7a485d6c891ac9aa7242","tag_id":"607f43b65d6c891ac9aa7462","sort_order":3},{"id":"60f826efe7634f04c892bf5b","post_id":"606d7a485d6c891ac9aa7242","tag_id":"60f826efe7634f04c892bf56","sort_order":4},{"id":"6375205ff20ac751bf7a5ed8","post_id":"6375187bf20ac751bf7a5ea9","tag_id":"6375205ff20ac751bf7a5ed5","sort_order":0},{"id":"6375205ff20ac751bf7a5ed9","post_id":"6375187bf20ac751bf7a5ea9","tag_id":"6375205ff20ac751bf7a5ed6","sort_order":1},{"id":"6375205ff20ac751bf7a5eda","post_id":"6375187bf20ac751bf7a5ea9","tag_id":"6375205ff20ac751bf7a5ed7","sort_order":2},{"id":"6384aec0f20ac751bf7a620b","post_id":"6379e4e9f20ac751bf7a5ee3","tag_id":"6384aec0f20ac751bf7a6208","sort_order":0},{"id":"6384aec0f20ac751bf7a620c","post_id":"6379e4e9f20ac751bf7a5ee3","tag_id":"6384aec0f20ac751bf7a6209","sort_order":1},{"id":"6384aec0f20ac751bf7a620d","post_id":"6379e4e9f20ac751bf7a5ee3","tag_id":"6384aec0f20ac751bf7a620a","sort_order":2},{"id":"6384e794f20ac751bf7a62e9","post_id":"6384c8a2f20ac751bf7a621a","tag_id":"6375205ff20ac751bf7a5ed5","sort_order":0},{"id":"6384e794f20ac751bf7a62ea","post_id":"6384c8a2f20ac751bf7a621a","tag_id":"6384e794f20ac751bf7a62e6","sort_order":1},{"id":"6384e794f20ac751bf7a62eb","post_id":"6384c8a2f20ac751bf7a621a","tag_id":"6384e794f20ac751bf7a62e7","sort_order":2},{"id":"6384e794f20ac751bf7a62ec","post_id":"6384c8a2f20ac751bf7a621a","tag_id":"6384e794f20ac751bf7a62e8","sort_order":3},{"id":"63865bf3bbda300a2f29c021","post_id":"6384f541f20ac751bf7a62f3","tag_id":"63865bf3bbda300a2f29c01e","sort_order":0},{"id":"63865bf3bbda300a2f29c022","post_id":"6384f541f20ac751bf7a62f3","tag_id":"63865bf3bbda300a2f29c01f","sort_order":1},{"id":"63865bf3bbda300a2f29c023","post_id":"6384f541f20ac751bf7a62f3","tag_id":"63865bf3bbda300a2f29c020","sort_order":2},{"id":"6387919abbda300a2f29c415","post_id":"6386ffb8bbda300a2f29c029","tag_id":"6387919abbda300a2f29c410","sort_order":0},{"id":"6387919abbda300a2f29c416","post_id":"6386ffb8bbda300a2f29c029","tag_id":"6387919abbda300a2f29c411","sort_order":1},{"id":"6387919abbda300a2f29c417","post_id":"6386ffb8bbda300a2f29c029","tag_id":"6384e794f20ac751bf7a62e6","sort_order":2},{"id":"6387919abbda300a2f29c418","post_id":"6386ffb8bbda300a2f29c029","tag_id":"6384e794f20ac751bf7a62e7","sort_order":3},{"id":"6387919abbda300a2f29c419","post_id":"6386ffb8bbda300a2f29c029","tag_id":"6387919abbda300a2f29c412","sort_order":4},{"id":"6387919abbda300a2f29c41a","post_id":"6386ffb8bbda300a2f29c029","tag_id":"6387919abbda300a2f29c413","sort_order":5},{"id":"6387919abbda300a2f29c41b","post_id":"6386ffb8bbda300a2f29c029","tag_id":"6387919abbda300a2f29c414","sort_order":6},{"id":"639a39b9bbda300a2f29c6b8","post_id":"639a2d70bbda300a2f29c627","tag_id":"6384e794f20ac751bf7a62e7","sort_order":0},{"id":"639a39b9bbda300a2f29c6b9","post_id":"639a2d70bbda300a2f29c627","tag_id":"639a39b9bbda300a2f29c6b6","sort_order":1},{"id":"639a39b9bbda300a2f29c6ba","post_id":"639a2d70bbda300a2f29c627","tag_id":"639a39b9bbda300a2f29c6b7","sort_order":2},{"id":"63c6e993bbda300a2f29c854","post_id":"63c6d6b0bbda300a2f29c6c6","tag_id":"6375205ff20ac751bf7a5ed5","sort_order":0},{"id":"63c6e993bbda300a2f29c855","post_id":"63c6d6b0bbda300a2f29c6c6","tag_id":"6384e794f20ac751bf7a62e6","sort_order":1},{"id":"63c6e993bbda300a2f29c856","post_id":"63c6d6b0bbda300a2f29c6c6","tag_id":"63c6e993bbda300a2f29c851","sort_order":2},{"id":"63c6e993bbda300a2f29c857","post_id":"63c6d6b0bbda300a2f29c6c6","tag_id":"63c6e993bbda300a2f29c852","sort_order":3},{"id":"63c6e993bbda300a2f29c858","post_id":"63c6d6b0bbda300a2f29c6c6","tag_id":"63c6e993bbda300a2f29c853","sort_order":4},{"id":"63c9fa00bbda300a2f29ca56","post_id":"63c9d7b4bbda300a2f29c85f","tag_id":"6375205ff20ac751bf7a5ed5","sort_order":0},{"id":"63c9fa00bbda300a2f29ca57","post_id":"63c9d7b4bbda300a2f29c85f","tag_id":"6384e794f20ac751bf7a62e6","sort_order":1},{"id":"63c9fa00bbda300a2f29ca58","post_id":"63c9d7b4bbda300a2f29c85f","tag_id":"63c9fa00bbda300a2f29ca53","sort_order":2},{"id":"63c9fa00bbda300a2f29ca59","post_id":"63c9d7b4bbda300a2f29c85f","tag_id":"63c9fa00bbda300a2f29ca54","sort_order":3},{"id":"63c9fa00bbda300a2f29ca5a","post_id":"63c9d7b4bbda300a2f29c85f","tag_id":"63c9fa00bbda300a2f29ca55","sort_order":4},{"id":"63cc4b6cbbda300a2f29cdbc","post_id":"63cc1ff5bbda300a2f29cb53","tag_id":"63cc4b6cbbda300a2f29cdba","sort_order":0},{"id":"63cc4b6cbbda300a2f29cdbd","post_id":"63cc1ff5bbda300a2f29cb53","tag_id":"6384e794f20ac751bf7a62e7","sort_order":1},{"id":"63cc4b6cbbda300a2f29cdbe","post_id":"63cc1ff5bbda300a2f29cb53","tag_id":"63cc4b6cbbda300a2f29cdbb","sort_order":2},{"id":"63cdc21ebbda300a2f29cff4","post_id":"63cd9d9ebbda300a2f29cdc6","tag_id":"63cdc21ebbda300a2f29cff3","sort_order":0},{"id":"63cdc21ebbda300a2f29cff5","post_id":"63cd9d9ebbda300a2f29cdc6","tag_id":"6375205ff20ac751bf7a5ed5","sort_order":1},{"id":"63cdc21ebbda300a2f29cff6","post_id":"63cd9d9ebbda300a2f29cdc6","tag_id":"63c9fa00bbda300a2f29ca54","sort_order":2},{"id":"63cdc21ebbda300a2f29cff7","post_id":"63cd9d9ebbda300a2f29cdc6","tag_id":"63cc4b6cbbda300a2f29cdbb","sort_order":3},{"id":"63e3d006bbda300a2f29d2d8","post_id":"63e3962dbbda300a2f29cffd","tag_id":"639a39b9bbda300a2f29c6b7","sort_order":0},{"id":"63e3d006bbda300a2f29d2d9","post_id":"63e3962dbbda300a2f29cffd","tag_id":"607f4bbd5d6c891ac9aa751c","sort_order":1},{"id":"63ee2d40bbda300a2f29d40b","post_id":"63ee10a8bbda300a2f29d2df","tag_id":"63ee2d40bbda300a2f29d40a","sort_order":0},{"id":"63f1ef05bbda300a2f29d45b","post_id":"63f1e7b7bbda300a2f29d411","tag_id":"63f1ef05bbda300a2f29d45a","sort_order":0},{"id":"63f1ef05bbda300a2f29d45c","post_id":"63f1e7b7bbda300a2f29d411","tag_id":"6384e794f20ac751bf7a62e6","sort_order":1},{"id":"63f43fcabbda300a2f29d4de","post_id":"63f43262bbda300a2f29d463","tag_id":"6375205ff20ac751bf7a5ed5","sort_order":0},{"id":"63f43fcabbda300a2f29d4df","post_id":"63f43262bbda300a2f29d463","tag_id":"63ee2d40bbda300a2f29d40a","sort_order":1},{"id":"63f43fcabbda300a2f29d4e0","post_id":"63f43262bbda300a2f29d463","tag_id":"6384e794f20ac751bf7a62e7","sort_order":2},{"id":"63f43fcabbda300a2f29d4e1","post_id":"63f43262bbda300a2f29d463","tag_id":"63f43fcabbda300a2f29d4dd","sort_order":3},{"id":"64003955bbda300a2f29d55d","post_id":"64002f89bbda300a2f29d4ed","tag_id":"64003955bbda300a2f29d55c","sort_order":0},{"id":"640039d3bbda300a2f29d563","post_id":"64002f89bbda300a2f29d4ed","tag_id":"640039d3bbda300a2f29d561","sort_order":1},{"id":"640039d3bbda300a2f29d564","post_id":"64002f89bbda300a2f29d4ed","tag_id":"640039d3bbda300a2f29d562","sort_order":2},{"id":"6409a1e1bbda300a2f29d820","post_id":"640936aabbda300a2f29d56c","tag_id":"6409a1e1bbda300a2f29d81d","sort_order":0},{"id":"6409a1e1bbda300a2f29d821","post_id":"640936aabbda300a2f29d56c","tag_id":"6409a1e1bbda300a2f29d81e","sort_order":1},{"id":"6409a1e1bbda300a2f29d822","post_id":"640936aabbda300a2f29d56c","tag_id":"6409a1e1bbda300a2f29d81f","sort_order":2},{"id":"641552b80f360525ad851860","post_id":"64154ee60f360525ad851806","tag_id":"6375205ff20ac751bf7a5ed5","sort_order":0},{"id":"641552b80f360525ad851861","post_id":"64154ee60f360525ad851806","tag_id":"641552b80f360525ad85185e","sort_order":1},{"id":"641552b80f360525ad851862","post_id":"64154ee60f360525ad851806","tag_id":"641552b80f360525ad85185f","sort_order":2},{"id":"641552b80f360525ad851863","post_id":"64154ee60f360525ad851806","tag_id":"640039d3bbda300a2f29d562","sort_order":3},{"id":"6417f1970f360525ad8518f1","post_id":"6417e0c70f360525ad85186a","tag_id":"640039d3bbda300a2f29d562","sort_order":0},{"id":"6417f1970f360525ad8518f2","post_id":"6417e0c70f360525ad85186a","tag_id":"6417f1970f360525ad8518ee","sort_order":1},{"id":"6417f1970f360525ad8518f3","post_id":"6417e0c70f360525ad85186a","tag_id":"6417f1970f360525ad8518ef","sort_order":2},{"id":"6417f1970f360525ad8518f4","post_id":"6417e0c70f360525ad85186a","tag_id":"6417f1970f360525ad8518f0","sort_order":3},{"id":"641f9b6e99d7a498d8917d20","post_id":"641e5d1b4e210aabcb6e1625","tag_id":"641f9b6e99d7a498d8917d1e","sort_order":0},{"id":"641f9b6e99d7a498d8917d21","post_id":"641e5d1b4e210aabcb6e1625","tag_id":"641f9b6e99d7a498d8917d1f","sort_order":1},{"id":"641f9b6e99d7a498d8917d22","post_id":"641e5d1b4e210aabcb6e1625","tag_id":"6384e794f20ac751bf7a62e7","sort_order":2},{"id":"6422d2f599d7a498d8917d6b","post_id":"6422832d99d7a498d8917d2e","tag_id":"6422d2f599d7a498d8917d69","sort_order":0},{"id":"6422d2f599d7a498d8917d6c","post_id":"6422832d99d7a498d8917d2e","tag_id":"6422d2f599d7a498d8917d6a","sort_order":1},{"id":"6422d2f599d7a498d8917d6d","post_id":"6422832d99d7a498d8917d2e","tag_id":"6375205ff20ac751bf7a5ed5","sort_order":2},{"id":"642e549cc61a14d8a5114972","post_id":"642e545bc61a14d8a5114967","tag_id":"642e549cc61a14d8a5114971","sort_order":0}],"products":[{"id":"608b196c5786540883bcbf03","name":"Ghost Subscription","slug":"ghost-subscription","created_at":"2021-04-29T20:39:08.000Z","updated_at":null,"description":null,"monthly_price_id":null,"yearly_price_id":null,"type":"paid","active":1,"welcome_page_url":"/","visibility":"public","trial_days":0,"monthly_price":500,"yearly_price":5000,"currency":"usd"},{"id":"640b49f20f360525ad85156a","name":"Free","slug":"640b49f20f360525ad85156a","created_at":"2023-03-10T15:17:06.000Z","updated_at":null,"description":null,"monthly_price_id":null,"yearly_price_id":null,"type":"free","active":1,"welcome_page_url":"/","visibility":"public","trial_days":0,"monthly_price":null,"yearly_price":null,"currency":null}],"products_benefits":[],"roles":[{"id":"606d737dcbc39943048fcfb6","name":"Administrator","description":"Administrators","created_at":"2021-04-07T08:55:25.000Z","updated_at":"2021-04-07T08:55:25.000Z"},{"id":"606d737dcbc39943048fcfb7","name":"Editor","description":"Editors","created_at":"2021-04-07T08:55:25.000Z","updated_at":"2021-04-07T08:55:25.000Z"},{"id":"606d737dcbc39943048fcfb8","name":"Author","description":"Authors","created_at":"2021-04-07T08:55:25.000Z","updated_at":"2021-04-07T08:55:25.000Z"},{"id":"606d737dcbc39943048fcfb9","name":"Contributor","description":"Contributors","created_at":"2021-04-07T08:55:25.000Z","updated_at":"2021-04-07T08:55:25.000Z"},{"id":"606d737dcbc39943048fcfba","name":"Owner","description":"Blog Owner","created_at":"2021-04-07T08:55:25.000Z","updated_at":"2021-04-07T08:55:25.000Z"},{"id":"606d737dcbc39943048fcfbb","name":"Admin Integration","description":"External Apps","created_at":"2021-04-07T08:55:25.000Z","updated_at":"2021-04-07T08:55:25.000Z"},{"id":"606d737dcbc39943048fcfbc","name":"DB Backup Integration","description":"Internal DB Backup Client","created_at":"2021-04-07T08:55:25.000Z","updated_at":"2021-04-07T08:55:25.000Z"},{"id":"606d737dcbc39943048fcfbd","name":"Scheduler Integration","description":"Internal Scheduler Client","created_at":"2021-04-07T08:55:25.000Z","updated_at":"2021-04-07T08:55:25.000Z"},{"id":"640b49ff0f360525ad8515a3","name":"Ghost Explore Integration","description":"Internal Integration for the Ghost Explore directory","created_at":"2023-03-10T15:17:19.000Z","updated_at":null},{"id":"642e299bbd641cd7931bf534","name":"Self-Serve Migration Integration","description":"Core Integration for the Ghost Explore directory","created_at":"2023-04-06T02:08:27.000Z","updated_at":null}],"roles_users":[{"id":"606d737fcbc39943048fd00e","role_id":"606d737dcbc39943048fcfb9","user_id":"5951f5fca366002ebd5dbef7"},{"id":"606d7383cbc39943048fd10d","role_id":"606d737dcbc39943048fcfba","user_id":"1"},{"id":"606d7a3d5d6c891ac9aa7240","role_id":"606d737dcbc39943048fcfb6","user_id":"606d7a3d5d6c891ac9aa723f"},{"id":"606d7c205d6c891ac9aa725e","role_id":"606d737dcbc39943048fcfb6","user_id":"606d7c205d6c891ac9aa725d"},{"id":"606d7ea85d6c891ac9aa729a","role_id":"606d737dcbc39943048fcfb8","user_id":"606d7ea75d6c891ac9aa7299"}],"settings":[{"id":"606d7385cbc39943048fd10e","group":"core","key":"db_hash","value":"1d4fc43c-a524-4933-8f83-0cd42a57f400","type":"string","flags":null,"created_at":"2021-04-07T08:55:36.000Z","updated_at":"2021-04-07T08:55:36.000Z"},{"id":"606d7385cbc39943048fd10f","group":"core","key":"routes_hash","value":"fd573775449ee56dc6cbfb013d2729ca","type":"string","flags":null,"created_at":"2021-04-07T08:55:36.000Z","updated_at":"2023-02-16T06:22:42.000Z"},{"id":"606d7385cbc39943048fd110","group":"core","key":"next_update_check","value":"1693742545","type":"number","flags":null,"created_at":"2021-04-07T08:55:36.000Z","updated_at":"2023-09-02T12:02:25.000Z"},{"id":"606d7385cbc39943048fd111","group":"core","key":"notifications","value":"[{\"dismissible\":true,\"location\":\"bottom\",\"status\":\"alert\",\"id\":\"dc9d2a40-f484-11eb-9822-9716424d2a07\",\"custom\":false,\"createdAt\":\"2021-08-03T17:01:43.000Z\",\"type\":\"info\",\"top\":false,\"message\":\"Ghost <a href=\\\"https://github.com/TryGhost/Ghost/releases\\\">4.11.0</a> has been released, <a href=\\\"https://ghost.org/update/?v=4.3.3\\\">click here</a> to upgrade.\",\"seen\":false,\"addedAt\":\"2021-08-15T23:21:46.816Z\"},{\"dismissible\":true,\"location\":\"bottom\",\"status\":\"alert\",\"id\":\"08d31d49-170c-46bf-a9a3-017a861a64da\",\"custom\":true,\"createdAt\":\"2022-06-15T02:36:08.000Z\",\"type\":\"alert\",\"top\":false,\"message\":\"Critical security update available — please update Ghost as soon as possible. <a href=\\\"https://github.com/TryGhost/Ghost/security/advisories/GHSA-7v28-g2pq-ggg8\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\">Details here.</a>\",\"seen\":true,\"addedAt\":\"2022-11-16T17:05:11.623Z\",\"seenBy\":[\"1\"]}]","type":"array","flags":null,"created_at":"2021-04-07T08:55:36.000Z","updated_at":"2022-11-26T12:49:29.000Z"},{"id":"606d7385cbc39943048fd112","group":"core","key":"admin_session_secret","value":"e88857c798ef109d1ac8d61c18fe75b160719606158cb93a0a5961f13d7f9ea6","type":"string","flags":null,"created_at":"2021-04-07T08:55:36.000Z","updated_at":"2021-04-07T08:55:36.000Z"},{"id":"606d7385cbc39943048fd113","group":"core","key":"theme_session_secret","value":"f3d75e4f2ccc36627797e0a7ace5d80a606c0b07f352c0d2d84ec877012aff77","type":"string","flags":null,"created_at":"2021-04-07T08:55:36.000Z","updated_at":"2021-04-07T08:55:36.000Z"},{"id":"606d7387cbc39943048fd114","group":"core","key":"ghost_public_key","value":"-----BEGIN RSA PUBLIC KEY-----\nMIGJAoGBAKoGkzcb8ZRKYpS6xi/YpuluZfcriNzobSUv9RjvaYnAc+4Hko1PmhtVKpKYbVO8\nrDyAlbPFtI4flGuMllE9dPywz7z8oAPltCRGL6Ng2CRZ4oOAYI1UArYHYeYC8bVEr4QuHIhZ\nTWafD18xeMVVWv0aaHmEk6Dz8iiESfZeYvPlAgMBAAE=\n-----END RSA PUBLIC KEY-----\n","type":"string","flags":null,"created_at":"2021-04-07T08:55:36.000Z","updated_at":"2021-04-07T08:55:36.000Z"},{"id":"606d7387cbc39943048fd115","group":"core","key":"ghost_private_key","value":"-----BEGIN RSA PRIVATE KEY-----\nMIICXAIBAAKBgQCqBpM3G/GUSmKUusYv2KbpbmX3K4jc6G0lL/UY72mJwHPuB5KNT5obVSqS\nmG1TvKw8gJWzxbSOH5RrjJZRPXT8sM+8/KAD5bQkRi+jYNgkWeKDgGCNVAK2B2HmAvG1RK+E\nLhyIWU1mnw9fMXjFVVr9Gmh5hJOg8/IohEn2XmLz5QIDAQABAoGAYb1J34I2y5I/PVRpHZQj\nz0jhYMcr9CHArIH3GZB3UPLLMeg0fPtnkZLR2Fe7cUmikV0xsZhThOfugCzfNHBp0O9t6Rmp\nzwkq6SKkgT7ztZiX746/na8R2+1RTxXaPgoLFI3dHH+NSe67PUe0t16EcmoZE4X9g7eyd/9x\n3zVHbrkCQQDsY5Fh/3MjKe8fJnrIESf3YrEKlQ1nnODBQJzkp0piPhjEm10QDOgaZbguC2C3\n32PCXvgoEx1nyk1ywmJiGM23AkEAuCGVU14CVz65painoPc6RdcxZas7w3eMTL12Wjp2mPBx\nndDYrhDnkiZeycp+IRsaCkNxd5EYkfiXQOt2T2PLQwJBAKwQAWeaf90tjc9Xu/Fag4PPQ1yX\nh81OZE5mUI0is8L0viSFjeS78EoelkR1pa3RHZUCeZD58OJ2X49TrDcJJNsCQAcG2RD+ZG55\n6VHGFueQp7ukk7ECkNxLwqHnFQ4qbv41JtDT+IDkCkJMjo9618dhpmO/4SOj+OERMIx8r94l\nu8sCQCubZ+KAdXTMDErdW9Pc3LreTWFXe8I74CpMs2YT8zdiScJuzEhw+/ceUMothArpPJfu\n2JRACp8sgc+D8cLfkgA=\n-----END RSA PRIVATE KEY-----\n","type":"string","flags":null,"created_at":"2021-04-07T08:55:36.000Z","updated_at":"2021-04-07T08:55:36.000Z"},{"id":"606d7388cbc39943048fd116","group":"core","key":"members_public_key","value":"-----BEGIN RSA PUBLIC KEY-----\nMIGJAoGBAKTLFn7/6dLfV87TsNxEPd9KgexT9KEtWOv68xgdBagS81LvLtKwoV5vpOvz5Xh/\nrTXj3vuCwuHIIqKqb4m7IlyhmgiHqyPQJbaWvcqLPVk/IoOm+BXkDcK9+Rs5cSX7Y4WPNhfV\nDIYiCHB4pQNblm7Yr7fno1DnOSIrqIUeVLARAgMBAAE=\n-----END RSA PUBLIC KEY-----\n","type":"string","flags":null,"created_at":"2021-04-07T08:55:36.000Z","updated_at":"2021-04-07T08:55:36.000Z"},{"id":"606d7388cbc39943048fd117","group":"core","key":"members_private_key","value":"-----BEGIN RSA PRIVATE KEY-----\nMIICXQIBAAKBgQCkyxZ+/+nS31fO07DcRD3fSoHsU/ShLVjr+vMYHQWoEvNS7y7SsKFeb6Tr\n8+V4f6014977gsLhyCKiqm+JuyJcoZoIh6sj0CW2lr3Kiz1ZPyKDpvgV5A3CvfkbOXEl+2OF\njzYX1QyGIghweKUDW5Zu2K+356NQ5zkiK6iFHlSwEQIDAQABAoGAYljxrAl+umKgPMcJner8\nIe6Na0UPkcFGeE7kFVf8sDnfDXfBMexH4dwvSMHeCPPpo2fDA8ceFzEhuoKM3l3YOwXbCq2E\nExslmlztG+A5TCzRh4CQuLrny4atGY3BZVbBFi3QCNiLi/q4ku+NUx4bJMKZlBh/V3s9URsr\n/2uHR4ECQQD7pOZhp7GgoVHElYDBVjrO7OMoQ+2cHOER/gMMnb9j1usWlFsyenOnvcr/f5/d\nfMcznhqNAQnyTJu6HhzNKkEFAkEAp6VUXETlIFPRWgqX7lAueTsYwfzuw2h81OyWqgFNZ5h1\nF3VybwRm8x1DcyzOf7wd5Nttlf2LiN5pRkGAgviQnQJAOUEQhcGAwZpSn1agn9x9rtzo5h1m\nb3GGp/BSQ0mU5SNeA5onkbmYnN6q1Cz2c49TR2Q+iDxnRfC2McduKCPn/QJBAIenChoXTWfZ\nKt+3DrUxgElsfl4J8pF/7PLF9iveHeojvSucR1p5r2wtU7TQns9RQsc6nvPtU4kOnxTQT9Kq\nmykCQQCT3bn1uDvP9LC42tVAzD/GCIMgmsScwFMx+zMHSLLCCnUqup6mH/yZ7XUwa9VNTt50\nRyFkpYWf5Hs3bw5IoCU1\n-----END RSA PRIVATE KEY-----\n","type":"string","flags":null,"created_at":"2021-04-07T08:55:36.000Z","updated_at":"2021-04-07T08:55:36.000Z"},{"id":"606d7388cbc39943048fd118","group":"core","key":"members_email_auth_secret","value":"df07d700774cbb8e6bb436fda4860eeb21ea577a618025548551fb0778853962e7ef889acdd419cf7443b4ff7804ca290aca85ed58eb095cdc08263f711d7dcb","type":"string","flags":null,"created_at":"2021-04-07T08:55:36.000Z","updated_at":"2021-04-07T08:55:36.000Z"},{"id":"606d7388cbc39943048fd11b","group":"site","key":"title","value":"Precise Lab","type":"string","flags":"PUBLIC","created_at":"2021-04-07T08:55:36.000Z","updated_at":"2021-04-07T09:04:48.000Z"},{"id":"606d7388cbc39943048fd11c","group":"site","key":"description","value":"Software House","type":"string","flags":"PUBLIC","created_at":"2021-04-07T08:55:36.000Z","updated_at":"2021-04-07T10:38:25.000Z"},{"id":"606d7388cbc39943048fd11d","group":"site","key":"logo","value":"__GHOST_URL__/content/images/2021/04/logo-1.png","type":"string","flags":null,"created_at":"2021-04-07T08:55:36.000Z","updated_at":"2021-04-07T11:01:53.000Z"},{"id":"606d7388cbc39943048fd11e","group":"site","key":"cover_image","value":"__GHOST_URL__/content/images/2021/04/section-BG-dark.jpg","type":"string","flags":null,"created_at":"2021-04-07T08:55:36.000Z","updated_at":"2021-04-07T10:42:41.000Z"},{"id":"606d7388cbc39943048fd11f","group":"site","key":"icon","value":"__GHOST_URL__/content/images/2021/04/favicon-1.png","type":"string","flags":null,"created_at":"2021-04-07T08:55:36.000Z","updated_at":"2021-04-07T11:01:53.000Z"},{"id":"606d7388cbc39943048fd120","group":"site","key":"accent_color","value":"#000000","type":"string","flags":"PUBLIC","created_at":"2021-04-07T08:55:36.000Z","updated_at":"2021-04-07T10:58:09.000Z"},{"id":"606d7388cbc39943048fd121","group":"site","key":"locale","value":"en","type":"string","flags":null,"created_at":"2021-04-07T08:55:36.000Z","updated_at":"2021-04-07T08:55:36.000Z"},{"id":"606d7388cbc39943048fd122","group":"site","key":"timezone","value":"Europe/Warsaw","type":"string","flags":null,"created_at":"2021-04-07T08:55:36.000Z","updated_at":"2021-04-30T18:29:49.000Z"},{"id":"606d7388cbc39943048fd123","group":"site","key":"codeinjection_head","value":"<script src=\"https://polyfill.io/v3/polyfill.min.js?features=es6\"></script>\n<script id=\"MathJax-script\" async src=\"https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js\"></script>\n\n<link rel=\"stylesheet\" href=\"https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css\" integrity=\"sha512-vswe+cgvic/XBoF1OcM/TeJ2FW0OofqAVdCZiEYkd6dwGXthvkSFWOoGGJgS2CW70VK5dQM5Oh+7ne47s74VTg==\" crossorigin=\"anonymous\" referrerpolicy=\"no-referrer\" />\n<link rel=\"stylesheet\" href=\"https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/diff-highlight/prism-diff-highlight.min.css\" integrity=\"sha512-rErSjI34XKsATVf+BW6GnuWVmj7imdMR7AIyb4ydHhiMFewUiJOeN9bYO35iCgdG+3Bxkl0GkAs0E8hrDYooLA==\" crossorigin=\"anonymous\" referrerpolicy=\"no-referrer\" />\n\n<script async src=\"https://www.googletagmanager.com/gtag/js?id=G-7Z0RZ51CSF\"></script>\n<script>\n  window.dataLayer = window.dataLayer || [];\n  function gtag(){dataLayer.push(arguments);}\n  gtag('js', new Date());\n\n  gtag('config', 'G-7Z0RZ51CSF');\n</script>\n\n<!-- Latex in \\[ \\] -->\n<link rel=\"stylesheet\" href=\"https://cdn.jsdelivr.net/npm/katex@0.10.1/dist/katex.css\" crossorigin=\"anonymous\">\n<script defer src=\"https://cdn.jsdelivr.net/npm/katex@0.10.1/dist/katex.js\" crossorigin=\"anonymous\"></script>\n<script defer src=\"https://cdn.jsdelivr.net/npm/katex@0.10.1/dist/contrib/auto-render.min.js\" crossorigin=\"anonymous\" onload=\"renderMathInElement(document.body);\"></script>\n<!-- Latex in \\[ \\] -->","type":"string","flags":null,"created_at":"2021-04-07T08:55:36.000Z","updated_at":"2023-04-06T01:03:47.000Z"},{"id":"606d7388cbc39943048fd124","group":"site","key":"codeinjection_foot","value":"<script src=\"https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js\" integrity=\"sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==\" crossorigin=\"anonymous\" referrerpolicy=\"no-referrer\"></script>\n<script src=\"https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-diff.min.js\" integrity=\"sha512-tBR4SAva+2bw36ToxaFeOEvgqxWHON25E9xp+kEBfw175sS5OusQEH8GrigKgTdHUXcKsK1yiyfo7fctBYl+rA==\" crossorigin=\"anonymous\" referrerpolicy=\"no-referrer\"></script>\n<script src=\"https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-json.min.js\" integrity=\"sha512-QXFMVAusM85vUYDaNgcYeU3rzSlc+bTV4JvkfJhjxSHlQEo+ig53BtnGkvFTiNJh8D+wv6uWAQ2vJaVmxe8d3w==\" crossorigin=\"anonymous\" referrerpolicy=\"no-referrer\"></script>\n<script src=\"https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-bash.min.js\" integrity=\"sha512-whYhDwtTmlC/NpZlCr6PSsAaLOrfjVg/iXAnC4H/dtiHawpShhT2SlIMbpIhT/IL/NrpdMm+Hq2C13+VKpHTYw==\" crossorigin=\"anonymous\" referrerpolicy=\"no-referrer\"></script>\n<script src=\"https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-typescript.min.js\" integrity=\"sha512-uOw7XYETzS/DPmmirpP5UCMihSDNMeyTS965J0/456OSPfxn9xEtHHjj5Q/5WefVdqyMfN/afmQnNpZd/tpkcA==\" crossorigin=\"anonymous\" referrerpolicy=\"no-referrer\"></script>\n<script src=\"https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-rust.min.js\" integrity=\"sha512-R/HpMlNfZZV6DxMhNz1dYJbBaPBVSOCqX8imo3uGUurhPDHRcXrBxkEVOjawwUwTMfOqT6t1eLYYQXIjFWCX/A==\" crossorigin=\"anonymous\" referrerpolicy=\"no-referrer\"></script>\n<script src=\"https://cdnjs.cloudflare.com/ajax/libs/prism/9000.0.1/components/prism-go.min.js\" integrity=\"sha512-19J5mMl3tkNptyMFkeBLHmdNi6f6l7quYk69/kiTgk4UNmxRCkdVCMkqPvoAQ7CE6fZQzz7Hp8VECXDpi7g5mw==\" crossorigin=\"anonymous\" referrerpolicy=\"no-referrer\"></script>\n\n\n<script type=\"text/javascript\">\n    var HYVOR_TALK_WEBSITE = 3947;\n    var HYVOR_TALK_CONFIG = {\n        url: false,\n        id: false\n    };\n</script>\n<script async type=\"text/javascript\" src=\"//talk.hyvor.com/web-api/embed.js\"></script>\n\n<script>\n    System = {Console:{WriteLine:console.log}}\n</script>","type":"string","flags":null,"created_at":"2021-04-07T08:55:36.000Z","updated_at":"2023-02-21T07:21:33.000Z"},{"id":"606d7388cbc39943048fd125","group":"site","key":"facebook","value":null,"type":"string","flags":null,"created_at":"2021-04-07T08:55:36.000Z","updated_at":"2022-11-28T13:02:57.000Z"},{"id":"606d7388cbc39943048fd126","group":"site","key":"twitter","value":"@PreciseLabPL","type":"string","flags":null,"created_at":"2021-04-07T08:55:36.000Z","updated_at":"2021-04-30T18:29:49.000Z"},{"id":"606d7388cbc39943048fd127","group":"site","key":"navigation","value":"[{\"label\":\"Portfolio\",\"url\":\"/portfolio/\"},{\"label\":\"Team\",\"url\":\"/team/\"},{\"label\":\"Contact\",\"url\":\"/contact/\"}]","type":"array","flags":null,"created_at":"2021-04-07T08:55:36.000Z","updated_at":"2021-04-07T10:38:25.000Z"},{"id":"606d7388cbc39943048fd128","group":"site","key":"secondary_navigation","value":"[{\"label\":\"Portfolio\",\"url\":\"/portfolio/\"},{\"label\":\"Team\",\"url\":\"/team/\"},{\"label\":\"Contact\",\"url\":\"/contact/\"}]","type":"array","flags":null,"created_at":"2021-04-07T08:55:36.000Z","updated_at":"2021-04-07T11:00:51.000Z"},{"id":"606d7388cbc39943048fd129","group":"site","key":"meta_title","value":"Precise Lab - Software House","type":"string","flags":null,"created_at":"2021-04-07T08:55:36.000Z","updated_at":"2021-04-07T12:55:16.000Z"},{"id":"606d7388cbc39943048fd12a","group":"site","key":"meta_description","value":"Software House. We are creating with node js, fastify, graphql, apollo, strapi, nuxt. W love scraping, big data, kafka, mongodb and data processing.","type":"string","flags":null,"created_at":"2021-04-07T08:55:36.000Z","updated_at":"2021-04-30T18:29:49.000Z"},{"id":"606d7388cbc39943048fd12b","group":"site","key":"og_image","value":null,"type":"string","flags":null,"created_at":"2021-04-07T08:55:36.000Z","updated_at":"2021-04-07T08:55:36.000Z"},{"id":"606d7388cbc39943048fd12c","group":"site","key":"og_title","value":null,"type":"string","flags":null,"created_at":"2021-04-07T08:55:36.000Z","updated_at":"2021-04-07T08:55:36.000Z"},{"id":"606d7388cbc39943048fd12d","group":"site","key":"og_description","value":"Software House. We are creating with node js, fastify, graphql, apollo, strapi, nuxt. W love scraping, big data, kafka, mongodb and data processing.","type":"string","flags":null,"created_at":"2021-04-07T08:55:36.000Z","updated_at":"2021-04-30T18:29:49.000Z"},{"id":"606d7388cbc39943048fd12e","group":"site","key":"twitter_image","value":null,"type":"string","flags":null,"created_at":"2021-04-07T08:55:36.000Z","updated_at":"2021-04-07T08:55:36.000Z"},{"id":"606d7388cbc39943048fd12f","group":"site","key":"twitter_title","value":null,"type":"string","flags":null,"created_at":"2021-04-07T08:55:36.000Z","updated_at":"2021-04-07T08:55:36.000Z"},{"id":"606d7388cbc39943048fd130","group":"site","key":"twitter_description","value":"Software House. We are creating with node js, fastify, graphql, apollo, strapi, nuxt. W love scraping, big data, kafka, mongodb and data processing.","type":"string","flags":null,"created_at":"2021-04-07T08:55:36.000Z","updated_at":"2021-04-30T18:29:49.000Z"},{"id":"606d7388cbc39943048fd131","group":"theme","key":"active_theme","value":"casper-rss","type":"string","flags":"RO","created_at":"2021-04-07T08:55:36.000Z","updated_at":"2023-02-16T06:24:54.000Z"},{"id":"606d7388cbc39943048fd132","group":"private","key":"is_private","value":"false","type":"boolean","flags":null,"created_at":"2021-04-07T08:55:36.000Z","updated_at":"2021-04-07T08:55:36.000Z"},{"id":"606d7388cbc39943048fd133","group":"private","key":"password","value":"","type":"string","flags":null,"created_at":"2021-04-07T08:55:36.000Z","updated_at":"2021-04-07T08:55:36.000Z"},{"id":"606d7388cbc39943048fd134","group":"private","key":"public_hash","value":"04250ff3b3de5a56d0eafe28c122e8","type":"string","flags":null,"created_at":"2021-04-07T08:55:36.000Z","updated_at":"2021-04-07T08:55:36.000Z"},{"id":"606d7388cbc39943048fd135","group":"members","key":"default_content_visibility","value":"public","type":"string","flags":null,"created_at":"2021-04-07T08:55:36.000Z","updated_at":"2021-04-07T08:55:36.000Z"},{"id":"606d7388cbc39943048fd138","group":"members","key":"members_support_address","value":"noreply","type":"string","flags":"PUBLIC,RO","created_at":"2021-04-07T08:55:36.000Z","updated_at":"2021-04-07T08:55:36.000Z"},{"id":"606d7388cbc39943048fd13f","group":"members","key":"stripe_plans","value":"[{\"name\":\"Monthly\",\"currency\":\"usd\",\"interval\":\"month\",\"amount\":500},{\"name\":\"Yearly\",\"currency\":\"usd\",\"interval\":\"year\",\"amount\":5000}]","type":"array","flags":null,"created_at":"2021-04-07T08:55:36.000Z","updated_at":"2021-04-07T08:55:36.000Z"},{"id":"606d7388cbc39943048fd142","group":"members","key":"stripe_connect_livemode","value":null,"type":"boolean","flags":null,"created_at":"2021-04-07T08:55:36.000Z","updated_at":"2021-04-07T08:55:36.000Z"},{"id":"606d7388cbc39943048fd143","group":"members","key":"stripe_connect_display_name","value":null,"type":"string","flags":null,"created_at":"2021-04-07T08:55:36.000Z","updated_at":"2021-04-07T08:55:36.000Z"},{"id":"606d7388cbc39943048fd145","group":"portal","key":"portal_name","value":"true","type":"boolean","flags":null,"created_at":"2021-04-07T08:55:36.000Z","updated_at":"2021-04-07T08:55:36.000Z"},{"id":"606d7388cbc39943048fd146","group":"portal","key":"portal_button","value":"true","type":"boolean","flags":null,"created_at":"2021-04-07T08:55:36.000Z","updated_at":"2021-04-07T08:55:36.000Z"},{"id":"606d7388cbc39943048fd147","group":"portal","key":"portal_plans","value":"[\"free\",\"monthly\",\"yearly\"]","type":"array","flags":null,"created_at":"2021-04-07T08:55:36.000Z","updated_at":"2021-04-07T09:41:28.000Z"},{"id":"606d7388cbc39943048fd148","group":"portal","key":"portal_button_style","value":"icon-and-text","type":"string","flags":null,"created_at":"2021-04-07T08:55:36.000Z","updated_at":"2021-04-07T08:55:36.000Z"},{"id":"606d7388cbc39943048fd149","group":"portal","key":"portal_button_icon","value":"icon-5","type":"string","flags":null,"created_at":"2021-04-07T08:55:36.000Z","updated_at":"2021-04-30T18:31:39.000Z"},{"id":"606d7388cbc39943048fd14a","group":"portal","key":"portal_button_signup_text","value":"Subscribe","type":"string","flags":null,"created_at":"2021-04-07T08:55:36.000Z","updated_at":"2021-04-07T08:55:36.000Z"},{"id":"606d7388cbc39943048fd14b","group":"email","key":"mailgun_domain","value":null,"type":"string","flags":null,"created_at":"2021-04-07T08:55:36.000Z","updated_at":"2021-04-07T08:55:36.000Z"},{"id":"606d7388cbc39943048fd14c","group":"email","key":"mailgun_api_key","value":null,"type":"string","flags":null,"created_at":"2021-04-07T08:55:36.000Z","updated_at":"2021-04-07T08:55:36.000Z"},{"id":"606d7388cbc39943048fd14d","group":"email","key":"mailgun_base_url","value":null,"type":"string","flags":null,"created_at":"2021-04-07T08:55:36.000Z","updated_at":"2021-04-07T08:55:36.000Z"},{"id":"606d7388cbc39943048fd14e","group":"email","key":"email_track_opens","value":"true","type":"boolean","flags":null,"created_at":"2021-04-07T08:55:36.000Z","updated_at":"2021-04-07T08:55:36.000Z"},{"id":"606d7388cbc39943048fd14f","group":"amp","key":"amp","value":"true","type":"boolean","flags":null,"created_at":"2021-04-07T08:55:36.000Z","updated_at":"2021-04-07T08:55:36.000Z"},{"id":"606d7388cbc39943048fd150","group":"amp","key":"amp_gtag_id","value":null,"type":"string","flags":null,"created_at":"2021-04-07T08:55:36.000Z","updated_at":"2021-04-07T08:55:36.000Z"},{"id":"606d7388cbc39943048fd151","group":"firstpromoter","key":"firstpromoter","value":"false","type":"boolean","flags":null,"created_at":"2021-04-07T08:55:36.000Z","updated_at":"2021-04-07T08:55:36.000Z"},{"id":"606d7388cbc39943048fd152","group":"firstpromoter","key":"firstpromoter_id","value":null,"type":"string","flags":null,"created_at":"2021-04-07T08:55:36.000Z","updated_at":"2021-04-07T08:55:36.000Z"},{"id":"606d7388cbc39943048fd153","group":"slack","key":"slack_url","value":"","type":"string","flags":null,"created_at":"2021-04-07T08:55:36.000Z","updated_at":"2023-02-21T07:21:33.000Z"},{"id":"606d7388cbc39943048fd154","group":"slack","key":"slack_username","value":"Ghost","type":"string","flags":null,"created_at":"2021-04-07T08:55:36.000Z","updated_at":"2023-02-21T07:21:33.000Z"},{"id":"606d7388cbc39943048fd155","group":"unsplash","key":"unsplash","value":"true","type":"boolean","flags":null,"created_at":"2021-04-07T08:55:36.000Z","updated_at":"2021-04-07T08:55:36.000Z"},{"id":"606d7388cbc39943048fd156","group":"views","key":"shared_views","value":"[]","type":"array","flags":null,"created_at":"2021-04-07T08:55:36.000Z","updated_at":"2021-04-07T08:55:36.000Z"},{"id":"608b196c5786540883bcbf12","group":"members","key":"members_signup_access","value":"all","type":"string","flags":null,"created_at":"2021-04-29T20:39:08.000Z","updated_at":"2021-04-29T20:39:08.000Z"},{"id":"640b49ed0f360525ad851557","group":"labs","key":"labs","value":"{}","type":"object","flags":null,"created_at":"2023-03-10T15:17:01.000Z","updated_at":"2023-03-10T15:17:01.000Z"},{"id":"640b49ee0f360525ad851558","group":"portal","key":"portal_products","value":"[\"608b196c5786540883bcbf03\"]","type":"array","flags":null,"created_at":"2023-03-10T15:17:02.000Z","updated_at":"2023-03-10T15:17:02.000Z"},{"id":"640b49f50f360525ad85156b","group":"members","key":"default_content_visibility_tiers","value":"[]","type":"array","flags":null,"created_at":"2023-03-10T15:17:09.000Z","updated_at":null},{"id":"640b49f90f360525ad85157c","group":"core","key":"version_notifications","value":"[]","type":"array","flags":null,"created_at":"2023-03-10T15:17:13.000Z","updated_at":null},{"id":"640b49ff0f360525ad8515a2","group":"comments","key":"comments_enabled","value":"off","type":"string","flags":null,"created_at":"2023-03-10T15:17:19.000Z","updated_at":null},{"id":"640b4a040f360525ad8515ad","group":"email","key":"email_track_clicks","value":"true","type":"boolean","flags":null,"created_at":"2023-03-10T15:17:24.000Z","updated_at":null},{"id":"640b4a090f360525ad8515b4","group":"members","key":"members_track_sources","value":"true","type":"boolean","flags":null,"created_at":"2023-03-10T15:17:29.000Z","updated_at":null},{"id":"640b4a110f360525ad8515ba","group":"analytics","key":"outbound_link_tagging","value":"true","type":"boolean","flags":null,"created_at":"2023-03-10T15:17:37.000Z","updated_at":null},{"id":"640b4a130f360525ad8515be","group":"members","key":"members_monthly_price_id","value":null,"type":"string","flags":null,"created_at":"2023-03-10T15:17:39.000Z","updated_at":"2023-03-10T15:17:39.000Z"},{"id":"640b4a130f360525ad8515bf","group":"members","key":"members_yearly_price_id","value":null,"type":"string","flags":null,"created_at":"2023-03-10T15:17:39.000Z","updated_at":"2023-03-10T15:17:39.000Z"},{"id":"640b4a130f360525ad8515c0","group":"editor","key":"editor_default_email_recipients","value":"visibility","type":"string","flags":null,"created_at":"2023-03-10T15:17:39.000Z","updated_at":"2023-03-10T15:17:39.000Z"},{"id":"640b4a130f360525ad8515c1","group":"editor","key":"editor_default_email_recipients_filter","value":"all","type":"string","flags":null,"created_at":"2023-03-10T15:17:39.000Z","updated_at":"2023-03-10T15:17:39.000Z"},{"id":"642e299bbd641cd7931bf533","group":"core","key":"last_mentions_report_email_timestamp","value":null,"type":"number","flags":null,"created_at":"2023-04-06T02:08:27.000Z","updated_at":null},{"id":"642e299cbd641cd7931bf53a","group":"portal","key":"portal_signup_terms_html","value":null,"type":"string","flags":null,"created_at":"2023-04-06T02:08:28.000Z","updated_at":null},{"id":"642e299cbd641cd7931bf53b","group":"portal","key":"portal_signup_checkbox_required","value":"false","type":"boolean","flags":null,"created_at":"2023-04-06T02:08:28.000Z","updated_at":null}],"snippets":[],"stripe_prices":[],"stripe_products":[],"tags":[{"id":"607f38e15d6c891ac9aa73f2","name":"xss","slug":"xss","description":null,"feature_image":null,"parent_id":null,"visibility":"public","og_image":null,"og_title":null,"og_description":null,"twitter_image":null,"twitter_title":null,"twitter_description":null,"meta_title":null,"meta_description":null,"codeinjection_head":null,"codeinjection_foot":null,"canonical_url":null,"accent_color":null,"created_at":"2021-04-20T20:26:09.000Z","updated_at":"2021-04-20T20:26:09.000Z"},{"id":"607f38e15d6c891ac9aa73f3","name":"hacking","slug":"hacking","description":null,"feature_image":null,"parent_id":null,"visibility":"public","og_image":null,"og_title":null,"og_description":null,"twitter_image":null,"twitter_title":null,"twitter_description":null,"meta_title":null,"meta_description":null,"codeinjection_head":null,"codeinjection_foot":null,"canonical_url":null,"accent_color":null,"created_at":"2021-04-20T20:26:09.000Z","updated_at":"2021-04-20T20:26:09.000Z"},{"id":"607f38e15d6c891ac9aa73f4","name":"attack","slug":"attack","description":null,"feature_image":null,"parent_id":null,"visibility":"public","og_image":null,"og_title":null,"og_description":null,"twitter_image":null,"twitter_title":null,"twitter_description":null,"meta_title":null,"meta_description":null,"codeinjection_head":null,"codeinjection_foot":null,"canonical_url":null,"accent_color":null,"created_at":"2021-04-20T20:26:09.000Z","updated_at":"2021-04-20T20:26:09.000Z"},{"id":"607f43b65d6c891ac9aa7462","name":"vue","slug":"vue","description":null,"feature_image":null,"parent_id":null,"visibility":"public","og_image":null,"og_title":null,"og_description":null,"twitter_image":null,"twitter_title":null,"twitter_description":null,"meta_title":null,"meta_description":null,"codeinjection_head":null,"codeinjection_foot":null,"canonical_url":null,"accent_color":null,"created_at":"2021-04-20T21:12:22.000Z","updated_at":"2021-04-20T21:12:22.000Z"},{"id":"607f43b65d6c891ac9aa7463","name":"meteor","slug":"meteor","description":null,"feature_image":null,"parent_id":null,"visibility":"public","og_image":null,"og_title":null,"og_description":null,"twitter_image":null,"twitter_title":null,"twitter_description":null,"meta_title":null,"meta_description":null,"codeinjection_head":null,"codeinjection_foot":null,"canonical_url":null,"accent_color":null,"created_at":"2021-04-20T21:12:22.000Z","updated_at":"2021-04-20T21:12:22.000Z"},{"id":"607f4bbd5d6c891ac9aa751b","name":"js","slug":"js","description":null,"feature_image":null,"parent_id":null,"visibility":"public","og_image":null,"og_title":null,"og_description":null,"twitter_image":null,"twitter_title":null,"twitter_description":null,"meta_title":null,"meta_description":null,"codeinjection_head":null,"codeinjection_foot":null,"canonical_url":null,"accent_color":null,"created_at":"2021-04-20T21:46:37.000Z","updated_at":"2021-04-20T21:46:37.000Z"},{"id":"607f4bbd5d6c891ac9aa751c","name":"es6","slug":"es6","description":null,"feature_image":null,"parent_id":null,"visibility":"public","og_image":null,"og_title":null,"og_description":null,"twitter_image":null,"twitter_title":null,"twitter_description":null,"meta_title":null,"meta_description":null,"codeinjection_head":null,"codeinjection_foot":null,"canonical_url":null,"accent_color":null,"created_at":"2021-04-20T21:46:37.000Z","updated_at":"2021-04-20T21:46:37.000Z"},{"id":"607f4bbd5d6c891ac9aa751d","name":"html","slug":"html","description":null,"feature_image":null,"parent_id":null,"visibility":"public","og_image":null,"og_title":null,"og_description":null,"twitter_image":null,"twitter_title":null,"twitter_description":null,"meta_title":null,"meta_description":null,"codeinjection_head":null,"codeinjection_foot":null,"canonical_url":null,"accent_color":null,"created_at":"2021-04-20T21:46:37.000Z","updated_at":"2021-04-20T21:46:37.000Z"},{"id":"607f4bbd5d6c891ac9aa751e","name":"css","slug":"css","description":null,"feature_image":null,"parent_id":null,"visibility":"public","og_image":null,"og_title":null,"og_description":null,"twitter_image":null,"twitter_title":null,"twitter_description":null,"meta_title":null,"meta_description":null,"codeinjection_head":null,"codeinjection_foot":null,"canonical_url":null,"accent_color":null,"created_at":"2021-04-20T21:46:37.000Z","updated_at":"2021-04-20T21:46:37.000Z"},{"id":"60c856eee7634f04c892beb5","name":"mail","slug":"mail","description":null,"feature_image":null,"parent_id":null,"visibility":"public","og_image":null,"og_title":null,"og_description":null,"twitter_image":null,"twitter_title":null,"twitter_description":null,"meta_title":null,"meta_description":null,"codeinjection_head":null,"codeinjection_foot":null,"canonical_url":null,"accent_color":null,"created_at":"2021-06-15T07:29:50.000Z","updated_at":"2021-06-15T07:29:50.000Z"},{"id":"60c856eee7634f04c892beb6","name":"yandex","slug":"yandex","description":null,"feature_image":null,"parent_id":null,"visibility":"public","og_image":null,"og_title":null,"og_description":null,"twitter_image":null,"twitter_title":null,"twitter_description":null,"meta_title":null,"meta_description":null,"codeinjection_head":null,"codeinjection_foot":null,"canonical_url":null,"accent_color":null,"created_at":"2021-06-15T07:29:50.000Z","updated_at":"2021-06-15T07:29:50.000Z"},{"id":"60c856eee7634f04c892beb7","name":"email","slug":"email","description":null,"feature_image":null,"parent_id":null,"visibility":"public","og_image":null,"og_title":null,"og_description":null,"twitter_image":null,"twitter_title":null,"twitter_description":null,"meta_title":null,"meta_description":null,"codeinjection_head":null,"codeinjection_foot":null,"canonical_url":null,"accent_color":null,"created_at":"2021-06-15T07:29:50.000Z","updated_at":"2021-06-15T07:29:50.000Z"},{"id":"60f826efe7634f04c892bf55","name":"bolt","slug":"bolt","description":null,"feature_image":null,"parent_id":null,"visibility":"public","og_image":null,"og_title":null,"og_description":null,"twitter_image":null,"twitter_title":null,"twitter_description":null,"meta_title":null,"meta_description":null,"codeinjection_head":null,"codeinjection_foot":null,"canonical_url":null,"accent_color":null,"created_at":"2021-07-21T13:53:51.000Z","updated_at":"2021-07-21T13:53:51.000Z"},{"id":"60f826efe7634f04c892bf56","name":"MITM","slug":"mitm","description":null,"feature_image":null,"parent_id":null,"visibility":"public","og_image":null,"og_title":null,"og_description":null,"twitter_image":null,"twitter_title":null,"twitter_description":null,"meta_title":null,"meta_description":null,"codeinjection_head":null,"codeinjection_foot":null,"canonical_url":null,"accent_color":null,"created_at":"2021-07-21T13:53:51.000Z","updated_at":"2021-07-21T13:53:51.000Z"},{"id":"6375205ff20ac751bf7a5ed5","name":"rust","slug":"rust","description":null,"feature_image":null,"parent_id":null,"visibility":"public","og_image":null,"og_title":null,"og_description":null,"twitter_image":null,"twitter_title":null,"twitter_description":null,"meta_title":null,"meta_description":null,"codeinjection_head":null,"codeinjection_foot":null,"canonical_url":null,"accent_color":null,"created_at":"2022-11-16T17:39:43.000Z","updated_at":"2022-11-16T17:39:43.000Z"},{"id":"6375205ff20ac751bf7a5ed6","name":"linear search","slug":"linear-search","description":null,"feature_image":null,"parent_id":null,"visibility":"public","og_image":null,"og_title":null,"og_description":null,"twitter_image":null,"twitter_title":null,"twitter_description":null,"meta_title":null,"meta_description":null,"codeinjection_head":null,"codeinjection_foot":null,"canonical_url":null,"accent_color":null,"created_at":"2022-11-16T17:39:43.000Z","updated_at":"2022-11-16T17:39:43.000Z"},{"id":"6375205ff20ac751bf7a5ed7","name":"easy","slug":"easy","description":null,"feature_image":null,"parent_id":null,"visibility":"public","og_image":null,"og_title":null,"og_description":null,"twitter_image":null,"twitter_title":null,"twitter_description":null,"meta_title":null,"meta_description":null,"codeinjection_head":null,"codeinjection_foot":null,"canonical_url":null,"accent_color":null,"created_at":"2022-11-16T17:39:43.000Z","updated_at":"2022-11-16T17:39:43.000Z"},{"id":"6384aec0f20ac751bf7a6208","name":"pulumi","slug":"pulumi","description":null,"feature_image":null,"parent_id":null,"visibility":"public","og_image":null,"og_title":null,"og_description":null,"twitter_image":null,"twitter_title":null,"twitter_description":null,"meta_title":null,"meta_description":null,"codeinjection_head":null,"codeinjection_foot":null,"canonical_url":null,"accent_color":null,"created_at":"2022-11-28T12:51:12.000Z","updated_at":"2022-11-28T12:51:12.000Z"},{"id":"6384aec0f20ac751bf7a6209","name":"iac","slug":"iac","description":null,"feature_image":null,"parent_id":null,"visibility":"public","og_image":null,"og_title":null,"og_description":null,"twitter_image":null,"twitter_title":null,"twitter_description":null,"meta_title":null,"meta_description":null,"codeinjection_head":null,"codeinjection_foot":null,"canonical_url":null,"accent_color":null,"created_at":"2022-11-28T12:51:12.000Z","updated_at":"2022-11-28T12:51:12.000Z"},{"id":"6384aec0f20ac751bf7a620a","name":"deployment","slug":"deployment","description":null,"feature_image":null,"parent_id":null,"visibility":"public","og_image":null,"og_title":null,"og_description":null,"twitter_image":null,"twitter_title":null,"twitter_description":null,"meta_title":null,"meta_description":null,"codeinjection_head":null,"codeinjection_foot":null,"canonical_url":null,"accent_color":null,"created_at":"2022-11-28T12:51:12.000Z","updated_at":"2022-11-28T12:51:12.000Z"},{"id":"6384e794f20ac751bf7a62e6","name":"nodejs","slug":"nodejs","description":null,"feature_image":null,"parent_id":null,"visibility":"public","og_image":null,"og_title":null,"og_description":null,"twitter_image":null,"twitter_title":null,"twitter_description":null,"meta_title":null,"meta_description":null,"codeinjection_head":null,"codeinjection_foot":null,"canonical_url":null,"accent_color":null,"created_at":"2022-11-28T16:53:40.000Z","updated_at":"2022-11-28T16:53:40.000Z"},{"id":"6384e794f20ac751bf7a62e7","name":"typescript","slug":"typescript","description":null,"feature_image":null,"parent_id":null,"visibility":"public","og_image":null,"og_title":null,"og_description":null,"twitter_image":null,"twitter_title":null,"twitter_description":null,"meta_title":null,"meta_description":null,"codeinjection_head":null,"codeinjection_foot":null,"canonical_url":null,"accent_color":null,"created_at":"2022-11-28T16:53:40.000Z","updated_at":"2022-11-28T16:53:40.000Z"},{"id":"6384e794f20ac751bf7a62e8","name":"linear-search","slug":"linear-search-2","description":null,"feature_image":null,"parent_id":null,"visibility":"public","og_image":null,"og_title":null,"og_description":null,"twitter_image":null,"twitter_title":null,"twitter_description":null,"meta_title":null,"meta_description":null,"codeinjection_head":null,"codeinjection_foot":null,"canonical_url":null,"accent_color":null,"created_at":"2022-11-28T16:53:40.000Z","updated_at":"2022-11-28T16:53:40.000Z"},{"id":"63865bf3bbda300a2f29c01e","name":"nuxt","slug":"nuxt","description":null,"feature_image":null,"parent_id":null,"visibility":"public","og_image":null,"og_title":null,"og_description":null,"twitter_image":null,"twitter_title":null,"twitter_description":null,"meta_title":null,"meta_description":null,"codeinjection_head":null,"codeinjection_foot":null,"canonical_url":null,"accent_color":null,"created_at":"2022-11-29T19:22:27.000Z","updated_at":"2022-11-29T19:22:27.000Z"},{"id":"63865bf3bbda300a2f29c01f","name":"strapi","slug":"strapi","description":null,"feature_image":null,"parent_id":null,"visibility":"public","og_image":null,"og_title":null,"og_description":null,"twitter_image":null,"twitter_title":null,"twitter_description":null,"meta_title":null,"meta_description":null,"codeinjection_head":null,"codeinjection_foot":null,"canonical_url":null,"accent_color":null,"created_at":"2022-11-29T19:22:27.000Z","updated_at":"2022-11-29T19:22:27.000Z"},{"id":"63865bf3bbda300a2f29c020","name":"login","slug":"login","description":null,"feature_image":null,"parent_id":null,"visibility":"public","og_image":null,"og_title":null,"og_description":null,"twitter_image":null,"twitter_title":null,"twitter_description":null,"meta_title":null,"meta_description":null,"codeinjection_head":null,"codeinjection_foot":null,"canonical_url":null,"accent_color":null,"created_at":"2022-11-29T19:22:27.000Z","updated_at":"2022-11-29T19:22:27.000Z"},{"id":"6387919abbda300a2f29c410","name":"metamask","slug":"metamask","description":null,"feature_image":null,"parent_id":null,"visibility":"public","og_image":null,"og_title":null,"og_description":null,"twitter_image":null,"twitter_title":null,"twitter_description":null,"meta_title":null,"meta_description":null,"codeinjection_head":null,"codeinjection_foot":null,"canonical_url":null,"accent_color":null,"created_at":"2022-11-30T17:23:38.000Z","updated_at":"2022-11-30T17:23:38.000Z"},{"id":"6387919abbda300a2f29c411","name":"fastify","slug":"fastify","description":null,"feature_image":null,"parent_id":null,"visibility":"public","og_image":null,"og_title":null,"og_description":null,"twitter_image":null,"twitter_title":null,"twitter_description":null,"meta_title":null,"meta_description":null,"codeinjection_head":null,"codeinjection_foot":null,"canonical_url":null,"accent_color":null,"created_at":"2022-11-30T17:23:38.000Z","updated_at":"2022-11-30T17:23:38.000Z"},{"id":"6387919abbda300a2f29c412","name":"jest","slug":"jest","description":null,"feature_image":null,"parent_id":null,"visibility":"public","og_image":null,"og_title":null,"og_description":null,"twitter_image":null,"twitter_title":null,"twitter_description":null,"meta_title":null,"meta_description":null,"codeinjection_head":null,"codeinjection_foot":null,"canonical_url":null,"accent_color":null,"created_at":"2022-11-30T17:23:38.000Z","updated_at":"2022-11-30T17:23:38.000Z"},{"id":"6387919abbda300a2f29c413","name":"prisma","slug":"prisma","description":null,"feature_image":null,"parent_id":null,"visibility":"public","og_image":null,"og_title":null,"og_description":null,"twitter_image":null,"twitter_title":null,"twitter_description":null,"meta_title":null,"meta_description":null,"codeinjection_head":null,"codeinjection_foot":null,"canonical_url":null,"accent_color":null,"created_at":"2022-11-30T17:23:38.000Z","updated_at":"2022-11-30T17:23:38.000Z"},{"id":"6387919abbda300a2f29c414","name":"rest","slug":"rest","description":null,"feature_image":null,"parent_id":null,"visibility":"public","og_image":null,"og_title":null,"og_description":null,"twitter_image":null,"twitter_title":null,"twitter_description":null,"meta_title":null,"meta_description":null,"codeinjection_head":null,"codeinjection_foot":null,"canonical_url":null,"accent_color":null,"created_at":"2022-11-30T17:23:38.000Z","updated_at":"2022-11-30T17:23:38.000Z"},{"id":"639a39b9bbda300a2f29c6b6","name":"signatures","slug":"signatures","description":null,"feature_image":null,"parent_id":null,"visibility":"public","og_image":null,"og_title":null,"og_description":null,"twitter_image":null,"twitter_title":null,"twitter_description":null,"meta_title":null,"meta_description":null,"codeinjection_head":null,"codeinjection_foot":null,"canonical_url":null,"accent_color":null,"created_at":"2022-12-14T21:01:45.000Z","updated_at":"2022-12-14T21:01:45.000Z"},{"id":"639a39b9bbda300a2f29c6b7","name":"javascript","slug":"javascript","description":null,"feature_image":null,"parent_id":null,"visibility":"public","og_image":null,"og_title":null,"og_description":null,"twitter_image":null,"twitter_title":null,"twitter_description":null,"meta_title":null,"meta_description":null,"codeinjection_head":null,"codeinjection_foot":null,"canonical_url":null,"accent_color":null,"created_at":"2022-12-14T21:01:45.000Z","updated_at":"2022-12-14T21:01:45.000Z"},{"id":"63c6e993bbda300a2f29c851","name":"strings","slug":"strings","description":null,"feature_image":null,"parent_id":null,"visibility":"public","og_image":null,"og_title":null,"og_description":null,"twitter_image":null,"twitter_title":null,"twitter_description":null,"meta_title":null,"meta_description":null,"codeinjection_head":null,"codeinjection_foot":null,"canonical_url":null,"accent_color":null,"created_at":"2023-01-17T18:31:47.000Z","updated_at":"2023-01-17T18:31:47.000Z"},{"id":"63c6e993bbda300a2f29c852","name":"arrays","slug":"arrays","description":null,"feature_image":null,"parent_id":null,"visibility":"public","og_image":null,"og_title":null,"og_description":null,"twitter_image":null,"twitter_title":null,"twitter_description":null,"meta_title":null,"meta_description":null,"codeinjection_head":null,"codeinjection_foot":null,"canonical_url":null,"accent_color":null,"created_at":"2023-01-17T18:31:47.000Z","updated_at":"2023-01-17T18:31:47.000Z"},{"id":"63c6e993bbda300a2f29c853","name":"loops","slug":"loops","description":null,"feature_image":null,"parent_id":null,"visibility":"public","og_image":null,"og_title":null,"og_description":null,"twitter_image":null,"twitter_title":null,"twitter_description":null,"meta_title":null,"meta_description":null,"codeinjection_head":null,"codeinjection_foot":null,"canonical_url":null,"accent_color":null,"created_at":"2023-01-17T18:31:47.000Z","updated_at":"2023-01-17T18:31:47.000Z"},{"id":"63c9fa00bbda300a2f29ca53","name":"algebra","slug":"algebra","description":null,"feature_image":null,"parent_id":null,"visibility":"public","og_image":null,"og_title":null,"og_description":null,"twitter_image":null,"twitter_title":null,"twitter_description":null,"meta_title":null,"meta_description":null,"codeinjection_head":null,"codeinjection_foot":null,"canonical_url":null,"accent_color":null,"created_at":"2023-01-20T02:18:40.000Z","updated_at":"2023-01-20T02:18:40.000Z"},{"id":"63c9fa00bbda300a2f29ca54","name":"mathematics","slug":"mathematics","description":null,"feature_image":null,"parent_id":null,"visibility":"public","og_image":null,"og_title":null,"og_description":null,"twitter_image":null,"twitter_title":null,"twitter_description":null,"meta_title":null,"meta_description":null,"codeinjection_head":null,"codeinjection_foot":null,"canonical_url":null,"accent_color":null,"created_at":"2023-01-20T02:18:40.000Z","updated_at":"2023-01-20T02:18:40.000Z"},{"id":"63c9fa00bbda300a2f29ca55","name":"parsing","slug":"parsing","description":null,"feature_image":null,"parent_id":null,"visibility":"public","og_image":null,"og_title":null,"og_description":null,"twitter_image":null,"twitter_title":null,"twitter_description":null,"meta_title":null,"meta_description":null,"codeinjection_head":null,"codeinjection_foot":null,"canonical_url":null,"accent_color":null,"created_at":"2023-01-20T02:18:40.000Z","updated_at":"2023-01-20T02:18:40.000Z"},{"id":"63cc4b6cbbda300a2f29cdba","name":"recursion","slug":"recursion","description":null,"feature_image":null,"parent_id":null,"visibility":"public","og_image":null,"og_title":null,"og_description":null,"twitter_image":null,"twitter_title":null,"twitter_description":null,"meta_title":null,"meta_description":null,"codeinjection_head":null,"codeinjection_foot":null,"canonical_url":null,"accent_color":null,"created_at":"2023-01-21T20:30:36.000Z","updated_at":"2023-01-21T20:30:36.000Z"},{"id":"63cc4b6cbbda300a2f29cdbb","name":"codingame","slug":"codingame","description":null,"feature_image":null,"parent_id":null,"visibility":"public","og_image":null,"og_title":null,"og_description":null,"twitter_image":null,"twitter_title":null,"twitter_description":null,"meta_title":null,"meta_description":null,"codeinjection_head":null,"codeinjection_foot":null,"canonical_url":null,"accent_color":null,"created_at":"2023-01-21T20:30:36.000Z","updated_at":"2023-01-21T20:30:36.000Z"},{"id":"63cdc21ebbda300a2f29cff3","name":"regression","slug":"regression","description":null,"feature_image":null,"parent_id":null,"visibility":"public","og_image":null,"og_title":null,"og_description":null,"twitter_image":null,"twitter_title":null,"twitter_description":null,"meta_title":null,"meta_description":null,"codeinjection_head":null,"codeinjection_foot":null,"canonical_url":null,"accent_color":null,"created_at":"2023-01-22T23:09:18.000Z","updated_at":"2023-01-22T23:09:18.000Z"},{"id":"63ee2d40bbda300a2f29d40a","name":"google","slug":"google","description":null,"feature_image":null,"parent_id":null,"visibility":"public","og_image":null,"og_title":null,"og_description":null,"twitter_image":null,"twitter_title":null,"twitter_description":null,"meta_title":null,"meta_description":null,"codeinjection_head":null,"codeinjection_foot":null,"canonical_url":null,"accent_color":null,"created_at":"2023-02-16T13:18:56.000Z","updated_at":"2023-02-16T13:18:56.000Z"},{"id":"63f1ef05bbda300a2f29d45a","name":"queue","slug":"queue","description":null,"feature_image":null,"parent_id":null,"visibility":"public","og_image":null,"og_title":null,"og_description":null,"twitter_image":null,"twitter_title":null,"twitter_description":null,"meta_title":null,"meta_description":null,"codeinjection_head":null,"codeinjection_foot":null,"canonical_url":null,"accent_color":null,"created_at":"2023-02-19T09:42:29.000Z","updated_at":"2023-02-19T09:42:29.000Z"},{"id":"63f43fcabbda300a2f29d4dd","name":"sort","slug":"sort","description":null,"feature_image":null,"parent_id":null,"visibility":"public","og_image":null,"og_title":null,"og_description":null,"twitter_image":null,"twitter_title":null,"twitter_description":null,"meta_title":null,"meta_description":null,"codeinjection_head":null,"codeinjection_foot":null,"canonical_url":null,"accent_color":null,"created_at":"2023-02-21T03:51:38.000Z","updated_at":"2023-02-21T03:51:38.000Z"},{"id":"64003955bbda300a2f29d55c","name":"mongodb","slug":"mongodb","description":null,"feature_image":null,"parent_id":null,"visibility":"public","og_image":null,"og_title":null,"og_description":null,"twitter_image":null,"twitter_title":null,"twitter_description":null,"meta_title":null,"meta_description":null,"codeinjection_head":null,"codeinjection_foot":null,"canonical_url":null,"accent_color":null,"created_at":"2023-03-02T05:51:17.000Z","updated_at":"2023-03-02T05:51:17.000Z"},{"id":"640039d3bbda300a2f29d561","name":"fedora","slug":"fedora","description":null,"feature_image":null,"parent_id":null,"visibility":"public","og_image":null,"og_title":null,"og_description":null,"twitter_image":null,"twitter_title":null,"twitter_description":null,"meta_title":null,"meta_description":null,"codeinjection_head":null,"codeinjection_foot":null,"canonical_url":null,"accent_color":null,"created_at":"2023-03-02T05:53:23.000Z","updated_at":"2023-03-02T05:53:23.000Z"},{"id":"640039d3bbda300a2f29d562","name":"linux","slug":"linux","description":null,"feature_image":null,"parent_id":null,"visibility":"public","og_image":null,"og_title":null,"og_description":null,"twitter_image":null,"twitter_title":null,"twitter_description":null,"meta_title":null,"meta_description":null,"codeinjection_head":null,"codeinjection_foot":null,"canonical_url":null,"accent_color":null,"created_at":"2023-03-02T05:53:23.000Z","updated_at":"2023-03-02T05:53:23.000Z"},{"id":"6409a1e1bbda300a2f29d81d","name":"trpc","slug":"trpc","description":null,"feature_image":null,"parent_id":null,"visibility":"public","og_image":null,"og_title":null,"og_description":null,"twitter_image":null,"twitter_title":null,"twitter_description":null,"meta_title":null,"meta_description":null,"codeinjection_head":null,"codeinjection_foot":null,"canonical_url":null,"accent_color":null,"created_at":"2023-03-09T09:07:45.000Z","updated_at":"2023-03-09T09:07:45.000Z"},{"id":"6409a1e1bbda300a2f29d81e","name":"websocket","slug":"websocket","description":null,"feature_image":null,"parent_id":null,"visibility":"public","og_image":null,"og_title":null,"og_description":null,"twitter_image":null,"twitter_title":null,"twitter_description":null,"meta_title":null,"meta_description":null,"codeinjection_head":null,"codeinjection_foot":null,"canonical_url":null,"accent_color":null,"created_at":"2023-03-09T09:07:45.000Z","updated_at":"2023-03-09T09:07:45.000Z"},{"id":"6409a1e1bbda300a2f29d81f","name":"authorization","slug":"authorization","description":null,"feature_image":null,"parent_id":null,"visibility":"public","og_image":null,"og_title":null,"og_description":null,"twitter_image":null,"twitter_title":null,"twitter_description":null,"meta_title":null,"meta_description":null,"codeinjection_head":null,"codeinjection_foot":null,"canonical_url":null,"accent_color":null,"created_at":"2023-03-09T09:07:45.000Z","updated_at":"2023-03-09T09:07:45.000Z"},{"id":"641552b80f360525ad85185e","name":"gpt","slug":"gpt","description":null,"feature_image":null,"parent_id":null,"visibility":"public","og_image":null,"og_title":null,"og_description":null,"twitter_image":null,"twitter_title":null,"twitter_description":null,"meta_title":null,"meta_description":null,"codeinjection_head":null,"codeinjection_foot":null,"canonical_url":null,"accent_color":null,"created_at":"2023-03-18T05:57:12.000Z","updated_at":"2023-03-18T05:57:12.000Z"},{"id":"641552b80f360525ad85185f","name":"cli","slug":"cli","description":null,"feature_image":null,"parent_id":null,"visibility":"public","og_image":null,"og_title":null,"og_description":null,"twitter_image":null,"twitter_title":null,"twitter_description":null,"meta_title":null,"meta_description":null,"codeinjection_head":null,"codeinjection_foot":null,"canonical_url":null,"accent_color":null,"created_at":"2023-03-18T05:57:12.000Z","updated_at":"2023-03-18T05:57:12.000Z"},{"id":"6417f1970f360525ad8518ee","name":"arch","slug":"arch","description":null,"feature_image":null,"parent_id":null,"visibility":"public","og_image":null,"og_title":null,"og_description":null,"twitter_image":null,"twitter_title":null,"twitter_description":null,"meta_title":null,"meta_description":null,"codeinjection_head":null,"codeinjection_foot":null,"canonical_url":null,"accent_color":null,"created_at":"2023-03-20T05:39:35.000Z","updated_at":"2023-03-20T05:39:35.000Z"},{"id":"6417f1970f360525ad8518ef","name":"docker","slug":"docker","description":null,"feature_image":null,"parent_id":null,"visibility":"public","og_image":null,"og_title":null,"og_description":null,"twitter_image":null,"twitter_title":null,"twitter_description":null,"meta_title":null,"meta_description":null,"codeinjection_head":null,"codeinjection_foot":null,"canonical_url":null,"accent_color":null,"created_at":"2023-03-20T05:39:35.000Z","updated_at":"2023-03-20T05:39:35.000Z"},{"id":"6417f1970f360525ad8518f0","name":"yay","slug":"yay","description":null,"feature_image":null,"parent_id":null,"visibility":"public","og_image":null,"og_title":null,"og_description":null,"twitter_image":null,"twitter_title":null,"twitter_description":null,"meta_title":null,"meta_description":null,"codeinjection_head":null,"codeinjection_foot":null,"canonical_url":null,"accent_color":null,"created_at":"2023-03-20T05:39:35.000Z","updated_at":"2023-03-20T05:39:35.000Z"},{"id":"641f9b6e99d7a498d8917d1e","name":"esm","slug":"esm","description":null,"feature_image":null,"parent_id":null,"visibility":"public","og_image":null,"og_title":null,"og_description":null,"twitter_image":null,"twitter_title":null,"twitter_description":null,"meta_title":null,"meta_description":null,"codeinjection_head":null,"codeinjection_foot":null,"canonical_url":null,"accent_color":null,"created_at":"2023-03-26T01:10:06.000Z","updated_at":"2023-03-26T01:10:06.000Z"},{"id":"641f9b6e99d7a498d8917d1f","name":"cjs","slug":"cjs","description":null,"feature_image":null,"parent_id":null,"visibility":"public","og_image":null,"og_title":null,"og_description":null,"twitter_image":null,"twitter_title":null,"twitter_description":null,"meta_title":null,"meta_description":null,"codeinjection_head":null,"codeinjection_foot":null,"canonical_url":null,"accent_color":null,"created_at":"2023-03-26T01:10:06.000Z","updated_at":"2023-03-26T01:10:06.000Z"},{"id":"6422d2f599d7a498d8917d69","name":"json","slug":"json","description":null,"feature_image":null,"parent_id":null,"visibility":"public","og_image":null,"og_title":null,"og_description":null,"twitter_image":null,"twitter_title":null,"twitter_description":null,"meta_title":null,"meta_description":null,"codeinjection_head":null,"codeinjection_foot":null,"canonical_url":null,"accent_color":null,"created_at":"2023-03-28T11:43:49.000Z","updated_at":"2023-03-28T11:43:49.000Z"},{"id":"6422d2f599d7a498d8917d6a","name":"rfc","slug":"rfc","description":null,"feature_image":null,"parent_id":null,"visibility":"public","og_image":null,"og_title":null,"og_description":null,"twitter_image":null,"twitter_title":null,"twitter_description":null,"meta_title":null,"meta_description":null,"codeinjection_head":null,"codeinjection_foot":null,"canonical_url":null,"accent_color":null,"created_at":"2023-03-28T11:43:49.000Z","updated_at":"2023-03-28T11:43:49.000Z"},{"id":"642e549cc61a14d8a5114971","name":"test","slug":"test","description":null,"feature_image":null,"parent_id":null,"visibility":"public","og_image":null,"og_title":null,"og_description":null,"twitter_image":null,"twitter_title":null,"twitter_description":null,"meta_title":null,"meta_description":null,"codeinjection_head":null,"codeinjection_foot":null,"canonical_url":null,"accent_color":null,"created_at":"2023-04-06T05:11:56.000Z","updated_at":"2023-04-06T05:11:56.000Z"}],"users":[{"id":"1","name":"Daniel Gustaw","slug":"precise","password":"$2a$10$z4MD2B68G3CWvwqPoqmjh.ahrk9lDN9Rf0CesECRLdKTfr14YufTm","email":"gustaw.daniel@gmail.com","profile_image":"__GHOST_URL__/content/images/2022/11/Daniel-Gustaw---compressed.jpg","cover_image":null,"bio":null,"website":null,"location":null,"facebook":null,"twitter":null,"accessibility":"{\"whatsNew\":{\"lastSeenDate\":\"2023-02-14T16:17:02.000+00:00\"},\"nightShift\":false}","status":"active","locale":null,"visibility":"public","meta_title":null,"meta_description":null,"tour":null,"last_seen":"2023-09-02T17:44:59.000Z","created_at":"2021-04-07T08:55:26.000Z","updated_at":"2023-09-02T18:12:34.000Z","comment_notifications":1,"free_member_signup_notification":1,"paid_subscription_canceled_notification":0,"paid_subscription_started_notification":1,"mention_notifications":1,"milestone_notifications":1},{"id":"5951f5fca366002ebd5dbef7","name":"Ghost","slug":"ghost","password":"$2a$10$LdWJ3.BqCETEDX.sgEZMM.jbSif50zKGD.ZVQwAeREdZn9HcBwovG","email":"ghost-author@example.com","profile_image":"https://static.ghost.org/v4.0.0/images/ghost-user.png","cover_image":null,"bio":"You can delete this user to remove all the welcome posts","website":"https://ghost.org","location":"The Internet","facebook":"ghost","twitter":"ghost","accessibility":null,"status":"active","locale":null,"visibility":"public","meta_title":null,"meta_description":null,"tour":null,"last_seen":null,"created_at":"2021-04-07T08:55:27.000Z","updated_at":"2021-04-07T08:55:27.000Z","comment_notifications":1,"free_member_signup_notification":1,"paid_subscription_canceled_notification":0,"paid_subscription_started_notification":1,"mention_notifications":1,"milestone_notifications":1},{"id":"606d7a3d5d6c891ac9aa723f","name":"Krzysztof Dziardziel","slug":"dziardziel","password":"$2a$10$SWMqBSc55SQg5UJwxoFLFOCzL20DDduljOOBrp7K8eHnsa1521d4G","email":"krzysztof.dziardziel@preciselab.io","profile_image":"__GHOST_URL__/content/images/2021/04/Krzysztof-Dziardziel---Profile-photo.jpg","cover_image":"__GHOST_URL__/content/images/2021/04/bckgrnd-1.jpeg","bio":null,"website":null,"location":"Warsaw, Poland","facebook":null,"twitter":null,"accessibility":"{\"nightShift\":false}","status":"active","locale":null,"visibility":"public","meta_title":null,"meta_description":null,"tour":null,"last_seen":"2021-08-15T23:21:46.000Z","created_at":"2021-04-07T09:24:13.000Z","updated_at":"2021-08-15T23:21:46.000Z","comment_notifications":1,"free_member_signup_notification":1,"paid_subscription_canceled_notification":0,"paid_subscription_started_notification":1,"mention_notifications":1,"milestone_notifications":1},{"id":"606d7c205d6c891ac9aa725d","name":"Angelina","slug":"angelina","password":"$2a$10$CabS50ySvYe73ZJBZCXekO0mfxyrouASD6O5ZvBnp7Li4/Oz.Y8Zy","email":"angelina.zaretska@preciselab.io","profile_image":"__GHOST_URL__/content/images/2021/04/569001F4-9CCB-43CB-A2DE-4C8B1661868C.jpeg","cover_image":null,"bio":null,"website":null,"location":null,"facebook":null,"twitter":null,"accessibility":null,"status":"active","locale":null,"visibility":"public","meta_title":null,"meta_description":null,"tour":null,"last_seen":"2021-04-07T09:32:17.000Z","created_at":"2021-04-07T09:32:16.000Z","updated_at":"2021-04-07T09:44:40.000Z","comment_notifications":1,"free_member_signup_notification":1,"paid_subscription_canceled_notification":0,"paid_subscription_started_notification":1,"mention_notifications":1,"milestone_notifications":1},{"id":"606d7ea75d6c891ac9aa7299","name":"Jakub Szulc","slug":"jakub","password":"$2a$10$9DP2GSvHmeE0UOTCrwBRseRH/YACpuJYrFgTmlTfPtk9bCxFwCpb.","email":"jakub.szulc@preciselab.io","profile_image":null,"cover_image":null,"bio":null,"website":null,"location":null,"facebook":null,"twitter":null,"accessibility":null,"status":"active","locale":null,"visibility":"public","meta_title":null,"meta_description":null,"tour":null,"last_seen":"2021-04-07T09:43:04.000Z","created_at":"2021-04-07T09:43:03.000Z","updated_at":"2021-04-07T09:43:04.000Z","comment_notifications":1,"free_member_signup_notification":1,"paid_subscription_canceled_notification":0,"paid_subscription_started_notification":1,"mention_notifications":1,"milestone_notifications":1}]}}]}